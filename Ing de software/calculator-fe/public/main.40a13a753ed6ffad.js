(self.webpackChunkcalculator=self.webpackChunkcalculator||[]).push([[179],{6089:(Lt,rt,xe)=>{"use strict";var de=xe(9095),ye=xe(4703),p="\n  ",K={};function ge(ae){var X=Array.isArray(ae);return function(te){var ue=Te(K.plainArray,te);if(ue)return ue;if(X&&te.length!==ae.length)return"an array with "+ae.length+" items";for(var oe=0;oe<te.length;oe++)if(ue=Te(X?ae[oe]:ae,te[oe]))return[oe].concat(ue)}}function Te(ae,X){if(null!=X||ae.hasOwnProperty("__required")){var re=ae(X);if(re)return Array.isArray(re)?re:[re]}}function Pe(ae,X){var re=ae.length,Q=ae[re-1],te=ae.slice(0,re-1);return 0===te.length&&(te=["value"]),X=ye(X,{path:te}),"function"==typeof Q?Q(X):He(X,function bt(ae){return"must be "+function nt(ae){return/^an? /.test(ae)?ae:/^[aeiou]/i.test(ae)?"an "+ae:/^[a-z]/i.test(ae)?"a "+ae:ae}(ae)+"."}(Q))}function Fe(ae){return ae.length<2?ae[0]:2===ae.length?ae.join(" or "):ae.slice(0,-1).join(", ")+", or "+ae.slice(-1)}function He(ae,X){return(dt(ae.path)?"Item at position ":"")+ae.path.join(".")+" "+X}function dt(ae){return"number"==typeof ae[ae.length-1]||"number"==typeof ae[0]}K.assert=function(ae,X){return X=X||{},function(re){var Q=Te(ae,re);if(Q){var te=Pe(Q,X);throw X.apiName&&(te=X.apiName+": "+te),new Error(te)}}},K.shape=function(X){var re=function Rt(ae){return Object.keys(ae||{}).map(function(X){return{key:X,value:ae[X]}})}(X);return function(te){var ue=Te(K.plainObject,te);if(ue)return ue;for(var oe,me=[],ne=0;ne<re.length;ne++)(ue=Te(re[ne].value,te[oe=re[ne].key]))&&me.push([oe].concat(ue));return me.length<2?me[0]:function(ct){me=me.map(function(Se){return"- "+Se[0]+": "+Pe(Se,ct).split("\n").join(p)});var je=ct.path.join(".");return"The following properties"+("value"===je?"":" of "+je)+" have invalid values:"+p+me.join(p)}}},K.strictShape=function(X){var re=K.shape(X);return function(te){var ue=re(te);if(ue)return ue;var oe=Object.keys(te).reduce(function(le,me){return void 0===X[me]&&le.push(me),le},[]);return 0!==oe.length?function(){return"The following keys are invalid: "+oe.join(", ")}:void 0}},K.arrayOf=function(X){return ge(X)},K.tuple=function(){var X=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return ge(X)},K.required=function(X){function re(Q){return null==Q?function(te){return He(te,dt(te.path)?"cannot be undefined/null.":"is required.")}:X.apply(this,arguments)}return re.__required=!0,re},K.oneOfType=function(){var X=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(Q){var te=X.map(function(ue){return Te(ue,Q)}).filter(Boolean);if(te.length===X.length)return te.every(function(ue){return 1===ue.length&&"string"==typeof ue[0]})?Fe(te.map(function(ue){return ue[0]})):te.reduce(function(ue,oe){return oe.length>ue.length?oe:ue})}},K.equal=function(X){return function(Q){if(Q!==X)return JSON.stringify(X)}},K.oneOf=function(){var X=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),re=X.map(function(Q){return K.equal(Q)});return K.oneOfType.apply(this,re)},K.range=function(X){var re=X[0],Q=X[1];return function(ue){if(Te(K.number,ue)||ue<re||ue>Q)return"number between "+re+" & "+Q+" (inclusive)"}},K.any=function(){},K.boolean=function(X){if("boolean"!=typeof X)return"boolean"},K.number=function(X){if("number"!=typeof X)return"number"},K.plainArray=function(X){if(!Array.isArray(X))return"array"},K.plainObject=function(X){if(!de(X))return"object"},K.string=function(X){if("string"!=typeof X)return"string"},K.func=function(X){if("function"!=typeof X)return"function"},K.validate=Te,K.processMessage=Pe,Lt.exports=K},9095:Lt=>{"use strict";var rt=Object.prototype.toString;Lt.exports=function(xe){var de;return"[object Object]"===rt.call(xe)&&(null===(de=Object.getPrototypeOf(xe))||de===Object.getPrototypeOf({}))}},8527:function(Lt){Lt.exports=function(){"use strict";var rt=function(k,G){var we={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},st={on:function(Mt,Dt,Cn){if(void 0===we[Mt])throw new Error("Invalid event type: "+Mt);we[Mt].push({selector:Dt,fn:Cn})},render:function(Mt){G.store.featureChanged(Mt)}},at=function(Mt,Dt){for(var Cn=we[Mt],Mn=Cn.length;Mn--;){var Zn=Cn[Mn];if(Zn.selector(Dt)){Zn.fn.call(st,Dt)||G.store.render(),G.ui.updateMapClasses();break}}};return k.start.call(st),{render:k.render,stop:function(){k.stop&&k.stop()},trash:function(){k.trash&&(k.trash(),G.store.render())},combineFeatures:function(){k.combineFeatures&&k.combineFeatures()},uncombineFeatures:function(){k.uncombineFeatures&&k.uncombineFeatures()},drag:function(Mt){at("drag",Mt)},click:function(Mt){at("click",Mt)},mousemove:function(Mt){at("mousemove",Mt)},mousedown:function(Mt){at("mousedown",Mt)},mouseup:function(Mt){at("mouseup",Mt)},mouseout:function(Mt){at("mouseout",Mt)},keydown:function(Mt){at("keydown",Mt)},keyup:function(Mt){at("keyup",Mt)},touchstart:function(Mt){at("touchstart",Mt)},touchmove:function(Mt){at("touchmove",Mt)},touchend:function(Mt){at("touchend",Mt)},tap:function(Mt){at("tap",Mt)}}};var de={},Ce_RADIUS=6378137;function p(k){var G=0;if(k&&k.length>0){G+=Math.abs(K(k[0]));for(var we=1;we<k.length;we++)G-=Math.abs(K(k[we]))}return G}function K(k){var G,we,st,at,Mt,Dt,Cn=0,Mn=k.length;if(Mn>2){for(Dt=0;Dt<Mn;Dt++)Dt===Mn-2?(st=Mn-2,at=Mn-1,Mt=0):Dt===Mn-1?(st=Mn-1,at=0,Mt=1):(st=Dt,at=Dt+1,Mt=Dt+2),G=k[st],we=k[at],Cn+=(ge(k[Mt][0])-ge(G[0]))*Math.sin(ge(we[1]));Cn=Cn*Ce_RADIUS*Ce_RADIUS/2}return Cn}function ge(k){return k*Math.PI/180}de.geometry=function k(G){var we,st=0;switch(G.type){case"Polygon":return p(G.coordinates);case"MultiPolygon":for(we=0;we<G.coordinates.length;we++)st+=p(G.coordinates[we]);return st;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(we=0;we<G.geometries.length;we++)st+=k(G.geometries[we]);return st}},de.ring=K;var Te={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Pe={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Fe={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},bt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},nt={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},He={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},dt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Rt={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},ae={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},X={ACTIVE:"true",INACTIVE:"false"},re=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],te=Object.freeze({__proto__:null,classes:Te,sources:Pe,cursors:Fe,types:bt,geojsonTypes:nt,modes:He,events:dt,updateActions:Rt,meta:ae,activeStates:X,interactions:re,LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ue={Point:0,LineString:1,MultiLineString:1,Polygon:2};function oe(k,G){var we=ue[k.geometry.type]-ue[G.geometry.type];return 0===we&&k.geometry.type===nt.POLYGON?k.area-G.area:we}function le(k){return k.map(function(G){return G.geometry.type===nt.POLYGON&&(G.area=de.geometry({type:nt.FEATURE,property:{},geometry:G.geometry})),G}).sort(oe).map(function(G){return delete G.area,G})}function me(k,G){return void 0===G&&(G=0),[[k.point.x-G,k.point.y-G],[k.point.x+G,k.point.y+G]]}function ne(k){if(this._items={},this._nums={},this._length=k?k.length:0,k)for(var G=0,we=k.length;G<we;G++)this.add(k[G]),void 0!==k[G]&&("string"==typeof k[G]?this._items[k[G]]=G:this._nums[k[G]]=G)}ne.prototype.add=function(k){return this.has(k)||(this._length++,"string"==typeof k?this._items[k]=this._length:this._nums[k]=this._length),this},ne.prototype.delete=function(k){return!1===this.has(k)||(this._length--,delete this._items[k],delete this._nums[k]),this},ne.prototype.has=function(k){return!("string"!=typeof k&&"number"!=typeof k||void 0===this._items[k]&&void 0===this._nums[k])},ne.prototype.values=function(){var k=this,G=[];return Object.keys(this._items).forEach(function(we){G.push({k:we,v:k._items[we]})}),Object.keys(this._nums).forEach(function(we){G.push({k:JSON.parse(we),v:k._nums[we]})}),G.sort(function(we,st){return we.v-st.v}).map(function(we){return we.k})},ne.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var ct=[ae.FEATURE,ae.MIDPOINT,ae.VERTEX],je={click:function(k,G,we){return We(k,G,we,we.options.clickBuffer)},touch:function(k,G,we){return We(k,G,we,we.options.touchBuffer)}};function We(k,G,we,st){if(null===we.map)return[];var at=k?me(k,st):G,Mt={};we.options.styles&&(Mt.layers=we.options.styles.map(function(Zn){return Zn.id}));var Dt=we.map.queryRenderedFeatures(at,Mt).filter(function(Zn){return-1!==ct.indexOf(Zn.properties.meta)}),Cn=new ne,Mn=[];return Dt.forEach(function(Zn){var Qn=Zn.properties.id;Cn.has(Qn)||(Cn.add(Qn),Mn.push(Zn))}),le(Mn)}function Se(k,G){var we=je.click(k,null,G),st={mouse:Fe.NONE};return we[0]&&(st.mouse=we[0].properties.active===X.ACTIVE?Fe.MOVE:Fe.POINTER,st.feature=we[0].properties.meta),-1!==G.events.currentModeName().indexOf("draw")&&(st.mouse=Fe.ADD),G.ui.queueMapClasses(st),G.ui.updateMapClasses(),we[0]}function ln(k,G){var we=k.x-G.x,st=k.y-G.y;return Math.sqrt(we*we+st*st)}function Bt(k,G,we){void 0===we&&(we={});var st=null!=we.fineTolerance?we.fineTolerance:4,at=null!=we.grossTolerance?we.grossTolerance:12,Mt=null!=we.interval?we.interval:500;k.point=k.point||G.point,k.time=k.time||G.time;var Dt=ln(k.point,G.point);return Dt<st||Dt<at&&G.time-k.time<Mt}function $e(k,G,we){void 0===we&&(we={});var st=null!=we.tolerance?we.tolerance:25,at=null!=we.interval?we.interval:250;return k.point=k.point||G.point,k.time=k.time||G.time,ln(k.point,G.point)<st&&G.time-k.time<at}var Tt={},Xe={get exports(){return Tt},set exports(k){Tt=k}}.exports=function(k,G){if(G||(G=16),void 0===k&&(k=128),k<=0)return"0";for(var we=Math.log(Math.pow(2,k))/Math.log(G),st=2;we===1/0;st*=2)we=Math.log(Math.pow(2,k/st))/Math.log(G)*st;var at=we-Math.floor(we),Mt="";for(st=0;st<Math.floor(we);st++)Mt=Math.floor(Math.random()*G).toString(G)+Mt;if(at){var Dt=Math.pow(G,at);Mt=Math.floor(Math.random()*Dt).toString(G)+Mt}var Cn=parseInt(Mt,G);return Cn!==1/0&&Cn>=Math.pow(2,k)?Xe(k,G):Mt};Xe.rack=function(k,G,we){var st=function(Mt){var Dt=0;do{if(Dt++>10){if(!we)throw new Error("too many ID collisions, use more bits");k+=we}var Cn=Xe(k,G)}while(Object.hasOwnProperty.call(at,Cn));return at[Cn]=Mt,Cn},at=st.hats={};return st.get=function(Mt){return st.hats[Mt]},st.set=function(Mt,Dt){return st.hats[Mt]=Dt,st},st.bits=k||128,st.base=G||16,st};var gt=function(k,G){this.ctx=k,this.properties=G.properties||{},this.coordinates=G.geometry.coordinates,this.id=G.id||Tt(),this.type=G.geometry.type};gt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},gt.prototype.incomingCoords=function(k){this.setCoordinates(k)},gt.prototype.setCoordinates=function(k){this.coordinates=k,this.changed()},gt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},gt.prototype.setProperty=function(k,G){this.properties[k]=G},gt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:nt.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},gt.prototype.internal=function(k){var G={id:this.id,meta:ae.FEATURE,"meta:type":this.type,active:X.INACTIVE,mode:k};if(this.ctx.options.userProperties)for(var we in this.properties)G["user_"+we]=this.properties[we];return{type:nt.FEATURE,properties:G,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var xt=function(k,G){gt.call(this,k,G)};(xt.prototype=Object.create(gt.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},xt.prototype.updateCoordinate=function(k,G,we){this.coordinates=3===arguments.length?[G,we]:[k,G],this.changed()},xt.prototype.getCoordinate=function(){return this.getCoordinates()};var Be=function(k,G){gt.call(this,k,G)};(Be.prototype=Object.create(gt.prototype)).isValid=function(){return this.coordinates.length>1},Be.prototype.addCoordinate=function(k,G,we){this.changed();var st=parseInt(k,10);this.coordinates.splice(st,0,[G,we])},Be.prototype.getCoordinate=function(k){var G=parseInt(k,10);return JSON.parse(JSON.stringify(this.coordinates[G]))},Be.prototype.removeCoordinate=function(k){this.changed(),this.coordinates.splice(parseInt(k,10),1)},Be.prototype.updateCoordinate=function(k,G,we){var st=parseInt(k,10);this.coordinates[st]=[G,we],this.changed()};var qt=function(k,G){gt.call(this,k,G),this.coordinates=this.coordinates.map(function(we){return we.slice(0,-1)})};(qt.prototype=Object.create(gt.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(k){return k.length>2})},qt.prototype.incomingCoords=function(k){this.coordinates=k.map(function(G){return G.slice(0,-1)}),this.changed()},qt.prototype.setCoordinates=function(k){this.coordinates=k,this.changed()},qt.prototype.addCoordinate=function(k,G,we){this.changed();var st=k.split(".").map(function(at){return parseInt(at,10)});this.coordinates[st[0]].splice(st[1],0,[G,we])},qt.prototype.removeCoordinate=function(k){this.changed();var G=k.split(".").map(function(st){return parseInt(st,10)}),we=this.coordinates[G[0]];we&&(we.splice(G[1],1),we.length<3&&this.coordinates.splice(G[0],1))},qt.prototype.getCoordinate=function(k){var G=k.split(".").map(function(st){return parseInt(st,10)});return JSON.parse(JSON.stringify(this.coordinates[G[0]][G[1]]))},qt.prototype.getCoordinates=function(){return this.coordinates.map(function(k){return k.concat([k[0]])})},qt.prototype.updateCoordinate=function(k,G,we){this.changed();var st=k.split("."),at=parseInt(st[0],10),Mt=parseInt(st[1],10);void 0===this.coordinates[at]&&(this.coordinates[at]=[]),this.coordinates[at][Mt]=[G,we]};var $t={MultiPoint:xt,MultiLineString:Be,MultiPolygon:qt},pn=function(k,G,we,st,at){var Mt=we.split("."),Dt=parseInt(Mt[0],10),Cn=Mt[1]?Mt.slice(1).join("."):null;return k[Dt][G](Cn,st,at)},At=function(k,G){if(gt.call(this,k,G),delete this.coordinates,this.model=$t[G.geometry.type],void 0===this.model)throw new TypeError(G.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(G.geometry.coordinates)};function Sn(k){this.map=k.map,this.drawConfig=JSON.parse(JSON.stringify(k.options||{})),this._ctx=k}(At.prototype=Object.create(gt.prototype))._coordinatesToFeatures=function(k){var G=this,we=this.model.bind(this);return k.map(function(st){return new we(G.ctx,{id:Tt(),type:nt.FEATURE,properties:{},geometry:{coordinates:st,type:G.type.replace("Multi","")}})})},At.prototype.isValid=function(){return this.features.every(function(k){return k.isValid()})},At.prototype.setCoordinates=function(k){this.features=this._coordinatesToFeatures(k),this.changed()},At.prototype.getCoordinate=function(k){return pn(this.features,"getCoordinate",k)},At.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(k){return k.type===nt.POLYGON?k.getCoordinates():k.coordinates})))},At.prototype.updateCoordinate=function(k,G,we){pn(this.features,"updateCoordinate",k,G,we),this.changed()},At.prototype.addCoordinate=function(k,G,we){pn(this.features,"addCoordinate",k,G,we),this.changed()},At.prototype.removeCoordinate=function(k){pn(this.features,"removeCoordinate",k),this.changed()},At.prototype.getFeatures=function(){return this.features},Sn.prototype.setSelected=function(k){return this._ctx.store.setSelected(k)},Sn.prototype.setSelectedCoordinates=function(k){var G=this;this._ctx.store.setSelectedCoordinates(k),k.reduce(function(we,st){return void 0===we[st.feature_id]&&(we[st.feature_id]=!0,G._ctx.store.get(st.feature_id).changed()),we},{})},Sn.prototype.getSelected=function(){return this._ctx.store.getSelected()},Sn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Sn.prototype.isSelected=function(k){return this._ctx.store.isSelected(k)},Sn.prototype.getFeature=function(k){return this._ctx.store.get(k)},Sn.prototype.select=function(k){return this._ctx.store.select(k)},Sn.prototype.deselect=function(k){return this._ctx.store.deselect(k)},Sn.prototype.deleteFeature=function(k,G){return void 0===G&&(G={}),this._ctx.store.delete(k,G)},Sn.prototype.addFeature=function(k){return this._ctx.store.add(k)},Sn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Sn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Sn.prototype.setActionableState=function(k){return void 0===k&&(k={}),this._ctx.events.actionable({trash:k.trash||!1,combineFeatures:k.combineFeatures||!1,uncombineFeatures:k.uncombineFeatures||!1})},Sn.prototype.changeMode=function(k,G,we){return void 0===G&&(G={}),void 0===we&&(we={}),this._ctx.events.changeMode(k,G,we)},Sn.prototype.updateUIClasses=function(k){return this._ctx.ui.queueMapClasses(k)},Sn.prototype.activateUIButton=function(k){return this._ctx.ui.setActiveButton(k)},Sn.prototype.featuresAt=function(k,G,we){if(void 0===we&&(we="click"),"click"!==we&&"touch"!==we)throw new Error("invalid buffer type");return je[we](k,G,this._ctx)},Sn.prototype.newFeature=function(k){var G=k.geometry.type;return G===nt.POINT?new xt(this._ctx,k):G===nt.LINE_STRING?new Be(this._ctx,k):G===nt.POLYGON?new qt(this._ctx,k):new At(this._ctx,k)},Sn.prototype.isInstanceOf=function(k,G){if(k===nt.POINT)return G instanceof xt;if(k===nt.LINE_STRING)return G instanceof Be;if(k===nt.POLYGON)return G instanceof qt;if("MultiFeature"===k)return G instanceof At;throw new Error("Unknown feature class: "+k)},Sn.prototype.doRender=function(k){return this._ctx.store.featureChanged(k)},Sn.prototype.onSetup=function(){},Sn.prototype.onDrag=function(){},Sn.prototype.onClick=function(){},Sn.prototype.onMouseMove=function(){},Sn.prototype.onMouseDown=function(){},Sn.prototype.onMouseUp=function(){},Sn.prototype.onMouseOut=function(){},Sn.prototype.onKeyUp=function(){},Sn.prototype.onKeyDown=function(){},Sn.prototype.onTouchStart=function(){},Sn.prototype.onTouchMove=function(){},Sn.prototype.onTouchEnd=function(){},Sn.prototype.onTap=function(){},Sn.prototype.onStop=function(){},Sn.prototype.onTrash=function(){},Sn.prototype.onCombineFeature=function(){},Sn.prototype.onUncombineFeature=function(){},Sn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Yn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Kn=Object.keys(Yn);function Un(k){return[].concat(k).filter(function(G){return void 0!==G})}function Rn(){var k=this;if(!k.ctx.map||void 0===k.ctx.map.getSource(Pe.HOT))return Mn();var G=k.ctx.events.currentModeName();k.ctx.ui.queueMapClasses({mode:G});var we=[],st=[];k.isDirty?st=k.getAllIds():(we=k.getChangedIds().filter(function(Zn){return void 0!==k.get(Zn)}),st=k.sources.hot.filter(function(Zn){return Zn.properties.id&&-1===we.indexOf(Zn.properties.id)&&void 0!==k.get(Zn.properties.id)}).map(function(Zn){return Zn.properties.id})),k.sources.hot=[];var at=k.sources.cold.length;k.sources.cold=k.isDirty?[]:k.sources.cold.filter(function(Zn){return-1===we.indexOf(Zn.properties.id||Zn.properties.parent)});var Mt=at!==k.sources.cold.length||st.length>0;function Dt(Zn,Qn){var jn=k.get(Zn).internal(G);k.ctx.events.currentModeRender(jn,function(cn){k.sources[Qn].push(cn)})}if(we.forEach(function(Zn){return Dt(Zn,"hot")}),st.forEach(function(Zn){return Dt(Zn,"cold")}),Mt&&k.ctx.map.getSource(Pe.COLD).setData({type:nt.FEATURE_COLLECTION,features:k.sources.cold}),k.ctx.map.getSource(Pe.HOT).setData({type:nt.FEATURE_COLLECTION,features:k.sources.hot}),k._emitSelectionChange&&(k.ctx.map.fire(dt.SELECTION_CHANGE,{features:k.getSelected().map(function(Zn){return Zn.toGeoJSON()}),points:k.getSelectedCoordinates().map(function(Zn){return{type:nt.FEATURE,properties:{},geometry:{type:nt.POINT,coordinates:Zn.coordinates}}})}),k._emitSelectionChange=!1),k._deletedFeaturesToEmit.length){var Cn=k._deletedFeaturesToEmit.map(function(Zn){return Zn.toGeoJSON()});k._deletedFeaturesToEmit=[],k.ctx.map.fire(dt.DELETE,{features:Cn})}function Mn(){k.isDirty=!1,k.clearChangedIds()}Mn(),k.ctx.map.fire(dt.RENDER,{})}function Jn(k){var G,we=this;this._features={},this._featureIds=new ne,this._selectedFeatureIds=new ne,this._selectedCoordinates=[],this._changedFeatureIds=new ne,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=k,this.sources={hot:[],cold:[]},this.render=function(){G||(G=requestAnimationFrame(function(){G=null,Rn.call(we)}))},this.isDirty=!1}function Ei(k,G){var we=k._selectedCoordinates.filter(function(st){return k._selectedFeatureIds.has(st.feature_id)});k._selectedCoordinates.length===we.length||G.silent||(k._emitSelectionChange=!0),k._selectedCoordinates=we}Jn.prototype.createRenderBatch=function(){var k=this,G=this.render,we=0;return this.render=function(){we++},function(){k.render=G,we>0&&k.render()}},Jn.prototype.setDirty=function(){return this.isDirty=!0,this},Jn.prototype.featureChanged=function(k){return this._changedFeatureIds.add(k),this},Jn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Jn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Jn.prototype.getAllIds=function(){return this._featureIds.values()},Jn.prototype.add=function(k){return this.featureChanged(k.id),this._features[k.id]=k,this._featureIds.add(k.id),this},Jn.prototype.delete=function(k,G){var we=this;return void 0===G&&(G={}),Un(k).forEach(function(st){we._featureIds.has(st)&&(we._featureIds.delete(st),we._selectedFeatureIds.delete(st),G.silent||-1===we._deletedFeaturesToEmit.indexOf(we._features[st])&&we._deletedFeaturesToEmit.push(we._features[st]),delete we._features[st],we.isDirty=!0)}),Ei(this,G),this},Jn.prototype.get=function(k){return this._features[k]},Jn.prototype.getAll=function(){var k=this;return Object.keys(this._features).map(function(G){return k._features[G]})},Jn.prototype.select=function(k,G){var we=this;return void 0===G&&(G={}),Un(k).forEach(function(st){we._selectedFeatureIds.has(st)||(we._selectedFeatureIds.add(st),we._changedFeatureIds.add(st),G.silent||(we._emitSelectionChange=!0))}),this},Jn.prototype.deselect=function(k,G){var we=this;return void 0===G&&(G={}),Un(k).forEach(function(st){we._selectedFeatureIds.has(st)&&(we._selectedFeatureIds.delete(st),we._changedFeatureIds.add(st),G.silent||(we._emitSelectionChange=!0))}),Ei(this,G),this},Jn.prototype.clearSelected=function(k){return void 0===k&&(k={}),this.deselect(this._selectedFeatureIds.values(),{silent:k.silent}),this},Jn.prototype.setSelected=function(k,G){var we=this;return void 0===G&&(G={}),k=Un(k),this.deselect(this._selectedFeatureIds.values().filter(function(st){return-1===k.indexOf(st)}),{silent:G.silent}),this.select(k.filter(function(st){return!we._selectedFeatureIds.has(st)}),{silent:G.silent}),this},Jn.prototype.setSelectedCoordinates=function(k){return this._selectedCoordinates=k,this._emitSelectionChange=!0,this},Jn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Jn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Jn.prototype.getSelected=function(){var k=this;return this._selectedFeatureIds.values().map(function(G){return k.get(G)})},Jn.prototype.getSelectedCoordinates=function(){var k=this;return this._selectedCoordinates.map(function(G){return{coordinates:k.get(G.feature_id).getCoordinate(G.coord_path)}})},Jn.prototype.isSelected=function(k){return this._selectedFeatureIds.has(k)},Jn.prototype.setFeatureProperty=function(k,G,we){this.get(k).setProperty(G,we),this.featureChanged(k)},Jn.prototype.storeMapConfig=function(){var k=this;re.forEach(function(G){k.ctx.map[G]&&(k._mapInitialConfig[G]=k.ctx.map[G].isEnabled())})},Jn.prototype.restoreMapConfig=function(){var k=this;Object.keys(this._mapInitialConfig).forEach(function(G){k._mapInitialConfig[G]?k.ctx.map[G].enable():k.ctx.map[G].disable()})},Jn.prototype.getInitialConfigValue=function(k){return void 0===this._mapInitialConfig[k]||this._mapInitialConfig[k]};var Ai=function(){for(var k=arguments,G={},we=0;we<arguments.length;we++){var st=k[we];for(var at in st)Sr.call(st,at)&&(G[at]=st[at])}return G},Sr=Object.prototype.hasOwnProperty,zr=["mode","feature","mouse"];function Nt(k){var G=null,we=null,st={onRemove:function(){return k.map.off("load",st.connect),clearInterval(we),st.removeLayers(),k.store.restoreMapConfig(),k.ui.removeButtons(),k.events.removeEventListeners(),k.ui.clearMapClasses(),k.map=null,k.container=null,k.store=null,G&&G.parentNode&&G.parentNode.removeChild(G),G=null,this},connect:function(){k.map.off("load",st.connect),clearInterval(we),st.addLayers(),k.store.storeMapConfig(),k.events.addEventListeners()},onAdd:function(at){var Mt=at.fire;return at.fire=function(Dt,Cn){var Mn=arguments;return 1===Mt.length&&1!==arguments.length&&(Mn=[Ai({},{type:Dt},Cn)]),Mt.apply(at,Mn)},k.map=at,k.events=function(Dt){var Cn=Object.keys(Dt.options.modes).reduce(function(bn,$n){return bn[$n]=function pr(k){var G=Object.keys(k);return function(we,st){void 0===st&&(st={});var at={},Mt=G.reduce(function(Dt,Cn){return Dt[Cn]=k[Cn],Dt},new Sn(we));return{start:function(){var Dt=this;at=Mt.onSetup(st),Kn.forEach(function(Cn){var Mn,Zn=Yn[Cn],Qn=function(){return!1};k[Zn]&&(Qn=function(){return!0}),Dt.on(Cn,Qn,(Mn=Zn,function(jn){return Mt[Mn](at,jn)}))})},stop:function(){Mt.onStop(at)},trash:function(){Mt.onTrash(at)},combineFeatures:function(){Mt.onCombineFeatures(at)},uncombineFeatures:function(){Mt.onUncombineFeatures(at)},render:function(Dt,Cn){Mt.toDisplayFeatures(at,Dt,Cn)}}}}(Dt.options.modes[$n]),bn},{}),Mn={},Zn={},Qn={},jn=null,cn=null;Qn.drag=function(bn,$n){$n({point:bn.point,time:(new Date).getTime()})?(Dt.ui.queueMapClasses({mouse:Fe.DRAG}),cn.drag(bn)):bn.originalEvent.stopPropagation()},Qn.mousedrag=function(bn){Qn.drag(bn,function($n){return!Bt(Mn,$n)})},Qn.touchdrag=function(bn){Qn.drag(bn,function($n){return!$e(Zn,$n)})},Qn.mousemove=function(bn){if(1===(void 0!==bn.originalEvent.buttons?bn.originalEvent.buttons:bn.originalEvent.which))return Qn.mousedrag(bn);var $n=Se(bn,Dt);bn.featureTarget=$n,cn.mousemove(bn)},Qn.mousedown=function(bn){Mn={time:(new Date).getTime(),point:bn.point};var $n=Se(bn,Dt);bn.featureTarget=$n,cn.mousedown(bn)},Qn.mouseup=function(bn){var $n=Se(bn,Dt);bn.featureTarget=$n,Bt(Mn,{point:bn.point,time:(new Date).getTime()})?cn.click(bn):cn.mouseup(bn)},Qn.mouseout=function(bn){cn.mouseout(bn)},Qn.touchstart=function(bn){if(bn.originalEvent.preventDefault(),Dt.options.touchEnabled){Zn={time:(new Date).getTime(),point:bn.point};var $n=je.touch(bn,null,Dt)[0];bn.featureTarget=$n,cn.touchstart(bn)}},Qn.touchmove=function(bn){if(bn.originalEvent.preventDefault(),Dt.options.touchEnabled)return cn.touchmove(bn),Qn.touchdrag(bn)},Qn.touchend=function(bn){if(bn.originalEvent.preventDefault(),Dt.options.touchEnabled){var $n=je.touch(bn,null,Dt)[0];bn.featureTarget=$n,$e(Zn,{time:(new Date).getTime(),point:bn.point})?cn.tap(bn):cn.touchend(bn)}};var as=function(bn){return!(8===bn||46===bn||bn>=48&&bn<=57)};function jr(bn,$n,sr){void 0===sr&&(sr={}),cn.stop();var Jr=Cn[bn];if(void 0===Jr)throw new Error(bn+" is not valid");jn=bn;var Gr=Jr(Dt,$n);cn=rt(Gr,Dt),sr.silent||Dt.map.fire(dt.MODE_CHANGE,{mode:bn}),Dt.store.setDirty(),Dt.store.render()}Qn.keydown=function(bn){"mapboxgl-canvas"===(bn.srcElement||bn.target).classList[0]&&(8!==bn.keyCode&&46!==bn.keyCode||!Dt.options.controls.trash?as(bn.keyCode)?cn.keydown(bn):49===bn.keyCode&&Dt.options.controls.point?jr(He.DRAW_POINT):50===bn.keyCode&&Dt.options.controls.line_string?jr(He.DRAW_LINE_STRING):51===bn.keyCode&&Dt.options.controls.polygon&&jr(He.DRAW_POLYGON):(bn.preventDefault(),cn.trash()))},Qn.keyup=function(bn){as(bn.keyCode)&&cn.keyup(bn)},Qn.zoomend=function(){Dt.store.changeZoom()},Qn.data=function(bn){if("style"===bn.dataType){var $n=Dt.setup,sr=Dt.map,Gr=Dt.store;Dt.options.styles.some(function(vi){return sr.getLayer(vi.id)})||($n.addLayers(),Gr.setDirty(),Gr.render())}};var lo={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){cn=rt(Cn[jn=Dt.options.defaultMode](Dt),Dt)},changeMode:jr,actionable:function(bn){var $n=!1;Object.keys(bn).forEach(function(sr){if(void 0===lo[sr])throw new Error("Invalid action type");lo[sr]!==bn[sr]&&($n=!0),lo[sr]=bn[sr]}),$n&&Dt.map.fire(dt.ACTIONABLE,{actions:lo})},currentModeName:function(){return jn},currentModeRender:function(bn,$n){return cn.render(bn,$n)},fire:function(bn,$n){Qn[bn]&&Qn[bn]($n)},addEventListeners:function(){Dt.map.on("mousemove",Qn.mousemove),Dt.map.on("mousedown",Qn.mousedown),Dt.map.on("mouseup",Qn.mouseup),Dt.map.on("data",Qn.data),Dt.map.on("touchmove",Qn.touchmove),Dt.map.on("touchstart",Qn.touchstart),Dt.map.on("touchend",Qn.touchend),Dt.container.addEventListener("mouseout",Qn.mouseout),Dt.options.keybindings&&(Dt.container.addEventListener("keydown",Qn.keydown),Dt.container.addEventListener("keyup",Qn.keyup))},removeEventListeners:function(){Dt.map.off("mousemove",Qn.mousemove),Dt.map.off("mousedown",Qn.mousedown),Dt.map.off("mouseup",Qn.mouseup),Dt.map.off("data",Qn.data),Dt.map.off("touchmove",Qn.touchmove),Dt.map.off("touchstart",Qn.touchstart),Dt.map.off("touchend",Qn.touchend),Dt.container.removeEventListener("mouseout",Qn.mouseout),Dt.options.keybindings&&(Dt.container.removeEventListener("keydown",Qn.keydown),Dt.container.removeEventListener("keyup",Qn.keyup))},trash:function(bn){cn.trash(bn)},combineFeatures:function(){cn.combineFeatures()},uncombineFeatures:function(){cn.uncombineFeatures()},getMode:function(){return jn}}}(k),k.ui=function(Dt){var Cn={},Mn=null,Zn={mode:null,feature:null,mouse:null},Qn={mode:null,feature:null,mouse:null};function jn(bn){Qn=Ai(Qn,bn)}function cn(){var bn,$n;if(Dt.container){var sr=[],Jr=[];zr.forEach(function(Gr){Qn[Gr]!==Zn[Gr]&&(sr.push(Gr+"-"+Zn[Gr]),null!==Qn[Gr]&&Jr.push(Gr+"-"+Qn[Gr]))}),sr.length>0&&(bn=Dt.container.classList).remove.apply(bn,sr),Jr.length>0&&($n=Dt.container.classList).add.apply($n,Jr),Zn=Ai(Zn,Qn)}}function as(bn,$n){void 0===$n&&($n={});var sr=document.createElement("button");return sr.className=Te.CONTROL_BUTTON+" "+$n.className,sr.setAttribute("title",$n.title),$n.container.appendChild(sr),sr.addEventListener("click",function(Jr){if(Jr.preventDefault(),Jr.stopPropagation(),Jr.target===Mn)return jr(),void $n.onDeactivate();lo(bn),$n.onActivate()},!0),sr}function jr(){Mn&&(Mn.classList.remove(Te.ACTIVE_BUTTON),Mn=null)}function lo(bn){jr();var $n=Cn[bn];$n&&$n&&"trash"!==bn&&($n.classList.add(Te.ACTIVE_BUTTON),Mn=$n)}return{setActiveButton:lo,queueMapClasses:jn,updateMapClasses:cn,clearMapClasses:function(){jn({mode:null,feature:null,mouse:null}),cn()},addButtons:function(){var bn=Dt.options.controls,$n=document.createElement("div");return $n.className=Te.CONTROL_GROUP+" "+Te.CONTROL_BASE,bn&&(bn[bt.LINE]&&(Cn[bt.LINE]=as(bt.LINE,{container:$n,className:Te.CONTROL_BUTTON_LINE,title:"LineString tool "+(Dt.options.keybindings?"(l)":""),onActivate:function(){return Dt.events.changeMode(He.DRAW_LINE_STRING)},onDeactivate:function(){return Dt.events.trash()}})),bn[bt.POLYGON]&&(Cn[bt.POLYGON]=as(bt.POLYGON,{container:$n,className:Te.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Dt.options.keybindings?"(p)":""),onActivate:function(){return Dt.events.changeMode(He.DRAW_POLYGON)},onDeactivate:function(){return Dt.events.trash()}})),bn[bt.POINT]&&(Cn[bt.POINT]=as(bt.POINT,{container:$n,className:Te.CONTROL_BUTTON_POINT,title:"Marker tool "+(Dt.options.keybindings?"(m)":""),onActivate:function(){return Dt.events.changeMode(He.DRAW_POINT)},onDeactivate:function(){return Dt.events.trash()}})),bn.trash&&(Cn.trash=as("trash",{container:$n,className:Te.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Dt.events.trash()}})),bn.combine_features&&(Cn.combine_features=as("combineFeatures",{container:$n,className:Te.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Dt.events.combineFeatures()}})),bn.uncombine_features&&(Cn.uncombine_features=as("uncombineFeatures",{container:$n,className:Te.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Dt.events.uncombineFeatures()}}))),$n},removeButtons:function(){Object.keys(Cn).forEach(function(bn){var $n=Cn[bn];$n.parentNode&&$n.parentNode.removeChild($n),delete Cn[bn]})}}}(k),k.container=at.getContainer(),k.store=new Jn(k),G=k.ui.addButtons(),k.options.boxSelect&&(at.boxZoom.disable(),at.dragPan.disable(),at.dragPan.enable()),at.loaded()?st.connect():(at.on("load",st.connect),we=setInterval(function(){at.loaded()&&st.connect()},16)),k.events.start(),G},addLayers:function(){k.map.addSource(Pe.COLD,{data:{type:nt.FEATURE_COLLECTION,features:[]},type:"geojson"}),k.map.addSource(Pe.HOT,{data:{type:nt.FEATURE_COLLECTION,features:[]},type:"geojson"}),k.options.styles.forEach(function(at){k.map.addLayer(at)}),k.store.setDirty(!0),k.store.render()},removeLayers:function(){k.options.styles.forEach(function(at){k.map.getLayer(at.id)&&k.map.removeLayer(at.id)}),k.map.getSource(Pe.COLD)&&k.map.removeSource(Pe.COLD),k.map.getSource(Pe.HOT)&&k.map.removeSource(Pe.HOT)}};return k.setup=st,st}var Le=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function De(k){return function(G){var we=G.featureTarget;return!!we&&!!we.properties&&we.properties.meta===k}}function Me(k){return!!k.originalEvent&&!!k.originalEvent.shiftKey&&0===k.originalEvent.button}function Ke(k){return!!k.featureTarget&&!!k.featureTarget.properties&&k.featureTarget.properties.active===X.ACTIVE&&k.featureTarget.properties.meta===ae.FEATURE}function St(k){return!!k.featureTarget&&!!k.featureTarget.properties&&k.featureTarget.properties.active===X.INACTIVE&&k.featureTarget.properties.meta===ae.FEATURE}function Jt(k){return void 0===k.featureTarget}function En(k){return!!k.featureTarget&&!!k.featureTarget.properties&&k.featureTarget.properties.meta===ae.FEATURE}function vn(k){var G=k.featureTarget;return!!G&&!!G.properties&&G.properties.meta===ae.VERTEX}function un(k){return!!k.originalEvent&&!0===k.originalEvent.shiftKey}function kr(k){return 27===k.keyCode}function Xr(k){return 13===k.keyCode}var kn=Object.freeze({__proto__:null,isOfMetaType:De,isShiftMousedown:Me,isActiveFeature:Ke,isInactiveFeature:St,noTarget:Jt,isFeature:En,isVertex:vn,isShiftDown:un,isEscapeKey:kr,isEnterKey:Xr,isTrue:function(){return!0}}),ri=Hi;function Hi(k,G){this.x=k,this.y=G}function li(k,G){var we=G.getBoundingClientRect();return new ri(k.clientX-we.left-(G.clientLeft||0),k.clientY-we.top-(G.clientTop||0))}function gi(k,G,we,st){return{type:nt.FEATURE,properties:{meta:ae.VERTEX,parent:k,coord_path:we,active:st?X.ACTIVE:X.INACTIVE},geometry:{type:nt.POINT,coordinates:G}}}function oo(k,G,we){var st=G.geometry.coordinates,at=we.geometry.coordinates;if(st[1]>85||st[1]<-85||at[1]>85||at[1]<-85)return null;var Mt={lng:(st[0]+at[0])/2,lat:(st[1]+at[1])/2};return{type:nt.FEATURE,properties:{meta:ae.MIDPOINT,parent:k,lng:Mt.lng,lat:Mt.lat,coord_path:we.properties.coord_path},geometry:{type:nt.POINT,coordinates:[Mt.lng,Mt.lat]}}}function xo(k,G,we){void 0===G&&(G={}),void 0===we&&(we=null);var st,at=k.geometry,Mt=at.type,Dt=at.coordinates,Cn=k.properties&&k.properties.id,Mn=[];function Zn(jn,cn){var as="",jr=null;jn.forEach(function(lo,bn){var $n=null!=cn?cn+"."+bn:String(bn),sr=gi(Cn,lo,$n,Qn($n));if(G.midpoints&&jr){var Jr=oo(Cn,jr,sr);Jr&&Mn.push(Jr)}jr=sr;var Gr=JSON.stringify(lo);as!==Gr&&Mn.push(sr),0===bn&&(as=Gr)})}function Qn(jn){return!!G.selectedPaths&&-1!==G.selectedPaths.indexOf(jn)}return Mt===nt.POINT?Mn.push(gi(Cn,Dt,we,Qn(we))):Mt===nt.POLYGON?Dt.forEach(function(jn,cn){Zn(jn,null!==we?we+"."+cn:String(cn))}):Mt===nt.LINE_STRING?Zn(Dt,we):0===Mt.indexOf(nt.MULTI_PREFIX)&&(st=Mt.replace(nt.MULTI_PREFIX,""),Dt.forEach(function(jn,cn){Mn=Mn.concat(xo({type:nt.FEATURE,properties:k.properties,geometry:{type:st,coordinates:jn}},G,cn))})),Mn}Hi.prototype={clone:function(){return new Hi(this.x,this.y)},add:function(k){return this.clone()._add(k)},sub:function(k){return this.clone()._sub(k)},multByPoint:function(k){return this.clone()._multByPoint(k)},divByPoint:function(k){return this.clone()._divByPoint(k)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(k){return this.clone()._rotate(k)},rotateAround:function(k,G){return this.clone()._rotateAround(k,G)},matMult:function(k){return this.clone()._matMult(k)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(k){return this.x===k.x&&this.y===k.y},dist:function(k){return Math.sqrt(this.distSqr(k))},distSqr:function(k){var G=k.x-this.x,we=k.y-this.y;return G*G+we*we},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(k){return Math.atan2(this.y-k.y,this.x-k.x)},angleWith:function(k){return this.angleWithSep(k.x,k.y)},angleWithSep:function(k,G){return Math.atan2(this.x*G-this.y*k,this.x*k+this.y*G)},_matMult:function(k){var we=k[2]*this.x+k[3]*this.y;return this.x=k[0]*this.x+k[1]*this.y,this.y=we,this},_add:function(k){return this.x+=k.x,this.y+=k.y,this},_sub:function(k){return this.x-=k.x,this.y-=k.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_multByPoint:function(k){return this.x*=k.x,this.y*=k.y,this},_divByPoint:function(k){return this.x/=k.x,this.y/=k.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var k=this.y;return this.y=this.x,this.x=-k,this},_rotate:function(k){var G=Math.cos(k),we=Math.sin(k),at=we*this.x+G*this.y;return this.x=G*this.x-we*this.y,this.y=at,this},_rotateAround:function(k,G){var we=Math.cos(k),st=Math.sin(k),Mt=G.y+st*(this.x-G.x)+we*(this.y-G.y);return this.x=G.x+we*(this.x-G.x)-st*(this.y-G.y),this.y=Mt,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Hi.convert=function(k){return k instanceof Hi?k:Array.isArray(k)?new Hi(k[0],k[1]):k};var eo={enable:function(k){setTimeout(function(){k.map&&k.map.doubleClickZoom&&k._ctx&&k._ctx.store&&k._ctx.store.getInitialConfigValue&&k._ctx.store.getInitialConfigValue("doubleClickZoom")&&k.map.doubleClickZoom.enable()},0)},disable:function(k){setTimeout(function(){k.map&&k.map.doubleClickZoom&&k.map.doubleClickZoom.disable()},0)}},wo={},Bs={get exports(){return wo},set exports(k){wo=k}},Li=function(k){if(!k||!k.type)return null;var G=ra[k.type];return G?"geometry"===G?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:k}]}:"feature"===G?{type:"FeatureCollection",features:[k]}:"featurecollection"===G?k:void 0:null},ra={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ls=Object.freeze({__proto__:null,default:function k(G){switch(G&&G.type||null){case"FeatureCollection":return G.features=G.features.reduce(function(we,st){return we.concat(k(st))},[]),G;case"Feature":return G.geometry?k(G.geometry).map(function(we){var st={type:"Feature",properties:JSON.parse(JSON.stringify(G.properties)),geometry:we};return void 0!==G.id&&(st.id=G.id),st}):[G];case"MultiPoint":return G.coordinates.map(function(we){return{type:"Point",coordinates:we}});case"MultiPolygon":return G.coordinates.map(function(we){return{type:"Polygon",coordinates:we}});case"MultiLineString":return G.coordinates.map(function(we){return{type:"LineString",coordinates:we}});case"GeometryCollection":return G.geometries.map(k).reduce(function(we,st){return we.concat(st)},[]);case"Point":case"Polygon":case"LineString":return[G]}}}),Tn=Li,il=function xe(k){if(k.__esModule)return k;var G=k.default;if("function"==typeof G){var we=function st(){if(this instanceof st){var at=[null];return at.push.apply(at,arguments),new(Function.bind.apply(G,at))}return G.apply(this,arguments)};we.prototype=G.prototype}else we={};return Object.defineProperty(we,"__esModule",{value:!0}),Object.keys(k).forEach(function(st){var at=Object.getOwnPropertyDescriptor(k,st);Object.defineProperty(we,st,at.get?at:{enumerable:!0,get:function(){return k[st]}})}),we}(Ls);il instanceof Function||(il=il.default);var Fr={},Ua={get exports(){return Fr},set exports(k){Fr=k}}.exports=function(k){return new Is(k)};function Is(k){this.value=k}function Va(k,G,we){var st=[],at=[],Mt=!0;return function Dt(Cn){var Mn=we?Ze(Cn):Cn,Zn={},Qn=!0,jn={node:Mn,node_:Cn,path:[].concat(st),parent:at[at.length-1],parents:at,key:st.slice(-1)[0],isRoot:0===st.length,level:st.length,circular:null,update:function(jr,lo){jn.isRoot||(jn.parent.node[jn.key]=jr),jn.node=jr,lo&&(Qn=!1)},delete:function(jr){delete jn.parent.node[jn.key],jr&&(Qn=!1)},remove:function(jr){ze(jn.parent.node)?jn.parent.node.splice(jn.key,1):delete jn.parent.node[jn.key],jr&&(Qn=!1)},keys:null,before:function(jr){Zn.before=jr},after:function(jr){Zn.after=jr},pre:function(jr){Zn.pre=jr},post:function(jr){Zn.post=jr},stop:function(){Mt=!1},block:function(){Qn=!1}};if(!Mt)return jn;function cn(){if("object"==typeof jn.node&&null!==jn.node){jn.keys&&jn.node_===jn.node||(jn.keys=ce(jn.node)),jn.isLeaf=0==jn.keys.length;for(var jr=0;jr<at.length;jr++)if(at[jr].node_===Cn){jn.circular=at[jr];break}}else jn.isLeaf=!0,jn.keys=null;jn.notLeaf=!jn.isLeaf,jn.notRoot=!jn.isRoot}cn();var as=G.call(jn,jn.node);return void 0!==as&&jn.update&&jn.update(as),Zn.before&&Zn.before.call(jn,jn.node),Qn&&("object"!=typeof jn.node||null===jn.node||jn.circular||(at.push(jn),cn(),et(jn.keys,function(jr,lo){st.push(jr),Zn.pre&&Zn.pre.call(jn,jn.node[jr],jr);var bn=Dt(jn.node[jr]);we&&yt.call(jn.node,jr)&&(jn.node[jr]=bn.node),bn.isLast=lo==jn.keys.length-1,bn.isFirst=0==lo,Zn.post&&Zn.post.call(jn,bn),st.pop()}),at.pop()),Zn.after&&Zn.after.call(jn,jn.node)),jn}(k).node}function Ze(k){if("object"==typeof k&&null!==k){var G;if(ze(k))G=[];else if("[object Date]"===be(k))G=new Date(k.getTime?k.getTime():k);else if("[object RegExp]"===be(k))G=new RegExp(k);else if("[object Error]"===be(k))G={message:k.message};else if(function(at){return"[object Boolean]"===be(at)}(k))G=new Boolean(k);else if(function(at){return"[object Number]"===be(at)}(k))G=new Number(k);else if(function(at){return"[object String]"===be(at)}(k))G=new String(k);else if(Object.create&&Object.getPrototypeOf)G=Object.create(Object.getPrototypeOf(k));else if(k.constructor===Object)G={};else{var st=function(){};st.prototype=k.constructor&&k.constructor.prototype||k.__proto__||{},G=new st}return et(ce(k),function(at){G[at]=k[at]}),G}return k}Is.prototype.get=function(k){for(var G=this.value,we=0;we<k.length;we++){var st=k[we];if(!G||!yt.call(G,st)){G=void 0;break}G=G[st]}return G},Is.prototype.has=function(k){for(var G=this.value,we=0;we<k.length;we++){var st=k[we];if(!G||!yt.call(G,st))return!1;G=G[st]}return!0},Is.prototype.set=function(k,G){for(var we=this.value,st=0;st<k.length-1;st++){var at=k[st];yt.call(we,at)||(we[at]={}),we=we[at]}return we[k[st]]=G,G},Is.prototype.map=function(k){return Va(this.value,k,!0)},Is.prototype.forEach=function(k){return this.value=Va(this.value,k,!1),this.value},Is.prototype.reduce=function(k,G){var we=1===arguments.length,st=we?this.value:G;return this.forEach(function(at){this.isRoot&&we||(st=k.call(this,st,at))}),st},Is.prototype.paths=function(){var k=[];return this.forEach(function(G){k.push(this.path)}),k},Is.prototype.nodes=function(){var k=[];return this.forEach(function(G){k.push(this.node)}),k},Is.prototype.clone=function(){var k=[],G=[];return function we(st){for(var at=0;at<k.length;at++)if(k[at]===st)return G[at];if("object"==typeof st&&null!==st){var Mt=Ze(st);return k.push(st),G.push(Mt),et(ce(st),function(Dt){Mt[Dt]=we(st[Dt])}),k.pop(),G.pop(),Mt}return st}(this.value)};var ce=Object.keys||function(k){var G=[];for(var we in k)G.push(we);return G};function be(k){return Object.prototype.toString.call(k)}var ze=Array.isArray||function(k){return"[object Array]"===Object.prototype.toString.call(k)},et=function(k,G){if(k.forEach)return k.forEach(G);for(var we=0;we<k.length;we++)G(k[we],we,k)};et(ce(Is.prototype),function(k){Ua[k]=function(G){var we=[].slice.call(arguments,1),st=new Is(G);return st[k].apply(st,we)}});var yt=Object.hasOwnProperty||function(k,G){return G in k},Ut=Pt;function Pt(k){if(!(this instanceof Pt))return new Pt(k);this._bbox=k||[1/0,1/0,-1/0,-1/0],this._valid=!!k}Pt.prototype.include=function(k){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],k[0]),this._bbox[1]=Math.min(this._bbox[1],k[1]),this._bbox[2]=Math.max(this._bbox[2],k[0]),this._bbox[3]=Math.max(this._bbox[3],k[1]),this},Pt.prototype.equals=function(k){var G;return G=k instanceof Pt?k.bbox():k,this._bbox[0]==G[0]&&this._bbox[1]==G[1]&&this._bbox[2]==G[2]&&this._bbox[3]==G[3]},Pt.prototype.center=function(k){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Pt.prototype.union=function(k){var G;return this._valid=!0,G=k instanceof Pt?k.bbox():k,this._bbox[0]=Math.min(this._bbox[0],G[0]),this._bbox[1]=Math.min(this._bbox[1],G[1]),this._bbox[2]=Math.max(this._bbox[2],G[2]),this._bbox[3]=Math.max(this._bbox[3],G[3]),this},Pt.prototype.bbox=function(){return this._valid?this._bbox:null},Pt.prototype.contains=function(k){if(!k)return this._fastContains();if(!this._valid)return null;var G=k[0],we=k[1];return this._bbox[0]<=G&&this._bbox[1]<=we&&this._bbox[2]>=G&&this._bbox[3]>=we},Pt.prototype.intersect=function(k){return this._valid?(G=k instanceof Pt?k.bbox():k,!(this._bbox[0]>G[2]||this._bbox[2]<G[0]||this._bbox[3]<G[1]||this._bbox[1]>G[3])):null;var G},Pt.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},Pt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var ht=function(k){if(!k)return[];var G=il(Tn(k)),we=[];return G.features.forEach(function(st){st.geometry&&(we=we.concat(function(k){return function G(we){return Array.isArray(we)&&we.length&&"number"==typeof we[0]?[we]:we.reduce(function(st,at){return Array.isArray(at)&&Array.isArray(at[0])?st.concat(G(at)):(st.push(at),st)},[])}(k)}(st.geometry.coordinates)))}),we},zt=Fr,dn=Ut,Fn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},mn=Object.keys(Fn);function yr(k){for(var G=dn(),we=ht(k),st=0;st<we.length;st++)G.include(we[st]);return G}Bs.exports=function(k){return yr(k).bbox()},wo.polygon=function(k){return yr(k).polygon()},wo.bboxify=function(k){return zt(k).map(function(G){G&&mn.some(function(we){return!!G[we]&&-1!==Fn[we].indexOf(G.type)})&&(G.bbox=yr(G).bbox(),this.update(G))})};function xr(k,G){var we=-90,st=90,at=-90,Mt=90,Dt=270,Cn=-270;k.forEach(function(Zn){var Qn=wo(Zn),jn=Qn[1],cn=Qn[3],as=Qn[0],jr=Qn[2];jn>we&&(we=jn),cn<st&&(st=cn),cn>at&&(at=cn),jn<Mt&&(Mt=jn),as<Dt&&(Dt=as),jr>Cn&&(Cn=jr)});var Mn=G;return we+Mn.lat>85&&(Mn.lat=85-we),at+Mn.lat>90&&(Mn.lat=90-at),st+Mn.lat<-85&&(Mn.lat=-85-st),Mt+Mn.lat<-90&&(Mn.lat=-90-Mt),Dt+Mn.lng<=-270&&(Mn.lng+=360*Math.ceil(Math.abs(Mn.lng)/360)),Cn+Mn.lng>=270&&(Mn.lng-=360*Math.ceil(Math.abs(Mn.lng)/360)),Mn}function _r(k,G){var we=xr(k.map(function(st){return st.toGeoJSON()}),G);k.forEach(function(st){var at,Mt=st.getCoordinates(),Dt=function(Mn){var Zn={lng:Mn[0]+we.lng,lat:Mn[1]+we.lat};return[Zn.lng,Zn.lat]},Cn=function(Mn){return Mn.map(function(Zn){return Dt(Zn)})};st.type===nt.POINT?at=Dt(Mt):st.type===nt.LINE_STRING||st.type===nt.MULTI_POINT?at=Mt.map(Dt):st.type===nt.POLYGON||st.type===nt.MULTI_LINE_STRING?at=Mt.map(Cn):st.type===nt.MULTI_POLYGON&&(at=Mt.map(function(Mn){return Mn.map(function(Zn){return Cn(Zn)})})),st.incomingCoords(at)})}var Dr={onSetup:function(k){var G=this,we={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:k.featureIds||[]};return this.setSelected(we.initiallySelectedFeatureIds.filter(function(st){return void 0!==G.getFeature(st)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),we},fireUpdate:function(){this.map.fire(dt.UPDATE,{action:Rt.MOVE,features:this.getSelected().map(function(k){return k.toGeoJSON()})})},fireActionable:function(){var k=this,G=this.getSelected(),we=G.filter(function(Cn){return k.isInstanceOf("MultiFeature",Cn)}),st=!1;if(G.length>1){st=!0;var at=G[0].type.replace("Multi","");G.forEach(function(Cn){Cn.type.replace("Multi","")!==at&&(st=!1)})}this.setActionableState({combineFeatures:st,uncombineFeatures:we.length>0,trash:G.length>0})},getUniqueIds:function(k){return k.length?k.map(function(G){return G.properties.id}).filter(function(G){return void 0!==G}).reduce(function(G,we){return G.add(we),G},new ne).values():[]},stopExtendedInteractions:function(k){k.boxSelectElement&&(k.boxSelectElement.parentNode&&k.boxSelectElement.parentNode.removeChild(k.boxSelectElement),k.boxSelectElement=null),this.map.dragPan.enable(),k.boxSelecting=!1,k.canBoxSelect=!1,k.dragMoving=!1,k.canDragMove=!1},onStop:function(){eo.enable(this)},onMouseMove:function(k){return this.stopExtendedInteractions(k),!0},onMouseOut:function(k){return!k.dragMoving||this.fireUpdate()}};Dr.onTap=Dr.onClick=function(k,G){return Jt(G)?this.clickAnywhere(k,G):De(ae.VERTEX)(G)?this.clickOnVertex(k,G):En(G)?this.clickOnFeature(k,G):void 0},Dr.clickAnywhere=function(k){var G=this,we=this.getSelectedIds();we.length&&(this.clearSelectedFeatures(),we.forEach(function(st){return G.doRender(st)})),eo.enable(this),this.stopExtendedInteractions(k)},Dr.clickOnVertex=function(k,G){this.changeMode(He.DIRECT_SELECT,{featureId:G.featureTarget.properties.parent,coordPath:G.featureTarget.properties.coord_path,startPos:G.lngLat}),this.updateUIClasses({mouse:Fe.MOVE})},Dr.startOnActiveFeature=function(k,G){this.stopExtendedInteractions(k),this.map.dragPan.disable(),this.doRender(G.featureTarget.properties.id),k.canDragMove=!0,k.dragMoveLocation=G.lngLat},Dr.clickOnFeature=function(k,G){var we=this;eo.disable(this),this.stopExtendedInteractions(k);var st=un(G),at=this.getSelectedIds(),Mt=G.featureTarget.properties.id,Dt=this.isSelected(Mt);if(!st&&Dt&&this.getFeature(Mt).type!==nt.POINT)return this.changeMode(He.DIRECT_SELECT,{featureId:Mt});Dt&&st?(this.deselect(Mt),this.updateUIClasses({mouse:Fe.POINTER}),1===at.length&&eo.enable(this)):!Dt&&st?(this.select(Mt),this.updateUIClasses({mouse:Fe.MOVE})):Dt||st||(at.forEach(function(Cn){return we.doRender(Cn)}),this.setSelected(Mt),this.updateUIClasses({mouse:Fe.MOVE})),this.doRender(Mt)},Dr.onMouseDown=function(k,G){return Ke(G)?this.startOnActiveFeature(k,G):this.drawConfig.boxSelect&&Me(G)?this.startBoxSelect(k,G):void 0},Dr.startBoxSelect=function(k,G){this.stopExtendedInteractions(k),this.map.dragPan.disable(),k.boxSelectStartLocation=li(G.originalEvent,this.map.getContainer()),k.canBoxSelect=!0},Dr.onTouchStart=function(k,G){if(Ke(G))return this.startOnActiveFeature(k,G)},Dr.onDrag=function(k,G){return k.canDragMove?this.dragMove(k,G):this.drawConfig.boxSelect&&k.canBoxSelect?this.whileBoxSelect(k,G):void 0},Dr.whileBoxSelect=function(k,G){k.boxSelecting=!0,this.updateUIClasses({mouse:Fe.ADD}),k.boxSelectElement||(k.boxSelectElement=document.createElement("div"),k.boxSelectElement.classList.add(Te.BOX_SELECT),this.map.getContainer().appendChild(k.boxSelectElement));var we=li(G.originalEvent,this.map.getContainer()),st=Math.min(k.boxSelectStartLocation.x,we.x),at=Math.max(k.boxSelectStartLocation.x,we.x),Mt=Math.min(k.boxSelectStartLocation.y,we.y),Dt=Math.max(k.boxSelectStartLocation.y,we.y),Cn="translate("+st+"px, "+Mt+"px)";k.boxSelectElement.style.transform=Cn,k.boxSelectElement.style.WebkitTransform=Cn,k.boxSelectElement.style.width=at-st+"px",k.boxSelectElement.style.height=Dt-Mt+"px"},Dr.dragMove=function(k,G){k.dragMoving=!0,G.originalEvent.stopPropagation();var we={lng:G.lngLat.lng-k.dragMoveLocation.lng,lat:G.lngLat.lat-k.dragMoveLocation.lat};_r(this.getSelected(),we),k.dragMoveLocation=G.lngLat},Dr.onTouchEnd=Dr.onMouseUp=function(k,G){var we=this;if(k.dragMoving)this.fireUpdate();else if(k.boxSelecting){var st=[k.boxSelectStartLocation,li(G.originalEvent,this.map.getContainer())],at=this.featuresAt(null,st,"click"),Mt=this.getUniqueIds(at).filter(function(Dt){return!we.isSelected(Dt)});Mt.length&&(this.select(Mt),Mt.forEach(function(Dt){return we.doRender(Dt)}),this.updateUIClasses({mouse:Fe.MOVE}))}this.stopExtendedInteractions(k)},Dr.toDisplayFeatures=function(k,G,we){G.properties.active=this.isSelected(G.properties.id)?X.ACTIVE:X.INACTIVE,we(G),this.fireActionable(),G.properties.active===X.ACTIVE&&G.geometry.type!==nt.POINT&&xo(G).forEach(we)},Dr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Dr.onCombineFeatures=function(){var k=this.getSelected();if(!(0===k.length||k.length<2)){for(var G=[],we=[],st=k[0].type.replace("Multi",""),at=0;at<k.length;at++){var Mt=k[at];if(Mt.type.replace("Multi","")!==st)return;Mt.type.includes("Multi")?Mt.getCoordinates().forEach(function(Cn){G.push(Cn)}):G.push(Mt.getCoordinates()),we.push(Mt.toGeoJSON())}if(we.length>1){var Dt=this.newFeature({type:nt.FEATURE,properties:we[0].properties,geometry:{type:"Multi"+st,coordinates:G}});this.addFeature(Dt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Dt.id]),this.map.fire(dt.COMBINE_FEATURES,{createdFeatures:[Dt.toGeoJSON()],deletedFeatures:we})}this.fireActionable()}},Dr.onUncombineFeatures=function(){var k=this,G=this.getSelected();if(0!==G.length){for(var we=[],st=[],at=function(Dt){var Cn=G[Dt];k.isInstanceOf("MultiFeature",Cn)&&(Cn.getFeatures().forEach(function(Mn){k.addFeature(Mn),Mn.properties=Cn.properties,we.push(Mn.toGeoJSON()),k.select([Mn.id])}),k.deleteFeature(Cn.id,{silent:!0}),st.push(Cn.toGeoJSON()))},Mt=0;Mt<G.length;Mt++)at(Mt);we.length>1&&this.map.fire(dt.UNCOMBINE_FEATURES,{createdFeatures:we,deletedFeatures:st}),this.fireActionable()}};var Vr=De(ae.VERTEX),nr=De(ae.MIDPOINT),Pi={fireUpdate:function(){this.map.fire(dt.UPDATE,{action:Rt.CHANGE_COORDINATES,features:this.getSelected().map(function(k){return k.toGeoJSON()})})},fireActionable:function(k){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:k.selectedCoordPaths.length>0})},startDragging:function(k,G){this.map.dragPan.disable(),k.canDragMove=!0,k.dragMoveLocation=G.lngLat},stopDragging:function(k){this.map.dragPan.enable(),k.dragMoving=!1,k.canDragMove=!1,k.dragMoveLocation=null},onVertex:function(k,G){this.startDragging(k,G);var we=G.featureTarget.properties,st=k.selectedCoordPaths.indexOf(we.coord_path);un(G)||-1!==st?un(G)&&-1===st&&k.selectedCoordPaths.push(we.coord_path):k.selectedCoordPaths=[we.coord_path];var at=this.pathsToCoordinates(k.featureId,k.selectedCoordPaths);this.setSelectedCoordinates(at)},onMidpoint:function(k,G){this.startDragging(k,G);var we=G.featureTarget.properties;k.feature.addCoordinate(we.coord_path,we.lng,we.lat),this.fireUpdate(),k.selectedCoordPaths=[we.coord_path]},pathsToCoordinates:function(k,G){return G.map(function(we){return{feature_id:k,coord_path:we}})},onFeature:function(k,G){0===k.selectedCoordPaths.length?this.startDragging(k,G):this.stopDragging(k)},dragFeature:function(k,G,we){_r(this.getSelected(),we),k.dragMoveLocation=G.lngLat},dragVertex:function(k,G,we){for(var st=k.selectedCoordPaths.map(function(Cn){return k.feature.getCoordinate(Cn)}),at=xr(st.map(function(Cn){return{type:nt.FEATURE,properties:{},geometry:{type:nt.POINT,coordinates:Cn}}}),we),Mt=0;Mt<st.length;Mt++){var Dt=st[Mt];k.feature.updateCoordinate(k.selectedCoordPaths[Mt],Dt[0]+at.lng,Dt[1]+at.lat)}},clickNoTarget:function(){this.changeMode(He.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(He.SIMPLE_SELECT)},clickActiveFeature:function(k){k.selectedCoordPaths=[],this.clearSelectedCoordinates(),k.feature.changed()},onSetup:function(k){var G=k.featureId,we=this.getFeature(G);if(!we)throw new Error("You must provide a featureId to enter direct_select mode");if(we.type===nt.POINT)throw new TypeError("direct_select mode doesn't handle point features");var st={featureId:G,feature:we,dragMoveLocation:k.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:k.coordPath?[k.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(G,st.selectedCoordPaths)),this.setSelected(G),eo.disable(this),this.setActionableState({trash:!0}),st},onStop:function(){eo.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(k,G,we){k.featureId===G.properties.id?(G.properties.active=X.ACTIVE,we(G),xo(G,{map:this.map,midpoints:!0,selectedPaths:k.selectedCoordPaths}).forEach(we)):(G.properties.active=X.INACTIVE,we(G)),this.fireActionable(k)},onTrash:function(k){k.selectedCoordPaths.sort(function(G,we){return we.localeCompare(G,"en",{numeric:!0})}).forEach(function(G){return k.feature.removeCoordinate(G)}),this.fireUpdate(),k.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(k),!1===k.feature.isValid()&&(this.deleteFeature([k.featureId]),this.changeMode(He.SIMPLE_SELECT,{}))},onMouseMove:function(k,G){var we=Ke(G),st=Vr(G),at=0===k.selectedCoordPaths.length;return this.updateUIClasses(we&&at||st&&!at?{mouse:Fe.MOVE}:{mouse:Fe.NONE}),this.stopDragging(k),!0},onMouseOut:function(k){return k.dragMoving&&this.fireUpdate(),!0}};Pi.onTouchStart=Pi.onMouseDown=function(k,G){return Vr(G)?this.onVertex(k,G):Ke(G)?this.onFeature(k,G):nr(G)?this.onMidpoint(k,G):void 0},Pi.onDrag=function(k,G){if(!0===k.canDragMove){k.dragMoving=!0,G.originalEvent.stopPropagation();var we={lng:G.lngLat.lng-k.dragMoveLocation.lng,lat:G.lngLat.lat-k.dragMoveLocation.lat};k.selectedCoordPaths.length>0?this.dragVertex(k,G,we):this.dragFeature(k,G,we),k.dragMoveLocation=G.lngLat}},Pi.onClick=function(k,G){return Jt(G)?this.clickNoTarget(k,G):Ke(G)?this.clickActiveFeature(k,G):St(G)?this.clickInactive(k,G):void this.stopDragging(k)},Pi.onTap=function(k,G){return Jt(G)?this.clickNoTarget(k,G):Ke(G)?this.clickActiveFeature(k,G):St(G)?this.clickInactive(k,G):void 0},Pi.onTouchEnd=Pi.onMouseUp=function(k){k.dragMoving&&this.fireUpdate(),this.stopDragging(k)};var Zr={};function Wi(k,G){return!!k.lngLat&&k.lngLat.lng===G[0]&&k.lngLat.lat===G[1]}Zr.onSetup=function(){var k=this.newFeature({type:nt.FEATURE,properties:{},geometry:{type:nt.POINT,coordinates:[]}});return this.addFeature(k),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Fe.ADD}),this.activateUIButton(bt.POINT),this.setActionableState({trash:!0}),{point:k}},Zr.stopDrawingAndRemove=function(k){this.deleteFeature([k.point.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)},Zr.onTap=Zr.onClick=function(k,G){this.updateUIClasses({mouse:Fe.MOVE}),k.point.updateCoordinate("",G.lngLat.lng,G.lngLat.lat),this.map.fire(dt.CREATE,{features:[k.point.toGeoJSON()]}),this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.point.id]})},Zr.onStop=function(k){this.activateUIButton(),k.point.getCoordinate().length||this.deleteFeature([k.point.id],{silent:!0})},Zr.toDisplayFeatures=function(k,G,we){var st=G.properties.id===k.point.id;if(G.properties.active=st?X.ACTIVE:X.INACTIVE,!st)return we(G)},Zr.onTrash=Zr.stopDrawingAndRemove,Zr.onKeyUp=function(k,G){if(kr(G)||Xr(G))return this.stopDrawingAndRemove(k,G)};var Xi={onSetup:function(){var k=this.newFeature({type:nt.FEATURE,properties:{},geometry:{type:nt.POLYGON,coordinates:[[]]}});return this.addFeature(k),this.clearSelectedFeatures(),eo.disable(this),this.updateUIClasses({mouse:Fe.ADD}),this.activateUIButton(bt.POLYGON),this.setActionableState({trash:!0}),{polygon:k,currentVertexPosition:0}},clickAnywhere:function(k,G){if(k.currentVertexPosition>0&&Wi(G,k.polygon.coordinates[0][k.currentVertexPosition-1]))return this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.polygon.id]});this.updateUIClasses({mouse:Fe.ADD}),k.polygon.updateCoordinate("0."+k.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),k.currentVertexPosition++,k.polygon.updateCoordinate("0."+k.currentVertexPosition,G.lngLat.lng,G.lngLat.lat)},clickOnVertex:function(k){return this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.polygon.id]})},onMouseMove:function(k,G){k.polygon.updateCoordinate("0."+k.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),vn(G)&&this.updateUIClasses({mouse:Fe.POINTER})}};Xi.onTap=Xi.onClick=function(k,G){return vn(G)?this.clickOnVertex(k,G):this.clickAnywhere(k,G)},Xi.onKeyUp=function(k,G){kr(G)?(this.deleteFeature([k.polygon.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)):Xr(G)&&this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.polygon.id]})},Xi.onStop=function(k){this.updateUIClasses({mouse:Fe.NONE}),eo.enable(this),this.activateUIButton(),void 0!==this.getFeature(k.polygon.id)&&(k.polygon.removeCoordinate("0."+k.currentVertexPosition),k.polygon.isValid()?this.map.fire(dt.CREATE,{features:[k.polygon.toGeoJSON()]}):(this.deleteFeature([k.polygon.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT,{},{silent:!0})))},Xi.toDisplayFeatures=function(k,G,we){var st=G.properties.id===k.polygon.id;if(G.properties.active=st?X.ACTIVE:X.INACTIVE,!st)return we(G);if(0!==G.geometry.coordinates.length){var at=G.geometry.coordinates[0].length;if(!(at<3)){if(G.properties.meta=ae.FEATURE,we(gi(k.polygon.id,G.geometry.coordinates[0][0],"0.0",!1)),at>3){var Mt=G.geometry.coordinates[0].length-3;we(gi(k.polygon.id,G.geometry.coordinates[0][Mt],"0."+Mt,!1))}if(at<=4&&(we({type:nt.FEATURE,properties:G.properties,geometry:{coordinates:[[G.geometry.coordinates[0][0][0],G.geometry.coordinates[0][0][1]],[G.geometry.coordinates[0][1][0],G.geometry.coordinates[0][1][1]]],type:nt.LINE_STRING}}),3===at))return;return we(G)}}},Xi.onTrash=function(k){this.deleteFeature([k.polygon.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)};var Yt={onSetup:function(k){var G,we,st=(k=k||{}).featureId,at="forward";if(st){if(!(G=this.getFeature(st)))throw new Error("Could not find a feature with the provided featureId");var Mt=k.from;if(Mt&&"Feature"===Mt.type&&Mt.geometry&&"Point"===Mt.geometry.type&&(Mt=Mt.geometry),Mt&&"Point"===Mt.type&&Mt.coordinates&&2===Mt.coordinates.length&&(Mt=Mt.coordinates),!Mt||!Array.isArray(Mt))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Dt=G.coordinates.length-1;if(G.coordinates[Dt][0]===Mt[0]&&G.coordinates[Dt][1]===Mt[1])G.addCoordinate.apply(G,[we=Dt+1].concat(G.coordinates[Dt]));else{if(G.coordinates[0][0]!==Mt[0]||G.coordinates[0][1]!==Mt[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");at="backwards",G.addCoordinate.apply(G,[we=0].concat(G.coordinates[0]))}}else G=this.newFeature({type:nt.FEATURE,properties:{},geometry:{type:nt.LINE_STRING,coordinates:[]}}),we=0,this.addFeature(G);return this.clearSelectedFeatures(),eo.disable(this),this.updateUIClasses({mouse:Fe.ADD}),this.activateUIButton(bt.LINE),this.setActionableState({trash:!0}),{line:G,currentVertexPosition:we,direction:at}},clickAnywhere:function(k,G){if(k.currentVertexPosition>0&&Wi(G,k.line.coordinates[k.currentVertexPosition-1])||"backwards"===k.direction&&Wi(G,k.line.coordinates[k.currentVertexPosition+1]))return this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.line.id]});this.updateUIClasses({mouse:Fe.ADD}),k.line.updateCoordinate(k.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),"forward"===k.direction?(k.currentVertexPosition++,k.line.updateCoordinate(k.currentVertexPosition,G.lngLat.lng,G.lngLat.lat)):k.line.addCoordinate(0,G.lngLat.lng,G.lngLat.lat)},clickOnVertex:function(k){return this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.line.id]})},onMouseMove:function(k,G){k.line.updateCoordinate(k.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),vn(G)&&this.updateUIClasses({mouse:Fe.POINTER})}};Yt.onTap=Yt.onClick=function(k,G){if(vn(G))return this.clickOnVertex(k,G);this.clickAnywhere(k,G)},Yt.onKeyUp=function(k,G){Xr(G)?this.changeMode(He.SIMPLE_SELECT,{featureIds:[k.line.id]}):kr(G)&&(this.deleteFeature([k.line.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT))},Yt.onStop=function(k){eo.enable(this),this.activateUIButton(),void 0!==this.getFeature(k.line.id)&&(k.line.removeCoordinate(""+k.currentVertexPosition),k.line.isValid()?this.map.fire(dt.CREATE,{features:[k.line.toGeoJSON()]}):(this.deleteFeature([k.line.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT,{},{silent:!0})))},Yt.onTrash=function(k){this.deleteFeature([k.line.id],{silent:!0}),this.changeMode(He.SIMPLE_SELECT)},Yt.toDisplayFeatures=function(k,G,we){var st=G.properties.id===k.line.id;if(G.properties.active=st?X.ACTIVE:X.INACTIVE,!st)return we(G);G.geometry.coordinates.length<2||(G.properties.meta=ae.FEATURE,we(gi(k.line.id,G.geometry.coordinates["forward"===k.direction?G.geometry.coordinates.length-2:1],""+("forward"===k.direction?G.geometry.coordinates.length-2:1),!1)),we(G))};var ca={simple_select:Dr,direct_select:Pi,draw_point:Zr,draw_polygon:Xi,draw_line_string:Yt},so={defaultMode:He.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Le,modes:ca,controls:{},userProperties:!1},di={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Qu={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Ni(k,G){return k.map(function(we){return we.source?we:Ai(we,{id:we.id+"."+G,source:"hot"===G?Pe.HOT:Pe.COLD})})}var ol={};!function(k,G){var we="__lodash_hash_undefined__",st=9007199254740991,at="[object Arguments]",Mt="[object Array]",Dt="[object Boolean]",Cn="[object Date]",Mn="[object Error]",Zn="[object Function]",Qn="[object Map]",jn="[object Number]",cn="[object Object]",as="[object Promise]",jr="[object RegExp]",lo="[object Set]",bn="[object String]",sr="[object WeakMap]",Jr="[object ArrayBuffer]",Gr="[object DataView]",vi=/^\[object .+?Constructor\]$/,pl=/^(?:0|[1-9]\d*)$/,ji={};ji["[object Float32Array]"]=ji["[object Float64Array]"]=ji["[object Int8Array]"]=ji["[object Int16Array]"]=ji["[object Int32Array]"]=ji["[object Uint8Array]"]=ji["[object Uint8ClampedArray]"]=ji["[object Uint16Array]"]=ji["[object Uint32Array]"]=!0,ji[at]=ji[Mt]=ji[Jr]=ji[Dt]=ji[Gr]=ji[Cn]=ji[Mn]=ji[Zn]=ji[Qn]=ji[jn]=ji[cn]=ji[jr]=ji[lo]=ji[bn]=ji[sr]=!1;var ec="object"==typeof global&&global&&global.Object===Object&&global,zn="object"==typeof self&&self&&self.Object===Object&&self,Ci=ec||zn||Function("return this")(),Ms=G&&!G.nodeType&&G,bs=Ms&&k&&!k.nodeType&&k,ha=bs&&bs.exports===Ms,$l=ha&&ec.process,uo=function(){try{return $l&&$l.binding&&$l.binding("util")}catch{}}(),Ns=uo&&uo.isTypedArray;function ou(Ft,rn){for(var Hn=-1,Ar=null==Ft?0:Ft.length;++Hn<Ar;)if(rn(Ft[Hn],Hn,Ft))return!0;return!1}function xa(Ft){var rn=-1,Hn=Array(Ft.size);return Ft.forEach(function(Ar,Yi){Hn[++rn]=[Yi,Ar]}),Hn}function ql(Ft){var rn=-1,Hn=Array(Ft.size);return Ft.forEach(function(Ar){Hn[++rn]=Ar}),Hn}var Cl,Sl,fr,Gu=Array.prototype,xi=Object.prototype,Es=Ci["__core-js_shared__"],su=Function.prototype.toString,ms=xi.hasOwnProperty,ia=(Cl=/[^.]+$/.exec(Es&&Es.keys&&Es.keys.IE_PROTO||""))?"Symbol(src)_1."+Cl:"",Ih=xi.toString,sf=RegExp("^"+su.call(ms).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bo=ha?Ci.Buffer:void 0,Zi=Ci.Symbol,fa=Ci.Uint8Array,Au=xi.propertyIsEnumerable,oa=Gu.splice,Ri=Zi?Zi.toStringTag:void 0,go=Object.getOwnPropertySymbols,wr=bo?bo.isBuffer:void 0,wc=(Sl=Object.keys,fr=Object,function(Ft){return Sl(fr(Ft))}),gl=Xl(Ci,"DataView"),Ur=Xl(Ci,"Map"),ea=Xl(Ci,"Promise"),Hl=Xl(Ci,"Set"),ja=Xl(Ci,"WeakMap"),au=Xl(Object,"create"),bc=Cs(gl),ki=Cs(Ur),ls=Cs(ea),us=Cs(Hl),$u=Cs(ja),Fi=Zi?Zi.prototype:void 0,Xs=Fi?Fi.valueOf:void 0;function ur(Ft){var rn=-1,Hn=null==Ft?0:Ft.length;for(this.clear();++rn<Hn;){var Ar=Ft[rn];this.set(Ar[0],Ar[1])}}function Eo(Ft){var rn=-1,Hn=null==Ft?0:Ft.length;for(this.clear();++rn<Hn;){var Ar=Ft[rn];this.set(Ar[0],Ar[1])}}function er(Ft){var rn=-1,Hn=null==Ft?0:Ft.length;for(this.clear();++rn<Hn;){var Ar=Ft[rn];this.set(Ar[0],Ar[1])}}function Ga(Ft){var rn=-1,Hn=null==Ft?0:Ft.length;for(this.__data__=new er;++rn<Hn;)this.add(Ft[rn])}function Ji(Ft){var rn=this.__data__=new Eo(Ft);this.size=rn.size}function lr(Ft,rn){for(var Hn=Ft.length;Hn--;)if(da(Ft[Hn][0],rn))return Hn;return-1}function Yr(Ft){return null==Ft?void 0===Ft?"[object Undefined]":"[object Null]":Ri&&Ri in Object(Ft)?function(rn){var Hn=ms.call(rn,Ri),Ar=rn[Ri];try{rn[Ri]=void 0;var Yi=!0}catch{}var ei=Ih.call(rn);return Yi&&(Hn?rn[Ri]=Ar:delete rn[Ri]),ei}(Ft):Ih.call(Ft)}function Or(Ft){return ui(Ft)&&Yr(Ft)==at}function ys(Ft,rn,Hn,Ar,Yi){return Ft===rn||(null==Ft||null==rn||!ui(Ft)&&!ui(rn)?Ft!=Ft&&rn!=rn:function(ei,ks,Gi,Qi,Bi,cs){var So=qa(ei),io=qa(ks),ta=So?Mt:Zs(ei),uu=io?Mt:Zs(ks),Il=(ta=ta==at?cn:ta)==cn,Ml=(uu=uu==at?cn:uu)==cn,Ja=ta==uu;if(Ja&&Ds(ei)){if(!Ds(ks))return!1;So=!0,Il=!1}if(Ja&&!Il)return cs||(cs=new Ji),So||Tl(ei)?zs(ei,ks,Gi,Qi,Bi,cs):function(no,ro,Us,mo,Aa,_s,al){switch(Us){case Gr:if(no.byteLength!=ro.byteLength||no.byteOffset!=ro.byteOffset)return!1;no=no.buffer,ro=ro.buffer;case Jr:return!(no.byteLength!=ro.byteLength||!_s(new fa(no),new fa(ro)));case Dt:case Cn:case jn:return da(+no,+ro);case Mn:return no.name==ro.name&&no.message==ro.message;case jr:case bn:return no==ro+"";case Qn:var Pa=xa;case lo:if(Pa||(Pa=ql),no.size!=ro.size&&!(1&mo))return!1;var Ks=al.get(no);if(Ks)return Ks==ro;mo|=2,al.set(no,ro);var ci=zs(Pa(no),Pa(ro),mo,Aa,_s,al);return al.delete(no),ci;case"[object Symbol]":if(Xs)return Xs.call(no)==Xs.call(ro)}return!1}(ei,ks,ta,Gi,Qi,Bi,cs);if(!(1&Gi)){var Ys=Il&&ms.call(ei,"__wrapped__"),sl=Ml&&ms.call(ks,"__wrapped__");if(Ys||sl){var ba=Ys?ei.value():ei,af=sl?ks.value():ks;return cs||(cs=new Ji),Bi(ba,af,Gi,Qi,cs)}}return!!Ja&&(cs||(cs=new Ji),function(no,ro,Us,mo,Aa,_s){var al=1&Us,Pa=Si(no),pa=Pa.length;if(pa!=Si(ro).length&&!al)return!1;for(var ci=pa;ci--;){var vs=Pa[ci];if(!(al?vs in ro:ms.call(ro,vs)))return!1}var Mh=_s.get(no);if(Mh&&_s.get(ro))return Mh==ro;var Qa=!0;_s.set(no,ro),_s.set(ro,no);for(var ho=al;++ci<pa;){var Ra=no[vs=Pa[ci]],Oa=ro[vs];if(mo)var Yl=al?mo(Oa,Ra,vs,ro,no,_s):mo(Ra,Oa,vs,no,ro,_s);if(!(void 0===Yl?Ra===Oa||Aa(Ra,Oa,Us,mo,_s):Yl)){Qa=!1;break}ho||(ho="constructor"==vs)}if(Qa&&!ho){var el=no.constructor,Dl=ro.constructor;el==Dl||!("constructor"in no)||!("constructor"in ro)||"function"==typeof el&&el instanceof el&&"function"==typeof Dl&&Dl instanceof Dl||(Qa=!1)}return _s.delete(no),_s.delete(ro),Qa}(ei,ks,Gi,Qi,Bi,cs))}(Ft,rn,Hn,Ar,ys,Yi))}function zs(Ft,rn,Hn,Ar,Yi,ei){var ks=1&Hn,Gi=Ft.length,Qi=rn.length;if(Gi!=Qi&&!(ks&&Qi>Gi))return!1;var Bi=ei.get(Ft);if(Bi&&ei.get(rn))return Bi==rn;var cs=-1,So=!0,io=2&Hn?new Ga:void 0;for(ei.set(Ft,rn),ei.set(rn,Ft);++cs<Gi;){var ta=Ft[cs],uu=rn[cs];if(Ar)var Il=ks?Ar(uu,ta,cs,rn,Ft,ei):Ar(ta,uu,cs,Ft,rn,ei);if(void 0!==Il){if(Il)continue;So=!1;break}if(io){if(!ou(rn,function(Ml,Ja){if(!io.has(Ja)&&(ta===Ml||Yi(ta,Ml,Hn,Ar,ei)))return io.push(Ja)})){So=!1;break}}else if(ta!==uu&&!Yi(ta,uu,Hn,Ar,ei)){So=!1;break}}return ei.delete(Ft),ei.delete(rn),So}function Si(Ft){return Ar=oi,Yi=function Zl(Ft){return null!=(rn=Ft)&&Pu(rn.length)&&!co(rn)?function wa(Ft,rn){var Hn=qa(Ft),Ar=!Hn&&ts(Ft),Yi=!Hn&&!Ar&&Ds(Ft),ei=!Hn&&!Ar&&!Yi&&Tl(Ft),ks=Hn||Ar||Yi||ei,Gi=ks?function(cs,So){for(var io=-1,ta=Array(cs);++io<cs;)ta[io]=So(io);return ta}(Ft.length,String):[],Qi=Gi.length;for(var Bi in Ft)!rn&&!ms.call(Ft,Bi)||ks&&("length"==Bi||Yi&&("offset"==Bi||"parent"==Bi)||ei&&("buffer"==Bi||"byteLength"==Bi||"byteOffset"==Bi)||$a(Bi,Qi))||Gi.push(Bi);return Gi}(Ft):function Co(Ft){if(Hn=(rn=Ft)&&rn.constructor,rn!==("function"==typeof Hn&&Hn.prototype||xi))return wc(Ft);var rn,Hn,Yi=[];for(var ei in Object(Ft))ms.call(Ft,ei)&&"constructor"!=ei&&Yi.push(ei);return Yi}(Ft);var rn}(rn=Ft),qa(rn)?Yi:function(ei,ks){for(var Gi=-1,Qi=ks.length,Bi=ei.length;++Gi<Qi;)ei[Bi+Gi]=ks[Gi];return ei}(Yi,Ar(rn));var rn,Ar,Yi}function lu(Ft,rn){var Hn,Ar,Yi=Ft.__data__;return("string"==(Ar=typeof(Hn=rn))||"number"==Ar||"symbol"==Ar||"boolean"==Ar?"__proto__"!==Hn:null===Hn)?Yi["string"==typeof rn?"string":"hash"]:Yi.map}function Xl(Ft,rn){var Hn=Ft?.[rn];return function Wl(Ft){return!(!Ru(Ft)||(rn=Ft,ia&&ia in rn))&&(co(Ft)?sf:vi).test(Cs(Ft));var rn}(Hn)?Hn:void 0}ur.prototype.clear=function(){this.__data__=au?au(null):{},this.size=0},ur.prototype.delete=function(Ft){var rn=this.has(Ft)&&delete this.__data__[Ft];return this.size-=rn?1:0,rn},ur.prototype.get=function(Ft){var rn=this.__data__;if(au){var Hn=rn[Ft];return Hn===we?void 0:Hn}return ms.call(rn,Ft)?rn[Ft]:void 0},ur.prototype.has=function(Ft){var rn=this.__data__;return au?void 0!==rn[Ft]:ms.call(rn,Ft)},ur.prototype.set=function(Ft,rn){var Hn=this.__data__;return this.size+=this.has(Ft)?0:1,Hn[Ft]=au&&void 0===rn?we:rn,this},Eo.prototype.clear=function(){this.__data__=[],this.size=0},Eo.prototype.delete=function(Ft){var rn=this.__data__,Hn=lr(rn,Ft);return!(Hn<0||(Hn==rn.length-1?rn.pop():oa.call(rn,Hn,1),--this.size,0))},Eo.prototype.get=function(Ft){var rn=this.__data__,Hn=lr(rn,Ft);return Hn<0?void 0:rn[Hn][1]},Eo.prototype.has=function(Ft){return lr(this.__data__,Ft)>-1},Eo.prototype.set=function(Ft,rn){var Hn=this.__data__,Ar=lr(Hn,Ft);return Ar<0?(++this.size,Hn.push([Ft,rn])):Hn[Ar][1]=rn,this},er.prototype.clear=function(){this.size=0,this.__data__={hash:new ur,map:new(Ur||Eo),string:new ur}},er.prototype.delete=function(Ft){var rn=lu(this,Ft).delete(Ft);return this.size-=rn?1:0,rn},er.prototype.get=function(Ft){return lu(this,Ft).get(Ft)},er.prototype.has=function(Ft){return lu(this,Ft).has(Ft)},er.prototype.set=function(Ft,rn){var Hn=lu(this,Ft),Ar=Hn.size;return Hn.set(Ft,rn),this.size+=Hn.size==Ar?0:1,this},Ga.prototype.add=Ga.prototype.push=function(Ft){return this.__data__.set(Ft,we),this},Ga.prototype.has=function(Ft){return this.__data__.has(Ft)},Ji.prototype.clear=function(){this.__data__=new Eo,this.size=0},Ji.prototype.delete=function(Ft){var rn=this.__data__,Hn=rn.delete(Ft);return this.size=rn.size,Hn},Ji.prototype.get=function(Ft){return this.__data__.get(Ft)},Ji.prototype.has=function(Ft){return this.__data__.has(Ft)},Ji.prototype.set=function(Ft,rn){var Hn=this.__data__;if(Hn instanceof Eo){var Ar=Hn.__data__;if(!Ur||Ar.length<199)return Ar.push([Ft,rn]),this.size=++Hn.size,this;Hn=this.__data__=new er(Ar)}return Hn.set(Ft,rn),this.size=Hn.size,this};var oi=go?function(Ft){return null==Ft?[]:(Ft=Object(Ft),function(rn,Hn){for(var Ar=-1,Yi=null==rn?0:rn.length,ei=0,ks=[];++Ar<Yi;){var Gi=rn[Ar];Hn(Gi)&&(ks[ei++]=Gi)}return ks}(go(Ft),function(rn){return Au.call(Ft,rn)}))}:function(){return[]},Zs=Yr;function $a(Ft,rn){return!!(rn=rn??st)&&("number"==typeof Ft||pl.test(Ft))&&Ft>-1&&Ft%1==0&&Ft<rn}function Cs(Ft){if(null!=Ft){try{return su.call(Ft)}catch{}try{return Ft+""}catch{}}return""}function da(Ft,rn){return Ft===rn||Ft!=Ft&&rn!=rn}(gl&&Zs(new gl(new ArrayBuffer(1)))!=Gr||Ur&&Zs(new Ur)!=Qn||ea&&Zs(ea.resolve())!=as||Hl&&Zs(new Hl)!=lo||ja&&Zs(new ja)!=sr)&&(Zs=function(Ft){var rn=Yr(Ft),Hn=rn==cn?Ft.constructor:void 0,Ar=Hn?Cs(Hn):"";if(Ar)switch(Ar){case bc:return Gr;case ki:return Qn;case ls:return as;case us:return lo;case $u:return sr}return rn});var ts=Or(function(){return arguments}())?Or:function(Ft){return ui(Ft)&&ms.call(Ft,"callee")&&!Au.call(Ft,"callee")},qa=Array.isArray,Ds=wr||function(){return!1};function co(Ft){if(!Ru(Ft))return!1;var rn=Yr(Ft);return rn==Zn||"[object GeneratorFunction]"==rn||"[object AsyncFunction]"==rn||"[object Proxy]"==rn}function Pu(Ft){return"number"==typeof Ft&&Ft>-1&&Ft%1==0&&Ft<=st}function Ru(Ft){var rn=typeof Ft;return null!=Ft&&("object"==rn||"function"==rn)}function ui(Ft){return null!=Ft&&"object"==typeof Ft}var Ft,Tl=Ns?(Ft=Ns,function(rn){return Ft(rn)}):function(Ft){return ui(Ft)&&Pu(Ft.length)&&!!ji[Yr(Ft)]};k.exports=function(Ft,rn){return ys(Ft,rn)}}({get exports(){return ol},set exports(k){ol=k}},ol);var xc=ol;function ao(k,G){return k.length===G.length&&JSON.stringify(k.map(function(we){return we}).sort())===JSON.stringify(G.map(function(we){return we}).sort())}var hn={Polygon:qt,LineString:Be,Point:xt,MultiPolygon:At,MultiLineString:At,MultiPoint:At},Qr=Object.freeze({__proto__:null,CommonSelectors:kn,constrainFeatureMovement:xr,createMidPoint:oo,createSupplementaryPoints:xo,createVertex:gi,doubleClickZoom:eo,euclideanDistance:ln,featuresAt:je,getFeatureAtAndSetCursors:Se,isClick:Bt,isEventAtCoordinates:Wi,isTap:$e,mapEventToBoundingBox:me,ModeHandler:rt,moveFeatures:_r,sortFeatures:le,stringSetsAreEqual:ao,StringSet:ne,theme:Le,toDenseArray:Un});function On(k){!function(k,G){var at,Mt,we={options:k=function(at){void 0===at&&(at={});var Mt=Ai(at);return at.controls||(Mt.controls={}),Mt.controls=Ai(!1===at.displayControlsDefault?Qu:di,at.controls),(Mt=Ai(so,Mt)).styles=Ni(Mt.styles,"cold").concat(Ni(Mt.styles,"hot")),Mt}(k)};at=we,(Mt=G).modes=He,Mt.getFeatureIdsAt=function(Dt){return je.click({point:Dt},null,at).map(function(Cn){return Cn.properties.id})},Mt.getSelectedIds=function(){return at.store.getSelectedIds()},Mt.getSelected=function(){return{type:nt.FEATURE_COLLECTION,features:at.store.getSelectedIds().map(function(Dt){return at.store.get(Dt)}).map(function(Dt){return Dt.toGeoJSON()})}},Mt.getSelectedPoints=function(){return{type:nt.FEATURE_COLLECTION,features:at.store.getSelectedCoordinates().map(function(Dt){return{type:nt.FEATURE,properties:{},geometry:{type:nt.POINT,coordinates:Dt.coordinates}}})}},Mt.set=function(Dt){if(void 0===Dt.type||Dt.type!==nt.FEATURE_COLLECTION||!Array.isArray(Dt.features))throw new Error("Invalid FeatureCollection");var Cn=at.store.createRenderBatch(),Mn=at.store.getAllIds().slice(),Zn=Mt.add(Dt),Qn=new ne(Zn);return(Mn=Mn.filter(function(jn){return!Qn.has(jn)})).length&&Mt.delete(Mn),Cn(),Zn},Mt.add=function(Dt){var Cn=JSON.parse(JSON.stringify(Li(Dt))).features.map(function(Mn){if(Mn.id=Mn.id||Tt(),null===Mn.geometry)throw new Error("Invalid geometry: null");if(void 0===at.store.get(Mn.id)||at.store.get(Mn.id).type!==Mn.geometry.type){var Zn=hn[Mn.geometry.type];if(void 0===Zn)throw new Error("Invalid geometry type: "+Mn.geometry.type+".");var Qn=new Zn(at,Mn);at.store.add(Qn)}else{var jn=at.store.get(Mn.id);jn.properties=Mn.properties,xc(jn.getCoordinates(),Mn.geometry.coordinates)||jn.incomingCoords(Mn.geometry.coordinates)}return Mn.id});return at.store.render(),Cn},Mt.get=function(Dt){var Cn=at.store.get(Dt);if(Cn)return Cn.toGeoJSON()},Mt.getAll=function(){return{type:nt.FEATURE_COLLECTION,features:at.store.getAll().map(function(Dt){return Dt.toGeoJSON()})}},Mt.delete=function(Dt){return at.store.delete(Dt,{silent:!0}),Mt.getMode()!==He.DIRECT_SELECT||at.store.getSelectedIds().length?at.store.render():at.events.changeMode(He.SIMPLE_SELECT,void 0,{silent:!0}),Mt},Mt.deleteAll=function(){return at.store.delete(at.store.getAllIds(),{silent:!0}),Mt.getMode()===He.DIRECT_SELECT?at.events.changeMode(He.SIMPLE_SELECT,void 0,{silent:!0}):at.store.render(),Mt},Mt.changeMode=function(Dt,Cn){return void 0===Cn&&(Cn={}),Dt===He.SIMPLE_SELECT&&Mt.getMode()===He.SIMPLE_SELECT?(ao(Cn.featureIds||[],at.store.getSelectedIds())||(at.store.setSelected(Cn.featureIds,{silent:!0}),at.store.render()),Mt):(Dt===He.DIRECT_SELECT&&Mt.getMode()===He.DIRECT_SELECT&&Cn.featureId===at.store.getSelectedIds()[0]||at.events.changeMode(Dt,Cn,{silent:!0}),Mt)},Mt.getMode=function(){return at.events.getMode()},Mt.trash=function(){return at.events.trash({silent:!0}),Mt},Mt.combineFeatures=function(){return at.events.combineFeatures({silent:!0}),Mt},Mt.uncombineFeatures=function(){return at.events.uncombineFeatures({silent:!0}),Mt},Mt.setFeatureProperty=function(Dt,Cn,Mn){return at.store.setFeatureProperty(Dt,Cn,Mn),Mt},we.api=G=Mt;var st=Nt(we);G.onAdd=st.onAdd,G.onRemove=st.onRemove,G.types=bt,G.options=k}(k,this)}return On.modes=ca,On.constants=te,On.lib=Qr,On}()},2564:(Lt,rt,xe)=>{"use strict";var de=xe(9652).x0;function ye(Ce){this.origin=Ce.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=Ce.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=Ce,this.send=this.send.bind(this),this.countries=Ce.countries?Ce.countries.split(","):null,this.types=Ce.types?Ce.types.split(","):null,this.bbox=Ce.bbox?Ce.bbox:null,this.language=Ce.language?Ce.language.split(","):null,this.limit=Ce.limit?+Ce.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(Ce),this.eventQueue=new Array,this.flushInterval=Ce.flushInterval||1e3,this.maxQueueSize=Ce.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}ye.prototype={select:function(Ce,p){var K=this.getSelectedIndex(Ce,p),ge=this.getEventPayload("search.select",p);if(ge.resultIndex=K,ge.resultPlaceName=Ce.place_name,ge.resultId=Ce.id,(K!==this.lastSentIndex||ge.queryString!==this.lastSentInput)&&-1!=K&&(this.lastSentIndex=K,this.lastSentInput=ge.queryString,ge.queryString))return this.push(ge)},start:function(Ce){var p=this.getEventPayload("search.start",Ce);if(p.queryString)return this.push(p)},keyevent:function(Ce,p){if(Ce.key&&!Ce.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(Ce.keyCode)){var K=this.getEventPayload("search.keystroke",p);if(K.lastAction=Ce.key,K.queryString)return this.push(K)}},send:function(Ce,p){if(!this.enableEventLogging)return p?p():void 0;var K=this.getRequestOptions(Ce);this.request(K,function(ge){return ge?this.handleError(ge,p):p?p():void 0}.bind(this))},getRequestOptions:function(Ce){return Array.isArray(Ce)||(Ce=[Ce]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(Ce)}},getEventPayload:function(Ce,p){var K;K=p.options.proximity?"object"==typeof p.options.proximity?[p.options.proximity.longitude,p.options.proximity.latitude]:"ip"===p.options.proximity?[999,999]:p.options.proximity:null;var ge=p._map?p._map.getZoom():void 0,Te={event:Ce,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:p.options.autocomplete,fuzzyMatch:p.options.fuzzyMatch,proximity:K,limit:p.options.limit,routing:p.options.routing,worldview:p.options.worldview,mapZoom:ge,keyboardLocale:this.locale};return Te.queryString="search.select"===Ce?p.inputString:"search.select"!=Ce&&p._inputEl?p._inputEl.value:p.inputString,Te},request:function(Ce,p){var K=new XMLHttpRequest;for(var ge in K.onreadystatechange=function(){if(4==this.readyState)return p(204==this.status?null:this.statusText)},K.open(Ce.method,Ce.host+"/"+Ce.path,!0),Ce.headers)K.setRequestHeader(ge,Ce.headers[ge]);K.send(Ce.body)},handleError:function(Ce,p){if(p)return p(Ce)},generateSessionID:function(){return de()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(Ce,p){if(p._typeahead){var ge=Ce.id;return p._typeahead.data.map(function(Fe){return Fe.id}).indexOf(ge)}},shouldEnableLogging:function(Ce){return!(!1===Ce.enableEventLogging||Ce.origin&&"https://api.mapbox.com"!==Ce.origin||Ce.localGeocoder||Ce.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(Ce,p){this.eventQueue.push(Ce),(this.eventQueue.length>=this.maxQueueSize||p)&&this.flush()},remove:function(){this.flush()}},Lt.exports=ye},3424:Lt=>{Lt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},3569:Lt=>{function rt(){}rt.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const xe={enableHighAccuracy:!0};return new Promise(function(de,ye){window.navigator.geolocation.getCurrentPosition(de,ye,xe)})}},Lt.exports=rt},8545:(Lt,rt,xe)=>{"use strict";var de=xe(5562),ye=xe(3082),Ce=xe(4703),p=xe(9069).EventEmitter,K=xe(3424),ge=xe(9471),Te=xe(7075),Pe=xe(2564),Fe=xe(1753),bt=xe(6775),nt=xe(3569),He=xe(2777);function ae(X){this._eventEmitter=new p,this.options=Ce({},this.options,X),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new nt}ae.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(X){return X.place_name},render:function(X){var re=X.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+re[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+re.splice(1,re.length).join(",")+"</div></div>"}},addTo:function(X){function re(Q,te){if(!document.body.contains(te))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ue=Q.onAdd();te.appendChild(ue)}if(X._controlContainer)X.addControl(this);else if(X instanceof HTMLElement)re(this,X);else{if("string"!=typeof X)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const Q=document.querySelectorAll(X);if(0===Q.length)throw new Error("Element ",X,"not found.");if(Q.length>1)throw new Error("Geocoder can only be added to a single html element");re(this,Q[0])}}},onAdd:function(X){if(X&&"string"!=typeof X&&(this._map=X),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Te(ge({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Pe(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var re=this.container=document.createElement("div");re.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var Q=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",ye(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(ct){this.eventManager.keyevent(ct,this)}.bind(this));var te=document.createElement("div");te.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ue=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ue),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),te.appendChild(this._clearEl),te.appendChild(this._loadingEl),re.appendChild(Q),re.appendChild(this._inputEl),re.appendChild(te),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var oe=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(oe),te.appendChild(this._geolocateEl),this._showGeolocateButton()}var le=this._typeahead=new de(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),le.getItemValue=this.options.getItemValue;var me=le.list.draw,ne=this._footerNode=function Rt(){var X=document.createElement("div");return X.className="mapboxgl-ctrl-geocoder--powered-by",X.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',X}();return le.list.draw=function(){me.call(this),ne.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),ne.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(ne)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),re},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(X){this._hideLoadingIcon();const re={geometry:{type:"Point",coordinates:[X.coords.longitude,X.coords.latitude]}};this._handleMarker(re),this._fly(re),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(re),this._showClearButton(),this.fresh=!1;const Q={limit:1,language:[this.options.language],query:re.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(re.geometry.coordinates[0]+","+re.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:re})):this.geocoderService.reverseGeocode(Q).send().then(function(te){const ue=te.body.features[0];if(ue){const oe=He.transformFeatureToGeolocationText(ue,this.options.addressAccuracy);this._setInputValue(oe),ue.user_coordinates=re.geometry.coordinates,this._eventEmitter.emit("result",{result:ue})}else this._eventEmitter.emit("result",{result:{user_coordinates:re.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(X){1===X.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(X,re){var Q=document.createElementNS("http://www.w3.org/2000/svg","svg");return Q.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+X),Q.setAttribute("viewBox","0 0 18 18"),Q.setAttribute("xml:space","preserve"),Q.setAttribute("width",18),Q.setAttribute("height",18),Q.innerHTML=re,Q},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(X){this._inputEl.value=X,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(X){var re=(X.clipboardData||window.clipboardData).getData("text");re.length>=this.options.minLength&&this._geocode(re)},_onKeyDown:function(X){var re=27,Q=9;if(X.keyCode===re&&this.options.clearAndBlurOnEsc)return this._clear(X),this._inputEl.blur();var te=X.target&&X.target.shadowRoot?X.target.shadowRoot.activeElement:X.target;if(!te||!te.value)return this.fresh=!0,X.keyCode!==Q&&this.clear(X),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!X.metaKey&&-1===[Q,re,37,39,13,38,40].indexOf(X.keyCode)&&te.value.length>=this.options.minLength&&this._geocode(te.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(X){this.options.clearOnBlur&&this._clearOnBlur(X),this.options.collapsed&&this._collapse()},_onChange:function(){var X=this._typeahead.selected;X&&JSON.stringify(X)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(X),this.options.marker&&this._mapboxgl&&this._handleMarker(X),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(X),this._eventEmitter.emit("result",{result:X}),this.eventManager.select(X,this))},_fly:function(X){var re;if(X.properties&&K[X.properties.short_code])re=Ce({},this.options.flyTo),this._map&&this._map.fitBounds(K[X.properties.short_code].bbox,re);else if(X.bbox){var Q=X.bbox;re=Ce({},this.options.flyTo),this._map&&this._map.fitBounds([[Q[0],Q[1]],[Q[2],Q[3]]],re)}else re=Ce({},{zoom:this.options.zoom},this.options.flyTo),X.center?re.center=X.center:X.geometry&&X.geometry.type&&"Point"===X.geometry.type&&X.geometry.coordinates&&(re.center=X.geometry.coordinates),this._map&&this._map.flyTo(re)},_requestType:function(X,re){return X.localGeocoderOnly?1:X.reverseGeocode&&He.REVERSE_GEOCODE_COORD_RGX.test(re)?2:0},_setupConfig:function(X,re){const te=/[\s,]+/;var ue=this,oe=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(me,ne){return null==ue.options[ne]||(me[ne]=["countries","types","language"].indexOf(ne)>-1?ue.options[ne].split(te):ue.options[ne],"proximity"===ne&&"number"==typeof ue.options[ne].longitude&&"number"==typeof ue.options[ne].latitude&&(me[ne]=[ue.options[ne].longitude,ue.options[ne].latitude])),me},{});switch(X){case 2:var le=re.split(te).map(function(me){return parseFloat(me,10)});ue.options.flipCoordinates||le.reverse(),oe=Ce(oe,{query:le,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(me){me in oe&&delete oe[me]});break;case 0:{const me=re.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(me)&&(re=re.replace(/,/g," ")),oe=Ce(oe,{query:re})}}return oe},_geocode:function(X){this.inputString=X,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:X});const re=this._requestType(this.options,X),Q=this._setupConfig(re,X);var te;switch(re){case 1:te=Promise.resolve();break;case 0:te=this.geocoderService.forwardGeocode(Q).send();break;case 2:te=this.geocoderService.reverseGeocode(Q).send()}var ue=this.options.localGeocoder&&this.options.localGeocoder(X)||[],oe=[],le=null;return te.catch(function(me){le=me}.bind(this)).then(function(me){this._hideLoadingIcon();var ne={};return me?"200"==me.statusCode&&((ne=me.body).request=me.request,ne.headers=me.headers):ne={type:"FeatureCollection",features:[]},ne.config=Q,this.fresh&&(this.eventManager.start(this),this.fresh=!1),ne.features=ne.features?ue.concat(ne.features):ue,this.options.externalGeocoder?(oe=this.options.externalGeocoder(X,ne.features)||Promise.resolve([])).then(function(ct){return ne.features=ne.features?ct.concat(ne.features):ct,ne},function(){return ne}):ne}.bind(this)).then(function(me){if(le)throw le;this.options.filter&&me.features.length&&(me.features=me.features.filter(this.options.filter)),me.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",me),this._typeahead.update(me.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",me))}.bind(this)).catch(function(me){this._hideLoadingIcon(),this._hideAttribution(),ue.length&&this.options.localGeocoder||oe.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ue)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ue}),this._eventEmitter.emit("error",{error:me})}.bind(this)),te},_clear:function(X){X&&X.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(X){this._clear(X),this._inputEl.focus()},_clearOnBlur:function(X){X.relatedTarget&&this._clear(X)},_onQueryResult:function(X){var re=X.body;if(re.features.length){var Q=re.features[0];this._typeahead.selected=Q,this._inputEl.value=Q.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var X=this._map.getCenter().wrap();this.setProximity({longitude:X.lng,latitude:X.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(X){return this._geocode(X).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(X){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(X)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var X=this.options.language.split(",")[0],re=bt.language(X),Q=Fe.placeholder[re];if(Q)return Q}return"Search"},setInput:function(X){return this._inputEl.value=X,this._typeahead.selected=null,this._typeahead.clear(),X.length>=this.options.minLength&&this._geocode(X),this},setProximity:function(X,re=!0){return this.options.proximity=X,re&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(X){return X&&"function"==typeof X&&(this._typeahead.render=X),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(X){var re=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=X||this.options.language||re,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(X){return this.options.zoom=X,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(X){return this.options.flyTo=X,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(X){return this.placeholder=X||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(X){return this.options.bbox=X,this},getCountries:function(){return this.options.countries},setCountries:function(X){return this.options.countries=X,this},getTypes:function(){return this.options.types},setTypes:function(X){return this.options.types=X,this},getMinLength:function(){return this.options.minLength},setMinLength:function(X){return this.options.minLength=X,this._typeahead&&(this._typeahead.options.minLength=X),this},getLimit:function(){return this.options.limit},setLimit:function(X){return this.options.limit=X,this._typeahead&&(this._typeahead.options.limit=X),this},getFilter:function(){return this.options.filter},setFilter:function(X){return this.options.filter=X,this},setOrigin:function(X){return this.options.origin=X,this.geocoderService=Te(ge({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(X){return this.options.accessToken=X,this.geocoderService=Te(ge({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(X){return this.options.autocomplete=X,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(X){return this.options.fuzzyMatch=X,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(X){return this.options.routing=X,this},getRouting:function(){return this.options.routing},setWorldview:function(X){return this.options.worldview=X,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(X){if(this._map){this._removeMarker();var Q=Ce({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(Q),X.center?this.mapMarker.setLngLat(X.center).addTo(this._map):X.geometry&&X.geometry.type&&"Point"===X.geometry.type&&X.geometry.coordinates&&this.mapMarker.setLngLat(X.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(X,re){return this._eventEmitter.on(X,re),this},off:function(X,re){return this._eventEmitter.removeListener(X,re),this.eventManager.remove(),this}},Lt.exports=ae},1753:Lt=>{"use strict";Lt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},2777:Lt=>{function xe(ye){const Ce=ye.address||"",p=ye.text||"",K=ye.place_name||"",Te={address:K.split(",")[0],houseNumber:Ce,street:p,placeName:K};return ye.context.forEach(function(Pe){const Fe=Pe.id.split(".")[0];Te[Fe]=Pe.text}),Te}Lt.exports={transformFeatureToGeolocationText:function rt(ye,Ce){const p=xe(ye),K=["address","street","place","country"];if("function"==typeof Ce)return Ce(p);const Te=K.indexOf(Ce);return(-1===Te?K:K.slice(Te)).reduce(function(Pe,Fe){return p[Fe]?(""!==Pe&&(Pe+=", "),Pe+p[Fe]):Pe},"")},getAddressInfo:xe,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},9471:(Lt,rt,xe)=>{"use strict";var de=xe(7454);Lt.exports=de},7454:(Lt,rt,xe)=>{"use strict";var de=xe(753),ye=xe(4176);function Ce(K){ye.call(this,K)}(Ce.prototype=Object.create(ye.prototype)).constructor=Ce,Ce.prototype.sendRequest=de.browserSend,Ce.prototype.abortRequest=de.browserAbort,Lt.exports=function p(K){return new Ce(K)}},753:(Lt,rt,xe)=>{"use strict";var de=xe(4332),ye=xe(6158),Ce=xe(9719),p=xe(8829),K={};function Pe(He){var dt=He.total,Rt=He.loaded;return{total:dt,transferred:Rt,percent:100*Rt/dt}}function Fe(He,dt){return new Promise(function(Rt,ae){dt.onprogress=function(Q){He.emitter.emit(Ce.EVENT_PROGRESS_DOWNLOAD,Pe(Q))};var X=He.file;X&&(dt.upload.onprogress=function(Q){He.emitter.emit(Ce.EVENT_PROGRESS_UPLOAD,Pe(Q))}),dt.onerror=function(Q){ae(Q)},dt.onabort=function(){var Q=new ye({request:He,type:Ce.ERROR_REQUEST_ABORTED});ae(Q)},dt.onload=function(){if(delete K[He.id],dt.status<200||dt.status>=400){var Q=new ye({request:He,body:dt.response,statusCode:dt.status});ae(Q)}else Rt(dt)};var re=He.body;"string"==typeof re?dt.send(re):re?dt.send(JSON.stringify(re)):X?dt.send(X):dt.send(),K[He.id]=dt}).then(function(Rt){return function Te(He,dt){return new de(He,{body:dt.response,headers:p(dt.getAllResponseHeaders()),statusCode:dt.status})}(He,Rt)})}function bt(He,dt){var Rt=He.url(dt),ae=new window.XMLHttpRequest;return ae.open(He.method,Rt),Object.keys(He.headers).forEach(function(X){ae.setRequestHeader(X,He.headers[X])}),ae}Lt.exports={browserAbort:function ge(He){var dt=K[He.id];!dt||(dt.abort(),delete K[He.id])},sendRequestXhr:Fe,browserSend:function nt(He){return Promise.resolve().then(function(){var dt=bt(He,He.client.accessToken);return Fe(He,dt)})},createRequestXhr:bt}},4176:(Lt,rt,xe)=>{"use strict";var de=xe(8129),ye=xe(4538),Ce=xe(9719);function p(K){if(!K||!K.accessToken)throw new Error("Cannot create a client without an access token");de(K.accessToken),this.accessToken=K.accessToken,this.origin=K.origin||Ce.API_ORIGIN}p.prototype.createRequest=function(ge){return new ye(this,ge)},Lt.exports=p},6158:(Lt,rt,xe)=>{"use strict";var de=xe(9719);Lt.exports=function ye(Ce){var K,p=Ce.type||de.ERROR_HTTP;if(Ce.body)try{K=JSON.parse(Ce.body)}catch{K=Ce.body}else K=null;var ge=Ce.message||null;ge||("string"==typeof K?ge=K:K&&"string"==typeof K.message?ge=K.message:p===de.ERROR_REQUEST_ABORTED&&(ge="Request aborted")),this.message=ge,this.type=p,this.statusCode=Ce.statusCode||null,this.request=Ce.request,this.body=K}},4538:(Lt,rt,xe)=>{"use strict";var de=xe(8129),ye=xe(4703),Ce=xe(6661),p=xe(3449),K=xe(9719),ge=1;function Te(Pe,Fe){if(!Pe)throw new Error("MapiRequest requires a client");if(!Fe||!Fe.path||!Fe.method)throw new Error("MapiRequest requires an options object with path and method properties");var bt={};Fe.body&&(bt["content-type"]="application/json");var nt=ye(bt,Fe.headers),He=Object.keys(nt).reduce(function(dt,Rt){return dt[Rt.toLowerCase()]=nt[Rt],dt},{});this.id=ge++,this._options=Fe,this.emitter=new Ce,this.client=Pe,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=Fe.path,this.method=Fe.method,this.origin=Fe.origin||Pe.origin,this.query=Fe.query||{},this.params=Fe.params||{},this.body=Fe.body||null,this.file=Fe.file||null,this.encoding=Fe.encoding||"utf8",this.sendFileAs=Fe.sendFileAs||null,this.headers=He}Te.prototype.url=function(Fe){var bt=p.prependOrigin(this.path,this.origin);bt=p.appendQueryObject(bt,this.query);var nt=this.params,He=Fe??this.client.accessToken;if(He){bt=p.appendQueryParam(bt,"access_token",He);var dt=de(He).user;nt=ye({ownerId:dt},nt)}return p.interpolateRouteParams(bt,nt)},Te.prototype.send=function(){var Fe=this;if(Fe.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return Fe.sent=!0,Fe.client.sendRequest(Fe).then(function(bt){return Fe.response=bt,Fe.emitter.emit(K.EVENT_RESPONSE,bt),bt},function(bt){throw Fe.error=bt,Fe.emitter.emit(K.EVENT_ERROR,bt),bt})},Te.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Te.prototype.eachPage=function(Fe){var bt=this;function nt(Rt){Fe(null,Rt,function ae(){delete bt._nextPageRequest;var X=Rt.nextPage();X&&(bt._nextPageRequest=X,dt(X))})}function He(Rt){Fe(Rt,null,function(){})}function dt(Rt){Rt.send().then(nt,He)}dt(this)},Te.prototype.clone=function(){return this._extend()},Te.prototype._extend=function(Fe){var bt=ye(this._options,Fe);return new Te(this.client,bt)},Lt.exports=Te},4332:(Lt,rt,xe)=>{"use strict";var de=xe(5699);function ye(Ce,p){this.request=Ce,this.headers=p.headers,this.rawBody=p.body,this.statusCode=p.statusCode;try{this.body=JSON.parse(p.body||"{}")}catch{this.body=p.body}this.links=de(this.headers.link)}ye.prototype.hasNextPage=function(){return!!this.links.next},ye.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Lt.exports=ye},9719:Lt=>{"use strict";Lt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},8829:Lt=>{"use strict";Lt.exports=function xe(de){var ye={};return de&&de.trim().split(/[\r|\n]+/).forEach(function(Ce){var p=function rt(de){var ye=de.indexOf(":");return{name:de.substring(0,ye).trim().toLowerCase(),value:de.substring(ye+1).trim()}}(Ce);ye[p.name]=p.value}),ye}},5699:Lt=>{"use strict";Lt.exports=function de(ye){return ye?ye.split(/,\s*</).reduce(function(Ce,p){var K=function xe(ye){var Ce=ye.match(/<?([^>]*)>(.*)/);if(!Ce)return null;var p=Ce[1],K=Ce[2].split(";"),ge=null,Te=K.reduce(function(Pe,Fe){var bt=function rt(ye){var Ce=ye.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return Ce?{key:Ce[1],value:Ce[2]}:null}(Fe);return bt?"rel"===bt.key?(ge||(ge=bt.value),Pe):(Pe[bt.key]=bt.value,Pe):Pe},{});return ge?{url:p,rel:ge,params:Te}:null}(p);return K?(K.rel.split(/\s+/).forEach(function(Te){Ce[Te]||(Ce[Te]={url:K.url,params:K.params})}),Ce):Ce},{}):{}}},3449:Lt=>{"use strict";function xe(K){return Array.isArray(K)?function rt(K){return K.map(encodeURIComponent).join(",")}(K):encodeURIComponent(String(K))}function de(K,ge,Te){if(!1===Te||null===Te)return K;var Pe=/\?/.test(K)?"&":"?",Fe=encodeURIComponent(ge);return void 0!==Te&&""!==Te&&!0!==Te&&(Fe+="="+xe(Te)),""+K+Pe+Fe}Lt.exports={appendQueryObject:function ye(K,ge){if(!ge)return K;var Te=K;return Object.keys(ge).forEach(function(Pe){var Fe=ge[Pe];void 0!==Fe&&(Array.isArray(Fe)&&(Fe=Fe.filter(function(bt){return null!=bt}).join(",")),Te=de(Te,Pe,Fe))}),Te},appendQueryParam:de,prependOrigin:function Ce(K,ge){if(!ge||"http"===K.slice(0,4))return K;var Te="/"===K[0]?"":"/";return""+ge.replace(/\/$/,"")+Te+K},interpolateRouteParams:function p(K,ge){return ge?K.replace(/\/:([a-zA-Z0-9]+)/g,function(Te,Pe){var Fe=ge[Pe];if(void 0===Fe)throw new Error("Unspecified route parameter "+Pe);return"/"+xe(Fe)}):K}}},6661:Lt=>{"use strict";var rt=Object.prototype.hasOwnProperty,xe="~";function de(){}function ye(ge,Te,Pe){this.fn=ge,this.context=Te,this.once=Pe||!1}function Ce(ge,Te,Pe,Fe,bt){if("function"!=typeof Pe)throw new TypeError("The listener must be a function");var nt=new ye(Pe,Fe||ge,bt),He=xe?xe+Te:Te;return ge._events[He]?ge._events[He].fn?ge._events[He]=[ge._events[He],nt]:ge._events[He].push(nt):(ge._events[He]=nt,ge._eventsCount++),ge}function p(ge,Te){0==--ge._eventsCount?ge._events=new de:delete ge._events[Te]}function K(){this._events=new de,this._eventsCount=0}Object.create&&(de.prototype=Object.create(null),(new de).__proto__||(xe=!1)),K.prototype.eventNames=function(){var Pe,Fe,Te=[];if(0===this._eventsCount)return Te;for(Fe in Pe=this._events)rt.call(Pe,Fe)&&Te.push(xe?Fe.slice(1):Fe);return Object.getOwnPropertySymbols?Te.concat(Object.getOwnPropertySymbols(Pe)):Te},K.prototype.listeners=function(Te){var Fe=this._events[xe?xe+Te:Te];if(!Fe)return[];if(Fe.fn)return[Fe.fn];for(var bt=0,nt=Fe.length,He=new Array(nt);bt<nt;bt++)He[bt]=Fe[bt].fn;return He},K.prototype.listenerCount=function(Te){var Fe=this._events[xe?xe+Te:Te];return Fe?Fe.fn?1:Fe.length:0},K.prototype.emit=function(Te,Pe,Fe,bt,nt,He){var dt=xe?xe+Te:Te;if(!this._events[dt])return!1;var X,re,Rt=this._events[dt],ae=arguments.length;if(Rt.fn){switch(Rt.once&&this.removeListener(Te,Rt.fn,void 0,!0),ae){case 1:return Rt.fn.call(Rt.context),!0;case 2:return Rt.fn.call(Rt.context,Pe),!0;case 3:return Rt.fn.call(Rt.context,Pe,Fe),!0;case 4:return Rt.fn.call(Rt.context,Pe,Fe,bt),!0;case 5:return Rt.fn.call(Rt.context,Pe,Fe,bt,nt),!0;case 6:return Rt.fn.call(Rt.context,Pe,Fe,bt,nt,He),!0}for(re=1,X=new Array(ae-1);re<ae;re++)X[re-1]=arguments[re];Rt.fn.apply(Rt.context,X)}else{var te,Q=Rt.length;for(re=0;re<Q;re++)switch(Rt[re].once&&this.removeListener(Te,Rt[re].fn,void 0,!0),ae){case 1:Rt[re].fn.call(Rt[re].context);break;case 2:Rt[re].fn.call(Rt[re].context,Pe);break;case 3:Rt[re].fn.call(Rt[re].context,Pe,Fe);break;case 4:Rt[re].fn.call(Rt[re].context,Pe,Fe,bt);break;default:if(!X)for(te=1,X=new Array(ae-1);te<ae;te++)X[te-1]=arguments[te];Rt[re].fn.apply(Rt[re].context,X)}}return!0},K.prototype.on=function(Te,Pe,Fe){return Ce(this,Te,Pe,Fe,!1)},K.prototype.once=function(Te,Pe,Fe){return Ce(this,Te,Pe,Fe,!0)},K.prototype.removeListener=function(Te,Pe,Fe,bt){var nt=xe?xe+Te:Te;if(!this._events[nt])return this;if(!Pe)return p(this,nt),this;var He=this._events[nt];if(He.fn)He.fn===Pe&&(!bt||He.once)&&(!Fe||He.context===Fe)&&p(this,nt);else{for(var dt=0,Rt=[],ae=He.length;dt<ae;dt++)(He[dt].fn!==Pe||bt&&!He[dt].once||Fe&&He[dt].context!==Fe)&&Rt.push(He[dt]);Rt.length?this._events[nt]=1===Rt.length?Rt[0]:Rt:p(this,nt)}return this},K.prototype.removeAllListeners=function(Te){var Pe;return Te?this._events[Pe=xe?xe+Te:Te]&&p(this,Pe):(this._events=new de,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=xe,K.EventEmitter=K,Lt.exports=K},7075:(Lt,rt,xe)=>{"use strict";var de=xe(4703),ye=xe(9801),Ce=xe(4313),p=xe(1836),K=xe(497),ge={},Te=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];ge.forwardGeocode=function(Pe){ye.assertShape({query:ye.required(ye.string),mode:ye.oneOf("mapbox.places","mapbox.places-permanent"),countries:ye.arrayOf(ye.string),proximity:ye.oneOf(ye.coordinates,"ip"),types:ye.arrayOf(ye.oneOf(Te)),autocomplete:ye.boolean,bbox:ye.arrayOf(ye.number),limit:ye.number,language:ye.arrayOf(ye.string),routing:ye.boolean,fuzzyMatch:ye.boolean,worldview:ye.string})(Pe),Pe.mode=Pe.mode||"mapbox.places";var Fe=p(de({country:Pe.countries},Ce(Pe,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ce(Pe,["mode","query"]),query:Fe})},ge.reverseGeocode=function(Pe){ye.assertShape({query:ye.required(ye.coordinates),mode:ye.oneOf("mapbox.places","mapbox.places-permanent"),countries:ye.arrayOf(ye.string),types:ye.arrayOf(ye.oneOf(Te)),bbox:ye.arrayOf(ye.number),limit:ye.number,language:ye.arrayOf(ye.string),reverseMode:ye.oneOf("distance","score"),routing:ye.boolean,worldview:ye.string})(Pe),Pe.mode=Pe.mode||"mapbox.places";var Fe=p(de({country:Pe.countries},Ce(Pe,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ce(Pe,["mode","query"]),query:Fe})},Lt.exports=K(ge)},497:(Lt,rt,xe)=>{"use strict";var de=xe(4176),ye=xe(7454);Lt.exports=function Ce(p){return function(K){var ge;ge=de.prototype.isPrototypeOf(K)?K:ye(K);var Te=Object.create(p);return Te.client=ge,Te}}},5621:Lt=>{"use strict";Lt.exports=function rt(xe,de){return Object.keys(xe).reduce(function(ye,Ce){return ye[Ce]=de(Ce,xe[Ce]),ye},{})}},4313:Lt=>{"use strict";Lt.exports=function rt(xe,de){var ye=function(Ce,p){return-1!==de.indexOf(Ce)&&void 0!==p};return"function"==typeof de&&(ye=de),Object.keys(xe).filter(function(Ce){return ye(Ce,xe[Ce])}).reduce(function(Ce,p){return Ce[p]=xe[p],Ce},{})}},1836:(Lt,rt,xe)=>{"use strict";var de=xe(5621);Lt.exports=function ye(Ce){return de(Ce,function(p,K){return"boolean"==typeof K?JSON.stringify(K):K})}},9801:(Lt,rt,xe)=>{"use strict";var de=xe(4703),ye=xe(6089);Lt.exports=de(ye,{file:function Ce(Te){return typeof window<"u"?Te instanceof global.Blob||Te instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Te&&void 0===Te.pipe?"Filename or Readable stream":void 0},date:function K(Te){var Pe="date";if("boolean"==typeof Te)return Pe;try{var Fe=new Date(Te);if(Fe.getTime&&isNaN(Fe.getTime()))return Pe}catch{return Pe}},coordinates:function ge(Te){return ye.tuple(ye.number,ye.number)(Te)},assertShape:function p(Te,Pe){return ye.assert(ye.strictShape(Te),Pe)}})},8129:(Lt,rt,xe)=>{"use strict";var de=xe(2049),ye={};function K(ge,Te){return Object.prototype.hasOwnProperty.call(ge,Te)}Lt.exports=function Ce(ge){if(ye[ge])return ye[ge];var Te=ge.split("."),Pe=Te[0],Fe=Te[1];if(!Fe)throw new Error("Invalid token");var bt=function p(ge){try{return JSON.parse(de.decode(ge))}catch{throw new Error("Invalid token")}}(Fe),nt={usage:Pe,user:bt.u};return K(bt,"a")&&(nt.authorization=bt.a),K(bt,"exp")&&(nt.expires=1e3*bt.exp),K(bt,"iat")&&(nt.created=1e3*bt.iat),K(bt,"scopes")&&(nt.scopes=bt.scopes),K(bt,"client")&&(nt.client=bt.client),K(bt,"ll")&&(nt.lastLogin=bt.ll),K(bt,"iu")&&(nt.impersonator=bt.iu),ye[ge]=nt,nt}},3659:(Lt,rt,xe)=>{"use strict";function de(t){return"function"==typeof t}function ye(t){const n=t(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Ce=ye(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(t,e){if(t){const n=t.indexOf(e);0<=n&&t.splice(n,1)}}class K{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const s of n)s.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(de(r))try{r()}catch(s){e=s instanceof Ce?s.errors:[s]}const{_teardowns:i}=this;if(i){this._teardowns=null;for(const s of i)try{Pe(s)}catch(f){e=e??[],f instanceof Ce?e=[...e,...f.errors]:e.push(f)}}if(e)throw new Ce(e)}}add(e){var n;if(e&&e!==this)if(this.closed)Pe(e);else{if(e instanceof K){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(e)}}_hasParent(e){const{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){const{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&p(n,e)}remove(e){const{_teardowns:n}=this;n&&p(n,e),e instanceof K&&e._removeParent(this)}}K.EMPTY=(()=>{const t=new K;return t.closed=!0,t})();const ge=K.EMPTY;function Te(t){return t instanceof K||t&&"closed"in t&&de(t.remove)&&de(t.add)&&de(t.unsubscribe)}function Pe(t){de(t)?t():t.unsubscribe()}const Fe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},bt={setTimeout(...t){const{delegate:e}=bt;return(e?.setTimeout||setTimeout)(...t)},clearTimeout(t){const{delegate:e}=bt;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function nt(t){bt.setTimeout(()=>{const{onUnhandledError:e}=Fe;if(!e)throw t;e(t)})}function He(){}const dt=X("C",void 0,void 0);function X(t,e,n){return{kind:t,value:e,error:n}}let re=null;function Q(t){if(Fe.useDeprecatedSynchronousErrorHandling){const e=!re;if(e&&(re={errorThrown:!1,error:null}),t(),e){const{errorThrown:n,error:r}=re;if(re=null,n)throw r}}else t()}class ue extends K{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Te(e)&&e.add(this)):this.destination=ct}static create(e,n,r){return new oe(e,n,r)}next(e){this.isStopped?ne(function ae(t){return X("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?ne(function Rt(t){return X("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?ne(dt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class oe extends ue{constructor(e,n,r){let i;if(super(),de(e))i=e;else if(e){let s;({next:i,error:n,complete:r}=e),this&&Fe.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe()):s=e,i=i?.bind(s),n=n?.bind(s),r=r?.bind(s)}this.destination={next:i?le(i):He,error:le(n??me),complete:r?le(r):He}}}function le(t,e){return(...n)=>{try{t(...n)}catch(r){Fe.useDeprecatedSynchronousErrorHandling?function te(t){Fe.useDeprecatedSynchronousErrorHandling&&re&&(re.errorThrown=!0,re.error=t)}(r):nt(r)}}}function me(t){throw t}function ne(t,e){const{onStoppedNotification:n}=Fe;n&&bt.setTimeout(()=>n(t,e))}const ct={closed:!0,next:He,error:me,complete:He},je="function"==typeof Symbol&&Symbol.observable||"@@observable";function We(t){return t}function ln(t){return 0===t.length?We:1===t.length?t[0]:function(n){return t.reduce((r,i)=>i(r),n)}}let Bt=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new t;return r.source=this,r.operator=n,r}subscribe(n,r,i){const s=function Xe(t){return t&&t instanceof ue||function Tt(t){return t&&de(t.next)&&de(t.error)&&de(t.complete)}(t)&&Te(t)}(n)?n:new oe(n,r,i);return Q(()=>{const{operator:f,source:g}=this;s.add(f?f.call(s,g):g?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=$e(r))((i,s)=>{let f;f=this.subscribe(g=>{try{n(g)}catch(v){s(v),f?.unsubscribe()}},s,i)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[je](){return this}pipe(...n){return ln(n)(this)}toPromise(n){return new(n=$e(n))((r,i)=>{let s;this.subscribe(f=>s=f,f=>i(f),()=>r(s))})}}return t.create=e=>new t(e),t})();function $e(t){var e;return null!==(e=t??Fe.Promise)&&void 0!==e?e:Promise}const gt=ye(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let xt=(()=>{class t extends Bt{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new Be(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new gt}next(n){Q(()=>{if(this._throwIfClosed(),!this.isStopped){const r=this.observers.slice();for(const i of r)i.next(n)}})}error(n){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:i,observers:s}=this;return r||i?ge:(s.push(n),new K(()=>p(s,n)))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:i,isStopped:s}=this;r?n.error(i):s&&n.complete()}asObservable(){const n=new Bt;return n.source=this,n}}return t.create=(e,n)=>new Be(e,n),t})();class Be extends xt{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,e)}error(e){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,e)}complete(){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===n||n.call(e)}_subscribe(e){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(e))&&void 0!==r?r:ge}}function qt(t){return de(t?.lift)}function $t(t){return e=>{if(qt(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}class pn extends ue{constructor(e,n,r,i,s){super(e),this.onFinalize=s,this._next=n?function(f){try{n(f)}catch(g){e.error(g)}}:super._next,this._error=i?function(f){try{i(f)}catch(g){e.error(g)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(f){e.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:n}=this;super.unsubscribe(),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function At(t,e){return $t((n,r)=>{let i=0;n.subscribe(new pn(r,s=>{r.next(t.call(e,s,i++))}))})}function St(t){return this instanceof St?(this.v=t,this):new St(t)}function Jt(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(t,e||[]),s=[];return i={},f("next"),f("throw"),f("return"),i[Symbol.asyncIterator]=function(){return this},i;function f(L){r[L]&&(i[L]=function(B){return new Promise(function(ee,se){s.push([L,B,ee,se])>1||g(L,B)})})}function g(L,B){try{!function v(L){L.value instanceof St?Promise.resolve(L.value.v).then(x,M):R(s[0][2],L)}(r[L](B))}catch(ee){R(s[0][3],ee)}}function x(L){g("next",L)}function M(L){g("throw",L)}function R(L,B){L(B),s.shift(),s.length&&g(s[0][0],s[0][1])}}function vn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,e=t[Symbol.asyncIterator];return e?e.call(t):(t=function Nt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(f){return new Promise(function(g,v){!function i(s,f,g,v){Promise.resolve(v).then(function(x){s({value:x,done:g})},f)}(g,v,(f=t[s](f)).done,f.value)})}}}const li=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function gi(t){return de(t?.then)}function oo(t){return de(t[je])}function xo(t){return Symbol.asyncIterator&&de(t?.[Symbol.asyncIterator])}function eo(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Bs=function wo(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Li(t){return de(t?.[Bs])}function ra(t){return Jt(this,arguments,function*(){const n=t.getReader();try{for(;;){const{value:r,done:i}=yield St(n.read());if(i)return yield St(void 0);yield yield St(r)}}finally{n.releaseLock()}})}function Ls(t){return de(t?.getReader)}function Tn(t){if(t instanceof Bt)return t;if(null!=t){if(oo(t))return function il(t){return new Bt(e=>{const n=t[je]();if(de(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(li(t))return function va(t){return new Bt(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}(t);if(gi(t))return function Fr(t){return new Bt(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,nt)})}(t);if(xo(t))return Is(t);if(Li(t))return function Ua(t){return new Bt(e=>{for(const n of t)if(e.next(n),e.closed)return;e.complete()})}(t);if(Ls(t))return function Va(t){return Is(ra(t))}(t)}throw eo(t)}function Is(t){return new Bt(e=>{(function Ze(t,e){var n,r,i,s;return function Ei(t,e,n,r){return new(n||(n=Promise))(function(s,f){function g(M){try{x(r.next(M))}catch(R){f(R)}}function v(M){try{x(r.throw(M))}catch(R){f(R)}}function x(M){M.done?s(M.value):function i(s){return s instanceof n?s:new n(function(f){f(s)})}(M.value).then(g,v)}x((r=r.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){try{for(n=vn(t);!(r=yield n.next()).done;)if(e.next(r.value),e.closed)return}catch(f){i={error:f}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}e.complete()})})(t,e).catch(n=>e.error(n))})}function ce(t,e,n,r=0,i=!1){const s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function ze(t,e,n=1/0){return de(e)?ze((r,i)=>At((s,f)=>e(r,s,i,f))(Tn(t(r,i))),n):("number"==typeof e&&(n=e),$t((r,i)=>function be(t,e,n,r,i,s,f,g){const v=[];let x=0,M=0,R=!1;const L=()=>{R&&!v.length&&!x&&e.complete()},B=se=>x<r?ee(se):v.push(se),ee=se=>{s&&e.next(se),x++;let Oe=!1;Tn(n(se,M++)).subscribe(new pn(e,Ee=>{i?.(Ee),s?B(Ee):e.next(Ee)},()=>{Oe=!0},void 0,()=>{if(Oe)try{for(x--;v.length&&x<r;){const Ee=v.shift();f?ce(e,f,()=>ee(Ee)):ee(Ee)}L()}catch(Ee){e.error(Ee)}}))};return t.subscribe(new pn(e,B,()=>{R=!0,L()})),()=>{g?.()}}(r,i,t,n)))}function et(t=1/0){return ze(We,t)}const yt=new Bt(t=>t.complete());function ht(t){return t&&de(t.schedule)}function zt(t){return t[t.length-1]}function Fn(t){return ht(zt(t))?t.pop():void 0}function yr(t,e=0){return $t((n,r)=>{n.subscribe(new pn(r,i=>ce(r,t,()=>r.next(i),e),()=>ce(r,t,()=>r.complete(),e),i=>ce(r,t,()=>r.error(i),e)))})}function ir(t,e=0){return $t((n,r)=>{r.add(t.schedule(()=>n.subscribe(r),e))})}function nr(t,e){if(!t)throw new Error("Iterable cannot be null");return new Bt(n=>{ce(n,e,()=>{const r=t[Symbol.asyncIterator]();ce(n,e,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function Wi(t,e){return e?function Zr(t,e){if(null!=t){if(oo(t))return function xr(t,e){return Tn(t).pipe(ir(e),yr(e))}(t,e);if(li(t))return function Dr(t,e){return new Bt(n=>{let r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}(t,e);if(gi(t))return function _r(t,e){return Tn(t).pipe(ir(e),yr(e))}(t,e);if(xo(t))return nr(t,e);if(Li(t))return function Vr(t,e){return new Bt(n=>{let r;return ce(n,e,()=>{r=t[Bs](),ce(n,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(f){return void n.error(f)}s?n.complete():n.next(i)},0,!0)}),()=>de(r?.return)&&r.return()})}(t,e);if(Ls(t))return function Pi(t,e){return nr(ra(t),e)}(t,e)}throw eo(t)}(t,e):Tn(t)}function Xi(...t){const e=Fn(t),n=function mn(t,e){return"number"==typeof zt(t)?t.pop():e}(t,1/0),r=t;return r.length?1===r.length?Tn(r[0]):et(n)(Wi(r,e)):yt}function Yt(t){return t<=0?()=>yt:$t((e,n)=>{let r=0;e.subscribe(new pn(n,i=>{++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function so(t,e,...n){return!0===e?(t(),null):!1===e?null:e(...n).pipe(Yt(1)).subscribe(()=>t())}function di(t){for(let e in t)if(t[e]===di)return e;throw Error("Could not find renamed property on target object.")}function Qu(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function Ni(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Ni).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function ol(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const xc=di({__forward_ref__:di});function ao(t){return t.__forward_ref__=ao,t.toString=function(){return Ni(this())},t}function hn(t){return Qr(t)?t():t}function Qr(t){return"function"==typeof t&&t.hasOwnProperty(xc)&&t.__forward_ref__===ao}class On extends Error{constructor(e,n){super(function k(t,e){return`NG0${Math.abs(t)}${e?": "+e.trim():""}`}(e,n)),this.code=e}}function G(t){return"string"==typeof t?t:null==t?"":String(t)}function Dt(t,e){throw new On(-201,!1)}function Gr(t,e){null==t&&function vi(t,e,n,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${n} ${r} ${e} <=Actual]`))}(e,t,null,"!=")}function zn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ms(t){return{providers:t.providers||[],imports:t.imports||[]}}function bs(t){return $l(t,xa)||$l(t,Cl)}function $l(t,e){return t.hasOwnProperty(e)?t[e]:null}function ou(t){return t&&(t.hasOwnProperty(ql)||t.hasOwnProperty(Sl))?t[ql]:null}const xa=di({\u0275prov:di}),ql=di({\u0275inj:di}),Cl=di({ngInjectableDef:di}),Sl=di({ngInjectorDef:di});var fr=(()=>((fr=fr||{})[fr.Default=0]="Default",fr[fr.Host=1]="Host",fr[fr.Self=2]="Self",fr[fr.SkipSelf=4]="SkipSelf",fr[fr.Optional=8]="Optional",fr))();let Gu;function xi(t){const e=Gu;return Gu=t,e}function Es(t,e,n){const r=bs(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&fr.Optional?null:void 0!==e?e:void Dt(Ni(t))}function ms(t){return{toString:t}.toString()}var ia=(()=>((ia=ia||{})[ia.OnPush=0]="OnPush",ia[ia.Default=1]="Default",ia))(),bo=(()=>{return(t=bo||(bo={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",bo;var t})();const Zi=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),oa={},Ri=[],go=di({\u0275cmp:di}),wr=di({\u0275dir:di}),wc=di({\u0275pipe:di}),gl=di({\u0275mod:di}),Ur=di({\u0275fac:di}),ea=di({__NG_ELEMENT_ID__:di});let Hl=0;function ja(t){return ms(()=>{const n=!0===t.standalone,r={},i={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===ia.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&t.dependencies||null,getStandaloneInjector:null,selectors:t.selectors||Ri,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||bo.Emulated,id:"c"+Hl++,styles:t.styles||Ri,_:null,setInput:null,schemas:t.schemas||null,tView:null},s=t.dependencies,f=t.features;return i.inputs=$u(t.inputs,r),i.outputs=$u(t.outputs),f&&f.forEach(g=>g(i)),i.directiveDefs=s?()=>("function"==typeof s?s():s).map(bc).filter(ki):null,i.pipeDefs=s?()=>("function"==typeof s?s():s).map(er).filter(ki):null,i})}function bc(t){return ur(t)||Eo(t)}function ki(t){return null!==t}function ls(t){return ms(()=>({type:t.type,bootstrap:t.bootstrap||Ri,declarations:t.declarations||Ri,imports:t.imports||Ri,exports:t.exports||Ri,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function $u(t,e){if(null==t)return oa;const n={};for(const r in t)if(t.hasOwnProperty(r)){let i=t[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,e&&(e[i]=s)}return n}const Fi=ja;function ur(t){return t[go]||null}function Eo(t){return t[wr]||null}function er(t){return t[wc]||null}function Ji(t,e){const n=t[gl]||null;if(!n&&!0===e)throw new Error(`Type ${Ni(t)} does not have '\u0275mod' property.`);return n}function Gi(t){return Array.isArray(t)&&"object"==typeof t[1]}function Qi(t){return Array.isArray(t)&&!0===t[1]}function Bi(t){return 0!=(8&t.flags)}function cs(t){return 2==(2&t.flags)}function So(t){return 1==(1&t.flags)}function io(t){return null!==t.template}function ta(t){return 0!=(256&t[2])}function ho(t,e){return t.hasOwnProperty(Ur)?t[Ur]:null}class Ra{constructor(e,n,r){this.previousValue=e,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function Yl(t){return t.type.prototype.ngOnChanges&&(t.setInput=Dl),el}function el(){const t=ll(this),e=t?.current;if(e){const n=t.previous;if(n===oa)t.previous=e;else for(let r in e)n[r]=e[r];t.current=null,this.ngOnChanges(e)}}function Dl(t,e,n,r){const i=ll(t)||function As(t,e){return t[sa]=e}(t,{previous:oa,current:null}),s=i.current||(i.current={}),f=i.previous,g=this.declaredInputs[n],v=f[g];s[g]=new Ra(v&&v.currentValue,e,f===oa),t[r]=e}const sa="__ngSimpleChanges__";function ll(t){return t[sa]||null}function $i(t){for(;Array.isArray(t);)t=t[0];return t}function tl(t,e){return $i(e[t.index])}function Fc(t,e){return t.data[e]}function hs(t,e){const n=e[t];return Gi(n)?n:n[0]}function lf(t){return 64==(64&t[2])}function Ea(t,e){return null==e?null:t[e]}function nc(t){t[18]=0}function Ou(t,e){t[5]+=e;let n=t,r=t[3];for(;null!==r&&(1===e&&1===n[5]||-1===e&&0===n[5]);)r[5]+=e,n=r,r=r[3]}const mi={lFrame:Ff(null),bindingsEnabled:!0};function ti(){return mi.bindingsEnabled}function Dn(){return mi.lFrame.lView}function si(){return mi.lFrame.tView}function Oi(){let t=uf();for(;null!==t&&64===t.type;)t=t.parent;return t}function uf(){return mi.lFrame.currentTNode}function l(t,e){const n=mi.lFrame;n.currentTNode=t,n.isParent=e}function h(){return mi.lFrame.isParent}function vt(){return mi.lFrame.bindingIndex++}function hr(t,e){const n=mi.lFrame;n.bindingIndex=n.bindingRootIndex=t,to(e)}function to(t){mi.lFrame.currentDirectiveIndex=t}function Ps(t){const e=mi.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}function ka(){return mi.lFrame.currentQueryIndex}function Pl(t){mi.lFrame.currentQueryIndex=t}function ku(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function Sc(t,e,n){if(n&fr.SkipSelf){let i=e,s=t;for(;!(i=i.parent,null!==i||n&fr.Host||(i=ku(s),null===i||(s=s[15],10&i.type))););if(null===i)return!1;e=i,t=s}const r=mi.lFrame=Dh();return r.currentTNode=e,r.lView=t,!0}function cf(t){const e=Dh(),n=t[1];mi.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function Dh(){const t=mi.lFrame,e=null===t?null:t.child;return null===e?Ff(t):e}function Ff(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function xp(){const t=mi.lFrame;return mi.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const wp=xp;function Bf(){const t=xp();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Kl(){return mi.lFrame.selectedIndex}function Tc(t){mi.lFrame.selectedIndex=t}function ma(){const t=mi.lFrame;return Fc(t.tView,t.selectedIndex)}function c(t,e){for(let n=e.directiveStart,r=e.directiveEnd;n<r;n++){const s=t.data[n].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:g,ngAfterViewInit:v,ngAfterViewChecked:x,ngOnDestroy:M}=s;f&&(t.contentHooks||(t.contentHooks=[])).push(-n,f),g&&((t.contentHooks||(t.contentHooks=[])).push(n,g),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,g)),v&&(t.viewHooks||(t.viewHooks=[])).push(-n,v),x&&((t.viewHooks||(t.viewHooks=[])).push(n,x),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,x)),null!=M&&(t.destroyHooks||(t.destroyHooks=[])).push(n,M)}}function m(t,e,n){P(t,e,3,n)}function C(t,e,n,r){(3&t[2])===n&&P(t,e,n,r)}function T(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function P(t,e,n,r){const s=r??-1,f=e.length-1;let g=0;for(let v=void 0!==r?65535&t[18]:0;v<f;v++)if("number"==typeof e[v+1]){if(g=e[v],null!=r&&g>=r)break}else e[v]<0&&(t[18]+=65536),(g<s||-1==s)&&(F(t,n,e,v),t[18]=(4294901760&t[18])+v+2),v++}function F(t,e,n,r){const i=n[r]<0,s=n[r+1],g=t[i?-n[r]:n[r]];if(i){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{s.call(g)}finally{}}}else try{s.call(g)}finally{}}const z=-1;class j{constructor(e,n,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function Ie(t,e,n){let r=0;for(;r<n.length;){const i=n[r];if("number"==typeof i){if(0!==i)break;r++;const s=n[r++],f=n[r++],g=n[r++];t.setAttribute(e,f,g,s)}else{const s=i,f=n[++r];Je(s)?t.setProperty(e,s,f):t.setAttribute(e,s,f),r++}}return r}function tt(t){return 3===t||4===t||6===t}function Je(t){return 64===t.charCodeAt(0)}function ot(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?n=i:0===n||Ct(t,n,i,null,-1===n||2===n?e[++r]:null)}}return t}function Ct(t,e,n,r,i){let s=0,f=t.length;if(-1===e)f=-1;else for(;s<t.length;){const g=t[s++];if("number"==typeof g){if(g===e){f=-1;break}if(g>e){f=s-1;break}}}for(;s<t.length;){const g=t[s];if("number"==typeof g)break;if(g===n){if(null===r)return void(null!==i&&(t[s+1]=i));if(r===t[s+1])return void(t[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==f&&(t.splice(f,0,e),s=f+1),t.splice(s++,0,n),null!==r&&t.splice(s++,0,r),null!==i&&t.splice(s++,0,i)}function _t(t){return t!==z}function It(t){return 32767&t}function Wt(t,e){let n=function jt(t){return t>>16}(t),r=e;for(;n>0;)r=r[15],n--;return r}let Qt=!0;function Bn(t){const e=Qt;return Qt=t,e}let An=0;const Ht={};function en(t,e){const n=Pn(t,e);if(-1!==n)return n;const r=e[1];r.firstCreatePass&&(t.injectorIndex=e.length,xn(r.data,t),xn(e,null),xn(r.blueprint,null));const i=br(t,e),s=t.injectorIndex;if(_t(i)){const f=It(i),g=Wt(i,e),v=g[1].data;for(let x=0;x<8;x++)e[s+x]=g[f+x]|v[f+x]}return e[s+8]=i,s}function xn(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Pn(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function br(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,r=null,i=e;for(;null!==i;){if(r=ya(i),null===r)return z;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return z}function wi(t,e,n){!function Vt(t,e,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(ea)&&(r=n[ea]),null==r&&(r=n[ea]=An++);const i=255&r;e.data[t+(i>>5)]|=1<<i}(t,e,n)}function or(t,e,n){if(n&fr.Optional||void 0!==t)return t;Dt()}function Ir(t,e,n,r){if(n&fr.Optional&&void 0===r&&(r=null),0==(n&(fr.Self|fr.Host))){const i=t[9],s=xi(void 0);try{return i?i.get(e,r,n&fr.Optional):Es(e,r,n&fr.Optional)}finally{xi(s)}}return or(r,0,n)}function qi(t,e,n,r=fr.Default,i){if(null!==t){if(1024&e[2]){const f=function yo(t,e,n,r,i){let s=t,f=e;for(;null!==s&&null!==f&&1024&f[2]&&!(256&f[2]);){const g=Br(s,f,n,r|fr.Self,Ht);if(g!==Ht)return g;let v=s.parent;if(!v){const x=f[21];if(x){const M=x.get(n,Ht,r);if(M!==Ht)return M}v=ya(f),f=f[15]}s=v}return i}(t,e,n,r,Ht);if(f!==Ht)return f}const s=Br(t,e,n,r,Ht);if(s!==Ht)return s}return Ir(e,n,r,i)}function Br(t,e,n,r,i){const s=function Rs(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(ea)?t[ea]:void 0;return"number"==typeof e?e>=0?255&e:Bc:e}(n);if("function"==typeof s){if(!Sc(e,t,r))return r&fr.Host?or(i,0,r):Ir(e,n,r,i);try{const f=s(r);if(null!=f||r&fr.Optional)return f;Dt()}finally{wp()}}else if("number"==typeof s){let f=null,g=Pn(t,e),v=z,x=r&fr.Host?e[16][6]:null;for((-1===g||r&fr.SkipSelf)&&(v=-1===g?br(t,e):e[g+8],v!==z&&cu(r,!1)?(f=e[1],g=It(v),e=Wt(v,e)):g=-1);-1!==g;){const M=e[1];if(Fa(s,g,M.data)){const R=ns(g,e,n,f,r,x);if(R!==Ht)return R}v=e[g+8],v!==z&&cu(r,e[1].data[g+8]===x)&&Fa(s,g,e)?(f=M,g=It(v),e=Wt(v,e)):g=-1}}return i}function ns(t,e,n,r,i,s){const f=e[1],g=f.data[t+8],M=rs(g,f,n,null==r?cs(g)&&Qt:r!=f&&0!=(3&g.type),i&fr.Host&&s===g);return null!==M?fs(e,f,M,g):Ht}function rs(t,e,n,r,i){const s=t.providerIndexes,f=e.data,g=1048575&s,v=t.directiveStart,M=s>>20,L=i?g+M:t.directiveEnd;for(let B=r?g:g+M;B<L;B++){const ee=f[B];if(B<v&&n===ee||B>=v&&ee.type===n)return B}if(i){const B=f[v];if(B&&io(B)&&B.type===n)return v}return null}function fs(t,e,n,r){let i=t[n];const s=e.data;if(function W(t){return t instanceof j}(i)){const f=i;f.resolving&&function st(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new On(-200,`Circular dependency in DI detected for ${t}${n}`)}(function we(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():G(t)}(s[n]));const g=Bn(f.canSeeViewProviders);f.resolving=!0;const v=f.injectImpl?xi(f.injectImpl):null;Sc(t,r,fr.Default);try{i=t[n]=f.factory(void 0,s,t,r),e.firstCreatePass&&n>=r.directiveStart&&function b(t,e,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){const f=Yl(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,f),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,f)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,s))}(n,s[n],e)}finally{null!==v&&xi(v),Bn(g),f.resolving=!1,wp()}}return i}function Fa(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function cu(t,e){return!(t&fr.Self||t&fr.Host&&e)}class Jl{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,r){return qi(this._tNode,this._lView,e,r,n)}}function Bc(){return new Jl(Oi(),Dn())}function xs(t){return Qr(t)?()=>{const e=xs(hn(t));return e&&e()}:ho(t)}function ya(t){const e=t[1],n=e.type;return 2===n?e.declTNode:1===n?t[6]:null}const Ha="__parameters__";function _l(t,e,n){return ms(()=>{const r=function ih(t){return function(...n){if(t){const r=t(...n);for(const i in r)this[i]=r[i]}}}(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;const f=new i(...s);return g.annotation=f,g;function g(v,x,M){const R=v.hasOwnProperty(Ha)?v[Ha]:Object.defineProperty(v,Ha,{value:[]})[Ha];for(;R.length<=M;)R.push(null);return(R[M]=R[M]||[]).push(f),v}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i})}class Er{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=zn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Rl(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let r=t[n];Array.isArray(r)?(e===t&&(e=t.slice(0,n)),Rl(r,e)):e!==t&&e.push(r)}return e}function Ph(t,e){t.forEach(n=>Array.isArray(n)?Ph(n,e):e(n))}function Dg(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Cd(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}const Ep={},gy="__NG_DI_FLAG__",Rg="ngTempTokenPath",Xv=/\n/gm,Ic="__source";let Cp;function Md(t){const e=Cp;return Cp=t,e}function Xa(t,e=fr.Default){if(void 0===Cp)throw new On(-203,!1);return null===Cp?Es(t,void 0,e):Cp.get(t,e&fr.Optional?null:void 0,e)}function Gt(t,e=fr.Default){return(function Da(){return Gu}()||Xa)(hn(t),e)}function _a(t,e=fr.Default){return"number"!=typeof e&&(e=0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)),Gt(t,e)}function bu(t){const e=[];for(let n=0;n<t.length;n++){const r=hn(t[n]);if(Array.isArray(r)){if(0===r.length)throw new On(900,!1);let i,s=fr.Default;for(let f=0;f<r.length;f++){const g=r[f],v=Zv(g);"number"==typeof v?-1===v?i=g.token:s|=v:i=g}e.push(Gt(i,s))}else e.push(Gt(r))}return e}function Dd(t,e){return t[gy]=e,t.prototype[gy]=e,t}function Zv(t){return t[gy]}const ah=Dd(_l("Optional"),8),jf=Dd(_l("SkipSelf"),4);var xl=(()=>((xl=xl||{})[xl.Important=1]="Important",xl[xl.DashCase=2]="DashCase",xl))();const Ld=new Map;let n0=0;const Rp="__ngContext__";function ul(t,e){Gi(e)?(t[Rp]=e[20],function vy(t){Ld.set(t[20],t)}(e)):t[Rp]=e}function Ty(t,e){return undefined(t,e)}function $f(t){const e=t[3];return Qi(e)?e[3]:e}function lc(t){return Ol(t[13])}function Fu(t){return Ol(t[4])}function Ol(t){for(;null!==t&&!Qi(t);)t=t[4];return t}function Za(t,e,n,r,i){if(null!=r){let s,f=!1;Qi(r)?s=r:Gi(r)&&(f=!0,r=r[0]);const g=$i(r);0===t&&null!==n?null==i?c0(e,n,g):Fh(e,n,g,i||null,!0):1===t&&null!==n?Fh(e,n,g,i||null,!0):2===t?function Wg(t,e,n){const r=fh(t,e);r&&function h0(t,e,n,r){t.removeChild(e,n,r)}(t,r,e,n)}(e,g,f):3===t&&e.destroyNode(g),null!=s&&function g0(t,e,n,r,i){const s=n[7];s!==$i(n)&&Za(e,t,r,s,i);for(let g=10;g<n.length;g++){const v=n[g];Fp(v[1],v,t,e,r,s)}}(e,t,s,n,i)}}function jg(t,e,n){return t.createElement(e,n)}function ff(t,e){const n=t[9],r=n.indexOf(e),i=e[3];512&e[2]&&(e[2]&=-513,Ou(i,-1)),n.splice(r,1)}function Bd(t,e){if(t.length<=10)return;const n=10+e,r=t[n];if(r){const i=r[17];null!==i&&i!==t&&ff(i,r),e>0&&(t[n-1][4]=r[4]);const s=Cd(t,10+e);!function Dy(t,e){Fp(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const f=s[19];null!==f&&f.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function Lp(t,e){if(!(128&e[2])){const n=e[11];n.destroyNode&&Fp(t,e,n,3,null,null),function a0(t){let e=t[13];if(!e)return Np(t[1],t);for(;e;){let n=null;if(Gi(e))n=e[13];else{const r=e[10];r&&(n=r)}if(!n){for(;e&&!e[4]&&e!==t;)Gi(e)&&Np(e[1],e),e=e[3];null===e&&(e=t),Gi(e)&&Np(e[1],e),n=e&&e[4]}e=n}}(e)}}function Np(t,e){if(!(128&e[2])){e[2]&=-65,e[2]|=128,function Yw(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let r=0;r<n.length;r+=2){const i=e[n[r]];if(!(i instanceof j)){const s=n[r+1];if(Array.isArray(s))for(let f=0;f<s.length;f+=2){const g=i[s[f]],v=s[f+1];try{v.call(g)}finally{}}else try{s.call(i)}finally{}}}}(t,e),function l0(t,e){const n=t.cleanup,r=e[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const f=n[s+1],g="function"==typeof f?f(e):$i(e[f]),v=r[i=n[s+2]],x=n[s+3];"boolean"==typeof x?g.removeEventListener(n[s],v,x):x>=0?r[i=x]():r[i=-x].unsubscribe(),s+=2}else{const f=r[i=n[s+1]];n[s].call(f)}if(null!==r){for(let s=i+1;s<r.length;s++)(0,r[s])();e[7]=null}}(t,e),1===e[1].type&&e[11].destroy();const n=e[17];if(null!==n&&Qi(e[3])){n!==e[3]&&ff(n,e);const r=e[19];null!==r&&r.detachView(t)}!function Gf(t){Ld.delete(t[20])}(e)}}function Py(t,e,n){return function u0(t,e,n){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return n[0];if(2&r.flags){const i=t.data[r.directiveStart].encapsulation;if(i===bo.None||i===bo.Emulated)return null}return tl(r,n)}(t,e.parent,n)}function Fh(t,e,n,r,i){t.insertBefore(e,n,r,i)}function c0(t,e,n){t.appendChild(e,n)}function Gg(t,e,n,r,i){null!==r?Fh(t,e,n,r,i):c0(t,e,n)}function fh(t,e){return t.parentNode(e)}let Yg,kp=function Hf(t,e,n){return 40&t.type?tl(t,n):null};function qg(t,e,n,r){const i=Py(t,r,e),s=e[11],g=function d0(t,e,n){return kp(t,e,n)}(r.parent||e[6],r,e);if(null!=i)if(Array.isArray(n))for(let v=0;v<n.length;v++)Gg(s,i,n[v],g,!1);else Gg(s,i,n,g,!1)}function Hg(t,e){if(null!==e){const n=e.type;if(3&n)return tl(e,t);if(4&n)return Ly(-1,t[e.index]);if(8&n){const r=e.child;if(null!==r)return Hg(t,r);{const i=t[e.index];return Qi(i)?Ly(-1,i):$i(i)}}if(32&n)return Ty(e,t)()||$i(t[e.index]);{const r=Oy(t,e);return null!==r?Array.isArray(r)?r[0]:Hg($f(t[16]),r):Hg(t,e.next)}}return null}function Oy(t,e){return null!==e?t[16][6].projection[e.projection]:null}function Ly(t,e){const n=10+t+1;if(n<e.length){const r=e[n],i=r[1].firstChild;if(null!==i)return Hg(r,i)}return e[7]}function Ny(t,e,n,r,i,s,f){for(;null!=n;){const g=r[n.index],v=n.type;if(f&&0===e&&(g&&ul($i(g),r),n.flags|=4),64!=(64&n.flags))if(8&v)Ny(t,e,n.child,r,i,s,!1),Za(e,t,i,g,s);else if(32&v){const x=Ty(n,r);let M;for(;M=x();)Za(e,t,i,M,s);Za(e,t,i,g,s)}else 16&v?ky(t,e,r,n,i,s):Za(e,t,i,g,s);n=f?n.projectionNext:n.next}}function Fp(t,e,n,r,i,s){Ny(n,r,t.firstChild,e,i,s,!1)}function ky(t,e,n,r,i,s){const f=n[16],v=f[6].projection[r.projection];if(Array.isArray(v))for(let x=0;x<v.length;x++)Za(e,t,i,v[x],s);else Ny(t,e,v,f[3],i,s,!0)}function dh(t,e,n){t.setAttribute(e,"style",n)}function Su(t,e,n){""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}const im=new Er("ENVIRONMENT_INITIALIZER"),Xy=new Er("INJECTOR",-1),Zy=new Er("INJECTOR_DEF_TYPES");class Yy{get(e,n=Ep){if(n===Ep){const r=new Error(`NullInjectorError: No provider for ${Ni(e)}!`);throw r.name="NullInjectorError",r}return n}}function I0(...t){return{\u0275providers:Ky(0,t)}}function Ky(t,...e){const n=[],r=new Set;let i;return Ph(e,s=>{const f=s;Jy(f,n,[],r)&&(i||(i=[]),i.push(f))}),void 0!==i&&M0(i,n),n}function M0(t,e){for(let n=0;n<t.length;n++){const{providers:i}=t[n];Ph(i,s=>{e.push(s)})}}function Jy(t,e,n,r){if(!(t=hn(t)))return!1;let i=null,s=ou(t);const f=!s&&ur(t);if(s||f){if(f&&!f.standalone)return!1;i=t}else{const v=t.ngModule;if(s=ou(v),!s)return!1;i=v}const g=r.has(i);if(f){if(g)return!1;if(r.add(i),f.dependencies){const v="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const x of v)Jy(x,e,n,r)}}else{if(!s)return!1;{if(null!=s.imports&&!g){let x;r.add(i);try{Ph(s.imports,M=>{Jy(M,e,n,r)&&(x||(x=[]),x.push(M))})}finally{}void 0!==x&&M0(x,e)}if(!g){const x=ho(i)||(()=>new i);e.push({provide:i,useFactory:x,deps:Ri},{provide:Zy,useValue:i,multi:!0},{provide:im,useValue:()=>Gt(i),multi:!0})}const v=s.providers;null==v||g||Ph(v,M=>{e.push(M)})}}return i!==t&&void 0!==t.providers}const om=di({provide:String,useValue:di});function sm(t){return null!==t&&"object"==typeof t&&om in t}function Rc(t){return"function"==typeof t}const am=new Er("Set Injector scope."),Hp={},pb={};let Qy;function lm(){return void 0===Qy&&(Qy=new Yy),Qy}class pf{}class D0 extends pf{constructor(e,n,r,i){super(),this.parent=n,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,n_(e,f=>this.processProvider(f)),this.records.set(Xy,Kf(void 0,this)),i.has("environment")&&this.records.set(pf,Kf(void 0,this));const s=this.records.get(am);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Zy.multi,Ri,fr.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const n=Md(this),r=xi(void 0);try{return e()}finally{Md(n),xi(r)}}get(e,n=Ep,r=fr.Default){this.assertNotDestroyed();const i=Md(this),s=xi(void 0);try{if(!(r&fr.SkipSelf)){let g=this.records.get(e);if(void 0===g){const v=function yb(t){return"function"==typeof t||"object"==typeof t&&t instanceof Er}(e)&&bs(e);g=v&&this.injectableDefInScope(v)?Kf(e_(e),Hp):null,this.records.set(e,g)}if(null!=g)return this.hydrate(e,g)}return(r&fr.Self?lm():this.parent).get(e,n=r&fr.Optional&&n===Ep?null:n)}catch(f){if("NullInjectorError"===f.name){if((f[Rg]=f[Rg]||[]).unshift(Ni(e)),i)throw f;return function Gc(t,e,n,r){const i=t[Rg];throw e[Ic]&&i.unshift(e[Ic]),t.message=function my(t,e,n,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let i=Ni(e);if(Array.isArray(e))i=e.map(Ni).join(" -> ");else if("object"==typeof e){let s=[];for(let f in e)if(e.hasOwnProperty(f)){let g=e[f];s.push(f+":"+("string"==typeof g?JSON.stringify(g):Ni(g)))}i=`{${s.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${t.replace(Xv,"\n  ")}`}("\n"+t.message,i,n,r),t.ngTokenPath=i,t[Rg]=null,t}(f,e,"R3InjectorError",this.source)}throw f}finally{xi(s),Md(i)}}resolveInjectorInitializers(){const e=Md(this),n=xi(void 0);try{const r=this.get(im.multi,Ri,fr.Self);for(const i of r)i()}finally{Md(e),xi(n)}}toString(){const e=[],n=this.records;for(const r of n.keys())e.push(Ni(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new On(205,!1)}processProvider(e){let n=Rc(e=hn(e))?e:hn(e&&e.provide);const r=function gb(t){return sm(t)?Kf(void 0,t.useValue):Kf(function t_(t,e,n){let r;if(Rc(t)){const i=hn(t);return ho(i)||e_(i)}if(sm(t))r=()=>hn(t.useValue);else if(function $d(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...bu(t.deps||[]));else if(function fu(t){return!(!t||!t.useExisting)}(t))r=()=>Gt(hn(t.useExisting));else{const i=hn(t&&(t.useClass||t.provide));if(!function A0(t){return!!t.deps}(t))return ho(i)||e_(i);r=()=>new i(...bu(t.deps))}return r}(t),Hp)}(e);if(Rc(e)||!0!==e.multi)this.records.get(n);else{let i=this.records.get(n);i||(i=Kf(void 0,Hp,!0),i.factory=()=>bu(i.multi),this.records.set(n,i)),n=e,i.multi.push(e)}this.records.set(n,r)}hydrate(e,n){return n.value===Hp&&(n.value=pb,n.value=n.factory()),"object"==typeof n.value&&n.value&&function mb(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=hn(e.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function e_(t){const e=bs(t),n=null!==e?e.factory:ho(t);if(null!==n)return n;if(t instanceof Er)throw new On(204,!1);if(t instanceof Function)return function um(t){const e=t.length;if(e>0)throw function Sd(t,e){const n=[];for(let r=0;r<t;r++)n.push(e);return n}(e,"?"),new On(204,!1);const n=function uo(t){const e=t&&(t[xa]||t[Cl]);if(e){const n=function Ns(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new On(204,!1)}function Kf(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function _b(t){return!!t.\u0275providers}function n_(t,e){for(const n of t)Array.isArray(n)?n_(n,e):_b(n)?n_(n.\u0275providers,e):e(n)}class r_{}class i_{resolveComponentFactory(e){throw function xb(t){const e=Error(`No component factory found for ${Ni(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let ph=(()=>{class t{}return t.NULL=new i_,t})();function qd(){return Hd(Oi(),Dn())}function Hd(t,e){return new Oc(tl(t,e))}let Oc=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=qd,t})();function Wp(t){return t instanceof Oc?t.nativeElement:t}class Xp{}let R0=(()=>{class t{}return t.\u0275prov=zn({token:t,providedIn:"root",factory:()=>null}),t})();class Io{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const o_=new Io("14.3.0"),cm={};function mf(t){return t.ngOriginalError}class Jf{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e);this._console.error("ERROR",e),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&mf(e);for(;n&&mf(n);)n=mf(n);return n||null}}function Vh(t){return t instanceof Function?t():t}function dm(t,e,n){let r=t.length;for(;;){const i=t.indexOf(e,n);if(-1===i)return i;if(0===i||t.charCodeAt(i-1)<=32){const s=e.length;if(i+s===r||t.charCodeAt(i+s)<=32)return i}n=i+1}}const s_="ng-template";function uc(t,e,n){let r=0;for(;r<t.length;){let i=t[r++];if(n&&"class"===i){if(i=t[r],-1!==dm(i.toLowerCase(),e,0))return!0}else if(1===i){for(;r<t.length&&"string"==typeof(i=t[r++]);)if(i.toLowerCase()===e)return!0;return!1}}return!1}function Zd(t){return 4===t.type&&t.value!==s_}function Yd(t,e,n){return e===(4!==t.type||n?t.value:s_)}function a_(t,e,n){let r=4;const i=t.attrs||[],s=function Ab(t){for(let e=0;e<t.length;e++)if(tt(t[e]))return e;return t.length}(i);let f=!1;for(let g=0;g<e.length;g++){const v=e[g];if("number"!=typeof v){if(!f)if(4&r){if(r=2|1&r,""!==v&&!Yd(t,v,n)||""===v&&1===e.length){if(Xu(r))return!1;f=!0}}else{const x=8&r?v:e[++g];if(8&r&&null!==t.attrs){if(!uc(t.attrs,x,n)){if(Xu(r))return!1;f=!0}continue}const R=Db(8&r?"class":v,i,Zd(t),n);if(-1===R){if(Xu(r))return!1;f=!0;continue}if(""!==x){let L;L=R>s?"":i[R+1].toLowerCase();const B=8&r?L:null;if(B&&-1!==dm(B,x,0)||2&r&&x!==L){if(Xu(r))return!1;f=!0}}}}else{if(!f&&!Xu(r)&&!Xu(v))return!1;if(f&&Xu(v))continue;f=!1,r=v|1&r}}return Xu(r)||f}function Xu(t){return 0==(1&t)}function Db(t,e,n,r){if(null===e)return-1;let i=0;if(r||!n){let s=!1;for(;i<e.length;){const f=e[i];if(f===t)return i;if(3===f||6===f)s=!0;else{if(1===f||2===f){let g=e[++i];for(;"string"==typeof g;)g=e[++i];continue}if(4===f)break;if(0===f){i+=4;continue}}i+=s?1:2}return-1}return function k0(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const r=t[n];if("number"==typeof r)return-1;if(r===e)return n;n++}return-1}(e,t)}function l_(t,e,n=!1){for(let r=0;r<e.length;r++)if(a_(t,e[r],n))return!0;return!1}function pm(t,e){return t?":not("+e.trim()+")":e}function B0(t){let e=t[0],n=1,r=2,i="",s=!1;for(;n<t.length;){let f=t[n];if("string"==typeof f)if(2&r){const g=t[++n];i+="["+f+(g.length>0?'="'+g+'"':"")+"]"}else 8&r?i+="."+f:4&r&&(i+=" "+f);else""!==i&&!Xu(f)&&(e+=pm(s,i),i=""),r=f,s=s||!Xu(r);n++}return""!==i&&(e+=pm(s,i)),e}const yi={};function gm(t){u_(si(),Dn(),Kl()+t,!1)}function u_(t,e,n,r){if(!r)if(3==(3&e[2])){const s=t.preOrderCheckHooks;null!==s&&m(e,s,n)}else{const s=t.preOrderHooks;null!==s&&C(e,s,0,n)}Tc(n)}function mm(t,e=null,n=null,r){const i=Qf(t,e,n,r);return i.resolveInjectorInitializers(),i}function Qf(t,e=null,n=null,r,i=new Set){const s=[n||Ri,I0(t)];return r=r||("object"==typeof t?void 0:Ni(t)),new D0(s,e||lm(),r||null,i)}let du=(()=>{class t{static create(n,r){if(Array.isArray(n))return mm({name:""},r,n,"");{const i=n.name??"";return mm({name:i},n.parent,n.providers,i)}}}return t.THROW_IF_NOT_FOUND=Ep,t.NULL=new Yy,t.\u0275prov=zn({token:t,providedIn:"any",factory:()=>Gt(Xy)}),t.__NG_ELEMENT_ID__=-1,t})();function Tr(t,e=fr.Default){const n=Dn();return null===n?Gt(t,e):qi(Oi(),n,hn(t),e)}function Em(){throw new Error("invalid")}function I_(t,e){const n=t.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const f=t.data[s];Pl(i),f.contentQueries(2,e[s],s)}}}function Jp(t,e,n,r,i,s,f,g,v,x,M){const R=e.blueprint.slice();return R[0]=i,R[2]=76|r,(null!==M||t&&1024&t[2])&&(R[2]|=1024),nc(R),R[3]=R[15]=t,R[8]=n,R[10]=f||t&&t[10],R[11]=g||t&&t[11],R[12]=v||t&&t[12]||null,R[9]=x||t&&t[9]||null,R[6]=s,R[20]=function Hw(){return n0++}(),R[21]=M,R[16]=2==e.type?t[16]:R,R}function Zh(t,e,n,r,i){let s=t.data[e];if(null===s)s=function M_(t,e,n,r,i){const s=uf(),f=h(),v=t.data[e]=function u1(t,e,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?s:s&&s.parent,n,e,r,i);return null===t.firstChild&&(t.firstChild=v),null!==s&&(f?null==s.child&&null!==v.parent&&(s.child=v):null===s.next&&(s.next=v)),v}(t,e,n,r,i),function Gn(){return mi.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const f=function xu(){const t=mi.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();s.injectorIndex=null===f?-1:f.injectorIndex}return l(s,!0),s}function Xc(t,e,n,r){if(0===n)return-1;const i=e.length;for(let s=0;s<n;s++)e.push(r),t.blueprint.push(r),t.data.push(null);return i}function Qp(t,e,n){cf(e);try{const r=t.viewQuery;null!==r&&In(1,r,n);const i=t.template;null!==i&&Zc(t,e,i,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&I_(t,e),t.staticViewQueries&&In(2,t.viewQuery,n);const s=t.components;null!==s&&function _f(t,e){for(let n=0;n<e.length;n++)Zt(t,e[n])}(e,s)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{e[2]&=-5,Bf()}}function rp(t,e,n,r){const i=e[2];if(128!=(128&i)){cf(e);try{nc(e),function wt(t){return mi.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&Zc(t,e,n,2,r);const f=3==(3&i);if(f){const x=t.preOrderCheckHooks;null!==x&&m(e,x,null)}else{const x=t.preOrderHooks;null!==x&&C(e,x,0,null),T(e,0)}if(function Et(t){for(let e=lc(t);null!==e;e=Fu(e)){if(!e[2])continue;const n=e[9];for(let r=0;r<n.length;r++){const i=n[r],s=i[3];0==(512&i[2])&&Ou(s,1),i[2]|=512}}}(e),function lt(t){for(let e=lc(t);null!==e;e=Fu(e))for(let n=10;n<e.length;n++){const r=e[n],i=r[1];lf(r)&&rp(i,r,i.template,r[8])}}(e),null!==t.contentQueries&&I_(t,e),f){const x=t.contentCheckHooks;null!==x&&m(e,x)}else{const x=t.contentHooks;null!==x&&C(e,x,1),T(e,1)}!function s1(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const i=n[r];if(i<0)Tc(~i);else{const s=i,f=n[++r],g=n[++r];hr(f,s),g(2,e[s])}}}finally{Tc(-1)}}(t,e);const g=t.components;null!==g&&function a1(t,e){for(let n=0;n<e.length;n++)pt(t,e[n])}(e,g);const v=t.viewQuery;if(null!==v&&In(2,v,r),f){const x=t.viewCheckHooks;null!==x&&m(e,x)}else{const x=t.viewHooks;null!==x&&C(e,x,2),T(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),e[2]&=-41,512&e[2]&&(e[2]&=-513,Ou(e[3],-1))}finally{Bf()}}}function Zc(t,e,n,r,i){const s=Kl(),f=2&r;try{Tc(-1),f&&e.length>22&&u_(t,e,22,!1),n(r,i)}finally{Tc(s)}}function eg(t,e,n){!ti()||(function y(t,e,n,r){const i=n.directiveStart,s=n.directiveEnd;t.firstCreatePass||en(n,e),ul(r,e);const f=n.initialInputs;for(let g=i;g<s;g++){const v=t.data[g],x=io(v);x&&J(e,n,v);const M=fs(e,t,g,n);ul(M,e),null!==f&&Ne(0,g-i,M,v,0,f),x&&(hs(n.index,e)[8]=M)}}(t,e,n,tl(n,e)),128==(128&n.flags)&&function E(t,e,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,f=function Lr(){return mi.lFrame.currentDirectiveIndex}();try{Tc(s);for(let g=r;g<i;g++){const v=t.data[g],x=e[g];to(g),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&S(v,x)}}finally{Tc(-1),to(f)}}(t,e,n))}function cc(t,e,n=tl){const r=e.localNames;if(null!==r){let i=e.index+1;for(let s=0;s<r.length;s+=2){const f=r[s+1],g=-1===f?n(e,t):t[f];t[i++]=g}}}function vf(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=Rm(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function Rm(t,e,n,r,i,s,f,g,v,x){const M=22+r,R=M+i,L=function l1(t,e){const n=[];for(let r=0;r<e;r++)n.push(r<t?null:yi);return n}(M,R),B="function"==typeof x?x():x;return L[1]={type:t,blueprint:L,template:n,queries:null,viewQuery:g,declTNode:e,data:L.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:R,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:v,consts:B,incompleteFirstPass:!1}}function D_(t,e,n,r){const i=an(e);null===n?i.push(r):(i.push(n),t.firstCreatePass&&Wn(t).push(r,i.length-1))}function c1(t,e,n){for(let r in t)if(t.hasOwnProperty(r)){const i=t[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(e,i):n[r]=[e,i]}return n}function A_(t,e){const r=e.directiveEnd,i=t.data,s=e.attrs,f=[];let g=null,v=null;for(let x=e.directiveStart;x<r;x++){const M=i[x],R=M.inputs,L=null===s||Zd(e)?null:Qe(R,s);f.push(L),g=c1(R,x,g),v=c1(M.outputs,x,v)}null!==g&&(g.hasOwnProperty("class")&&(e.flags|=16),g.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=f,e.inputs=g,e.outputs=v}function hc(t,e,n,r,i,s,f,g){const v=tl(e,n);let M,x=e.inputs;!g&&null!=x&&(M=x[r])?(vr(t,n,M,r,i),cs(e)&&Nm(n,e.index)):3&e.type&&(r=function h1(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),i=null!=f?f(i,e.value||"",r):i,s.setProperty(v,r,i))}function Nm(t,e){const n=hs(e,t);16&n[2]||(n[2]|=32)}function o(t,e,n,r){let i=!1;if(ti()){const s=function D(t,e,n){const r=t.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const f=r[s];l_(n,f.selectors,!1)&&(i||(i=[]),wi(en(n,e),t,f.type),io(f)?(O(t,n),i.unshift(f)):i.push(f))}return i}(t,e,n),f=null===r?null:{"":-1};if(null!==s){i=!0,$(n,t.data.length,s.length);for(let M=0;M<s.length;M++){const R=s[M];R.providersResolver&&R.providersResolver(R)}let g=!1,v=!1,x=Xc(t,e,s.length,null);for(let M=0;M<s.length;M++){const R=s[M];n.mergedAttrs=ot(n.mergedAttrs,R.hostAttrs),H(t,n,e,x,R),V(x,R,f),null!==R.contentQueries&&(n.flags|=8),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(n.flags|=128);const L=R.type.prototype;!g&&(L.ngOnChanges||L.ngOnInit||L.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),g=!0),!v&&(L.ngOnChanges||L.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),v=!0),x++}A_(t,n)}f&&function N(t,e,n){if(e){const r=t.localNames=[];for(let i=0;i<e.length;i+=2){const s=n[e[i+1]];if(null==s)throw new On(-301,!1);r.push(e[i],s)}}}(n,r,f)}return n.mergedAttrs=ot(n.mergedAttrs,n.attrs),i}function u(t,e,n,r,i,s){const f=s.hostBindings;if(f){let g=t.hostBindingOpCodes;null===g&&(g=t.hostBindingOpCodes=[]);const v=~e.index;(function d(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(g)!=v&&g.push(v),g.push(r,i,f)}}function S(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function O(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function V(t,e,n){if(n){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)n[e.exportAs[r]]=t;io(e)&&(n[""]=t)}}function $(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function H(t,e,n,r,i){t.data[r]=i;const s=i.factory||(i.factory=ho(i.type)),f=new j(s,io(i),Tr);t.blueprint[r]=f,n[r]=f,u(t,e,0,r,Xc(t,n,i.hostVars,yi),i)}function J(t,e,n){const r=tl(e,t),i=vf(n),s=t[10],f=Ln(t,Jp(t,i,null,n.onPush?32:16,r,e,s,s.createRenderer(r,n),null,null,null));t[e.index]=f}function ie(t,e,n,r,i,s){const f=tl(t,e);!function pe(t,e,n,r,i,s,f){if(null==s)t.removeAttribute(e,i,n);else{const g=null==f?G(s):f(s,r||"",i);t.setAttribute(e,i,g,n)}}(e[11],f,s,t.value,n,r,i)}function Ne(t,e,n,r,i,s){const f=s[e];if(null!==f){const g=r.setInput;for(let v=0;v<f.length;){const x=f[v++],M=f[v++],R=f[v++];null!==g?r.setInput(n,R,x,M):n[M]=R}}}function Qe(t,e){let n=null,r=0;for(;r<e.length;){const i=e[r];if(0!==i)if(5!==i){if("number"==typeof i)break;t.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,t[i],e[r+1])),r+=2}else r+=2;else r+=4}return n}function Ye(t,e,n,r){return new Array(t,!0,!1,e,null,0,r,n,null,null)}function pt(t,e){const n=hs(e,t);if(lf(n)){const r=n[1];48&n[2]?rp(r,n,r.template,n[8]):n[5]>0&&Kt(n)}}function Kt(t){for(let r=lc(t);null!==r;r=Fu(r))for(let i=10;i<r.length;i++){const s=r[i];if(lf(s))if(512&s[2]){const f=s[1];rp(f,s,f.template,s[8])}else s[5]>0&&Kt(s)}const n=t[1].components;if(null!==n)for(let r=0;r<n.length;r++){const i=hs(n[r],t);lf(i)&&i[5]>0&&Kt(i)}}function Zt(t,e){const n=hs(e,t),r=n[1];(function fn(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(r,n),Qp(r,n,n[8])}function Ln(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function nn(t){for(;t;){t[2]|=32;const e=$f(t);if(ta(t)&&!e)return t;t=e}return null}function gn(t,e,n,r=!0){const i=e[10];i.begin&&i.begin();try{rp(t,e,t.template,n)}catch(f){throw r&&rr(e,f),f}finally{i.end&&i.end()}}function In(t,e,n){Pl(0),e(t,n)}function an(t){return t[7]||(t[7]=[])}function Wn(t){return t.cleanup||(t.cleanup=[])}function $r(t,e,n){return(null===t||io(t))&&(n=function Wu(t){for(;Array.isArray(t);){if("object"==typeof t[1])return t;t=t[0]}return null}(n[e.index])),n[11]}function rr(t,e){const n=t[9],r=n?n.get(Jf,null):null;r&&r.handleError(e)}function vr(t,e,n,r,i){for(let s=0;s<n.length;){const f=n[s++],g=n[s++],v=e[f],x=t.data[f];null!==x.setInput?x.setInput(v,i,r,g):v[g]=i}}function Vn(t,e,n){const r=function tc(t,e){return $i(e[t])}(e,t);!function qf(t,e,n){t.setValue(e,n)}(t[11],r,n)}function qr(t,e,n){let r=n?t.styles:null,i=n?t.classes:null,s=0;if(null!==e)for(let f=0;f<e.length;f++){const g=e[f];"number"==typeof g?s=g:1==s?i=ol(i,g):2==s&&(r=ol(r,g+": "+e[++f]+";"))}n?t.styles=r:t.stylesWithoutHost=r,n?t.classes=i:t.classesWithoutHost=i}function zi(t,e,n,r,i=!1){for(;null!==n;){const s=e[n.index];if(null!==s&&r.push($i(s)),Qi(s))for(let g=10;g<s.length;g++){const v=s[g],x=v[1].firstChild;null!==x&&zi(v[1],v,x,r)}const f=n.type;if(8&f)zi(t,e,n.child,r);else if(32&f){const g=Ty(n,e);let v;for(;v=g();)r.push(v)}else if(16&f){const g=Oy(e,n);if(Array.isArray(g))r.push(...g);else{const v=$f(e[16]);zi(v[1],v,g,r,!0)}}n=i?n.projectionNext:n.next}return r}class Ii{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return zi(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Qi(e)){const n=e[8],r=n?n.indexOf(this):-1;r>-1&&(Bd(e,r),Cd(n,r))}this._attachedToViewContainer=!1}Lp(this._lView[1],this._lView)}onDestroy(e){D_(this._lView[1],this._lView,null,e)}markForCheck(){nn(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){gn(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new On(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ay(t,e){Fp(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new On(902,!1);this._appRef=e}}class Vi extends Ii{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;gn(e[1],e,e[8],!1)}checkNoChanges(){}get context(){return null}}class Wr extends ph{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=ur(e);return new Mo(n,this.ngModule)}}function ps(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class Ki{constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,r){const i=this.injector.get(e,cm,r);return i!==cm||n===cm?i:this.parentInjector.get(e,n,r)}}class Mo extends r_{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function Pb(t){return t.map(B0).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return ps(this.componentDef.inputs)}get outputs(){return ps(this.componentDef.outputs)}create(e,n,r,i){let s=(i=i||this.ngModule)instanceof pf?i:i?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const f=s?new Ki(e,s):e,g=f.get(Xp,null);if(null===g)throw new On(407,!1);const v=f.get(R0,null),x=g.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",R=r?function Lm(t,e,n){return t.selectRootElement(e,n===bo.ShadowDom)}(x,r,this.componentDef.encapsulation):jg(x,M,function hi(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(M)),L=this.componentDef.onPush?288:272,B=Rm(0,null,null,1,0,null,null,null,null,null),ee=Jp(null,B,null,L,null,null,g,x,v,f,null);let se,Oe;cf(ee);try{const Ee=function Sa(t,e,n,r,i,s){const f=n[1];n[22]=t;const v=Zh(f,22,2,"#host",null),x=v.mergedAttrs=e.hostAttrs;null!==x&&(qr(v,x,!0),null!==t&&(Ie(i,t,x),null!==v.classes&&Su(i,t,v.classes),null!==v.styles&&dh(i,t,v.styles)));const M=r.createRenderer(t,e),R=Jp(n,vf(e),null,e.onPush?32:16,n[22],v,r,M,s||null,null,null);return f.firstCreatePass&&(wi(en(v,n),f,e.type),O(f,v),$(v,n.length,1)),Ln(n,R),n[22]=R}(R,this.componentDef,ee,g,x);if(R)if(r)Ie(x,R,["ng-version",o_.full]);else{const{attrs:_e,classes:ve}=function z0(t){const e=[],n=[];let r=1,i=2;for(;r<t.length;){let s=t[r];if("string"==typeof s)2===i?""!==s&&e.push(s,t[++r]):8===i&&n.push(s);else{if(!Xu(i))break;i=s}r++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);_e&&Ie(x,R,_e),ve&&ve.length>0&&Su(x,R,ve.join(" "))}if(Oe=Fc(B,22),void 0!==n){const _e=Oe.projection=[];for(let ve=0;ve<this.ngContentSelectors.length;ve++){const it=n[ve];_e.push(null!=it?Array.from(it):null)}}se=function Nl(t,e,n,r){const i=n[1],s=function a(t,e,n){const r=Oi();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),H(t,r,e,Xc(t,e,1,null),n),A_(t,r));const i=fs(e,t,r.directiveStart,r);ul(i,e);const s=tl(r,e);return s&&ul(s,e),i}(i,n,e);if(t[8]=n[8]=s,null!==r)for(const g of r)g(s,e);if(e.contentQueries){const g=Oi();e.contentQueries(1,s,g.directiveStart)}const f=Oi();return!i.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Tc(f.index),u(n[1],f,0,f.directiveStart,f.directiveEnd,e),S(e,s)),s}(Ee,this.componentDef,ee,[ws]),Qp(B,ee,null)}finally{Bf()}return new qs(this.componentType,se,Hd(Oe,ee),ee,Oe)}}class qs extends class vb{}{constructor(e,n,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.instance=n,this.hostView=this.changeDetectorRef=new Vi(i),this.componentType=e}setInput(e,n){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[e])){const s=this._rootLView;vr(s[1],s,i,e,n),Nm(s,this._tNode.index)}}get injector(){return new Jl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function ws(){const t=Oi();c(Dn()[1],t)}function la(t){let e=function Ya(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),n=!0;const r=[t];for(;e;){let i;if(io(t))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new On(903,!1);i=e.\u0275dir}if(i){if(n){r.push(i);const f=t;f.inputs=Js(t.inputs),f.declaredInputs=Js(t.declaredInputs),f.outputs=Js(t.outputs);const g=i.hostBindings;g&&Ba(t,g);const v=i.viewQuery,x=i.contentQueries;if(v&&cl(t,v),x&&Ss(t,x),Qu(t.inputs,i.inputs),Qu(t.declaredInputs,i.declaredInputs),Qu(t.outputs,i.outputs),io(i)&&i.data.animation){const M=t.data;M.animation=(M.animation||[]).concat(i.data.animation)}}const s=i.features;if(s)for(let f=0;f<s.length;f++){const g=s[f];g&&g.ngInherit&&g(t),g===la&&(n=!1)}}e=Object.getPrototypeOf(e)}!function _o(t){let e=0,n=null;for(let r=t.length-1;r>=0;r--){const i=t[r];i.hostVars=e+=i.hostVars,i.hostAttrs=ot(i.hostAttrs,n=ot(n,i.hostAttrs))}}(r)}function Js(t){return t===oa?{}:t===Ri?[]:t}function cl(t,e){const n=t.viewQuery;t.viewQuery=n?(r,i)=>{e(r,i),n(r,i)}:e}function Ss(t,e){const n=t.contentQueries;t.contentQueries=n?(r,i,s)=>{e(r,i,s),n(r,i,s)}:e}function Ba(t,e){const n=t.hostBindings;t.hostBindings=n?(r,i)=>{e(r,i),n(r,i)}:e}let Bl=null;function Ta(){if(!Bl){const t=Zi.Symbol;if(t&&t.iterator)Bl=t.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<e.length;++n){const r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Bl=r)}}}return Bl}function Ql(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function ip(t,e,n,r){const i=Dn();return Ql(i,vt(),e)&&(si(),ie(ma(),i,t,e,n,r)),ip}function jb(t,e,n,r,i){const f=i?"class":"style";vr(t,n,e.inputs[f],f,r)}function zu(t,e,n,r){const i=Dn(),s=si(),f=22+t,g=i[11],v=i[f]=jg(g,e,function zf(){return mi.lFrame.currentNamespace}()),x=s.firstCreatePass?function WN(t,e,n,r,i,s,f){const g=e.consts,x=Zh(e,t,2,i,Ea(g,s));return o(e,n,x,Ea(g,f)),null!==x.attrs&&qr(x,x.attrs,!1),null!==x.mergedAttrs&&qr(x,x.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,x),x}(f,s,i,0,e,n,r):s.data[f];l(x,!0);const M=x.mergedAttrs;null!==M&&Ie(g,v,M);const R=x.classes;null!==R&&Su(g,v,R);const L=x.styles;return null!==L&&dh(g,v,L),64!=(64&x.flags)&&qg(s,i,v,x),0===function rh(){return mi.lFrame.elementDepthCount}()&&ul(v,i),function ic(){mi.lFrame.elementDepthCount++}(),So(x)&&(eg(s,i,x),function Pm(t,e,n){if(Bi(e)){const i=e.directiveEnd;for(let s=e.directiveStart;s<i;s++){const f=t.data[s];f.contentQueries&&f.contentQueries(1,n[s],s)}}}(s,x,i)),null!==r&&cc(i,x),zu}function Yu(){let t=Oi();h()?function _(){mi.lFrame.isParent=!1}():(t=t.parent,l(t,!1));const e=t;!function oc(){mi.lFrame.elementDepthCount--}();const n=si();return n.firstCreatePass&&(c(n,t),Bi(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function Ve(t){return 0!=(16&t.flags)}(e)&&jb(n,e,Dn(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function Ue(t){return 0!=(32&t.flags)}(e)&&jb(n,e,Dn(),e.stylesWithoutHost,!1),Yu}function sp(t,e,n,r){return zu(t,e,n,r),Yu(),sp}function p1(t){return!!t&&"function"==typeof t.then}const SI=function CI(t){return!!t&&"function"==typeof t.subscribe};function qb(t,e){const n=Oi(),r=Dn(),i=si();return function TI(t,e,n,r,i,s,f,g){const v=So(r),M=t.firstCreatePass&&Wn(t),R=e[8],L=an(e);let B=!0;if(3&r.type||g){const Oe=tl(r,e),Ee=g?g(Oe):Oe,_e=L.length,ve=g?mt=>g($i(mt[r.index])):r.index;let it=null;if(!g&&v&&(it=function YN(t,e,n,r){const i=t.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const f=i[s];if(f===n&&i[s+1]===r){const g=e[7],v=i[s+2];return g.length>v?g[v]:null}"string"==typeof f&&(s+=2)}return null}(t,e,i,r.index)),null!==it)(it.__ngLastListenerFn__||it).__ngNextListenerFn__=s,it.__ngLastListenerFn__=s,B=!1;else{s=MI(r,e,R,s,!1);const mt=n.listen(Ee,i,s);L.push(s,mt),M&&M.push(i,ve,_e,_e+1)}}else s=MI(r,e,R,s,!1);const ee=r.outputs;let se;if(B&&null!==ee&&(se=ee[i])){const Oe=se.length;if(Oe)for(let Ee=0;Ee<Oe;Ee+=2){const Ot=e[se[Ee]][se[Ee+1]].subscribe(s),kt=L.length;L.push(s,Ot),M&&M.push(i,r.index,kt,-(kt+1))}}}(i,r,$r(Ps(i.data),n,r),n,t,e),qb}function II(t,e,n,r){try{return!1!==n(r)}catch(i){return rr(t,i),!1}}function MI(t,e,n,r,i){return function s(f){if(f===Function)return r;nn(2&t.flags?hs(t.index,e):e);let v=II(e,0,r,f),x=s.__ngNextListenerFn__;for(;x;)v=II(e,0,x,f)&&v,x=x.__ngNextListenerFn__;return i&&!1===v&&(f.preventDefault(),f.returnValue=!1),v}}function Kc(t,e=""){const n=Dn(),r=si(),i=t+22,s=r.firstCreatePass?Zh(r,i,1,e,null):r.data[i],f=n[i]=function Vg(t,e){return t.createText(e)}(n[11],e);qg(r,n,f,s),l(s,!1)}function R_(t,e,n){const r=Dn(),i=function fc(t,e,n,r){return Ql(t,vt(),n)?e+G(n)+r:yi}(r,t,e,n);return i!==yi&&Vn(r,Kl(),i),R_}function Xb(t,e,n){const r=Dn();return Ql(r,vt(),e)&&hc(si(),ma(),r,t,e,r[11],n,!0),Xb}function Zb(t,e,n){const r=Dn();if(Ql(r,vt(),e)){const s=si(),f=ma();hc(s,f,r,t,e,$r(Ps(s.data),f,r),n,!0)}return Zb}const zm="en-US";let vM=zm;class og{}class qM{}class HM extends og{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Wr(this);const r=Ji(e);this._bootstrapComponents=Vh(r.bootstrap),this._r3Injector=Qf(e,n,[{provide:og,useValue:this},{provide:ph,useValue:this.componentFactoryResolver}],Ni(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class nE extends qM{constructor(e){super(),this.moduleType=e}create(e){return new HM(this.moduleType,e)}}class zF extends og{constructor(e,n,r){super(),this.componentFactoryResolver=new Wr(this),this.instance=null;const i=new D0([...e,{provide:og,useValue:this},{provide:ph,useValue:this.componentFactoryResolver}],n||lm(),r,new Set(["environment"]));this.injector=i,i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function w1(t,e,n=null){return new zF(t,e,n).injector}let UF=(()=>{class t{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=Ky(0,n.type),i=r.length>0?w1([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,i)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return t.\u0275prov=zn({token:t,providedIn:"environment",factory:()=>new t(Gt(pf))}),t})();function WM(t){t.getStandaloneInjector=e=>e.get(UF).getOrCreateStandaloneInjector(t)}function iE(t){return e=>{setTimeout(t,void 0,e)}}const Iu=class fB extends xt{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,r){let i=e,s=n||(()=>null),f=r;if(e&&"object"==typeof e){const v=e;i=v.next?.bind(v),s=v.error?.bind(v),f=v.complete?.bind(v)}this.__isAsync&&(s=iE(s),i&&(i=iE(i)),f&&(f=iE(f)));const g=super.subscribe({next:i,error:s,complete:f});return e instanceof K&&e.add(g),g}};function dB(){return this._results[Ta()]()}class oE{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=Ta(),r=oE.prototype;r[n]||(r[n]=dB)}get changes(){return this._changes||(this._changes=new Iu)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){const r=this;r.dirty=!1;const i=Rl(e);(this._changesDetected=!function Fw(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){let i=t[r],s=e[r];if(n&&(i=n(i),s=n(s)),s!==i)return!1}return!0}(r._results,i,n))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let If=(()=>{class t{}return t.__NG_ELEMENT_ID__=mB,t})();const pB=If,gB=class extends pB{constructor(e,n,r){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(e,n){const r=this._declarationTContainer.tViews,i=Jp(this._declarationLView,r,e,16,null,r.declTNode,null,null,null,null,n||null);i[17]=this._declarationLView[this._declarationTContainer.index];const f=this._declarationLView[19];return null!==f&&(i[19]=f.createEmbeddedView(r)),Qp(r,i,e),new Ii(i)}};function mB(){return b1(Oi(),Dn())}function b1(t,e){return 4&t.type?new gB(e,t,Hd(t,e)):null}let yh=(()=>{class t{}return t.__NG_ELEMENT_ID__=yB,t})();function yB(){return aD(Oi(),Dn())}const _B=yh,oD=class extends _B{constructor(e,n,r){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=r}get element(){return Hd(this._hostTNode,this._hostLView)}get injector(){return new Jl(this._hostTNode,this._hostLView)}get parentInjector(){const e=br(this._hostTNode,this._hostLView);if(_t(e)){const n=Wt(e,this._hostLView),r=It(e);return new Jl(n[1].data[r+8],n)}return new Jl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=sD(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,r){let i,s;"number"==typeof r?i=r:null!=r&&(i=r.index,s=r.injector);const f=e.createEmbeddedView(n||{},s);return this.insert(f,i),f}createComponent(e,n,r,i,s){const f=e&&!function Ed(t){return"function"==typeof t}(e);let g;if(f)g=n;else{const R=n||{};g=R.index,r=R.injector,i=R.projectableNodes,s=R.environmentInjector||R.ngModuleRef}const v=f?e:new Mo(ur(e)),x=r||this.parentInjector;if(!s&&null==v.ngModule){const L=(f?x:this.parentInjector).get(pf,null);L&&(s=L)}const M=v.create(x,i,void 0,s);return this.insert(M.hostView,g),M}insert(e,n){const r=e._lView,i=r[1];if(function xd(t){return Qi(t[3])}(r)){const M=this.indexOf(e);if(-1!==M)this.detach(M);else{const R=r[3],L=new oD(R,R[6],R[3]);L.detach(L.indexOf(e))}}const s=this._adjustIndex(n),f=this._lContainer;!function Zw(t,e,n,r){const i=10+r,s=n.length;r>0&&(n[i-1][4]=e),r<s-10?(e[4]=n[i],Dg(n,10+r,e)):(n.push(e),e[4]=null),e[3]=n;const f=e[17];null!==f&&n!==f&&function kh(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(f,e);const g=e[19];null!==g&&g.insertView(t),e[2]|=64}(i,r,f,s);const g=Ly(s,f),v=r[11],x=fh(v,f[7]);return null!==x&&function Xw(t,e,n,r,i,s){r[0]=i,r[6]=e,Fp(t,r,n,1,i,s)}(i,f[6],v,r,x,g),e.attachToViewContainerRef(),Dg(sE(f),s,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=sD(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),r=Bd(this._lContainer,n);r&&(Cd(sE(this._lContainer),n),Lp(r[1],r))}detach(e){const n=this._adjustIndex(e,-1),r=Bd(this._lContainer,n);return r&&null!=Cd(sE(this._lContainer),n)?new Ii(r):null}_adjustIndex(e,n=0){return e??this.length+n}};function sD(t){return t[8]}function sE(t){return t[8]||(t[8]=[])}function aD(t,e){let n;const r=e[t.index];if(Qi(r))n=r;else{let i;if(8&t.type)i=$i(r);else{const s=e[11];i=s.createComment("");const f=tl(t,e);Fh(s,fh(s,f),i,function f0(t,e){return t.nextSibling(e)}(s,f),!1)}e[t.index]=n=Ye(r,e,i,t),Ln(e,n)}return new oD(n,t,e)}class aE{constructor(e){this.queryList=e,this.matches=null}clone(){return new aE(this.queryList)}setDirty(){this.queryList.setDirty()}}class lE{constructor(e=[]){this.queries=e}createEmbeddedView(e){const n=e.queries;if(null!==n){const r=null!==e.contentQueries?e.contentQueries[0]:n.length,i=[];for(let s=0;s<r;s++){const f=n.getByIndex(s);i.push(this.queries[f.indexInDeclarationView].clone())}return new lE(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)null!==fD(e,n).matches&&this.queries[n].setDirty()}}class lD{constructor(e,n,r=null){this.predicate=e,this.flags=n,this.read=r}}class uE{constructor(e=[]){this.queries=e}elementStart(e,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let r=0;r<this.length;r++){const i=null!==n?n.length:0,s=this.getByIndex(r).embeddedTView(e,i);s&&(s.indexInDeclarationView=r,null!==n?n.push(s):n=[s])}return null!==n?new uE(n):null}template(e,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class cE{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new cE(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];this.matchTNodeWithReadOption(e,n,wB(n,s)),this.matchTNodeWithReadOption(e,n,rs(n,e,s,!1,!1))}else r===If?4&n.type&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,rs(n,e,r,!1,!1))}matchTNodeWithReadOption(e,n,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Oc||i===yh||i===If&&4&n.type)this.addMatch(n.index,-2);else{const s=rs(n,e,i,!1,!1);null!==s&&this.addMatch(n.index,s)}else this.addMatch(n.index,r)}}addMatch(e,n){null===this.matches?this.matches=[e,n]:this.matches.push(e,n)}}function wB(t,e){const n=t.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===e)return n[r+1];return null}function EB(t,e,n,r){return-1===n?function bB(t,e){return 11&t.type?Hd(t,e):4&t.type?b1(t,e):null}(e,t):-2===n?function CB(t,e,n){return n===Oc?Hd(e,t):n===If?b1(e,t):n===yh?aD(e,t):void 0}(t,e,r):fs(t,t[1],n,e)}function uD(t,e,n,r){const i=e[19].queries[r];if(null===i.matches){const s=t.data,f=n.matches,g=[];for(let v=0;v<f.length;v+=2){const x=f[v];g.push(x<0?null:EB(e,s[x],f[v+1],n.metadata.read))}i.matches=g}return i.matches}function hE(t,e,n,r){const i=t.queries.getByIndex(n),s=i.matches;if(null!==s){const f=uD(t,e,i,n);for(let g=0;g<s.length;g+=2){const v=s[g];if(v>0)r.push(f[g/2]);else{const x=s[g+1],M=e[-v];for(let R=10;R<M.length;R++){const L=M[R];L[17]===L[3]&&hE(L[1],L,x,r)}if(null!==M[9]){const R=M[9];for(let L=0;L<R.length;L++){const B=R[L];hE(B[1],B,x,r)}}}}}return r}function U_(t){const e=Dn(),n=si(),r=ka();Pl(r+1);const i=fD(n,r);if(t.dirty&&function Cc(t){return 4==(4&t[2])}(e)===(2==(2&i.metadata.flags))){if(null===i.matches)t.reset([]);else{const s=i.crossesNgTemplate?hE(n,e,r,[]):uD(n,e,i,r);t.reset(s,Wp),t.notifyOnChanges()}return!0}return!1}function fE(t,e,n){const r=si();r.firstCreatePass&&(function hD(t,e,n){null===t.queries&&(t.queries=new uE),t.queries.track(new cE(e,n))}(r,new lD(t,e,n),-1),2==(2&e)&&(r.staticViewQueries=!0)),function cD(t,e,n){const r=new oE(4==(4&n));D_(t,e,r,r.destroy),null===e[19]&&(e[19]=new lE),e[19].queries.push(new aE(r))}(r,Dn(),e)}function V_(){return function SB(t,e){return t[19].queries[e].queryList}(Dn(),ka())}function fD(t,e){return t.queries.getByIndex(e)}function C1(...t){}const S1=new Er("Application Initializer");let T1=(()=>{class t{constructor(n){this.appInits=n,this.resolve=C1,this.reject=C1,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const s=this.appInits[i]();if(p1(s))n.push(s);else if(SI(s)){const f=new Promise((g,v)=>{s.subscribe({complete:g,error:v})});n.push(f)}}Promise.all(n).then(()=>{r()}).catch(i=>{this.reject(i)}),0===n.length&&r(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(Gt(S1,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const G_=new Er("AppId",{providedIn:"root",factory:function PD(){return`${_E()}${_E()}${_E()}`}});function _E(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const RD=new Er("Platform Initializer"),I1=new Er("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),OD=new Er("appBootstrapListener"),vE=new Er("AnimationModuleType");let WB=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Mf=new Er("LocaleId",{providedIn:"root",factory:()=>_a(Mf,fr.Optional|fr.SkipSelf)||function XB(){return typeof $localize<"u"&&$localize.locale||zm}()});class YB{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}let xE=(()=>{class t{compileModuleSync(n){return new nE(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),s=Vh(Ji(n).declarations).reduce((f,g)=>{const v=ur(g);return v&&f.push(new Mo(v)),f},[]);return new YB(r,s)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const QB=(()=>Promise.resolve(0))();function wE(t){typeof Zone>"u"?QB.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class ua{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Iu(!1),this.onMicrotaskEmpty=new Iu(!1),this.onStable=new Iu(!1),this.onError=new Iu(!1),typeof Zone>"u")throw new On(908,!1);Zone.assertZonePatched();const i=this;if(i._nesting=0,i._outer=i._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;i._inner=i._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&n,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function e3(){let t=Zi.requestAnimationFrame,e=Zi.cancelAnimationFrame;if(typeof Zone<"u"&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function r3(t){const e=()=>{!function n3(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Zi,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,EE(t),t.isCheckStableRunning=!0,bE(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),EE(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,f,g)=>{try{return kD(t),n.invokeTask(i,s,f,g)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||t.shouldCoalesceRunChangeDetection)&&e(),FD(t)}},onInvoke:(n,r,i,s,f,g,v)=>{try{return kD(t),n.invoke(i,s,f,g,v)}finally{t.shouldCoalesceRunChangeDetection&&e(),FD(t)}},onHasTask:(n,r,i,s)=>{n.hasTask(i,s),r===i&&("microTask"==s.change?(t._hasPendingMicrotasks=s.microTask,EE(t),bE(t)):"macroTask"==s.change&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,r,i,s)=>(n.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ua.isInAngularZone())throw new On(909,!1)}static assertNotInAngularZone(){if(ua.isInAngularZone())throw new On(909,!1)}run(e,n,r){return this._inner.run(e,n,r)}runTask(e,n,r,i){const s=this._inner,f=s.scheduleEventTask("NgZoneEvent: "+i,e,t3,C1,C1);try{return s.runTask(f,n,r)}finally{s.cancelTask(f)}}runGuarded(e,n,r){return this._inner.runGuarded(e,n,r)}runOutsideAngular(e){return this._outer.run(e)}}const t3={};function bE(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function EE(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function kD(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function FD(t){t._nesting--,bE(t)}class o3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Iu,this.onMicrotaskEmpty=new Iu,this.onStable=new Iu,this.onError=new Iu}run(e,n,r){return e.apply(n,r)}runGuarded(e,n,r){return e.apply(n,r)}runOutsideAngular(e){return e()}runTask(e,n,r,i){return e.apply(n,r)}}const BD=new Er(""),M1=new Er("");let TE,CE=(()=>{class t{constructor(n,r,i){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,TE||(function s3(t){TE=t}(i),i.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ua.assertNotInAngularZone(),wE(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())wE(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,i){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==s),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:s,updateCb:i})}whenStable(n,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,i){return[]}}return t.\u0275fac=function(n){return new(n||t)(Gt(ua),Gt(SE),Gt(M1))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),SE=(()=>{class t{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return TE?.findTestabilityInTree(this,n,r)??null}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})(),ap=null;const zD=new Er("AllowMultipleToken"),IE=new Er("PlatformDestroyListeners");class UD{constructor(e,n){this.name=e,this.token=n}}function jD(t,e,n=[]){const r=`Platform: ${e}`,i=new Er(r);return(s=[])=>{let f=ME();if(!f||f.injector.get(zD,!1)){const g=[...n,...s,{provide:i,useValue:!0}];t?t(g):function u3(t){if(ap&&!ap.get(zD,!1))throw new On(400,!1);ap=t;const e=t.get($D);(function VD(t){const e=t.get(RD,null);e&&e.forEach(n=>n())})(t)}(function GD(t=[],e){return du.create({name:e,providers:[{provide:am,useValue:"platform"},{provide:IE,useValue:new Set([()=>ap=null])},...t]})}(g,r))}return function h3(t){const e=ME();if(!e)throw new On(401,!1);return e}()}}function ME(){return ap?.get($D)??null}let $D=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const i=function HD(t,e){let n;return n="noop"===t?new o3:("zone.js"===t?void 0:t)||new ua(e),n}(r?.ngZone,function qD(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!t||!t.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!t||!t.ngZoneRunCoalescing)||!1}}(r)),s=[{provide:ua,useValue:i}];return i.run(()=>{const f=du.create({providers:s,parent:this.injector,name:n.moduleType.name}),g=n.create(f),v=g.injector.get(Jf,null);if(!v)throw new On(402,!1);return i.runOutsideAngular(()=>{const x=i.onError.subscribe({next:M=>{v.handleError(M)}});g.onDestroy(()=>{D1(this._modules,g),x.unsubscribe()})}),function WD(t,e,n){try{const r=n();return p1(r)?r.catch(i=>{throw e.runOutsideAngular(()=>t.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(v,i,()=>{const x=g.injector.get(T1);return x.runInitializers(),x.donePromise.then(()=>(function xM(t){Gr(t,"Expected localeId to be defined"),"string"==typeof t&&(vM=t.toLowerCase().replace(/_/g,"-"))}(g.injector.get(Mf,zm)||zm),this._moduleDoBootstrap(g),g))})})}bootstrapModule(n,r=[]){const i=XD({},r);return function a3(t,e,n){const r=new nE(n);return Promise.resolve(r)}(0,0,n).then(s=>this.bootstrapModuleFactory(s,i))}_moduleDoBootstrap(n){const r=n.injector.get(jm);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!n.instance.ngDoBootstrap)throw new On(403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new On(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(IE,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(Gt(du))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function XD(t,e){return Array.isArray(e)?e.reduce(XD,t):{...t,...e}}let jm=(()=>{class t{constructor(n,r,i){this._zone=n,this._injector=r,this._exceptionHandler=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Bt(g=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{g.next(this._stable),g.complete()})}),f=new Bt(g=>{let v;this._zone.runOutsideAngular(()=>{v=this._zone.onStable.subscribe(()=>{ua.assertNotInAngularZone(),wE(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,g.next(!0))})})});const x=this._zone.onUnstable.subscribe(()=>{ua.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{g.next(!1)}))});return()=>{v.unsubscribe(),x.unsubscribe()}});this.isStable=Xi(s,f.pipe(function ca(t={}){const{connector:e=(()=>new xt),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=t;return s=>{let f=null,g=null,v=null,x=0,M=!1,R=!1;const L=()=>{g?.unsubscribe(),g=null},B=()=>{L(),f=v=null,M=R=!1},ee=()=>{const se=f;B(),se?.unsubscribe()};return $t((se,Oe)=>{x++,!R&&!M&&L();const Ee=v=v??e();Oe.add(()=>{x--,0===x&&!R&&!M&&(g=so(ee,i))}),Ee.subscribe(Oe),f||(f=new oe({next:_e=>Ee.next(_e),error:_e=>{R=!0,L(),g=so(B,n,_e),Ee.error(_e)},complete:()=>{M=!0,L(),g=so(B,r),Ee.complete()}}),Wi(se).subscribe(f))})(s)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const i=n instanceof r_;if(!this._injector.get(T1).done)throw!i&&function Ga(t){const e=ur(t)||Eo(t)||er(t);return null!==e&&e.standalone}(n),new On(405,false);let f;f=i?n:this._injector.get(ph).resolveComponentFactory(n),this.componentTypes.push(f.componentType);const g=function l3(t){return t.isBoundToModule}(f)?void 0:this._injector.get(og),x=f.create(du.NULL,[],r||f.selector,g),M=x.location.nativeElement,R=x.injector.get(BD,null);return R?.registerApplication(M),x.onDestroy(()=>{this.detachView(x.hostView),D1(this.components,x),R?.unregisterApplication(M)}),this._loadComponent(x),x}tick(){if(this._runningTick)throw new On(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;D1(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(OD,[]).concat(this._bootstrapListeners).forEach(i=>i(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>D1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new On(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return t.\u0275fac=function(n){return new(n||t)(Gt(ua),Gt(pf),Gt(Jf))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function D1(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let YD=!0,KD=!1,A1=(()=>{class t{}return t.__NG_ELEMENT_ID__=g3,t})();function g3(t){return function m3(t,e,n){if(cs(t)&&!n){const r=hs(t.index,e);return new Ii(r,r)}return 47&t.type?new Ii(e[16],e):null}(Oi(),Dn(),16==(16&t))}const D3=jD(null,"core",[]);let A3=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(Gt(jm))},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({}),t})(),L1=null;function lp(){return L1}const Os=new Er("DocumentToken");let OE=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:function(){return function L3(){return Gt(aA)}()},providedIn:"platform"}),t})();const N3=new Er("Location Initialized");let aA=(()=>{class t extends OE{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return lp().getBaseHref(this._doc)}onPopState(n){const r=lp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=lp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,i){lA()?this._history.pushState(n,r,i):this.location.hash=i}replaceState(n,r,i){lA()?this._history.replaceState(n,r,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:function(){return function k3(){return new aA(Gt(Os))}()},providedIn:"platform"}),t})();function lA(){return!!window.history.pushState}function LE(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function uA(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function ad(t){return t&&"?"!==t[0]?"?"+t:t}let ag=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:function(){return _a(hA)},providedIn:"root"}),t})();const cA=new Er("appBaseHref");let hA=(()=>{class t extends ag{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??_a(Os).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return LE(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+ad(this._platformLocation.search),i=this._platformLocation.hash;return i&&n?`${r}${i}`:r}pushState(n,r,i,s){const f=this.prepareExternalUrl(i+ad(s));this._platformLocation.pushState(n,r,f)}replaceState(n,r,i,s){const f=this.prepareExternalUrl(i+ad(s));this._platformLocation.replaceState(n,r,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return t.\u0275fac=function(n){return new(n||t)(Gt(OE),Gt(cA,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),F3=(()=>{class t extends ag{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=LE(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,i,s){let f=this.prepareExternalUrl(i+ad(s));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(n,r,f)}replaceState(n,r,i,s){let f=this.prepareExternalUrl(i+ad(s));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return t.\u0275fac=function(n){return new(n||t)(Gt(OE),Gt(cA,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),q_=(()=>{class t{constructor(n){this._subject=new Iu,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._baseHref=uA(fA(r)),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+ad(r))}normalize(n){return t.stripTrailingSlash(function z3(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,fA(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",i=null){this._locationStrategy.pushState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ad(r)),i)}replaceState(n,r="",i=null){this._locationStrategy.replaceState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ad(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(i=>i(n,r))}subscribe(n,r,i){return this._subject.subscribe({next:n,error:r,complete:i})}}return t.normalizeQueryParams=ad,t.joinWithSlash=LE,t.stripTrailingSlash=uA,t.\u0275fac=function(n){return new(n||t)(Gt(ag))},t.\u0275prov=zn({token:t,factory:function(){return function B3(){return new q_(Gt(ag))}()},providedIn:"root"}),t})();function fA(t){return t.replace(/\/index.html$/,"")}function wA(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const r=n.indexOf("="),[i,s]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}let t4=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({}),t})();const MA="browser";let s4=(()=>{class t{}return t.\u0275prov=zn({token:t,providedIn:"root",factory:()=>new a4(Gt(Os),window)}),t})();class a4{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function l4(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const s=i.shadowRoot;if(s){const f=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(f)return f}i=r.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),r=n.left+this.window.pageXOffset,i=n.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=DA(this.window.history)||DA(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function DA(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class AA{}class YE extends class N4 extends class O3{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function R3(t){L1||(L1=t)}(new YE)}onAndCancel(e,n,r){return e.addEventListener(n,r,!1),()=>{e.removeEventListener(n,r,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function k4(){return Z_=Z_||document.querySelector("base"),Z_?Z_.getAttribute("href"):null}();return null==n?null:function F4(t){H1=H1||document.createElement("a"),H1.setAttribute("href",t);const e=H1.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){Z_=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return wA(document.cookie,e)}}let H1,Z_=null;const NA=new Er("TRANSITION_ID"),z4=[{provide:S1,useFactory:function B4(t,e,n){return()=>{n.get(T1).donePromise.then(()=>{const r=lp(),i=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let s=0;s<i.length;s++)r.remove(i[s])})}},deps:[NA,Os,du],multi:!0}];let V4=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();const W1=new Er("EventManagerPlugins");let X1=(()=>{class t{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(i=>i.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,i){return this._findPluginFor(r).addEventListener(n,r,i)}addGlobalEventListener(n,r,i){return this._findPluginFor(r).addGlobalEventListener(n,r,i)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const i=this._plugins;for(let s=0;s<i.length;s++){const f=i[s];if(f.supports(n))return this._eventNameToPlugin.set(n,f),f}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(Gt(W1),Gt(ua))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();class kA{constructor(e){this._doc=e}addGlobalEventListener(e,n,r){const i=lp().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${n}`);return this.addEventListener(i,n,r)}}let FA=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),Y_=(()=>{class t extends FA{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,i){n.forEach(s=>{const f=this._doc.createElement("style");f.textContent=s,i.push(r.appendChild(f))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(BA),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(n,i,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(BA))}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();function BA(t){lp().remove(t)}const KE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},JE=/%COMP%/g;function Z1(t,e,n){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?Z1(t,i,n):(i=i.replace(JE,t),n.push(i))}return n}function VA(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let Y1=(()=>{class t{constructor(n,r,i){this.eventManager=n,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new QE(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case bo.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new W4(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(n),i}case 1:case bo.ShadowDom:return new X4(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const i=Z1(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(Gt(X1),Gt(Y_),Gt(G_))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();class QE{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(KE[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){(GA(e)?e.content:e).appendChild(n)}insertBefore(e,n,r){e&&(GA(e)?e.content:e).insertBefore(n,r)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return n||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,r,i){if(i){n=i+":"+n;const s=KE[i];s?e.setAttributeNS(s,n,r):e.setAttribute(n,r)}else e.setAttribute(n,r)}removeAttribute(e,n,r){if(r){const i=KE[r];i?e.removeAttributeNS(i,n):e.removeAttribute(`${r}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,r,i){i&(xl.DashCase|xl.Important)?e.style.setProperty(n,r,i&xl.Important?"important":""):e.style[n]=r}removeStyle(e,n,r){r&xl.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,r){e[n]=r}setValue(e,n){e.nodeValue=n}listen(e,n,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,VA(r)):this.eventManager.addEventListener(e,n,VA(r))}}function GA(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class W4 extends QE{constructor(e,n,r,i){super(e),this.component=r;const s=Z1(i+"-"+r.id,r.styles,[]);n.addStyles(s),this.contentAttr=function $4(t){return"_ngcontent-%COMP%".replace(JE,t)}(i+"-"+r.id),this.hostAttr=function q4(t){return"_nghost-%COMP%".replace(JE,t)}(i+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const r=super.createElement(e,n);return super.setAttribute(r,this.contentAttr,""),r}}class X4 extends QE{constructor(e,n,r,i){super(e),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Z1(i.id,i.styles,[]);for(let f=0;f<s.length;f++){const g=document.createElement("style");g.textContent=s[f],this.shadowRoot.appendChild(g)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,r){return super.insertBefore(this.nodeOrShadowRoot(e),n,r)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Z4=(()=>{class t extends kA{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,i){return n.addEventListener(r,i,!1),()=>this.removeEventListener(n,r,i)}removeEventListener(n,r,i){return n.removeEventListener(r,i)}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();const $A=["alt","control","meta","shift"],Y4={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},K4={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let J4=(()=>{class t extends kA{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,r,i){const s=t.parseEventName(r),f=t.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>lp().onAndCancel(n,s.domEventName,f))}static parseEventName(n){const r=n.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=t._normalizeKey(r.pop());let f="",g=r.indexOf("code");if(g>-1&&(r.splice(g,1),f="code."),$A.forEach(x=>{const M=r.indexOf(x);M>-1&&(r.splice(M,1),f+=x+".")}),f+=s,0!=r.length||0===s.length)return null;const v={};return v.domEventName=i,v.fullKey=f,v}static matchEventFullKeyCode(n,r){let i=Y4[n.key]||n.key,s="";return r.indexOf("code.")>-1&&(i=n.code,s="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),$A.forEach(f=>{f!==i&&(0,K4[f])(n)&&(s+=f+".")}),s+=i,s===r)}static eventCallback(n,r,i){return s=>{t.matchEventFullKeyCode(s,n)&&i.runGuarded(()=>r(s))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();const n5=jD(D3,"browser",[{provide:I1,useValue:MA},{provide:RD,useValue:function Q4(){YE.makeCurrent()},multi:!0},{provide:Os,useFactory:function t5(){return function Xf(t){Yg=t}(document),document},deps:[]}]),WA=new Er(""),XA=[{provide:M1,useClass:class U4{addToWindow(e){Zi.getAngularTestability=(r,i=!0)=>{const s=e.findTestabilityInTree(r,i);if(null==s)throw new Error("Could not find testability for element.");return s},Zi.getAllAngularTestabilities=()=>e.getAllTestabilities(),Zi.getAllAngularRootElements=()=>e.getAllRootElements(),Zi.frameworkStabilizers||(Zi.frameworkStabilizers=[]),Zi.frameworkStabilizers.push(r=>{const i=Zi.getAllAngularTestabilities();let s=i.length,f=!1;const g=function(v){f=f||v,s--,0==s&&r(f)};i.forEach(function(v){v.whenStable(g)})})}findTestabilityInTree(e,n,r){return null==n?null:e.getTestability(n)??(r?lp().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null)}},deps:[]},{provide:BD,useClass:CE,deps:[ua,SE,M1]},{provide:CE,useClass:CE,deps:[ua,SE,M1]}],ZA=[{provide:am,useValue:"root"},{provide:Jf,useFactory:function e5(){return new Jf},deps:[]},{provide:W1,useClass:Z4,multi:!0,deps:[Os,ua,I1]},{provide:W1,useClass:J4,multi:!0,deps:[Os]},{provide:Y1,useClass:Y1,deps:[X1,Y_,G_]},{provide:Xp,useExisting:Y1},{provide:FA,useExisting:Y_},{provide:Y_,useClass:Y_,deps:[Os]},{provide:X1,useClass:X1,deps:[W1,ua]},{provide:AA,useClass:V4,deps:[]},[]];let YA=(()=>{class t{constructor(n){}static withServerTransition(n){return{ngModule:t,providers:[{provide:G_,useValue:n.appId},{provide:NA,useExisting:G_},z4]}}}return t.\u0275fac=function(n){return new(n||t)(Gt(WA,12))},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({providers:[...ZA,...XA],imports:[t4,A3]}),t})(),KA=(()=>{class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:function(n){let r=null;return r=n?new n:function o5(){return new KA(Gt(Os))}(),r},providedIn:"root"}),t})();function fi(...t){return Wi(t,Fn(t))}typeof window<"u"&&window;class xh extends xt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){const{hasError:e,thrownError:n,_value:r}=this;if(e)throw n;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}const K1=ye(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:d5}=Array,{getPrototypeOf:p5,prototype:g5,keys:m5}=Object;const{isArray:v5}=Array;function eP(t){return At(e=>function x5(t,e){return v5(e)?t(...e):t(e)}(t,e))}function tP(...t){const e=Fn(t),n=function dn(t){return de(zt(t))?t.pop():void 0}(t),{args:r,keys:i}=function y5(t){if(1===t.length){const e=t[0];if(d5(e))return{args:e,keys:null};if(function _5(t){return t&&"object"==typeof t&&p5(t)===g5}(e)){const n=m5(e);return{args:n.map(r=>e[r]),keys:n}}}return{args:t,keys:null}}(t);if(0===r.length)return Wi([],e);const s=new Bt(function b5(t,e,n=We){return r=>{nP(e,()=>{const{length:i}=t,s=new Array(i);let f=i,g=i;for(let v=0;v<i;v++)nP(e,()=>{const x=Wi(t[v],e);let M=!1;x.subscribe(new pn(r,R=>{s[v]=R,M||(M=!0,g--),g||r.next(n(s.slice()))},()=>{--f||r.complete()}))},r)},r)}}(r,e,i?f=>function w5(t,e){return t.reduce((n,r,i)=>(n[r]=e[i],n),{})}(i,f):We));return n?s.pipe(eP(n)):s}function nP(t,e,n){t?ce(n,t,e):e()}function nC(...t){return function E5(){return et(1)}()(Wi(t,Fn(t)))}function rC(t){return new Bt(e=>{Tn(t()).subscribe(e)})}function K_(t,e){const n=de(t)?t:()=>t,r=i=>i.error(n());return new Bt(e?i=>e.schedule(r,0,i):r)}function iC(){return $t((t,e)=>{let n=null;t._refCount++;const r=new pn(e,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(n=null);const i=t._connection,s=n;n=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});t.subscribe(r),r.closed||(n=t.connect())})}class rP extends Bt{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,qt(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new K;const n=this.getSubject();e.add(this.source.subscribe(new pn(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=K.EMPTY)}return e}refCount(){return iC()(this)}}function Df(t,e){return $t((n,r)=>{let i=null,s=0,f=!1;const g=()=>f&&!i&&r.complete();n.subscribe(new pn(r,v=>{i?.unsubscribe();let x=0;const M=s++;Tn(t(v,M)).subscribe(i=new pn(r,R=>r.next(e?e(v,R,M,x++):R),()=>{i=null,g()}))},()=>{f=!0,g()}))})}function iP(...t){const e=Fn(t);return $t((n,r)=>{(e?nC(t,n,e):nC(t,n)).subscribe(r)})}function gc(t,e){return $t((n,r)=>{let i=0;n.subscribe(new pn(r,s=>t.call(e,s,i++)&&r.next(s)))})}function J1(t){return $t((e,n)=>{let r=!1;e.subscribe(new pn(n,i=>{r=!0,n.next(i)},()=>{r||n.next(t),n.complete()}))})}function oP(t=C5){return $t((e,n)=>{let r=!1;e.subscribe(new pn(n,i=>{r=!0,n.next(i)},()=>r?n.complete():n.error(t())))})}function C5(){return new K1}function cp(t,e){const n=arguments.length>=2;return r=>r.pipe(t?gc((i,s)=>t(i,s,r)):We,Yt(1),n?J1(e):oP(()=>new K1))}function hp(t,e){return de(e)?ze(t,e,1):ze(t,1)}function Ku(t,e,n){const r=de(t)||e||n?{next:t,error:e,complete:n}:t;return r?$t((i,s)=>{var f;null===(f=r.subscribe)||void 0===f||f.call(r);let g=!0;i.subscribe(new pn(s,v=>{var x;null===(x=r.next)||void 0===x||x.call(r,v),s.next(v)},()=>{var v;g=!1,null===(v=r.complete)||void 0===v||v.call(r),s.complete()},v=>{var x;g=!1,null===(x=r.error)||void 0===x||x.call(r,v),s.error(v)},()=>{var v,x;g&&(null===(v=r.unsubscribe)||void 0===v||v.call(r)),null===(x=r.finalize)||void 0===x||x.call(r)}))}):We}function fp(t){return $t((e,n)=>{let s,r=null,i=!1;r=e.subscribe(new pn(n,void 0,void 0,f=>{s=Tn(t(f,fp(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function S5(t,e,n,r,i){return(s,f)=>{let g=n,v=e,x=0;s.subscribe(new pn(f,M=>{const R=x++;v=g?t(v,M,R):(g=!0,M),r&&f.next(v)},i&&(()=>{g&&f.next(v),f.complete()})))}}function sP(t,e){return $t(S5(t,e,arguments.length>=2,!0))}function oC(t){return t<=0?()=>yt:$t((e,n)=>{let r=[];e.subscribe(new pn(n,i=>{r.push(i),t<r.length&&r.shift()},()=>{for(const i of r)n.next(i);n.complete()},void 0,()=>{r=null}))})}function aP(t,e){const n=arguments.length>=2;return r=>r.pipe(t?gc((i,s)=>t(i,s,r)):We,oC(1),n?J1(e):oP(()=>new K1))}function sC(t){return $t((e,n)=>{try{e.subscribe(n)}finally{n.add(t)}})}const Do="primary",J_=Symbol("RouteTitle");class M5{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function $m(t){return new M5(t)}function D5(t,e,n){const r=n.path.split("/");if(r.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;const i={};for(let s=0;s<r.length;s++){const f=r[s],g=t[s];if(f.startsWith(":"))i[f.substring(1)]=g;else if(f!==g.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}function Af(t,e){const n=t?Object.keys(t):void 0,r=e?Object.keys(e):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!lP(t[i],e[i]))return!1;return!0}function lP(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),r=[...e].sort();return n.every((i,s)=>r[s]===i)}return t===e}function uP(t){return Array.prototype.concat.apply([],t)}function cP(t){return t.length>0?t[t.length-1]:null}function Uu(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function dp(t){return SI(t)?t:p1(t)?Wi(Promise.resolve(t)):fi(t)}const R5={exact:function dP(t,e,n){if(!ug(t.segments,e.segments)||!Q1(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!t.children[r]||!dP(t.children[r],e.children[r],n))return!1;return!0},subset:pP},hP={exact:function O5(t,e){return Af(t,e)},subset:function L5(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>lP(t[n],e[n]))},ignored:()=>!0};function fP(t,e,n){return R5[n.paths](t.root,e.root,n.matrixParams)&&hP[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function pP(t,e,n){return gP(t,e,e.segments,n)}function gP(t,e,n,r){if(t.segments.length>n.length){const i=t.segments.slice(0,n.length);return!(!ug(i,n)||e.hasChildren()||!Q1(i,n,r))}if(t.segments.length===n.length){if(!ug(t.segments,n)||!Q1(t.segments,n,r))return!1;for(const i in e.children)if(!t.children[i]||!pP(t.children[i],e.children[i],r))return!1;return!0}{const i=n.slice(0,t.segments.length),s=n.slice(t.segments.length);return!!(ug(t.segments,i)&&Q1(t.segments,i,r)&&t.children[Do])&&gP(t.children[Do],e,s,r)}}function Q1(t,e,n){return e.every((r,i)=>hP[n](t[i].parameters,r.parameters))}class lg{constructor(e,n,r){this.root=e,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$m(this.queryParams)),this._queryParamMap}toString(){return F5.serialize(this)}}class is{constructor(e,n){this.segments=e,this.children=n,this.parent=null,Uu(n,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ex(this)}}class Q_{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=$m(this.parameters)),this._parameterMap}toString(){return vP(this)}}function ug(t,e){return t.length===e.length&&t.every((n,r)=>n.path===e[r].path)}let mP=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:function(){return new lC},providedIn:"root"}),t})();class lC{parse(e){const n=new H5(e);return new lg(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){const n=`/${ev(e.root,!0)}`,r=function U5(t){const e=Object.keys(t).map(n=>{const r=t[n];return Array.isArray(r)?r.map(i=>`${tx(n)}=${tx(i)}`).join("&"):`${tx(n)}=${tx(r)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${n}${r}${"string"==typeof e.fragment?`#${function B5(t){return encodeURI(t)}(e.fragment)}`:""}`}}const F5=new lC;function ex(t){return t.segments.map(e=>vP(e)).join("/")}function ev(t,e){if(!t.hasChildren())return ex(t);if(e){const n=t.children[Do]?ev(t.children[Do],!1):"",r=[];return Uu(t.children,(i,s)=>{s!==Do&&r.push(`${s}:${ev(i,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function k5(t,e){let n=[];return Uu(t.children,(r,i)=>{i===Do&&(n=n.concat(e(r,i)))}),Uu(t.children,(r,i)=>{i!==Do&&(n=n.concat(e(r,i)))}),n}(t,(r,i)=>i===Do?[ev(t.children[Do],!1)]:[`${i}:${ev(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Do]?`${ex(t)}/${n[0]}`:`${ex(t)}/(${n.join("//")})`}}function yP(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function tx(t){return yP(t).replace(/%3B/gi,";")}function uC(t){return yP(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function nx(t){return decodeURIComponent(t)}function _P(t){return nx(t.replace(/\+/g,"%20"))}function vP(t){return`${uC(t.path)}${function z5(t){return Object.keys(t).map(e=>`;${uC(e)}=${uC(t[e])}`).join("")}(t.parameters)}`}const V5=/^[^\/()?;=#]+/;function rx(t){const e=t.match(V5);return e?e[0]:""}const j5=/^[^=?&#]+/,$5=/^[^&#]+/;class H5{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new is([],{}):new is([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(r[Do]=new is(e,n)),r}parseSegment(){const e=rx(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new On(4009,!1);return this.capture(e),new Q_(nx(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=rx(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const i=rx(this.remaining);i&&(r=i,this.capture(r))}e[nx(n)]=nx(r)}parseQueryParam(e){const n=function G5(t){const e=t.match(j5);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const f=function q5(t){const e=t.match($5);return e?e[0]:""}(this.remaining);f&&(r=f,this.capture(r))}const i=_P(n),s=_P(r);if(e.hasOwnProperty(i)){let f=e[i];Array.isArray(f)||(f=[f],e[i]=f),f.push(s)}else e[i]=s}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=rx(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new On(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=Do);const f=this.parseChildren();n[s]=1===Object.keys(f).length?f[Do]:new is([],f),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new On(4011,!1)}}function cC(t){return t.segments.length>0?new is([],{[Do]:t}):t}function ix(t){const e={};for(const r of Object.keys(t.children)){const s=ix(t.children[r]);(s.segments.length>0||s.hasChildren())&&(e[r]=s)}return function W5(t){if(1===t.numberOfChildren&&t.children[Do]){const e=t.children[Do];return new is(t.segments.concat(e.segments),e.children)}return t}(new is(t.segments,e))}function cg(t){return t instanceof lg}function Y5(t,e,n,r,i){if(0===n.length)return qm(e.root,e.root,e.root,r,i);const s=function bP(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new wP(!0,0,t);let e=0,n=!1;const r=t.reduce((i,s,f)=>{if("object"==typeof s&&null!=s){if(s.outlets){const g={};return Uu(s.outlets,(v,x)=>{g[x]="string"==typeof v?v.split("/"):v}),[...i,{outlets:g}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===f?(s.split("/").forEach((g,v)=>{0==v&&"."===g||(0==v&&""===g?n=!0:".."===g?e++:""!=g&&i.push(g))}),i):[...i,s]},[]);return new wP(n,e,r)}(n);return s.toRoot()?qm(e.root,e.root,new is([],{}),r,i):function f(v){const x=function J5(t,e,n,r){if(t.isAbsolute)return new Hm(e.root,!0,0);if(-1===r)return new Hm(n,n===e.root,0);return function EP(t,e,n){let r=t,i=e,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new On(4005,!1);i=r.segments.length}return new Hm(r,!1,i-s)}(n,r+(tv(t.commands[0])?0:1),t.numberOfDoubleDots)}(s,e,t.snapshot?._urlSegment,v),M=x.processChildren?rv(x.segmentGroup,x.index,s.commands):fC(x.segmentGroup,x.index,s.commands);return qm(e.root,x.segmentGroup,M,r,i)}(t.snapshot?._lastPathIndex)}function tv(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function nv(t){return"object"==typeof t&&null!=t&&t.outlets}function qm(t,e,n,r,i){let f,s={};r&&Uu(r,(v,x)=>{s[x]=Array.isArray(v)?v.map(M=>`${M}`):`${v}`}),f=t===e?n:xP(t,e,n);const g=cC(ix(f));return new lg(g,s,i)}function xP(t,e,n){const r={};return Uu(t.children,(i,s)=>{r[s]=i===e?n:xP(i,e,n)}),new is(t.segments,r)}class wP{constructor(e,n,r){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=r,e&&r.length>0&&tv(r[0]))throw new On(4003,!1);const i=r.find(nv);if(i&&i!==cP(r))throw new On(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Hm{constructor(e,n,r){this.segmentGroup=e,this.processChildren=n,this.index=r}}function fC(t,e,n){if(t||(t=new is([],{})),0===t.segments.length&&t.hasChildren())return rv(t,e,n);const r=function eU(t,e,n){let r=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(r>=n.length)return s;const f=t.segments[i],g=n[r];if(nv(g))break;const v=`${g}`,x=r<n.length-1?n[r+1]:null;if(i>0&&void 0===v)break;if(v&&x&&"object"==typeof x&&void 0===x.outlets){if(!SP(v,x,f))return s;r+=2}else{if(!SP(v,{},f))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(t,e,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const s=new is(t.segments.slice(0,r.pathIndex),{});return s.children[Do]=new is(t.segments.slice(r.pathIndex),t.children),rv(s,0,i)}return r.match&&0===i.length?new is(t.segments,{}):r.match&&!t.hasChildren()?dC(t,e,n):r.match?rv(t,0,i):dC(t,e,n)}function rv(t,e,n){if(0===n.length)return new is(t.segments,{});{const r=function Q5(t){return nv(t[0])?t[0].outlets:{[Do]:t}}(n),i={};return Uu(r,(s,f)=>{"string"==typeof s&&(s=[s]),null!==s&&(i[f]=fC(t.children[f],e,s))}),Uu(t.children,(s,f)=>{void 0===r[f]&&(i[f]=s)}),new is(t.segments,i)}}function dC(t,e,n){const r=t.segments.slice(0,e);let i=0;for(;i<n.length;){const s=n[i];if(nv(s)){const v=tU(s.outlets);return new is(r,v)}if(0===i&&tv(n[0])){r.push(new Q_(t.segments[e].path,CP(n[0]))),i++;continue}const f=nv(s)?s.outlets[Do]:`${s}`,g=i<n.length-1?n[i+1]:null;f&&g&&tv(g)?(r.push(new Q_(f,CP(g))),i+=2):(r.push(new Q_(f,{})),i++)}return new is(r,{})}function tU(t){const e={};return Uu(t,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[r]=dC(new is([],{}),0,n))}),e}function CP(t){const e={};return Uu(t,(n,r)=>e[r]=`${n}`),e}function SP(t,e,n){return t==n.path&&Af(e,n.parameters)}class ud{constructor(e,n){this.id=e,this.url=n}}class pC extends ud{constructor(e,n,r="imperative",i=null){super(e,n),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class hg extends ud{constructor(e,n,r){super(e,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ox extends ud{constructor(e,n,r,i){super(e,n),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class TP extends ud{constructor(e,n,r,i){super(e,n),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class nU extends ud{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rU extends ud{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iU extends ud{constructor(e,n,r,i,s){super(e,n),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class oU extends ud{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class sU extends ud{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class aU{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class lU{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class uU{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cU{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hU{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fU{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class IP{constructor(e,n,r){this.routerEvent=e,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class MP{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=gC(e,this._root);return n?n.children.map(r=>r.value):[]}firstChild(e){const n=gC(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=mC(e,this._root);return n.length<2?[]:n[n.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return mC(e,this._root).map(n=>n.value)}}function gC(t,e){if(t===e.value)return e;for(const n of e.children){const r=gC(t,n);if(r)return r}return null}function mC(t,e){if(t===e.value)return[e];for(const n of e.children){const r=mC(t,n);if(r.length)return r.unshift(e),r}return[]}class cd{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function Wm(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class DP extends MP{constructor(e,n){super(e),this.snapshot=n,yC(this,e)}toString(){return this.snapshot.toString()}}function AP(t,e){const n=function pU(t,e){const f=new sx([],{},{},"",{},Do,e,null,t.root,-1,{});return new RP("",new cd(f,[]))}(t,e),r=new xh([new Q_("",{})]),i=new xh({}),s=new xh({}),f=new xh({}),g=new xh(""),v=new fg(r,i,f,g,s,Do,e,n.root);return v.snapshot=n.root,new DP(new cd(v,[]),n)}class fg{constructor(e,n,r,i,s,f,g,v){this.url=e,this.params=n,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=f,this.component=g,this.title=this.data?.pipe(At(x=>x[J_]))??fi(void 0),this._futureSnapshot=v}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(At(e=>$m(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(At(e=>$m(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function PP(t,e="emptyOnly"){const n=t.pathFromRoot;let r=0;if("always"!==e)for(r=n.length-1;r>=1;){const i=n[r],s=n[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(s.component)break;r--}}return function gU(t){return t.reduce((e,n)=>({params:{...e.params,...n.params},data:{...e.data,...n.data},resolve:{...n.data,...e.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class sx{constructor(e,n,r,i,s,f,g,v,x,M,R,L){this.url=e,this.params=n,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=f,this.component=g,this.title=this.data?.[J_],this.routeConfig=v,this._urlSegment=x,this._lastPathIndex=M,this._correctedLastPathIndex=L??M,this._resolve=R}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=$m(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$m(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class RP extends MP{constructor(e,n){super(n),this.url=e,yC(this,n)}toString(){return OP(this._root)}}function yC(t,e){e.value._routerState=t,e.children.forEach(n=>yC(t,n))}function OP(t){const e=t.children.length>0?` { ${t.children.map(OP).join(", ")} } `:"";return`${t.value}${e}`}function _C(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Af(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Af(e.params,n.params)||t.params.next(n.params),function A5(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Af(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Af(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function vC(t,e){const n=Af(t.params,e.params)&&function N5(t,e){return ug(t,e)&&t.every((n,r)=>Af(n.parameters,e[r].parameters))}(t.url,e.url);return n&&!(!t.parent!=!e.parent)&&(!t.parent||vC(t.parent,e.parent))}function iv(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=e.value;const i=function yU(t,e,n){return e.children.map(r=>{for(const i of n.children)if(t.shouldReuseRoute(r.value,i.value.snapshot))return iv(t,r,i);return iv(t,r)})}(t,e,n);return new cd(r,i)}{if(t.shouldAttach(e.value)){const s=t.retrieve(e.value);if(null!==s){const f=s.route;return f.value._futureSnapshot=e.value,f.children=e.children.map(g=>iv(t,g)),f}}const r=function _U(t){return new fg(new xh(t.url),new xh(t.params),new xh(t.queryParams),new xh(t.fragment),new xh(t.data),t.outlet,t.component,t)}(e.value),i=e.children.map(s=>iv(t,s));return new cd(r,i)}}const xC="ngNavigationCancelingError";function LP(t,e){const{redirectTo:n,navigationBehaviorOptions:r}=cg(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=NP(!1,0,e);return i.url=n,i.navigationBehaviorOptions=r,i}function NP(t,e,n){const r=new Error("NavigationCancelingError: "+(t||""));return r[xC]=!0,r.cancellationCode=e,n&&(r.url=n),r}function kP(t){return FP(t)&&cg(t.url)}function FP(t){return t&&t[xC]}class vU{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new ov,this.attachRef=null}}let ov=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const i=this.getOrCreateContext(n);i.outlet=r,this.contexts.set(n,i)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new vU,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ax=!1;let wC=(()=>{class t{constructor(n,r,i,s,f){this.parentContexts=n,this.location=r,this.changeDetector=s,this.environmentInjector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new Iu,this.deactivateEvents=new Iu,this.attachEvents=new Iu,this.detachEvents=new Iu,this.name=i||Do,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new On(4012,ax);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new On(4012,ax);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new On(4012,ax);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new On(4013,ax);this._activatedRoute=n;const i=this.location,f=n._futureSnapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,v=new xU(n,g,i.injector);if(r&&function wU(t){return!!t.resolveComponentFactory}(r)){const x=r.resolveComponentFactory(f);this.activated=i.createComponent(x,i.length,v)}else this.activated=i.createComponent(f,{index:i.length,injector:v,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(Tr(ov),Tr(yh),function nl(t){return function gr(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const r=n.length;let i=0;for(;i<r;){const s=n[i];if(tt(s))break;if(0===s)i+=2;else if("number"==typeof s)for(i++;i<r&&"string"==typeof n[i];)i++;else{if(s===e)return n[i+1];i+=2}}}return null}(Oi(),t)}("name"),Tr(A1),Tr(pf))},t.\u0275dir=Fi({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),t})();class xU{constructor(e,n,r){this.route=e,this.childContexts=n,this.parent=r}get(e,n){return e===fg?this.route:e===ov?this.childContexts:this.parent.get(e,n)}}let bC=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ja({type:t,selectors:[["ng-component"]],standalone:!0,features:[WM],decls:1,vars:0,template:function(n,r){1&n&&sp(0,"router-outlet")},dependencies:[wC],encapsulation:2}),t})();function BP(t,e){return t.providers&&!t._injector&&(t._injector=w1(t.providers,e,`Route: ${t.path}`)),t._injector??e}function CC(t){const e=t.children&&t.children.map(CC),n=e?{...t,children:e}:{...t};return!n.component&&!n.loadComponent&&(e||n.loadChildren)&&n.outlet&&n.outlet!==Do&&(n.component=bC),n}function wh(t){return t.outlet||Do}function zP(t,e){const n=t.filter(r=>wh(r)===e);return n.push(...t.filter(r=>wh(r)!==e)),n}function sv(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class TU{constructor(e,n,r,i){this.routeReuseStrategy=e,this.futureState=n,this.currState=r,this.forwardEvent=i}activate(e){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,e),_C(this.futureState.root),this.activateChildRoutes(n,r,e)}deactivateChildRoutes(e,n,r){const i=Wm(n);e.children.forEach(s=>{const f=s.value.outlet;this.deactivateRoutes(s,i[f],r),delete i[f]}),Uu(i,(s,f)=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,n,r){const i=e.value,s=n?n.value:null;if(i===s)if(i.component){const f=r.getContext(i.outlet);f&&this.deactivateChildRoutes(e,n,f.children)}else this.deactivateChildRoutes(e,n,r);else s&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const r=n.getContext(e.value.outlet),i=r&&e.value.component?r.children:n,s=Wm(e);for(const f of Object.keys(s))this.deactivateRouteAndItsChildren(s[f],i);if(r&&r.outlet){const f=r.outlet.detach(),g=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:f,route:e,contexts:g})}}deactivateRouteAndOutlet(e,n){const r=n.getContext(e.value.outlet),i=r&&e.value.component?r.children:n,s=Wm(e);for(const f of Object.keys(s))this.deactivateRouteAndItsChildren(s[f],i);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,n,r){const i=Wm(n);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new fU(s.value.snapshot))}),e.children.length&&this.forwardEvent(new cU(e.value.snapshot))}activateRoutes(e,n,r){const i=e.value,s=n?n.value:null;if(_C(i),i===s)if(i.component){const f=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,n,f.children)}else this.activateChildRoutes(e,n,r);else if(i.component){const f=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const g=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),f.children.onOutletReAttached(g.contexts),f.attachRef=g.componentRef,f.route=g.route.value,f.outlet&&f.outlet.attach(g.componentRef,g.route.value),_C(g.route.value),this.activateChildRoutes(e,null,f.children)}else{const g=sv(i.snapshot),v=g?.get(ph)??null;f.attachRef=null,f.route=i,f.resolver=v,f.injector=g,f.outlet&&f.outlet.activateWith(i,f.injector),this.activateChildRoutes(e,null,f.children)}}else this.activateChildRoutes(e,null,r)}}class UP{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class lx{constructor(e,n){this.component=e,this.route=n}}function IU(t,e,n){const r=t._root;return av(r,e?e._root:null,n,[r.value])}function Xm(t,e){const n=Symbol(),r=e.get(t,n);return r===n?"function"!=typeof t||function ha(t){return null!==bs(t)}(t)?e.get(t):t:r}function av(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Wm(e);return t.children.forEach(f=>{(function DU(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=t.value,f=e?e.value:null,g=n?n.getContext(t.value.outlet):null;if(f&&s.routeConfig===f.routeConfig){const v=function AU(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!ug(t.url,e.url);case"pathParamsOrQueryParamsChange":return!ug(t.url,e.url)||!Af(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!vC(t,e)||!Af(t.queryParams,e.queryParams);default:return!vC(t,e)}}(f,s,s.routeConfig.runGuardsAndResolvers);v?i.canActivateChecks.push(new UP(r)):(s.data=f.data,s._resolvedData=f._resolvedData),av(t,e,s.component?g?g.children:null:n,r,i),v&&g&&g.outlet&&g.outlet.isActivated&&i.canDeactivateChecks.push(new lx(g.outlet.component,f))}else f&&lv(e,g,i),i.canActivateChecks.push(new UP(r)),av(t,null,s.component?g?g.children:null:n,r,i)})(f,s[f.value.outlet],n,r.concat([f.value]),i),delete s[f.value.outlet]}),Uu(s,(f,g)=>lv(f,n.getContext(g),i)),i}function lv(t,e,n){const r=Wm(t),i=t.value;Uu(r,(s,f)=>{lv(s,i.component?e?e.children.getContext(f):null:e,n)}),n.canDeactivateChecks.push(new lx(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}function uv(t){return"function"==typeof t}function SC(t){return t instanceof K1||"EmptyError"===t?.name}const ux=Symbol("INITIAL_VALUE");function Zm(){return Df(t=>tP(t.map(e=>e.pipe(Yt(1),iP(ux)))).pipe(At(e=>{for(const n of e)if(!0!==n){if(n===ux)return ux;if(!1===n||n instanceof lg)return n}return!0}),gc(e=>e!==ux),Yt(1)))}function VP(t){return function Se(...t){return ln(t)}(Ku(e=>{if(cg(e))throw LP(0,e)}),At(e=>!0===e))}const TC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function jP(t,e,n,r,i){const s=IC(t,e,n);return s.matched?function WU(t,e,n,r){const i=e.canMatch;return i&&0!==i.length?fi(i.map(f=>{const g=Xm(f,t);return dp(function kU(t){return t&&uv(t.canMatch)}(g)?g.canMatch(e,n):t.runInContext(()=>g(e,n)))})).pipe(Zm(),VP()):fi(!0)}(r=BP(e,r),e,n).pipe(At(f=>!0===f?s:{...TC})):fi(s)}function IC(t,e,n){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?{...TC}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const i=(e.matcher||D5)(n,t,e);if(!i)return{...TC};const s={};Uu(i.posParams,(g,v)=>{s[v]=g.path});const f=i.consumed.length>0?{...s,...i.consumed[i.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:n.slice(i.consumed.length),parameters:f,positionalParamSegments:i.posParams??{}}}function cx(t,e,n,r,i="corrected"){if(n.length>0&&function YU(t,e,n){return n.some(r=>hx(t,e,r)&&wh(r)!==Do)}(t,n,r)){const f=new is(e,function ZU(t,e,n,r){const i={};i[Do]=r,r._sourceSegment=t,r._segmentIndexShift=e.length;for(const s of n)if(""===s.path&&wh(s)!==Do){const f=new is([],{});f._sourceSegment=t,f._segmentIndexShift=e.length,i[wh(s)]=f}return i}(t,e,r,new is(n,t.children)));return f._sourceSegment=t,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:[]}}if(0===n.length&&function KU(t,e,n){return n.some(r=>hx(t,e,r))}(t,n,r)){const f=new is(t.segments,function XU(t,e,n,r,i,s){const f={};for(const g of r)if(hx(t,n,g)&&!i[wh(g)]){const v=new is([],{});v._sourceSegment=t,v._segmentIndexShift="legacy"===s?t.segments.length:e.length,f[wh(g)]=v}return{...i,...f}}(t,e,n,r,t.children,i));return f._sourceSegment=t,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:n}}const s=new is(t.segments,t.children);return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:n}}function hx(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function GP(t,e,n,r){return!!(wh(t)===r||r!==Do&&hx(e,n,t))&&("**"===t.path||IC(e,t,n).matched)}function $P(t,e,n){return 0===e.length&&!t.children[n]}const fx=!1;class dx{constructor(e){this.segmentGroup=e||null}}class qP{constructor(e){this.urlTree=e}}function cv(t){return K_(new dx(t))}function HP(t){return K_(new qP(t))}class tV{constructor(e,n,r,i,s){this.injector=e,this.configLoader=n,this.urlSerializer=r,this.urlTree=i,this.config=s,this.allowRedirects=!0}apply(){const e=cx(this.urlTree.root,[],[],this.config).segmentGroup,n=new is(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,n,Do).pipe(At(s=>this.createUrlTree(ix(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(fp(s=>{if(s instanceof qP)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof dx?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,Do).pipe(At(i=>this.createUrlTree(ix(i),e.queryParams,e.fragment))).pipe(fp(i=>{throw i instanceof dx?this.noMatchError(i):i}))}noMatchError(e){return new On(4002,fx)}createUrlTree(e,n,r){const i=cC(e);return new lg(i,n,r)}expandSegmentGroup(e,n,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,n,r).pipe(At(s=>new is([],s))):this.expandSegment(e,r,n,r.segments,i,!0)}expandChildren(e,n,r){const i=[];for(const s of Object.keys(r.children))"primary"===s?i.unshift(s):i.push(s);return Wi(i).pipe(hp(s=>{const f=r.children[s],g=zP(n,s);return this.expandSegmentGroup(e,g,f,s).pipe(At(v=>({segment:v,outlet:s})))}),sP((s,f)=>(s[f.outlet]=f.segment,s),{}),aP())}expandSegment(e,n,r,i,s,f){return Wi(r).pipe(hp(g=>this.expandSegmentAgainstRoute(e,n,r,g,i,s,f).pipe(fp(x=>{if(x instanceof dx)return fi(null);throw x}))),cp(g=>!!g),fp((g,v)=>{if(SC(g))return $P(n,i,s)?fi(new is([],{})):cv(n);throw g}))}expandSegmentAgainstRoute(e,n,r,i,s,f,g){return GP(i,n,s,f)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,n,i,s,f):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,r,i,s,f):cv(n):cv(n)}expandSegmentAgainstRouteUsingRedirect(e,n,r,i,s,f){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,i,f):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,r,i,s,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,i){const s=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?HP(s):this.lineralizeSegments(r,s).pipe(ze(f=>{const g=new is(f,{});return this.expandSegment(e,g,n,f,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,r,i,s,f){const{matched:g,consumedSegments:v,remainingSegments:x,positionalParamSegments:M}=IC(n,i,s);if(!g)return cv(n);const R=this.applyRedirectCommands(v,i.redirectTo,M);return i.redirectTo.startsWith("/")?HP(R):this.lineralizeSegments(i,R).pipe(ze(L=>this.expandSegment(e,n,r,L.concat(x),f,!1)))}matchSegmentAgainstRoute(e,n,r,i,s){return"**"===r.path?(e=BP(r,e),r.loadChildren?(r._loadedRoutes?fi({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(e,r)).pipe(At(g=>(r._loadedRoutes=g.routes,r._loadedInjector=g.injector,new is(i,{})))):fi(new is(i,{}))):jP(n,r,i,e).pipe(Df(({matched:f,consumedSegments:g,remainingSegments:v})=>f?this.getChildConfig(e=r._injector??e,r,i).pipe(ze(M=>{const R=M.injector??e,L=M.routes,{segmentGroup:B,slicedSegments:ee}=cx(n,g,v,L),se=new is(B.segments,B.children);if(0===ee.length&&se.hasChildren())return this.expandChildren(R,L,se).pipe(At(ve=>new is(g,ve)));if(0===L.length&&0===ee.length)return fi(new is(g,{}));const Oe=wh(r)===s;return this.expandSegment(R,se,L,ee,Oe?Do:s,!0).pipe(At(_e=>new is(g.concat(_e.segments),_e.children)))})):cv(n)))}getChildConfig(e,n,r){return n.children?fi({routes:n.children,injector:e}):n.loadChildren?void 0!==n._loadedRoutes?fi({routes:n._loadedRoutes,injector:n._loadedInjector}):function HU(t,e,n,r){const i=e.canLoad;return void 0===i||0===i.length?fi(!0):fi(i.map(f=>{const g=Xm(f,t);return dp(function RU(t){return t&&uv(t.canLoad)}(g)?g.canLoad(e,n):t.runInContext(()=>g(e,n)))})).pipe(Zm(),VP())}(e,n,r).pipe(ze(i=>i?this.configLoader.loadChildren(e,n).pipe(Ku(s=>{n._loadedRoutes=s.routes,n._loadedInjector=s.injector})):function QU(t){return K_(NP(fx,3))}())):fi({routes:[],injector:e})}lineralizeSegments(e,n){let r=[],i=n.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return fi(r);if(i.numberOfChildren>1||!i.children[Do])return K_(new On(4e3,fx));i=i.children[Do]}}applyRedirectCommands(e,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),e,r)}applyRedirectCreateUrlTree(e,n,r,i){const s=this.createSegmentGroup(e,n.root,r,i);return new lg(s,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const r={};return Uu(e,(i,s)=>{if("string"==typeof i&&i.startsWith(":")){const g=i.substring(1);r[s]=n[g]}else r[s]=i}),r}createSegmentGroup(e,n,r,i){const s=this.createSegments(e,n.segments,r,i);let f={};return Uu(n.children,(g,v)=>{f[v]=this.createSegmentGroup(e,g,r,i)}),new is(s,f)}createSegments(e,n,r,i){return n.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,n,r){const i=r[n.path.substring(1)];if(!i)throw new On(4001,fx);return i}findOrReturn(e,n){let r=0;for(const i of n){if(i.path===e.path)return n.splice(r),i;r++}return e}}class rV{}class sV{constructor(e,n,r,i,s,f,g,v){this.injector=e,this.rootComponentType=n,this.config=r,this.urlTree=i,this.url=s,this.paramsInheritanceStrategy=f,this.relativeLinkResolution=g,this.urlSerializer=v}recognize(){const e=cx(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,Do).pipe(At(n=>{if(null===n)return null;const r=new sx([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Do,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new cd(r,n),s=new RP(this.url,i);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(e){const n=e.value,r=PP(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,n,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(e,n,r):this.processSegment(e,n,r,r.segments,i)}processChildren(e,n,r){return Wi(Object.keys(r.children)).pipe(hp(i=>{const s=r.children[i],f=zP(n,i);return this.processSegmentGroup(e,f,s,i)}),sP((i,s)=>i&&s?(i.push(...s),i):null),function T5(t,e=!1){return $t((n,r)=>{let i=0;n.subscribe(new pn(r,s=>{const f=t(s,i++);(f||e)&&r.next(s),!f&&r.complete()}))})}(i=>null!==i),J1(null),aP(),At(i=>{if(null===i)return null;const s=WP(i);return function aV(t){t.sort((e,n)=>e.value.outlet===Do?-1:n.value.outlet===Do?1:e.value.outlet.localeCompare(n.value.outlet))}(s),s}))}processSegment(e,n,r,i,s){return Wi(n).pipe(hp(f=>this.processSegmentAgainstRoute(f._injector??e,f,r,i,s)),cp(f=>!!f),fp(f=>{if(SC(f))return $P(r,i,s)?fi([]):fi(null);throw f}))}processSegmentAgainstRoute(e,n,r,i,s){if(n.redirectTo||!GP(n,r,i,s))return fi(null);let f;if("**"===n.path){const g=i.length>0?cP(i).parameters:{},v=ZP(r)+i.length;f=fi({snapshot:new sx(i,g,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,KP(n),wh(n),n.component??n._loadedComponent??null,n,XP(r),v,JP(n),v),consumedSegments:[],remainingSegments:[]})}else f=jP(r,n,i,e).pipe(At(({matched:g,consumedSegments:v,remainingSegments:x,parameters:M})=>{if(!g)return null;const R=ZP(r)+v.length;return{snapshot:new sx(v,M,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,KP(n),wh(n),n.component??n._loadedComponent??null,n,XP(r),R,JP(n),R),consumedSegments:v,remainingSegments:x}}));return f.pipe(Df(g=>{if(null===g)return fi(null);const{snapshot:v,consumedSegments:x,remainingSegments:M}=g;e=n._injector??e;const R=n._loadedInjector??e,L=function lV(t){return t.children?t.children:t.loadChildren?t._loadedRoutes:[]}(n),{segmentGroup:B,slicedSegments:ee}=cx(r,x,M,L.filter(Oe=>void 0===Oe.redirectTo),this.relativeLinkResolution);if(0===ee.length&&B.hasChildren())return this.processChildren(R,L,B).pipe(At(Oe=>null===Oe?null:[new cd(v,Oe)]));if(0===L.length&&0===ee.length)return fi([new cd(v,[])]);const se=wh(n)===s;return this.processSegment(R,L,B,ee,se?Do:s).pipe(At(Oe=>null===Oe?null:[new cd(v,Oe)]))}))}}function uV(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function WP(t){const e=[],n=new Set;for(const r of t){if(!uV(r)){e.push(r);continue}const i=e.find(s=>r.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...r.children),n.add(i)):e.push(r)}for(const r of n){const i=WP(r.children);e.push(new cd(r.value,i))}return e.filter(r=>!n.has(r))}function XP(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function ZP(t){let e=t,n=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift??0;return n-1}function KP(t){return t.data||{}}function JP(t){return t.resolve||{}}function QP(t){return"string"==typeof t.title||null===t.title}function MC(t){return Df(e=>{const n=t(e);return n?Wi(n).pipe(At(()=>e)):fi(e)})}let eR=(()=>{class t{buildTitle(n){let r,i=n.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===Do);return r}getResolvedTitleForRoute(n){return n.data[J_]}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:function(){return _a(tR)},providedIn:"root"}),t})(),tR=(()=>{class t extends eR{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return t.\u0275fac=function(n){return new(n||t)(Gt(KA))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class yV{}class vV extends class _V{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const gx=new Er("",{providedIn:"root",factory:()=>({})}),DC=new Er("ROUTES");let AC=(()=>{class t{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return fi(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=dp(n.loadComponent()).pipe(Ku(s=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=s}),sC(()=>{this.componentLoaders.delete(n)})),i=new rP(r,()=>new xt).pipe(iC());return this.componentLoaders.set(n,i),i}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return fi({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const s=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(At(g=>{this.onLoadEndListener&&this.onLoadEndListener(r);let v,x,M=!1;Array.isArray(g)?x=g:(v=g.create(n).injector,x=uP(v.get(DC,[],fr.Self|fr.Optional)));return{routes:x.map(CC),injector:v}}),sC(()=>{this.childrenLoaders.delete(r)})),f=new rP(s,()=>new xt).pipe(iC());return this.childrenLoaders.set(r,f),f}loadModuleFactoryOrRoutes(n){return dp(n()).pipe(ze(r=>r instanceof qM||Array.isArray(r)?fi(r):Wi(this.compiler.compileModuleAsync(r))))}}return t.\u0275fac=function(n){return new(n||t)(Gt(du),Gt(xE))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class wV{}class bV{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function EV(t){throw t}function CV(t,e,n){return e.parse("/")}const SV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},TV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function rR(){const t=_a(mP),e=_a(ov),n=_a(q_),r=_a(du),i=_a(xE),s=_a(DC,{optional:!0})??[],f=_a(gx,{optional:!0})??{},g=_a(tR),v=_a(eR,{optional:!0}),x=_a(wV,{optional:!0}),M=_a(yV,{optional:!0}),R=new Vu(null,t,e,n,r,i,uP(s));return x&&(R.urlHandlingStrategy=x),M&&(R.routeReuseStrategy=M),R.titleStrategy=v??g,function IV(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(e.canceledNavigationResolution=t.canceledNavigationResolution)}(f,R),R}let Vu=(()=>{class t{constructor(n,r,i,s,f,g,v){this.rootComponentType=n,this.urlSerializer=r,this.rootContexts=i,this.location=s,this.config=v,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new xt,this.errorHandler=EV,this.malformedUriErrorHandler=CV,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>fi(void 0),this.urlHandlingStrategy=new bV,this.routeReuseStrategy=new vV,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=f.get(AC),this.configLoader.onLoadEndListener=L=>this.triggerEvent(new lU(L)),this.configLoader.onLoadStartListener=L=>this.triggerEvent(new aU(L)),this.ngModule=f.get(og),this.console=f.get(WB);const R=f.get(ua);this.isNgZoneEnabled=R instanceof ua&&ua.isInAngularZone(),this.resetConfig(v),this.currentUrlTree=function P5(){return new lg(new is([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=AP(this.currentUrlTree,this.rootComponentType),this.transitions=new xh({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(n){const r=this.events;return n.pipe(gc(i=>0!==i.id),At(i=>({...i,extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),Df(i=>{let s=!1,f=!1;return fi(i).pipe(Ku(g=>{this.currentNavigation={id:g.id,initialUrl:g.rawUrl,extractedUrl:g.extractedUrl,trigger:g.source,extras:g.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Df(g=>{const v=this.browserUrlTree.toString(),x=!this.navigated||g.extractedUrl.toString()!==v||v!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||x)&&this.urlHandlingStrategy.shouldProcessUrl(g.rawUrl))return iR(g.source)&&(this.browserUrlTree=g.extractedUrl),fi(g).pipe(Df(R=>{const L=this.transitions.getValue();return r.next(new pC(R.id,this.serializeUrl(R.extractedUrl),R.source,R.restoredState)),L!==this.transitions.getValue()?yt:Promise.resolve(R)}),function nV(t,e,n,r){return Df(i=>function eV(t,e,n,r,i){return new tV(t,e,n,r,i).apply()}(t,e,n,i.extractedUrl,r).pipe(At(s=>({...i,urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Ku(R=>{this.currentNavigation={...this.currentNavigation,finalUrl:R.urlAfterRedirects},i.urlAfterRedirects=R.urlAfterRedirects}),function hV(t,e,n,r,i,s){return ze(f=>function oV(t,e,n,r,i,s,f="emptyOnly",g="legacy"){return new sV(t,e,n,r,i,f,g,s).recognize().pipe(Df(v=>null===v?function iV(t){return new Bt(e=>e.error(t))}(new rV):fi(v)))}(t,e,n,f.urlAfterRedirects,r.serialize(f.urlAfterRedirects),r,i,s).pipe(At(g=>({...f,targetSnapshot:g}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Ku(R=>{if(i.targetSnapshot=R.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!R.extras.skipLocationChange){const B=this.urlHandlingStrategy.merge(R.urlAfterRedirects,R.rawUrl);this.setBrowserUrl(B,R)}this.browserUrlTree=R.urlAfterRedirects}const L=new nU(R.id,this.serializeUrl(R.extractedUrl),this.serializeUrl(R.urlAfterRedirects),R.targetSnapshot);r.next(L)}));if(x&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:L,extractedUrl:B,source:ee,restoredState:se,extras:Oe}=g,Ee=new pC(L,this.serializeUrl(B),ee,se);r.next(Ee);const _e=AP(B,this.rootComponentType).snapshot;return fi(i={...g,targetSnapshot:_e,urlAfterRedirects:B,extras:{...Oe,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=g.rawUrl,g.resolve(null),yt}),Ku(g=>{const v=new rU(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot);this.triggerEvent(v)}),At(g=>i={...g,guards:IU(g.targetSnapshot,g.currentSnapshot,this.rootContexts)}),function BU(t,e){return ze(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:f}}=n;return 0===f.length&&0===s.length?fi({...n,guardsResult:!0}):function zU(t,e,n,r){return Wi(t).pipe(ze(i=>function qU(t,e,n,r,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?fi(s.map(g=>{const v=sv(e)??i,x=Xm(g,v);return dp(function NU(t){return t&&uv(t.canDeactivate)}(x)?x.canDeactivate(t,e,n,r):v.runInContext(()=>x(t,e,n,r))).pipe(cp())})).pipe(Zm()):fi(!0)}(i.component,i.route,n,e,r)),cp(i=>!0!==i,!0))}(f,r,i,t).pipe(ze(g=>g&&function PU(t){return"boolean"==typeof t}(g)?function UU(t,e,n,r){return Wi(e).pipe(hp(i=>nC(function jU(t,e){return null!==t&&e&&e(new uU(t)),fi(!0)}(i.route.parent,r),function VU(t,e){return null!==t&&e&&e(new hU(t)),fi(!0)}(i.route,r),function $U(t,e,n){const r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(f=>function MU(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(f)).filter(f=>null!==f).map(f=>rC(()=>fi(f.guards.map(v=>{const x=sv(f.node)??n,M=Xm(v,x);return dp(function LU(t){return t&&uv(t.canActivateChild)}(M)?M.canActivateChild(r,t):x.runInContext(()=>M(r,t))).pipe(cp())})).pipe(Zm())));return fi(s).pipe(Zm())}(t,i.path,n),function GU(t,e,n){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return fi(!0);const i=r.map(s=>rC(()=>{const f=sv(e)??n,g=Xm(s,f);return dp(function OU(t){return t&&uv(t.canActivate)}(g)?g.canActivate(e,t):f.runInContext(()=>g(e,t))).pipe(cp())}));return fi(i).pipe(Zm())}(t,i.route,n))),cp(i=>!0!==i,!0))}(r,s,t,e):fi(g)),At(g=>({...n,guardsResult:g})))})}(this.ngModule.injector,g=>this.triggerEvent(g)),Ku(g=>{if(i.guardsResult=g.guardsResult,cg(g.guardsResult))throw LP(0,g.guardsResult);const v=new iU(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot,!!g.guardsResult);this.triggerEvent(v)}),gc(g=>!!g.guardsResult||(this.restoreHistory(g),this.cancelNavigationTransition(g,"",3),!1)),MC(g=>{if(g.guards.canActivateChecks.length)return fi(g).pipe(Ku(v=>{const x=new oU(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(x)}),Df(v=>{let x=!1;return fi(v).pipe(function fV(t,e){return ze(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return fi(n);let s=0;return Wi(i).pipe(hp(f=>function dV(t,e,n,r){const i=t.routeConfig,s=t._resolve;return void 0!==i?.title&&!QP(i)&&(s[J_]=i.title),function pV(t,e,n,r){const i=function gV(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===i.length)return fi({});const s={};return Wi(i).pipe(ze(f=>function mV(t,e,n,r){const i=sv(e)??r,s=Xm(t,i);return dp(s.resolve?s.resolve(e,n):i.runInContext(()=>s(e,n)))}(t[f],e,n,r).pipe(cp(),Ku(g=>{s[f]=g}))),oC(1),function I5(t){return At(()=>t)}(s),fp(f=>SC(f)?yt:K_(f)))}(s,t,e,r).pipe(At(f=>(t._resolvedData=f,t.data=PP(t,n).resolve,i&&QP(i)&&(t.data[J_]=i.title),null)))}(f.route,r,t,e)),Ku(()=>s++),oC(1),ze(f=>s===i.length?fi(n):yt))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Ku({next:()=>x=!0,complete:()=>{x||(this.restoreHistory(v),this.cancelNavigationTransition(v,"",2))}}))}),Ku(v=>{const x=new sU(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(x)}))}),MC(g=>{const v=x=>{const M=[];x.routeConfig?.loadComponent&&!x.routeConfig._loadedComponent&&M.push(this.configLoader.loadComponent(x.routeConfig).pipe(Ku(R=>{x.component=R}),At(()=>{})));for(const R of x.children)M.push(...v(R));return M};return tP(v(g.targetSnapshot.root)).pipe(J1(),Yt(1))}),MC(()=>this.afterPreactivation()),At(g=>{const v=function mU(t,e,n){const r=iv(t,e._root,n?n._root:void 0);return new DP(r,e)}(this.routeReuseStrategy,g.targetSnapshot,g.currentRouterState);return i={...g,targetRouterState:v}}),Ku(g=>{this.currentUrlTree=g.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(g.urlAfterRedirects,g.rawUrl),this.routerState=g.targetRouterState,"deferred"===this.urlUpdateStrategy&&(g.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,g),this.browserUrlTree=g.urlAfterRedirects)}),((t,e,n)=>At(r=>(new TU(e,r.targetRouterState,r.currentRouterState,n).activate(t),r)))(this.rootContexts,this.routeReuseStrategy,g=>this.triggerEvent(g)),Ku({next(){s=!0},complete(){s=!0}}),sC(()=>{s||f||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),fp(g=>{if(f=!0,FP(g)){kP(g)||(this.navigated=!0,this.restoreHistory(i,!0));const v=new ox(i.id,this.serializeUrl(i.extractedUrl),g.message,g.cancellationCode);if(r.next(v),kP(g)){const x=this.urlHandlingStrategy.merge(g.url,this.rawUrlTree),M={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||iR(i.source)};this.scheduleNavigation(x,"imperative",null,M,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{this.restoreHistory(i,!0);const v=new TP(i.id,this.serializeUrl(i.extractedUrl),g,i.targetSnapshot??void 0);r.next(v);try{i.resolve(this.errorHandler(g))}catch(x){i.reject(x)}}return yt}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next({...this.transitions.value,...n})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{const i={replaceUrl:!0},s=n.state?.navigationId?n.state:null;if(s){const g={...s};delete g.navigationId,delete g.\u0275routerPageId,0!==Object.keys(g).length&&(i.state=g)}const f=this.parseUrl(n.url);this.scheduleNavigation(f,r,s,i)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){this.config=n.map(CC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:i,queryParams:s,fragment:f,queryParamsHandling:g,preserveFragment:v}=r,x=i||this.routerState.root,M=v?this.currentUrlTree.fragment:f;let R=null;switch(g){case"merge":R={...this.currentUrlTree.queryParams,...s};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=s||null}return null!==R&&(R=this.removeEmptyProps(R)),Y5(x,this.currentUrlTree,n,R,M??null)}navigateByUrl(n,r={skipLocationChange:!1}){const i=cg(n)?n:this.parseUrl(n),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function MV(t){for(let e=0;e<t.length;e++){if(null==t[e])throw new On(4008,false)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,n)}return r}isActive(n,r){let i;if(i=!0===r?{...SV}:!1===r?{...TV}:r,cg(n))return fP(this.currentUrlTree,n,i);const s=this.parseUrl(n);return fP(this.currentUrlTree,s,i)}removeEmptyProps(n){return Object.keys(n).reduce((r,i)=>{const s=n[i];return null!=s&&(r[i]=s),r},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new hg(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,r,i,s,f){if(this.disposed)return Promise.resolve(!1);let g,v,x;f?(g=f.resolve,v=f.reject,x=f.promise):x=new Promise((L,B)=>{g=L,v=B});const M=++this.navigationId;let R;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),R=i&&i.\u0275routerPageId?i.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):R=0,this.setTransition({id:M,targetPageId:R,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:s,resolve:g,reject:v,promise:x,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),x.catch(L=>Promise.reject(L))}setBrowserUrl(n,r){const i=this.urlSerializer.serialize(n),s={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl?this.location.replaceState(i,"",s):this.location.go(i,"",s)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const i=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===i?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===i&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(i)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,r,i){const s=new ox(n.id,this.serializeUrl(n.extractedUrl),r,i);this.triggerEvent(s),n.resolve(!1)}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return t.\u0275fac=function(n){Em()},t.\u0275prov=zn({token:t,factory:function(){return rR()},providedIn:"root"}),t})();function iR(t){return"imperative"!==t}class oR{}let PV=(()=>{class t{constructor(n,r,i,s,f){this.router=n,this.injector=i,this.preloadingStrategy=s,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(gc(n=>n instanceof hg),hp(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const i=[];for(const s of r){s.providers&&!s._injector&&(s._injector=w1(s.providers,n,`Route: ${s.path}`));const f=s._injector??n,g=s._loadedInjector??f;s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent?i.push(this.preloadConfig(f,s)):(s.children||s._loadedRoutes)&&i.push(this.processRoutes(g,s.children??s._loadedRoutes))}return Wi(i).pipe(et())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):fi(null);const s=i.pipe(ze(f=>null===f?fi(void 0):(r._loadedRoutes=f.routes,r._loadedInjector=f.injector,this.processRoutes(f.injector??n,f.routes))));return r.loadComponent&&!r._loadedComponent?Wi([s,this.loader.loadComponent(r)]).pipe(et()):s})}}return t.\u0275fac=function(n){return new(n||t)(Gt(Vu),Gt(xE),Gt(pf),Gt(oR),Gt(AC))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const OC=new Er("");let sR=(()=>{class t{constructor(n,r,i={}){this.router=n,this.viewportScroller=r,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof pC?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof hg&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof IP&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.router.triggerEvent(new IP(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){Em()},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();function Ym(t,e){return{\u0275kind:t,\u0275providers:e}}function LC(t){return[{provide:DC,multi:!0,useValue:t}]}function lR(){const t=_a(du);return e=>{const n=t.get(jm);if(e!==n.components[0])return;const r=t.get(Vu),i=t.get(uR);1===t.get(NC)&&r.initialNavigation(),t.get(cR,null,fr.Optional)?.setUpPreloading(),t.get(OC,null,fr.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),i.closed||(i.next(),i.unsubscribe())}}const uR=new Er("",{factory:()=>new xt}),NC=new Er("",{providedIn:"root",factory:()=>1});const cR=new Er("");function NV(t){return Ym(0,[{provide:cR,useExisting:PV},{provide:oR,useExisting:t}])}const hR=new Er("ROUTER_FORROOT_GUARD"),kV=[q_,{provide:mP,useClass:lC},{provide:Vu,useFactory:rR},ov,{provide:fg,useFactory:function aR(t){return t.routerState.root},deps:[Vu]},AC];function FV(){return new UD("Router",Vu)}let fR=(()=>{class t{constructor(n){}static forRoot(n,r){return{ngModule:t,providers:[kV,[],LC(n),{provide:hR,useFactory:VV,deps:[[Vu,new ah,new jf]]},{provide:gx,useValue:r||{}},r?.useHash?{provide:ag,useClass:F3}:{provide:ag,useClass:hA},{provide:OC,useFactory:()=>{const t=_a(Vu),e=_a(s4),n=_a(gx);return n.scrollOffset&&e.setOffset(n.scrollOffset),new sR(t,e,n)}},r?.preloadingStrategy?NV(r.preloadingStrategy).\u0275providers:[],{provide:UD,multi:!0,useFactory:FV},r?.initialNavigation?jV(r):[],[{provide:dR,useFactory:lR},{provide:OD,multi:!0,useExisting:dR}]]}}static forChild(n){return{ngModule:t,providers:[LC(n)]}}}return t.\u0275fac=function(n){return new(n||t)(Gt(hR,8))},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({imports:[bC]}),t})();function VV(t){return"guarded"}function jV(t){return["disabled"===t.initialNavigation?Ym(3,[{provide:S1,multi:!0,useFactory:()=>{const e=_a(Vu);return()=>{e.setUpLocationChangeListener()}}},{provide:NC,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Ym(2,[{provide:NC,useValue:0},{provide:S1,multi:!0,deps:[du],useFactory:e=>{const n=e.get(N3,Promise.resolve());let r=!1;return()=>n.then(()=>new Promise(s=>{const f=e.get(Vu),g=e.get(uR);(function i(s){e.get(Vu).events.pipe(gc(g=>g instanceof hg||g instanceof ox||g instanceof TP),At(g=>g instanceof hg||g instanceof ox&&(0===g.code||1===g.code)&&null),gc(g=>null!==g),Yt(1)).subscribe(()=>{s()})})(()=>{s(!0),r=!0}),f.afterPreactivation=()=>(s(!0),r||g.closed?fi(void 0):g),f.initialNavigation()}))}}]).\u0275providers:[]]}const dR=new Er(""),$V=[];let qV=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({imports:[fR.forRoot($V),fR]}),t})();function pR(t,e,n,r,i,s,f){try{var g=t[s](f),v=g.value}catch(x){return void n(x)}g.done?e(v):Promise.resolve(v).then(r,i)}function gR(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function f(v){pR(s,r,i,f,g,"next",v)}function g(v){pR(s,r,i,f,g,"throw",v)}f(void 0)})}}var kC=xe(9898),HV=xe(8545),WV=xe.n(HV),XV=xe(8527),ZV=xe.n(XV);function hd(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function vx(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zC(t[0])||!zC(t[1]))throw new Error("coordinates must contain numbers");return hd({type:"Point",coordinates:t},e,n)}function xx(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var s=i[r];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}return hd({type:"Polygon",coordinates:t},e,n)}function zC(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function hv(t,e,n){if(null!==t)for(var r,i,s,f,g,v,x,L,M=0,R=0,B=t.type,ee="FeatureCollection"===B,se="Feature"===B,Oe=ee?t.features.length:1,Ee=0;Ee<Oe;Ee++){g=(L=!!(x=ee?t.features[Ee].geometry:se?t.geometry:t)&&"GeometryCollection"===x.type)?x.geometries.length:1;for(var _e=0;_e<g;_e++){var ve=0,it=0;if(null!==(f=L?x.geometries[_e]:x)){v=f.coordinates;var mt=f.type;switch(M=!n||"Polygon"!==mt&&"MultiPolygon"!==mt?0:1,mt){case null:break;case"Point":if(!1===e(v,R,Ee,ve,it))return!1;R++,ve++;break;case"LineString":case"MultiPoint":for(r=0;r<v.length;r++){if(!1===e(v[r],R,Ee,ve,it))return!1;R++,"MultiPoint"===mt&&ve++}"LineString"===mt&&ve++;break;case"Polygon":case"MultiLineString":for(r=0;r<v.length;r++){for(i=0;i<v[r].length-M;i++){if(!1===e(v[r][i],R,Ee,ve,it))return!1;R++}"MultiLineString"===mt&&ve++,"Polygon"===mt&&it++}"Polygon"===mt&&ve++;break;case"MultiPolygon":for(r=0;r<v.length;r++){for(it=0,i=0;i<v[r].length;i++){for(s=0;s<v[r][i].length-M;s++){if(!1===e(v[r][i][s],R,Ee,ve,it))return!1;R++}it++}ve++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if(!1===hv(f.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xR(t,e){var n,r,i,s,f,g,v,x,M,R,L=0,B="FeatureCollection"===t.type,ee="Feature"===t.type,se=B?t.features.length:1;for(n=0;n<se;n++){for(x=B?t.features[n].properties:ee?t.properties:{},M=B?t.features[n].bbox:ee?t.bbox:void 0,R=B?t.features[n].id:ee?t.id:void 0,f=(v=!!(g=B?t.features[n].geometry:ee?t.geometry:t)&&"GeometryCollection"===g.type)?g.geometries.length:1,i=0;i<f;i++)if(null!==(s=v?g.geometries[i]:g))switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(s,L,x,M,R))return!1;break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===e(s.geometries[r],L,x,M,R))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,L,x,M,R))return!1;L++}}function UC(t){var e=[1/0,1/0,-1/0,-1/0];return hv(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}UC.default=UC;const sj=UC;function CR(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=function aj(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),i=function cj(t){return"Feature"===t.type?t.geometry:t}(e),s=i.type,f=e.bbox,g=i.coordinates;if(f&&!1===function xj(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,f))return!1;"Polygon"===s&&(g=[g]);for(var v=!1,x=0;x<g.length&&!v;x++)if(SR(r,g[x][0],n.ignoreBoundary)){for(var M=!1,R=1;R<g[x].length&&!M;)SR(r,g[x][R],!n.ignoreBoundary)&&(M=!0),R++;M||(v=!0)}return v}function SR(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,s=e.length-1;i<e.length;s=i++){var f=e[i][0],g=e[i][1],v=e[s][0],x=e[s][1];if(t[1]*(f-v)+g*(v-t[0])+x*(t[0]-f)==0&&(f-t[0])*(v-t[0])<=0&&(g-t[1])*(x-t[1])<=0)return!n;g>t[1]!=x>t[1]&&t[0]<(v-f)*(t[1]-g)/(x-g)+f&&(r=!r)}return r}xe(5943),xe(1335);var IR=new ArrayBuffer(16);new Float64Array(IR),new Uint32Array(IR),xe(3544),function(){function t(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length,this.delay=0;for(var n=0;n<this.length;n++)this.points[n].z=this.points[n].z||0;for(n=0;n<this.length-1;n++){var r=this.points[n],i=this.points[n+1];this.centers.push({x:(r.x+i.x)/2,y:(r.y+i.y)/2,z:(r.z+i.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),n=0;n<this.centers.length-1;n++){var s=this.points[n+1].x-(this.centers[n].x+this.centers[n+1].x)/2,f=this.points[n+1].y-(this.centers[n].y+this.centers[n+1].y)/2,g=this.points[n+1].z-(this.centers[n].y+this.centers[n+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n].x+s),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n].y+f),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n].z+g)},{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n+1].x+s),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n+1].y+f),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n+1].z+g)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}t.prototype.cacheSteps=function(e){var n=[],r=this.pos(0);n.push(0);for(var i=0;i<this.duration;i+=10){var s=this.pos(i);Math.sqrt((s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y)+(s.z-r.z)*(s.z-r.z))>e&&(n.push(i),r=s)}return n},t.prototype.vector=function(e){var n=this.pos(e+10),r=this.pos(e-10);return{angle:180*Math.atan2(n.y-r.y,n.x-r.x)/3.14,speed:Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)+(r.z-n.z)*(r.z-n.z))}},t.prototype.pos=function(e){var n=e-this.delay;n<0&&(n=0),n>this.duration&&(n=this.duration-1);var r=n/this.duration;if(r>=1)return this.points[this.length-1];var i=Math.floor((this.points.length-1)*r);return function kj(t,e,n,r,i){var s=function Fj(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*s[0]+r.x*s[1]+n.x*s[2]+e.x*s[3],y:i.y*s[0]+r.y*s[1]+n.y*s[2]+e.y*s[3],z:i.z*s[0]+r.z*s[1]+n.z*s[2]+e.z*s[3]}}((this.length-1)*r-i,this.points[i],this.controls[i][1],this.controls[i+1][0],this.points[i+1])}}();function BR(t){var e=0;if(t&&t.length>0){e+=Math.abs(zR(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(zR(t[n]))}return e}function zR(t){var e,n,i,s,f,g,v=0,x=t.length;if(x>2){for(g=0;g<x;g++)g===x-2?(i=x-2,s=x-1,f=0):g===x-1?(i=x-1,s=0,f=1):(i=g,s=g+1,f=g+2),e=t[i],n=t[s],v+=(WC(t[f][0])-WC(e[0]))*Math.sin(WC(n[1]));v=6378137*v*6378137/2}return v}function WC(t){return t*Math.PI/180}xe(5469),xe(5406);var $R=Math.PI/180,qR=180/Math.PI,pv=function(t,e){this.lon=t,this.lat=e,this.x=$R*t,this.y=$R*e};pv.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},pv.prototype.antipode=function(){return new pv(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var HR=function(){this.coords=[],this.length=0};HR.prototype.move_to=function(t){this.length++,this.coords.push(t)};var XC=function(t){this.properties=t||{},this.geometries=[]};XC.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},XC.prototype.wkt=function(){for(var t="",e="LINESTRING(",n=function(s){e+=s[0]+" "+s[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),t+=e.substring(0,e.length-1)+")"}return t};var ZC=function(t,e,n){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new pv(t.x,t.y),this.end=new pv(e.x,e.y),this.properties=n||{};var r=this.start.x-this.end.x,s=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(s)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};ZC.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),n=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),s=e*Math.sin(this.start.y)+n*Math.sin(this.end.y),f=qR*Math.atan2(s,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[qR*Math.atan2(i,r),f]},ZC.prototype.Arc=function(t,e){var n=[];if(!t||t<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),i=0;i<t;++i){var f=this.interpolate(r*i);n.push(f)}for(var g=!1,v=0,x=e&&e.offset?e.offset:10,M=180-x,R=-180+x,L=360-x,B=1;B<n.length;++B){var ee=n[B-1][0],se=n[B][0],Oe=Math.abs(se-ee);Oe>L&&(se>M&&ee<R||ee>M&&se<R)?g=!0:Oe>v&&(v=Oe)}var Ee=[];if(g&&v<x){var _e=[];Ee.push(_e);for(var ve=0;ve<n.length;++ve){var it=parseFloat(n[ve][0]);if(ve>0&&Math.abs(it-n[ve-1][0])>L){var mt=parseFloat(n[ve-1][0]),Ot=parseFloat(n[ve-1][1]),kt=parseFloat(n[ve][0]),tn=parseFloat(n[ve][1]);if(mt>-180&&mt<R&&180===kt&&ve+1<n.length&&n[ve-1][0]>-180&&n[ve-1][0]<R){_e.push([-180,n[ve][1]]),ve++,_e.push([n[ve][0],n[ve][1]]);continue}if(mt>M&&mt<180&&-180===kt&&ve+1<n.length&&n[ve-1][0]>M&&n[ve-1][0]<180){_e.push([180,n[ve][1]]),ve++,_e.push([n[ve][0],n[ve][1]]);continue}if(mt<R&&kt>M){var ut=mt;mt=kt,kt=ut;var Nr=Ot;Ot=tn,tn=Nr}if(mt>M&&kt<R&&(kt+=360),mt<=180&&kt>=180&&mt<kt){var dr=(180-mt)/(kt-mt),ni=dr*tn+(1-dr)*Ot;_e.push([n[ve-1][0]>M?180:-180,ni]),(_e=[]).push([n[ve-1][0]>M?-180:180,ni]),Ee.push(_e)}else Ee.push(_e=[]);_e.push([it,n[ve][1]])}else _e.push([n[ve][0],n[ve][1]])}}else{var ai=[];Ee.push(ai);for(var Xn=0;Xn<n.length;++Xn)ai.push([n[Xn][0],n[Xn][1]])}for(var Hr=new XC(this.properties),_n=0;_n<Ee.length;++_n){var ar=new HR;Hr.geometries.push(ar);for(var cr=Ee[_n],Cr=0;Cr<cr.length;++Cr)ar.move_to(cr[Cr])}return Hr},xe(6952);var Ao=[],Po=[],Ro=[],Oo=[],Lo=[],No=[],ko=[],Fo=[],Bo=[],zo=[],Uo=[],Vo=[],jo=[],Go=[],$o=[],qo=[],Ho=[],Wo=[],Xo=[],Zo=[],Yo=[],Ko=[],Jo=[],Qo=[];ko[85]=zo[85]=-1,Fo[85]=Uo[85]=0,Bo[85]=Vo[85]=1,Xo[85]=Ko[85]=1,Zo[85]=Jo[85]=0,Yo[85]=Qo[85]=1,Ao[85]=Oo[85]=0,Po[85]=Lo[85]=-1,Ro[85]=$o[85]=0,qo[85]=jo[85]=0,Ho[85]=Go[85]=1,No[85]=Wo[85]=1,Ko[1]=Ko[169]=0,Jo[1]=Jo[169]=-1,Qo[1]=Qo[169]=0,jo[1]=jo[169]=-1,Go[1]=Go[169]=0,$o[1]=$o[169]=0,zo[4]=zo[166]=0,Uo[4]=Uo[166]=-1,Vo[4]=Vo[166]=1,qo[4]=qo[166]=1,Ho[4]=Ho[166]=0,Wo[4]=Wo[166]=0,ko[16]=ko[154]=0,Fo[16]=Fo[154]=1,Bo[16]=Bo[154]=1,Oo[16]=Oo[154]=1,Lo[16]=Lo[154]=0,No[16]=No[154]=1,Xo[64]=Xo[106]=0,Zo[64]=Zo[106]=1,Yo[64]=Yo[106]=0,Ao[64]=Ao[106]=-1,Po[64]=Po[106]=0,Ro[64]=Ro[106]=1,Xo[2]=Xo[168]=0,Zo[2]=Zo[168]=-1,Yo[2]=Yo[168]=1,Ko[2]=Ko[168]=0,Jo[2]=Jo[168]=-1,Qo[2]=Qo[168]=0,jo[2]=jo[168]=-1,Go[2]=Go[168]=0,$o[2]=$o[168]=0,qo[2]=qo[168]=-1,Ho[2]=Ho[168]=0,Wo[2]=Wo[168]=1,ko[8]=ko[162]=0,Fo[8]=Fo[162]=-1,Bo[8]=Bo[162]=0,zo[8]=zo[162]=0,Uo[8]=Uo[162]=-1,Vo[8]=Vo[162]=1,jo[8]=jo[162]=1,Go[8]=Go[162]=0,$o[8]=$o[162]=1,qo[8]=qo[162]=1,Ho[8]=Ho[162]=0,Wo[8]=Wo[162]=0,ko[32]=ko[138]=0,Fo[32]=Fo[138]=1,Bo[32]=Bo[138]=1,zo[32]=zo[138]=0,Uo[32]=Uo[138]=1,Vo[32]=Vo[138]=0,Ao[32]=Ao[138]=1,Po[32]=Po[138]=0,Ro[32]=Ro[138]=0,Oo[32]=Oo[138]=1,Lo[32]=Lo[138]=0,No[32]=No[138]=1,Ko[128]=Ko[42]=0,Jo[128]=Jo[42]=1,Qo[128]=Qo[42]=1,Xo[128]=Xo[42]=0,Zo[128]=Zo[42]=1,Yo[128]=Yo[42]=0,Ao[128]=Ao[42]=-1,Po[128]=Po[42]=0,Ro[128]=Ro[42]=1,Oo[128]=Oo[42]=-1,Lo[128]=Lo[42]=0,No[128]=No[42]=0,zo[5]=zo[165]=-1,Uo[5]=Uo[165]=0,Vo[5]=Vo[165]=0,Ko[5]=Ko[165]=1,Jo[5]=Jo[165]=0,Qo[5]=Qo[165]=0,qo[20]=qo[150]=0,Ho[20]=Ho[150]=1,Wo[20]=Wo[150]=1,Oo[20]=Oo[150]=0,Lo[20]=Lo[150]=-1,No[20]=No[150]=1,ko[80]=ko[90]=-1,Fo[80]=Fo[90]=0,Bo[80]=Bo[90]=1,Xo[80]=Xo[90]=1,Zo[80]=Zo[90]=0,Yo[80]=Yo[90]=1,jo[65]=jo[105]=0,Go[65]=Go[105]=1,$o[65]=$o[105]=0,Ao[65]=Ao[105]=0,Po[65]=Po[105]=-1,Ro[65]=Ro[105]=0,ko[160]=ko[10]=-1,Fo[160]=Fo[10]=0,Bo[160]=Bo[10]=1,zo[160]=zo[10]=-1,Uo[160]=Uo[10]=0,Vo[160]=Vo[10]=0,Ko[160]=Ko[10]=1,Jo[160]=Jo[10]=0,Qo[160]=Qo[10]=0,Xo[160]=Xo[10]=1,Zo[160]=Zo[10]=0,Yo[160]=Yo[10]=1,qo[130]=qo[40]=0,Ho[130]=Ho[40]=1,Wo[130]=Wo[40]=1,jo[130]=jo[40]=0,Go[130]=Go[40]=1,$o[130]=$o[40]=0,Ao[130]=Ao[40]=0,Po[130]=Po[40]=-1,Ro[130]=Ro[40]=0,Oo[130]=Oo[40]=0,Lo[130]=Lo[40]=-1,No[130]=No[40]=1,zo[37]=zo[133]=0,Uo[37]=Uo[133]=1,Vo[37]=Vo[133]=1,Ko[37]=Ko[133]=0,Jo[37]=Jo[133]=1,Qo[37]=Qo[133]=0,Ao[37]=Ao[133]=-1,Po[37]=Po[133]=0,Ro[37]=Ro[133]=0,Oo[37]=Oo[133]=1,Lo[37]=Lo[133]=0,No[37]=No[133]=0,qo[148]=qo[22]=-1,Ho[148]=Ho[22]=0,Wo[148]=Wo[22]=0,Ko[148]=Ko[22]=0,Jo[148]=Jo[22]=-1,Qo[148]=Qo[22]=1,Xo[148]=Xo[22]=0,Zo[148]=Zo[22]=1,Yo[148]=Yo[22]=1,Oo[148]=Oo[22]=-1,Lo[148]=Lo[22]=0,No[148]=No[22]=1,ko[82]=ko[88]=0,Fo[82]=Fo[88]=-1,Bo[82]=Bo[88]=1,qo[82]=qo[88]=1,Ho[82]=Ho[88]=0,Wo[82]=Wo[88]=1,jo[82]=jo[88]=-1,Go[82]=Go[88]=0,$o[82]=$o[88]=1,Xo[82]=Xo[88]=0,Zo[82]=Zo[88]=-1,Yo[82]=Yo[88]=0,ko[73]=ko[97]=0,Fo[73]=Fo[97]=1,Bo[73]=Bo[97]=0,zo[73]=zo[97]=0,Uo[73]=Uo[97]=-1,Vo[73]=Vo[97]=0,jo[73]=jo[97]=1,Go[73]=Go[97]=0,$o[73]=$o[97]=0,Ao[73]=Ao[97]=1,Po[73]=Po[97]=0,Ro[73]=Ro[97]=1,ko[145]=ko[25]=0,Fo[145]=Fo[25]=-1,Bo[145]=Bo[25]=0,jo[145]=jo[25]=1,Go[145]=Go[25]=0,$o[145]=$o[25]=1,Ko[145]=Ko[25]=0,Jo[145]=Jo[25]=1,Qo[145]=Qo[25]=1,Oo[145]=Oo[25]=-1,Lo[145]=Lo[25]=0,No[145]=No[25]=0,zo[70]=zo[100]=0,Uo[70]=Uo[100]=1,Vo[70]=Vo[100]=0,qo[70]=qo[100]=-1,Ho[70]=Ho[100]=0,Wo[70]=Wo[100]=1,Xo[70]=Xo[100]=0,Zo[70]=Zo[100]=-1,Yo[70]=Yo[100]=1,Ao[70]=Ao[100]=1,Po[70]=Po[100]=0,Ro[70]=Ro[100]=0,zo[101]=zo[69]=0,Uo[101]=Uo[69]=1,Vo[101]=Vo[69]=0,Ao[101]=Ao[69]=1,Po[101]=Po[69]=0,Ro[101]=Ro[69]=0,Ko[149]=Ko[21]=0,Jo[149]=Jo[21]=1,Qo[149]=Qo[21]=1,Oo[149]=Oo[21]=-1,Lo[149]=Lo[21]=0,No[149]=No[21]=0,qo[86]=qo[84]=-1,Ho[86]=Ho[84]=0,Wo[86]=Wo[84]=1,Xo[86]=Xo[84]=0,Zo[86]=Zo[84]=-1,Yo[86]=Yo[84]=1,ko[89]=ko[81]=0,Fo[89]=Fo[81]=-1,Bo[89]=Bo[81]=0,jo[89]=jo[81]=1,Go[89]=Go[81]=0,$o[89]=$o[81]=1,ko[96]=ko[74]=0,Fo[96]=Fo[74]=1,Bo[96]=Bo[74]=0,zo[96]=zo[74]=-1,Uo[96]=Uo[74]=0,Vo[96]=Vo[74]=1,Xo[96]=Xo[74]=1,Zo[96]=Zo[74]=0,Yo[96]=Yo[74]=0,Ao[96]=Ao[74]=1,Po[96]=Po[74]=0,Ro[96]=Ro[74]=1,ko[24]=ko[146]=0,Fo[24]=Fo[146]=-1,Bo[24]=Bo[146]=1,qo[24]=qo[146]=1,Ho[24]=Ho[146]=0,Wo[24]=Wo[146]=1,jo[24]=jo[146]=0,Go[24]=Go[146]=1,$o[24]=$o[146]=1,Oo[24]=Oo[146]=0,Lo[24]=Lo[146]=-1,No[24]=No[146]=0,zo[6]=zo[164]=-1,Uo[6]=Uo[164]=0,Vo[6]=Vo[164]=1,qo[6]=qo[164]=-1,Ho[6]=Ho[164]=0,Wo[6]=Wo[164]=0,Ko[6]=Ko[164]=0,Jo[6]=Jo[164]=-1,Qo[6]=Qo[164]=1,Xo[6]=Xo[164]=1,Zo[6]=Zo[164]=0,Yo[6]=Yo[164]=0,jo[129]=jo[41]=0,Go[129]=Go[41]=1,$o[129]=$o[41]=1,Ko[129]=Ko[41]=0,Jo[129]=Jo[41]=1,Qo[129]=Qo[41]=0,Ao[129]=Ao[41]=-1,Po[129]=Po[41]=0,Ro[129]=Ro[41]=0,Oo[129]=Oo[41]=0,Lo[129]=Lo[41]=-1,No[129]=No[41]=0,qo[66]=qo[104]=0,Ho[66]=Ho[104]=1,Wo[66]=Wo[104]=0,jo[66]=jo[104]=-1,Go[66]=Go[104]=0,$o[66]=$o[104]=1,Xo[66]=Xo[104]=0,Zo[66]=Zo[104]=-1,Yo[66]=Yo[104]=0,Ao[66]=Ao[104]=0,Po[66]=Po[104]=-1,Ro[66]=Ro[104]=1,ko[144]=ko[26]=-1,Fo[144]=Fo[26]=0,Bo[144]=Bo[26]=0,Ko[144]=Ko[26]=1,Jo[144]=Jo[26]=0,Qo[144]=Qo[26]=1,Xo[144]=Xo[26]=0,Zo[144]=Zo[26]=1,Yo[144]=Yo[26]=1,Oo[144]=Oo[26]=-1,Lo[144]=Lo[26]=0,No[144]=No[26]=1,zo[36]=zo[134]=0,Uo[36]=Uo[134]=1,Vo[36]=Vo[134]=1,qo[36]=qo[134]=0,Ho[36]=Ho[134]=1,Wo[36]=Wo[134]=0,Ao[36]=Ao[134]=0,Po[36]=Po[134]=-1,Ro[36]=Ro[134]=1,Oo[36]=Oo[134]=1,Lo[36]=Lo[134]=0,No[36]=No[134]=0,ko[9]=ko[161]=-1,Fo[9]=Fo[161]=0,Bo[9]=Bo[161]=0,zo[9]=zo[161]=0,Uo[9]=Uo[161]=-1,Vo[9]=Vo[161]=0,jo[9]=jo[161]=1,Go[9]=Go[161]=0,$o[9]=$o[161]=0,Ko[9]=Ko[161]=1,Jo[9]=Jo[161]=0,Qo[9]=Qo[161]=1,ko[136]=0,Fo[136]=1,Bo[136]=1,zo[136]=0,Uo[136]=1,Vo[136]=0,qo[136]=-1,Ho[136]=0,Wo[136]=1,jo[136]=-1,Go[136]=0,$o[136]=0,Ko[136]=0,Jo[136]=-1,Qo[136]=0,Xo[136]=0,Zo[136]=-1,Yo[136]=1,Ao[136]=1,Po[136]=0,Ro[136]=0,Oo[136]=1,Lo[136]=0,No[136]=1,ko[34]=0,Fo[34]=-1,Bo[34]=0,zo[34]=0,Uo[34]=-1,Vo[34]=1,qo[34]=1,Ho[34]=0,Wo[34]=0,jo[34]=1,Go[34]=0,$o[34]=1,Ko[34]=0,Jo[34]=1,Qo[34]=1,Xo[34]=0,Zo[34]=1,Yo[34]=0,Ao[34]=-1,Po[34]=0,Ro[34]=1,Oo[34]=-1,Lo[34]=0,No[34]=0,ko[35]=0,Fo[35]=1,Bo[35]=1,zo[35]=0,Uo[35]=-1,Vo[35]=1,qo[35]=1,Ho[35]=0,Wo[35]=0,jo[35]=-1,Go[35]=0,$o[35]=0,Ko[35]=0,Jo[35]=-1,Qo[35]=0,Xo[35]=0,Zo[35]=1,Yo[35]=0,Ao[35]=-1,Po[35]=0,Ro[35]=1,Oo[35]=1,Lo[35]=0,No[35]=1,ko[153]=0,Fo[153]=1,Bo[153]=1,jo[153]=-1,Go[153]=0,$o[153]=0,Ko[153]=0,Jo[153]=-1,Qo[153]=0,Oo[153]=1,Lo[153]=0,No[153]=1,zo[102]=0,Uo[102]=-1,Vo[102]=1,qo[102]=1,Ho[102]=0,Wo[102]=0,Xo[102]=0,Zo[102]=1,Yo[102]=0,Ao[102]=-1,Po[102]=0,Ro[102]=1,ko[155]=0,Fo[155]=-1,Bo[155]=0,jo[155]=1,Go[155]=0,$o[155]=1,Ko[155]=0,Jo[155]=1,Qo[155]=1,Oo[155]=-1,Lo[155]=0,No[155]=0,zo[103]=0,Uo[103]=1,Vo[103]=0,qo[103]=-1,Ho[103]=0,Wo[103]=1,Xo[103]=0,Zo[103]=-1,Yo[103]=1,Ao[103]=1,Po[103]=0,Ro[103]=0,ko[152]=0,Fo[152]=1,Bo[152]=1,qo[152]=-1,Ho[152]=0,Wo[152]=1,jo[152]=-1,Go[152]=0,$o[152]=0,Ko[152]=0,Jo[152]=-1,Qo[152]=0,Xo[152]=0,Zo[152]=-1,Yo[152]=1,Oo[152]=1,Lo[152]=0,No[152]=1,ko[156]=0,Fo[156]=-1,Bo[156]=1,qo[156]=1,Ho[156]=0,Wo[156]=1,jo[156]=-1,Go[156]=0,$o[156]=0,Ko[156]=0,Jo[156]=-1,Qo[156]=0,Xo[156]=0,Zo[156]=1,Yo[156]=1,Oo[156]=-1,Lo[156]=0,No[156]=1,ko[137]=0,Fo[137]=1,Bo[137]=1,zo[137]=0,Uo[137]=1,Vo[137]=0,jo[137]=-1,Go[137]=0,$o[137]=0,Ko[137]=0,Jo[137]=-1,Qo[137]=0,Ao[137]=1,Po[137]=0,Ro[137]=0,Oo[137]=1,Lo[137]=0,No[137]=1,ko[139]=0,Fo[139]=1,Bo[139]=1,zo[139]=0,Uo[139]=-1,Vo[139]=0,jo[139]=1,Go[139]=0,$o[139]=0,Ko[139]=0,Jo[139]=1,Qo[139]=0,Ao[139]=-1,Po[139]=0,Ro[139]=0,Oo[139]=1,Lo[139]=0,No[139]=1,ko[98]=0,Fo[98]=-1,Bo[98]=0,zo[98]=0,Uo[98]=-1,Vo[98]=1,qo[98]=1,Ho[98]=0,Wo[98]=0,jo[98]=1,Go[98]=0,$o[98]=1,Xo[98]=0,Zo[98]=1,Yo[98]=0,Ao[98]=-1,Po[98]=0,Ro[98]=1,ko[99]=0,Fo[99]=1,Bo[99]=0,zo[99]=0,Uo[99]=-1,Vo[99]=1,qo[99]=1,Ho[99]=0,Wo[99]=0,jo[99]=-1,Go[99]=0,$o[99]=1,Xo[99]=0,Zo[99]=-1,Yo[99]=0,Ao[99]=1,Po[99]=0,Ro[99]=1,zo[38]=0,Uo[38]=-1,Vo[38]=1,qo[38]=1,Ho[38]=0,Wo[38]=0,Ko[38]=0,Jo[38]=1,Qo[38]=1,Xo[38]=0,Zo[38]=1,Yo[38]=0,Ao[38]=-1,Po[38]=0,Ro[38]=1,Oo[38]=-1,Lo[38]=0,No[38]=0,zo[39]=0,Uo[39]=1,Vo[39]=1,qo[39]=-1,Ho[39]=0,Wo[39]=0,Ko[39]=0,Jo[39]=-1,Qo[39]=1,Xo[39]=0,Zo[39]=1,Yo[39]=0,Ao[39]=-1,Po[39]=0,Ro[39]=1,Oo[39]=1,Lo[39]=0,No[39]=0;var QC=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},eS=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},tS=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},nS=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},rS=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},iS=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},oS=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},sS=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Rr=[],Mr=[],ii=[],Kr=[],bi=[],_i=[],es=[],os=[];Kr[1]=bi[1]=18,Kr[169]=bi[169]=18,ii[4]=Mr[4]=12,ii[166]=Mr[166]=12,Rr[16]=os[16]=4,Rr[154]=os[154]=4,_i[64]=es[64]=22,_i[106]=es[106]=22,ii[2]=_i[2]=17,Kr[2]=bi[2]=18,ii[168]=_i[168]=17,Kr[168]=bi[168]=18,Rr[8]=Kr[8]=9,Mr[8]=ii[8]=12,Rr[162]=Kr[162]=9,Mr[162]=ii[162]=12,Rr[32]=os[32]=4,Mr[32]=es[32]=1,Rr[138]=os[138]=4,Mr[138]=es[138]=1,bi[128]=os[128]=21,_i[128]=es[128]=22,bi[42]=os[42]=21,_i[42]=es[42]=22,Mr[5]=bi[5]=14,Mr[165]=bi[165]=14,ii[20]=os[20]=6,ii[150]=os[150]=6,Rr[80]=_i[80]=11,Rr[90]=_i[90]=11,Kr[65]=es[65]=3,Kr[105]=es[105]=3,Rr[160]=_i[160]=11,Mr[160]=bi[160]=14,Rr[10]=_i[10]=11,Mr[10]=bi[10]=14,ii[130]=os[130]=6,Kr[130]=es[130]=3,ii[40]=os[40]=6,Kr[40]=es[40]=3,Mr[101]=es[101]=1,Mr[69]=es[69]=1,bi[149]=os[149]=21,bi[21]=os[21]=21,ii[86]=_i[86]=17,ii[84]=_i[84]=17,Rr[89]=Kr[89]=9,Rr[81]=Kr[81]=9,Rr[96]=es[96]=0,Mr[96]=_i[96]=15,Rr[74]=es[74]=0,Mr[74]=_i[74]=15,Rr[24]=ii[24]=8,Kr[24]=os[24]=7,Rr[146]=ii[146]=8,Kr[146]=os[146]=7,Mr[6]=_i[6]=15,ii[6]=bi[6]=16,Mr[164]=_i[164]=15,ii[164]=bi[164]=16,Kr[129]=os[129]=7,bi[129]=es[129]=20,Kr[41]=os[41]=7,bi[41]=es[41]=20,ii[66]=es[66]=2,Kr[66]=_i[66]=19,ii[104]=es[104]=2,Kr[104]=_i[104]=19,Rr[144]=bi[144]=10,_i[144]=os[144]=23,Rr[26]=bi[26]=10,_i[26]=os[26]=23,Mr[36]=os[36]=5,ii[36]=es[36]=2,Mr[134]=os[134]=5,ii[134]=es[134]=2,Rr[9]=bi[9]=10,Mr[9]=Kr[9]=13,Rr[161]=bi[161]=10,Mr[161]=Kr[161]=13,Mr[37]=os[37]=5,bi[37]=es[37]=20,Mr[133]=os[133]=5,bi[133]=es[133]=20,ii[148]=bi[148]=16,_i[148]=os[148]=23,ii[22]=bi[22]=16,_i[22]=os[22]=23,Rr[82]=ii[82]=8,Kr[82]=_i[82]=19,Rr[88]=ii[88]=8,Kr[88]=_i[88]=19,Rr[73]=es[73]=0,Mr[73]=Kr[73]=13,Rr[97]=es[97]=0,Mr[97]=Kr[97]=13,Rr[145]=Kr[145]=9,bi[145]=os[145]=21,Rr[25]=Kr[25]=9,bi[25]=os[25]=21,Mr[70]=es[70]=1,ii[70]=_i[70]=17,Mr[100]=es[100]=1,ii[100]=_i[100]=17,Rr[34]=Kr[34]=9,Mr[34]=ii[34]=12,bi[34]=os[34]=21,_i[34]=es[34]=22,Rr[136]=os[136]=4,Mr[136]=es[136]=1,ii[136]=_i[136]=17,Kr[136]=bi[136]=18,Rr[35]=os[35]=4,Mr[35]=ii[35]=12,Kr[35]=bi[35]=18,_i[35]=es[35]=22,Rr[153]=os[153]=4,Kr[153]=bi[153]=18,Mr[102]=ii[102]=12,_i[102]=es[102]=22,Rr[155]=Kr[155]=9,bi[155]=os[155]=23,Mr[103]=es[103]=1,ii[103]=_i[103]=17,Rr[152]=os[152]=4,ii[152]=_i[152]=17,Kr[152]=bi[152]=18,Rr[156]=ii[156]=8,Kr[156]=bi[156]=18,_i[156]=os[156]=23,Rr[137]=os[137]=4,Mr[137]=es[137]=1,Kr[137]=bi[137]=18,Rr[139]=os[139]=4,Mr[139]=Kr[139]=13,bi[139]=es[139]=20,Rr[98]=Kr[98]=9,Mr[98]=ii[98]=12,_i[98]=es[98]=22,Rr[99]=es[99]=0,Mr[99]=ii[99]=12,Kr[99]=_i[99]=19,Mr[38]=ii[38]=12,bi[38]=os[38]=21,_i[38]=es[38]=22,Mr[39]=os[39]=5,ii[39]=bi[39]=16,_i[39]=es[39]=22;var mr=[];function uS(t,e,n){return function TG(t){return(t>0)-(t<0)||+t}((e[0]-t[0])*(n[1]-e[1])-(n[0]-e[0])*(e[1]-t[1]))}function u2(t,e){return e.geometry.coordinates[0].every(function(n){return CR(vx(n),t)})}mr[1]=mr[169]=QC,mr[4]=mr[166]=eS,mr[16]=mr[154]=tS,mr[64]=mr[106]=nS,mr[168]=mr[2]=rS,mr[162]=mr[8]=iS,mr[138]=mr[32]=oS,mr[42]=mr[128]=sS,mr[5]=mr[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},mr[20]=mr[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},mr[80]=mr[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},mr[65]=mr[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},mr[160]=mr[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},mr[130]=mr[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},mr[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},mr[101]=mr[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},mr[149]=mr[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},mr[86]=mr[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},mr[89]=mr[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},mr[96]=mr[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},mr[24]=mr[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},mr[6]=mr[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},mr[129]=mr[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},mr[66]=mr[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},mr[144]=mr[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},mr[36]=mr[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},mr[9]=mr[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},mr[37]=mr[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},mr[148]=mr[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},mr[82]=mr[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},mr[73]=mr[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},mr[145]=mr[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},mr[70]=mr[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},mr[34]=function(t){return[sS(t),iS(t)]},mr[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},mr[136]=function(t){return[oS(t),rS(t)]},mr[153]=function(t){return[tS(t),QC(t)]},mr[102]=function(t){return[eS(t),nS(t)]},mr[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},mr[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},mr[152]=function(t){return[tS(t),rS(t)]},mr[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},mr[137]=function(t){return[oS(t),QC(t)]},mr[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},mr[98]=function(t){return[iS(t),nS(t)]},mr[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},mr[38]=function(t){return[eS(t),sS(t)]},mr[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};const c2=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(e){return e.join(",")},t.prototype.removeInnerEdge=function(e){this.innerEdges=this.innerEdges.filter(function(n){return n.from.id!==e.from.id})},t.prototype.removeOuterEdge=function(e){this.outerEdges=this.outerEdges.filter(function(n){return n.to.id!==e.to.id})},t.prototype.addOuterEdge=function(e){this.outerEdges.push(e),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var e=this;this.outerEdgesSorted||(this.outerEdges.sort(function(n,r){var i=n.to,s=r.to;if(i.coordinates[0]-e.coordinates[0]>=0&&s.coordinates[0]-e.coordinates[0]<0)return 1;if(i.coordinates[0]-e.coordinates[0]<0&&s.coordinates[0]-e.coordinates[0]>=0)return-1;if(i.coordinates[0]-e.coordinates[0]==0&&s.coordinates[0]-e.coordinates[0]==0)return i.coordinates[1]-e.coordinates[1]>=0||s.coordinates[1]-e.coordinates[1]>=0?i.coordinates[1]-s.coordinates[1]:s.coordinates[1]-i.coordinates[1];var f=uS(e.coordinates,i.coordinates,s.coordinates);return f<0?1:f>0?-1:Math.pow(i.coordinates[0]-e.coordinates[0],2)+Math.pow(i.coordinates[1]-e.coordinates[1],2)-(Math.pow(s.coordinates[0]-e.coordinates[0],2)+Math.pow(s.coordinates[1]-e.coordinates[1],2))}),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(e){return this.sortOuterEdges(),this.outerEdges[e]},t.prototype.addInnerEdge=function(e){this.innerEdges.push(e)},t}(),PG=function(){function t(e,n){this.from=e,this.to=n,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(e){return this.from.id===e.from.id&&this.to.id===e.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return function FC(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return hd({type:"LineString",coordinates:t},e,n)}([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(e){return uS(e.from.coordinates,e.to.coordinates,this.to.coordinates)},t}(),OG=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(e){this.edges.push(e),this.polygon=this.envelope=void 0},t.prototype.get=function(e){return this.edges[e]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(e){this.edges.forEach(e)},t.prototype.map=function(e){return this.edges.map(e)},t.prototype.some=function(e){return this.edges.some(e)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var e=this,n=this.edges.reduce(function(f,g,v){return g.from.coordinates[1]>e.edges[f].from.coordinates[1]&&(f=v),f},0),r=(0===n?this.length:n)-1,i=(n+1)%this.length,s=uS(this.edges[r].from.coordinates,this.edges[n].from.coordinates,this.edges[i].from.coordinates);return 0===s?this.edges[r].from.coordinates[0]>this.edges[i].from.coordinates[0]:s>0},t.prototype.toMultiPoint=function(){return function _R(t,e,n){return void 0===n&&(n={}),hd({type:"MultiPoint",coordinates:t},e,n)}(this.edges.map(function(e){return e.from.coordinates}))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var e=this.edges.map(function(n){return n.from.coordinates});return e.push(this.edges[0].from.coordinates),this.polygon=xx([e])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function Uj(t){return function zj(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),s=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[n,r];return xx([[f,[i,r],[i,s],[n,s],f]],e.properties,{bbox:t,id:e.id})}(sj(t))}(this.toPolygon())},t.findEdgeRingContaining=function(e,n){var i,s,r=e.getEnvelope();return n.forEach(function(f){var g=f.getEnvelope();if(s&&(i=s.getEnvelope()),!function IG(t,e){var n=t.geometry.coordinates[0].map(function(f){return f[0]}),r=t.geometry.coordinates[0].map(function(f){return f[1]}),i=e.geometry.coordinates[0].map(function(f){return f[0]}),s=e.geometry.coordinates[0].map(function(f){return f[1]});return Math.max.apply(null,n)===Math.max.apply(null,i)&&Math.max.apply(null,r)===Math.max.apply(null,s)&&Math.min.apply(null,n)===Math.min.apply(null,i)&&Math.min.apply(null,r)===Math.min.apply(null,s)}(g,r)&&u2(g,r)){for(var v=e.map(function(ee){return ee.from.coordinates}),x=void 0,M=function(ee){f.some(function(se){return function MG(t,e){return t[0]===e[0]&&t[1]===e[1]}(ee,se.from.coordinates)})||(x=ee)},R=0,L=v;R<L.length;R++)M(L[R]);x&&f.inside(vx(x))&&(!s||u2(i,g))&&(s=f)}}),s},t.prototype.inside=function(e){return CR(e,this.toPolygon())},t}();function v2(t){for(var e=t,n=[];e.parent;)n.unshift(e),e=e.parent;return n}!function(){function t(){this.edges=[],this.nodes={}}t.fromGeoJson=function(e){!function LG(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var n=new t;return function wx(t,e){xR(t,function(n,r,i,s,f){var v,g=null===n?null:n.type;switch(g){case null:case"Point":case"LineString":case"Polygon":return!1!==e(hd(n,i,{bbox:s,id:f}),r,0)&&void 0}switch(g){case"MultiPoint":v="Point";break;case"MultiLineString":v="LineString";break;case"MultiPolygon":v="Polygon"}for(var x=0;x<n.coordinates.length;x++)if(!1===e(hd({type:v,coordinates:n.coordinates[x]},i),r,x))return!1})}(e,function(r){(function uj(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)})(r,"LineString","Graph::fromGeoJson"),function ej(t,e,n,r){var i=n;hv(t,function(s,f,g,v,x){i=0===f&&void 0===n?s:e(i,s,f,g,v,x)},r)}(r,function(i,s){if(i){var f=n.getNode(i),g=n.getNode(s);n.addEdge(f,g)}return s})}),n},t.prototype.getNode=function(e){var n=c2.buildId(e),r=this.nodes[n];return r||(r=this.nodes[n]=new c2(e)),r},t.prototype.addEdge=function(e,n){var r=new PG(e,n),i=r.getSymetric();this.edges.push(r),this.edges.push(i)},t.prototype.deleteDangles=function(){var e=this;Object.keys(this.nodes).map(function(n){return e.nodes[n]}).forEach(function(n){return e._removeIfDangle(n)})},t.prototype._removeIfDangle=function(e){var n=this;if(e.innerEdges.length<=1){var r=e.getOuterEdges().map(function(i){return i.to});this.removeNode(e),r.forEach(function(i){return n._removeIfDangle(i)})}},t.prototype.deleteCutEdges=function(){var e=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(n){n.label===n.symetric.label&&(e.removeEdge(n.symetric),e.removeEdge(n))})},t.prototype._computeNextCWEdges=function(e){var n=this;typeof e>"u"?Object.keys(this.nodes).forEach(function(r){return n._computeNextCWEdges(n.nodes[r])}):e.getOuterEdges().forEach(function(r,i){e.getOuterEdge((0===i?e.getOuterEdges().length:i)-1).symetric.next=r})},t.prototype._computeNextCCWEdges=function(e,n){for(var i,s,r=e.getOuterEdges(),f=r.length-1;f>=0;--f){var g=r[f],v=g.symetric,x=void 0,M=void 0;g.label===n&&(x=g),v.label===n&&(M=v),x&&M&&(M&&(s=M),x&&(s&&(s.next=x,s=void 0),i||(i=x)))}s&&(s.next=i)},t.prototype._findLabeledEdgeRings=function(){var e=[],n=0;return this.edges.forEach(function(r){if(!(r.label>=0)){e.push(r);var i=r;do{i.label=n,i=i.next}while(!r.isEqual(i));n++}}),e},t.prototype.getEdgeRings=function(){var e=this;this._computeNextCWEdges(),this.edges.forEach(function(r){r.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){e._findIntersectionNodes(r).forEach(function(i){e._computeNextCCWEdges(i,r.label)})});var n=[];return this.edges.forEach(function(r){r.ring||n.push(e._findEdgeRing(r))}),n},t.prototype._findIntersectionNodes=function(e){var n=[],r=e,i=function(){var s=0;r.from.getOuterEdges().forEach(function(f){f.label===e.label&&++s}),s>1&&n.push(r.from),r=r.next};do{i()}while(!e.isEqual(r));return n},t.prototype._findEdgeRing=function(e){var n=e,r=new OG;do{r.push(n),n.ring=r,n=n.next}while(!e.isEqual(n));return r},t.prototype.removeNode=function(e){var n=this;e.getOuterEdges().forEach(function(r){return n.removeEdge(r)}),e.innerEdges.forEach(function(r){return n.removeEdge(r)}),delete this.nodes[e.id]},t.prototype.removeEdge=function(e){this.edges=this.edges.filter(function(n){return!n.isEqual(e)}),e.deleteEdge()}}(),xe(5013),xe(7470),xe(9475);var Mx={search:function(t,e,n,r){t.cleanDirty();var i=(r=r||{}).heuristic||Mx.heuristics.manhattan,s=r.closest||!1,f=function YG(){return new x2(function(t){return t.f})}(),g=e;for(e.h=i(e,n),f.push(e);f.size()>0;){var v=f.pop();if(v===n)return v2(v);v.closed=!0;for(var x=t.neighbors(v),M=0,R=x.length;M<R;++M){var L=x[M];if(!L.closed&&!L.isWall()){var B=v.g+L.getCost(v),ee=L.visited;(!ee||B<L.g)&&(L.visited=!0,L.parent=v,L.h=L.h||i(L,n),L.g=B,L.f=L.g+L.h,t.markDirty(L),s&&(L.h<g.h||L.h===g.h&&L.g<g.g)&&(g=L),ee?f.rescoreElement(L):f.push(L))}}}return s?v2(g):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var r=Math.sqrt(2),i=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);return 1*(i+s)+(r-2)*Math.min(i,s)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function Jm(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var n=0;n<t.length;n++){this.grid[n]=[];for(var r=0,i=t[n];r<i.length;r++){var s=new Dx(n,r,i[r]);this.grid[n][r]=s,this.nodes.push(s)}}this.init()}function Dx(t,e,n){this.x=t,this.y=e,this.weight=n}function x2(t){this.content=[],this.scoreFunction=t}function hS(){this._=null}function Ax(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function mv(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function yv(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function w2(t){for(;t.L;)t=t.L;return t}Jm.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)Mx.cleanNode(this.nodes[t])},Jm.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)Mx.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},Jm.prototype.markDirty=function(t){this.dirtyNodes.push(t)},Jm.prototype.neighbors=function(t){var e=[],n=t.x,r=t.y,i=this.grid;return i[n-1]&&i[n-1][r]&&e.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&e.push(i[n+1][r]),i[n]&&i[n][r-1]&&e.push(i[n][r-1]),i[n]&&i[n][r+1]&&e.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&e.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&e.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&e.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&e.push(i[n+1][r+1])),e},Jm.prototype.toString=function(){for(var n,r,i,s,t=[],e=this.grid,f=0,g=e.length;f<g;f++){for(n=[],i=0,s=(r=e[f]).length;i<s;i++)n.push(r[i].weight);t.push(n.join(" "))}return t.join("\n")},Dx.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Dx.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Dx.prototype.isWall=function(){return 0===this.weight},x2.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var g,i=t+1<<1,s=i-1,f=null;if(s<e&&(g=this.scoreFunction(this.content[s]))<r&&(f=s),i<e&&this.scoreFunction(this.content[i])<(null===f?r:g)&&(f=i),null===f)break;this.content[t]=this.content[f],this.content[f]=n,t=f}}},hS.prototype={constructor:hS,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=w2(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(mv(this,n),n=(t=n).U),n.C=!1,r.C=!0,yv(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(yv(this,n),n=(t=n).U),n.C=!1,r.C=!0,mv(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var n,s,f,e=t.U,r=t.L,i=t.R;if(s=r?i?w2(i):r:i,e?e.L===t?e.L=s:e.R=s:this._=s,r&&i?(f=s.C,s.C=t.C,s.L=r,r.U=s,s!==i?(e=s.U,s.U=t.U,e.L=t=s.R,s.R=i,i.U=s):(s.U=e,e=s,t=s.R)):(f=t.C,t=s),t&&(t.U=e),!f){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===e.L){if((n=e.R).C&&(n.C=!1,e.C=!0,mv(this,e),n=e.R),n.L&&n.L.C||n.R&&n.R.C){(!n.R||!n.R.C)&&(n.L.C=!1,n.C=!0,yv(this,n),n=e.R),n.C=e.C,e.C=n.R.C=!1,mv(this,e),t=this._;break}}else if((n=e.L).C&&(n.C=!1,e.C=!0,yv(this,e),n=e.L),n.L&&n.L.C||n.R&&n.R.C){(!n.L||!n.L.C)&&(n.R.C=!1,n.C=!0,mv(this,n),n=e.L),n.C=e.C,e.C=n.L.C=!1,yv(this,e),t=this._;break}n.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};const b2=hS;function _v(t,e,n,r){var i=[null,null],s=Ju.push(i)-1;return i.left=t,i.right=e,n&&Px(i,t,e,n),r&&Px(i,e,t,r),Jc[t.index].halfedges.push(s),Jc[e.index].halfedges.push(s),i}function vv(t,e,n){var r=[e,n];return r.left=t,r}function Px(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function JG(t,e,n,r,i){var se,s=t[0],f=t[1],g=s[0],v=s[1],R=0,L=1,B=f[0]-g,ee=f[1]-v;if(se=e-g,B||!(se>0)){if(se/=B,B<0){if(se<R)return;se<L&&(L=se)}else if(B>0){if(se>L)return;se>R&&(R=se)}if(se=r-g,B||!(se<0)){if(se/=B,B<0){if(se>L)return;se>R&&(R=se)}else if(B>0){if(se<R)return;se<L&&(L=se)}if(se=n-v,ee||!(se>0)){if(se/=ee,ee<0){if(se<R)return;se<L&&(L=se)}else if(ee>0){if(se>L)return;se>R&&(R=se)}if(se=i-v,ee||!(se<0)){if(se/=ee,ee<0){if(se>L)return;se>R&&(R=se)}else if(ee>0){if(se<R)return;se<L&&(L=se)}return!(R>0)&&!(L<1)||(R>0&&(t[0]=[g+R*B,v+R*ee]),L<1&&(t[1]=[g+L*B,v+L*ee])),!0}}}}}function QG(t,e,n,r,i){var s=t[1];if(s)return!0;var se,Oe,f=t[0],g=t.left,v=t.right,x=g[0],M=g[1],R=v[0],L=v[1],B=(x+R)/2;if(L===M){if(B<e||B>=r)return;if(x>R){if(f){if(f[1]>=i)return}else f=[B,n];s=[B,i]}else{if(f){if(f[1]<n)return}else f=[B,i];s=[B,n]}}else if(Oe=(M+L)/2-(se=(x-R)/(L-M))*B,se<-1||se>1)if(x>R){if(f){if(f[1]>=i)return}else f=[(n-Oe)/se,n];s=[(i-Oe)/se,i]}else{if(f){if(f[1]<n)return}else f=[(i-Oe)/se,i];s=[(n-Oe)/se,n]}else if(M<L){if(f){if(f[0]>=r)return}else f=[e,se*e+Oe];s=[r,se*r+Oe]}else{if(f){if(f[0]<e)return}else f=[r,se*r+Oe];s=[e,se*e+Oe]}return t[0]=f,t[1]=s,!0}function n8(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function E2(t,e){return e[+(e.left!==t.site)]}function r8(t,e){return e[+(e.left===t.site)]}var fS,C2=[];function s8(){Ax(this),this.x=this.y=this.arc=this.site=this.cy=null}function Qm(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,s=n.site;if(r!==s){var f=i[0],g=i[1],v=r[0]-f,x=r[1]-g,M=s[0]-f,R=s[1]-g,L=2*(v*R-x*M);if(!(L>=-h8)){var B=v*v+x*x,ee=M*M+R*R,se=(R*B-x*ee)/L,Oe=(v*ee-M*B)/L,Ee=C2.pop()||new s8;Ee.arc=t,Ee.site=i,Ee.x=se+f,Ee.y=(Ee.cy=Oe+g)+Math.sqrt(se*se+Oe*Oe),t.circle=Ee;for(var _e=null,ve=xv._;ve;)if(Ee.y<ve.y||Ee.y===ve.y&&Ee.x<=ve.x){if(!ve.L){_e=ve.P;break}ve=ve.L}else{if(!ve.R){_e=ve;break}ve=ve.R}xv.insert(_e,Ee),_e||(fS=Ee)}}}}function ey(t){var e=t.circle;e&&(e.P||(fS=e.N),xv.remove(e),C2.push(e),Ax(e),t.circle=null)}var S2=[];function a8(){Ax(this),this.edge=this.site=this.circle=null}function T2(t){var e=S2.pop()||new a8;return e.site=t,e}function dS(t){ey(t),ty.remove(t),S2.push(t),Ax(t)}function l8(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],s=t.P,f=t.N,g=[t];dS(t);for(var v=s;v.circle&&Math.abs(n-v.circle.x)<rl&&Math.abs(r-v.circle.cy)<rl;)s=v.P,g.unshift(v),dS(v),v=s;g.unshift(v),ey(v);for(var x=f;x.circle&&Math.abs(n-x.circle.x)<rl&&Math.abs(r-x.circle.cy)<rl;)f=x.N,g.push(x),dS(x),x=f;g.push(x),ey(x);var R,M=g.length;for(R=1;R<M;++R)Px((x=g[R]).edge,(v=g[R-1]).site,x.site,i);(x=g[M-1]).edge=_v((v=g[0]).site,x.site,null,i),Qm(v),Qm(x)}function u8(t){for(var r,i,s,f,e=t[0],n=t[1],g=ty._;g;)if((s=I2(g,n)-e)>rl)g=g.L;else{if(!((f=e-c8(g,n))>rl)){s>-rl?(r=g.P,i=g):f>-rl?(r=g,i=g.N):r=i=g;break}if(!g.R){r=g;break}g=g.R}!function t8(t){Jc[t.index]={site:t,halfedges:[]}}(t);var v=T2(t);if(ty.insert(r,v),r||i){if(r===i)return ey(r),i=T2(r.site),ty.insert(v,i),v.edge=i.edge=_v(r.site,v.site),Qm(r),void Qm(i);if(!i)return void(v.edge=_v(r.site,v.site));ey(r),ey(i);var x=r.site,M=x[0],R=x[1],L=t[0]-M,B=t[1]-R,ee=i.site,se=ee[0]-M,Oe=ee[1]-R,Ee=2*(L*Oe-B*se),_e=L*L+B*B,ve=se*se+Oe*Oe,it=[(Oe*_e-B*ve)/Ee+M,(L*ve-se*_e)/Ee+R];Px(i.edge,x,ee,it),v.edge=_v(x,t,null,it),i.edge=_v(t,ee,null,it),Qm(r),Qm(i)}}function I2(t,e){var n=t.site,r=n[0],i=n[1],s=i-e;if(!s)return r;var f=t.P;if(!f)return-1/0;var g=(n=f.site)[0],v=n[1],x=v-e;if(!x)return g;var M=g-r,R=1/s-1/x,L=M/x;return R?(-L+Math.sqrt(L*L-2*R*(M*M/(-2*x)-v+x/2+i-s/2)))/R+r:(r+g)/2}function c8(t,e){var n=t.N;if(n)return I2(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var ty,Jc,xv,Ju,rl=1e-6,h8=1e-12;function f8(t,e,n){return(t[0]-n[0])*(e[1]-t[1])-(t[0]-e[0])*(n[1]-t[1])}function d8(t,e){return e[1]-t[1]||e[0]-t[0]}function M2(t,e){var r,i,s,n=t.sort(d8).pop();for(Ju=[],Jc=new Array(t.length),ty=new b2,xv=new b2;;)if(s=fS,n&&(!s||n[1]<s.y||n[1]===s.y&&n[0]<s.x))(n[0]!==r||n[1]!==i)&&(u8(n),r=n[0],i=n[1]),n=t.pop();else{if(!s)break;l8(s.arc)}if(function i8(){for(var n,r,i,s,t=0,e=Jc.length;t<e;++t)if((n=Jc[t])&&(s=(r=n.halfedges).length)){var f=new Array(s),g=new Array(s);for(i=0;i<s;++i)f[i]=i,g[i]=n8(n,Ju[r[i]]);for(f.sort(function(v,x){return g[x]-g[v]}),i=0;i<s;++i)g[i]=r[f[i]];for(i=0;i<s;++i)r[i]=g[i]}}(),e){var f=+e[0][0],g=+e[0][1],v=+e[1][0],x=+e[1][1];(function e8(t,e,n,r){for(var s,i=Ju.length;i--;)QG(s=Ju[i],t,e,n,r)&&JG(s,t,e,n,r)&&(Math.abs(s[0][0]-s[1][0])>rl||Math.abs(s[0][1]-s[1][1])>rl)||delete Ju[i]})(f,g,v,x),function o8(t,e,n,r){var s,f,g,v,x,M,R,L,B,ee,se,Oe,i=Jc.length,Ee=!0;for(s=0;s<i;++s)if(f=Jc[s]){for(g=f.site,v=(x=f.halfedges).length;v--;)Ju[x[v]]||x.splice(v,1);for(v=0,M=x.length;v<M;)se=(ee=r8(f,Ju[x[v]]))[0],Oe=ee[1],L=(R=E2(f,Ju[x[++v%M]]))[0],B=R[1],(Math.abs(se-L)>rl||Math.abs(Oe-B)>rl)&&(x.splice(v,0,Ju.push(vv(g,ee,Math.abs(se-t)<rl&&r-Oe>rl?[t,Math.abs(L-t)<rl?B:r]:Math.abs(Oe-r)<rl&&n-se>rl?[Math.abs(B-r)<rl?L:n,r]:Math.abs(se-n)<rl&&Oe-e>rl?[n,Math.abs(L-n)<rl?B:e]:Math.abs(Oe-e)<rl&&se-t>rl?[Math.abs(B-e)<rl?L:t,e]:null))-1),++M);M&&(Ee=!1)}if(Ee){var _e,ve,it,mt=1/0;for(s=0,Ee=null;s<i;++s)(f=Jc[s])&&(it=(_e=(g=f.site)[0]-t)*_e+(ve=g[1]-e)*ve)<mt&&(mt=it,Ee=f);if(Ee){var Ot=[t,e],kt=[t,r],tn=[n,r],ut=[n,e];Ee.halfedges.push(Ju.push(vv(g=Ee.site,Ot,kt))-1,Ju.push(vv(g,kt,tn))-1,Ju.push(vv(g,tn,ut))-1,Ju.push(vv(g,ut,Ot))-1)}}for(s=0;s<i;++s)(f=Jc[s])&&(f.halfedges.length||delete Jc[s])}(f,g,v,x)}this.edges=Ju,this.cells=Jc,ty=xv=Ju=Jc=null}function pp(){return new Rx}function Rx(){this.reset()}M2.prototype={constructor:M2,polygons:function(){var t=this.edges;return this.cells.map(function(e){var n=e.halfedges.map(function(r){return E2(e,t[r])});return n.data=e.site.data,n})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(n,r){if(g=(s=n.halfedges).length)for(var s,g,v,i=n.site,f=-1,x=e[s[g-1]],M=x.left===i?x.right:x.left;++f<g;)v=M,M=(x=e[s[f]]).left===i?x.right:x.left,v&&M&&r<v.index&&r<M.index&&f8(i,v,M)<0&&t.push([i.data,v.data,M.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,n){for(var i,g,r=this,s=r._found||0,f=r.cells.length;!(g=r.cells[s]);)if(++s>=f)return null;var v=t-g.site[0],x=e-g.site[1],M=v*v+x*x;do{g=r.cells[i=s],s=null,g.halfedges.forEach(function(R){var L=r.edges[R],B=L.left;if(B!==g.site&&B||(B=L.right)){var ee=t-B[0],se=e-B[1],Oe=ee*ee+se*se;Oe<M&&(M=Oe,s=B.index)}})}while(null!==s);return r._found=i,null==n||M<=n*n?g.site:null}},xe(9855),xe(770),Rx.prototype={constructor:Rx,reset:function(){this.s=this.t=0},add:function(t){z2(Ox,t,this.t),z2(this,Ox.s,this.s),this.s?this.t+=Ox.t:this.s=Ox.t},valueOf:function(){return this.s}};var Ox=new Rx;function z2(t,e,n){var r=t.s=e+n,i=r-e;t.t=e-(r-i)+(n-i)}var fl=Math.PI,Nc=fl/2,ny=2*fl,Ka=fl/180,wv=(Math,Math.atan),ry=Math.atan2,Fs=Math.cos,ss=(Math,Math,Math,Math,Math,Math.sin),fd=(Math,Math.sqrt);Math;function iy(t){return t>1?Nc:t<-1?-Nc:Math.asin(t)}function IS(t,e){return[t>fl?t-ny:t<-fl?t+ny:t,e]}function fO(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}pp(),pp(),pp(),IS.invert=IS,function q8(t){1===t.length&&(t=function H8(t){return function(e,n){return fO(t(e),n)}}(t))}(fO),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);pp();function HS(){}function BO(t){return function(e,n){var r=Fs(e),i=Fs(n),s=t(r*i);return[s*i*ss(e),s*ss(n)]}}function Pv(t){return function(e,n){var r=fd(e*e+n*n),i=t(r),s=ss(i),f=Fs(i);return[ry(e*s,r*f),iy(r&&n*s/r)]}}function XS(t,e){return[t,e]}pp(),pp(),pp(),pp(),function NO(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}(4.5),HS.prototype={constructor:HS,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Fs(30*Ka),function kO(t){return function(e){var n=new HS;for(var r in t)n[r]=t[r];return n.stream=e,n}}({point:function(t,e){this.stream.point(t*Ka,e*Ka)}}),BO(function(t){return fd(2/(1+t))}).invert=Pv(function(t){return 2*iy(t/2)}),BO(function(t){return(t=function I8(t){return t>1?0:t<-1?fl:Math.acos(t)}(t))&&t/ss(t)}).invert=Pv(function(t){return t}),XS.invert=XS,Pv(wv),Pv(iy),Pv(function(t){return 2*wv(t)});class YO{}class KO{}class gd{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const r=n.indexOf(":");if(r>0){const i=n.slice(0,r),s=i.toLowerCase(),f=n.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(f):this.headers.set(s,[f])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let r=e[n];const i=n.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(i,r),this.maybeSetNormalizedName(n,i))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof gd?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new gd;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof gd?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,n);const i=("a"===e.op?this.headers.get(n):void 0)||[];i.push(...r),this.headers.set(n,i);break;case"d":const s=e.value;if(s){let f=this.headers.get(n);if(!f)return;f=f.filter(g=>-1===s.indexOf(g)),0===f.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,f)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class z${encodeKey(e){return JO(e)}encodeValue(e){return JO(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const V$=/%(\d[a-f0-9])/gi,j$={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function JO(t){return encodeURIComponent(t).replace(V$,(e,n)=>j$[n]??e)}function ow(t){return`${t}`}class mp{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new z$,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function U$(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(i=>{const s=i.indexOf("="),[f,g]=-1==s?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],v=n.get(f)||[];v.push(g),n.set(f,v)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const r=e.fromObject[n],i=Array.isArray(r)?r.map(ow):[ow(r)];this.map.set(n,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(r=>{const i=e[r];Array.isArray(i)?i.forEach(s=>{n.push({param:r,value:s,op:"a"})}):n.push({param:r,value:i,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(r=>n+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new mp({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(ow(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const i=r.indexOf(ow(e.value));-1!==i&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class G${constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function QO(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function eL(t){return typeof Blob<"u"&&t instanceof Blob}function tL(t){return typeof FormData<"u"&&t instanceof FormData}class Rv{constructor(e,n,r,i){let s;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function $$(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new gd),this.context||(this.context=new G$),this.params){const f=this.params.toString();if(0===f.length)this.urlWithParams=n;else{const g=n.indexOf("?");this.urlWithParams=n+(-1===g?"?":g<n.length-1?"&":"")+f}}else this.params=new mp,this.urlWithParams=n}serializeBody(){return null===this.body?null:QO(this.body)||eL(this.body)||tL(this.body)||function q$(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof mp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||tL(this.body)?null:eL(this.body)?this.body.type||null:QO(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof mp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,f=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,g=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let v=e.headers||this.headers,x=e.params||this.params;const M=e.context??this.context;return void 0!==e.setHeaders&&(v=Object.keys(e.setHeaders).reduce((R,L)=>R.set(L,e.setHeaders[L]),v)),e.setParams&&(x=Object.keys(e.setParams).reduce((R,L)=>R.set(L,e.setParams[L]),x)),new Rv(n,r,s,{params:x,headers:v,context:M,reportProgress:g,responseType:i,withCredentials:f})}}var ru=(()=>((ru=ru||{})[ru.Sent=0]="Sent",ru[ru.UploadProgress=1]="UploadProgress",ru[ru.ResponseHeader=2]="ResponseHeader",ru[ru.DownloadProgress=3]="DownloadProgress",ru[ru.Response=4]="Response",ru[ru.User=5]="User",ru))();class ZS{constructor(e,n=200,r="OK"){this.headers=e.headers||new gd,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class YS extends ZS{constructor(e={}){super(e),this.type=ru.ResponseHeader}clone(e={}){return new YS({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class sw extends ZS{constructor(e={}){super(e),this.type=ru.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new sw({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class nL extends ZS{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function KS(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let rL=(()=>{class t{constructor(n){this.handler=n}request(n,r,i={}){let s;if(n instanceof Rv)s=n;else{let v,x;v=i.headers instanceof gd?i.headers:new gd(i.headers),i.params&&(x=i.params instanceof mp?i.params:new mp({fromObject:i.params})),s=new Rv(n,r,void 0!==i.body?i.body:null,{headers:v,context:i.context,params:x,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials})}const f=fi(s).pipe(hp(v=>this.handler.handle(v)));if(n instanceof Rv||"events"===i.observe)return f;const g=f.pipe(gc(v=>v instanceof sw));switch(i.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return g.pipe(At(v=>{if(null!==v.body&&!(v.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return v.body}));case"blob":return g.pipe(At(v=>{if(null!==v.body&&!(v.body instanceof Blob))throw new Error("Response is not a Blob.");return v.body}));case"text":return g.pipe(At(v=>{if(null!==v.body&&"string"!=typeof v.body)throw new Error("Response is not a string.");return v.body}));default:return g.pipe(At(v=>v.body))}case"response":return g;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new mp).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,i={}){return this.request("PATCH",n,KS(i,r))}post(n,r,i={}){return this.request("POST",n,KS(i,r))}put(n,r,i={}){return this.request("PUT",n,KS(i,r))}}return t.\u0275fac=function(n){return new(n||t)(Gt(YO))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();class iL{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const oL=new Er("HTTP_INTERCEPTORS");let H$=(()=>{class t{intercept(n,r){return r.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();const W$=/^\)\]\}',?\n/;let sL=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Bt(r=>{const i=this.xhrFactory.build();if(i.open(n.method,n.urlWithParams),n.withCredentials&&(i.withCredentials=!0),n.headers.forEach((B,ee)=>i.setRequestHeader(B,ee.join(","))),n.headers.has("Accept")||i.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const B=n.detectContentTypeHeader();null!==B&&i.setRequestHeader("Content-Type",B)}if(n.responseType){const B=n.responseType.toLowerCase();i.responseType="json"!==B?B:"text"}const s=n.serializeBody();let f=null;const g=()=>{if(null!==f)return f;const B=i.statusText||"OK",ee=new gd(i.getAllResponseHeaders()),se=function X$(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(i)||n.url;return f=new YS({headers:ee,status:i.status,statusText:B,url:se}),f},v=()=>{let{headers:B,status:ee,statusText:se,url:Oe}=g(),Ee=null;204!==ee&&(Ee=typeof i.response>"u"?i.responseText:i.response),0===ee&&(ee=Ee?200:0);let _e=ee>=200&&ee<300;if("json"===n.responseType&&"string"==typeof Ee){const ve=Ee;Ee=Ee.replace(W$,"");try{Ee=""!==Ee?JSON.parse(Ee):null}catch(it){Ee=ve,_e&&(_e=!1,Ee={error:it,text:Ee})}}_e?(r.next(new sw({body:Ee,headers:B,status:ee,statusText:se,url:Oe||void 0})),r.complete()):r.error(new nL({error:Ee,headers:B,status:ee,statusText:se,url:Oe||void 0}))},x=B=>{const{url:ee}=g(),se=new nL({error:B,status:i.status||0,statusText:i.statusText||"Unknown Error",url:ee||void 0});r.error(se)};let M=!1;const R=B=>{M||(r.next(g()),M=!0);let ee={type:ru.DownloadProgress,loaded:B.loaded};B.lengthComputable&&(ee.total=B.total),"text"===n.responseType&&!!i.responseText&&(ee.partialText=i.responseText),r.next(ee)},L=B=>{let ee={type:ru.UploadProgress,loaded:B.loaded};B.lengthComputable&&(ee.total=B.total),r.next(ee)};return i.addEventListener("load",v),i.addEventListener("error",x),i.addEventListener("timeout",x),i.addEventListener("abort",x),n.reportProgress&&(i.addEventListener("progress",R),null!==s&&i.upload&&i.upload.addEventListener("progress",L)),i.send(s),r.next({type:ru.Sent}),()=>{i.removeEventListener("error",x),i.removeEventListener("abort",x),i.removeEventListener("load",v),i.removeEventListener("timeout",x),n.reportProgress&&(i.removeEventListener("progress",R),null!==s&&i.upload&&i.upload.removeEventListener("progress",L)),i.readyState!==i.DONE&&i.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(Gt(AA))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();const JS=new Er("XSRF_COOKIE_NAME"),QS=new Er("XSRF_HEADER_NAME");class aL{}let Z$=(()=>{class t{constructor(n,r,i){this.doc=n,this.platform=r,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=wA(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os),Gt(I1),Gt(JS))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),eT=(()=>{class t{constructor(n,r){this.tokenService=n,this.headerName=r}intercept(n,r){const i=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||i.startsWith("http://")||i.startsWith("https://"))return r.handle(n);const s=this.tokenService.getToken();return null!==s&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,s)})),r.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(Gt(aL),Gt(QS))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),Y$=(()=>{class t{constructor(n,r){this.backend=n,this.injector=r,this.chain=null}handle(n){if(null===this.chain){const r=this.injector.get(oL,[]);this.chain=r.reduceRight((i,s)=>new iL(i,s),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(Gt(KO),Gt(du))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),K$=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:eT,useClass:H$}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:JS,useValue:n.cookieName}:[],n.headerName?{provide:QS,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({providers:[eT,{provide:oL,useExisting:eT,multi:!0},{provide:aL,useClass:Z$},{provide:JS,useValue:"XSRF-TOKEN"},{provide:QS,useValue:"X-XSRF-TOKEN"}]}),t})(),J$=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({providers:[rL,{provide:YO,useClass:Y$},sL,{provide:KO,useExisting:sL}],imports:[K$.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),t})(),Q$=(()=>{class t{constructor(n){this.http=n,this.ENDPOINT="http://ismi.fi.upm.es:8087"}validar(n){const r={coordinates:n};return console.log(r),this.http.post(`${this.ENDPOINT}/validar`,r)}calcSuperficie(n){return this.http.post(`${this.ENDPOINT}/calcSuperficie`,{coordinates:n})}getOcupados(){return this.http.get(`${this.ENDPOINT}/getOcupados`)}}return t.\u0275fac=function(n){return new(n||t)(Gt(rL))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function lL(t){return Array.isArray(t)?t:[t]}function iu(t){return null==t?"":"string"==typeof t?t:`${t}px`}function aw(t){return t instanceof Oc?t.nativeElement:t}const tq=["addListener","removeListener"],nq=["addEventListener","removeEventListener"],rq=["on","off"];function tT(t,e,n,r){if(de(n)&&(r=n,n=void 0),r)return tT(t,e,n).pipe(eP(r));const[i,s]=function sq(t){return de(t.addEventListener)&&de(t.removeEventListener)}(t)?nq.map(f=>g=>t[f](e,g,n)):function iq(t){return de(t.addListener)&&de(t.removeListener)}(t)?tq.map(uL(t,e)):function oq(t){return de(t.on)&&de(t.off)}(t)?rq.map(uL(t,e)):[];if(!i&&li(t))return ze(f=>tT(f,e,n))(Tn(t));if(!i)throw new TypeError("Invalid event target");return new Bt(f=>{const g=(...v)=>f.next(1<v.length?v:v[0]);return i(g),()=>s(g)})}function uL(t,e){return n=>r=>t[n](e,r)}class aq extends K{constructor(e,n){super()}schedule(e,n=0){return this}}const lw={setInterval(...t){const{delegate:e}=lw;return(e?.setInterval||setInterval)(...t)},clearInterval(t){const{delegate:e}=lw;return(e?.clearInterval||clearInterval)(t)},delegate:void 0};class nT extends aq{constructor(e,n){super(e,n),this.scheduler=e,this.work=n,this.pending=!1}schedule(e,n=0){if(this.closed)return this;this.state=e;const r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(i,this.id,n),this}requestAsyncId(e,n,r=0){return lw.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,n,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return n;lw.clearInterval(n)}execute(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,n);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,n){let i,r=!1;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:n}=this,{actions:r}=n;this.work=this.state=this.scheduler=null,this.pending=!1,p(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,super.unsubscribe()}}}const Ov={schedule(t){let e=requestAnimationFrame,n=cancelAnimationFrame;const{delegate:r}=Ov;r&&(e=r.requestAnimationFrame,n=r.cancelAnimationFrame);const i=e(s=>{n=void 0,t(s)});return new K(()=>n?.(i))},requestAnimationFrame(...t){const{delegate:e}=Ov;return(e?.requestAnimationFrame||requestAnimationFrame)(...t)},cancelAnimationFrame(...t){const{delegate:e}=Ov;return(e?.cancelAnimationFrame||cancelAnimationFrame)(...t)},delegate:void 0},cL={now:()=>(cL.delegate||Date).now(),delegate:void 0};class Lv{constructor(e,n=Lv.now){this.schedulerActionCtor=e,this.now=n}schedule(e,n=0,r){return new this.schedulerActionCtor(this,e).schedule(r,n)}}Lv.now=cL.now;class rT extends Lv{constructor(e,n=Lv.now){super(e,n),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:n}=this;if(this._active)return void n.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=n.shift());if(this._active=!1,r){for(;e=n.shift();)e.unsubscribe();throw r}}}new class uq extends rT{flush(e){this._active=!0,this._scheduled=void 0;const{actions:n}=this;let r,i=-1;e=e||n.shift();const s=n.length;do{if(r=e.execute(e.state,e.delay))break}while(++i<s&&(e=n.shift()));if(this._active=!1,r){for(;++i<s&&(e=n.shift());)e.unsubscribe();throw r}}}(class lq extends nT{constructor(e,n){super(e,n),this.scheduler=e,this.work=n}requestAsyncId(e,n,r=0){return null!==r&&r>0?super.requestAsyncId(e,n,r):(e.actions.push(this),e._scheduled||(e._scheduled=Ov.requestAnimationFrame(()=>e.flush(void 0))))}recycleAsyncId(e,n,r=0){if(null!=r&&r>0||null==r&&this.delay>0)return super.recycleAsyncId(e,n,r);0===e.actions.length&&(Ov.cancelAnimationFrame(n),e._scheduled=void 0)}});let iT,hq=1;const uw={};function hL(t){return t in uw&&(delete uw[t],!0)}const fq={setImmediate(t){const e=hq++;return uw[e]=!0,iT||(iT=Promise.resolve()),iT.then(()=>hL(e)&&t()),e},clearImmediate(t){hL(t)}},{setImmediate:dq,clearImmediate:pq}=fq,cw={setImmediate(...t){const{delegate:e}=cw;return(e?.setImmediate||dq)(...t)},clearImmediate(t){const{delegate:e}=cw;return(e?.clearImmediate||pq)(t)},delegate:void 0},fL=(new class mq extends rT{flush(e){this._active=!0,this._scheduled=void 0;const{actions:n}=this;let r,i=-1;e=e||n.shift();const s=n.length;do{if(r=e.execute(e.state,e.delay))break}while(++i<s&&(e=n.shift()));if(this._active=!1,r){for(;++i<s&&(e=n.shift());)e.unsubscribe();throw r}}}(class gq extends nT{constructor(e,n){super(e,n),this.scheduler=e,this.work=n}requestAsyncId(e,n,r=0){return null!==r&&r>0?super.requestAsyncId(e,n,r):(e.actions.push(this),e._scheduled||(e._scheduled=cw.setImmediate(e.flush.bind(e,void 0))))}recycleAsyncId(e,n,r=0){if(null!=r&&r>0||null==r&&this.delay>0)return super.recycleAsyncId(e,n,r);0===e.actions.length&&(cw.clearImmediate(n),e._scheduled=void 0)}}),new rT(nT));function dL(t,e=fL){return function _q(t){return $t((e,n)=>{let r=!1,i=null,s=null,f=!1;const g=()=>{if(s?.unsubscribe(),s=null,r){r=!1;const x=i;i=null,n.next(x)}f&&n.complete()},v=()=>{s=null,f&&n.complete()};e.subscribe(new pn(n,x=>{r=!0,i=x,s||Tn(t(x)).subscribe(s=new pn(n,g,v))},()=>{f=!0,(!r||!s||s.closed)&&n.complete()}))})}(()=>function xq(t=0,e,n=fL){let r=-1;return null!=e&&(ht(e)?n=e:r=e),new Bt(i=>{let s=function vq(t){return t instanceof Date&&!isNaN(t)}(t)?+t-n.now():t;s<0&&(s=0);let f=0;return n.schedule(function(){i.closed||(i.next(f++),0<=r?this.schedule(void 0,r):i.complete())},s)})}(t,e))}let oT;try{oT=typeof Intl<"u"&&Intl.v8BreakIterator}catch{oT=!1}let Nv,yg,aT,nf,md=(()=>{class t{constructor(n){this._platformId=n,this.isBrowser=this._platformId?function o4(t){return t===MA}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!oT)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return t.\u0275fac=function(n){return new(n||t)(Gt(I1))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),wq=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({}),t})();function sT(t){return function bq(){if(null==Nv&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Nv=!0}))}finally{Nv=Nv||!1}return Nv}()?t:!!t.capture}function Eq(){if(null==yg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return yg=!1,yg;if("scrollBehavior"in document.documentElement.style)yg=!0;else{const t=Element.prototype.scrollTo;yg=!!t&&!/\{\s*\[native code\]\s*\}/.test(t.toString())}}return yg}function lT(){let t=typeof document<"u"&&document?document.activeElement:null;for(;t&&t.shadowRoot;){const e=t.shadowRoot.activeElement;if(e===t)break;t=e}return t}function _g(t){return t.composedPath?t.composedPath()[0]:t.target}function uT(){return typeof nf.__karma__<"u"&&!!nf.__karma__||typeof nf.jasmine<"u"&&!!nf.jasmine||typeof nf.jest<"u"&&!!nf.jest||typeof nf.Mocha<"u"&&!!nf.Mocha}nf=typeof global<"u"?global:typeof window<"u"?window:{};const Tq=new Er("cdk-dir-doc",{providedIn:"root",factory:function Iq(){return _a(Os)}});let cT=(()=>{class t{constructor(n){if(this.value="ltr",this.change=new Iu,n){const i=n.documentElement?n.documentElement.dir:null,s=(n.body?n.body.dir:null)||i;this.value="ltr"===s||"rtl"===s?s:"ltr"}}ngOnDestroy(){this.change.complete()}}return t.\u0275fac=function(n){return new(n||t)(Gt(Tq,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),kv=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({}),t})(),Dq=(()=>{class t{constructor(n,r,i){this._ngZone=n,this._platform=r,this._scrolled=new xt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=i}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const r=this.scrollContainers.get(n);r&&(r.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new Bt(r=>{this._globalSubscription||this._addGlobalListener();const i=n>0?this._scrolled.pipe(dL(n)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):fi()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(n,r){const i=this.getAncestorScrollContainers(n);return this.scrolled(r).pipe(gc(s=>!s||i.indexOf(s)>-1))}getAncestorScrollContainers(n){const r=[];return this.scrollContainers.forEach((i,s)=>{this._scrollableContainsElement(s,n)&&r.push(s)}),r}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,r){let i=aw(r),s=n.getElementRef().nativeElement;do{if(i==s)return!0}while(i=i.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>tT(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return t.\u0275fac=function(n){return new(n||t)(Gt(ua),Gt(md),Gt(Os,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),gL=(()=>{class t{constructor(n,r,i){this._platform=n,this._change=new xt,this._changeListener=s=>{this._change.next(s)},this._document=i,r.runOutsideAngular(()=>{if(n.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:r,height:i}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+i,right:n.left+r,height:i,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,r=this._getWindow(),i=n.documentElement,s=i.getBoundingClientRect();return{top:-s.top||n.body.scrollTop||r.scrollY||i.scrollTop||0,left:-s.left||n.body.scrollLeft||r.scrollX||i.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(dL(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}}return t.\u0275fac=function(n){return new(n||t)(Gt(md),Gt(ua),Gt(Os,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),mL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({}),t})(),yL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({imports:[[kv,wq,mL],kv,mL]}),t})();function Rq(t,e){return function(n,r){e(n,r,t)}}function Oq(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}class fT{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class dT extends fT{constructor(e,n,r,i){super(),this.component=e,this.viewContainerRef=n,this.injector=r,this.componentFactoryResolver=i}}class wL extends fT{constructor(e,n,r){super(),this.templateRef=e,this.viewContainerRef=n,this.context=r}get origin(){return this.templateRef.elementRef}attach(e,n=this.context){return this.context=n,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class kq extends fT{constructor(e){super(),this.element=e instanceof Oc?e.nativeElement:e}}class pT{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof dT?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof wL?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof kq?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Fq extends pT{constructor(e,n,r,i,s){super(),this.outletElement=e,this._componentFactoryResolver=n,this._appRef=r,this._defaultInjector=i,this.attachDomPortal=f=>{const g=f.element,v=this._document.createComment("dom-portal");g.parentNode.insertBefore(v,g),this.outletElement.appendChild(g),this._attachedPortal=f,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(g,v)})},this._document=s}attachComponentPortal(e){const r=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let i;return e.viewContainerRef?(i=e.viewContainerRef.createComponent(r,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>i.destroy())):(i=r.create(e.injector||this._defaultInjector),this._appRef.attachView(i.hostView),this.setDisposeFn(()=>{this._appRef.detachView(i.hostView),i.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(i)),this._attachedPortal=e,i}attachTemplatePortal(e){let n=e.viewContainerRef,r=n.createEmbeddedView(e.templateRef,e.context);return r.rootNodes.forEach(i=>this.outletElement.appendChild(i)),r.detectChanges(),this.setDisposeFn(()=>{let i=n.indexOf(r);-1!==i&&n.remove(i)}),this._attachedPortal=e,r}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let bL=(()=>{class t extends pT{constructor(n,r,i){super(),this._componentFactoryResolver=n,this._viewContainerRef=r,this._isInitialized=!1,this.attached=new Iu,this.attachDomPortal=s=>{const f=s.element,g=this._document.createComment("dom-portal");s.setAttachedHost(this),f.parentNode.insertBefore(g,f),this._getRootNode().appendChild(f),this._attachedPortal=s,super.setDisposeFn(()=>{g.parentNode&&g.parentNode.replaceChild(f,g)})},this._document=i}get portal(){return this._attachedPortal}set portal(n){this.hasAttached()&&!n&&!this._isInitialized||(this.hasAttached()&&super.detach(),n&&super.attach(n),this._attachedPortal=n)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(n){n.setAttachedHost(this);const r=null!=n.viewContainerRef?n.viewContainerRef:this._viewContainerRef,s=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),f=r.createComponent(s,r.length,n.injector||r.injector);return r!==this._viewContainerRef&&this._getRootNode().appendChild(f.hostView.rootNodes[0]),super.setDisposeFn(()=>f.destroy()),this._attachedPortal=n,this._attachedRef=f,this.attached.emit(f),f}attachTemplatePortal(n){n.setAttachedHost(this);const r=this._viewContainerRef.createEmbeddedView(n.templateRef,n.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=n,this._attachedRef=r,this.attached.emit(r),r}_getRootNode(){const n=this._viewContainerRef.element.nativeElement;return n.nodeType===n.ELEMENT_NODE?n:n.parentNode}}return t.\u0275fac=function(n){return new(n||t)(Tr(ph),Tr(yh),Tr(Os))},t.\u0275dir=Fi({type:t,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[la]}),t})(),EL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({}),t})();function CL(t){return $t((e,n)=>{Tn(t).subscribe(new pn(n,()=>n.complete(),He)),!n.closed&&e.subscribe(n)})}const SL=Eq();class Bq{constructor(e,n){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=n}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=iu(-this._previousScrollPosition.left),e.style.top=iu(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,r=e.style,i=this._document.body.style,s=r.scrollBehavior||"",f=i.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),SL&&(r.scrollBehavior=i.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),SL&&(r.scrollBehavior=s,i.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const n=this._document.body,r=this._viewportRuler.getViewportSize();return n.scrollHeight>r.height||n.scrollWidth>r.width}}class zq{constructor(e,n,r,i){this._scrollDispatcher=e,this._ngZone=n,this._viewportRuler=r,this._config=i,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const n=this._viewportRuler.getViewportScrollPosition().top;Math.abs(n-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class TL{enable(){}disable(){}attach(){}}function gT(t,e){return e.some(n=>t.bottom<n.top||t.top>n.bottom||t.right<n.left||t.left>n.right)}function IL(t,e){return e.some(n=>t.top<n.top||t.bottom>n.bottom||t.left<n.left||t.right>n.right)}class Uq{constructor(e,n,r,i){this._scrollDispatcher=e,this._viewportRuler=n,this._ngZone=r,this._config=i,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const n=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:i}=this._viewportRuler.getViewportSize();gT(n,[{width:r,height:i,bottom:i,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Vq=(()=>{class t{constructor(n,r,i,s){this._scrollDispatcher=n,this._viewportRuler=r,this._ngZone=i,this.noop=()=>new TL,this.close=f=>new zq(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new Bq(this._viewportRuler,this._document),this.reposition=f=>new Uq(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=s}}return t.\u0275fac=function(n){return new(n||t)(Gt(Dq),Gt(gL),Gt(ua),Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class ML{constructor(e){if(this.scrollStrategy=new TL,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const n=Object.keys(e);for(const r of n)void 0!==e[r]&&(this[r]=e[r])}}}class jq{constructor(e,n,r,i,s){this.offsetX=r,this.offsetY=i,this.panelClass=s,this.originX=e.originX,this.originY=e.originY,this.overlayX=n.overlayX,this.overlayY=n.overlayY}}class Gq{}let $q=(()=>{let t=class{constructor(n,r){this.connectionPair=n,this.scrollableViewProperties=r}};return t=function Pq(t,e,n,r){var f,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(s=(i<3?f(s):i>3?f(e,n,s):f(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}([Rq(1,ah()),Oq("design:paramtypes",[jq,Gq])],t),t})(),DL=(()=>{class t{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const r=this._attachedOverlays.indexOf(n);r>-1&&this._attachedOverlays.splice(r,1),0===this._attachedOverlays.length&&this.detach()}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),qq=(()=>{class t extends DL{constructor(n){super(n),this._keydownListener=r=>{const i=this._attachedOverlays;for(let s=i.length-1;s>-1;s--)if(i[s]._keydownEvents.observers.length>0){i[s]._keydownEvents.next(r);break}}}add(n){super.add(n),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Hq=(()=>{class t extends DL{constructor(n,r){super(n),this._platform=r,this._cursorStyleIsSet=!1,this._pointerDownListener=i=>{this._pointerDownEventTarget=_g(i)},this._clickListener=i=>{const s=_g(i),f="click"===i.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:s;this._pointerDownEventTarget=null;const g=this._attachedOverlays.slice();for(let v=g.length-1;v>-1;v--){const x=g[v];if(!(x._outsidePointerEvents.observers.length<1)&&x.hasAttached()){if(x.overlayElement.contains(s)||x.overlayElement.contains(f))break;x._outsidePointerEvents.next(i)}}}}add(n){if(super.add(n),!this._isAttached){const r=this._document.body;r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os),Gt(md))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),mT=(()=>{class t{constructor(n,r){this._platform=r,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||uT()){const i=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let s=0;s<i.length;s++)i[s].remove()}const r=this._document.createElement("div");r.classList.add(n),uT()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os),Gt(md))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class Wq{constructor(e,n,r,i,s,f,g,v,x){this._portalOutlet=e,this._host=n,this._pane=r,this._config=i,this._ngZone=s,this._keyboardDispatcher=f,this._document=g,this._location=v,this._outsideClickDispatcher=x,this._backdropElement=null,this._backdropClick=new xt,this._attachments=new xt,this._detachments=new xt,this._locationChanges=K.EMPTY,this._backdropClickHandler=M=>this._backdropClick.next(M),this._keydownEvents=new xt,this._outsidePointerEvents=new xt,i.scrollStrategy&&(this._scrollStrategy=i.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=i.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){let n=this._portalOutlet.attach(e);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Yt(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),n}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config={...this._config,...e},this._updateElementSize()}setDirection(e){this._config={...this._config,direction:e},this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=iu(this._config.width),e.height=iu(this._config.height),e.minWidth=iu(this._config.minWidth),e.minHeight=iu(this._config.minHeight),e.maxWidth=iu(this._config.maxWidth),e.maxHeight=iu(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(!e)return;let n;const r=()=>{e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",r),this._disposeBackdrop(e)),this._config.backdropClass&&this._toggleClasses(e,this._config.backdropClass,!1),clearTimeout(n)};e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",r)}),e.style.pointerEvents="none",n=this._ngZone.runOutsideAngular(()=>setTimeout(r,500))}_toggleClasses(e,n,r){const i=lL(n||[]).filter(s=>!!s);i.length&&(r?e.classList.add(...i):e.classList.remove(...i))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(CL(Xi(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.remove(),this._backdropElement===e&&(this._backdropElement=null))}}const AL="cdk-overlay-connected-position-bounding-box",Xq=/([A-Za-z%]+)$/;class Zq{constructor(e,n,r,i,s){this._viewportRuler=n,this._document=r,this._platform=i,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new xt,this._resizeSubscription=K.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(AL),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const e=this._originRect,n=this._overlayRect,r=this._viewportRect,i=[];let s;for(let f of this._preferredPositions){let g=this._getOriginPoint(e,f),v=this._getOverlayPoint(g,n,f),x=this._getOverlayFit(v,n,r,f);if(x.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(f,g);this._canFitWithFlexibleDimensions(x,v,r)?i.push({position:f,origin:g,overlayRect:n,boundingBoxRect:this._calculateBoundingBoxRect(g,f)}):(!s||s.overlayFit.visibleArea<x.visibleArea)&&(s={overlayFit:x,overlayPoint:v,originPoint:g,position:f,overlayRect:n})}if(i.length){let f=null,g=-1;for(const v of i){const x=v.boundingBoxRect.width*v.boundingBoxRect.height*(v.position.weight||1);x>g&&(g=x,f=v)}return this._isPushed=!1,void this._applyPosition(f.position,f.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(s.position,s.originPoint);this._applyPosition(s.position,s.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&vg(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(AL),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const e=this._lastPosition||this._preferredPositions[0],n=this._getOriginPoint(this._originRect,e);this._applyPosition(e,n)}}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,n){let r,i;if("center"==n.originX)r=e.left+e.width/2;else{const s=this._isRtl()?e.right:e.left,f=this._isRtl()?e.left:e.right;r="start"==n.originX?s:f}return i="center"==n.originY?e.top+e.height/2:"top"==n.originY?e.top:e.bottom,{x:r,y:i}}_getOverlayPoint(e,n,r){let i,s;return i="center"==r.overlayX?-n.width/2:"start"===r.overlayX?this._isRtl()?-n.width:0:this._isRtl()?0:-n.width,s="center"==r.overlayY?-n.height/2:"top"==r.overlayY?0:-n.height,{x:e.x+i,y:e.y+s}}_getOverlayFit(e,n,r,i){const s=RL(n);let{x:f,y:g}=e,v=this._getOffset(i,"x"),x=this._getOffset(i,"y");v&&(f+=v),x&&(g+=x);let L=0-g,B=g+s.height-r.height,ee=this._subtractOverflows(s.width,0-f,f+s.width-r.width),se=this._subtractOverflows(s.height,L,B),Oe=ee*se;return{visibleArea:Oe,isCompletelyWithinViewport:s.width*s.height===Oe,fitsInViewportVertically:se===s.height,fitsInViewportHorizontally:ee==s.width}}_canFitWithFlexibleDimensions(e,n,r){if(this._hasFlexibleDimensions){const i=r.bottom-n.y,s=r.right-n.x,f=PL(this._overlayRef.getConfig().minHeight),g=PL(this._overlayRef.getConfig().minWidth),x=e.fitsInViewportHorizontally||null!=g&&g<=s;return(e.fitsInViewportVertically||null!=f&&f<=i)&&x}return!1}_pushOverlayOnScreen(e,n,r){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const i=RL(n),s=this._viewportRect,f=Math.max(e.x+i.width-s.width,0),g=Math.max(e.y+i.height-s.height,0),v=Math.max(s.top-r.top-e.y,0),x=Math.max(s.left-r.left-e.x,0);let M=0,R=0;return M=i.width<=s.width?x||-f:e.x<this._viewportMargin?s.left-r.left-e.x:0,R=i.height<=s.height?v||-g:e.y<this._viewportMargin?s.top-r.top-e.y:0,this._previousPushAmount={x:M,y:R},{x:e.x+M,y:e.y+R}}_applyPosition(e,n){if(this._setTransformOrigin(e),this._setOverlayElementStyles(n,e),this._setBoundingBoxStyles(n,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const r=this._getScrollVisibility(),i=new $q(e,r);this._positionChanges.next(i)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const n=this._boundingBox.querySelectorAll(this._transformOriginSelector);let r,i=e.overlayY;r="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let s=0;s<n.length;s++)n[s].style.transformOrigin=`${r} ${i}`}_calculateBoundingBoxRect(e,n){const r=this._viewportRect,i=this._isRtl();let s,f,g,M,R,L;if("top"===n.overlayY)f=e.y,s=r.height-f+this._viewportMargin;else if("bottom"===n.overlayY)g=r.height-e.y+2*this._viewportMargin,s=r.height-g+this._viewportMargin;else{const B=Math.min(r.bottom-e.y+r.top,e.y),ee=this._lastBoundingBoxSize.height;s=2*B,f=e.y-B,s>ee&&!this._isInitialRender&&!this._growAfterOpen&&(f=e.y-ee/2)}if("end"===n.overlayX&&!i||"start"===n.overlayX&&i)L=r.width-e.x+this._viewportMargin,M=e.x-this._viewportMargin;else if("start"===n.overlayX&&!i||"end"===n.overlayX&&i)R=e.x,M=r.right-e.x;else{const B=Math.min(r.right-e.x+r.left,e.x),ee=this._lastBoundingBoxSize.width;M=2*B,R=e.x-B,M>ee&&!this._isInitialRender&&!this._growAfterOpen&&(R=e.x-ee/2)}return{top:f,left:R,bottom:g,right:L,width:M,height:s}}_setBoundingBoxStyles(e,n){const r=this._calculateBoundingBoxRect(e,n);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));const i={};if(this._hasExactPosition())i.top=i.left="0",i.bottom=i.right=i.maxHeight=i.maxWidth="",i.width=i.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;i.height=iu(r.height),i.top=iu(r.top),i.bottom=iu(r.bottom),i.width=iu(r.width),i.left=iu(r.left),i.right=iu(r.right),i.alignItems="center"===n.overlayX?"center":"end"===n.overlayX?"flex-end":"flex-start",i.justifyContent="center"===n.overlayY?"center":"bottom"===n.overlayY?"flex-end":"flex-start",s&&(i.maxHeight=iu(s)),f&&(i.maxWidth=iu(f))}this._lastBoundingBoxSize=r,vg(this._boundingBox.style,i)}_resetBoundingBoxStyles(){vg(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){vg(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,n){const r={},i=this._hasExactPosition(),s=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(i){const M=this._viewportRuler.getViewportScrollPosition();vg(r,this._getExactOverlayY(n,e,M)),vg(r,this._getExactOverlayX(n,e,M))}else r.position="static";let g="",v=this._getOffset(n,"x"),x=this._getOffset(n,"y");v&&(g+=`translateX(${v}px) `),x&&(g+=`translateY(${x}px)`),r.transform=g.trim(),f.maxHeight&&(i?r.maxHeight=iu(f.maxHeight):s&&(r.maxHeight="")),f.maxWidth&&(i?r.maxWidth=iu(f.maxWidth):s&&(r.maxWidth="")),vg(this._pane.style,r)}_getExactOverlayY(e,n,r){let i={top:"",bottom:""},s=this._getOverlayPoint(n,this._overlayRect,e);this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,r));let f=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return s.y-=f,"bottom"===e.overlayY?i.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":i.top=iu(s.y),i}_getExactOverlayX(e,n,r){let f,i={left:"",right:""},s=this._getOverlayPoint(n,this._overlayRect,e);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,r)),f=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===f?i.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":i.left=iu(s.x),i}_getScrollVisibility(){const e=this._getOriginRect(),n=this._pane.getBoundingClientRect(),r=this._scrollables.map(i=>i.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:IL(e,r),isOriginOutsideView:gT(e,r),isOverlayClipped:IL(n,r),isOverlayOutsideView:gT(n,r)}}_subtractOverflows(e,...n){return n.reduce((r,i)=>r-Math.max(i,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,n=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+e-this._viewportMargin,bottom:r.top+n-this._viewportMargin,width:e-2*this._viewportMargin,height:n-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,n){return"x"===n?e.offsetX??this._offsetX:e.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&lL(e).forEach(n=>{""!==n&&-1===this._appliedPanelClasses.indexOf(n)&&(this._appliedPanelClasses.push(n),this._pane.classList.add(n))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof Oc)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const n=e.width||0,r=e.height||0;return{top:e.y,bottom:e.y+r,left:e.x,right:e.x+n,height:r,width:n}}}function vg(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function PL(t){if("number"!=typeof t&&null!=t){const[e,n]=t.split(Xq);return n&&"px"!==n?null:parseFloat(e)}return t||null}function RL(t){return{top:Math.floor(t.top),right:Math.floor(t.right),bottom:Math.floor(t.bottom),left:Math.floor(t.left),width:Math.floor(t.width),height:Math.floor(t.height)}}const OL="cdk-global-overlay-wrapper";class Yq{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(e){const n=e.getConfig();this._overlayRef=e,this._width&&!n.width&&e.updateSize({width:this._width}),this._height&&!n.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(OL),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._rightOffset="",this._leftOffset=e,this._justifyContent="flex-start",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._leftOffset="",this._rightOffset=e,this._justifyContent="flex-end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._justifyContent="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:i,height:s,maxWidth:f,maxHeight:g}=r,v=!("100%"!==i&&"100vw"!==i||f&&"100%"!==f&&"100vw"!==f),x=!("100%"!==s&&"100vh"!==s||g&&"100%"!==g&&"100vh"!==g);e.position=this._cssPosition,e.marginLeft=v?"0":this._leftOffset,e.marginTop=x?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=this._rightOffset,v?n.justifyContent="flex-start":"center"===this._justifyContent?n.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?n.justifyContent="flex-end":"flex-end"===this._justifyContent&&(n.justifyContent="flex-start"):n.justifyContent=this._justifyContent,n.alignItems=x?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement,r=n.style;n.classList.remove(OL),r.justifyContent=r.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let Kq=(()=>{class t{constructor(n,r,i,s){this._viewportRuler=n,this._document=r,this._platform=i,this._overlayContainer=s}global(){return new Yq}flexibleConnectedTo(n){return new Zq(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return t.\u0275fac=function(n){return new(n||t)(Gt(gL),Gt(Os),Gt(md),Gt(mT))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Jq=0,dw=(()=>{class t{constructor(n,r,i,s,f,g,v,x,M,R,L){this.scrollStrategies=n,this._overlayContainer=r,this._componentFactoryResolver=i,this._positionBuilder=s,this._keyboardDispatcher=f,this._injector=g,this._ngZone=v,this._document=x,this._directionality=M,this._location=R,this._outsideClickDispatcher=L}create(n){const r=this._createHostElement(),i=this._createPaneElement(r),s=this._createPortalOutlet(i),f=new ML(n);return f.direction=f.direction||this._directionality.value,new Wq(s,r,i,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(n){const r=this._document.createElement("div");return r.id="cdk-overlay-"+Jq++,r.classList.add("cdk-overlay-pane"),n.appendChild(r),r}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(jm)),new Fq(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return t.\u0275fac=function(n){return new(n||t)(Gt(Vq),Gt(mT),Gt(ph),Gt(Kq),Gt(qq),Gt(du),Gt(ua),Gt(Os),Gt(cT),Gt(q_),Gt(Hq))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();const tH={provide:new Er("cdk-connected-overlay-scroll-strategy"),deps:[dw],useFactory:function eH(t){return()=>t.scrollStrategies.reposition()}};let nH=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({providers:[dw,tH],imports:[[kv,EL,yL],yL]}),t})();function fH(t,e){return t===e}let kL=(()=>{class t{constructor(n){this._platform=n}isDisabled(n){return n.hasAttribute("disabled")}isVisible(n){return function mH(t){return!!(t.offsetWidth||t.offsetHeight||"function"==typeof t.getClientRects&&t.getClientRects().length)}(n)&&"visible"===getComputedStyle(n).visibility}isTabbable(n){if(!this._platform.isBrowser)return!1;const r=function gH(t){try{return t.frameElement}catch{return null}}(function CH(t){return t.ownerDocument&&t.ownerDocument.defaultView||window}(n));if(r&&(-1===BL(r)||!this.isVisible(r)))return!1;let i=n.nodeName.toLowerCase(),s=BL(n);return n.hasAttribute("contenteditable")?-1!==s:!("iframe"===i||"object"===i||this._platform.WEBKIT&&this._platform.IOS&&!function bH(t){let e=t.nodeName.toLowerCase(),n="input"===e&&t.type;return"text"===n||"password"===n||"select"===e||"textarea"===e}(n))&&("audio"===i?!!n.hasAttribute("controls")&&-1!==s:"video"===i?-1!==s&&(null!==s||this._platform.FIREFOX||n.hasAttribute("controls")):n.tabIndex>=0)}isFocusable(n,r){return function EH(t){return!function _H(t){return function xH(t){return"input"==t.nodeName.toLowerCase()}(t)&&"hidden"==t.type}(t)&&(function yH(t){let e=t.nodeName.toLowerCase();return"input"===e||"select"===e||"button"===e||"textarea"===e}(t)||function vH(t){return function wH(t){return"a"==t.nodeName.toLowerCase()}(t)&&t.hasAttribute("href")}(t)||t.hasAttribute("contenteditable")||FL(t))}(n)&&!this.isDisabled(n)&&(r?.ignoreVisibility||this.isVisible(n))}}return t.\u0275fac=function(n){return new(n||t)(Gt(md))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function FL(t){if(!t.hasAttribute("tabindex")||void 0===t.tabIndex)return!1;let e=t.getAttribute("tabindex");return!(!e||isNaN(parseInt(e,10)))}function BL(t){if(!FL(t))return null;const e=parseInt(t.getAttribute("tabindex")||"",10);return isNaN(e)?-1:e}class SH{constructor(e,n,r,i,s=!1){this._element=e,this._checker=n,this._ngZone=r,this._document=i,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(e,this._startAnchor),this._toggleAnchorTabIndex(e,this._endAnchor))}destroy(){const e=this._startAnchor,n=this._endAnchor;e&&(e.removeEventListener("focus",this.startAnchorListener),e.remove()),n&&(n.removeEventListener("focus",this.endAnchorListener),n.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(e){return new Promise(n=>{this._executeOnStable(()=>n(this.focusInitialElement(e)))})}focusFirstTabbableElementWhenReady(e){return new Promise(n=>{this._executeOnStable(()=>n(this.focusFirstTabbableElement(e)))})}focusLastTabbableElementWhenReady(e){return new Promise(n=>{this._executeOnStable(()=>n(this.focusLastTabbableElement(e)))})}_getRegionBoundary(e){let n=this._element.querySelectorAll(`[cdk-focus-region-${e}], [cdkFocusRegion${e}], [cdk-focus-${e}]`);for(let r=0;r<n.length;r++)n[r].hasAttribute(`cdk-focus-${e}`)?console.warn(`Found use of deprecated attribute 'cdk-focus-${e}', use 'cdkFocusRegion${e}' instead. The deprecated attribute will be removed in 8.0.0.`,n[r]):n[r].hasAttribute(`cdk-focus-region-${e}`)&&console.warn(`Found use of deprecated attribute 'cdk-focus-region-${e}', use 'cdkFocusRegion${e}' instead. The deprecated attribute will be removed in 8.0.0.`,n[r]);return"start"==e?n.length?n[0]:this._getFirstTabbableElement(this._element):n.length?n[n.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(e){const n=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(n){if(n.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",n),!this._checker.isFocusable(n)){const r=this._getFirstTabbableElement(n);return r?.focus(e),!!r}return n.focus(e),!0}return this.focusFirstTabbableElement(e)}focusFirstTabbableElement(e){const n=this._getRegionBoundary("start");return n&&n.focus(e),!!n}focusLastTabbableElement(e){const n=this._getRegionBoundary("end");return n&&n.focus(e),!!n}hasAttached(){return this._hasAttached}_getFirstTabbableElement(e){if(this._checker.isFocusable(e)&&this._checker.isTabbable(e))return e;const n=e.children;for(let r=0;r<n.length;r++){const i=n[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(n[r]):null;if(i)return i}return null}_getLastTabbableElement(e){if(this._checker.isFocusable(e)&&this._checker.isTabbable(e))return e;const n=e.children;for(let r=n.length-1;r>=0;r--){const i=n[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(n[r]):null;if(i)return i}return null}_createAnchor(){const e=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,e),e.classList.add("cdk-visually-hidden"),e.classList.add("cdk-focus-trap-anchor"),e.setAttribute("aria-hidden","true"),e}_toggleAnchorTabIndex(e,n){e?n.setAttribute("tabindex","0"):n.removeAttribute("tabindex")}toggleAnchors(e){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(e,this._startAnchor),this._toggleAnchorTabIndex(e,this._endAnchor))}_executeOnStable(e){this._ngZone.isStable?e():this._ngZone.onStable.pipe(Yt(1)).subscribe(e)}}let TH=(()=>{class t{constructor(n,r,i){this._checker=n,this._ngZone=r,this._document=i}create(n,r=!1){return new SH(n,this._checker,this._ngZone,this._document,r)}}return t.\u0275fac=function(n){return new(n||t)(Gt(kL),Gt(ua),Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const DH=new Er("cdk-input-modality-detector-options"),AH={ignoreKeys:[18,17,224,91,16]},cy=sT({passive:!0,capture:!0});let PH=(()=>{class t{constructor(n,r,i,s){this._platform=n,this._mostRecentTarget=null,this._modality=new xh(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(g=>g===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=_g(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function IH(t){return 0===t.offsetX&&0===t.offsetY}(f)?"keyboard":"mouse"),this._mostRecentTarget=_g(f))},this._onTouchstart=f=>{!function MH(t){const e=t.touches&&t.touches[0]||t.changedTouches&&t.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}(f)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=_g(f)):this._modality.next("keyboard")},this._options={...AH,...s},this.modalityDetected=this._modality.pipe(function cH(t){return gc((e,n)=>t<=n)}(1)),this.modalityChanged=this.modalityDetected.pipe(function hH(t,e=We){return t=t??fH,$t((n,r)=>{let i,s=!0;n.subscribe(new pn(r,f=>{const g=e(f);(s||!t(i,g))&&(s=!1,i=g,r.next(f))}))})}()),n.isBrowser&&r.runOutsideAngular(()=>{i.addEventListener("keydown",this._onKeydown,cy),i.addEventListener("mousedown",this._onMousedown,cy),i.addEventListener("touchstart",this._onTouchstart,cy)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,cy),document.removeEventListener("mousedown",this._onMousedown,cy),document.removeEventListener("touchstart",this._onTouchstart,cy))}}return t.\u0275fac=function(n){return new(n||t)(Gt(md),Gt(ua),Gt(Os),Gt(DH,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const OH=new Er("cdk-focus-monitor-default-options"),pw=sT({passive:!0,capture:!0});let LH=(()=>{class t{constructor(n,r,i,s,f){this._ngZone=n,this._platform=r,this._inputModalityDetector=i,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new xt,this._rootNodeFocusAndBlurListener=g=>{const v=_g(g),x="focus"===g.type?this._onFocus:this._onBlur;for(let M=v;M;M=M.parentElement)x.call(this,g,M)},this._document=s,this._detectionMode=f?.detectionMode||0}monitor(n,r=!1){const i=aw(n);if(!this._platform.isBrowser||1!==i.nodeType)return fi(null);const s=function Sq(t){if(function Cq(){if(null==aT){const t=typeof document<"u"?document.head:null;aT=!(!t||!t.createShadowRoot&&!t.attachShadow)}return aT}()){const e=t.getRootNode?t.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(i)||this._getDocument(),f=this._elementInfo.get(i);if(f)return r&&(f.checkChildren=!0),f.subject;const g={checkChildren:r,subject:new xt,rootNode:s};return this._elementInfo.set(i,g),this._registerGlobalListeners(g),g.subject}stopMonitoring(n){const r=aw(n),i=this._elementInfo.get(r);i&&(i.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(i))}focusVia(n,r,i){const s=aw(n);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([g,v])=>this._originChanged(g,r,v)):(this._setOrigin(r),"function"==typeof s.focus&&s.focus(i))}ngOnDestroy(){this._elementInfo.forEach((n,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(n){return 1===this._detectionMode||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,r){n.classList.toggle("cdk-focused",!!r),n.classList.toggle("cdk-touch-focused","touch"===r),n.classList.toggle("cdk-keyboard-focused","keyboard"===r),n.classList.toggle("cdk-mouse-focused","mouse"===r),n.classList.toggle("cdk-program-focused","program"===r)}_setOrigin(n,r=!1){this._ngZone.runOutsideAngular(()=>{this._origin=n,this._originFromTouchInteraction="touch"===n&&r,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(n,r){const i=this._elementInfo.get(r),s=_g(n);!i||!i.checkChildren&&r!==s||this._originChanged(r,this._getFocusOrigin(s),i)}_onBlur(n,r){const i=this._elementInfo.get(r);!i||i.checkChildren&&n.relatedTarget instanceof Node&&r.contains(n.relatedTarget)||(this._setClasses(r),this._emitOrigin(i.subject,null))}_emitOrigin(n,r){this._ngZone.run(()=>n.next(r))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;const r=n.rootNode,i=this._rootNodeFocusListenerCount.get(r)||0;i||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,pw),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,pw)}),this._rootNodeFocusListenerCount.set(r,i+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(CL(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(n){const r=n.rootNode;if(this._rootNodeFocusListenerCount.has(r)){const i=this._rootNodeFocusListenerCount.get(r);i>1?this._rootNodeFocusListenerCount.set(r,i-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,pw),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,pw),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,r,i){this._setClasses(n,r),this._emitOrigin(i.subject,r),this._lastFocusOrigin=r}_getClosestElementsInfo(n){const r=[];return this._elementInfo.forEach((i,s)=>{(s===n||i.checkChildren&&s.contains(n))&&r.push([s,i])}),r}}return t.\u0275fac=function(n){return new(n||t)(Gt(ua),Gt(md),Gt(PH),Gt(Os,8),Gt(OH,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const UL="cdk-high-contrast-black-on-white",VL="cdk-high-contrast-white-on-black",yT="cdk-high-contrast-active";let NH=(()=>{class t{constructor(n,r){this._platform=n,this._document=r}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const r=this._document.defaultView||window,i=r&&r.getComputedStyle?r.getComputedStyle(n):null,s=(i&&i.backgroundColor||"").replace(/ /g,"");switch(n.remove(),s){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(yT),n.remove(UL),n.remove(VL),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?(n.add(yT),n.add(UL)):2===r&&(n.add(yT),n.add(VL))}}}return t.\u0275fac=function(n){return new(n||t)(Gt(md),Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const jL=new Io("13.0.0"),GL=new Io("13.0.0"),FH=new Er("mat-sanity-checks",{providedIn:"root",factory:function kH(){return!0}});let $L=(()=>{class t{constructor(n,r,i){this._hasDoneGlobalChecks=!1,this._document=i,n._applyBodyHighContrastModeCssClasses(),this._sanityChecks=r,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!(!function d3(){return KD=!0,YD}()||uT())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const n=this._document.createElement("div");n.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(n);const r=getComputedStyle(n);r&&"none"!==r.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),n.remove()}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&GL.full!==jL.full&&console.warn("The Angular Material version ("+GL.full+") does not match the Angular CDK version ("+jL.full+").\nPlease ensure the versions of these two packages exactly match.")}}return t.\u0275fac=function(n){return new(n||t)(Gt(NH),Gt(FH,8),Gt(Os))},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({imports:[[kv],kv]}),t})();class XL{}const yd="*";function $H(t,e){return{type:7,name:t,definitions:e,options:{}}}function ZL(t,e=null){return{type:4,styles:e,timings:t}}function YL(t,e=null){return{type:2,steps:t,options:e}}function hy(t){return{type:6,styles:t,offset:null}}function KL(t,e,n){return{type:0,name:t,styles:e,options:n}}function JL(t,e,n=null){return{type:1,expr:t,animation:e,options:n}}function QL(t){Promise.resolve().then(t)}class Bv{constructor(e=0,n=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){QL(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const n="start"==e?this._onStartFns:this._onDoneFns;n.forEach(r=>r()),n.length=0}}class eN{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let n=0,r=0,i=0;const s=this.players.length;0==s?QL(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++n==s&&this._onFinish()}),f.onDestroy(()=>{++r==s&&this._onDestroy()}),f.onStart(()=>{++i==s&&this._onStart()})}),this.totalTime=this.players.reduce((f,g)=>Math.max(f,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const n=e*this.totalTime;this.players.forEach(r=>{const i=r.totalTime?Math.min(1,n/r.totalTime):1;r.setPosition(i)})}getPosition(){const e=this.players.reduce((n,r)=>null===n||r.totalTime>n.totalTime?r:n,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const n="start"==e?this._onStartFns:this._onDoneFns;n.forEach(r=>r()),n.length=0}}function qH(t,e){}class xT{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0}}const HH={dialogContainer:$H("dialogContainer",[KL("void, exit",hy({opacity:0,transform:"scale(0.7)"})),KL("enter",hy({transform:"none"})),JL("* => enter",ZL("150ms cubic-bezier(0, 0, 0.2, 1)",hy({transform:"none",opacity:1}))),JL("* => void, * => exit",ZL("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",hy({opacity:0})))])};let WH=(()=>{class t extends pT{constructor(n,r,i,s,f,g,v,x){super(),this._elementRef=n,this._focusTrapFactory=r,this._changeDetectorRef=i,this._config=f,this._interactivityChecker=g,this._ngZone=v,this._focusMonitor=x,this._animationStateChanged=new Iu,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(M)),this._ariaLabelledBy=f.ariaLabelledBy||null,this._document=s}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement()}attachComponentPortal(n){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(n)}attachTemplatePortal(n){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(n)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(n,r){this._interactivityChecker.isFocusable(n)||(n.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{n.addEventListener("blur",()=>n.removeAttribute("tabindex")),n.addEventListener("mousedown",()=>n.removeAttribute("tabindex"))})),n.focus(r)}_focusByCssSelector(n,r){let i=this._elementRef.nativeElement.querySelector(n);i&&this._forceFocus(i,r)}_trapFocus(){const n=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||n.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(r=>{r||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const n=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&n&&"function"==typeof n.focus){const r=lT(),i=this._elementRef.nativeElement;(!r||r===this._document.body||r===i||i.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(n,this._closeInteractionType),this._closeInteractionType=null):n.focus())}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=lT())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const n=this._elementRef.nativeElement,r=lT();return n===r||n.contains(r)}}return t.\u0275fac=function(n){return new(n||t)(Tr(Oc),Tr(TH),Tr(A1),Tr(Os,8),Tr(xT),Tr(kL),Tr(ua),Tr(LH))},t.\u0275dir=Fi({type:t,viewQuery:function(n,r){if(1&n&&fE(bL,7),2&n){let i;U_(i=V_())&&(r._portalOutlet=i.first)}},features:[la]}),t})(),XH=(()=>{class t extends WH{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:n,totalTime:r}){"enter"===n?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})):"exit"===n&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:r}))}_onAnimationStart({toState:n,totalTime:r}){"enter"===n?this._animationStateChanged.next({state:"opening",totalTime:r}):("exit"===n||"void"===n)&&this._animationStateChanged.next({state:"closing",totalTime:r})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return t.\u0275fac=function(){let e;return function(r){return(e||(e=function Vs(t){return ms(()=>{const e=t.prototype.constructor,n=e[Ur]||xs(e),r=Object.prototype;let i=Object.getPrototypeOf(t.prototype).constructor;for(;i&&i!==r;){const s=i[Ur]||xs(i);if(s&&s!==n)return s;i=Object.getPrototypeOf(i)}return s=>new s})}(t)))(r||t)}}(),t.\u0275cmp=ja({type:t,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(n,r){1&n&&qb("@dialogContainer.start",function(s){return r._onAnimationStart(s)})("@dialogContainer.done",function(s){return r._onAnimationDone(s)}),2&n&&(Xb("id",r._id),ip("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledBy)("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),Zb("@dialogContainer",r._state))},features:[la],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(n,r){1&n&&function wI(t,e,n,r,i,s,f,g){const v=Dn(),x=si(),M=t+22,R=x.firstCreatePass?function $N(t,e,n,r,i,s,f,g,v){const x=e.consts,M=Zh(e,t,4,f||null,Ea(x,g));o(e,n,M,Ea(x,v)),c(e,M);const R=M.tViews=Rm(2,M,r,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,x);return null!==e.queries&&(e.queries.template(e,M),R.queries=e.queries.embeddedTView(M)),M}(M,x,v,e,n,r,i,s,f):x.data[M];l(R,!1);const L=v[11].createComment("");qg(x,v,L,R),ul(L,v),Ln(v,v[M]=Ye(L,v,L,R)),So(R)&&eg(x,v,R),null!=f&&cc(v,R,g)}(0,qH,0,0,"ng-template",0)},dependencies:[bL],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[HH.dialogContainer]}}),t})(),ZH=0;class YH{constructor(e,n,r="mat-dialog-"+ZH++){this._overlayRef=e,this._containerInstance=n,this.id=r,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new xt,this._afterClosed=new xt,this._beforeClosed=new xt,this._state=0,n._id=r,n._animationStateChanged.pipe(gc(i=>"opened"===i.state),Yt(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe(gc(i=>"closed"===i.state),Yt(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),e.keydownEvents().pipe(gc(i=>27===i.keyCode&&!this.disableClose&&!function uH(t,...e){return e.length?e.some(n=>t[n]):t.altKey||t.shiftKey||t.ctrlKey||t.metaKey}(i))).subscribe(i=>{i.preventDefault(),tN(this,"keyboard")}),e.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():tN(this,"mouse")})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe(gc(n=>"closing"===n.state),Yt(1)).subscribe(n=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),n.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(e){let n=this._getPositionStrategy();return e&&(e.left||e.right)?e.left?n.left(e.left):n.right(e.right):n.centerHorizontally(),e&&(e.top||e.bottom)?e.top?n.top(e.top):n.bottom(e.bottom):n.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(e="",n=""){return this._overlayRef.updateSize({width:e,height:n}),this._overlayRef.updatePosition(),this}addPanelClass(e){return this._overlayRef.addPanelClass(e),this}removePanelClass(e){return this._overlayRef.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function tN(t,e,n){return void 0!==t._containerInstance&&(t._containerInstance._closeInteractionType=e),t.close(n)}const KH=new Er("MatDialogData"),JH=new Er("mat-dialog-default-options"),nN=new Er("mat-dialog-scroll-strategy"),e9={provide:nN,deps:[dw],useFactory:function QH(t){return()=>t.scrollStrategies.block()}};let t9=(()=>{class t{constructor(n,r,i,s,f,g,v,x,M,R){this._overlay=n,this._injector=r,this._defaultOptions=i,this._parentDialog=s,this._overlayContainer=f,this._dialogRefConstructor=v,this._dialogContainerType=x,this._dialogDataToken=M,this._animationMode=R,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new xt,this._afterOpenedAtThisLevel=new xt,this._ariaHiddenElements=new Map,this._dialogAnimatingOpen=!1,this.afterAllClosed=rC(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(iP(void 0))),this._scrollStrategy=g}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(n,r){if(r=function n9(t,e){return{...e,...t}}(r,this._defaultOptions||new xT),r.id&&this.getDialogById(r.id),this._dialogAnimatingOpen)return this._lastDialogRef;const i=this._createOverlay(r),s=this._attachDialogContainer(i,r);if("NoopAnimations"!==this._animationMode){const g=s._animationStateChanged.subscribe(v=>{"opening"===v.state&&(this._dialogAnimatingOpen=!0),"opened"===v.state&&(this._dialogAnimatingOpen=!1,g.unsubscribe())});this._animationStateSubscriptions||(this._animationStateSubscriptions=new K),this._animationStateSubscriptions.add(g)}const f=this._attachDialogContent(n,s,i,r);return this._lastDialogRef=f,this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(f),f.afterClosed().subscribe(()=>this._removeOpenDialog(f)),this.afterOpened.next(f),s._initializeWithAttachedContent(),f}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(n){return this.openDialogs.find(r=>r.id===n)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._animationStateSubscriptions&&this._animationStateSubscriptions.unsubscribe()}_createOverlay(n){const r=this._getOverlayConfig(n);return this._overlay.create(r)}_getOverlayConfig(n){const r=new ML({positionStrategy:this._overlay.position().global(),scrollStrategy:n.scrollStrategy||this._scrollStrategy(),panelClass:n.panelClass,hasBackdrop:n.hasBackdrop,direction:n.direction,minWidth:n.minWidth,minHeight:n.minHeight,maxWidth:n.maxWidth,maxHeight:n.maxHeight,disposeOnNavigation:n.closeOnNavigation});return n.backdropClass&&(r.backdropClass=n.backdropClass),r}_attachDialogContainer(n,r){const s=du.create({parent:r&&r.viewContainerRef&&r.viewContainerRef.injector||this._injector,providers:[{provide:xT,useValue:r}]}),f=new dT(this._dialogContainerType,r.viewContainerRef,s,r.componentFactoryResolver);return n.attach(f).instance}_attachDialogContent(n,r,i,s){const f=new this._dialogRefConstructor(i,r,s.id);if(n instanceof If)r.attachTemplatePortal(new wL(n,null,{$implicit:s.data,dialogRef:f}));else{const g=this._createInjector(s,f,r),v=r.attachComponentPortal(new dT(n,s.viewContainerRef,g));f.componentInstance=v.instance}return f.updateSize(s.width,s.height).updatePosition(s.position),f}_createInjector(n,r,i){const s=n&&n.viewContainerRef&&n.viewContainerRef.injector,f=[{provide:this._dialogContainerType,useValue:i},{provide:this._dialogDataToken,useValue:n.data},{provide:this._dialogRefConstructor,useValue:r}];return n.direction&&(!s||!s.get(cT,null,fr.Optional))&&f.push({provide:cT,useValue:{value:n.direction,change:fi()}}),du.create({parent:s||this._injector,providers:f})}_removeOpenDialog(n){const r=this.openDialogs.indexOf(n);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((i,s)=>{i?s.setAttribute("aria-hidden",i):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const n=this._overlayContainer.getContainerElement();if(n.parentElement){const r=n.parentElement.children;for(let i=r.length-1;i>-1;i--){let s=r[i];s!==n&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_closeDialogs(n){let r=n.length;for(;r--;)n[r].close()}}return t.\u0275fac=function(n){Em()},t.\u0275dir=Fi({type:t}),t})(),rN=(()=>{class t extends t9{constructor(n,r,i,s,f,g,v,x){super(n,r,s,g,v,f,YH,XH,KH,x)}}return t.\u0275fac=function(n){return new(n||t)(Gt(dw),Gt(du),Gt(q_,8),Gt(JH,8),Gt(nN),Gt(t,12),Gt(mT),Gt(vE,8))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),r9=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({providers:[rN,e9],imports:[[nH,EL,$L],$L]}),t})(),iN=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const i9=["mapContainer"];let o9=(()=>{class t{constructor(n,r,i){this.apiService=n,this.dialog=r,this.sharedDataService=i,this.roundedArea=0}ngOnInit(){var n=this;this.map=new kC.Map({accessToken:"pk.eyJ1IjoibWVuY2lhIiwiYSI6ImNsZjEweXVsNjAzeXIzcXM5azFqMjk0ZjMifQ.hc_d2rsywhp29WXrLAz9Aw",container:this.mapContainer.nativeElement,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-3.7,40.4165],zoom:8,maxBounds:[[-5.001472937182655,39.66718156208276],[-2.8859631358626814,41.943656520135676]]});const r=new(WV())({accessToken:"pk.eyJ1IjoibWVuY2lhIiwiYSI6ImNsZjEweXVsNjAzeXIzcXM5azFqMjk0ZjMifQ.hc_d2rsywhp29WXrLAz9Aw",language:"es-ES",mapboxgl:kC,placeholder:"Buscar",marker:!0,zoom:14});this.map.addControl(r,"top-left"),this.map.addControl(new kC.NavigationControl,"top-left");const i=new(ZV())({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"draw_polygon"});this.map.addControl(i,"top-left");const s=L=>{const B=i.getAll();if(B.features.length>0){const ee=function e6(t){return function rj(t,e,n){var r=n;return xR(t,function(i,s,f,g,v){r=0===s&&void 0===n?i:e(r,i,s,f,g,v)}),r}(t,function(e,n){return e+function t6(t){var n,e=0;switch(t.type){case"Polygon":return BR(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)e+=BR(t.coordinates[n]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(n)},0)}(B);this.roundedArea=Math.round(ee)}if("draw.create"==L.type){const ee=document.querySelector(".btn-validate");ee&&ee.classList.remove("collapsed")}if("draw.delete"==L.type){const ee=document.querySelector(".btn-validate");ee&&ee.classList.add("collapsed")}};this.map.on("draw.create",s),this.map.on("draw.delete",s),this.map.on("draw.update",s);const g=function(){var L=gR(function*(){const B=i.getAll();let ee=B.features.find(Oe=>"Polygon"===Oe.geometry.type);if(ee){if(ee){const Oe=function f(L){return L.features[0].geometry.coordinates}(B);var se=[];for(let ve=0;ve<Oe.length;ve++)se.push(JSON.stringify(Oe[ve]));const Ee=yield new Promise(ve=>{n.apiService.validar(se).subscribe(it=>{ve(it)})});n.sharedDataService.area=Ee.area,n.sharedDataService.presupuesto=Ee.presupuesto,n.sharedDataService.coords=Ee.coordinates,n.dialog.open(s9).afterClosed().subscribe(ve=>{console.log(`Dialog result: ${ve}`)})}}else alert("No se ha dibujado un pol\xedgono")});return function(){return L.apply(this,arguments)}}(),v=document.querySelector(".btn-validate");function R(L,B,ee){ee.addSource(`${B}`,function M(L){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[L],type:"Polygon"},id:0}]}}}(function x(L){return JSON.parse(L)}(L))),ee.addLayer({id:`${B}`,type:"fill",source:`${B}`,layout:{},paint:{"fill-color":"#ef0101","fill-opacity":.5}}),ee.addLayer({id:"outline",type:"line",source:`${B}`,layout:{},paint:{"line-color":"#000","line-width":.5}})}v&&v.addEventListener("click",()=>{g()}),this.map.on("load",gR(function*(){var L;L=yield new Promise(B=>{n.apiService.getOcupados().subscribe(ee=>{B(ee.coordinates)})});for(let B=0;B<L.length;B++)R(L[B],B,n.map)}))}ngOnDestroy(){this.map.remove()}}return t.\u0275fac=function(n){return new(n||t)(Tr(Q$),Tr(rN),Tr(iN))},t.\u0275cmp=ja({type:t,selectors:[["app-map"]],viewQuery:function(n,r){if(1&n&&fE(i9,7),2&n){let i;U_(i=V_())&&(r.mapContainer=i.first)}},decls:23,vars:0,consts:[["rel","preconnect","href","https://fonts.gstatic.com"],["href","https://fonts.googleapis.com/css?family=Gentium+Basic&display=swap","rel","stylesheet"],["href","https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap","rel","stylesheet"],["href","https://fonts.googleapis.com/icon?family=Material+Icons","rel","stylesheet"],[1,"map-container"],["mapContainer",""],["id","right",1,"sidebar","flex-center","right"],[1,"sidebar-content","rounded-rect","flex-center"],[1,"sidebar-content-inner"],[1,"sidebar-body"],[1,"sidebar-section"],["mat-button","","type","submit",1,"button","btn-volver"],["mat-button","","type","submit",1,"button","btn-validate","collapsed"],[1,"calculation-box"],["id","area total"]],template:function(n,r){1&n&&(zu(0,"head"),sp(1,"link",0)(2,"link",1)(3,"link",2)(4,"link",3),Yu(),zu(5,"body")(6,"div",4,5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"button",11),Kc(14,"Volver"),Yu(),zu(15,"button",12),Kc(16,"Validar"),Yu()()()()()()(),zu(17,"div",13)(18,"p"),Kc(19," Pinche en el mapa para comenzar a dibujar"),Yu(),zu(20,"p"),Kc(21," Haga doble click o presione enter para terminar la figura"),Yu(),sp(22,"div",14),Yu()())},styles:['@charset "UTF-8";body[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Open Sans,sans-serif;font-size:14px;color:#333;background-color:#fff;line-height:1.5;text-align:left;text-decoration:none;text-shadow:none}.map-container[_ngcontent-%COMP%]{cursor:pointer;width:100%;height:100vh}.calculation-box[_ngcontent-%COMP%]{width:150px;position:absolute;bottom:40px;left:10px;background-color:#ffffffe6;border-radius:5px;padding:15px;text-align:center;box-shadow:0 0 40px #00000045}.calculation-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Gentium Basic,serif;margin:0;font-size:15px}.rounded-rect[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 0 50px -25px #000}.flex-center[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:column;justify-content:center;align-items:center}.flex-center.left[_ngcontent-%COMP%]{left:0}.flex-center.right[_ngcontent-%COMP%]{right:10px}.sidebar-content[_ngcontent-%COMP%]{position:absolute;width:95%;font-family:Arial,Helvetica,sans-serif;font-size:32px;bottom:25px;color:gray}.sidebar-content-inner[_ngcontent-%COMP%]{width:100%}.sidebar-toggle[_ngcontent-%COMP%]{position:absolute;width:1.3em;height:1.3em;overflow:visible;display:flex;justify-content:center;align-items:center}.sidebar-toggle.left[_ngcontent-%COMP%]{right:-1.5em}.sidebar-toggle.right[_ngcontent-%COMP%]{left:-1.5em}.sidebar-toggle[_ngcontent-%COMP%]:hover{color:#0aa1cf;cursor:pointer}.sidebar[_ngcontent-%COMP%]{transition:transform 1s;z-index:1;width:300px;bottom:0}.sidebar-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:20px}.btn-validate.collapsed[_ngcontent-%COMP%]{transform:translateY(295px)}.btn-send[_ngcontent-%COMP%]{width:100%;display:block;background-color:#48bb78;color:#fff;font-size:16px;font-weight:700;text-align:center;text-decoration:none;padding:20px;border-radius:5px;border:none;cursor:pointer;transition:background-color .3s}.btn-send[_ngcontent-%COMP%]:hover{background-color:#38a169}.buttonBox[_ngcontent-%COMP%]{position:fixed;display:flex;flex-direction:column;justify-content:center}.button[_ngcontent-%COMP%]{font-family:Gentium Basic,serif;border:2px solid #ffffff;background:#FDA521;border-radius:10px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.btn-validate[_ngcontent-%COMP%]{right:10px;position:fixed;bottom:30px;display:block;text-align:center;text-decoration:none;padding:15px 40px;border-radius:5px;cursor:pointer;transition:background-color .3s;transition:transform .8s;font-size:22pt}.btn-validate[_ngcontent-%COMP%]:hover{background-color:#df911d}.btn-volver[_ngcontent-%COMP%]{background-color:#204fa1;position:fixed;color:#fff;font-size:15pt;top:10px;right:10px;display:block;text-align:center;text-decoration:none;padding:15px 40px;border-radius:5px;cursor:pointer;transition:background-color .3s;transition:transform .8s}.btn-volver[_ngcontent-%COMP%]:hover{background-color:#194287}']}),t})(),s9=(()=>{class t{constructor(n){this.sharedDataService=n}}return t.\u0275fac=function(n){return new(n||t)(Tr(iN))},t.\u0275cmp=ja({type:t,selectors:[["map-dialog"]],decls:26,vars:2,consts:[["rel","preconnect","href","https://fonts.gstatic.com"],["href","https://fonts.googleapis.com/css?family=Gentium+Basic&display=swap","rel","stylesheet"],["href","https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap","rel","stylesheet"],["href","https://fonts.googleapis.com/icon?family=Material+Icons","rel","stylesheet"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close","",1,"btn"]],template:function(n,r){1&n&&(zu(0,"head"),sp(1,"link",0)(2,"link",1)(3,"link",2)(4,"link",3),Yu(),zu(5,"body")(6,"h2",4),Kc(7,"\xa1Enhorabuena!"),Yu(),zu(8,"div",5)(9,"h3"),Kc(10,"El \xe1rea seleccionada es v\xe1lida"),Yu(),zu(11,"p"),Kc(12,"El \xe1rea que ha sido seleccionada es aparentemente v\xe1lida. En caso de que se tramite con \xe9xito se podr\xeda optar a la siguiente ayuda:"),Yu(),zu(13,"ul")(14,"li"),Kc(15,"Subvenci\xf3n m\xe1xima aspirable: "),zu(16,"b"),Kc(17),Yu()(),zu(18,"li"),Kc(19,"Superficie seleccionada: "),zu(20,"b"),Kc(21),Yu()()()(),sp(22,"br"),zu(23,"div",6)(24,"button",7),Kc(25,"Enviar"),Yu()()()),2&n&&(gm(17),R_("",r.sharedDataService.presupuesto," \u20ac"),gm(4),R_("",r.sharedDataService.area," m\xb2"))},styles:[".btn[_ngcontent-%COMP%]{display:block;width:100%;font-size:16px;font-weight:700;text-align:center;text-decoration:none;padding:20px;border-radius:5px;border:none;cursor:pointer;transition:background-color .3s;transition:transform ease-out .2s;background-color:#7d7;font-family:Gentium Basic,serif;font-size:15pt}.btn[_ngcontent-%COMP%]:hover{background-color:#6ecd6e;transform:scale(1.01)}"]}),t})(),a9=(()=>{class t{constructor(){this.title="calculator"}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ja({type:t,selectors:[["app-root"]],decls:2,vars:0,template:function(n,r){1&n&&sp(0,"router-outlet")(1,"app-map")},dependencies:[wC,o9],styles:["body[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Open Sans,sans-serif;font-size:13px;color:#333;background:#f5f5f5}"]}),t})();function oN(t){return new On(3e3,!1)}function j9(){return typeof window<"u"&&typeof window.document<"u"}function wT(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function yp(t){switch(t.length){case 0:return new Bv;case 1:return t[0];default:return new eN(t)}}function sN(t,e,n,r,i=new Map,s=new Map){const f=[],g=[];let v=-1,x=null;if(r.forEach(M=>{const R=M.get("offset"),L=R==v,B=L&&x||new Map;M.forEach((ee,se)=>{let Oe=se,Ee=ee;if("offset"!==se)switch(Oe=e.normalizePropertyName(Oe,f),Ee){case"!":Ee=i.get(se);break;case yd:Ee=s.get(se);break;default:Ee=e.normalizeStyleValue(se,Oe,Ee,f)}B.set(Oe,Ee)}),L||g.push(B),x=B,v=R}),f.length)throw function A9(t){return new On(3502,!1)}();return g}function bT(t,e,n,r){switch(e){case"start":t.onStart(()=>r(n&&ET(n,"start",t)));break;case"done":t.onDone(()=>r(n&&ET(n,"done",t)));break;case"destroy":t.onDestroy(()=>r(n&&ET(n,"destroy",t)))}}function ET(t,e,n){const s=CT(t.element,t.triggerName,t.fromState,t.toState,e||t.phaseName,n.totalTime??t.totalTime,!!n.disabled),f=t._data;return null!=f&&(s._data=f),s}function CT(t,e,n,r,i="",s=0,f){return{element:t,triggerName:e,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!f}}function th(t,e,n){let r=t.get(e);return r||t.set(e,r=n),r}function aN(t){const e=t.indexOf(":");return[t.substring(1,e),t.slice(e+1)]}let ST=(t,e)=>!1,lN=(t,e,n)=>[],uN=null;function TT(t){const e=t.parentNode||t.host;return e===uN?null:e}(wT()||typeof Element<"u")&&(j9()?(uN=(()=>document.documentElement)(),ST=(t,e)=>{for(;e;){if(e===t)return!0;e=TT(e)}return!1}):ST=(t,e)=>t.contains(e),lN=(t,e,n)=>{if(n)return Array.from(t.querySelectorAll(e));const r=t.querySelector(e);return r?[r]:[]});let xg=null,cN=!1;const hN=ST,fN=lN;let dN=(()=>{class t{validateStyleProperty(n){return function $9(t){xg||(xg=function q9(){return typeof document<"u"?document.body:null}()||{},cN=!!xg.style&&"WebkitAppearance"in xg.style);let e=!0;return xg.style&&!function G9(t){return"ebkit"==t.substring(1,6)}(t)&&(e=t in xg.style,!e&&cN&&(e="Webkit"+t.charAt(0).toUpperCase()+t.slice(1)in xg.style)),e}(n)}matchesElement(n,r){return!1}containsElement(n,r){return hN(n,r)}getParentElement(n){return TT(n)}query(n,r,i){return fN(n,r,i)}computeStyle(n,r,i){return i||""}animate(n,r,i,s,f,g=[],v){return new Bv(i,s)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})(),IT=(()=>{class t{}return t.NOOP=new dN,t})();const MT="ng-enter",gw="ng-leave",mw="ng-trigger",yw=".ng-trigger",gN="ng-animating",DT=".ng-animating";function _d(t){if("number"==typeof t)return t;const e=t.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:AT(parseFloat(e[1]),e[2])}function AT(t,e){return"s"===e?1e3*t:t}function _w(t,e,n){return t.hasOwnProperty("duration")?t:function X9(t,e,n){let i,s=0,f="";if("string"==typeof t){const g=t.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===g)return e.push(oN()),{duration:0,delay:0,easing:""};i=AT(parseFloat(g[1]),g[2]);const v=g[3];null!=v&&(s=AT(parseFloat(v),g[4]));const x=g[5];x&&(f=x)}else i=t;if(!n){let g=!1,v=e.length;i<0&&(e.push(function l9(){return new On(3100,!1)}()),g=!0),s<0&&(e.push(function u9(){return new On(3101,!1)}()),g=!0),g&&e.splice(v,0,oN())}return{duration:i,delay:s,easing:f}}(t,e,n)}function zv(t,e={}){return Object.keys(t).forEach(n=>{e[n]=t[n]}),e}function mN(t){const e=new Map;return Object.keys(t).forEach(n=>{e.set(n,t[n])}),e}function _p(t,e=new Map,n){if(n)for(let[r,i]of n)e.set(r,i);for(let[r,i]of t)e.set(r,i);return e}function _N(t,e,n){return n?e+":"+n+";":""}function vN(t){let e="";for(let n=0;n<t.style.length;n++){const r=t.style.item(n);e+=_N(0,r,t.style.getPropertyValue(r))}for(const n in t.style)t.style.hasOwnProperty(n)&&!n.startsWith("_")&&(e+=_N(0,J9(n),t.style[n]));t.setAttribute("style",e)}function Nf(t,e,n){t.style&&(e.forEach((r,i)=>{const s=RT(i);n&&!n.has(i)&&n.set(i,t.style[s]),t.style[s]=r}),wT()&&vN(t))}function wg(t,e){t.style&&(e.forEach((n,r)=>{const i=RT(r);t.style[i]=""}),wT()&&vN(t))}function Uv(t){return Array.isArray(t)?1==t.length?t[0]:YL(t):t}const PT=new RegExp("{{\\s*(.+?)\\s*}}","g");function xN(t){let e=[];if("string"==typeof t){let n;for(;n=PT.exec(t);)e.push(n[1]);PT.lastIndex=0}return e}function Vv(t,e,n){const r=t.toString(),i=r.replace(PT,(s,f)=>{let g=e[f];return null==g&&(n.push(function h9(t){return new On(3003,!1)}()),g=""),g.toString()});return i==r?t:i}function vw(t){const e=[];let n=t.next();for(;!n.done;)e.push(n.value),n=t.next();return e}const K9=/-+([a-z0-9])/g;function RT(t){return t.replace(K9,(...e)=>e[1].toUpperCase())}function J9(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function nh(t,e,n){switch(e.type){case 7:return t.visitTrigger(e,n);case 0:return t.visitState(e,n);case 1:return t.visitTransition(e,n);case 2:return t.visitSequence(e,n);case 3:return t.visitGroup(e,n);case 4:return t.visitAnimate(e,n);case 5:return t.visitKeyframes(e,n);case 6:return t.visitStyle(e,n);case 8:return t.visitReference(e,n);case 9:return t.visitAnimateChild(e,n);case 10:return t.visitAnimateRef(e,n);case 11:return t.visitQuery(e,n);case 12:return t.visitStagger(e,n);default:throw function f9(t){return new On(3004,!1)}()}}function wN(t,e){return window.getComputedStyle(t)[e]}function i7(t,e){const n=[];return"string"==typeof t?t.split(/\s*,\s*/).forEach(r=>function o7(t,e,n){if(":"==t[0]){const v=function s7(t,e){switch(t){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(n,r)=>parseFloat(r)>parseFloat(n);case":decrement":return(n,r)=>parseFloat(r)<parseFloat(n);default:return e.push(function T9(t){return new On(3016,!1)}()),"* => *"}}(t,n);if("function"==typeof v)return void e.push(v);t=v}const r=t.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(function S9(t){return new On(3015,!1)}()),e;const i=r[1],s=r[2],f=r[3];e.push(bN(i,f));"<"==s[0]&&!("*"==i&&"*"==f)&&e.push(bN(f,i))}(r,n,e)):n.push(t),n}const Ew=new Set(["true","1"]),Cw=new Set(["false","0"]);function bN(t,e){const n=Ew.has(t)||Cw.has(t),r=Ew.has(e)||Cw.has(e);return(i,s)=>{let f="*"==t||t==i,g="*"==e||e==s;return!f&&n&&"boolean"==typeof i&&(f=i?Ew.has(t):Cw.has(t)),!g&&r&&"boolean"==typeof s&&(g=s?Ew.has(e):Cw.has(e)),f&&g}}const a7=new RegExp("s*:selfs*,?","g");function OT(t,e,n,r){return new l7(t).build(e,n,r)}class l7{constructor(e){this._driver=e}build(e,n,r){const i=new h7(n);return this._resetContextStyleTimingState(i),nh(this,Uv(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,n){let r=n.queryCount=0,i=n.depCount=0;const s=[],f=[];return"@"==e.name.charAt(0)&&n.errors.push(function p9(){return new On(3006,!1)}()),e.definitions.forEach(g=>{if(this._resetContextStyleTimingState(n),0==g.type){const v=g,x=v.name;x.toString().split(/\s*,\s*/).forEach(M=>{v.name=M,s.push(this.visitState(v,n))}),v.name=x}else if(1==g.type){const v=this.visitTransition(g,n);r+=v.queryCount,i+=v.depCount,f.push(v)}else n.errors.push(function g9(){return new On(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:f,queryCount:r,depCount:i,options:null}}visitState(e,n){const r=this.visitStyle(e.styles,n),i=e.options&&e.options.params||null;if(r.containsDynamicStyles){const s=new Set,f=i||{};r.styles.forEach(g=>{g instanceof Map&&g.forEach(v=>{xN(v).forEach(x=>{f.hasOwnProperty(x)||s.add(x)})})}),s.size&&(vw(s.values()),n.errors.push(function m9(t,e){return new On(3008,!1)}()))}return{type:0,name:e.name,style:r,options:i?{params:i}:null}}visitTransition(e,n){n.queryCount=0,n.depCount=0;const r=nh(this,Uv(e.animation),n);return{type:1,matchers:i7(e.expr,n.errors),animation:r,queryCount:n.queryCount,depCount:n.depCount,options:bg(e.options)}}visitSequence(e,n){return{type:2,steps:e.steps.map(r=>nh(this,r,n)),options:bg(e.options)}}visitGroup(e,n){const r=n.currentTime;let i=0;const s=e.steps.map(f=>{n.currentTime=r;const g=nh(this,f,n);return i=Math.max(i,n.currentTime),g});return n.currentTime=i,{type:3,steps:s,options:bg(e.options)}}visitAnimate(e,n){const r=function d7(t,e){if(t.hasOwnProperty("duration"))return t;if("number"==typeof t)return LT(_w(t,e).duration,0,"");const n=t;if(n.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=LT(0,0,"");return s.dynamic=!0,s.strValue=n,s}const i=_w(n,e);return LT(i.duration,i.delay,i.easing)}(e.timings,n.errors);n.currentAnimateTimings=r;let i,s=e.styles?e.styles:hy({});if(5==s.type)i=this.visitKeyframes(s,n);else{let f=e.styles,g=!1;if(!f){g=!0;const x={};r.easing&&(x.easing=r.easing),f=hy(x)}n.currentTime+=r.duration+r.delay;const v=this.visitStyle(f,n);v.isEmptyStep=g,i=v}return n.currentAnimateTimings=null,{type:4,timings:r,style:i,options:null}}visitStyle(e,n){const r=this._makeStyleAst(e,n);return this._validateStyleAst(r,n),r}_makeStyleAst(e,n){const r=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let g of i)"string"==typeof g?g===yd?r.push(g):n.errors.push(new On(3002,!1)):r.push(mN(g));let s=!1,f=null;return r.forEach(g=>{if(g instanceof Map&&(g.has("easing")&&(f=g.get("easing"),g.delete("easing")),!s))for(let v of g.values())if(v.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:r,easing:f,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,n){const r=n.currentAnimateTimings;let i=n.currentTime,s=n.currentTime;r&&s>0&&(s-=r.duration+r.delay),e.styles.forEach(f=>{"string"!=typeof f&&f.forEach((g,v)=>{const x=n.collectedStyles.get(n.currentQuerySelector),M=x.get(v);let R=!0;M&&(s!=i&&s>=M.startTime&&i<=M.endTime&&(n.errors.push(function _9(t,e,n,r,i){return new On(3010,!1)}()),R=!1),s=M.startTime),R&&x.set(v,{startTime:s,endTime:i}),n.options&&function Y9(t,e,n){const r=e.params||{},i=xN(t);i.length&&i.forEach(s=>{r.hasOwnProperty(s)||n.push(function c9(t){return new On(3001,!1)}())})}(g,n.options,n.errors)})})}visitKeyframes(e,n){const r={type:5,styles:[],options:null};if(!n.currentAnimateTimings)return n.errors.push(function v9(){return new On(3011,!1)}()),r;let s=0;const f=[];let g=!1,v=!1,x=0;const M=e.steps.map(Ee=>{const _e=this._makeStyleAst(Ee,n);let ve=null!=_e.offset?_e.offset:function f7(t){if("string"==typeof t)return null;let e=null;if(Array.isArray(t))t.forEach(n=>{if(n instanceof Map&&n.has("offset")){const r=n;e=parseFloat(r.get("offset")),r.delete("offset")}});else if(t instanceof Map&&t.has("offset")){const n=t;e=parseFloat(n.get("offset")),n.delete("offset")}return e}(_e.styles),it=0;return null!=ve&&(s++,it=_e.offset=ve),v=v||it<0||it>1,g=g||it<x,x=it,f.push(it),_e});v&&n.errors.push(function x9(){return new On(3012,!1)}()),g&&n.errors.push(function w9(){return new On(3200,!1)}());const R=e.steps.length;let L=0;s>0&&s<R?n.errors.push(function b9(){return new On(3202,!1)}()):0==s&&(L=1/(R-1));const B=R-1,ee=n.currentTime,se=n.currentAnimateTimings,Oe=se.duration;return M.forEach((Ee,_e)=>{const ve=L>0?_e==B?1:L*_e:f[_e],it=ve*Oe;n.currentTime=ee+se.delay+it,se.duration=it,this._validateStyleAst(Ee,n),Ee.offset=ve,r.styles.push(Ee)}),r}visitReference(e,n){return{type:8,animation:nh(this,Uv(e.animation),n),options:bg(e.options)}}visitAnimateChild(e,n){return n.depCount++,{type:9,options:bg(e.options)}}visitAnimateRef(e,n){return{type:10,animation:this.visitReference(e.animation,n),options:bg(e.options)}}visitQuery(e,n){const r=n.currentQuerySelector,i=e.options||{};n.queryCount++,n.currentQuery=e;const[s,f]=function u7(t){const e=!!t.split(/\s*,\s*/).find(n=>":self"==n);return e&&(t=t.replace(a7,"")),t=t.replace(/@\*/g,yw).replace(/@\w+/g,n=>yw+"-"+n.slice(1)).replace(/:animating/g,DT),[t,e]}(e.selector);n.currentQuerySelector=r.length?r+" "+s:s,th(n.collectedStyles,n.currentQuerySelector,new Map);const g=nh(this,Uv(e.animation),n);return n.currentQuery=null,n.currentQuerySelector=r,{type:11,selector:s,limit:i.limit||0,optional:!!i.optional,includeSelf:f,animation:g,originalSelector:e.selector,options:bg(e.options)}}visitStagger(e,n){n.currentQuery||n.errors.push(function E9(){return new On(3013,!1)}());const r="full"===e.timings?{duration:0,delay:0,easing:"full"}:_w(e.timings,n.errors,!0);return{type:12,animation:nh(this,Uv(e.animation),n),timings:r,options:null}}}class h7{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function bg(t){return t?(t=zv(t)).params&&(t.params=function c7(t){return t?zv(t):null}(t.params)):t={},t}function LT(t,e,n){return{duration:t,delay:e,easing:n}}function NT(t,e,n,r,i,s,f=null,g=!1){return{type:1,element:t,keyframes:e,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:f,subTimeline:g}}class Sw{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,n){let r=this._map.get(e);r||this._map.set(e,r=[]),r.push(...n)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const m7=new RegExp(":enter","g"),_7=new RegExp(":leave","g");function kT(t,e,n,r,i,s=new Map,f=new Map,g,v,x=[]){return(new v7).buildKeyframes(t,e,n,r,i,s,f,g,v,x)}class v7{buildKeyframes(e,n,r,i,s,f,g,v,x,M=[]){x=x||new Sw;const R=new FT(e,n,x,i,s,M,[]);R.options=v;const L=v.delay?_d(v.delay):0;R.currentTimeline.delayNextStep(L),R.currentTimeline.setStyles([f],null,R.errors,v),nh(this,r,R);const B=R.timelines.filter(ee=>ee.containsAnimation());if(B.length&&g.size){let ee;for(let se=B.length-1;se>=0;se--){const Oe=B[se];if(Oe.element===n){ee=Oe;break}}ee&&!ee.allowOnlyTimelineStyles()&&ee.setStyles([g],null,R.errors,v)}return B.length?B.map(ee=>ee.buildKeyframes()):[NT(n,[],[],[],0,L,"",!1)]}visitTrigger(e,n){}visitState(e,n){}visitTransition(e,n){}visitAnimateChild(e,n){const r=n.subInstructions.get(n.element);if(r){const i=n.createSubContext(e.options),s=n.currentTimeline.currentTime,f=this._visitSubInstructions(r,i,i.options);s!=f&&n.transformIntoNewTimeline(f)}n.previousNode=e}visitAnimateRef(e,n){const r=n.createSubContext(e.options);r.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],n,r),this.visitReference(e.animation,r),n.transformIntoNewTimeline(r.currentTimeline.currentTime),n.previousNode=e}_applyAnimationRefDelays(e,n,r){for(const i of e){const s=i?.delay;if(s){const f="number"==typeof s?s:_d(Vv(s,i?.params??{},n.errors));r.delayNextStep(f)}}}_visitSubInstructions(e,n,r){let s=n.currentTimeline.currentTime;const f=null!=r.duration?_d(r.duration):null,g=null!=r.delay?_d(r.delay):null;return 0!==f&&e.forEach(v=>{const x=n.appendInstructionToTimeline(v,f,g);s=Math.max(s,x.duration+x.delay)}),s}visitReference(e,n){n.updateOptions(e.options,!0),nh(this,e.animation,n),n.previousNode=e}visitSequence(e,n){const r=n.subContextCount;let i=n;const s=e.options;if(s&&(s.params||s.delay)&&(i=n.createSubContext(s),i.transformIntoNewTimeline(),null!=s.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=Tw);const f=_d(s.delay);i.delayNextStep(f)}e.steps.length&&(e.steps.forEach(f=>nh(this,f,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),n.previousNode=e}visitGroup(e,n){const r=[];let i=n.currentTimeline.currentTime;const s=e.options&&e.options.delay?_d(e.options.delay):0;e.steps.forEach(f=>{const g=n.createSubContext(e.options);s&&g.delayNextStep(s),nh(this,f,g),i=Math.max(i,g.currentTimeline.currentTime),r.push(g.currentTimeline)}),r.forEach(f=>n.currentTimeline.mergeTimelineCollectedStyles(f)),n.transformIntoNewTimeline(i),n.previousNode=e}_visitTiming(e,n){if(e.dynamic){const r=e.strValue;return _w(n.params?Vv(r,n.params,n.errors):r,n.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,n){const r=n.currentAnimateTimings=this._visitTiming(e.timings,n),i=n.currentTimeline;r.delay&&(n.incrementTime(r.delay),i.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,n):(n.incrementTime(r.duration),this.visitStyle(s,n),i.applyStylesToKeyframe()),n.currentAnimateTimings=null,n.previousNode=e}visitStyle(e,n){const r=n.currentTimeline,i=n.currentAnimateTimings;!i&&r.hasCurrentStyleProperties()&&r.forwardFrame();const s=i&&i.easing||e.easing;e.isEmptyStep?r.applyEmptyStep(s):r.setStyles(e.styles,s,n.errors,n.options),n.previousNode=e}visitKeyframes(e,n){const r=n.currentAnimateTimings,i=n.currentTimeline.duration,s=r.duration,g=n.createSubContext().currentTimeline;g.easing=r.easing,e.styles.forEach(v=>{g.forwardTime((v.offset||0)*s),g.setStyles(v.styles,v.easing,n.errors,n.options),g.applyStylesToKeyframe()}),n.currentTimeline.mergeTimelineCollectedStyles(g),n.transformIntoNewTimeline(i+s),n.previousNode=e}visitQuery(e,n){const r=n.currentTimeline.currentTime,i=e.options||{},s=i.delay?_d(i.delay):0;s&&(6===n.previousNode.type||0==r&&n.currentTimeline.hasCurrentStyleProperties())&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=Tw);let f=r;const g=n.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,n.errors);n.currentQueryTotal=g.length;let v=null;g.forEach((x,M)=>{n.currentQueryIndex=M;const R=n.createSubContext(e.options,x);s&&R.delayNextStep(s),x===n.element&&(v=R.currentTimeline),nh(this,e.animation,R),R.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,R.currentTimeline.currentTime)}),n.currentQueryIndex=0,n.currentQueryTotal=0,n.transformIntoNewTimeline(f),v&&(n.currentTimeline.mergeTimelineCollectedStyles(v),n.currentTimeline.snapshotCurrentStyles()),n.previousNode=e}visitStagger(e,n){const r=n.parentContext,i=n.currentTimeline,s=e.timings,f=Math.abs(s.duration),g=f*(n.currentQueryTotal-1);let v=f*n.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":v=g-v;break;case"full":v=r.currentStaggerTime}const M=n.currentTimeline;v&&M.delayNextStep(v);const R=M.currentTime;nh(this,e.animation,n),n.previousNode=e,r.currentStaggerTime=i.currentTime-R+(i.startTime-r.currentTimeline.startTime)}}const Tw={};class FT{constructor(e,n,r,i,s,f,g,v){this._driver=e,this.element=n,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=s,this.errors=f,this.timelines=g,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Tw,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new Iw(this._driver,n,0),g.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,n){if(!e)return;const r=e;let i=this.options;null!=r.duration&&(i.duration=_d(r.duration)),null!=r.delay&&(i.delay=_d(r.delay));const s=r.params;if(s){let f=i.params;f||(f=this.options.params={}),Object.keys(s).forEach(g=>{(!n||!f.hasOwnProperty(g))&&(f[g]=Vv(s[g],f,this.errors))})}}_copyOptions(){const e={};if(this.options){const n=this.options.params;if(n){const r=e.params={};Object.keys(n).forEach(i=>{r[i]=n[i]})}}return e}createSubContext(e=null,n,r){const i=n||this.element,s=new FT(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=Tw,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,n,r){const i={duration:n??e.duration,delay:this.currentTimeline.currentTime+(r??0)+e.delay,easing:""},s=new x7(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(s),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,n,r,i,s,f){let g=[];if(i&&g.push(this.element),e.length>0){e=(e=e.replace(m7,"."+this._enterClassName)).replace(_7,"."+this._leaveClassName);let x=this._driver.query(this.element,e,1!=r);0!==r&&(x=r<0?x.slice(x.length+r,x.length):x.slice(0,r)),g.push(...x)}return!s&&0==g.length&&f.push(function C9(t){return new On(3014,!1)}()),g}}class Iw{constructor(e,n,r,i){this._driver=e,this.element=n,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const n=1===this._keyframes.size&&this._pendingStyles.size;this.duration||n?(this.forwardTime(this.currentTime+e),n&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,n){return this.applyStylesToKeyframe(),new Iw(this._driver,e,n||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,n){this._localTimelineStyles.set(e,n),this._globalTimelineStyles.set(e,n),this._styleSummary.set(e,{time:this.currentTime,value:n})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[n,r]of this._globalTimelineStyles)this._backFill.set(n,r||yd),this._currentKeyframe.set(n,yd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,n,r,i){n&&this._previousKeyframe.set("easing",n);const s=i&&i.params||{},f=function w7(t,e){const n=new Map;let r;return t.forEach(i=>{if("*"===i){r=r||e.keys();for(let s of r)n.set(s,yd)}else _p(i,n)}),n}(e,this._globalTimelineStyles);for(let[g,v]of f){const x=Vv(v,s,r);this._pendingStyles.set(g,x),this._localTimelineStyles.has(g)||this._backFill.set(g,this._globalTimelineStyles.get(g)??yd),this._updateStyle(g,x)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,n)=>{this._currentKeyframe.set(n,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,n)=>{this._currentKeyframe.has(n)||this._currentKeyframe.set(n,e)}))}snapshotCurrentStyles(){for(let[e,n]of this._localTimelineStyles)this._pendingStyles.set(e,n),this._updateStyle(e,n)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let n in this._currentKeyframe)e.push(n);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((n,r)=>{const i=this._styleSummary.get(r);(!i||n.time>i.time)&&this._updateStyle(r,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,n=new Set,r=1===this._keyframes.size&&0===this.duration;let i=[];this._keyframes.forEach((g,v)=>{const x=_p(g,new Map,this._backFill);x.forEach((M,R)=>{"!"===M?e.add(R):M===yd&&n.add(R)}),r||x.set("offset",v/this.duration),i.push(x)});const s=e.size?vw(e.values()):[],f=n.size?vw(n.values()):[];if(r){const g=i[0],v=new Map(g);g.set("offset",0),v.set("offset",1),i=[g,v]}return NT(this.element,i,s,f,this.duration,this.startTime,this.easing,!1)}}class x7 extends Iw{constructor(e,n,r,i,s,f,g=!1){super(e,n,f.delay),this.keyframes=r,this.preStyleProps=i,this.postStyleProps=s,this._stretchStartingKeyframe=g,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:n,duration:r,easing:i}=this.timings;if(this._stretchStartingKeyframe&&n){const s=[],f=r+n,g=n/f,v=_p(e[0]);v.set("offset",0),s.push(v);const x=_p(e[0]);x.set("offset",SN(g)),s.push(x);const M=e.length-1;for(let R=1;R<=M;R++){let L=_p(e[R]);const B=L.get("offset");L.set("offset",SN((n+B*r)/f)),s.push(L)}r=f,n=0,i="",e=s}return NT(this.element,e,this.preStyleProps,this.postStyleProps,r,n,i,!0)}}function SN(t,e=3){const n=Math.pow(10,e-1);return Math.round(t*n)/n}class BT{}const b7=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class E7 extends BT{normalizePropertyName(e,n){return RT(e)}normalizeStyleValue(e,n,r,i){let s="";const f=r.toString().trim();if(b7.has(n)&&0!==r&&"0"!==r)if("number"==typeof r)s="px";else{const g=r.match(/^[+-]?[\d\.]+([a-z]*)$/);g&&0==g[1].length&&i.push(function d9(t,e){return new On(3005,!1)}())}return f+s}}function TN(t,e,n,r,i,s,f,g,v,x,M,R,L){return{type:0,element:t,triggerName:e,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:f,timelines:g,queriedElements:v,preStyleProps:x,postStyleProps:M,totalTime:R,errors:L}}const zT={};class IN{constructor(e,n,r){this._triggerName=e,this.ast=n,this._stateStyles=r}match(e,n,r,i){return function C7(t,e,n,r,i){return t.some(s=>s(e,n,r,i))}(this.ast.matchers,e,n,r,i)}buildStyles(e,n,r){let i=this._stateStyles.get("*");return void 0!==e&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(n,r):new Map}build(e,n,r,i,s,f,g,v,x,M){const R=[],L=this.ast.options&&this.ast.options.params||zT,ee=this.buildStyles(r,g&&g.params||zT,R),se=v&&v.params||zT,Oe=this.buildStyles(i,se,R),Ee=new Set,_e=new Map,ve=new Map,it="void"===i,mt={params:S7(se,L),delay:this.ast.options?.delay},Ot=M?[]:kT(e,n,this.ast.animation,s,f,ee,Oe,mt,x,R);let kt=0;if(Ot.forEach(ut=>{kt=Math.max(ut.duration+ut.delay,kt)}),R.length)return TN(n,this._triggerName,r,i,it,ee,Oe,[],[],_e,ve,kt,R);Ot.forEach(ut=>{const Nr=ut.element,dr=th(_e,Nr,new Set);ut.preStyleProps.forEach(ai=>dr.add(ai));const ni=th(ve,Nr,new Set);ut.postStyleProps.forEach(ai=>ni.add(ai)),Nr!==n&&Ee.add(Nr)});const tn=vw(Ee.values());return TN(n,this._triggerName,r,i,it,ee,Oe,Ot,tn,_e,ve,kt)}}function S7(t,e){const n=zv(e);for(const r in t)t.hasOwnProperty(r)&&null!=t[r]&&(n[r]=t[r]);return n}class T7{constructor(e,n,r){this.styles=e,this.defaultParams=n,this.normalizer=r}buildStyles(e,n){const r=new Map,i=zv(this.defaultParams);return Object.keys(e).forEach(s=>{const f=e[s];null!==f&&(i[s]=f)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((f,g)=>{f&&(f=Vv(f,i,n));const v=this.normalizer.normalizePropertyName(g,n);f=this.normalizer.normalizeStyleValue(g,v,f,n),r.set(v,f)})}),r}}class M7{constructor(e,n,r){this.name=e,this.ast=n,this._normalizer=r,this.transitionFactories=[],this.states=new Map,n.states.forEach(i=>{this.states.set(i.name,new T7(i.style,i.options&&i.options.params||{},r))}),MN(this.states,"true","1"),MN(this.states,"false","0"),n.transitions.forEach(i=>{this.transitionFactories.push(new IN(e,i,this.states))}),this.fallbackTransition=function D7(t,e,n){return new IN(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,g)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,n,r,i){return this.transitionFactories.find(f=>f.match(e,n,r,i))||null}matchStyles(e,n,r){return this.fallbackTransition.buildStyles(e,n,r)}}function MN(t,e,n){t.has(e)?t.has(n)||t.set(n,t.get(e)):t.has(n)&&t.set(e,t.get(n))}const A7=new Sw;class P7{constructor(e,n,r){this.bodyNode=e,this._driver=n,this._normalizer=r,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,n){const r=[],s=OT(this._driver,n,r,[]);if(r.length)throw function P9(t){return new On(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,n,r){const i=e.element,s=sN(0,this._normalizer,0,e.keyframes,n,r);return this._driver.animate(i,s,e.duration,e.delay,e.easing,[],!0)}create(e,n,r={}){const i=[],s=this._animations.get(e);let f;const g=new Map;if(s?(f=kT(this._driver,n,s,MT,gw,new Map,new Map,r,A7,i),f.forEach(M=>{const R=th(g,M.element,new Map);M.postStyleProps.forEach(L=>R.set(L,null))})):(i.push(function R9(){return new On(3300,!1)}()),f=[]),i.length)throw function O9(t){return new On(3504,!1)}();g.forEach((M,R)=>{M.forEach((L,B)=>{M.set(B,this._driver.computeStyle(R,B,yd))})});const x=yp(f.map(M=>{const R=g.get(M.element);return this._buildPlayer(M,new Map,R)}));return this._playersById.set(e,x),x.onDestroy(()=>this.destroy(e)),this.players.push(x),x}destroy(e){const n=this._getPlayer(e);n.destroy(),this._playersById.delete(e);const r=this.players.indexOf(n);r>=0&&this.players.splice(r,1)}_getPlayer(e){const n=this._playersById.get(e);if(!n)throw function L9(t){return new On(3301,!1)}();return n}listen(e,n,r,i){const s=CT(n,"","","");return bT(this._getPlayer(e),r,s,i),()=>{}}command(e,n,r,i){if("register"==r)return void this.register(e,i[0]);if("create"==r)return void this.create(e,n,i[0]||{});const s=this._getPlayer(e);switch(r){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e)}}}const DN="ng-animate-queued",UT="ng-animate-disabled",k7=[],AN={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},F7={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ch="__ng_removed";class VT{constructor(e,n=""){this.namespaceId=n;const r=e&&e.hasOwnProperty("value");if(this.value=function V7(t){return t??null}(r?e.value:e),r){const s=zv(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const n=e.params;if(n){const r=this.options.params;Object.keys(n).forEach(i=>{null==r[i]&&(r[i]=n[i])})}}}const jv="void",jT=new VT(jv);class B7{constructor(e,n,r){this.id=e,this.hostElement=n,this._engine=r,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Sh(n,this._hostClassName)}listen(e,n,r,i){if(!this._triggers.has(n))throw function N9(t,e){return new On(3302,!1)}();if(null==r||0==r.length)throw function k9(t){return new On(3303,!1)}();if(!function j7(t){return"start"==t||"done"==t}(r))throw function F9(t,e){return new On(3400,!1)}();const s=th(this._elementListeners,e,[]),f={name:n,phase:r,callback:i};s.push(f);const g=th(this._engine.statesByElement,e,new Map);return g.has(n)||(Sh(e,mw),Sh(e,mw+"-"+n),g.set(n,jT)),()=>{this._engine.afterFlush(()=>{const v=s.indexOf(f);v>=0&&s.splice(v,1),this._triggers.has(n)||g.delete(n)})}}register(e,n){return!this._triggers.has(e)&&(this._triggers.set(e,n),!0)}_getTrigger(e){const n=this._triggers.get(e);if(!n)throw function B9(t){return new On(3401,!1)}();return n}trigger(e,n,r,i=!0){const s=this._getTrigger(n),f=new GT(this.id,n,e);let g=this._engine.statesByElement.get(e);g||(Sh(e,mw),Sh(e,mw+"-"+n),this._engine.statesByElement.set(e,g=new Map));let v=g.get(n);const x=new VT(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&v&&x.absorbOptions(v.options),g.set(n,x),v||(v=jT),x.value!==jv&&v.value===x.value){if(!function q7(t,e){const n=Object.keys(t),r=Object.keys(e);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const s=n[i];if(!e.hasOwnProperty(s)||t[s]!==e[s])return!1}return!0}(v.params,x.params)){const se=[],Oe=s.matchStyles(v.value,v.params,se),Ee=s.matchStyles(x.value,x.params,se);se.length?this._engine.reportError(se):this._engine.afterFlush(()=>{wg(e,Oe),Nf(e,Ee)})}return}const L=th(this._engine.playersByElement,e,[]);L.forEach(se=>{se.namespaceId==this.id&&se.triggerName==n&&se.queued&&se.destroy()});let B=s.matchTransition(v.value,x.value,e,x.params),ee=!1;if(!B){if(!i)return;B=s.fallbackTransition,ee=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:n,transition:B,fromState:v,toState:x,player:f,isFallbackTransition:ee}),ee||(Sh(e,DN),f.onStart(()=>{fy(e,DN)})),f.onDone(()=>{let se=this.players.indexOf(f);se>=0&&this.players.splice(se,1);const Oe=this._engine.playersByElement.get(e);if(Oe){let Ee=Oe.indexOf(f);Ee>=0&&Oe.splice(Ee,1)}}),this.players.push(f),L.push(f),f}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(n=>n.delete(e)),this._elementListeners.forEach((n,r)=>{this._elementListeners.set(r,n.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const n=this._engine.playersByElement.get(e);n&&(n.forEach(r=>r.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,n){const r=this._engine.driver.query(e,yw,!0);r.forEach(i=>{if(i[Ch])return;const s=this._engine.fetchNamespacesByElement(i);s.size?s.forEach(f=>f.triggerLeaveAnimation(i,n,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,n,r,i){const s=this._engine.statesByElement.get(e),f=new Map;if(s){const g=[];if(s.forEach((v,x)=>{if(f.set(x,v.value),this._triggers.has(x)){const M=this.trigger(e,x,jv,i);M&&g.push(M)}}),g.length)return this._engine.markElementAsRemoved(this.id,e,!0,n,f),r&&yp(g).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const n=this._elementListeners.get(e),r=this._engine.statesByElement.get(e);if(n&&r){const i=new Set;n.forEach(s=>{const f=s.name;if(i.has(f))return;i.add(f);const v=this._triggers.get(f).fallbackTransition,x=r.get(f)||jT,M=new VT(jv),R=new GT(this.id,f,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:f,transition:v,fromState:x,toState:M,player:R,isFallbackTransition:!0})})}}removeNode(e,n){const r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,n),this.triggerLeaveAnimation(e,n,!0))return;let i=!1;if(r.totalAnimations){const s=r.players.length?r.playersByQueriedElement.get(e):[];if(s&&s.length)i=!0;else{let f=e;for(;f=f.parentNode;)if(r.statesByElement.get(f)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)r.markElementAsRemoved(this.id,e,!1,n);else{const s=e[Ch];(!s||s===AN)&&(r.afterFlush(()=>this.clearElementCache(e)),r.destroyInnerAnimations(e),r._onRemovalComplete(e,n))}}insertNode(e,n){Sh(e,this._hostClassName)}drainQueuedTransitions(e){const n=[];return this._queue.forEach(r=>{const i=r.player;if(i.destroyed)return;const s=r.element,f=this._elementListeners.get(s);f&&f.forEach(g=>{if(g.name==r.triggerName){const v=CT(s,r.triggerName,r.fromState.value,r.toState.value);v._data=e,bT(r.player,g.phase,v,g.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):n.push(r)}),this._queue=[],n.sort((r,i)=>{const s=r.transition.ast.depCount,f=i.transition.ast.depCount;return 0==s||0==f?s-f:this._engine.driver.containsElement(r.element,i.element)?1:-1})}destroy(e){this.players.forEach(n=>n.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let n=!1;return this._elementListeners.has(e)&&(n=!0),n=!!this._queue.find(r=>r.element===e)||n,n}}class z7{constructor(e,n,r){this.bodyNode=e,this.driver=n,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,s)=>{}}_onRemovalComplete(e,n){this.onRemovalComplete(e,n)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(n=>{n.players.forEach(r=>{r.queued&&e.push(r)})}),e}createNamespace(e,n){const r=new B7(e,n,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,n)?this._balanceNamespaceList(r,n):(this.newHostElements.set(n,r),this.collectEnterElement(n)),this._namespaceLookup[e]=r}_balanceNamespaceList(e,n){const r=this._namespaceList,i=this.namespacesByHostElement;if(r.length-1>=0){let f=!1,g=this.driver.getParentElement(n);for(;g;){const v=i.get(g);if(v){const x=r.indexOf(v);r.splice(x+1,0,e),f=!0;break}g=this.driver.getParentElement(g)}f||r.unshift(e)}else r.push(e);return i.set(n,e),e}register(e,n){let r=this._namespaceLookup[e];return r||(r=this.createNamespace(e,n)),r}registerTrigger(e,n,r){let i=this._namespaceLookup[e];i&&i.register(n,r)&&this.totalAnimations++}destroy(e,n){if(!e)return;const r=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(r.hostElement),delete this._namespaceLookup[e];const i=this._namespaceList.indexOf(r);i>=0&&this._namespaceList.splice(i,1)}),this.afterFlushAnimationsDone(()=>r.destroy(n))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const n=new Set,r=this.statesByElement.get(e);if(r)for(let i of r.values())if(i.namespaceId){const s=this._fetchNamespace(i.namespaceId);s&&n.add(s)}return n}trigger(e,n,r,i){if(Mw(n)){const s=this._fetchNamespace(e);if(s)return s.trigger(n,r,i),!0}return!1}insertNode(e,n,r,i){if(!Mw(n))return;const s=n[Ch];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const f=this.collectedLeaveElements.indexOf(n);f>=0&&this.collectedLeaveElements.splice(f,1)}if(e){const f=this._fetchNamespace(e);f&&f.insertNode(n,r)}i&&this.collectEnterElement(n)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,n){n?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Sh(e,UT)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),fy(e,UT))}removeNode(e,n,r,i){if(Mw(n)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(n,i):this.markElementAsRemoved(e,n,!1,i),r){const f=this.namespacesByHostElement.get(n);f&&f.id!==e&&f.removeNode(n,i)}}else this._onRemovalComplete(n,i)}markElementAsRemoved(e,n,r,i,s){this.collectedLeaveElements.push(n),n[Ch]={namespaceId:e,setForRemoval:i,hasAnimation:r,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,n,r,i,s){return Mw(n)?this._fetchNamespace(e).listen(n,r,i,s):()=>{}}_buildInstruction(e,n,r,i,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,r,i,e.fromState.options,e.toState.options,n,s)}destroyInnerAnimations(e){let n=this.driver.query(e,yw,!0);n.forEach(r=>this.destroyActiveAnimationsForElement(r)),0!=this.playersByQueriedElement.size&&(n=this.driver.query(e,DT,!0),n.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(e){const n=this.playersByElement.get(e);n&&n.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(e){const n=this.playersByQueriedElement.get(e);n&&n.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return yp(this.players).onDone(()=>e());e()})}processLeaveNode(e){const n=e[Ch];if(n&&n.setForRemoval){if(e[Ch]=AN,n.namespaceId){this.destroyInnerAnimations(e);const r=this._fetchNamespace(n.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,n.setForRemoval)}e.classList?.contains(UT)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(e=-1){let n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,i)=>this._balanceNamespaceList(r,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++)Sh(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const r=[];try{n=this._flushAnimations(r,e)}finally{for(let i=0;i<r.length;i++)r[i]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++)this.processLeaveNode(this.collectedLeaveElements[r]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){const r=this._whenQuietFns;this._whenQuietFns=[],n.length?yp(n).onDone(()=>{r.forEach(i=>i())}):r.forEach(i=>i())}}reportError(e){throw function z9(t){return new On(3402,!1)}()}_flushAnimations(e,n){const r=new Sw,i=[],s=new Map,f=[],g=new Map,v=new Map,x=new Map,M=new Set;this.disabledNodes.forEach(_n=>{M.add(_n);const ar=this.driver.query(_n,".ng-animate-queued",!0);for(let cr=0;cr<ar.length;cr++)M.add(ar[cr])});const R=this.bodyNode,L=Array.from(this.statesByElement.keys()),B=ON(L,this.collectedEnterElements),ee=new Map;let se=0;B.forEach((_n,ar)=>{const cr=MT+se++;ee.set(ar,cr),_n.forEach(Cr=>Sh(Cr,cr))});const Oe=[],Ee=new Set,_e=new Set;for(let _n=0;_n<this.collectedLeaveElements.length;_n++){const ar=this.collectedLeaveElements[_n],cr=ar[Ch];cr&&cr.setForRemoval&&(Oe.push(ar),Ee.add(ar),cr.hasAnimation?this.driver.query(ar,".ng-star-inserted",!0).forEach(Cr=>Ee.add(Cr)):_e.add(ar))}const ve=new Map,it=ON(L,Array.from(Ee));it.forEach((_n,ar)=>{const cr=gw+se++;ve.set(ar,cr),_n.forEach(Cr=>Sh(Cr,cr))}),e.push(()=>{B.forEach((_n,ar)=>{const cr=ee.get(ar);_n.forEach(Cr=>fy(Cr,cr))}),it.forEach((_n,ar)=>{const cr=ve.get(ar);_n.forEach(Cr=>fy(Cr,cr))}),Oe.forEach(_n=>{this.processLeaveNode(_n)})});const mt=[],Ot=[];for(let _n=this._namespaceList.length-1;_n>=0;_n--)this._namespaceList[_n].drainQueuedTransitions(n).forEach(cr=>{const Cr=cr.player,Ts=cr.element;if(mt.push(Cr),this.collectedEnterElements.length){const Ma=Ts[Ch];if(Ma&&Ma.setForMove){if(Ma.previousTriggersValues&&Ma.previousTriggersValues.has(cr.triggerName)){const rf=Ma.previousTriggersValues.get(cr.triggerName),Du=this.statesByElement.get(cr.element);if(Du&&Du.has(cr.triggerName)){const vd=Du.get(cr.triggerName);vd.value=rf,Du.set(cr.triggerName,vd)}}return void Cr.destroy()}}const Qs=!R||!this.driver.containsElement(R,Ts),Ws=ve.get(Ts),vo=ee.get(Ts),Di=this._buildInstruction(cr,r,vo,Ws,Qs);if(Di.errors&&Di.errors.length)return void Ot.push(Di);if(Qs)return Cr.onStart(()=>wg(Ts,Di.fromStyles)),Cr.onDestroy(()=>Nf(Ts,Di.toStyles)),void i.push(Cr);if(cr.isFallbackTransition)return Cr.onStart(()=>wg(Ts,Di.fromStyles)),Cr.onDestroy(()=>Nf(Ts,Di.toStyles)),void i.push(Cr);const Ia=[];Di.timelines.forEach(Ma=>{Ma.stretchStartingKeyframe=!0,this.disabledNodes.has(Ma.element)||Ia.push(Ma)}),Di.timelines=Ia,r.append(Ts,Di.timelines),f.push({instruction:Di,player:Cr,element:Ts}),Di.queriedElements.forEach(Ma=>th(g,Ma,[]).push(Cr)),Di.preStyleProps.forEach((Ma,rf)=>{if(Ma.size){let Du=v.get(rf);Du||v.set(rf,Du=new Set),Ma.forEach((vd,vp)=>Du.add(vp))}}),Di.postStyleProps.forEach((Ma,rf)=>{let Du=x.get(rf);Du||x.set(rf,Du=new Set),Ma.forEach((vd,vp)=>Du.add(vp))})});if(Ot.length){const _n=[];Ot.forEach(ar=>{_n.push(function U9(t,e){return new On(3505,!1)}())}),mt.forEach(ar=>ar.destroy()),this.reportError(_n)}const kt=new Map,tn=new Map;f.forEach(_n=>{const ar=_n.element;r.has(ar)&&(tn.set(ar,ar),this._beforeAnimationBuild(_n.player.namespaceId,_n.instruction,kt))}),i.forEach(_n=>{const ar=_n.element;this._getPreviousPlayers(ar,!1,_n.namespaceId,_n.triggerName,null).forEach(Cr=>{th(kt,ar,[]).push(Cr),Cr.destroy()})});const ut=Oe.filter(_n=>NN(_n,v,x)),Nr=new Map;RN(Nr,this.driver,_e,x,yd).forEach(_n=>{NN(_n,v,x)&&ut.push(_n)});const ni=new Map;B.forEach((_n,ar)=>{RN(ni,this.driver,new Set(_n),v,"!")}),ut.forEach(_n=>{const ar=Nr.get(_n),cr=ni.get(_n);Nr.set(_n,new Map([...Array.from(ar?.entries()??[]),...Array.from(cr?.entries()??[])]))});const ai=[],Xn=[],Hr={};f.forEach(_n=>{const{element:ar,player:cr,instruction:Cr}=_n;if(r.has(ar)){if(M.has(ar))return cr.onDestroy(()=>Nf(ar,Cr.toStyles)),cr.disabled=!0,cr.overrideTotalTime(Cr.totalTime),void i.push(cr);let Ts=Hr;if(tn.size>1){let Ws=ar;const vo=[];for(;Ws=Ws.parentNode;){const Di=tn.get(Ws);if(Di){Ts=Di;break}vo.push(Ws)}vo.forEach(Di=>tn.set(Di,Ts))}const Qs=this._buildAnimation(cr.namespaceId,Cr,kt,s,ni,Nr);if(cr.setRealPlayer(Qs),Ts===Hr)ai.push(cr);else{const Ws=this.playersByElement.get(Ts);Ws&&Ws.length&&(cr.parentPlayer=yp(Ws)),i.push(cr)}}else wg(ar,Cr.fromStyles),cr.onDestroy(()=>Nf(ar,Cr.toStyles)),Xn.push(cr),M.has(ar)&&i.push(cr)}),Xn.forEach(_n=>{const ar=s.get(_n.element);if(ar&&ar.length){const cr=yp(ar);_n.setRealPlayer(cr)}}),i.forEach(_n=>{_n.parentPlayer?_n.syncPlayerEvents(_n.parentPlayer):_n.destroy()});for(let _n=0;_n<Oe.length;_n++){const ar=Oe[_n],cr=ar[Ch];if(fy(ar,gw),cr&&cr.hasAnimation)continue;let Cr=[];if(g.size){let Qs=g.get(ar);Qs&&Qs.length&&Cr.push(...Qs);let Ws=this.driver.query(ar,DT,!0);for(let vo=0;vo<Ws.length;vo++){let Di=g.get(Ws[vo]);Di&&Di.length&&Cr.push(...Di)}}const Ts=Cr.filter(Qs=>!Qs.destroyed);Ts.length?G7(this,ar,Ts):this.processLeaveNode(ar)}return Oe.length=0,ai.forEach(_n=>{this.players.push(_n),_n.onDone(()=>{_n.destroy();const ar=this.players.indexOf(_n);this.players.splice(ar,1)}),_n.play()}),ai}elementContainsData(e,n){let r=!1;const i=n[Ch];return i&&i.setForRemoval&&(r=!0),this.playersByElement.has(n)&&(r=!0),this.playersByQueriedElement.has(n)&&(r=!0),this.statesByElement.has(n)&&(r=!0),this._fetchNamespace(e).elementContainsData(n)||r}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,n,r,i,s){let f=[];if(n){const g=this.playersByQueriedElement.get(e);g&&(f=g)}else{const g=this.playersByElement.get(e);if(g){const v=!s||s==jv;g.forEach(x=>{x.queued||!v&&x.triggerName!=i||f.push(x)})}}return(r||i)&&(f=f.filter(g=>!(r&&r!=g.namespaceId||i&&i!=g.triggerName))),f}_beforeAnimationBuild(e,n,r){const s=n.element,f=n.isRemovalTransition?void 0:e,g=n.isRemovalTransition?void 0:n.triggerName;for(const v of n.timelines){const x=v.element,M=x!==s,R=th(r,x,[]);this._getPreviousPlayers(x,M,f,g,n.toState).forEach(B=>{const ee=B.getRealPlayer();ee.beforeDestroy&&ee.beforeDestroy(),B.destroy(),R.push(B)})}wg(s,n.fromStyles)}_buildAnimation(e,n,r,i,s,f){const g=n.triggerName,v=n.element,x=[],M=new Set,R=new Set,L=n.timelines.map(ee=>{const se=ee.element;M.add(se);const Oe=se[Ch];if(Oe&&Oe.removedBeforeQueried)return new Bv(ee.duration,ee.delay);const Ee=se!==v,_e=function $7(t){const e=[];return LN(t,e),e}((r.get(se)||k7).map(kt=>kt.getRealPlayer())).filter(kt=>!!kt.element&&kt.element===se),ve=s.get(se),it=f.get(se),mt=sN(0,this._normalizer,0,ee.keyframes,ve,it),Ot=this._buildPlayer(ee,mt,_e);if(ee.subTimeline&&i&&R.add(se),Ee){const kt=new GT(e,g,se);kt.setRealPlayer(Ot),x.push(kt)}return Ot});x.forEach(ee=>{th(this.playersByQueriedElement,ee.element,[]).push(ee),ee.onDone(()=>function U7(t,e,n){let r=t.get(e);if(r){if(r.length){const i=r.indexOf(n);r.splice(i,1)}0==r.length&&t.delete(e)}return r}(this.playersByQueriedElement,ee.element,ee))}),M.forEach(ee=>Sh(ee,gN));const B=yp(L);return B.onDestroy(()=>{M.forEach(ee=>fy(ee,gN)),Nf(v,n.toStyles)}),R.forEach(ee=>{th(i,ee,[]).push(B)}),B}_buildPlayer(e,n,r){return n.length>0?this.driver.animate(e.element,n,e.duration,e.delay,e.easing,r):new Bv(e.duration,e.delay)}}class GT{constructor(e,n,r){this.namespaceId=e,this.triggerName=n,this.element=r,this._player=new Bv,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((n,r)=>{n.forEach(i=>bT(e,r,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const n=this._player;n.triggerCallback&&e.onStart(()=>n.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,n){th(this._queuedCallbacks,e,[]).push(n)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const n=this._player;n.triggerCallback&&n.triggerCallback(e)}}function Mw(t){return t&&1===t.nodeType}function PN(t,e){const n=t.style.display;return t.style.display=e??"none",n}function RN(t,e,n,r,i){const s=[];n.forEach(v=>s.push(PN(v)));const f=[];r.forEach((v,x)=>{const M=new Map;v.forEach(R=>{const L=e.computeStyle(x,R,i);M.set(R,L),(!L||0==L.length)&&(x[Ch]=F7,f.push(x))}),t.set(x,M)});let g=0;return n.forEach(v=>PN(v,s[g++])),f}function ON(t,e){const n=new Map;if(t.forEach(g=>n.set(g,[])),0==e.length)return n;const i=new Set(e),s=new Map;function f(g){if(!g)return 1;let v=s.get(g);if(v)return v;const x=g.parentNode;return v=n.has(x)?x:i.has(x)?1:f(x),s.set(g,v),v}return e.forEach(g=>{const v=f(g);1!==v&&n.get(v).push(g)}),n}function Sh(t,e){t.classList?.add(e)}function fy(t,e){t.classList?.remove(e)}function G7(t,e,n){yp(n).onDone(()=>t.processLeaveNode(e))}function LN(t,e){for(let n=0;n<t.length;n++){const r=t[n];r instanceof eN?LN(r.players,e):e.push(r)}}function NN(t,e,n){const r=n.get(t);if(!r)return!1;let i=e.get(t);return i?r.forEach(s=>i.add(s)):e.set(t,r),n.delete(t),!0}class Dw{constructor(e,n,r){this.bodyNode=e,this._driver=n,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(i,s)=>{},this._transitionEngine=new z7(e,n,r),this._timelineEngine=new P7(e,n,r),this._transitionEngine.onRemovalComplete=(i,s)=>this.onRemovalComplete(i,s)}registerTrigger(e,n,r,i,s){const f=e+"-"+i;let g=this._triggerCache[f];if(!g){const v=[],M=OT(this._driver,s,v,[]);if(v.length)throw function D9(t,e){return new On(3404,!1)}();g=function I7(t,e,n){return new M7(t,e,n)}(i,M,this._normalizer),this._triggerCache[f]=g}this._transitionEngine.registerTrigger(n,i,g)}register(e,n){this._transitionEngine.register(e,n)}destroy(e,n){this._transitionEngine.destroy(e,n)}onInsert(e,n,r,i){this._transitionEngine.insertNode(e,n,r,i)}onRemove(e,n,r,i){this._transitionEngine.removeNode(e,n,i||!1,r)}disableAnimations(e,n){this._transitionEngine.markElementAsDisabled(e,n)}process(e,n,r,i){if("@"==r.charAt(0)){const[s,f]=aN(r);this._timelineEngine.command(s,n,f,i)}else this._transitionEngine.trigger(e,n,r,i)}listen(e,n,r,i,s){if("@"==r.charAt(0)){const[f,g]=aN(r);return this._timelineEngine.listen(f,n,g,s)}return this._transitionEngine.listen(e,n,r,i,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let W7=(()=>{class t{constructor(n,r,i){this._element=n,this._startStyles=r,this._endStyles=i,this._state=0;let s=t.initialStylesByElement.get(n);s||t.initialStylesByElement.set(n,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Nf(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Nf(this._element,this._initialStyles),this._endStyles&&(Nf(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(wg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(wg(this._element,this._endStyles),this._endStyles=null),Nf(this._element,this._initialStyles),this._state=3)}}return t.initialStylesByElement=new WeakMap,t})();function $T(t){let e=null;return t.forEach((n,r)=>{(function X7(t){return"display"===t||"position"===t})(r)&&(e=e||new Map,e.set(r,n))}),e}class kN{constructor(e,n,r,i){this.element=e,this.keyframes=n,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const n=[];return e.forEach(r=>{n.push(Object.fromEntries(r))}),n}_triggerWebAnimation(e,n,r){return e.animate(this._convertKeyframesToObject(n),r)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((r,i)=>{"offset"!==i&&e.set(i,this._finished?r:wN(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){const n="start"===e?this._onStartFns:this._onDoneFns;n.forEach(r=>r()),n.length=0}}class Z7{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,n){return!1}containsElement(e,n){return hN(e,n)}getParentElement(e){return TT(e)}query(e,n,r){return fN(e,n,r)}computeStyle(e,n,r){return window.getComputedStyle(e)[n]}animate(e,n,r,i,s,f=[]){const v={duration:r,delay:i,fill:0==i?"both":"forwards"};s&&(v.easing=s);const x=new Map,M=f.filter(B=>B instanceof kN);(function Q9(t,e){return 0===t||0===e})(r,i)&&M.forEach(B=>{B.currentSnapshot.forEach((ee,se)=>x.set(se,ee))});let R=function Z9(t){return t.length?t[0]instanceof Map?t:t.map(e=>mN(e)):[]}(n).map(B=>_p(B));R=function e7(t,e,n){if(n.size&&e.length){let r=e[0],i=[];if(n.forEach((s,f)=>{r.has(f)||i.push(f),r.set(f,s)}),i.length)for(let s=1;s<e.length;s++){let f=e[s];i.forEach(g=>f.set(g,wN(t,g)))}}return e}(e,R,x);const L=function H7(t,e){let n=null,r=null;return Array.isArray(e)&&e.length?(n=$T(e[0]),e.length>1&&(r=$T(e[e.length-1]))):e instanceof Map&&(n=$T(e)),n||r?new W7(t,n,r):null}(e,R);return new kN(e,R,v,L)}}let Y7=(()=>{class t extends XL{constructor(n,r){super(),this._nextAnimationId=0,this._renderer=n.createRenderer(r.body,{id:"0",encapsulation:bo.None,styles:[],data:{animation:[]}})}build(n){const r=this._nextAnimationId.toString();this._nextAnimationId++;const i=Array.isArray(n)?YL(n):n;return FN(this._renderer,null,r,"register",[i]),new K7(r,this._renderer)}}return t.\u0275fac=function(n){return new(n||t)(Gt(Xp),Gt(Os))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();class K7 extends class GH{}{constructor(e,n){super(),this._id=e,this._renderer=n}create(e,n){return new J7(this._id,e,n||{},this._renderer)}}class J7{constructor(e,n,r,i){this.id=e,this.element=n,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}_listen(e,n){return this._renderer.listen(this.element,`@@${this.id}:${e}`,n)}_command(e,...n){return FN(this._renderer,this.element,this.id,e,n)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function FN(t,e,n,r,i){return t.setProperty(e,`@@${n}:${r}`,i)}const BN="@.disabled";let Q7=(()=>{class t{constructor(n,r,i){this.delegate=n,this.engine=r,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),r.onRemovalComplete=(s,f)=>{const g=f?.parentNode(s);g&&f.removeChild(g,s)}}createRenderer(n,r){const s=this.delegate.createRenderer(n,r);if(!(n&&r&&r.data&&r.data.animation)){let M=this._rendererCache.get(s);return M||(M=new zN("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,M)),M}const f=r.id,g=r.id+"-"+this._currentId;this._currentId++,this.engine.register(g,n);const v=M=>{Array.isArray(M)?M.forEach(v):this.engine.registerTrigger(f,g,n,M.name,M)};return r.data.animation.forEach(v),new eW(this,g,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(n,r,i){n>=0&&n<this._microtaskId?this._zone.run(()=>r(i)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[f,g]=s;f(g)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([r,i]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return t.\u0275fac=function(n){return new(n||t)(Gt(Xp),Gt(Dw),Gt(ua))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})();class zN{constructor(e,n,r,i){this.namespaceId=e,this.delegate=n,this.engine=r,this._onDestroy=i,this.destroyNode=this.delegate.destroyNode?s=>n.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,n){return this.delegate.createElement(e,n)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,n){this.delegate.appendChild(e,n),this.engine.onInsert(this.namespaceId,n,e,!1)}insertBefore(e,n,r,i=!0){this.delegate.insertBefore(e,n,r),this.engine.onInsert(this.namespaceId,n,e,i)}removeChild(e,n,r){this.engine.onRemove(this.namespaceId,n,this.delegate,r)}selectRootElement(e,n){return this.delegate.selectRootElement(e,n)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,n,r,i){this.delegate.setAttribute(e,n,r,i)}removeAttribute(e,n,r){this.delegate.removeAttribute(e,n,r)}addClass(e,n){this.delegate.addClass(e,n)}removeClass(e,n){this.delegate.removeClass(e,n)}setStyle(e,n,r,i){this.delegate.setStyle(e,n,r,i)}removeStyle(e,n,r){this.delegate.removeStyle(e,n,r)}setProperty(e,n,r){"@"==n.charAt(0)&&n==BN?this.disableAnimations(e,!!r):this.delegate.setProperty(e,n,r)}setValue(e,n){this.delegate.setValue(e,n)}listen(e,n,r){return this.delegate.listen(e,n,r)}disableAnimations(e,n){this.engine.disableAnimations(e,n)}}class eW extends zN{constructor(e,n,r,i,s){super(n,r,i,s),this.factory=e,this.namespaceId=n}setProperty(e,n,r){"@"==n.charAt(0)?"."==n.charAt(1)&&n==BN?this.disableAnimations(e,r=void 0===r||!!r):this.engine.process(this.namespaceId,e,n.slice(1),r):this.delegate.setProperty(e,n,r)}listen(e,n,r){if("@"==n.charAt(0)){const i=function tW(t){switch(t){case"body":return document.body;case"document":return document;case"window":return window;default:return t}}(e);let s=n.slice(1),f="";return"@"!=s.charAt(0)&&([s,f]=function nW(t){const e=t.indexOf(".");return[t.substring(0,e),t.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,i,s,f,g=>{this.factory.scheduleListenerCallback(g._data||-1,r,g)})}return this.delegate.listen(e,n,r)}}const UN=[{provide:XL,useClass:Y7},{provide:BT,useFactory:function iW(){return new E7}},{provide:Dw,useClass:(()=>{class t extends Dw{constructor(n,r,i,s){super(n.body,r,i)}ngOnDestroy(){this.flush()}}return t.\u0275fac=function(n){return new(n||t)(Gt(Os),Gt(IT),Gt(BT),Gt(jm))},t.\u0275prov=zn({token:t,factory:t.\u0275fac}),t})()},{provide:Xp,useFactory:function oW(t,e,n){return new Q7(t,e,n)},deps:[Y1,Dw,ua]}],qT=[{provide:IT,useFactory:()=>new Z7},{provide:vE,useValue:"BrowserAnimations"},...UN],VN=[{provide:IT,useClass:dN},{provide:vE,useValue:"NoopAnimations"},...UN];let sW=(()=>{class t{static withConfig(n){return{ngModule:t,providers:n.disableAnimations?VN:qT}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t}),t.\u0275inj=Ms({providers:qT,imports:[YA]}),t})(),aW=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ls({type:t,bootstrap:[a9]}),t.\u0275inj=Ms({imports:[YA,qV,J$,sW,r9]}),t})();(function p3(){if(KD)throw new Error("Cannot enable prod mode after platform setup.");YD=!1})(),n5().bootstrapModule(aW).catch(t=>console.error(t))},1503:(Lt,rt,xe)=>{"use strict";var ye=xe(3269);function Ce(p){var K=[1/0,1/0,-1/0,-1/0];return ye.coordEach(p,function(ge){K[0]>ge[0]&&(K[0]=ge[0]),K[1]>ge[1]&&(K[1]=ge[1]),K[2]<ge[0]&&(K[2]=ge[0]),K[3]<ge[1]&&(K[3]=ge[1])}),K}Ce.default=Ce,rt.Z=Ce},8275:(Lt,rt)=>{"use strict";function xe(je,We,Se){void 0===Se&&(Se={});var ln={type:"Feature"};return(0===Se.id||Se.id)&&(ln.id=Se.id),Se.bbox&&(ln.bbox=Se.bbox),ln.properties=We||{},ln.geometry=je,ln}function ye(je,We,Se){if(void 0===Se&&(Se={}),!je)throw new Error("coordinates is required");if(!Array.isArray(je))throw new Error("coordinates must be an Array");if(je.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!le(je[0])||!le(je[1]))throw new Error("coordinates must contain numbers");return xe({type:"Point",coordinates:je},We,Se)}function p(je,We,Se){void 0===Se&&(Se={});for(var ln=0,Bt=je;ln<Bt.length;ln++){var $e=Bt[ln];if($e.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Tt=0;Tt<$e[$e.length-1].length;Tt++)if($e[$e.length-1][Tt]!==$e[0][Tt])throw new Error("First and last Position are not equivalent.")}return xe({type:"Polygon",coordinates:je},We,Se)}function ge(je,We,Se){if(void 0===Se&&(Se={}),je.length<2)throw new Error("coordinates must be an array of two or more positions");return xe({type:"LineString",coordinates:je},We,Se)}function Pe(je,We){void 0===We&&(We={});var Se={type:"FeatureCollection"};return We.id&&(Se.id=We.id),We.bbox&&(Se.bbox=We.bbox),Se.features=je,Se}function Fe(je,We,Se){return void 0===Se&&(Se={}),xe({type:"MultiLineString",coordinates:je},We,Se)}function bt(je,We,Se){return void 0===Se&&(Se={}),xe({type:"MultiPoint",coordinates:je},We,Se)}function nt(je,We,Se){return void 0===Se&&(Se={}),xe({type:"MultiPolygon",coordinates:je},We,Se)}function Rt(je,We){void 0===We&&(We="kilometers");var Se=rt.factors[We];if(!Se)throw new Error(We+" units is invalid");return je*Se}function ae(je,We){void 0===We&&(We="kilometers");var Se=rt.factors[We];if(!Se)throw new Error(We+" units is invalid");return je/Se}function Q(je){return je%(2*Math.PI)*180/Math.PI}function le(je){return!isNaN(je)&&null!==je&&!Array.isArray(je)}Object.defineProperty(rt,"__esModule",{value:!0}),rt.earthRadius=6371008.8,rt.factors={centimeters:100*rt.earthRadius,centimetres:100*rt.earthRadius,degrees:rt.earthRadius/111325,feet:3.28084*rt.earthRadius,inches:39.37*rt.earthRadius,kilometers:rt.earthRadius/1e3,kilometres:rt.earthRadius/1e3,meters:rt.earthRadius,metres:rt.earthRadius,miles:rt.earthRadius/1609.344,millimeters:1e3*rt.earthRadius,millimetres:1e3*rt.earthRadius,nauticalmiles:rt.earthRadius/1852,radians:1,yards:1.0936*rt.earthRadius},rt.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/rt.earthRadius,yards:1.0936133},rt.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},rt.feature=xe,rt.geometry=function de(je,We,Se){switch(void 0===Se&&(Se={}),je){case"Point":return ye(We).geometry;case"LineString":return ge(We).geometry;case"Polygon":return p(We).geometry;case"MultiPoint":return bt(We).geometry;case"MultiLineString":return Fe(We).geometry;case"MultiPolygon":return nt(We).geometry;default:throw new Error(je+" is invalid")}},rt.point=ye,rt.points=function Ce(je,We,Se){return void 0===Se&&(Se={}),Pe(je.map(function(ln){return ye(ln,We)}),Se)},rt.polygon=p,rt.polygons=function K(je,We,Se){return void 0===Se&&(Se={}),Pe(je.map(function(ln){return p(ln,We)}),Se)},rt.lineString=ge,rt.lineStrings=function Te(je,We,Se){return void 0===Se&&(Se={}),Pe(je.map(function(ln){return ge(ln,We)}),Se)},rt.featureCollection=Pe,rt.multiLineString=Fe,rt.multiPoint=bt,rt.multiPolygon=nt,rt.geometryCollection=function He(je,We,Se){return void 0===Se&&(Se={}),xe({type:"GeometryCollection",geometries:je},We,Se)},rt.round=function dt(je,We){if(void 0===We&&(We=0),We&&!(We>=0))throw new Error("precision must be a positive number");var Se=Math.pow(10,We||0);return Math.round(je*Se)/Se},rt.radiansToLength=Rt,rt.lengthToRadians=ae,rt.lengthToDegrees=function X(je,We){return Q(ae(je,We))},rt.bearingToAzimuth=function re(je){var We=je%360;return We<0&&(We+=360),We},rt.radiansToDegrees=Q,rt.degreesToRadians=function te(je){return je%360*Math.PI/180},rt.convertLength=function ue(je,We,Se){if(void 0===We&&(We="kilometers"),void 0===Se&&(Se="kilometers"),!(je>=0))throw new Error("length must be a positive number");return Rt(ae(je,We),Se)},rt.convertArea=function oe(je,We,Se){if(void 0===We&&(We="meters"),void 0===Se&&(Se="kilometers"),!(je>=0))throw new Error("area must be a positive number");var ln=rt.areaFactors[We];if(!ln)throw new Error("invalid original units");var Bt=rt.areaFactors[Se];if(!Bt)throw new Error("invalid final units");return je/ln*Bt},rt.isNumber=le,rt.isObject=function me(je){return!!je&&je.constructor===Object},rt.validateBBox=function ne(je){if(!je)throw new Error("bbox is required");if(!Array.isArray(je))throw new Error("bbox must be an Array");if(4!==je.length&&6!==je.length)throw new Error("bbox must be an Array of 4 or 6 numbers");je.forEach(function(We){if(!le(We))throw new Error("bbox must only contain numbers")})},rt.validateId=function ct(je){if(!je)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof je))throw new Error("id must be a number or a string")}},3269:(Lt,rt,xe)=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});var de=xe(8275);function ye(te,ue,oe){if(null!==te)for(var le,me,ne,ct,je,We,Se,$e,ln=0,Bt=0,Tt=te.type,Xe="FeatureCollection"===Tt,gt="Feature"===Tt,xt=Xe?te.features.length:1,Be=0;Be<xt;Be++){je=($e=!!(Se=Xe?te.features[Be].geometry:gt?te.geometry:te)&&"GeometryCollection"===Se.type)?Se.geometries.length:1;for(var qt=0;qt<je;qt++){var $t=0,pn=0;if(null!==(ct=$e?Se.geometries[qt]:Se)){We=ct.coordinates;var At=ct.type;switch(ln=!oe||"Polygon"!==At&&"MultiPolygon"!==At?0:1,At){case null:break;case"Point":if(!1===ue(We,Bt,Be,$t,pn))return!1;Bt++,$t++;break;case"LineString":case"MultiPoint":for(le=0;le<We.length;le++){if(!1===ue(We[le],Bt,Be,$t,pn))return!1;Bt++,"MultiPoint"===At&&$t++}"LineString"===At&&$t++;break;case"Polygon":case"MultiLineString":for(le=0;le<We.length;le++){for(me=0;me<We[le].length-ln;me++){if(!1===ue(We[le][me],Bt,Be,$t,pn))return!1;Bt++}"MultiLineString"===At&&$t++,"Polygon"===At&&pn++}"Polygon"===At&&$t++;break;case"MultiPolygon":for(le=0;le<We.length;le++){for(pn=0,me=0;me<We[le].length;me++){for(ne=0;ne<We[le][me].length-ln;ne++){if(!1===ue(We[le][me][ne],Bt,Be,$t,pn))return!1;Bt++}pn++}$t++}break;case"GeometryCollection":for(le=0;le<ct.geometries.length;le++)if(!1===ye(ct.geometries[le],ue,oe))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(te,ue){var oe;switch(te.type){case"FeatureCollection":for(oe=0;oe<te.features.length&&!1!==ue(te.features[oe].properties,oe);oe++);break;case"Feature":ue(te.properties,0)}}function ge(te,ue){if("Feature"===te.type)ue(te,0);else if("FeatureCollection"===te.type)for(var oe=0;oe<te.features.length&&!1!==ue(te.features[oe],oe);oe++);}function Fe(te,ue){var oe,le,me,ne,ct,je,We,Se,ln,Bt,$e=0,Tt="FeatureCollection"===te.type,Xe="Feature"===te.type,gt=Tt?te.features.length:1;for(oe=0;oe<gt;oe++){for(Se=Tt?te.features[oe].properties:Xe?te.properties:{},ln=Tt?te.features[oe].bbox:Xe?te.bbox:void 0,Bt=Tt?te.features[oe].id:Xe?te.id:void 0,ct=(We=!!(je=Tt?te.features[oe].geometry:Xe?te.geometry:te)&&"GeometryCollection"===je.type)?je.geometries.length:1,me=0;me<ct;me++)if(null!==(ne=We?je.geometries[me]:je))switch(ne.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===ue(ne,$e,Se,ln,Bt))return!1;break;case"GeometryCollection":for(le=0;le<ne.geometries.length;le++)if(!1===ue(ne.geometries[le],$e,Se,ln,Bt))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===ue(null,$e,Se,ln,Bt))return!1;$e++}}function nt(te,ue){Fe(te,function(oe,le,me,ne,ct){var We,je=null===oe?null:oe.type;switch(je){case null:case"Point":case"LineString":case"Polygon":return!1!==ue(de.feature(oe,me,{bbox:ne,id:ct}),le,0)&&void 0}switch(je){case"MultiPoint":We="Point";break;case"MultiLineString":We="LineString";break;case"MultiPolygon":We="Polygon"}for(var Se=0;Se<oe.coordinates.length;Se++)if(!1===ue(de.feature({type:We,coordinates:oe.coordinates[Se]},me),le,Se))return!1})}function dt(te,ue){nt(te,function(oe,le,me){var ne=0;if(oe.geometry){var ct=oe.geometry.type;if("Point"!==ct&&"MultiPoint"!==ct){var je,We=0,Se=0,ln=0;if(!1===ye(oe,function(Bt,$e,Tt,Xe,gt){if(void 0===je||le>We||Xe>Se||gt>ln)return je=Bt,We=le,Se=Xe,ln=gt,void(ne=0);var xt=de.lineString([je,Bt],oe.properties);if(!1===ue(xt,le,me,gt,ne))return!1;ne++,je=Bt}))return!1}}})}function ae(te,ue){if(!te)throw new Error("geojson is required");nt(te,function(oe,le,me){if(null!==oe.geometry){var ct=oe.geometry.coordinates;switch(oe.geometry.type){case"LineString":if(!1===ue(oe,le,me,0,0))return!1;break;case"Polygon":for(var je=0;je<ct.length;je++)if(!1===ue(de.lineString(ct[je],oe.properties),le,me,je))return!1}}})}rt.coordAll=function Pe(te){var ue=[];return ye(te,function(oe){ue.push(oe)}),ue},rt.coordEach=ye,rt.coordReduce=function Ce(te,ue,oe,le){var me=oe;return ye(te,function(ne,ct,je,We,Se){me=0===ct&&void 0===oe?ne:ue(me,ne,ct,je,We,Se)},le),me},rt.featureEach=ge,rt.featureReduce=function Te(te,ue,oe){var le=oe;return ge(te,function(me,ne){le=0===ne&&void 0===oe?me:ue(le,me,ne)}),le},rt.findPoint=function Q(te,ue){if(!de.isObject(ue=ue||{}))throw new Error("options is invalid");var je,oe=ue.featureIndex||0,le=ue.multiFeatureIndex||0,me=ue.geometryIndex||0,ne=ue.coordIndex||0,ct=ue.properties;switch(te.type){case"FeatureCollection":oe<0&&(oe=te.features.length+oe),ct=ct||te.features[oe].properties,je=te.features[oe].geometry;break;case"Feature":ct=ct||te.properties,je=te.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":je=te;break;default:throw new Error("geojson is invalid")}if(null===je)return null;var We=je.coordinates;switch(je.type){case"Point":return de.point(We,ct,ue);case"MultiPoint":return le<0&&(le=We.length+le),de.point(We[le],ct,ue);case"LineString":return ne<0&&(ne=We.length+ne),de.point(We[ne],ct,ue);case"Polygon":return me<0&&(me=We.length+me),ne<0&&(ne=We[me].length+ne),de.point(We[me][ne],ct,ue);case"MultiLineString":return le<0&&(le=We.length+le),ne<0&&(ne=We[le].length+ne),de.point(We[le][ne],ct,ue);case"MultiPolygon":return le<0&&(le=We.length+le),me<0&&(me=We[le].length+me),ne<0&&(ne=We[le][me].length-ne),de.point(We[le][me][ne],ct,ue)}throw new Error("geojson is invalid")},rt.findSegment=function re(te,ue){if(!de.isObject(ue=ue||{}))throw new Error("options is invalid");var je,oe=ue.featureIndex||0,le=ue.multiFeatureIndex||0,me=ue.geometryIndex||0,ne=ue.segmentIndex||0,ct=ue.properties;switch(te.type){case"FeatureCollection":oe<0&&(oe=te.features.length+oe),ct=ct||te.features[oe].properties,je=te.features[oe].geometry;break;case"Feature":ct=ct||te.properties,je=te.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":je=te;break;default:throw new Error("geojson is invalid")}if(null===je)return null;var We=je.coordinates;switch(je.type){case"Point":case"MultiPoint":return null;case"LineString":return ne<0&&(ne=We.length+ne-1),de.lineString([We[ne],We[ne+1]],ct,ue);case"Polygon":return me<0&&(me=We.length+me),ne<0&&(ne=We[me].length+ne-1),de.lineString([We[me][ne],We[me][ne+1]],ct,ue);case"MultiLineString":return le<0&&(le=We.length+le),ne<0&&(ne=We[le].length+ne-1),de.lineString([We[le][ne],We[le][ne+1]],ct,ue);case"MultiPolygon":return le<0&&(le=We.length+le),me<0&&(me=We[le].length+me),ne<0&&(ne=We[le][me].length-ne-1),de.lineString([We[le][me][ne],We[le][me][ne+1]],ct,ue)}throw new Error("geojson is invalid")},rt.flattenEach=nt,rt.flattenReduce=function He(te,ue,oe){var le=oe;return nt(te,function(me,ne,ct){le=0===ne&&0===ct&&void 0===oe?me:ue(le,me,ne,ct)}),le},rt.geomEach=Fe,rt.geomReduce=function bt(te,ue,oe){var le=oe;return Fe(te,function(me,ne,ct,je,We){le=0===ne&&void 0===oe?me:ue(le,me,ne,ct,je,We)}),le},rt.lineEach=ae,rt.lineReduce=function X(te,ue,oe){var le=oe;return ae(te,function(me,ne,ct,je){le=0===ne&&void 0===oe?me:ue(le,me,ne,ct,je)}),le},rt.propEach=p,rt.propReduce=function K(te,ue,oe){var le=oe;return p(te,function(me,ne){le=0===ne&&void 0===oe?me:ue(le,me,ne)}),le},rt.segmentEach=dt,rt.segmentReduce=function Rt(te,ue,oe){var le=oe,me=!1;return dt(te,function(ne,ct,je,We,Se){le=!1===me&&void 0===oe?ne:ue(le,ne,ct,je,We,Se),me=!0}),le}},2049:function(Lt,rt,xe){var de;Lt=xe.nmd(Lt),function(ye){"object"==typeof global&&global;var ge=function(Rt){this.message=Rt};(ge.prototype=new Error).name="InvalidCharacterError";var Te=function(Rt){throw new ge(Rt)},Pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe=/[\t\n\f\r ]/g,He={encode:function(Rt){Rt=String(Rt),/[^\0-\xFF]/.test(Rt)&&Te("The string to be encoded contains characters outside of the Latin1 range.");for(var Q,te,ue,le,ae=Rt.length%3,X="",re=-1,me=Rt.length-ae;++re<me;)Q=Rt.charCodeAt(re)<<16,te=Rt.charCodeAt(++re)<<8,ue=Rt.charCodeAt(++re),X+=Pe.charAt((le=Q+te+ue)>>18&63)+Pe.charAt(le>>12&63)+Pe.charAt(le>>6&63)+Pe.charAt(63&le);return 2==ae?(Q=Rt.charCodeAt(re)<<8,te=Rt.charCodeAt(++re),X+=Pe.charAt((le=Q+te)>>10)+Pe.charAt(le>>4&63)+Pe.charAt(le<<2&63)+"="):1==ae&&(le=Rt.charCodeAt(re),X+=Pe.charAt(le>>2)+Pe.charAt(le<<4&63)+"=="),X},decode:function(Rt){var ae=(Rt=String(Rt).replace(Fe,"")).length;ae%4==0&&(ae=(Rt=Rt.replace(/==?$/,"")).length),(ae%4==1||/[^+a-zA-Z0-9/]/.test(Rt))&&Te("Invalid character: the string to be decoded is not correctly encoded.");for(var re,Q,X=0,te="",ue=-1;++ue<ae;)Q=Pe.indexOf(Rt.charAt(ue)),re=X%4?64*re+Q:Q,X++%4&&(te+=String.fromCharCode(255&re>>(-2*X&6)));return te},version:"0.1.0"};void 0!==(de=function(){return He}.call(rt,xe,rt,Lt))&&(Lt.exports=de)}()},5834:(Lt,rt,xe)=>{"use strict";var de=xe(5203),ye=xe(5685),Ce=ye(de("String.prototype.indexOf"));Lt.exports=function(K,ge){var Te=de(K,!!ge);return"function"==typeof Te&&Ce(K,".prototype.")>-1?ye(Te):Te}},5685:(Lt,rt,xe)=>{"use strict";var de=xe(4444),ye=xe(5203),Ce=ye("%Function.prototype.apply%"),p=ye("%Function.prototype.call%"),K=ye("%Reflect.apply%",!0)||de.call(p,Ce),ge=ye("%Object.getOwnPropertyDescriptor%",!0),Te=ye("%Object.defineProperty%",!0),Pe=ye("%Math.max%");if(Te)try{Te({},"a",{value:1})}catch{Te=null}Lt.exports=function(nt){var He=K(de,p,arguments);if(ge&&Te){var dt=ge(He,"length");dt.configurable&&Te(He,"length",{value:1+Pe(0,nt.length-(arguments.length-1))})}return He};var Fe=function(){return K(de,Ce,arguments)};Te?Te(Lt.exports,"apply",{value:Fe}):Lt.exports.apply=Fe},1335:(Lt,rt,xe)=>{"use strict";var de=xe(3156),ye=xe(7253),Ce=xe(3870),p=xe(7563).orient2d;function K(oe,le,me){le=Math.max(0,void 0===le?2:le),me=me||0;var ne=function Rt(oe){for(var le=oe[0],me=oe[0],ne=oe[0],ct=oe[0],je=0;je<oe.length;je++){var We=oe[je];We[0]<le[0]&&(le=We),We[0]>ne[0]&&(ne=We),We[1]<me[1]&&(me=We),We[1]>ct[1]&&(ct=We)}var Se=[le,me,ne,ct],ln=Se.slice();for(je=0;je<oe.length;je++)Ce(oe[je],Se)||ln.push(oe[je]);return function ue(oe){oe.sort(te);for(var le=[],me=0;me<oe.length;me++){for(;le.length>=2&&nt(le[le.length-2],le[le.length-1],oe[me])<=0;)le.pop();le.push(oe[me])}for(var ne=[],ct=oe.length-1;ct>=0;ct--){for(;ne.length>=2&&nt(ne[ne.length-2],ne[ne.length-1],oe[ct])<=0;)ne.pop();ne.push(oe[ct])}return ne.pop(),le.pop(),le.concat(ne)}(ln)}(oe),ct=new de(16);ct.toBBox=function(pn){return{minX:pn[0],minY:pn[1],maxX:pn[0],maxY:pn[1]}},ct.compareMinX=function(pn,At){return pn[0]-At[0]},ct.compareMinY=function(pn,At){return pn[1]-At[1]},ct.load(oe);for(var Se,je=[],We=0;We<ne.length;We++){var ln=ne[We];ct.remove(ln),Se=ae(ln,Se),je.push(Se)}var Bt=new de(16);for(We=0;We<je.length;We++)Bt.insert(dt(je[We]));for(var $e=le*le,Tt=me*me;je.length;){var Xe=je.shift(),gt=Xe.p,xt=Xe.next.p,Be=X(gt,xt);if(!(Be<Tt)){var qt=Be/$e;(ln=ge(ct,Xe.prev.p,gt,xt,Xe.next.next.p,qt,Bt))&&Math.min(X(ln,gt),X(ln,xt))<=qt&&(je.push(Xe),je.push(ae(ln,Xe)),ct.remove(ln),Bt.remove(Xe),Bt.insert(dt(Xe)),Bt.insert(dt(Xe.next)))}}Xe=Se;var $t=[];do{$t.push(Xe.p),Xe=Xe.next}while(Xe!==Se);return $t.push(Xe.p),$t}function ge(oe,le,me,ne,ct,je,We){for(var Se=new ye([],Te),ln=oe.data;ln;){for(var Bt=0;Bt<ln.children.length;Bt++){var $e=ln.children[Bt],Tt=ln.leaf?re($e,me,ne):Pe(me,ne,$e);Tt>je||Se.push({node:$e,dist:Tt})}for(;Se.length&&!Se.peek().node.children;){var Xe=Se.pop(),gt=Xe.node,xt=re(gt,le,me),Be=re(gt,ne,ct);if(Xe.dist<xt&&Xe.dist<Be&&bt(me,gt,We)&&bt(ne,gt,We))return gt}(ln=Se.pop())&&(ln=ln.node)}return null}function Te(oe,le){return oe.dist-le.dist}function Pe(oe,le,me){if(Fe(oe,me)||Fe(le,me))return 0;var ne=Q(oe[0],oe[1],le[0],le[1],me.minX,me.minY,me.maxX,me.minY);if(0===ne)return 0;var ct=Q(oe[0],oe[1],le[0],le[1],me.minX,me.minY,me.minX,me.maxY);if(0===ct)return 0;var je=Q(oe[0],oe[1],le[0],le[1],me.maxX,me.minY,me.maxX,me.maxY);if(0===je)return 0;var We=Q(oe[0],oe[1],le[0],le[1],me.minX,me.maxY,me.maxX,me.maxY);return 0===We?0:Math.min(ne,ct,je,We)}function Fe(oe,le){return oe[0]>=le.minX&&oe[0]<=le.maxX&&oe[1]>=le.minY&&oe[1]<=le.maxY}function bt(oe,le,me){for(var ne=Math.min(oe[0],le[0]),ct=Math.min(oe[1],le[1]),je=Math.max(oe[0],le[0]),We=Math.max(oe[1],le[1]),Se=me.search({minX:ne,minY:ct,maxX:je,maxY:We}),ln=0;ln<Se.length;ln++)if(He(Se[ln].p,Se[ln].next.p,oe,le))return!1;return!0}function nt(oe,le,me){return p(oe[0],oe[1],le[0],le[1],me[0],me[1])}function He(oe,le,me,ne){return oe!==ne&&le!==me&&nt(oe,le,me)>0!=nt(oe,le,ne)>0&&nt(me,ne,oe)>0!=nt(me,ne,le)>0}function dt(oe){var le=oe.p,me=oe.next.p;return oe.minX=Math.min(le[0],me[0]),oe.minY=Math.min(le[1],me[1]),oe.maxX=Math.max(le[0],me[0]),oe.maxY=Math.max(le[1],me[1]),oe}function ae(oe,le){var me={p:oe,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return le?(me.next=le.next,me.prev=le,le.next.prev=me,le.next=me):(me.prev=me,me.next=me),me}function X(oe,le){var me=oe[0]-le[0],ne=oe[1]-le[1];return me*me+ne*ne}function re(oe,le,me){var ne=le[0],ct=le[1],je=me[0]-ne,We=me[1]-ct;if(0!==je||0!==We){var Se=((oe[0]-ne)*je+(oe[1]-ct)*We)/(je*je+We*We);Se>1?(ne=me[0],ct=me[1]):Se>0&&(ne+=je*Se,ct+=We*Se)}return(je=oe[0]-ne)*je+(We=oe[1]-ct)*We}function Q(oe,le,me,ne,ct,je,We,Se){var Sn,Yn,Kn,pr,ln=me-oe,Bt=ne-le,$e=We-ct,Tt=Se-je,Xe=oe-ct,gt=le-je,xt=ln*ln+Bt*Bt,Be=ln*$e+Bt*Tt,qt=$e*$e+Tt*Tt,$t=ln*Xe+Bt*gt,pn=$e*Xe+Tt*gt,At=xt*qt-Be*Be,Un=At,Rn=At;0===At?(Yn=0,Un=1,pr=pn,Rn=qt):(pr=xt*pn-Be*$t,(Yn=Be*pn-qt*$t)<0?(Yn=0,pr=pn,Rn=qt):Yn>Un&&(Yn=Un,pr=pn+Be,Rn=qt)),pr<0?(pr=0,-$t<0?Yn=0:-$t>xt?Yn=Un:(Yn=-$t,Un=xt)):pr>Rn&&(pr=Rn,-$t+Be<0?Yn=0:-$t+Be>xt?Yn=Un:(Yn=-$t+Be,Un=xt));var zr=(1-(Kn=0===pr?0:pr/Rn))*ct+Kn*We-((1-(Sn=0===Yn?0:Yn/Un))*oe+Sn*me),Nt=(1-Kn)*je+Kn*Se-((1-Sn)*le+Sn*ne);return zr*zr+Nt*Nt}function te(oe,le){return oe[0]===le[0]?oe[1]-le[1]:oe[0]-le[0]}ye.default&&(ye=ye.default),Lt.exports=K,Lt.exports.default=K},3156:function(Lt){Lt.exports=function(){"use strict";function rt(ae,X,re,Q,te){!function ue(oe,le,me,ne,ct){for(;ne>me;){if(ne-me>600){var je=ne-me+1,We=le-me+1,Se=Math.log(je),ln=.5*Math.exp(2*Se/3),Bt=.5*Math.sqrt(Se*ln*(je-ln)/je)*(We-je/2<0?-1:1);ue(oe,le,Math.max(me,Math.floor(le-We*ln/je+Bt)),Math.min(ne,Math.floor(le+(je-We)*ln/je+Bt)),ct)}var Xe=oe[le],gt=me,xt=ne;for(xe(oe,me,le),ct(oe[ne],Xe)>0&&xe(oe,me,ne);gt<xt;){for(xe(oe,gt,xt),gt++,xt--;ct(oe[gt],Xe)<0;)gt++;for(;ct(oe[xt],Xe)>0;)xt--}0===ct(oe[me],Xe)?xe(oe,me,xt):xe(oe,++xt,ne),xt<=le&&(me=xt+1),le<=xt&&(ne=xt-1)}}(ae,X,re||0,Q||ae.length-1,te||de)}function xe(ae,X,re){var Q=ae[X];ae[X]=ae[re],ae[re]=Q}function de(ae,X){return ae<X?-1:ae>X?1:0}var ye=function(ae){void 0===ae&&(ae=9),this._maxEntries=Math.max(4,ae),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function Ce(ae,X,re){if(!re)return X.indexOf(ae);for(var Q=0;Q<X.length;Q++)if(re(ae,X[Q]))return Q;return-1}function p(ae,X){K(ae,0,ae.children.length,X,ae)}function K(ae,X,re,Q,te){te||(te=dt(null)),te.minX=1/0,te.minY=1/0,te.maxX=-1/0,te.maxY=-1/0;for(var ue=X;ue<re;ue++){var oe=ae.children[ue];ge(te,ae.leaf?Q(oe):oe)}return te}function ge(ae,X){return ae.minX=Math.min(ae.minX,X.minX),ae.minY=Math.min(ae.minY,X.minY),ae.maxX=Math.max(ae.maxX,X.maxX),ae.maxY=Math.max(ae.maxY,X.maxY),ae}function Te(ae,X){return ae.minX-X.minX}function Pe(ae,X){return ae.minY-X.minY}function Fe(ae){return(ae.maxX-ae.minX)*(ae.maxY-ae.minY)}function bt(ae){return ae.maxX-ae.minX+(ae.maxY-ae.minY)}function nt(ae,X){return ae.minX<=X.minX&&ae.minY<=X.minY&&X.maxX<=ae.maxX&&X.maxY<=ae.maxY}function He(ae,X){return X.minX<=ae.maxX&&X.minY<=ae.maxY&&X.maxX>=ae.minX&&X.maxY>=ae.minY}function dt(ae){return{children:ae,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Rt(ae,X,re,Q,te){for(var ue=[X,re];ue.length;)if(!((re=ue.pop())-(X=ue.pop())<=Q)){var oe=X+Math.ceil((re-X)/Q/2)*Q;rt(ae,oe,X,re,te),ue.push(X,oe,oe,re)}}return ye.prototype.all=function(){return this._all(this.data,[])},ye.prototype.search=function(ae){var X=this.data,re=[];if(!He(ae,X))return re;for(var Q=this.toBBox,te=[];X;){for(var ue=0;ue<X.children.length;ue++){var oe=X.children[ue],le=X.leaf?Q(oe):oe;He(ae,le)&&(X.leaf?re.push(oe):nt(ae,le)?this._all(oe,re):te.push(oe))}X=te.pop()}return re},ye.prototype.collides=function(ae){var X=this.data;if(!He(ae,X))return!1;for(var re=[];X;){for(var Q=0;Q<X.children.length;Q++){var te=X.children[Q],ue=X.leaf?this.toBBox(te):te;if(He(ae,ue)){if(X.leaf||nt(ae,ue))return!0;re.push(te)}}X=re.pop()}return!1},ye.prototype.load=function(ae){if(!ae||!ae.length)return this;if(ae.length<this._minEntries){for(var X=0;X<ae.length;X++)this.insert(ae[X]);return this}var re=this._build(ae.slice(),0,ae.length-1,0);if(this.data.children.length)if(this.data.height===re.height)this._splitRoot(this.data,re);else{if(this.data.height<re.height){var Q=this.data;this.data=re,re=Q}this._insert(re,this.data.height-re.height-1,!0)}else this.data=re;return this},ye.prototype.insert=function(ae){return ae&&this._insert(ae,this.data.height-1),this},ye.prototype.clear=function(){return this.data=dt([]),this},ye.prototype.remove=function(ae,X){if(!ae)return this;for(var re,Q,te,ue=this.data,oe=this.toBBox(ae),le=[],me=[];ue||le.length;){if(ue||(ue=le.pop(),Q=le[le.length-1],re=me.pop(),te=!0),ue.leaf){var ne=Ce(ae,ue.children,X);if(-1!==ne)return ue.children.splice(ne,1),le.push(ue),this._condense(le),this}te||ue.leaf||!nt(ue,oe)?Q?(re++,ue=Q.children[re],te=!1):ue=null:(le.push(ue),me.push(re),re=0,Q=ue,ue=ue.children[0])}return this},ye.prototype.toBBox=function(ae){return ae},ye.prototype.compareMinX=function(ae,X){return ae.minX-X.minX},ye.prototype.compareMinY=function(ae,X){return ae.minY-X.minY},ye.prototype.toJSON=function(){return this.data},ye.prototype.fromJSON=function(ae){return this.data=ae,this},ye.prototype._all=function(ae,X){for(var re=[];ae;)ae.leaf?X.push.apply(X,ae.children):re.push.apply(re,ae.children),ae=re.pop();return X},ye.prototype._build=function(ae,X,re,Q){var te,ue=re-X+1,oe=this._maxEntries;if(ue<=oe)return p(te=dt(ae.slice(X,re+1)),this.toBBox),te;Q||(Q=Math.ceil(Math.log(ue)/Math.log(oe)),oe=Math.ceil(ue/Math.pow(oe,Q-1))),(te=dt([])).leaf=!1,te.height=Q;var le=Math.ceil(ue/oe),me=le*Math.ceil(Math.sqrt(oe));Rt(ae,X,re,me,this.compareMinX);for(var ne=X;ne<=re;ne+=me){var ct=Math.min(ne+me-1,re);Rt(ae,ne,ct,le,this.compareMinY);for(var je=ne;je<=ct;je+=le){var We=Math.min(je+le-1,ct);te.children.push(this._build(ae,je,We,Q-1))}}return p(te,this.toBBox),te},ye.prototype._chooseSubtree=function(ae,X,re,Q){for(;Q.push(X),!X.leaf&&Q.length-1!==re;){for(var te=1/0,ue=1/0,oe=void 0,le=0;le<X.children.length;le++){var me=X.children[le],ne=Fe(me),ct=(je=ae,We=me,(Math.max(We.maxX,je.maxX)-Math.min(We.minX,je.minX))*(Math.max(We.maxY,je.maxY)-Math.min(We.minY,je.minY))-ne);ct<ue?(ue=ct,te=ne<te?ne:te,oe=me):ct===ue&&ne<te&&(te=ne,oe=me)}X=oe||X.children[0]}var je,We;return X},ye.prototype._insert=function(ae,X,re){var Q=re?ae:this.toBBox(ae),te=[],ue=this._chooseSubtree(Q,this.data,X,te);for(ue.children.push(ae),ge(ue,Q);X>=0&&te[X].children.length>this._maxEntries;)this._split(te,X),X--;this._adjustParentBBoxes(Q,te,X)},ye.prototype._split=function(ae,X){var re=ae[X],Q=re.children.length,te=this._minEntries;this._chooseSplitAxis(re,te,Q);var ue=this._chooseSplitIndex(re,te,Q),oe=dt(re.children.splice(ue,re.children.length-ue));oe.height=re.height,oe.leaf=re.leaf,p(re,this.toBBox),p(oe,this.toBBox),X?ae[X-1].children.push(oe):this._splitRoot(re,oe)},ye.prototype._splitRoot=function(ae,X){this.data=dt([ae,X]),this.data.height=ae.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},ye.prototype._chooseSplitIndex=function(ae,X,re){for(var Q,te,ue,oe,le,me,ne,ct=1/0,je=1/0,We=X;We<=re-X;We++){var Se=K(ae,0,We,this.toBBox),ln=K(ae,We,re,this.toBBox),Bt=(te=Se,ue=ln,void 0,void 0,void 0,void 0,oe=Math.max(te.minX,ue.minX),le=Math.max(te.minY,ue.minY),me=Math.min(te.maxX,ue.maxX),ne=Math.min(te.maxY,ue.maxY),Math.max(0,me-oe)*Math.max(0,ne-le)),$e=Fe(Se)+Fe(ln);Bt<ct?(ct=Bt,Q=We,je=$e<je?$e:je):Bt===ct&&$e<je&&(je=$e,Q=We)}return Q||re-X},ye.prototype._chooseSplitAxis=function(ae,X,re){var Q=ae.leaf?this.compareMinX:Te,te=ae.leaf?this.compareMinY:Pe;this._allDistMargin(ae,X,re,Q)<this._allDistMargin(ae,X,re,te)&&ae.children.sort(Q)},ye.prototype._allDistMargin=function(ae,X,re,Q){ae.children.sort(Q);for(var te=this.toBBox,ue=K(ae,0,X,te),oe=K(ae,re-X,re,te),le=bt(ue)+bt(oe),me=X;me<re-X;me++){var ne=ae.children[me];ge(ue,ae.leaf?te(ne):ne),le+=bt(ue)}for(var ct=re-X-1;ct>=X;ct--){var je=ae.children[ct];ge(oe,ae.leaf?te(je):je),le+=bt(oe)}return le},ye.prototype._adjustParentBBoxes=function(ae,X,re){for(var Q=re;Q>=0;Q--)ge(X[Q],ae)},ye.prototype._condense=function(ae){for(var X=ae.length-1,re=void 0;X>=0;X--)0===ae[X].children.length?X>0?(re=ae[X-1].children).splice(re.indexOf(ae[X]),1):this.clear():p(ae[X],this.toBBox)},ye}()},6952:(Lt,rt,xe)=>{var de=xe(1356),ye=xe(3407),Ce=xe(2e3),p=xe(2342),K=xe(9235),ge=xe(2374),Te=Date.prototype.getTime;function Fe(He){return null==He}function bt(He){return!(!He||"object"!=typeof He||"number"!=typeof He.length||"function"!=typeof He.copy||"function"!=typeof He.slice||He.length>0&&"number"!=typeof He[0])}Lt.exports=function Pe(He,dt,Rt){var ae=Rt||{};return!!(ae.strict?Ce(He,dt):He===dt)||(!He||!dt||"object"!=typeof He&&"object"!=typeof dt?ae.strict?Ce(He,dt):He==dt:function nt(He,dt,Rt){var ae,X;if(typeof He!=typeof dt||Fe(He)||Fe(dt)||He.prototype!==dt.prototype||ye(He)!==ye(dt))return!1;var re=p(He),Q=p(dt);if(re!==Q)return!1;if(re||Q)return He.source===dt.source&&K(He)===K(dt);if(ge(He)&&ge(dt))return Te.call(He)===Te.call(dt);var te=bt(He),ue=bt(dt);if(te!==ue)return!1;if(te||ue){if(He.length!==dt.length)return!1;for(ae=0;ae<He.length;ae++)if(He[ae]!==dt[ae])return!1;return!0}if(typeof He!=typeof dt)return!1;try{var oe=de(He),le=de(dt)}catch{return!1}if(oe.length!==le.length)return!1;for(oe.sort(),le.sort(),ae=oe.length-1;ae>=0;ae--)if(oe[ae]!=le[ae])return!1;for(ae=oe.length-1;ae>=0;ae--)if(!Pe(He[X=oe[ae]],dt[X],Rt))return!1;return!0}(He,dt,ae))}},2358:(Lt,rt,xe)=>{"use strict";var de=xe(1356),ye="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Ce=Object.prototype.toString,p=Array.prototype.concat,K=Object.defineProperty,Te=xe(7027)(),Pe=K&&Te,Fe=function(nt,He,dt,Rt){if(He in nt)if(!0===Rt){if(nt[He]===dt)return}else if(!function(nt){return"function"==typeof nt&&"[object Function]"===Ce.call(nt)}(Rt)||!Rt())return;Pe?K(nt,He,{configurable:!0,enumerable:!1,value:dt,writable:!0}):nt[He]=dt},bt=function(nt,He){var dt=arguments.length>2?arguments[2]:{},Rt=de(He);ye&&(Rt=p.call(Rt,Object.getOwnPropertySymbols(He)));for(var ae=0;ae<Rt.length;ae+=1)Fe(nt,Rt[ae],He[Rt[ae]],dt[Rt[ae]])};bt.supportsDescriptors=!!Pe,Lt.exports=bt},1817:Lt=>{function rt(xe,de,ye,Ce){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(xe,de,ye,Ce)}rt.prototype.run=function(xe,de,ye,Ce){this._init(xe,de,ye,Ce);for(var p=0;p<this._datasetLength;p++)if(1!==this._visited[p]){this._visited[p]=1;var K=this._regionQuery(p);if(K.length<this.minPts)this.noise.push(p);else{var ge=this.clusters.length;this.clusters.push([]),this._addToCluster(p,ge),this._expandCluster(ge,K)}}return this.clusters},rt.prototype._init=function(xe,de,ye,Ce){if(xe){if(!(xe instanceof Array))throw Error("Dataset must be of type array, "+typeof xe+" given");this.dataset=xe,this.clusters=[],this.noise=[],this._datasetLength=xe.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}de&&(this.epsilon=de),ye&&(this.minPts=ye),Ce&&(this.distance=Ce)},rt.prototype._expandCluster=function(xe,de){for(var ye=0;ye<de.length;ye++){var Ce=de[ye];if(1!==this._visited[Ce]){this._visited[Ce]=1;var p=this._regionQuery(Ce);p.length>=this.minPts&&(de=this._mergeArrays(de,p))}1!==this._assigned[Ce]&&this._addToCluster(Ce,xe)}},rt.prototype._addToCluster=function(xe,de){this.clusters[de].push(xe),this._assigned[xe]=1},rt.prototype._regionQuery=function(xe){for(var de=[],ye=0;ye<this._datasetLength;ye++)this.distance(this.dataset[xe],this.dataset[ye])<this.epsilon&&de.push(ye);return de},rt.prototype._mergeArrays=function(xe,de){for(var ye=de.length,Ce=0;Ce<ye;Ce++){var p=de[Ce];xe.indexOf(p)<0&&xe.push(p)}return xe},rt.prototype._euclideanDistance=function(xe,de){for(var ye=0,Ce=Math.min(xe.length,de.length);Ce--;)ye+=(xe[Ce]-de[Ce])*(xe[Ce]-de[Ce]);return Math.sqrt(ye)},Lt.exports&&(Lt.exports=rt)},4273:Lt=>{function rt(xe,de,ye){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(xe,de,ye)}rt.prototype.init=function(xe,de,ye){this.assignments=[],this.centroids=[],typeof xe<"u"&&(this.dataset=xe),typeof de<"u"&&(this.k=de),typeof ye<"u"&&(this.distance=ye)},rt.prototype.run=function(xe,de){this.init(xe,de);for(var ye=this.dataset.length,Ce=0;Ce<this.k;Ce++)this.centroids[Ce]=this.randomCentroid();for(var p=!0;p;){p=this.assign();for(var K=0;K<this.k;K++){for(var ge=new Array(bt),Te=0,Pe=0;Pe<bt;Pe++)ge[Pe]=0;for(var Fe=0;Fe<ye;Fe++){var bt=this.dataset[Fe].length;if(K===this.assignments[Fe]){for(Pe=0;Pe<bt;Pe++)ge[Pe]+=this.dataset[Fe][Pe];Te++}}if(Te>0){for(Pe=0;Pe<bt;Pe++)ge[Pe]/=Te;this.centroids[K]=ge}else this.centroids[K]=this.randomCentroid(),p=!0}}return this.getClusters()},rt.prototype.randomCentroid=function(){var de,ye,xe=this.dataset.length-1;do{ye=Math.round(Math.random()*xe),de=this.dataset[ye]}while(this.centroids.indexOf(de)>=0);return de},rt.prototype.assign=function(){for(var ye,xe=!1,de=this.dataset.length,Ce=0;Ce<de;Ce++)(ye=this.argmin(this.dataset[Ce],this.centroids,this.distance))!=this.assignments[Ce]&&(this.assignments[Ce]=ye,xe=!0);return xe},rt.prototype.getClusters=function(){for(var de,xe=new Array(this.k),ye=0;ye<this.assignments.length;ye++)typeof xe[de=this.assignments[ye]]>"u"&&(xe[de]=[]),xe[de].push(ye);return xe},rt.prototype.argmin=function(xe,de,ye){for(var ge,Ce=Number.MAX_VALUE,p=0,K=de.length,Te=0;Te<K;Te++)(ge=ye(xe,de[Te]))<Ce&&(Ce=ge,p=Te);return p},rt.prototype.distance=function(xe,de){for(var ye=0,Ce=Math.min(xe.length,de.length);Ce--;){var p=xe[Ce]-de[Ce];ye+=p*p}return Math.sqrt(ye)},Lt.exports&&(Lt.exports=rt)},8680:(Lt,rt,xe)=>{if(Lt.exports)var de=xe(8759);function ye(Ce,p,K,ge){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(Ce,p,K,ge)}ye.prototype.run=function(Ce,p,K,ge){this._init(Ce,p,K,ge);for(var Te=0,Pe=this.dataset.length;Te<Pe;Te++)if(1!==this._processed[Te]){this._processed[Te]=1,this.clusters.push([Te]);var Fe=this.clusters.length-1;this._orderedList.push(Te);var bt=new de(null,null,"asc"),nt=this._regionQuery(Te);void 0!==this._distanceToCore(Te)&&(this._updateQueue(Te,nt,bt),this._expandCluster(Fe,bt))}return this.clusters},ye.prototype.getReachabilityPlot=function(){for(var Ce=[],p=0,K=this._orderedList.length;p<K;p++){var ge=this._orderedList[p];Ce.push([ge,this._reachability[ge]])}return Ce},ye.prototype._init=function(Ce,p,K,ge){if(Ce){if(!(Ce instanceof Array))throw Error("Dataset must be of type array, "+typeof Ce+" given");this.dataset=Ce,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}p&&(this.epsilon=p),K&&(this.minPts=K),ge&&(this.distance=ge)},ye.prototype._updateQueue=function(Ce,p,K){var ge=this;this._coreDistance=this._distanceToCore(Ce),p.forEach(function(Te){if(void 0===ge._processed[Te]){var Pe=ge.distance(ge.dataset[Ce],ge.dataset[Te]),Fe=Math.max(ge._coreDistance,Pe);void 0===ge._reachability[Te]?(ge._reachability[Te]=Fe,K.insert(Te,Fe)):Fe<ge._reachability[Te]&&(ge._reachability[Te]=Fe,K.remove(Te),K.insert(Te,Fe))}})},ye.prototype._expandCluster=function(Ce,p){for(var K=p.getElements(),ge=0,Te=K.length;ge<Te;ge++){var Pe=K[ge];if(void 0===this._processed[Pe]){var Fe=this._regionQuery(Pe);this._processed[Pe]=1,this.clusters[Ce].push(Pe),this._orderedList.push(Pe),void 0!==this._distanceToCore(Pe)&&(this._updateQueue(Pe,Fe,p),this._expandCluster(Ce,p))}}},ye.prototype._distanceToCore=function(Ce){for(var p=this.epsilon,K=0;K<p;K++)if(this._regionQuery(Ce,K).length>=this.minPts)return K},ye.prototype._regionQuery=function(Ce,p){p=p||this.epsilon;for(var K=[],ge=0,Te=this.dataset.length;ge<Te;ge++)this.distance(this.dataset[Ce],this.dataset[ge])<p&&K.push(ge);return K},ye.prototype._euclideanDistance=function(Ce,p){for(var K=0,ge=Math.min(Ce.length,p.length);ge--;)K+=(Ce[ge]-p[ge])*(Ce[ge]-p[ge]);return Math.sqrt(K)},Lt.exports&&(Lt.exports=ye)},8759:Lt=>{function rt(xe,de,ye){this._queue=[],this._priorities=[],this._sorting="desc",this._init(xe,de,ye)}rt.prototype.insert=function(xe,de){for(var ye=this._queue.length,Ce=ye;Ce--;){var p=this._priorities[Ce];"desc"===this._sorting?de>p&&(ye=Ce):de<p&&(ye=Ce)}this._insertAt(xe,de,ye)},rt.prototype.remove=function(xe){for(var de=this._queue.length;de--;)if(xe===this._queue[de]){this._queue.splice(de,1),this._priorities.splice(de,1);break}},rt.prototype.forEach=function(xe){this._queue.forEach(xe)},rt.prototype.getElements=function(){return this._queue},rt.prototype.getElementPriority=function(xe){return this._priorities[xe]},rt.prototype.getPriorities=function(){return this._priorities},rt.prototype.getElementsWithPriorities=function(){for(var xe=[],de=0,ye=this._queue.length;de<ye;de++)xe.push([this._queue[de],this._priorities[de]]);return xe},rt.prototype._init=function(xe,de,ye){if(xe&&de){if(this._queue=[],this._priorities=[],xe.length!==de.length)throw new Error("Arrays must have the same length");for(var Ce=0;Ce<xe.length;Ce++)this.insert(xe[Ce],de[Ce])}ye&&(this._sorting=ye)},rt.prototype._insertAt=function(xe,de,ye){this._queue.length===ye?(this._queue.push(xe),this._priorities.push(de)):(this._queue.splice(ye,0,xe),this._priorities.splice(ye,0,de))},Lt.exports&&(Lt.exports=rt)},7470:(Lt,rt,xe)=>{Lt.exports&&(Lt.exports={DBSCAN:xe(1817),KMEANS:xe(4273),OPTICS:xe(8680),PriorityQueue:xe(8759)})},5469:Lt=>{"use strict";function rt($e,Tt,Xe){Xe=Xe||2;var $t,pn,At,Sn,Yn,Kn,pr,gt=Tt&&Tt.length,xt=gt?Tt[0]*Xe:$e.length,Be=xe($e,0,xt,Xe,!0),qt=[];if(!Be||Be.next===Be.prev)return qt;if(gt&&(Be=function Te($e,Tt,Xe,gt){var Be,qt,At,xt=[];for(Be=0,qt=Tt.length;Be<qt;Be++)(At=xe($e,Tt[Be]*gt,Be<qt-1?Tt[Be+1]*gt:$e.length,gt,!1))===At.next&&(At.steiner=!0),xt.push(ae(At));for(xt.sort(Pe),Be=0;Be<xt.length;Be++)Xe=Fe(xt[Be],Xe);return Xe}($e,Tt,Be,Xe)),$e.length>80*Xe){$t=At=$e[0],pn=Sn=$e[1];for(var Un=Xe;Un<xt;Un+=Xe)(Yn=$e[Un])<$t&&($t=Yn),(Kn=$e[Un+1])<pn&&(pn=Kn),Yn>At&&(At=Yn),Kn>Sn&&(Sn=Kn);pr=0!==(pr=Math.max(At-$t,Sn-pn))?32767/pr:0}return ye(Be,qt,Xe,$t,pn,pr,0),qt}function xe($e,Tt,Xe,gt,xt){var Be,qt;if(xt===Bt($e,Tt,Xe,gt)>0)for(Be=Tt;Be<Xe;Be+=gt)qt=We(Be,$e[Be],$e[Be+1],qt);else for(Be=Xe-gt;Be>=Tt;Be-=gt)qt=We(Be,$e[Be],$e[Be+1],qt);return qt&&te(qt,qt.next)&&(Se(qt),qt=qt.next),qt}function de($e,Tt){if(!$e)return $e;Tt||(Tt=$e);var gt,Xe=$e;do{if(gt=!1,Xe.steiner||!te(Xe,Xe.next)&&0!==Q(Xe.prev,Xe,Xe.next))Xe=Xe.next;else{if(Se(Xe),(Xe=Tt=Xe.prev)===Xe.next)break;gt=!0}}while(gt||Xe!==Tt);return Tt}function ye($e,Tt,Xe,gt,xt,Be,qt){if($e){!qt&&Be&&function He($e,Tt,Xe,gt){var xt=$e;do{0===xt.z&&(xt.z=Rt(xt.x,xt.y,Tt,Xe,gt)),xt.prevZ=xt.prev,xt.nextZ=xt.next,xt=xt.next}while(xt!==$e);xt.prevZ.nextZ=null,xt.prevZ=null,function dt($e){var Tt,Xe,gt,xt,Be,qt,$t,pn,At=1;do{for(Xe=$e,$e=null,Be=null,qt=0;Xe;){for(qt++,gt=Xe,$t=0,Tt=0;Tt<At&&($t++,gt=gt.nextZ);Tt++);for(pn=At;$t>0||pn>0&&gt;)0!==$t&&(0===pn||!gt||Xe.z<=gt.z)?(xt=Xe,Xe=Xe.nextZ,$t--):(xt=gt,gt=gt.nextZ,pn--),Be?Be.nextZ=xt:$e=xt,xt.prevZ=Be,Be=xt;Xe=gt}Be.nextZ=null,At*=2}while(qt>1)}(xt)}($e,gt,xt,Be);for(var pn,At,$t=$e;$e.prev!==$e.next;)if(pn=$e.prev,At=$e.next,Be?p($e,gt,xt,Be):Ce($e))Tt.push(pn.i/Xe|0),Tt.push($e.i/Xe|0),Tt.push(At.i/Xe|0),Se($e),$e=At.next,$t=At.next;else if(($e=At)===$t){qt?1===qt?ye($e=K(de($e),Tt,Xe),Tt,Xe,gt,xt,Be,2):2===qt&&ge($e,Tt,Xe,gt,xt,Be):ye(de($e),Tt,Xe,gt,xt,Be,1);break}}}function Ce($e){var Tt=$e.prev,Xe=$e,gt=$e.next;if(Q(Tt,Xe,gt)>=0)return!1;for(var xt=Tt.x,Be=Xe.x,qt=gt.x,$t=Tt.y,pn=Xe.y,At=gt.y,Sn=xt<Be?xt<qt?xt:qt:Be<qt?Be:qt,Yn=$t<pn?$t<At?$t:At:pn<At?pn:At,Kn=xt>Be?xt>qt?xt:qt:Be>qt?Be:qt,pr=$t>pn?$t>At?$t:At:pn>At?pn:At,Un=gt.next;Un!==Tt;){if(Un.x>=Sn&&Un.x<=Kn&&Un.y>=Yn&&Un.y<=pr&&X(xt,$t,Be,pn,qt,At,Un.x,Un.y)&&Q(Un.prev,Un,Un.next)>=0)return!1;Un=Un.next}return!0}function p($e,Tt,Xe,gt){var xt=$e.prev,Be=$e,qt=$e.next;if(Q(xt,Be,qt)>=0)return!1;for(var $t=xt.x,pn=Be.x,At=qt.x,Sn=xt.y,Yn=Be.y,Kn=qt.y,pr=$t<pn?$t<At?$t:At:pn<At?pn:At,Un=Sn<Yn?Sn<Kn?Sn:Kn:Yn<Kn?Yn:Kn,Rn=$t>pn?$t>At?$t:At:pn>At?pn:At,Jn=Sn>Yn?Sn>Kn?Sn:Kn:Yn>Kn?Yn:Kn,Ei=Rt(pr,Un,Tt,Xe,gt),Ai=Rt(Rn,Jn,Tt,Xe,gt),Sr=$e.prevZ,zr=$e.nextZ;Sr&&Sr.z>=Ei&&zr&&zr.z<=Ai;){if(Sr.x>=pr&&Sr.x<=Rn&&Sr.y>=Un&&Sr.y<=Jn&&Sr!==xt&&Sr!==qt&&X($t,Sn,pn,Yn,At,Kn,Sr.x,Sr.y)&&Q(Sr.prev,Sr,Sr.next)>=0||(Sr=Sr.prevZ,zr.x>=pr&&zr.x<=Rn&&zr.y>=Un&&zr.y<=Jn&&zr!==xt&&zr!==qt&&X($t,Sn,pn,Yn,At,Kn,zr.x,zr.y)&&Q(zr.prev,zr,zr.next)>=0))return!1;zr=zr.nextZ}for(;Sr&&Sr.z>=Ei;){if(Sr.x>=pr&&Sr.x<=Rn&&Sr.y>=Un&&Sr.y<=Jn&&Sr!==xt&&Sr!==qt&&X($t,Sn,pn,Yn,At,Kn,Sr.x,Sr.y)&&Q(Sr.prev,Sr,Sr.next)>=0)return!1;Sr=Sr.prevZ}for(;zr&&zr.z<=Ai;){if(zr.x>=pr&&zr.x<=Rn&&zr.y>=Un&&zr.y<=Jn&&zr!==xt&&zr!==qt&&X($t,Sn,pn,Yn,At,Kn,zr.x,zr.y)&&Q(zr.prev,zr,zr.next)>=0)return!1;zr=zr.nextZ}return!0}function K($e,Tt,Xe){var gt=$e;do{var xt=gt.prev,Be=gt.next.next;!te(xt,Be)&&ue(xt,gt,gt.next,Be)&&ne(xt,Be)&&ne(Be,xt)&&(Tt.push(xt.i/Xe|0),Tt.push(gt.i/Xe|0),Tt.push(Be.i/Xe|0),Se(gt),Se(gt.next),gt=$e=Be),gt=gt.next}while(gt!==$e);return de(gt)}function ge($e,Tt,Xe,gt,xt,Be){var qt=$e;do{for(var $t=qt.next.next;$t!==qt.prev;){if(qt.i!==$t.i&&re(qt,$t)){var pn=je(qt,$t);return qt=de(qt,qt.next),pn=de(pn,pn.next),ye(qt,Tt,Xe,gt,xt,Be,0),void ye(pn,Tt,Xe,gt,xt,Be,0)}$t=$t.next}qt=qt.next}while(qt!==$e)}function Pe($e,Tt){return $e.x-Tt.x}function Fe($e,Tt){var Xe=function bt($e,Tt){var qt,Xe=Tt,gt=$e.x,xt=$e.y,Be=-1/0;do{if(xt<=Xe.y&&xt>=Xe.next.y&&Xe.next.y!==Xe.y){var $t=Xe.x+(xt-Xe.y)*(Xe.next.x-Xe.x)/(Xe.next.y-Xe.y);if($t<=gt&&$t>Be&&(Be=$t,qt=Xe.x<Xe.next.x?Xe:Xe.next,$t===gt))return qt}Xe=Xe.next}while(Xe!==Tt);if(!qt)return null;var Kn,pn=qt,At=qt.x,Sn=qt.y,Yn=1/0;Xe=qt;do{gt>=Xe.x&&Xe.x>=At&&gt!==Xe.x&&X(xt<Sn?gt:Be,xt,At,Sn,xt<Sn?Be:gt,xt,Xe.x,Xe.y)&&(Kn=Math.abs(xt-Xe.y)/(gt-Xe.x),ne(Xe,$e)&&(Kn<Yn||Kn===Yn&&(Xe.x>qt.x||Xe.x===qt.x&&nt(qt,Xe)))&&(qt=Xe,Yn=Kn)),Xe=Xe.next}while(Xe!==pn);return qt}($e,Tt);if(!Xe)return Tt;var gt=je(Xe,$e);return de(gt,gt.next),de(Xe,Xe.next)}function nt($e,Tt){return Q($e.prev,$e,Tt.prev)<0&&Q(Tt.next,$e,$e.next)<0}function Rt($e,Tt,Xe,gt,xt){return($e=1431655765&(($e=858993459&(($e=252645135&(($e=16711935&(($e=($e-Xe)*xt|0)|$e<<8))|$e<<4))|$e<<2))|$e<<1))|(Tt=1431655765&((Tt=858993459&((Tt=252645135&((Tt=16711935&((Tt=(Tt-gt)*xt|0)|Tt<<8))|Tt<<4))|Tt<<2))|Tt<<1))<<1}function ae($e){var Tt=$e,Xe=$e;do{(Tt.x<Xe.x||Tt.x===Xe.x&&Tt.y<Xe.y)&&(Xe=Tt),Tt=Tt.next}while(Tt!==$e);return Xe}function X($e,Tt,Xe,gt,xt,Be,qt,$t){return(xt-qt)*(Tt-$t)>=($e-qt)*(Be-$t)&&($e-qt)*(gt-$t)>=(Xe-qt)*(Tt-$t)&&(Xe-qt)*(Be-$t)>=(xt-qt)*(gt-$t)}function re($e,Tt){return $e.next.i!==Tt.i&&$e.prev.i!==Tt.i&&!function me($e,Tt){var Xe=$e;do{if(Xe.i!==$e.i&&Xe.next.i!==$e.i&&Xe.i!==Tt.i&&Xe.next.i!==Tt.i&&ue(Xe,Xe.next,$e,Tt))return!0;Xe=Xe.next}while(Xe!==$e);return!1}($e,Tt)&&(ne($e,Tt)&&ne(Tt,$e)&&function ct($e,Tt){var Xe=$e,gt=!1,xt=($e.x+Tt.x)/2,Be=($e.y+Tt.y)/2;do{Xe.y>Be!=Xe.next.y>Be&&Xe.next.y!==Xe.y&&xt<(Xe.next.x-Xe.x)*(Be-Xe.y)/(Xe.next.y-Xe.y)+Xe.x&&(gt=!gt),Xe=Xe.next}while(Xe!==$e);return gt}($e,Tt)&&(Q($e.prev,$e,Tt.prev)||Q($e,Tt.prev,Tt))||te($e,Tt)&&Q($e.prev,$e,$e.next)>0&&Q(Tt.prev,Tt,Tt.next)>0)}function Q($e,Tt,Xe){return(Tt.y-$e.y)*(Xe.x-Tt.x)-(Tt.x-$e.x)*(Xe.y-Tt.y)}function te($e,Tt){return $e.x===Tt.x&&$e.y===Tt.y}function ue($e,Tt,Xe,gt){var xt=le(Q($e,Tt,Xe)),Be=le(Q($e,Tt,gt)),qt=le(Q(Xe,gt,$e)),$t=le(Q(Xe,gt,Tt));return!!(xt!==Be&&qt!==$t||0===xt&&oe($e,Xe,Tt)||0===Be&&oe($e,gt,Tt)||0===qt&&oe(Xe,$e,gt)||0===$t&&oe(Xe,Tt,gt))}function oe($e,Tt,Xe){return Tt.x<=Math.max($e.x,Xe.x)&&Tt.x>=Math.min($e.x,Xe.x)&&Tt.y<=Math.max($e.y,Xe.y)&&Tt.y>=Math.min($e.y,Xe.y)}function le($e){return $e>0?1:$e<0?-1:0}function ne($e,Tt){return Q($e.prev,$e,$e.next)<0?Q($e,Tt,$e.next)>=0&&Q($e,$e.prev,Tt)>=0:Q($e,Tt,$e.prev)<0||Q($e,$e.next,Tt)<0}function je($e,Tt){var Xe=new ln($e.i,$e.x,$e.y),gt=new ln(Tt.i,Tt.x,Tt.y),xt=$e.next,Be=Tt.prev;return $e.next=Tt,Tt.prev=$e,Xe.next=xt,xt.prev=Xe,gt.next=Xe,Xe.prev=gt,Be.next=gt,gt.prev=Be,gt}function We($e,Tt,Xe,gt){var xt=new ln($e,Tt,Xe);return gt?(xt.next=gt.next,xt.prev=gt,gt.next.prev=xt,gt.next=xt):(xt.prev=xt,xt.next=xt),xt}function Se($e){$e.next.prev=$e.prev,$e.prev.next=$e.next,$e.prevZ&&($e.prevZ.nextZ=$e.nextZ),$e.nextZ&&($e.nextZ.prevZ=$e.prevZ)}function ln($e,Tt,Xe){this.i=$e,this.x=Tt,this.y=Xe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bt($e,Tt,Xe,gt){for(var xt=0,Be=Tt,qt=Xe-gt;Be<Xe;Be+=gt)xt+=($e[qt]-$e[Be])*($e[Be+1]+$e[qt+1]),qt=Be;return xt}Lt.exports=rt,Lt.exports.default=rt,rt.deviation=function($e,Tt,Xe,gt){var xt=Tt&&Tt.length,qt=Math.abs(Bt($e,0,xt?Tt[0]*Xe:$e.length,Xe));if(xt)for(var $t=0,pn=Tt.length;$t<pn;$t++)qt-=Math.abs(Bt($e,Tt[$t]*Xe,$t<pn-1?Tt[$t+1]*Xe:$e.length,Xe));var Yn=0;for($t=0;$t<gt.length;$t+=3){var Kn=gt[$t]*Xe,pr=gt[$t+1]*Xe,Un=gt[$t+2]*Xe;Yn+=Math.abs(($e[Kn]-$e[Un])*($e[pr+1]-$e[Kn+1])-($e[Kn]-$e[pr])*($e[Un+1]-$e[Kn+1]))}return 0===qt&&0===Yn?0:Math.abs((Yn-qt)/qt)},rt.flatten=function($e){for(var Tt=$e[0][0].length,Xe={vertices:[],holes:[],dimensions:Tt},gt=0,xt=0;xt<$e.length;xt++){for(var Be=0;Be<$e[xt].length;Be++)for(var qt=0;qt<Tt;qt++)Xe.vertices.push($e[xt][Be][qt]);xt>0&&Xe.holes.push(gt+=$e[xt-1].length)}return Xe}},9069:Lt=>{"use strict";var de,rt="object"==typeof Reflect?Reflect:null,xe=rt&&"function"==typeof rt.apply?rt.apply:function(ue,oe,le){return Function.prototype.apply.call(ue,oe,le)};de=rt&&"function"==typeof rt.ownKeys?rt.ownKeys:Object.getOwnPropertySymbols?function(ue){return Object.getOwnPropertyNames(ue).concat(Object.getOwnPropertySymbols(ue))}:function(ue){return Object.getOwnPropertyNames(ue)};var Ce=Number.isNaN||function(ue){return ue!=ue};function p(){p.init.call(this)}Lt.exports=p,Lt.exports.once=function X(te,ue){return new Promise(function(oe,le){function me(ct){te.removeListener(ue,ne),le(ct)}function ne(){"function"==typeof te.removeListener&&te.removeListener("error",me),oe([].slice.call(arguments))}Q(te,ue,ne,{once:!0}),"error"!==ue&&function re(te,ue,oe){"function"==typeof te.on&&Q(te,"error",ue,oe)}(te,me,{once:!0})})},p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var K=10;function ge(te){if("function"!=typeof te)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof te)}function Te(te){return void 0===te._maxListeners?p.defaultMaxListeners:te._maxListeners}function Pe(te,ue,oe,le){var me,ne,ct;if(ge(oe),void 0===(ne=te._events)?(ne=te._events=Object.create(null),te._eventsCount=0):(void 0!==ne.newListener&&(te.emit("newListener",ue,oe.listener?oe.listener:oe),ne=te._events),ct=ne[ue]),void 0===ct)ct=ne[ue]=oe,++te._eventsCount;else if("function"==typeof ct?ct=ne[ue]=le?[oe,ct]:[ct,oe]:le?ct.unshift(oe):ct.push(oe),(me=Te(te))>0&&ct.length>me&&!ct.warned){ct.warned=!0;var je=new Error("Possible EventEmitter memory leak detected. "+ct.length+" "+String(ue)+" listeners added. Use emitter.setMaxListeners() to increase limit");je.name="MaxListenersExceededWarning",je.emitter=te,je.type=ue,je.count=ct.length,function ye(te){console&&console.warn&&console.warn(te)}(je)}return te}function Fe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bt(te,ue,oe){var le={fired:!1,wrapFn:void 0,target:te,type:ue,listener:oe},me=Fe.bind(le);return me.listener=oe,le.wrapFn=me,me}function nt(te,ue,oe){var le=te._events;if(void 0===le)return[];var me=le[ue];return void 0===me?[]:"function"==typeof me?oe?[me.listener||me]:[me]:oe?function ae(te){for(var ue=new Array(te.length),oe=0;oe<ue.length;++oe)ue[oe]=te[oe].listener||te[oe];return ue}(me):dt(me,me.length)}function He(te){var ue=this._events;if(void 0!==ue){var oe=ue[te];if("function"==typeof oe)return 1;if(void 0!==oe)return oe.length}return 0}function dt(te,ue){for(var oe=new Array(ue),le=0;le<ue;++le)oe[le]=te[le];return oe}function Q(te,ue,oe,le){if("function"==typeof te.on)le.once?te.once(ue,oe):te.on(ue,oe);else{if("function"!=typeof te.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof te);te.addEventListener(ue,function me(ne){le.once&&te.removeEventListener(ue,me),oe(ne)})}}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return K},set:function(te){if("number"!=typeof te||te<0||Ce(te))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+te+".");K=te}}),p.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(ue){if("number"!=typeof ue||ue<0||Ce(ue))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ue+".");return this._maxListeners=ue,this},p.prototype.getMaxListeners=function(){return Te(this)},p.prototype.emit=function(ue){for(var oe=[],le=1;le<arguments.length;le++)oe.push(arguments[le]);var me="error"===ue,ne=this._events;if(void 0!==ne)me=me&&void 0===ne.error;else if(!me)return!1;if(me){var ct;if(oe.length>0&&(ct=oe[0]),ct instanceof Error)throw ct;var je=new Error("Unhandled error."+(ct?" ("+ct.message+")":""));throw je.context=ct,je}var We=ne[ue];if(void 0===We)return!1;if("function"==typeof We)xe(We,this,oe);else{var Se=We.length,ln=dt(We,Se);for(le=0;le<Se;++le)xe(ln[le],this,oe)}return!0},p.prototype.on=p.prototype.addListener=function(ue,oe){return Pe(this,ue,oe,!1)},p.prototype.prependListener=function(ue,oe){return Pe(this,ue,oe,!0)},p.prototype.once=function(ue,oe){return ge(oe),this.on(ue,bt(this,ue,oe)),this},p.prototype.prependOnceListener=function(ue,oe){return ge(oe),this.prependListener(ue,bt(this,ue,oe)),this},p.prototype.off=p.prototype.removeListener=function(ue,oe){var le,me,ne,ct,je;if(ge(oe),void 0===(me=this._events))return this;if(void 0===(le=me[ue]))return this;if(le===oe||le.listener===oe)0==--this._eventsCount?this._events=Object.create(null):(delete me[ue],me.removeListener&&this.emit("removeListener",ue,le.listener||oe));else if("function"!=typeof le){for(ne=-1,ct=le.length-1;ct>=0;ct--)if(le[ct]===oe||le[ct].listener===oe){je=le[ct].listener,ne=ct;break}if(ne<0)return this;0===ne?le.shift():function Rt(te,ue){for(;ue+1<te.length;ue++)te[ue]=te[ue+1];te.pop()}(le,ne),1===le.length&&(me[ue]=le[0]),void 0!==me.removeListener&&this.emit("removeListener",ue,je||oe)}return this},p.prototype.removeAllListeners=function(ue){var oe,le,me;if(void 0===(le=this._events))return this;if(void 0===le.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==le[ue]&&(0==--this._eventsCount?this._events=Object.create(null):delete le[ue]),this;if(0===arguments.length){var ct,ne=Object.keys(le);for(me=0;me<ne.length;++me)"removeListener"!==(ct=ne[me])&&this.removeAllListeners(ct);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(oe=le[ue]))this.removeListener(ue,oe);else if(void 0!==oe)for(me=oe.length-1;me>=0;me--)this.removeListener(ue,oe[me]);return this},p.prototype.listeners=function(ue){return nt(this,ue,!0)},p.prototype.rawListeners=function(ue){return nt(this,ue,!1)},p.listenerCount=function(te,ue){return"function"==typeof te.listenerCount?te.listenerCount(ue):He.call(te,ue)},p.prototype.listenerCount=He,p.prototype.eventNames=function(){return this._eventsCount>0?de(this._events):[]}},3457:Lt=>{"use strict";var rt="Function.prototype.bind called on incompatible ",xe=Array.prototype.slice,de=Object.prototype.toString,ye="[object Function]";Lt.exports=function(p){var K=this;if("function"!=typeof K||de.call(K)!==ye)throw new TypeError(rt+K);for(var Te,ge=xe.call(arguments,1),Pe=function(){if(this instanceof Te){var dt=K.apply(this,ge.concat(xe.call(arguments)));return Object(dt)===dt?dt:this}return K.apply(p,ge.concat(xe.call(arguments)))},Fe=Math.max(0,K.length-ge.length),bt=[],nt=0;nt<Fe;nt++)bt.push("$"+nt);if(Te=Function("binder","return function ("+bt.join(",")+"){ return binder.apply(this,arguments); }")(Pe),K.prototype){var He=function(){};He.prototype=K.prototype,Te.prototype=new He,He.prototype=null}return Te}},4444:(Lt,rt,xe)=>{"use strict";var de=xe(3457);Lt.exports=Function.prototype.bind||de},9582:Lt=>{"use strict";var rt=function(){return"string"==typeof function(){}.name},xe=Object.getOwnPropertyDescriptor;if(xe)try{xe([],"length")}catch{xe=null}rt.functionsHaveConfigurableNames=function(){if(!rt()||!xe)return!1;var Ce=xe(function(){},"name");return!!Ce&&!!Ce.configurable};var de=Function.prototype.bind;rt.boundFunctionsHaveNames=function(){return rt()&&"function"==typeof de&&""!==function(){}.bind().name},Lt.exports=rt},5780:Lt=>{var xe;Lt.exports=xe={},xe.simpleFilter=function(de,ye){return ye.filter(function(Ce){return xe.test(de,Ce)})},xe.test=function(de,ye){return null!==xe.match(de,ye)},xe.match=function(de,ye,Ce){var He,p=0,K=[],ge=ye.length,Te=0,Pe=0,Fe=(Ce=Ce||{}).pre||"",bt=Ce.post||"",nt=Ce.caseSensitive&&ye||ye.toLowerCase();de=Ce.caseSensitive&&de||de.toLowerCase();for(var dt=0;dt<ge;dt++)He=ye[dt],nt[dt]===de[p]?(He=Fe+He+bt,p+=1,Pe+=1+Pe):Pe=0,Te+=Pe,K[K.length]=He;return p===de.length?(Te=nt===de?1/0:Te,{rendered:K.join(""),score:Te}):null},xe.filter=function(de,ye,Ce){return ye&&0!==ye.length?"string"!=typeof de?ye:(Ce=Ce||{},ye.reduce(function(p,K,ge,Te){var Pe=K;Ce.extract&&(Pe=Ce.extract(K));var Fe=xe.match(de,Pe,Ce);return null!=Fe&&(p[p.length]={string:Fe.rendered,score:Fe.score,index:ge,original:K}),p},[]).sort(function(p,K){return K.score-p.score||p.index-K.index})):[]}},5013:(Lt,rt,xe)=>{var de=xe(6952),ye=function(ge){this.precision=ge&&ge.precision?ge.precision:17,this.direction=!(!ge||!ge.direction)&&ge.direction,this.pseudoNode=!(!ge||!ge.pseudoNode)&&ge.pseudoNode,this.objectComparator=ge&&ge.objectComparator?ge.objectComparator:K};function Ce(ge){return ge.coordinates.map(function(Te){return{type:ge.type.replace("Multi",""),coordinates:Te}})}function p(ge,Te){return ge.hasOwnProperty("coordinates")?ge.coordinates.length===Te.coordinates.length:ge.length===Te.length}function K(ge,Te){return de(ge,Te,{strict:!0})}ye.prototype.compare=function(ge,Te){if(ge.type!==Te.type||!p(ge,Te))return!1;switch(ge.type){case"Point":return this.compareCoord(ge.coordinates,Te.coordinates);case"LineString":return this.compareLine(ge.coordinates,Te.coordinates,0,!1);case"Polygon":return this.comparePolygon(ge,Te);case"Feature":return this.compareFeature(ge,Te);default:if(0===ge.type.indexOf("Multi")){var Pe=this,Fe=Ce(ge),bt=Ce(Te);return Fe.every(function(nt){return this.some(function(He){return Pe.compare(nt,He)})},bt)}}return!1},ye.prototype.compareCoord=function(ge,Te){if(ge.length!==Te.length)return!1;for(var Pe=0;Pe<ge.length;Pe++)if(ge[Pe].toFixed(this.precision)!==Te[Pe].toFixed(this.precision))return!1;return!0},ye.prototype.compareLine=function(ge,Te,Pe,Fe){if(!p(ge,Te))return!1;var bt=this.pseudoNode?ge:this.removePseudo(ge),nt=this.pseudoNode?Te:this.removePseudo(Te);if(!Fe||this.compareCoord(bt[0],nt[0])||(nt=this.fixStartIndex(nt,bt))){var He=this.compareCoord(bt[Pe],nt[Pe]);return this.direction||He?this.comparePath(bt,nt):!!this.compareCoord(bt[Pe],nt[nt.length-(1+Pe)])&&this.comparePath(bt.slice().reverse(),nt)}},ye.prototype.fixStartIndex=function(ge,Te){for(var Pe,Fe=-1,bt=0;bt<ge.length;bt++)if(this.compareCoord(ge[bt],Te[0])){Fe=bt;break}return Fe>=0&&(Pe=[].concat(ge.slice(Fe,ge.length),ge.slice(1,Fe+1))),Pe},ye.prototype.comparePath=function(ge,Te){var Pe=this;return ge.every(function(Fe,bt){return Pe.compareCoord(Fe,this[bt])},Te)},ye.prototype.comparePolygon=function(ge,Te){if(this.compareLine(ge.coordinates[0],Te.coordinates[0],1,!0)){var Pe=ge.coordinates.slice(1,ge.coordinates.length),Fe=Te.coordinates.slice(1,Te.coordinates.length),bt=this;return Pe.every(function(nt){return this.some(function(He){return bt.compareLine(nt,He,1,!0)})},Fe)}return!1},ye.prototype.compareFeature=function(ge,Te){return!(ge.id!==Te.id||!this.objectComparator(ge.properties,Te.properties)||!this.compareBBox(ge,Te))&&this.compare(ge.geometry,Te.geometry)},ye.prototype.compareBBox=function(ge,Te){return!!(!ge.bbox&&!Te.bbox||ge.bbox&&Te.bbox&&this.compareCoord(ge.bbox,Te.bbox))},ye.prototype.removePseudo=function(ge){return ge},Lt.exports=ye},5406:(Lt,rt,xe)=>{var de=xe(7192),ye=xe(8275),Ce=xe(3269),p=xe(1503).Z,K=Ce.featureEach,Pe=ye.featureCollection;function Fe(bt){var nt=new de(bt);return nt.insert=function(He){if("Feature"!==He.type)throw new Error("invalid feature");return He.bbox=He.bbox?He.bbox:p(He),de.prototype.insert.call(this,He)},nt.load=function(He){var dt=[];return Array.isArray(He)?He.forEach(function(Rt){if("Feature"!==Rt.type)throw new Error("invalid features");Rt.bbox=Rt.bbox?Rt.bbox:p(Rt),dt.push(Rt)}):K(He,function(Rt){if("Feature"!==Rt.type)throw new Error("invalid features");Rt.bbox=Rt.bbox?Rt.bbox:p(Rt),dt.push(Rt)}),de.prototype.load.call(this,dt)},nt.remove=function(He,dt){if("Feature"!==He.type)throw new Error("invalid feature");return He.bbox=He.bbox?He.bbox:p(He),de.prototype.remove.call(this,He,dt)},nt.clear=function(){return de.prototype.clear.call(this)},nt.search=function(He){var dt=de.prototype.search.call(this,this.toBBox(He));return Pe(dt)},nt.collides=function(He){return de.prototype.collides.call(this,this.toBBox(He))},nt.all=function(){var He=de.prototype.all.call(this);return Pe(He)},nt.toJSON=function(){return de.prototype.toJSON.call(this)},nt.fromJSON=function(He){return de.prototype.fromJSON.call(this,He)},nt.toBBox=function(He){var dt;if(He.bbox)dt=He.bbox;else if(Array.isArray(He)&&4===He.length)dt=He;else if(Array.isArray(He)&&6===He.length)dt=[He[0],He[1],He[3],He[4]];else if("Feature"===He.type)dt=p(He);else{if("FeatureCollection"!==He.type)throw new Error("invalid geojson");dt=p(He)}return{minX:dt[0],minY:dt[1],maxX:dt[2],maxY:dt[3]}},nt}Lt.exports=Fe,Lt.exports.default=Fe},7192:function(Lt){Lt.exports=function(){"use strict";function rt(ae,X,re,Q,te){!function ue(oe,le,me,ne,ct){for(;ne>me;){if(ne-me>600){var je=ne-me+1,We=le-me+1,Se=Math.log(je),ln=.5*Math.exp(2*Se/3),Bt=.5*Math.sqrt(Se*ln*(je-ln)/je)*(We-je/2<0?-1:1);ue(oe,le,Math.max(me,Math.floor(le-We*ln/je+Bt)),Math.min(ne,Math.floor(le+(je-We)*ln/je+Bt)),ct)}var Xe=oe[le],gt=me,xt=ne;for(xe(oe,me,le),ct(oe[ne],Xe)>0&&xe(oe,me,ne);gt<xt;){for(xe(oe,gt,xt),gt++,xt--;ct(oe[gt],Xe)<0;)gt++;for(;ct(oe[xt],Xe)>0;)xt--}0===ct(oe[me],Xe)?xe(oe,me,xt):xe(oe,++xt,ne),xt<=le&&(me=xt+1),le<=xt&&(ne=xt-1)}}(ae,X,re||0,Q||ae.length-1,te||de)}function xe(ae,X,re){var Q=ae[X];ae[X]=ae[re],ae[re]=Q}function de(ae,X){return ae<X?-1:ae>X?1:0}var ye=function(ae){void 0===ae&&(ae=9),this._maxEntries=Math.max(4,ae),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function Ce(ae,X,re){if(!re)return X.indexOf(ae);for(var Q=0;Q<X.length;Q++)if(re(ae,X[Q]))return Q;return-1}function p(ae,X){K(ae,0,ae.children.length,X,ae)}function K(ae,X,re,Q,te){te||(te=dt(null)),te.minX=1/0,te.minY=1/0,te.maxX=-1/0,te.maxY=-1/0;for(var ue=X;ue<re;ue++){var oe=ae.children[ue];ge(te,ae.leaf?Q(oe):oe)}return te}function ge(ae,X){return ae.minX=Math.min(ae.minX,X.minX),ae.minY=Math.min(ae.minY,X.minY),ae.maxX=Math.max(ae.maxX,X.maxX),ae.maxY=Math.max(ae.maxY,X.maxY),ae}function Te(ae,X){return ae.minX-X.minX}function Pe(ae,X){return ae.minY-X.minY}function Fe(ae){return(ae.maxX-ae.minX)*(ae.maxY-ae.minY)}function bt(ae){return ae.maxX-ae.minX+(ae.maxY-ae.minY)}function nt(ae,X){return ae.minX<=X.minX&&ae.minY<=X.minY&&X.maxX<=ae.maxX&&X.maxY<=ae.maxY}function He(ae,X){return X.minX<=ae.maxX&&X.minY<=ae.maxY&&X.maxX>=ae.minX&&X.maxY>=ae.minY}function dt(ae){return{children:ae,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Rt(ae,X,re,Q,te){for(var ue=[X,re];ue.length;)if(!((re=ue.pop())-(X=ue.pop())<=Q)){var oe=X+Math.ceil((re-X)/Q/2)*Q;rt(ae,oe,X,re,te),ue.push(X,oe,oe,re)}}return ye.prototype.all=function(){return this._all(this.data,[])},ye.prototype.search=function(ae){var X=this.data,re=[];if(!He(ae,X))return re;for(var Q=this.toBBox,te=[];X;){for(var ue=0;ue<X.children.length;ue++){var oe=X.children[ue],le=X.leaf?Q(oe):oe;He(ae,le)&&(X.leaf?re.push(oe):nt(ae,le)?this._all(oe,re):te.push(oe))}X=te.pop()}return re},ye.prototype.collides=function(ae){var X=this.data;if(!He(ae,X))return!1;for(var re=[];X;){for(var Q=0;Q<X.children.length;Q++){var te=X.children[Q],ue=X.leaf?this.toBBox(te):te;if(He(ae,ue)){if(X.leaf||nt(ae,ue))return!0;re.push(te)}}X=re.pop()}return!1},ye.prototype.load=function(ae){if(!ae||!ae.length)return this;if(ae.length<this._minEntries){for(var X=0;X<ae.length;X++)this.insert(ae[X]);return this}var re=this._build(ae.slice(),0,ae.length-1,0);if(this.data.children.length)if(this.data.height===re.height)this._splitRoot(this.data,re);else{if(this.data.height<re.height){var Q=this.data;this.data=re,re=Q}this._insert(re,this.data.height-re.height-1,!0)}else this.data=re;return this},ye.prototype.insert=function(ae){return ae&&this._insert(ae,this.data.height-1),this},ye.prototype.clear=function(){return this.data=dt([]),this},ye.prototype.remove=function(ae,X){if(!ae)return this;for(var re,Q,te,ue=this.data,oe=this.toBBox(ae),le=[],me=[];ue||le.length;){if(ue||(ue=le.pop(),Q=le[le.length-1],re=me.pop(),te=!0),ue.leaf){var ne=Ce(ae,ue.children,X);if(-1!==ne)return ue.children.splice(ne,1),le.push(ue),this._condense(le),this}te||ue.leaf||!nt(ue,oe)?Q?(re++,ue=Q.children[re],te=!1):ue=null:(le.push(ue),me.push(re),re=0,Q=ue,ue=ue.children[0])}return this},ye.prototype.toBBox=function(ae){return ae},ye.prototype.compareMinX=function(ae,X){return ae.minX-X.minX},ye.prototype.compareMinY=function(ae,X){return ae.minY-X.minY},ye.prototype.toJSON=function(){return this.data},ye.prototype.fromJSON=function(ae){return this.data=ae,this},ye.prototype._all=function(ae,X){for(var re=[];ae;)ae.leaf?X.push.apply(X,ae.children):re.push.apply(re,ae.children),ae=re.pop();return X},ye.prototype._build=function(ae,X,re,Q){var te,ue=re-X+1,oe=this._maxEntries;if(ue<=oe)return p(te=dt(ae.slice(X,re+1)),this.toBBox),te;Q||(Q=Math.ceil(Math.log(ue)/Math.log(oe)),oe=Math.ceil(ue/Math.pow(oe,Q-1))),(te=dt([])).leaf=!1,te.height=Q;var le=Math.ceil(ue/oe),me=le*Math.ceil(Math.sqrt(oe));Rt(ae,X,re,me,this.compareMinX);for(var ne=X;ne<=re;ne+=me){var ct=Math.min(ne+me-1,re);Rt(ae,ne,ct,le,this.compareMinY);for(var je=ne;je<=ct;je+=le){var We=Math.min(je+le-1,ct);te.children.push(this._build(ae,je,We,Q-1))}}return p(te,this.toBBox),te},ye.prototype._chooseSubtree=function(ae,X,re,Q){for(;Q.push(X),!X.leaf&&Q.length-1!==re;){for(var te=1/0,ue=1/0,oe=void 0,le=0;le<X.children.length;le++){var me=X.children[le],ne=Fe(me),ct=(je=ae,We=me,(Math.max(We.maxX,je.maxX)-Math.min(We.minX,je.minX))*(Math.max(We.maxY,je.maxY)-Math.min(We.minY,je.minY))-ne);ct<ue?(ue=ct,te=ne<te?ne:te,oe=me):ct===ue&&ne<te&&(te=ne,oe=me)}X=oe||X.children[0]}var je,We;return X},ye.prototype._insert=function(ae,X,re){var Q=re?ae:this.toBBox(ae),te=[],ue=this._chooseSubtree(Q,this.data,X,te);for(ue.children.push(ae),ge(ue,Q);X>=0&&te[X].children.length>this._maxEntries;)this._split(te,X),X--;this._adjustParentBBoxes(Q,te,X)},ye.prototype._split=function(ae,X){var re=ae[X],Q=re.children.length,te=this._minEntries;this._chooseSplitAxis(re,te,Q);var ue=this._chooseSplitIndex(re,te,Q),oe=dt(re.children.splice(ue,re.children.length-ue));oe.height=re.height,oe.leaf=re.leaf,p(re,this.toBBox),p(oe,this.toBBox),X?ae[X-1].children.push(oe):this._splitRoot(re,oe)},ye.prototype._splitRoot=function(ae,X){this.data=dt([ae,X]),this.data.height=ae.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},ye.prototype._chooseSplitIndex=function(ae,X,re){for(var Q,te,ue,oe,le,me,ne,ct=1/0,je=1/0,We=X;We<=re-X;We++){var Se=K(ae,0,We,this.toBBox),ln=K(ae,We,re,this.toBBox),Bt=(te=Se,ue=ln,void 0,void 0,void 0,void 0,oe=Math.max(te.minX,ue.minX),le=Math.max(te.minY,ue.minY),me=Math.min(te.maxX,ue.maxX),ne=Math.min(te.maxY,ue.maxY),Math.max(0,me-oe)*Math.max(0,ne-le)),$e=Fe(Se)+Fe(ln);Bt<ct?(ct=Bt,Q=We,je=$e<je?$e:je):Bt===ct&&$e<je&&(je=$e,Q=We)}return Q||re-X},ye.prototype._chooseSplitAxis=function(ae,X,re){var Q=ae.leaf?this.compareMinX:Te,te=ae.leaf?this.compareMinY:Pe;this._allDistMargin(ae,X,re,Q)<this._allDistMargin(ae,X,re,te)&&ae.children.sort(Q)},ye.prototype._allDistMargin=function(ae,X,re,Q){ae.children.sort(Q);for(var te=this.toBBox,ue=K(ae,0,X,te),oe=K(ae,re-X,re,te),le=bt(ue)+bt(oe),me=X;me<re-X;me++){var ne=ae.children[me];ge(ue,ae.leaf?te(ne):ne),le+=bt(ue)}for(var ct=re-X-1;ct>=X;ct--){var je=ae.children[ct];ge(oe,ae.leaf?te(je):je),le+=bt(oe)}return le},ye.prototype._adjustParentBBoxes=function(ae,X,re){for(var Q=re;Q>=0;Q--)ge(X[Q],ae)},ye.prototype._condense=function(ae){for(var X=ae.length-1,re=void 0;X>=0;X--)0===ae[X].children.length?X>0?(re=ae[X-1].children).splice(re.indexOf(ae[X]),1):this.clear():p(ae[X],this.toBBox)},ye}()},5203:(Lt,rt,xe)=>{"use strict";var de,ye=SyntaxError,Ce=Function,p=TypeError,K=function(je){try{return Ce('"use strict"; return ('+je+").constructor;")()}catch{}},ge=Object.getOwnPropertyDescriptor;if(ge)try{ge({},"")}catch{ge=null}var Te=function(){throw new p},Pe=ge?function(){try{return Te}catch{try{return ge(arguments,"callee").get}catch{return Te}}}():Te,Fe=xe(2969)(),bt=Object.getPrototypeOf||function(je){return je.__proto__},nt={},He=typeof Uint8Array>"u"?de:bt(Uint8Array),dt={"%AggregateError%":typeof AggregateError>"u"?de:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?de:ArrayBuffer,"%ArrayIteratorPrototype%":Fe?bt([][Symbol.iterator]()):de,"%AsyncFromSyncIteratorPrototype%":de,"%AsyncFunction%":nt,"%AsyncGenerator%":nt,"%AsyncGeneratorFunction%":nt,"%AsyncIteratorPrototype%":nt,"%Atomics%":typeof Atomics>"u"?de:Atomics,"%BigInt%":typeof BigInt>"u"?de:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?de:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?de:Float32Array,"%Float64Array%":typeof Float64Array>"u"?de:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?de:FinalizationRegistry,"%Function%":Ce,"%GeneratorFunction%":nt,"%Int8Array%":typeof Int8Array>"u"?de:Int8Array,"%Int16Array%":typeof Int16Array>"u"?de:Int16Array,"%Int32Array%":typeof Int32Array>"u"?de:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Fe?bt(bt([][Symbol.iterator]())):de,"%JSON%":"object"==typeof JSON?JSON:de,"%Map%":typeof Map>"u"?de:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Fe?de:bt((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?de:Promise,"%Proxy%":typeof Proxy>"u"?de:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?de:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?de:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Fe?de:bt((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?de:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Fe?bt(""[Symbol.iterator]()):de,"%Symbol%":Fe?Symbol:de,"%SyntaxError%":ye,"%ThrowTypeError%":Pe,"%TypedArray%":He,"%TypeError%":p,"%Uint8Array%":typeof Uint8Array>"u"?de:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?de:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?de:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?de:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?de:WeakMap,"%WeakRef%":typeof WeakRef>"u"?de:WeakRef,"%WeakSet%":typeof WeakSet>"u"?de:WeakSet},Rt=function je(We){var Se;if("%AsyncFunction%"===We)Se=K("async function () {}");else if("%GeneratorFunction%"===We)Se=K("function* () {}");else if("%AsyncGeneratorFunction%"===We)Se=K("async function* () {}");else if("%AsyncGenerator%"===We){var ln=je("%AsyncGeneratorFunction%");ln&&(Se=ln.prototype)}else if("%AsyncIteratorPrototype%"===We){var Bt=je("%AsyncGenerator%");Bt&&(Se=bt(Bt.prototype))}return dt[We]=Se,Se},ae={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},X=xe(4444),re=xe(3164),Q=X.call(Function.call,Array.prototype.concat),te=X.call(Function.apply,Array.prototype.splice),ue=X.call(Function.call,String.prototype.replace),oe=X.call(Function.call,String.prototype.slice),le=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,me=/\\(\\)?/g,ne=function(We){var Se=oe(We,0,1),ln=oe(We,-1);if("%"===Se&&"%"!==ln)throw new ye("invalid intrinsic syntax, expected closing `%`");if("%"===ln&&"%"!==Se)throw new ye("invalid intrinsic syntax, expected opening `%`");var Bt=[];return ue(We,le,function($e,Tt,Xe,gt){Bt[Bt.length]=Xe?ue(gt,me,"$1"):Tt||$e}),Bt},ct=function(We,Se){var Bt,ln=We;if(re(ae,ln)&&(ln="%"+(Bt=ae[ln])[0]+"%"),re(dt,ln)){var $e=dt[ln];if($e===nt&&($e=Rt(ln)),typeof $e>"u"&&!Se)throw new p("intrinsic "+We+" exists, but is not available. Please file an issue!");return{alias:Bt,name:ln,value:$e}}throw new ye("intrinsic "+We+" does not exist!")};Lt.exports=function(We,Se){if("string"!=typeof We||0===We.length)throw new p("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof Se)throw new p('"allowMissing" argument must be a boolean');var ln=ne(We),Bt=ln.length>0?ln[0]:"",$e=ct("%"+Bt+"%",Se),Tt=$e.name,Xe=$e.value,gt=!1,xt=$e.alias;xt&&(Bt=xt[0],te(ln,Q([0,1],xt)));for(var Be=1,qt=!0;Be<ln.length;Be+=1){var $t=ln[Be],pn=oe($t,0,1),At=oe($t,-1);if(('"'===pn||"'"===pn||"`"===pn||'"'===At||"'"===At||"`"===At)&&pn!==At)throw new ye("property names with quotes must have matching quotes");if(("constructor"===$t||!qt)&&(gt=!0),re(dt,Tt="%"+(Bt+="."+$t)+"%"))Xe=dt[Tt];else if(null!=Xe){if(!($t in Xe)){if(!Se)throw new p("base intrinsic for "+We+" exists, but the property is not available.");return}if(ge&&Be+1>=ln.length){var Sn=ge(Xe,$t);Xe=(qt=!!Sn)&&"get"in Sn&&!("originalValue"in Sn.get)?Sn.get:Xe[$t]}else qt=re(Xe,$t),Xe=Xe[$t];qt&&!gt&&(dt[Tt]=Xe)}}return Xe}},7027:(Lt,rt,xe)=>{"use strict";var ye=xe(5203)("%Object.defineProperty%",!0),Ce=function(){if(ye)try{return ye({},"a",{value:1}),!0}catch{return!1}return!1};Ce.hasArrayLengthDefineBug=function(){if(!Ce())return null;try{return 1!==ye([],"length",{value:1}).length}catch{return!0}},Lt.exports=Ce},2969:(Lt,rt,xe)=>{"use strict";var de=typeof Symbol<"u"&&Symbol,ye=xe(1983);Lt.exports=function(){return"function"==typeof de&&"function"==typeof Symbol&&"symbol"==typeof de("foo")&&"symbol"==typeof Symbol("bar")&&ye()}},1983:Lt=>{"use strict";Lt.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var xe={},de=Symbol("test"),ye=Object(de);if("string"==typeof de||"[object Symbol]"!==Object.prototype.toString.call(de)||"[object Symbol]"!==Object.prototype.toString.call(ye))return!1;for(de in xe[de]=42,xe)return!1;if("function"==typeof Object.keys&&0!==Object.keys(xe).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(xe).length)return!1;var p=Object.getOwnPropertySymbols(xe);if(1!==p.length||p[0]!==de||!Object.prototype.propertyIsEnumerable.call(xe,de))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var K=Object.getOwnPropertyDescriptor(xe,de);if(42!==K.value||!0!==K.enumerable)return!1}return!0}},6259:(Lt,rt,xe)=>{"use strict";var de=xe(1983);Lt.exports=function(){return de()&&!!Symbol.toStringTag}},3164:(Lt,rt,xe)=>{"use strict";var de=xe(4444);Lt.exports=de.call(Function.call,Object.prototype.hasOwnProperty)},3407:(Lt,rt,xe)=>{"use strict";var de=xe(6259)(),Ce=xe(5834)("Object.prototype.toString"),p=function(Pe){return!(de&&Pe&&"object"==typeof Pe&&Symbol.toStringTag in Pe)&&"[object Arguments]"===Ce(Pe)},K=function(Pe){return!!p(Pe)||null!==Pe&&"object"==typeof Pe&&"number"==typeof Pe.length&&Pe.length>=0&&"[object Array]"!==Ce(Pe)&&"[object Function]"===Ce(Pe.callee)},ge=function(){return p(arguments)}();p.isLegacyArguments=K,Lt.exports=ge?p:K},2374:(Lt,rt,xe)=>{"use strict";var de=Date.prototype.getDay,Ce=Object.prototype.toString,K=xe(6259)();Lt.exports=function(Te){return"object"==typeof Te&&null!==Te&&(K?function(Te){try{return de.call(Te),!0}catch{return!1}}(Te):"[object Date]"===Ce.call(Te))}},2342:(Lt,rt,xe)=>{"use strict";var Ce,p,K,ge,de=xe(5834),ye=xe(6259)();if(ye){Ce=de("Object.prototype.hasOwnProperty"),p=de("RegExp.prototype.exec"),K={};var Te=function(){throw K};ge={toString:Te,valueOf:Te},"symbol"==typeof Symbol.toPrimitive&&(ge[Symbol.toPrimitive]=Te)}var Pe=de("Object.prototype.toString"),Fe=Object.getOwnPropertyDescriptor;Lt.exports=ye?function(He){if(!He||"object"!=typeof He)return!1;var dt=Fe(He,"lastIndex");if(!dt||!Ce(dt,"value"))return!1;try{p(He,ge)}catch(ae){return ae===K}}:function(He){return!(!He||"object"!=typeof He&&"function"!=typeof He)&&"[object RegExp]"===Pe(He)}},3082:Lt=>{var ye=/^\s+|\s+$/g,Ce=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,K=/^0o[0-7]+$/i,ge=parseInt,Te="object"==typeof global&&global&&global.Object===Object&&global,Pe="object"==typeof self&&self&&self.Object===Object&&self,Fe=Te||Pe||Function("return this")(),nt=Object.prototype.toString,He=Math.max,dt=Math.min,Rt=function(){return Fe.Date.now()};function X(ue){var oe=typeof ue;return!!ue&&("object"==oe||"function"==oe)}function te(ue){if("number"==typeof ue)return ue;if(function Q(ue){return"symbol"==typeof ue||function re(ue){return!!ue&&"object"==typeof ue}(ue)&&"[object Symbol]"==nt.call(ue)}(ue))return NaN;if(X(ue)){var oe="function"==typeof ue.valueOf?ue.valueOf():ue;ue=X(oe)?oe+"":oe}if("string"!=typeof ue)return 0===ue?ue:+ue;ue=ue.replace(ye,"");var le=p.test(ue);return le||K.test(ue)?ge(ue.slice(2),le?2:8):Ce.test(ue)?NaN:+ue}Lt.exports=function ae(ue,oe,le){var me,ne,ct,je,We,Se,ln=0,Bt=!1,$e=!1,Tt=!0;if("function"!=typeof ue)throw new TypeError("Expected a function");function Xe(Yn){var Kn=me,pr=ne;return me=ne=void 0,ln=Yn,je=ue.apply(pr,Kn)}function gt(Yn){return ln=Yn,We=setTimeout(qt,oe),Bt?Xe(Yn):je}function Be(Yn){var Kn=Yn-Se;return void 0===Se||Kn>=oe||Kn<0||$e&&Yn-ln>=ct}function qt(){var Yn=Rt();if(Be(Yn))return $t(Yn);We=setTimeout(qt,function xt(Yn){var Un=oe-(Yn-Se);return $e?dt(Un,ct-(Yn-ln)):Un}(Yn))}function $t(Yn){return We=void 0,Tt&&me?Xe(Yn):(me=ne=void 0,je)}function Sn(){var Yn=Rt(),Kn=Be(Yn);if(me=arguments,ne=this,Se=Yn,Kn){if(void 0===We)return gt(Se);if($e)return We=setTimeout(qt,oe),Xe(Se)}return void 0===We&&(We=setTimeout(qt,oe)),je}return oe=te(oe)||0,X(le)&&(Bt=!!le.leading,ct=($e="maxWait"in le)?He(te(le.maxWait)||0,oe):ct,Tt="trailing"in le?!!le.trailing:Tt),Sn.cancel=function pn(){void 0!==We&&clearTimeout(We),ln=0,me=Se=ne=We=void 0},Sn.flush=function At(){return void 0===We?je:$t(Rt())},Sn}},9898:function(Lt){Lt.exports=function(){"use strict";var rt,xe,de;function ye(p,K){if(rt)if(xe){var ge="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+rt+")(sharedChunk); ("+xe+")(sharedChunk); self.onerror = null;",Te={};rt(Te),de=K(Te),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(de.workerUrl=window.URL.createObjectURL(new Blob([ge],{type:"text/javascript"})))}else xe=K;else rt=K}return ye(0,function(p){var K=typeof self<"u"?self:{},ge="2.13.0";let Te;const Pe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Te){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Te=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch{Te=a}}return Te},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Fe={supported:!1,testSupport:function(a){!He&&nt&&(dt?Rt(a):bt=a)}};let bt,nt,He=!1,dt=!1;function Rt(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,nt),a.isContextLost())return;Fe.supported=!0}catch{}a.deleteTexture(o),He=!0}K.document&&(nt=K.document.createElement("img"),nt.onload=function(){bt&&Rt(bt),bt=null,dt=!0},nt.onerror=function(){He=!0,bt=null},nt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ae="01";var X=re;function re(a,o,u,d){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=u,this.p2y=d}re.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var u=a,d=0;d<8;d++){var y=this.sampleCurveX(u)-a;if(Math.abs(y)<o)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=y/E}var S=0,D=1;for(u=a,d=0;d<20&&(y=this.sampleCurveX(u),!(Math.abs(y-a)<o));d++)a>y?S=u:D=u,u=.5*(D-S)+S;return u},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var Q=te;function te(a,o){this.x=a,this.y=o}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,u=a.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),u=Math.sin(a),d=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=d,this},_rotateAround:function(a,o){var u=Math.cos(a),d=Math.sin(a),y=o.y+d*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-d*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(a){return a instanceof te?a:Array.isArray(a)?new te(a[0],a[1]):a};const ue=Math.PI/180,oe=180/Math.PI;function le(a){return a*ue}function me(a){return a*oe}const ne=[[0,0],[1,0],[1,1],[0,1]];function ct(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,u=o*a;return 4*(a<.5?u:3*(a-o)+u-.75)}function je(a,o,u,d){const y=new X(a,o,u,d);return function(E){return y.solve(E)}}const We=je(.25,.1,.25,1);function Se(a,o,u){return Math.min(u,Math.max(o,a))}function ln(a,o,u){return(u=Se((u-a)/(o-a),0,1))*u*(3-2*u)}function Bt(a,o,u){const d=u-o,y=((a-o)%d+d)%d+o;return y===o?u:y}function $e(a,o,u){if(!a.length)return u(null,[]);let d=a.length;const y=new Array(a.length);let E=null;a.forEach((S,D)=>{o(S,(O,N)=>{O&&(E=O),y[D]=N,0==--d&&u(E,y)})})}function Tt(a){const o=[];for(const u in a)o.push(a[u]);return o}function Xe(a,...o){for(const u of o)for(const d in u)a[d]=u[d];return a}let gt=1;function xt(){return gt++}function Be(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function qt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function $t(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function pn(a,o){a.forEach(u=>{o[u]&&(o[u]=o[u].bind(o))})}function At(a,o){return-1!==a.indexOf(o,a.length-o.length)}function Sn(a,o,u){const d={};for(const y in a)d[y]=o.call(u||this,a[y],y,a);return d}function Yn(a,o,u){const d={};for(const y in a)o.call(u||this,a[y],y,a)&&(d[y]=a[y]);return d}function Kn(a){return Array.isArray(a)?a.map(Kn):"object"==typeof a&&a?Sn(a,Kn):a}const pr={};function Un(a){pr[a]||(typeof console<"u"&&console.warn(a),pr[a]=!0)}function Rn(a,o,u){return(u.y-a.y)*(o.x-a.x)>(o.y-a.y)*(u.x-a.x)}function Jn(a){let o=0;for(let u,d,y=0,E=a.length,S=E-1;y<E;S=y++)u=a[y],d=a[S],o+=(d.x-u.x)*(u.y+d.y);return o}function Ei(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ai(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,d,y,E)=>{const S=y||E;return o[d]=!S||S.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}let Sr=null;function zr(a){if(null==Sr){const o=a.navigator?a.navigator.userAgent:null;Sr=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Sr}function Nt(a){try{const o=K[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function Le(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const De="mapbox-tiles";let Me,Ke,St=500,Jt=50;function En(){try{return K.caches}catch{}}function vn(){En()&&!Me&&(Me=K.caches.open(De))}function un(a){const o=a.indexOf("?");if(o<0)return a;const d=function(y){const E=y.indexOf("?");return E>0?y.slice(E+1).split("&"):[]}(a).filter(y=>{const E=y.split("=");return"language"===E[0]||"worldview"===E[0]});return d.length?`${a.slice(0,o)}?${d.join("&")}`:a.slice(0,o)}let kr=1/0;const Xr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Xr);class kn extends Error{constructor(o,u,d){401===u&&ra(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=u,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ri=Ei()?()=>self.worker&&self.worker.referrer:()=>("blob:"===K.location.protocol?K.parent:K).location.href,Hi=function(a,o){if(!(/^file:/.test(u=a.url)||/^file:/.test(ri())&&!/^\w+:/.test(u))){if(K.fetch&&K.Request&&K.AbortController&&K.Request.prototype.hasOwnProperty("signal"))return function(d,y){const E=new K.AbortController,S=new K.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:ri(),signal:E.signal});let D=!1,O=!1;const N=(V=S.url).indexOf("sku=")>0&&ra(V);var V;"json"===d.type&&S.headers.set("Accept","application/json");const $=(J,ie,pe)=>{if(O)return;if(J&&"SecurityError"!==J.message&&Un(J),ie&&pe)return H(ie);const Ne=Date.now();K.fetch(S).then(Qe=>{if(Qe.ok){const ft=N?Qe.clone():null;return H(Qe,ft,Ne)}return y(new kn(Qe.statusText,Qe.status,d.url))}).catch(Qe=>{"AbortError"!==Qe.name&&y(new Error(`${Qe.message} ${d.url}`))})},H=(J,ie,pe)=>{("arrayBuffer"===d.type?J.arrayBuffer():"json"===d.type?J.json():J.text()).then(Ne=>{O||(ie&&pe&&function(Qe,ft,Ye){if(vn(),!Me)return;const lt={status:ft.status,statusText:ft.statusText,headers:new K.Headers};ft.headers.forEach((Kt,Zt)=>lt.headers.set(Zt,Kt));const Et=Ai(ft.headers.get("Cache-Control")||"");if(Et["no-store"])return;Et["max-age"]&&lt.headers.set("Expires",new Date(Ye+1e3*Et["max-age"]).toUTCString());const pt=lt.headers.get("Expires");pt&&(new Date(pt).getTime()-Ye<42e4||function(Kt,Zt){if(void 0===Ke)try{new Response(new ReadableStream),Ke=!0}catch{Ke=!1}Ke?Zt(Kt.body):Kt.blob().then(Zt)}(ft,Kt=>{const Zt=new K.Response(Kt,lt);vn(),Me&&Me.then(fn=>fn.put(un(Qe.url),Zt)).catch(fn=>Un(fn.message))}))}(S,ie,pe),D=!0,y(null,Ne,J.headers.get("Cache-Control"),J.headers.get("Expires")))}).catch(Ne=>{O||y(new Error(Ne.message))})};return N?function(J,ie){if(vn(),!Me)return ie(null);const pe=un(J.url);Me.then(Ne=>{Ne.match(pe).then(Qe=>{const ft=function(Ye){if(!Ye)return!1;const lt=new Date(Ye.headers.get("Expires")||0),Et=Ai(Ye.headers.get("Cache-Control")||"");return lt>Date.now()&&!Et["no-cache"]}(Qe);Ne.delete(pe),ft&&Ne.put(pe,Qe.clone()),ie(null,Qe,ft)}).catch(ie)}).catch(ie)}(S,$):$(null,null),{cancel:()=>{O=!0,D||E.abort()}}}(a,o);if(Ei()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var u;return function(d,y){const E=new K.XMLHttpRequest;E.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(E.responseType="arraybuffer");for(const S in d.headers)E.setRequestHeader(S,d.headers[S]);return"json"===d.type&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials="include"===d.credentials,E.onerror=()=>{y(new Error(E.statusText))},E.onload=()=>{if((E.status>=200&&E.status<300||0===E.status)&&null!==E.response){let S=E.response;if("json"===d.type)try{S=JSON.parse(E.response)}catch(D){return y(D)}y(null,S,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else y(new kn(E.statusText,E.status,d.url))},E.send(d.body),{cancel:()=>E.abort()}}(a,o)},li=function(a,o){return Hi(Xe(a,{type:"arrayBuffer"}),o)};function gi(a){const o=K.document.createElement("a");return o.href=a,o.protocol===K.document.location.protocol&&o.host===K.document.location.host}const oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let xo,eo;xo=[],eo=0;const wo=function(a,o){if(Fe.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),eo>=Pe.MAX_PARALLEL_IMAGE_REQUESTS){const E={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return xo.push(E),E}eo++;let u=!1;const d=()=>{if(!u)for(u=!0,eo--;xo.length&&eo<Pe.MAX_PARALLEL_IMAGE_REQUESTS;){const E=xo.shift(),{requestParameters:S,callback:D,cancelled:O}=E;O||(E.cancel=wo(S,D).cancel)}},y=li(a,(E,S,D,O)=>{d(),E?o(E):S&&(K.createImageBitmap?function(N,V){const $=new K.Blob([new Uint8Array(N)],{type:"image/png"});K.createImageBitmap($).then(H=>{V(null,H)}).catch(H=>{V(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(S,(N,V)=>o(N,V,D,O)):function(N,V){const $=new K.Image,H=K.URL;$.onload=()=>{V(null,$),H.revokeObjectURL($.src),$.onload=null,K.requestAnimationFrame(()=>{$.src=oo})},$.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const J=new K.Blob([new Uint8Array(N)],{type:"image/png"});$.src=N.byteLength?H.createObjectURL(J):oo}(S,(N,V)=>o(N,V,D,O)))});return{cancel:()=>{y.cancel(),d()}}},Bs="NO_ACCESS_TOKEN";function Li(a){return 0===a.indexOf("mapbox:")}function ra(a){return Pe.API_URL_REGEX.test(a)}function Ls(a){return Pe.API_CDN_URL_REGEX.test(a)}function Tn(a){return Pe.API_STYLE_REGEX.test(a)&&!il(a)}function il(a){return Pe.API_SPRITE_REGEX.test(a)}const va=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fr(a){const o=a.match(va);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Ua(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}function Is(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(K.atob(o[1]).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Va{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const u=Is(Pe.ACCESS_TOKEN);let d="";return d=u&&u.u?K.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,(y,E)=>String.fromCharCode(Number("0x"+E)))):Pe.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${d}`:`mapbox.eventData:${d}`}fetchEventData(){const o=Nt("localStorage"),u=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{const y=K.localStorage.getItem(u);y&&(this.eventData=JSON.parse(y));const E=K.localStorage.getItem(d);E&&(this.anonId=E)}catch{Un("Unable to read from LocalStorage")}}saveEventData(){const o=Nt("localStorage"),u=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{K.localStorage.setItem(d,this.anonId),Object.keys(this.eventData).length>=1&&K.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{Un("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,u,d,y){if(!Pe.EVENTS_URL)return;const E=Fr(Pe.EVENTS_URL);E.params.push(`access_token=${y||Pe.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(o).toISOString()},D=u?Xe(S,u):S,O={url:Ua(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};var V;this.pendingRequest=(V=N=>{this.pendingRequest=null,d(N),this.saveEventData(),this.processRequests(y)},Hi(Xe(O,{method:"POST"}),V))}queueRequest(o,u){this.queue.push(o),this.processRequests(u)}}const Ze=new class extends Va{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){Pe.EVENTS_URL&&Pe.ACCESS_TOKEN&&Array.isArray(a)&&a.some(u=>Li(u)||ra(u))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Is(Pe.ACCESS_TOKEN),u=o?o.u:Pe.ACCESS_TOKEN;let d=u!==this.eventData.tokenU;$t(this.anonId)||(this.anonId=Be(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),S=new Date(y),D=(y-this.eventData.lastSuccess)/864e5;d=d||D>=1||D<-1||E.getDate()!==S.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ge,skuId:ae,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=y,this.eventData.tokenU=u)},a):this.processRequests()}},ce=Ze.postTurnstileEvent.bind(Ze),be=new class extends Va{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,u,d){this.skuToken=o,this.errorCb=d,Pe.EVENTS_URL&&(u||Pe.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},u):this.errorCb(new Error(Bs)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),$t(this.anonId)||(this.anonId=Be()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ge,skuId:ae,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a))}},ze=be.postMapLoadEvent.bind(be),et=new class extends Va{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){Pe.EVENTS_URL&&(a||Pe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:u}=this.queue.shift(),d=function(y){const E=K.performance.getEntriesByType("resource"),S=K.performance.getEntriesByType("mark"),D=function(H){const J={};if(H)for(const ie in H)if("other"!==ie)for(const pe of H[ie]){const Ne=`${ie}ResolveRangeMin`,Qe=`${ie}ResolveRangeMax`,ft=`${ie}RequestCount`,Ye=`${ie}RequestCachedCount`;J[Ne]=Math.min(J[Ne]||1/0,pe.startTime),J[Qe]=Math.max(J[Qe]||-1/0,pe.responseEnd);const lt=Et=>{void 0===J[Et]&&(J[Et]=0),++J[Et]};void 0!==pe.transferSize&&0===pe.transferSize&&lt(Ye),lt(ft)}return J}(function(H,J){const ie={};if(H)for(const pe of H){const Ne=J(pe);void 0===ie[Ne]&&(ie[Ne]=[]),ie[Ne].push(pe)}return ie}(E,Fn)),O=K.devicePixelRatio,N=K.navigator.connection||K.navigator.mozConnection||K.navigator.webkitConnection,V={counters:[],metadata:[],attributes:[]},$=(H,J,ie)=>{null!=ie&&H.push({name:J,value:ie.toString()})};for(const H in D)$(V.counters,H,D[H]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&($(V.counters,"interactionRangeMin",y.interactionRange[0]),$(V.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const H of Object.keys(zt)){const J=zt[H],ie=S.find(pe=>pe.name===J);ie&&$(V.counters,J,ie.startTime)}return $(V.counters,"visibilityHidden",y.visibilityHidden),$(V.attributes,"style",function(H){if(H)for(const J of H){const ie=J.name.split("?")[0];if(Tn(ie)){const pe=ie.split("/").slice(-2);if(2===pe.length)return`mapbox://styles/${pe[0]}/${pe[1]}`}}}(E)),$(V.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),$(V.attributes,"fogEnabled",y.fogEnabled?"true":"false"),$(V.attributes,"projection",y.projection),$(V.attributes,"zoom",y.zoom),$(V.metadata,"devicePixelRatio",O),$(V.metadata,"connectionEffectiveType",N?N.effectiveType:void 0),$(V.metadata,"navigatorUserAgent",K.navigator.userAgent),$(V.metadata,"screenWidth",K.screen.width),$(V.metadata,"screenHeight",K.screen.height),$(V.metadata,"windowWidth",K.innerWidth),$(V.metadata,"windowHeight",K.innerHeight),$(V.metadata,"mapWidth",y.width/O),$(V.metadata,"mapHeight",y.height/O),$(V.metadata,"webglRenderer",y.renderer),$(V.metadata,"webglVendor",y.vendor),$(V.metadata,"sdkVersion",ge),$(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(u);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(o,d,()=>{},a)}},yt=et.postPerformanceEvent.bind(et),Ut=new class extends Va{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,u,d){if(!Pe.API_URL||!Pe.SESSION_PATH)return;const y=Fr(Pe.API_URL+Pe.SESSION_PATH);y.params.push(`sku=${o||""}`),y.params.push(`access_token=${d||Pe.ACCESS_TOKEN||""}`);const E={url:Ua(y),headers:{"Content-Type":"text/plain"}};var D;this.pendingRequest=(D=S=>{this.pendingRequest=null,u(S),this.saveEventData(),this.processRequests(d)},Hi(Xe(E,{method:"GET"}),D))}getSessionAPI(a,o,u,d){this.skuToken=o,this.errorCb=d,Pe.SESSION_PATH&&Pe.API_URL&&(u||Pe.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},u):this.errorCb(new Error(Bs)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||this.getSession(u,this.skuToken,d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a)}},Pt=Ut.getSessionAPI.bind(Ut),ht=new Set,zt={create:"create",load:"load",fullLoad:"fullLoad"},dn={mark(a){K.performance.mark(a)},measure(a,o,u){K.performance.measure(a,o,u)}};function Fn(a){const o=a.name.split("?")[0];return Ls(o)&&o.includes("mapbox-gl.js")?"javascript":Ls(o)&&o.includes("mapbox-gl.css")?"css":Pe.API_FONTS_REGEX.test(o)?"fontRange":il(o)?"sprite":Tn(o)?"style":Pe.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const mn=K.performance;function yr(a){const o=a?a.url.toString():void 0;return mn.getEntriesByName(o)}let ir,xr,_r,Dr;const Vr={now:()=>void 0!==_r?_r:K.performance.now(),setNow(a){_r=a},restoreNow(){_r=void 0},frame(a){const o=K.requestAnimationFrame(a);return{cancel:()=>K.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:u,height:d}=a;Dr||(Dr=K.document.createElement("canvas"));const y=Dr.getContext("2d",{willReadFrequently:!0});if(!y)throw new Error("failed to create canvas 2d context");return(u>Dr.width||d>Dr.height)&&(Dr.width=u,Dr.height=d),y.clearRect(-o,-o,u+2*o,d+2*o),y.drawImage(a,0,0,u,d),y.getImageData(-o,-o,u+2*o,d+2*o)},resolveURL:a=>(ir||(ir=K.document.createElement("a")),ir.href=a,ir.href),get devicePixelRatio(){return K.devicePixelRatio},get prefersReducedMotion(){return!!K.matchMedia&&(null==xr&&(xr=K.matchMedia("(prefers-reduced-motion: reduce)")),xr.matches)}};function nr(a,o,u){u[a]&&-1!==u[a].indexOf(o)||(u[a]=u[a]||[],u[a].push(o))}function Pi(a,o,u){if(u&&u[a]){const d=u[a].indexOf(o);-1!==d&&u[a].splice(d,1)}}class Zr{constructor(o,u={}){Xe(this,u),this.type=o}}class Wi extends Zr{constructor(o,u={}){super("error",Xe({error:o},u))}}class Xi{on(o,u){return this._listeners=this._listeners||{},nr(o,u,this._listeners),this}off(o,u){return Pi(o,u,this._listeners),Pi(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},nr(o,u,this._oneTimeListeners),this):new Promise(d=>this.once(o,d))}fire(o,u){"string"==typeof o&&(o=new Zr(o,u||{}));const d=o.type;if(this.listens(d)){o.target=this;const y=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const D of y)D.call(this,o);const E=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const D of E)Pi(d,D,this._oneTimeListeners),D.call(this,o);const S=this._eventedParent;S&&(Xe(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(o))}else o instanceof Wi&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var Yt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ca(a,...o){for(const u of o)for(const d in u)a[d]=u[d];return a}function so(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function di(a){if(Array.isArray(a))return a.map(di);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const u in a)o[u]=di(a[u]);return o}return so(a)}class Qu extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}var Ni=Qu;class ol{constructor(o,u=[]){this.parent=o,this.bindings={};for(const[d,y]of u)this.bindings[d]=y}concat(o){return new ol(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var xc=ol;const ao={kind:"null"},hn={kind:"number"},Qr={kind:"string"},Ti={kind:"boolean"},On={kind:"color"},k={kind:"object"},G={kind:"value"},we={kind:"collator"},st={kind:"formatted"},at={kind:"resolvedImage"};function Mt(a,o){return{kind:"array",itemType:a,N:o}}function Dt(a){if("array"===a.kind){const o=Dt(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const Cn=[ao,hn,Qr,Ti,On,st,k,Mt(G),at];function Mn(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Mn(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const u of Cn)if(!Mn(u,o))return null}return`Expected ${Dt(a)} but found ${Dt(o)} instead.`}function Zn(a,o){return o.some(u=>u.kind===a.kind)}function Qn(a,o){return o.some(u=>"null"===u?null===a:"array"===u?Array.isArray(a):"object"===u?a&&!Array.isArray(a)&&"object"==typeof a:u===typeof a)}var jn,cn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function as(a){return(a=Math.round(a))<0?0:a>255?255:a}function jr(a){return as("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function lo(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function bn(a,o,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?a+(o-a)*u*6:2*u<1?o:3*u<2?a+(o-a)*(2/3-u)*6:a}try{jn={}.parseCSSColor=function(a){var o,u=a.replace(/ /g,"").toLowerCase();if(u in cn)return cn[u].slice();if("#"===u[0])return 4===u.length?(o=parseInt(u.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===u.length&&(o=parseInt(u.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var d=u.indexOf("("),y=u.indexOf(")");if(-1!==d&&y+1===u.length){var E=u.substr(0,d),S=u.substr(d+1,y-(d+1)).split(","),D=1;switch(E){case"rgba":if(4!==S.length)return null;D=lo(S.pop());case"rgb":return 3!==S.length?null:[jr(S[0]),jr(S[1]),jr(S[2]),D];case"hsla":if(4!==S.length)return null;D=lo(S.pop());case"hsl":if(3!==S.length)return null;var O=(parseFloat(S[0])%360+360)%360/360,N=lo(S[1]),V=lo(S[2]),$=V<=.5?V*(N+1):V+N-V*N,H=2*V-$;return[as(255*bn(H,$,O+1/3)),as(255*bn(H,$,O)),as(255*bn(H,$,O-1/3)),D];default:return null}}return null}}catch{}class $n{constructor(o,u,d,y=1){this.r=o,this.g=u,this.b=d,this.a=y}static parse(o){if(!o)return;if(o instanceof $n)return o;if("string"!=typeof o)return;const u=jn(o);return u?new $n(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[o,u,d,y]=this.toArray();return`rgba(${Math.round(o)},${Math.round(u)},${Math.round(d)},${y})`}toArray(){const{r:o,g:u,b:d,a:y}=this;return 0===y?[0,0,0,0]:[255*o/y,255*u/y,255*d/y,y]}toArray01(){const{r:o,g:u,b:d,a:y}=this;return 0===y?[0,0,0,0]:[o/y,u/y,d/y,y]}toArray01PremultipliedAlpha(){const{r:o,g:u,b:d,a:y}=this;return[o,u,d,y]}}$n.black=new $n(0,0,0,1),$n.white=new $n(1,1,1,1),$n.transparent=new $n(0,0,0,0),$n.red=new $n(1,0,0,1),$n.blue=new $n(0,0,1,1);var sr=$n;class Jr{constructor(o,u,d){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gr{constructor(o,u,d,y,E){this.text=o.normalize?o.normalize():o,this.image=u,this.scale=d,this.fontStack=y,this.textColor=E}}class vi{constructor(o){this.sections=o}static fromString(o){return new vi([new Gr(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof vi?o:vi.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const u of this.sections){if(u.image){o.push(["image",u.image.name]);continue}o.push(u.text);const d={};u.fontStack&&(d["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(d["font-scale"]=u.scale),u.textColor&&(d["text-color"]=["rgba"].concat(u.textColor.toArray())),o.push(d)}return o}}class pl{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new pl({name:o,available:!1}):null}serialize(){return["image",this.name]}}function ji(a,o,u,d){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof u&&u>=0&&u<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[a,o,u,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[a,o,u,d]:[a,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ec(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof sr||a instanceof Jr||a instanceof vi||a instanceof pl)return!0;if(Array.isArray(a)){for(const o of a)if(!ec(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!ec(a[o]))return!1;return!0}return!1}function zn(a){if(null===a)return ao;if("string"==typeof a)return Qr;if("boolean"==typeof a)return Ti;if("number"==typeof a)return hn;if(a instanceof sr)return On;if(a instanceof Jr)return we;if(a instanceof vi)return st;if(a instanceof pl)return at;if(Array.isArray(a)){const o=a.length;let u;for(const d of a){const y=zn(d);if(u){if(u===y)continue;u=G;break}u=y}return Mt(u||G,o)}return k}function Ci(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof sr||a instanceof vi||a instanceof pl?a.toString():JSON.stringify(a)}class Ms{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(2!==o.length)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!ec(o[1]))return u.error("invalid value");const d=o[1];let y=zn(d);const E=u.expectedType;return"array"!==y.kind||0!==y.N||!E||"array"!==E.kind||"number"==typeof E.N&&0!==E.N||(y=E),new Ms(y,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof sr?["rgba"].concat(this.value.toArray()):this.value instanceof vi?this.value.serialize():this.value}}var bs=Ms,ha=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const $l={string:Qr,number:hn,boolean:Ti,object:k};class uo{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let d,y=1;const E=o[0];if("array"===E){let D,O;if(o.length>2){const N=o[1];if("string"!=typeof N||!(N in $l)||"object"===N)return u.error('The item type argument of "array" must be one of string, number, boolean',1);D=$l[N],y++}else D=G;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);O=o[2],y++}d=Mt(D,O)}else d=$l[E];const S=[];for(;y<o.length;y++){const D=u.parse(o[y],y,G);if(!D)return null;S.push(D)}return new uo(d,S)}evaluate(o){for(let u=0;u<this.args.length;u++){const d=this.args[u].evaluate(o);if(!Mn(this.type,zn(d)))return d;if(u===this.args.length-1)throw new ha(`Expected value to be of type ${Dt(this.type)}, but found ${Dt(zn(d))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,u=[o.kind];if("array"===o.kind){const d=o.itemType;if("string"===d.kind||"number"===d.kind||"boolean"===d.kind){u.push(d.kind);const y=o.N;("number"==typeof y||this.args.length>1)&&u.push(y)}}return u.concat(this.args.map(d=>d.serialize()))}}var Ns=uo;class ou{constructor(o){this.type=st,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&"object"==typeof d)return u.error("First argument must be an image or text section.");const y=[];let E=!1;for(let S=1;S<=o.length-1;++S){const D=o[S];if(E&&"object"==typeof D&&!Array.isArray(D)){E=!1;let O=null;if(D["font-scale"]&&(O=u.parse(D["font-scale"],1,hn),!O))return null;let N=null;if(D["text-font"]&&(N=u.parse(D["text-font"],1,Mt(Qr)),!N))return null;let V=null;if(D["text-color"]&&(V=u.parse(D["text-color"],1,On),!V))return null;const $=y[y.length-1];$.scale=O,$.font=N,$.textColor=V}else{const O=u.parse(o[S],1,G);if(!O)return null;const N=O.type.kind;if("string"!==N&&"value"!==N&&"null"!==N&&"resolvedImage"!==N)return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,y.push({content:O,scale:null,font:null,textColor:null})}}return new ou(y)}evaluate(o){return new vi(this.sections.map(u=>{const d=u.content.evaluate(o);return zn(d)===at?new Gr("",d,null,null,null):new Gr(Ci(d),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const u of this.sections){o.push(u.content.serialize());const d={};u.scale&&(d["font-scale"]=u.scale.serialize()),u.font&&(d["text-font"]=u.font.serialize()),u.textColor&&(d["text-color"]=u.textColor.serialize()),o.push(d)}return o}}class xa{constructor(o){this.type=at,this.input=o}static parse(o,u){if(2!==o.length)return u.error("Expected two arguments.");const d=u.parse(o[1],1,Qr);return d?new xa(d):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),d=pl.fromString(u);return d&&o.availableImages&&(d.available=o.availableImages.indexOf(u)>-1),d}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ql={"to-boolean":Ti,"to-color":On,"to-number":hn,"to-string":Qr};class Cl{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const d=o[0];if(("to-boolean"===d||"to-string"===d)&&2!==o.length)return u.error("Expected one argument.");const y=ql[d],E=[];for(let S=1;S<o.length;S++){const D=u.parse(o[S],S,G);if(!D)return null;E.push(D)}return new Cl(y,E)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let u,d;for(const y of this.args){if(u=y.evaluate(o),d=null,u instanceof sr)return u;if("string"==typeof u){const E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(d=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:ji(u[0],u[1],u[2],u[3]),!d))return new sr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ha(d||`Could not parse color from value '${"string"==typeof u?u:String(JSON.stringify(u))}'`)}if("number"===this.type.kind){let u=null;for(const d of this.args){if(u=d.evaluate(o),null===u)return 0;const y=Number(u);if(!isNaN(y))return y}throw new ha(`Could not convert ${JSON.stringify(u)} to number.`)}return"formatted"===this.type.kind?vi.fromString(Ci(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?pl.fromString(Ci(this.args[0].evaluate(o))):Ci(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ou([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new xa(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Sl=Cl;const fr=["Unknown","Point","LineString","Polygon"];var Gu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?fr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-a[0])+this.featureDistanceData.bearing[1]*(d*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=sr.parse(a)),o}};class Da{constructor(o,u,d,y){this.name=o,this.type=u,this._evaluate=d,this.args=y}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,u){const d=o[0],y=Da.definitions[d];if(!y)return u.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,D=S.filter(([N])=>!Array.isArray(N)||N.length===o.length-1);let O=null;for(const[N,V]of D){O=new $u(u.registry,u.path,null,u.scope);const $=[];let H=!1;for(let J=1;J<o.length;J++){const ie=o[J],pe=Array.isArray(N)?N[J-1]:N.type,Ne=O.parse(ie,1+$.length,pe);if(!Ne){H=!0;break}$.push(Ne)}if(!H)if(Array.isArray(N)&&N.length!==$.length)O.error(`Expected ${N.length} arguments, but found ${$.length} instead.`);else{for(let J=0;J<$.length;J++){const ie=Array.isArray(N)?N[J]:N.type,pe=$[J];O.concat(J+1).checkSubtype(ie,pe.type)}if(0===O.errors.length)return new Da(d,E,V,$)}}if(1===D.length)u.errors.push(...O.errors);else{const N=(D.length?D:S).map(([$])=>{return H=$,Array.isArray(H)?`(${H.map(Dt).join(", ")})`:`(${Dt(H.type)}...)`;var H}).join(" | "),V=[];for(let $=1;$<o.length;$++){const H=u.parse(o[$],1+V.length);if(!H)return null;V.push(Dt(H.type))}u.error(`Expected arguments of type ${N}, but found (${V.join(", ")}) instead.`)}return null}static register(o,u){Da.definitions=u;for(const d in u)o[d]=Da}}var xi=Da;class Es{constructor(o,u,d){this.type=we,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(2!==o.length)return u.error("Expected one argument.");const d=o[1];if("object"!=typeof d||Array.isArray(d))return u.error("Collator options argument must be an object.");const y=u.parse(void 0!==d["case-sensitive"]&&d["case-sensitive"],1,Ti);if(!y)return null;const E=u.parse(void 0!==d["diacritic-sensitive"]&&d["diacritic-sensitive"],1,Ti);if(!E)return null;let S=null;return d.locale&&(S=u.parse(d.locale,1,Qr),!S)?null:new Es(y,E,S)}evaluate(o){return new Jr(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const su=8192;function ms(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function ia(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function Ih(a,o){const u=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*su),Math.round(d*y*su)]}function sf(a,o,u){const d=a[0]-o[0],y=a[1]-o[1],E=a[0]-u[0],S=a[1]-u[1];return d*S-E*y==0&&d*E<=0&&y*S<=0}function bo(a,o){let u=!1;for(let S=0,D=o.length;S<D;S++){const O=o[S];for(let N=0,V=O.length;N<V-1;N++){if(sf(a,O[N],O[N+1]))return!1;(y=O[N])[1]>(d=a)[1]!=(E=O[N+1])[1]>d[1]&&d[0]<(E[0]-y[0])*(d[1]-y[1])/(E[1]-y[1])+y[0]&&(u=!u)}}var d,y,E;return u}function Zi(a,o){for(let u=0;u<o.length;u++)if(bo(a,o[u]))return!0;return!1}function fa(a,o,u,d){const y=d[0]-u[0],E=d[1]-u[1],S=(a[0]-u[0])*E-y*(a[1]-u[1]),D=(o[0]-u[0])*E-y*(o[1]-u[1]);return S>0&&D<0||S<0&&D>0}function Au(a,o,u){for(const N of u)for(let V=0;V<N.length-1;++V)if((D=[(S=N[V+1])[0]-(E=N[V])[0],S[1]-E[1]])[0]*(O=[(y=o)[0]-(d=a)[0],y[1]-d[1]])[1]-D[1]*O[0]!=0&&fa(d,y,E,S)&&fa(E,S,d,y))return!0;var d,y,E,S,D,O;return!1}function oa(a,o){for(let u=0;u<a.length;++u)if(!bo(a[u],o))return!1;for(let u=0;u<a.length-1;++u)if(Au(a[u],a[u+1],o))return!1;return!0}function Ri(a,o){for(let u=0;u<o.length;u++)if(oa(a,o[u]))return!0;return!1}function go(a,o,u){const d=[];for(let y=0;y<a.length;y++){const E=[];for(let S=0;S<a[y].length;S++){const D=Ih(a[y][S],u);ms(o,D),E.push(D)}d.push(E)}return d}function wr(a,o,u){const d=[];for(let y=0;y<a.length;y++){const E=go(a[y],o,u);d.push(E)}return d}function wc(a,o,u,d){if(a[0]<u[0]||a[0]>u[2]){const y=.5*d;let E=a[0]-u[0]>y?-d:u[0]-a[0]>y?d:0;0===E&&(E=a[0]-u[2]>y?-d:u[2]-a[0]>y?d:0),a[0]+=E}ms(o,a)}function gl(a,o,u,d){const y=Math.pow(2,d.z)*su,E=[d.x*su,d.y*su],S=[];if(!a)return S;for(const D of a)for(const O of D){const N=[O.x+E[0],O.y+E[1]];wc(N,o,u,y),S.push(N)}return S}function Ur(a,o,u,d){const y=Math.pow(2,d.z)*su,E=[d.x*su,d.y*su],S=[];if(!a)return S;for(const O of a){const N=[];for(const V of O){const $=[V.x+E[0],V.y+E[1]];ms(o,$),N.push($)}S.push(N)}if(o[2]-o[0]<=y/2){(D=o)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const O of S)for(const N of O)wc(N,o,u,y)}var D;return S}class ea{constructor(o,u){this.type=Ti,this.geojson=o,this.geometries=u}static parse(o,u){if(2!==o.length)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(ec(o[1])){const d=o[1];if("FeatureCollection"===d.type)for(let y=0;y<d.features.length;++y){const E=d.features[y].geometry.type;if("Polygon"===E||"MultiPolygon"===E)return new ea(d,d.features[y].geometry)}else if("Feature"===d.type){const y=d.geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new ea(d,d.geometry)}else if("Polygon"===d.type||"MultiPolygon"===d.type)return new ea(d,d)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(u,d){const y=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(!S)return!1;if("Polygon"===d.type){const D=go(d.coordinates,E,S),O=gl(u.geometry(),y,E,S);if(!ia(y,E))return!1;for(const N of O)if(!bo(N,D))return!1}if("MultiPolygon"===d.type){const D=wr(d.coordinates,E,S),O=gl(u.geometry(),y,E,S);if(!ia(y,E))return!1;for(const N of O)if(!Zi(N,D))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(u,d){const y=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(!S)return!1;if("Polygon"===d.type){const D=go(d.coordinates,E,S),O=Ur(u.geometry(),y,E,S);if(!ia(y,E))return!1;for(const N of O)if(!oa(N,D))return!1}if("MultiPolygon"===d.type){const D=wr(d.coordinates,E,S),O=Ur(u.geometry(),y,E,S);if(!ia(y,E))return!1;for(const N of O)if(!Ri(N,D))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Hl=ea;function ja(a){if(a instanceof xi&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Hl)return!1;let o=!0;return a.eachChild(u=>{o&&!ja(u)&&(o=!1)}),o}function au(a){if(a instanceof xi&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(u=>{o&&!au(u)&&(o=!1)}),o}function bc(a,o){if(a instanceof xi&&o.indexOf(a.name)>=0)return!1;let u=!0;return a.eachChild(d=>{u&&!bc(d,o)&&(u=!1)}),u}class ki{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(2!==o.length||"string"!=typeof o[1])return u.error("'var' expression requires exactly one string literal argument.");const d=o[1];return u.scope.has(d)?new ki(d,u.scope.get(d)):u.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ls=ki;class us{constructor(o,u=[],d,y=new xc,E=[]){this.registry=o,this.path=u,this.key=u.map(S=>`[${S}]`).join(""),this.scope=y,this.errors=E,this.expectedType=d}parse(o,u,d,y,E={}){return u?this.concat(u,d,y)._parse(o,E):this._parse(o,E)}_parse(o,u){function d(y,E,S){return"assert"===S?new Ns(E,[y]):"coerce"===S?new Sl(E,[y]):y}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=o[0];if("string"!=typeof y)return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[y];if(E){let S=E.parse(o,this);if(!S)return null;if(this.expectedType){const D=this.expectedType,O=S.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==O.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==O.kind&&"string"!==O.kind){if(this.checkSubtype(D,O))return null}else S=d(S,D,u.typeAnnotation||"coerce");else S=d(S,D,u.typeAnnotation||"assert")}if(!(S instanceof bs)&&"resolvedImage"!==S.type.kind&&Fi(S)){const D=new Gu;try{S=new bs(S.type,S.evaluate(D))}catch(O){return this.error(O.message),null}}return S}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,d){const y="number"==typeof o?this.path.concat(o):this.path,E=d?this.scope.concat(d):this.scope;return new us(this.registry,y,u||null,E,this.errors)}error(o,...u){const d=`${this.key}${u.map(y=>`[${y}]`).join("")}`;this.errors.push(new Ni(d,o))}checkSubtype(o,u){const d=Mn(o,u);return d&&this.error(d),d}}var $u=us;function Fi(a){if(a instanceof ls)return Fi(a.boundExpression);if(a instanceof xi&&"error"===a.name||a instanceof Es||a instanceof Hl)return!1;const o=a instanceof Sl||a instanceof Ns;let u=!0;return a.eachChild(d=>{u=o?u&&Fi(d):u&&d instanceof bs}),!!u&&ja(a)&&bc(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xs(a,o){const u=a.length-1;let d,y,E=0,S=u,D=0;for(;E<=S;)if(D=Math.floor((E+S)/2),d=a[D],y=a[D+1],d<=o){if(D===u||o<y)return D;E=D+1}else{if(!(d>o))throw new ha("Input is not a number.");S=D-1}return 0}class ur{constructor(o,u,d){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[y,E]of d)this.labels.push(y),this.outputs.push(E)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const d=u.parse(o[1],1,hn);if(!d)return null;const y=[];let E=null;u.expectedType&&"value"!==u.expectedType.kind&&(E=u.expectedType);for(let S=1;S<o.length;S+=2){const D=1===S?-1/0:o[S],O=o[S+1],N=S,V=S+1;if("number"!=typeof D)return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(y.length&&y[y.length-1][0]>=D)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const $=u.parse(O,V,E);if(!$)return null;E=E||$.type,y.push([D,$])}return new ur(E,d,y)}evaluate(o){const u=this.labels,d=this.outputs;if(1===u.length)return d[0].evaluate(o);const y=this.input.evaluate(o);if(y<=u[0])return d[0].evaluate(o);const E=u.length;return y>=u[E-1]?d[E-1].evaluate(o):d[Xs(u,y)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o}}var Eo=ur;function er(a,o,u){return a*(1-u)+o*u}var Ga=Object.freeze({__proto__:null,number:er,color:function(a,o,u){return new sr(er(a.r,o.r,u),er(a.g,o.g,u),er(a.b,o.b,u),er(a.a,o.a,u))},array:function(a,o,u){return a.map((d,y)=>er(d,o[y],u))}});const lr=4/29,Yr=6/29,Or=3*Yr*Yr,ys=Math.PI/180,Wl=180/Math.PI;function Co(a){return a>.008856451679035631?Math.pow(a,1/3):a/Or+lr}function zs(a){return a>Yr?a*a*a:Or*(a-lr)}function Si(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function lu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Xl(a){const o=lu(a.r),u=lu(a.g),d=lu(a.b),y=Co((.4124564*o+.3575761*u+.1804375*d)/.95047),E=Co((.2126729*o+.7151522*u+.072175*d)/1);return{l:116*E-16,a:500*(y-E),b:200*(E-Co((.0193339*o+.119192*u+.9503041*d)/1.08883)),alpha:a.a}}function oi(a){let o=(a.l+16)/116,u=isNaN(a.a)?o:o+a.a/500,d=isNaN(a.b)?o:o-a.b/200;return o=1*zs(o),u=.95047*zs(u),d=1.08883*zs(d),new sr(Si(3.2404542*u-1.5371385*o-.4985314*d),Si(-.969266*u+1.8760108*o+.041556*d),Si(.0556434*u-.2040259*o+1.0572252*d),a.alpha)}function Zs(a,o,u){const d=o-a;return a+u*(d>180||d<-180?d-360*Math.round(d/360):d)}const $a={forward:Xl,reverse:oi,interpolate:function(a,o,u){return{l:er(a.l,o.l,u),a:er(a.a,o.a,u),b:er(a.b,o.b,u),alpha:er(a.alpha,o.alpha,u)}}},Cs={forward:function(a){const{l:o,a:u,b:d}=Xl(a),y=Math.atan2(d,u)*Wl;return{h:y<0?y+360:y,c:Math.sqrt(u*u+d*d),l:o,alpha:a.a}},reverse:function(a){const o=a.h*ys,u=a.c;return oi({l:a.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:a.alpha})},interpolate:function(a,o,u){return{h:Zs(a.h,o.h,u),c:er(a.c,o.c,u),l:er(a.l,o.l,u),alpha:er(a.alpha,o.alpha,u)}}};var da=Object.freeze({__proto__:null,lab:$a,hcl:Cs});class ts{constructor(o,u,d,y,E){this.type=o,this.operator=u,this.interpolation=d,this.input=y,this.labels=[],this.outputs=[];for(const[S,D]of E)this.labels.push(S),this.outputs.push(D)}static interpolationFactor(o,u,d,y){let E=0;if("exponential"===o.name)E=qa(u,o.base,d,y);else if("linear"===o.name)E=qa(u,1,d,y);else if("cubic-bezier"===o.name){const S=o.controlPoints;E=new X(S[0],S[1],S[2],S[3]).solve(qa(u,1,d,y))}return E}static parse(o,u){let[d,y,E,...S]=o;if(!Array.isArray(y)||0===y.length)return u.error("Expected an interpolation type expression.",1);if("linear"===y[0])y={name:"linear"};else if("exponential"===y[0]){const N=y[1];if("number"!=typeof N)return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:N}}else{if("cubic-bezier"!==y[0])return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const N=y.slice(1);if(4!==N.length||N.some(V=>"number"!=typeof V||V<0||V>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:N}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,hn),!E)return null;const D=[];let O=null;"interpolate-hcl"===d||"interpolate-lab"===d?O=On:u.expectedType&&"value"!==u.expectedType.kind&&(O=u.expectedType);for(let N=0;N<S.length;N+=2){const V=S[N],$=S[N+1],H=N+3,J=N+4;if("number"!=typeof V)return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(D.length&&D[D.length-1][0]>=V)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const ie=u.parse($,J,O);if(!ie)return null;O=O||ie.type,D.push([V,ie])}return"number"===O.kind||"color"===O.kind||"array"===O.kind&&"number"===O.itemType.kind&&"number"==typeof O.N?new ts(O,d,y,E,D):u.error(`Type ${Dt(O)} is not interpolatable.`)}evaluate(o){const u=this.labels,d=this.outputs;if(1===u.length)return d[0].evaluate(o);const y=this.input.evaluate(o);if(y<=u[0])return d[0].evaluate(o);const E=u.length;if(y>=u[E-1])return d[E-1].evaluate(o);const S=Xs(u,y),D=ts.interpolationFactor(this.interpolation,y,u[S],u[S+1]),O=d[S].evaluate(o),N=d[S+1].evaluate(o);return"interpolate"===this.operator?Ga[this.type.kind.toLowerCase()](O,N,D):"interpolate-hcl"===this.operator?Cs.reverse(Cs.interpolate(Cs.forward(O),Cs.forward(N),D)):$a.reverse($a.interpolate($a.forward(O),$a.forward(N),D))}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)u.push(this.labels[d],this.outputs[d].serialize());return u}}function qa(a,o,u,d){const y=d-u,E=a-u;return 0===y?0:1===o?E/y:(Math.pow(o,E)-1)/(Math.pow(o,y)-1)}var Ds=ts;class co{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let d=null;const y=u.expectedType;y&&"value"!==y.kind&&(d=y);const E=[];for(const D of o.slice(1)){const O=u.parse(D,1+E.length,d,void 0,{typeAnnotation:"omit"});if(!O)return null;d=d||O.type,E.push(O)}const S=y&&E.some(D=>Mn(y,D.type));return new co(S?G:d,E)}evaluate(o){let u,d=null,y=0;for(const E of this.args){if(y++,d=E.evaluate(o),d&&d instanceof pl&&!d.available&&(u||(u=d),d=null,y===this.args.length))return u;if(null!==d)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Pu=co;class Ru{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let E=1;E<o.length-1;E+=2){const S=o[E];if("string"!=typeof S)return u.error(`Expected string, but found ${typeof S} instead.`,E);if(/[^a-zA-Z0-9_]/.test(S))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const D=u.parse(o[E+1],E+1);if(!D)return null;d.push([S,D])}const y=u.parse(o[o.length-1],o.length-1,u.expectedType,d);return y?new Ru(d,y):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[u,d]of this.bindings)o.push(u,d.serialize());return o.push(this.result.serialize()),o}}var ui=Ru;class Tl{constructor(o,u,d){this.type=o,this.index=u,this.input=d}static parse(o,u){if(3!==o.length)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=u.parse(o[1],1,hn),y=u.parse(o[2],2,Mt(u.expectedType||G));return d&&y?new Tl(y.type.itemType,d,y):null}evaluate(o){const u=this.index.evaluate(o),d=this.input.evaluate(o);if(u<0)throw new ha(`Array index out of bounds: ${u} < 0.`);if(u>=d.length)throw new ha(`Array index out of bounds: ${u} > ${d.length-1}.`);if(u!==Math.floor(u))throw new ha(`Array index must be an integer, but found ${u} instead.`);return d[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Zl=Tl;class Ft{constructor(o,u){this.type=Ti,this.needle=o,this.haystack=u}static parse(o,u){if(3!==o.length)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=u.parse(o[1],1,G),y=u.parse(o[2],2,G);return d&&y?Zn(d.type,[Ti,Qr,hn,ao,G])?new Ft(d,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dt(d.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(null==d)return!1;if(!Qn(u,["boolean","string","number","null"]))throw new ha(`Expected first argument to be of type boolean, string, number or null, but found ${Dt(zn(u))} instead.`);if(!Qn(d,["string","array"]))throw new ha(`Expected second argument to be of type array or string, but found ${Dt(zn(d))} instead.`);return d.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var rn=Ft;class Hn{constructor(o,u,d){this.type=hn,this.needle=o,this.haystack=u,this.fromIndex=d}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=u.parse(o[1],1,G),y=u.parse(o[2],2,G);if(!d||!y)return null;if(!Zn(d.type,[Ti,Qr,hn,ao,G]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dt(d.type)} instead`);if(4===o.length){const E=u.parse(o[3],3,hn);return E?new Hn(d,y,E):null}return new Hn(d,y)}evaluate(o){const u=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!Qn(u,["boolean","string","number","null"]))throw new ha(`Expected first argument to be of type boolean, string, number or null, but found ${Dt(zn(u))} instead.`);if(!Qn(d,["string","array"]))throw new ha(`Expected second argument to be of type array or string, but found ${Dt(zn(d))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(o);return d.indexOf(u,y)}return d.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ar=Hn;class Yi{constructor(o,u,d,y,E,S){this.inputType=o,this.type=u,this.input=d,this.cases=y,this.outputs=E,this.otherwise=S}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let d,y;u.expectedType&&"value"!==u.expectedType.kind&&(y=u.expectedType);const E={},S=[];for(let N=2;N<o.length-1;N+=2){let V=o[N];const $=o[N+1];Array.isArray(V)||(V=[V]);const H=u.concat(N);if(0===V.length)return H.error("Expected at least one branch label.");for(const ie of V){if("number"!=typeof ie&&"string"!=typeof ie)return H.error("Branch labels must be numbers or strings.");if("number"==typeof ie&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ie&&Math.floor(ie)!==ie)return H.error("Numeric branch labels must be integer values.");if(d){if(H.checkSubtype(d,zn(ie)))return null}else d=zn(ie);if(void 0!==E[String(ie)])return H.error("Branch labels must be unique.");E[String(ie)]=S.length}const J=u.parse($,N,y);if(!J)return null;y=y||J.type,S.push(J)}const D=u.parse(o[1],1,G);if(!D)return null;const O=u.parse(o[o.length-1],o.length-1,y);return O?"value"!==D.type.kind&&u.concat(1).checkSubtype(d,D.type)?null:new Yi(d,y,D,E,S,O):null}evaluate(o){const u=this.input.evaluate(o);return(zn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),d=[],y={};for(const S of u){const D=y[this.cases[S]];void 0===D?(y[this.cases[S]]=d.length,d.push([this.cases[S],[S]])):d[D][1].push(S)}const E=S=>"number"===this.inputType.kind?Number(S):S;for(const[S,D]of d)o.push(1===D.length?E(D[0]):D.map(E)),o.push(this.outputs[S].serialize());return o.push(this.otherwise.serialize()),o}}var ei=Yi;class ks{constructor(o,u,d){this.type=o,this.branches=u,this.otherwise=d}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let d;u.expectedType&&"value"!==u.expectedType.kind&&(d=u.expectedType);const y=[];for(let S=1;S<o.length-1;S+=2){const D=u.parse(o[S],S,Ti);if(!D)return null;const O=u.parse(o[S+1],S+1,d);if(!O)return null;y.push([D,O]),d=d||O.type}const E=u.parse(o[o.length-1],o.length-1,d);return E?new ks(d,y,E):null}evaluate(o){for(const[u,d]of this.branches)if(u.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,d]of this.branches)o(u),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Gi=ks;class Qi{constructor(o,u,d,y){this.type=o,this.input=u,this.beginIndex=d,this.endIndex=y}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=u.parse(o[1],1,G),y=u.parse(o[2],2,hn);if(!d||!y)return null;if(!Zn(d.type,[Mt(G),Qr,G]))return u.error(`Expected first argument to be of type array or string, but found ${Dt(d.type)} instead`);if(4===o.length){const E=u.parse(o[3],3,hn);return E?new Qi(d.type,d,y,E):null}return new Qi(d.type,d,y)}evaluate(o){const u=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!Qn(u,["string","array"]))throw new ha(`Expected first argument to be of type array or string, but found ${Dt(zn(u))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(o);return u.slice(d,y)}return u.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Bi=Qi;function cs(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function So(a,o,u,d){return 0===d.compare(o,u)}function io(a,o,u){const d="=="!==a&&"!="!==a;return class jN{constructor(E,S,D){this.type=Ti,this.lhs=E,this.rhs=S,this.collator=D,this.hasUntypedArgument="value"===E.type.kind||"value"===S.type.kind}static parse(E,S){if(3!==E.length&&4!==E.length)return S.error("Expected two or three arguments.");const D=E[0];let O=S.parse(E[1],1,G);if(!O)return null;if(!cs(D,O.type))return S.concat(1).error(`"${D}" comparisons are not supported for type '${Dt(O.type)}'.`);let N=S.parse(E[2],2,G);if(!N)return null;if(!cs(D,N.type))return S.concat(2).error(`"${D}" comparisons are not supported for type '${Dt(N.type)}'.`);if(O.type.kind!==N.type.kind&&"value"!==O.type.kind&&"value"!==N.type.kind)return S.error(`Cannot compare types '${Dt(O.type)}' and '${Dt(N.type)}'.`);d&&("value"===O.type.kind&&"value"!==N.type.kind?O=new Ns(N.type,[O]):"value"!==O.type.kind&&"value"===N.type.kind&&(N=new Ns(O.type,[N])));let V=null;if(4===E.length){if("string"!==O.type.kind&&"string"!==N.type.kind&&"value"!==O.type.kind&&"value"!==N.type.kind)return S.error("Cannot use collator to compare non-string types.");if(V=S.parse(E[3],3,we),!V)return null}return new jN(O,N,V)}evaluate(E){const S=this.lhs.evaluate(E),D=this.rhs.evaluate(E);if(d&&this.hasUntypedArgument){const O=zn(S),N=zn(D);if(O.kind!==N.kind||"string"!==O.kind&&"number"!==O.kind)throw new ha(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${O.kind}, ${N.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const O=zn(S),N=zn(D);if("string"!==O.kind||"string"!==N.kind)return o(E,S,D)}return this.collator?u(E,S,D,this.collator.evaluate(E)):o(E,S,D)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}serialize(){const E=[a];return this.eachChild(S=>{E.push(S.serialize())}),E}}}const ta=io("==",function(a,o,u){return o===u},So),uu=io("!=",function(a,o,u){return o!==u},function(a,o,u,d){return!So(0,o,u,d)}),Il=io("<",function(a,o,u){return o<u},function(a,o,u,d){return d.compare(o,u)<0}),Ml=io(">",function(a,o,u){return o>u},function(a,o,u,d){return d.compare(o,u)>0}),Ja=io("<=",function(a,o,u){return o<=u},function(a,o,u,d){return d.compare(o,u)<=0}),Ys=io(">=",function(a,o,u){return o>=u},function(a,o,u,d){return d.compare(o,u)>=0});class sl{constructor(o,u,d,y,E,S){this.type=Qr,this.number=o,this.locale=u,this.currency=d,this.unit=y,this.minFractionDigits=E,this.maxFractionDigits=S}static parse(o,u){if(3!==o.length)return u.error("Expected two arguments.");const d=u.parse(o[1],1,hn);if(!d)return null;const y=o[2];if("object"!=typeof y||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let E=null;if(y.locale&&(E=u.parse(y.locale,1,Qr),!E))return null;let S=null;if(y.currency&&(S=u.parse(y.currency,1,Qr),!S))return null;let D=null;if(y.unit&&(D=u.parse(y.unit,1,Qr),!D))return null;let O=null;if(y["min-fraction-digits"]&&(O=u.parse(y["min-fraction-digits"],1,hn),!O))return null;let N=null;return y["max-fraction-digits"]&&(N=u.parse(y["max-fraction-digits"],1,hn),!N)?null:new sl(d,E,S,D,O,N)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class ba{constructor(o){this.type=hn,this.input=o}static parse(o,u){if(2!==o.length)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=u.parse(o[1],1);return d?"array"!==d.type.kind&&"string"!==d.type.kind&&"value"!==d.type.kind?u.error(`Expected argument of type string or array, but found ${Dt(d.type)} instead.`):new ba(d):null}evaluate(o){const u=this.input.evaluate(o);if("string"==typeof u||Array.isArray(u))return u.length;throw new ha(`Expected value to be of type string or array, but found ${Dt(zn(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(u=>{o.push(u.serialize())}),o}}const af={"==":ta,"!=":uu,">":Ml,"<":Il,">=":Ys,"<=":Ja,array:Ns,at:Zl,boolean:Ns,case:Gi,coalesce:Pu,collator:Es,format:ou,image:xa,in:rn,"index-of":Ar,interpolate:Ds,"interpolate-hcl":Ds,"interpolate-lab":Ds,length:ba,let:ui,literal:bs,match:ei,number:Ns,"number-format":sl,object:Ns,slice:Bi,step:Eo,string:Ns,"to-boolean":Sl,"to-color":Sl,"to-number":Sl,"to-string":Sl,var:ls,within:Hl};function no(a,[o,u,d,y]){o=o.evaluate(a),u=u.evaluate(a),d=d.evaluate(a);const E=y?y.evaluate(a):1,S=ji(o,u,d,E);if(S)throw new ha(S);return new sr(o/255*E,u/255*E,d/255*E,E)}function ro(a,o){return a in o}function Us(a,o){const u=o[a];return void 0===u?null:u}function mo(a){return{type:a}}xi.register(af,{error:[{kind:"error"},[Qr],(a,[o])=>{throw new ha(o.evaluate(a))}],typeof:[Qr,[G],(a,[o])=>Dt(zn(o.evaluate(a)))],"to-rgba":[Mt(hn,4),[On],(a,[o])=>o.evaluate(a).toArray()],rgb:[On,[hn,hn,hn],no],rgba:[On,[hn,hn,hn,hn],no],has:{type:Ti,overloads:[[[Qr],(a,[o])=>ro(o.evaluate(a),a.properties())],[[Qr,k],(a,[o,u])=>ro(o.evaluate(a),u.evaluate(a))]]},get:{type:G,overloads:[[[Qr],(a,[o])=>Us(o.evaluate(a),a.properties())],[[Qr,k],(a,[o,u])=>Us(o.evaluate(a),u.evaluate(a))]]},"feature-state":[G,[Qr],(a,[o])=>Us(o.evaluate(a),a.featureState||{})],properties:[k,[],a=>a.properties()],"geometry-type":[Qr,[],a=>a.geometryType()],id:[G,[],a=>a.id()],zoom:[hn,[],a=>a.globals.zoom],pitch:[hn,[],a=>a.globals.pitch||0],"distance-from-center":[hn,[],a=>a.distanceFromCenter()],"heatmap-density":[hn,[],a=>a.globals.heatmapDensity||0],"line-progress":[hn,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[hn,[],a=>a.globals.skyRadialProgress||0],accumulated:[G,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[hn,mo(hn),(a,o)=>{let u=0;for(const d of o)u+=d.evaluate(a);return u}],"*":[hn,mo(hn),(a,o)=>{let u=1;for(const d of o)u*=d.evaluate(a);return u}],"-":{type:hn,overloads:[[[hn,hn],(a,[o,u])=>o.evaluate(a)-u.evaluate(a)],[[hn],(a,[o])=>-o.evaluate(a)]]},"/":[hn,[hn,hn],(a,[o,u])=>o.evaluate(a)/u.evaluate(a)],"%":[hn,[hn,hn],(a,[o,u])=>o.evaluate(a)%u.evaluate(a)],ln2:[hn,[],()=>Math.LN2],pi:[hn,[],()=>Math.PI],e:[hn,[],()=>Math.E],"^":[hn,[hn,hn],(a,[o,u])=>Math.pow(o.evaluate(a),u.evaluate(a))],sqrt:[hn,[hn],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[hn,[hn],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[hn,[hn],(a,[o])=>Math.log(o.evaluate(a))],log2:[hn,[hn],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[hn,[hn],(a,[o])=>Math.sin(o.evaluate(a))],cos:[hn,[hn],(a,[o])=>Math.cos(o.evaluate(a))],tan:[hn,[hn],(a,[o])=>Math.tan(o.evaluate(a))],asin:[hn,[hn],(a,[o])=>Math.asin(o.evaluate(a))],acos:[hn,[hn],(a,[o])=>Math.acos(o.evaluate(a))],atan:[hn,[hn],(a,[o])=>Math.atan(o.evaluate(a))],min:[hn,mo(hn),(a,o)=>Math.min(...o.map(u=>u.evaluate(a)))],max:[hn,mo(hn),(a,o)=>Math.max(...o.map(u=>u.evaluate(a)))],abs:[hn,[hn],(a,[o])=>Math.abs(o.evaluate(a))],round:[hn,[hn],(a,[o])=>{const u=o.evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[hn,[hn],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[hn,[hn],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Ti,[Qr,G],(a,[o,u])=>a.properties()[o.value]===u.value],"filter-id-==":[Ti,[G],(a,[o])=>a.id()===o.value],"filter-type-==":[Ti,[Qr],(a,[o])=>a.geometryType()===o.value],"filter-<":[Ti,[Qr,G],(a,[o,u])=>{const d=a.properties()[o.value],y=u.value;return typeof d==typeof y&&d<y}],"filter-id-<":[Ti,[G],(a,[o])=>{const u=a.id(),d=o.value;return typeof u==typeof d&&u<d}],"filter->":[Ti,[Qr,G],(a,[o,u])=>{const d=a.properties()[o.value],y=u.value;return typeof d==typeof y&&d>y}],"filter-id->":[Ti,[G],(a,[o])=>{const u=a.id(),d=o.value;return typeof u==typeof d&&u>d}],"filter-<=":[Ti,[Qr,G],(a,[o,u])=>{const d=a.properties()[o.value],y=u.value;return typeof d==typeof y&&d<=y}],"filter-id-<=":[Ti,[G],(a,[o])=>{const u=a.id(),d=o.value;return typeof u==typeof d&&u<=d}],"filter->=":[Ti,[Qr,G],(a,[o,u])=>{const d=a.properties()[o.value],y=u.value;return typeof d==typeof y&&d>=y}],"filter-id->=":[Ti,[G],(a,[o])=>{const u=a.id(),d=o.value;return typeof u==typeof d&&u>=d}],"filter-has":[Ti,[G],(a,[o])=>o.value in a.properties()],"filter-has-id":[Ti,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Ti,[Mt(Qr)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ti,[Mt(G)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Ti,[Qr,Mt(G)],(a,[o,u])=>u.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Ti,[Qr,Mt(G)],(a,[o,u])=>function(d,y,E,S){for(;E<=S;){const D=E+S>>1;if(y[D]===d)return!0;y[D]>d?S=D-1:E=D+1}return!1}(a.properties()[o.value],u.value,0,u.value.length-1)],all:{type:Ti,overloads:[[[Ti,Ti],(a,[o,u])=>o.evaluate(a)&&u.evaluate(a)],[mo(Ti),(a,o)=>{for(const u of o)if(!u.evaluate(a))return!1;return!0}]]},any:{type:Ti,overloads:[[[Ti,Ti],(a,[o,u])=>o.evaluate(a)||u.evaluate(a)],[mo(Ti),(a,o)=>{for(const u of o)if(u.evaluate(a))return!0;return!1}]]},"!":[Ti,[Ti],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Ti,[Qr],(a,[o])=>{const u=a.globals&&a.globals.isSupportedScript;return!u||u(o.evaluate(a))}],upcase:[Qr,[Qr],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Qr,[Qr],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Qr,mo(G),(a,o)=>o.map(u=>Ci(u.evaluate(a))).join("")],"resolved-locale":[Qr,[we],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Aa=af;function _s(a){return{result:"success",value:a}}function al(a){return{result:"error",value:a}}function Pa(a){return"data-driven"===a["property-type"]}function pa(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ks(a){return!!a.expression&&a.expression.interpolated}function ci(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function vs(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Mh(a){return a}function Qa(a,o){const u="color"===o.type,d=a.stops&&"object"==typeof a.stops[0][0],y=d||!(d||void 0!==a.property),E=a.type||(Ks(o)?"exponential":"interval");if(u&&((a=ca({},a)).stops&&(a.stops=a.stops.map(N=>[N[0],sr.parse(N[1])])),a.default=sr.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!da[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let S,D,O;if("exponential"===E)S=Yl;else if("interval"===E)S=Oa;else if("categorical"===E){S=Ra,D=Object.create(null);for(const N of a.stops)D[N[0]]=N[1];O=typeof a.stops[0][0]}else{if("identity"!==E)throw new Error(`Unknown function type "${E}"`);S=el}if(d){const N={},V=[];for(let J=0;J<a.stops.length;J++){const ie=a.stops[J],pe=ie[0].zoom;void 0===N[pe]&&(N[pe]={zoom:pe,type:a.type,property:a.property,default:a.default,stops:[]},V.push(pe)),N[pe].stops.push([ie[0].value,ie[1]])}const $=[];for(const J of V)$.push([N[J].zoom,Qa(N[J],o)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Ds.interpolationFactor.bind(void 0,H),zoomStops:$.map(J=>J[0]),evaluate:({zoom:J},ie)=>Yl({stops:$,base:a.base},o,J).evaluate(J,ie)}}if(y){const N="exponential"===E?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Ds.interpolationFactor.bind(void 0,N),zoomStops:a.stops.map(V=>V[0]),evaluate:({zoom:V})=>S(a,o,V,D,O)}}return{kind:"source",evaluate(N,V){const $=V&&V.properties?V.properties[a.property]:void 0;return void 0===$?ho(a.default,o.default):S(a,o,$,D,O)}}}function ho(a,o,u){return void 0!==a?a:void 0!==o?o:void 0!==u?u:void 0}function Ra(a,o,u,d,y){return ho(typeof u===y?d[u]:void 0,a.default,o.default)}function Oa(a,o,u){if("number"!==ci(u))return ho(a.default,o.default);const d=a.stops.length;if(1===d||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[d-1][0])return a.stops[d-1][1];const y=Xs(a.stops.map(E=>E[0]),u);return a.stops[y][1]}function Yl(a,o,u){const d=void 0!==a.base?a.base:1;if("number"!==ci(u))return ho(a.default,o.default);const y=a.stops.length;if(1===y||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[y-1][0])return a.stops[y-1][1];const E=Xs(a.stops.map(V=>V[0]),u),S=function(V,$,H,J){const ie=J-H,pe=V-H;return 0===ie?0:1===$?pe/ie:(Math.pow($,pe)-1)/(Math.pow($,ie)-1)}(u,d,a.stops[E][0],a.stops[E+1][0]),D=a.stops[E][1],O=a.stops[E+1][1];let N=Ga[o.type]||Mh;if(a.colorSpace&&"rgb"!==a.colorSpace){const V=da[a.colorSpace];N=($,H)=>V.reverse(V.interpolate(V.forward($),V.forward(H),S))}return"function"==typeof D.evaluate?{evaluate(...V){const $=D.evaluate.apply(void 0,V),H=O.evaluate.apply(void 0,V);if(void 0!==$&&void 0!==H)return N($,H,S)}}:N(D,O,S)}function el(a,o,u){return"color"===o.type?u=sr.parse(u):"formatted"===o.type?u=vi.fromString(u.toString()):"resolvedImage"===o.type?u=pl.fromString(u.toString()):ci(u)===o.type||"enum"===o.type&&o.values[u]||(u=void 0),ho(u,a.default,o.default)}class Dl{constructor(o,u){var d;this.expression=o,this._warningHistory={},this._evaluator=new Gu,this._defaultValue=u?"color"===(d=u).type&&(vs(d.default)||Array.isArray(d.default))?new sr(0,0,0,0):"color"===d.type?sr.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=u&&"enum"===u.type?u.values:null}evaluateWithoutErrorHandling(o,u,d,y,E,S,D,O){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=d,this._evaluator.canonical=y||null,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=O||null,this.expression.evaluate(this._evaluator)}evaluate(o,u,d,y,E,S,D,O){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=d||null,this._evaluator.canonical=y||null,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S||null,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=O||null;try{const N=this.expression.evaluate(this._evaluator);if(null==N||"number"==typeof N&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new ha(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(N)} instead.`);return N}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}}}function sa(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Aa}function ll(a,o){const u=new $u(Aa,[],o?function(y){const E={color:On,string:Qr,number:hn,enum:Qr,boolean:Ti,formatted:st,resolvedImage:at};return"array"===y.type?Mt(E[y.value]||G,y.length):E[y.type]}(o):void 0),d=u.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return d?_s(new Dl(d,o)):al(u.errors)}class As{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent="constant"!==o&&!au(u.expression)}evaluateWithoutErrorHandling(o,u,d,y,E,S){return this._styleExpression.evaluateWithoutErrorHandling(o,u,d,y,E,S)}evaluate(o,u,d,y,E,S){return this._styleExpression.evaluate(o,u,d,y,E,S)}}class qu{constructor(o,u,d,y){this.kind=o,this.zoomStops=d,this._styleExpression=u,this.isStateDependent="camera"!==o&&!au(u.expression),this.interpolationType=y}evaluateWithoutErrorHandling(o,u,d,y,E,S){return this._styleExpression.evaluateWithoutErrorHandling(o,u,d,y,E,S)}evaluate(o,u,d,y,E,S){return this._styleExpression.evaluate(o,u,d,y,E,S)}interpolationFactor(o,u,d){return this.interpolationType?Ds.interpolationFactor(this.interpolationType,o,u,d):0}}function Ec(a,o){if("error"===(a=ll(a,o)).result)return a;const u=a.value.expression,d=ja(u);if(!d&&!Pa(o))return al([new Ni("","data expressions not supported")]);const y=bc(u,["zoom","pitch","distance-from-center"]);if(!y&&!pa(o))return al([new Ni("","zoom expressions not supported")]);const E=Al(u);return E||y?E instanceof Ni?al([E]):E instanceof Ds&&!Ks(o)?al([new Ni("",'"interpolate" expressions cannot be used with this property')]):_s(E?new qu(d?"camera":"composite",a.value,E.labels,E instanceof Ds?E.interpolation:void 0):new As(d?"constant":"source",a.value)):al([new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class To{constructor(o,u){this._parameters=o,this._specification=u,ca(this,Qa(this._parameters,this._specification))}static deserialize(o){return new To(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Al(a){let o=null;if(a instanceof ui)o=Al(a.result);else if(a instanceof Pu){for(const u of a.args)if(o=Al(u),o)break}else(a instanceof Eo||a instanceof Ds)&&a.input instanceof xi&&"zoom"===a.input.name&&(o=a);return o instanceof Ni||a.eachChild(u=>{const d=Al(u);d instanceof Ni?o=d:!o&&d?o=new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&d&&o!==d&&(o=new Ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class tr{constructor(o,u,d,y){this.message=(o?`${o}: `:"")+d,y&&(this.identifier=y),null!=u&&u.__line__&&(this.line=u.__line__)}}function La(a){const o=a.key,u=a.value,d=a.valueSpec||{},y=a.objectElementValidators||{},E=a.style,S=a.styleSpec;let D=[];const O=ci(u);if("object"!==O)return[new tr(o,u,`object expected, ${O} found`)];for(const N in u){const V=N.split(".")[0],$=d[V]||d["*"];let H;y[V]?H=y[V]:d[V]?H=l:y["*"]?H=y["*"]:d["*"]&&(H=l),H?D=D.concat(H({key:(o&&`${o}.`)+N,value:u[N],valueSpec:$,style:E,styleSpec:S,object:u,objectKey:N},u)):D.push(new tr(o,u[N],`unknown property "${N}"`))}for(const N in d)y[N]||d[N].required&&void 0===d[N].default&&void 0===u[N]&&D.push(new tr(o,u,`missing required property "${N}"`));return D}function Hu(a){const o=a.value,u=a.valueSpec,d=a.style,y=a.styleSpec,E=a.key,S=a.arrayElementValidator||l;if("array"!==ci(o))return[new tr(E,o,`array expected, ${ci(o)} found`)];if(u.length&&o.length!==u.length)return[new tr(E,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new tr(E,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let D={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};y.$version<7&&(D.function=u.function),"object"===ci(u.value)&&(D=u.value);let O=[];for(let N=0;N<o.length;N++)O=O.concat(S({array:o,arrayIndex:N,value:o[N],valueSpec:D,style:d,styleSpec:y,key:`${E}[${N}]`}));return O}function ga(a){const o=a.key,u=a.value,d=a.valueSpec;let y=ci(u);if("number"===y&&u!=u&&(y="NaN"),"number"!==y)return[new tr(o,u,`number expected, ${y} found`)];if("minimum"in d){let E=d.minimum;if("array"===ci(d.minimum)&&(E=d.minimum[a.arrayIndex]),u<E)return[new tr(o,u,`${u} is less than the minimum value ${E}`)]}if("maximum"in d){let E=d.maximum;if("array"===ci(d.maximum)&&(E=d.maximum[a.arrayIndex]),u>E)return[new tr(o,u,`${u} is greater than the maximum value ${E}`)]}return[]}function $i(a){const o=a.valueSpec,u=so(a.value.type);let d,y,E,S={};const D="categorical"!==u&&void 0===a.value.property,O=!D,N="array"===ci(a.value.stops)&&"array"===ci(a.value.stops[0])&&"object"===ci(a.value.stops[0][0]),V=La({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(J){if("identity"===u)return[new tr(J.key,J.value,'identity function may not have a "stops" property')];let ie=[];const pe=J.value;return ie=ie.concat(Hu({key:J.key,value:pe,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:$})),"array"===ci(pe)&&0===pe.length&&ie.push(new tr(J.key,pe,"array must have at least one stop")),ie},default:function(J){return l({key:J.key,value:J.value,valueSpec:o,style:J.style,styleSpec:J.styleSpec})}}});return"identity"===u&&D&&V.push(new tr(a.key,a.value,'missing required property "property"')),"identity"===u||a.value.stops||V.push(new tr(a.key,a.value,'missing required property "stops"')),"exponential"===u&&a.valueSpec.expression&&!Ks(a.valueSpec)&&V.push(new tr(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(O&&!Pa(a.valueSpec)?V.push(new tr(a.key,a.value,"property functions not supported")):D&&!pa(a.valueSpec)&&V.push(new tr(a.key,a.value,"zoom functions not supported"))),"categorical"!==u&&!N||void 0!==a.value.property||V.push(new tr(a.key,a.value,'"property" property is required')),V;function $(J){let ie=[];const pe=J.value,Ne=J.key;if("array"!==ci(pe))return[new tr(Ne,pe,`array expected, ${ci(pe)} found`)];if(2!==pe.length)return[new tr(Ne,pe,`array length 2 expected, length ${pe.length} found`)];if(N){if("object"!==ci(pe[0]))return[new tr(Ne,pe,`object expected, ${ci(pe[0])} found`)];if(void 0===pe[0].zoom)return[new tr(Ne,pe,"object stop key must have zoom")];if(void 0===pe[0].value)return[new tr(Ne,pe,"object stop key must have value")];const Qe=so(pe[0].zoom);if("number"!=typeof Qe)return[new tr(Ne,pe[0].zoom,"stop zoom values must be numbers")];if(E&&E>Qe)return[new tr(Ne,pe[0].zoom,"stop zoom values must appear in ascending order")];Qe!==E&&(E=Qe,y=void 0,S={}),ie=ie.concat(La({key:`${Ne}[0]`,value:pe[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:ga,value:H}}))}else ie=ie.concat(H({key:`${Ne}[0]`,value:pe[0],valueSpec:{},style:J.style,styleSpec:J.styleSpec},pe));return sa(di(pe[1]))?ie.concat([new tr(`${Ne}[1]`,pe[1],"expressions are not allowed in function stops.")]):ie.concat(l({key:`${Ne}[1]`,value:pe[1],valueSpec:o,style:J.style,styleSpec:J.styleSpec}))}function H(J,ie){const pe=ci(J.value),Ne=so(J.value),Qe=null!==J.value?J.value:ie;if(d){if(pe!==d)return[new tr(J.key,Qe,`${pe} stop domain type must match previous stop domain type ${d}`)]}else d=pe;if("number"!==pe&&"string"!==pe&&"boolean"!==pe&&"number"!=typeof Ne&&"string"!=typeof Ne&&"boolean"!=typeof Ne)return[new tr(J.key,Qe,"stop domain value must be a number, string, or boolean")];if("number"!==pe&&"categorical"!==u){let ft=`number expected, ${pe} found`;return Pa(o)&&void 0===u&&(ft+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new tr(J.key,Qe,ft)]}return"categorical"!==u||"number"!==pe||"number"==typeof Ne&&isFinite(Ne)&&Math.floor(Ne)===Ne?"categorical"!==u&&"number"===pe&&"number"==typeof Ne&&"number"==typeof y&&void 0!==y&&Ne<y?[new tr(J.key,Qe,"stop domain values must appear in ascending order")]:(y=Ne,"categorical"===u&&Ne in S?[new tr(J.key,Qe,"stop domain values must be unique")]:(S[Ne]=!0,[])):[new tr(J.key,Qe,`integer expected, found ${String(Ne)}`)]}}function Wu(a){const o=("property"===a.expressionContext?Ec:ll)(di(a.value),a.valueSpec);if("error"===o.result)return o.value.map(d=>new tr(`${a.key}${d.key}`,a.value,d.message));const u=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!u.outputDefined())return[new tr(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!au(u))return[new tr(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return ml(u,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!bc(u,["zoom","feature-state"]))return[new tr(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!ja(u))return[new tr(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ml(a,o){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const y of o.valueSpec.expression.parameters)u.delete(y);if(0===u.size)return[];const d=[];return a instanceof xi&&u.has(a.name)?[new tr(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(y=>{d.push(...ml(y,o))}),d)}function tc(a){const o=a.key,u=a.value,d=a.valueSpec,y=[];return Array.isArray(d.values)?-1===d.values.indexOf(so(u))&&y.push(new tr(o,u,`expected one of [${d.values.join(", ")}], ${JSON.stringify(u)} found`)):-1===Object.keys(d.values).indexOf(so(u))&&y.push(new tr(o,u,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function tl(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!tl(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function aa(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};tl(a)||(a=Ea(a));const u=a;let d=!0;try{d=function(N){if(!hs(N))return N;let V=di(N);return Na(V),V=Fc(V),V}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(u,null,2)}\n        `)}const y=Yt[`filter_${o}`],E=ll(d,y);let S=null;if("error"===E.result)throw new Error(E.value.map(N=>`${N.key}: ${N.message}`).join(", "));S=(N,V,$)=>E.value.evaluate(N,V,{},$);let D=null,O=null;if(d!==u){const N=ll(u,y);if("error"===N.result)throw new Error(N.value.map(V=>`${V.key}: ${V.message}`).join(", "));D=(V,$,H,J,ie)=>N.value.evaluate(V,$,{},H,void 0,void 0,J,ie),O=!ja(N.value.expression)}return{filter:S,dynamicFilter:D||void 0,needGeometry:xd(d),needFeature:!!O}}function Fc(a){if(!Array.isArray(a))return a;const o=function(u){if(Cc.has(u[0]))for(let d=1;d<u.length;d++)if(hs(u[d]))return!0;return u}(a);return!0===o?o:o.map(u=>Fc(u))}function Na(a){let o=!1;const u=[];if("case"===a[0]){for(let d=1;d<a.length-1;d+=2)o=o||hs(a[d]),u.push(a[d+1]);u.push(a[a.length-1])}else if("match"===a[0]){o=o||hs(a[1]);for(let d=2;d<a.length-1;d+=2)u.push(a[d+1]);u.push(a[a.length-1])}else if("step"===a[0]){o=o||hs(a[1]);for(let d=1;d<a.length-1;d+=2)u.push(a[d+1])}o&&(a.length=0,a.push("any",...u));for(let d=1;d<a.length;d++)Na(a[d])}function hs(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let u=1;u<a.length;u++)if(hs(a[u]))return!0;return!1}const Cc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function lf(a,o){return a<o?-1:a>o?1:0}function xd(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(xd(a[o]))return!0;return!1}function Ea(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?nc(a[1],a[2],"=="):"!="===o?vu(nc(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?nc(a[1],a[2],o):"any"===o?(u=a.slice(1),["any"].concat(u.map(Ea))):"all"===o?["all"].concat(a.slice(1).map(Ea)):"none"===o?["all"].concat(a.slice(1).map(Ea).map(vu)):"in"===o?Ou(a[1],a.slice(2)):"!in"===o?vu(Ou(a[1],a.slice(2))):"has"===o?mi(a[1]):"!has"===o?vu(mi(a[1])):"within"!==o||a;var u}function nc(a,o,u){switch(a){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,a,o]}}function Ou(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",a,["literal",o.sort(lf)]]:["filter-in-small",a,["literal",o]]}}function mi(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function vu(a){return["!",a]}function rc(a){return tl(di(a.value))?Wu(ca({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):rh(a)}function rh(a){const o=a.value,u=a.key;if("array"!==ci(o))return[new tr(u,o,`array expected, ${ci(o)} found`)];const d=a.styleSpec;let y,E=[];if(o.length<1)return[new tr(u,o,"filter array must have at least 1 element")];switch(E=E.concat(tc({key:`${u}[0]`,value:o[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),so(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===so(o[1])&&E.push(new tr(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&E.push(new tr(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(y=ci(o[1]),"string"!==y&&E.push(new tr(`${u}[1]`,o[1],`string expected, ${y} found`)));for(let S=2;S<o.length;S++)y=ci(o[S]),"$type"===so(o[1])?E=E.concat(tc({key:`${u}[${S}]`,value:o[S],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==y&&"number"!==y&&"boolean"!==y&&E.push(new tr(`${u}[${S}]`,o[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)E=E.concat(rh({key:`${u}[${S}]`,value:o[S],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":y=ci(o[1]),2!==o.length?E.push(new tr(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==y&&E.push(new tr(`${u}[1]`,o[1],`string expected, ${y} found`));break;case"within":y=ci(o[1]),2!==o.length?E.push(new tr(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==y&&E.push(new tr(`${u}[1]`,o[1],`object expected, ${y} found`))}return E}function ic(a,o){const u=a.key,d=a.style,y=a.styleSpec,E=a.value,S=a.objectKey,D=y[`${o}_${a.layerType}`];if(!D)return[];const O=S.match(/^(.*)-transition$/);if("paint"===o&&O&&D[O[1]]&&D[O[1]].transition)return l({key:u,value:E,valueSpec:y.transition,style:d,styleSpec:y});const N=a.valueSpec||D[S];if(!N)return[new tr(u,E,`unknown property "${S}"`)];let V;if("string"===ci(E)&&Pa(N)&&!N.tokens&&(V=/^{([^}]+)}$/.exec(E)))return[new tr(u,E,`"${S}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const $=[];return"symbol"===a.layerType&&("text-field"===S&&d&&!d.glyphs&&$.push(new tr(u,E,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&vs(di(E))&&"identity"===so(E.type)&&$.push(new tr(u,E,'"text-font" does not support identity functions'))),$.concat(l({key:a.key,value:E,valueSpec:N,style:d,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function oc(a){return ic(a,"paint")}function ti(a){return ic(a,"layout")}function Lu(a){let o=[];const u=a.value,d=a.key,y=a.style,E=a.styleSpec;u.type||u.ref||o.push(new tr(d,u,'either "type" or "ref" is required'));let S=so(u.type);const D=so(u.ref);if(u.id){const O=so(u.id);for(let N=0;N<a.arrayIndex;N++){const V=y.layers[N];so(V.id)===O&&o.push(new tr(d,u.id,`duplicate layer id "${u.id}", previously used at line ${V.id.__line__}`))}}if("ref"in u){let O;["type","source","source-layer","filter","layout"].forEach(N=>{N in u&&o.push(new tr(d,u[N],`"${N}" is prohibited for ref layers`))}),y.layers.forEach(N=>{so(N.id)===D&&(O=N)}),O?O.ref?o.push(new tr(d,u.ref,"ref cannot reference another ref layer")):S=so(O.type):"string"==typeof D&&o.push(new tr(d,u.ref,`ref layer "${D}" not found`))}else if("background"!==S&&"sky"!==S)if(u.source){const O=y.sources&&y.sources[u.source],N=O&&so(O.type);O?"vector"===N&&"raster"===S?o.push(new tr(d,u.source,`layer "${u.id}" requires a raster source`)):"raster"===N&&"raster"!==S?o.push(new tr(d,u.source,`layer "${u.id}" requires a vector source`)):"vector"!==N||u["source-layer"]?"raster-dem"===N&&"hillshade"!==S?o.push(new tr(d,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==S||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||"geojson"===N&&O.lineMetrics||o.push(new tr(d,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new tr(d,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new tr(d,u.source,`source "${u.source}" not found`))}else o.push(new tr(d,u,'missing required property "source"'));return o=o.concat(La({key:d,value:u,valueSpec:E.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>l({key:`${d}.type`,value:u.type,valueSpec:E.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"}),filter:O=>rc(ca({layerType:S},O)),layout:O=>La({layer:u,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":N=>ti(ca({layerType:S},N))}}),paint:O=>La({layer:u,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":N=>oc(ca({layerType:S},N))}})}})),o}function Nu(a){const o=a.value,u=a.key,d=ci(o);return"string"!==d?[new tr(u,o,`string expected, ${d} found`)]:[]}const Dn={promoteId:function({key:a,value:o}){if("string"===ci(o))return Nu({key:a,value:o});{const u=[];for(const d in o)u.push(...Nu({key:`${a}.${d}`,value:o[d]}));return u}}};function si(a){const o=a.value,u=a.key,d=a.styleSpec,y=a.style;if(!o.type)return[new tr(u,o,'"type" is required')];const E=so(o.type);let S;switch(E){case"vector":case"raster":case"raster-dem":return S=La({key:u,value:o,valueSpec:d[`source_${E.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:Dn}),S;case"geojson":if(S=La({key:u,value:o,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:Dn}),o.cluster)for(const D in o.clusterProperties){const[O,N]=o.clusterProperties[D],V="string"==typeof O?[O,["accumulated"],["get",D]]:O;S.push(...Wu({key:`${u}.${D}.map`,value:N,expressionContext:"cluster-map"})),S.push(...Wu({key:`${u}.${D}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return S;case"video":return La({key:u,value:o,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return La({key:u,value:o,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new tr(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tc({key:`${u}.type`,value:o.type,valueSpec:{values:kf(d)},style:y,styleSpec:d})}}function kf(a){return a.source.reduce((o,u)=>{const d=a[u];return"enum"===d.type.type&&(o=o.concat(Object.keys(d.type.values))),o},[])}function yl(a){const o=a.value,u=a.styleSpec,d=u.light,y=a.style;let E=[];const S=ci(o);if(void 0===o)return E;if("object"!==S)return E=E.concat([new tr("light",o,`object expected, ${S} found`)]),E;for(const D in o){const O=D.match(/^(.*)-transition$/);E=E.concat(O&&d[O[1]]&&d[O[1]].transition?l({key:D,value:o[D],valueSpec:u.transition,style:y,styleSpec:u}):d[D]?l({key:D,value:o[D],valueSpec:d[D],style:y,styleSpec:u}):[new tr(D,o[D],`unknown property "${D}"`)])}return E}function Oi(a){const o=a.value,u=a.key,d=a.style,y=a.styleSpec,E=y.terrain;let S=[];const D=ci(o);if(void 0===o)return S;if("object"!==D)return S=S.concat([new tr("terrain",o,`object expected, ${D} found`)]),S;for(const O in o){const N=O.match(/^(.*)-transition$/);S=S.concat(N&&E[N[1]]&&E[N[1]].transition?l({key:O,value:o[O],valueSpec:y.transition,style:d,styleSpec:y}):E[O]?l({key:O,value:o[O],valueSpec:E[O],style:d,styleSpec:y}):[new tr(O,o[O],`unknown property "${O}"`)])}if(o.source){const O=d.sources&&d.sources[o.source],N=O&&so(O.type);O?"raster-dem"!==N&&S.push(new tr(u,o.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):S.push(new tr(u,o.source,`source "${o.source}" not found`))}else S.push(new tr(u,o,'terrain is missing required property "source"'));return S}function uf(a){const o=a.value,u=a.style,d=a.styleSpec,y=d.fog;let E=[];const S=ci(o);if(void 0===o)return E;if("object"!==S)return E=E.concat([new tr("fog",o,`object expected, ${S} found`)]),E;for(const D in o){const O=D.match(/^(.*)-transition$/);E=E.concat(O&&y[O[1]]&&y[O[1]].transition?l({key:D,value:o[D],valueSpec:d.transition,style:u,styleSpec:d}):y[D]?l({key:D,value:o[D],valueSpec:y[D],style:u,styleSpec:d}):[new tr(D,o[D],`unknown property "${D}"`)])}return E}const xu={"*":()=>[],array:Hu,boolean:function(a){const o=a.value,u=a.key,d=ci(o);return"boolean"!==d?[new tr(u,o,`boolean expected, ${d} found`)]:[]},number:ga,color:function(a){const o=a.key,u=a.value,d=ci(u);return"string"!==d?[new tr(o,u,`color expected, ${d} found`)]:null===jn(u)?[new tr(o,u,`color expected, "${u}" found`)]:[]},enum:tc,filter:rc,function:$i,layer:Lu,object:La,source:si,light:yl,terrain:Oi,fog:uf,string:Nu,formatted:function(a){return 0===Nu(a).length?[]:Wu(a)},resolvedImage:function(a){return 0===Nu(a).length?[]:Wu(a)},projection:function(a){const o=a.value,u=a.styleSpec,d=u.projection,y=a.style;let E=[];const S=ci(o);if("object"===S)for(const D in o)E=E.concat(l({key:D,value:o[D],valueSpec:d[D],style:y,styleSpec:u}));else"string"!==S&&(E=E.concat([new tr("projection",o,`object or string expected, ${S} found`)]));return E}};function l(a){const o=a.value,u=a.valueSpec,d=a.styleSpec;return u.expression&&vs(so(o))?$i(a):u.expression&&sa(di(o))?Wu(a):u.type&&xu[u.type]?xu[u.type](a):La(ca({},a,{valueSpec:u.type?d[u.type]:u}))}function h(a){const o=a.value,u=a.key,d=Nu(a);return d.length||(-1===o.indexOf("{fontstack}")&&d.push(new tr(u,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&d.push(new tr(u,o,'"glyphs" url must include a "{range}" token'))),d}function _(a,o=Yt){return U(l({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:h,"*":()=>[]}}))}const w=a=>U(oc(a)),I=a=>U(ti(a));function U(a){return a.slice().sort((o,u)=>o.line&&u.line?o.line-u.line:0)}function q(a,o){let u=!1;if(o&&o.length)for(const d of o)a.fire(new Wi(new Error(d.message))),u=!0;return u}var he=ke;function ke(a,o,u){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var E=0;E<this.d*this.d;E++){var S=y[3+E],D=y[3+E+1];d.push(S===D?null:y.subarray(S,D))}var O=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],O),this.bboxes=y.subarray(O),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var N=0;N<this.d*this.d;N++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=u,this.scale=o/a,this.uid=0;var V=u/o*a;this.min=-V,this.max=a+V}ke.prototype.insert=function(a,o,u,d,y){this._forEachCell(o,u,d,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)},ke.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ke.prototype._insertCell=function(a,o,u,d,y,E){this.cells[y].push(E)},ke.prototype.query=function(a,o,u,d,y){var E=this.min,S=this.max;if(a<=E&&o<=E&&S<=u&&S<=d&&!y)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(a,o,u,d,this._queryCell,D,{},y),D},ke.prototype._queryCell=function(a,o,u,d,y,E,S,D){var O=this.cells[y];if(null!==O)for(var N=this.keys,V=this.bboxes,$=0;$<O.length;$++){var H=O[$];if(void 0===S[H]){var J=4*H;(D?D(V[J+0],V[J+1],V[J+2],V[J+3]):a<=V[J+2]&&o<=V[J+3]&&u>=V[J+0]&&d>=V[J+1])?(S[H]=!0,E.push(N[H])):S[H]=!1}}},ke.prototype._forEachCell=function(a,o,u,d,y,E,S,D){for(var O=this._convertToCellCoord(a),N=this._convertToCellCoord(o),V=this._convertToCellCoord(u),$=this._convertToCellCoord(d),H=O;H<=V;H++)for(var J=N;J<=$;J++){var ie=this.d*J+H;if((!D||D(this._convertFromCellCoord(H),this._convertFromCellCoord(J),this._convertFromCellCoord(H+1),this._convertFromCellCoord(J+1)))&&y.call(this,a,o,u,d,ie,E,S,D))return}},ke.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ke.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ke.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,u=0,d=0;d<this.cells.length;d++)u+=this.cells[d].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var E=o,S=0;S<a.length;S++){var D=a[S];y[3+S]=E,y.set(D,E),E+=D.length}return y[3+a.length]=E,y.set(this.keys,E),y[3+a.length+1]=E+=this.keys.length,y.set(this.bboxes,E),E+=this.bboxes.length,y.buffer};const wt={};function vt(a,o,u={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),wt[o]={klass:a,omit:u.omit||[]}}vt(Object,"Object"),he.serialize=function(a,o){const u=a.toArrayBuffer();return o&&o.push(u),{buffer:u}},he.deserialize=function(a){return new he(a.buffer)},Object.defineProperty(he,"name",{value:"Grid"}),vt(he,"Grid"),vt(sr,"Color"),vt(Error,"Error"),vt(kn,"AJAXError"),vt(pl,"ResolvedImage"),vt(To,"StylePropertyFunction"),vt(Dl,"StyleExpression",{omit:["_evaluator"]}),vt(qu,"ZoomDependentExpression"),vt(As,"ZoomConstantExpression"),vt(xi,"CompoundExpression",{omit:["_evaluate"]});for(const a in Aa)wt[Aa[a]._classRegistryKey]||vt(Aa[a],`Expression${a}`);function on(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Gn(a){return K.ImageBitmap&&a instanceof K.ImageBitmap}function qn(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(on(a)||Gn(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const u=a;return o&&o.push(u.buffer),u}if(a instanceof K.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const u=[];for(const d of a)u.push(qn(d,o));return u}if("object"==typeof a){const u=a.constructor,d=u._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const y=u.serialize?u.serialize(a,o):{};if(!u.serialize){for(const E in a)a.hasOwnProperty(E)&&(wt[d].omit.indexOf(E)>=0||(y[E]=qn(a[E],o)));a instanceof Error&&(y.message=a.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==d&&(y.$name=d),y}throw new Error("can't serialize object of type "+typeof a)}function hr(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||on(a)||Gn(a)||ArrayBuffer.isView(a)||a instanceof K.ImageData)return a;if(Array.isArray(a))return a.map(hr);if("object"==typeof a){const o=a.$name||"Object",{klass:u}=wt[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(a);const d=Object.create(u.prototype);for(const y of Object.keys(a))"$name"!==y&&(d[y]=hr(a[y]));return d}throw new Error("can't deserialize object of type "+typeof a)}const Lr=a=>a>=1536&&a<=1791,to=a=>a>=1872&&a<=1919,Ps=a=>a>=2208&&a<=2303,ka=a=>a>=11904&&a<=12031,Pl=a=>a>=12032&&a<=12255,ku=a=>a>=12272&&a<=12287,Sc=a=>a>=12288&&a<=12351,cf=a=>a>=12352&&a<=12447,Dh=a=>a>=12448&&a<=12543,Ff=a=>a>=12544&&a<=12591,xp=a=>a>=12704&&a<=12735,wp=a=>a>=12736&&a<=12783,Bf=a=>a>=12784&&a<=12799,Eg=a=>a>=12800&&a<=13055,Cg=a=>a>=13056&&a<=13311,Kl=a=>a>=13312&&a<=19903,Tc=a=>a>=19968&&a<=40959,ma=a=>a>=40960&&a<=42127,Sg=a=>a>=42128&&a<=42191,Tg=a=>a>=44032&&a<=55215,Ig=a=>a>=63744&&a<=64255,wd=a=>a>=64336&&a<=65023,zf=a=>a>=65040&&a<=65055,b=a=>a>=65072&&a<=65103,c=a=>a>=65104&&a<=65135,m=a=>a>=65136&&a<=65279,C=a=>a>=65280&&a<=65519;function T(a){for(const o of a)if(z(o.charCodeAt(0)))return!0;return!1}function P(a){for(const o of a)if(!F(o.charCodeAt(0)))return!1;return!0}function F(a){return!(Lr(a)||to(a)||Ps(a)||wd(a)||m(a))}function z(a){return!(746!==a&&747!==a&&(a<4352||!(xp(a)||Ff(a)||b(a)&&!(a>=65097&&a<=65103)||Ig(a)||Cg(a)||ka(a)||wp(a)||!(!Sc(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Kl(a)||Tc(a)||Eg(a)||(o=a,o>=12592&&o<=12687)||(o=>o>=43360&&o<=43391)(a)||(o=>o>=55216&&o<=55295)(a)||(o=>o>=4352&&o<=4607)(a)||Tg(a)||cf(a)||ku(a)||(o=>o>=12688&&o<=12703)(a)||Pl(a)||Bf(a)||Dh(a)&&12540!==a||!(!C(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!c(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(o=>o>=5120&&o<=5759)(a)||(o=>o>=6320&&o<=6399)(a)||zf(a)||(o=>o>=19904&&o<=19967)(a)||ma(a)||Sg(a))));var o}function j(a){return!(z(a)||(o=a,(u=o)>=128&&u<=255&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||(u=>u>=8192&&u<=8303)(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||(u=>u>=8448&&u<=8527)(o)||(u=>u>=8528&&u<=8591)(o)||(u=>u>=8960&&u<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||(u=>u>=9216&&u<=9279)(o)&&9251!==o||(u=>u>=9280&&u<=9311)(o)||(u=>u>=9312&&u<=9471)(o)||(u=>u>=9632&&u<=9727)(o)||(u=>u>=9728&&u<=9983)(o)&&!(o>=9754&&o<=9759)||(u=>u>=11008&&u<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Sc(o)||Dh(o)||(u=>u>=57344&&u<=63743)(o)||b(o)||c(o)||C(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o,u}function W(a){return a>=1424&&a<=2303||wd(a)||m(a)}function Y(a,o){return!(!o&&W(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(u=a,u>=6016&&u<=6143));var u}function fe(a){for(const o of a)if(W(o.charCodeAt(0)))return!0;return!1}const Ae="deferred",Ve="loading",Ue="loaded";let Ge=null,qe="unavailable",Ie=null;const tt=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(qe="error"),Ge&&Ge(a)};function Je(){ot.fire(new Zr("pluginStateChange",{pluginStatus:qe,pluginURL:Ie}))}const ot=new Xi,Ct=function(){return qe},_t=function(){if(qe!==Ae||!Ie)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qe=Ve,Je(),Ie&&li({url:Ie},a=>{a?tt(a):(qe=Ue,Je())})},It={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qe===Ue||null!=It.applyArabicShaping,isLoading:()=>qe===Ve,setState(a){qe=a.pluginStatus,Ie=a.pluginURL},isParsed:()=>null!=It.applyArabicShaping&&null!=It.processBidirectionalText&&null!=It.processStyledBidirectionalText,getPluginURL:()=>Ie};class jt{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(u,d){for(const y of u)if(!Y(y.charCodeAt(0),d))return!1;return!0}(o,It.isLoaded())}}class Wt{constructor(o,u){this.property=o,this.value=u,this.expression=function(d,y){if(vs(d))return new To(d,y);if(sa(d)){const E=Ec(d,y);if("error"===E.result)throw new Error(E.value.map(S=>`${S.key}: ${S.message}`).join(", "));return E.value}{let E=d;return"string"==typeof d&&"color"===y.type&&(E=sr.parse(d)),{kind:"constant",evaluate:()=>E}}}(void 0===u?o.specification.default:u,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,u,d){return this.property.possiblyEvaluate(this,o,u,d)}}class Qt{constructor(o){this.property=o,this.value=new Wt(o,void 0)}transitioned(o,u){return new Xt(this.property,this.value,u,Xe({},o.transition,this.transition),o.now)}untransitioned(){return new Xt(this.property,this.value,null,{},0)}}class Bn{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Kn(this._values[o].value.value)}setValue(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Qt(this._values[o].property)),this._values[o].value=new Wt(this._values[o].property,null===u?void 0:Kn(u))}getTransition(o){return Kn(this._values[o].transition)}setTransition(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Qt(this._values[o].property)),this._values[o].transition=Kn(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const d=this.getValue(u);void 0!==d&&(o[u]=d);const y=this.getTransition(u);void 0!==y&&(o[`${u}-transition`]=y)}return o}transitioned(o,u){const d=new yn(this._properties);for(const y of Object.keys(this._values))d._values[y]=this._values[y].transitioned(o,u._values[y]);return d}untransitioned(){const o=new yn(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class Xt{constructor(o,u,d,y,E){const S=y.delay||0,D=y.duration||0;E=E||0,this.property=o,this.value=u,this.begin=E+S,this.end=this.begin+D,o.specification.transition&&(y.delay||y.duration)&&(this.prior=d)}possiblyEvaluate(o,u,d){const y=o.now||0,E=this.value.possiblyEvaluate(o,u,d),S=this.prior;if(S){if(y>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(y<this.begin)return S.possiblyEvaluate(o,u,d);{const D=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(o,u,d),E,ct(D))}}return E}}class yn{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,d){const y=new Ht(this._properties);for(const E of Object.keys(this._values))y._values[E]=this._values[E].possiblyEvaluate(o,u,d);return y}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class sn{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Kn(this._values[o].value)}setValue(o,u){this._values[o]=new Wt(this._values[o].property,null===u?void 0:Kn(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const d=this.getValue(u);void 0!==d&&(o[u]=d)}return o}possiblyEvaluate(o,u,d){const y=new Ht(this._properties);for(const E of Object.keys(this._values))y._values[E]=this._values[E].possiblyEvaluate(o,u,d);return y}}class An{constructor(o,u,d){this.property=o,this.value=u,this.parameters=d}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,u,d,y){return this.property.evaluate(this.value,this.parameters,o,u,d,y)}}class Ht{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Vt{constructor(o){this.specification=o}possiblyEvaluate(o,u){return o.expression.evaluate(u)}interpolate(o,u,d){const y=Ga[this.specification.type];return y?y(o,u,d):o}}class en{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,d,y){return new An(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(u,null,{},d,y)}:o.expression,u)}interpolate(o,u,d){if("constant"!==o.value.kind||"constant"!==u.value.kind)return o;if(void 0===o.value.value||void 0===u.value.value)return new An(this,{kind:"constant",value:void 0},o.parameters);const y=Ga[this.specification.type];return y?new An(this,{kind:"constant",value:y(o.value.value,u.value.value,d)},o.parameters):o}evaluate(o,u,d,y,E,S){return"constant"===o.kind?o.value:o.evaluate(u,d,y,E,S)}}class xn{constructor(o){this.specification=o}possiblyEvaluate(o,u,d,y){return!!o.expression.evaluate(u,null,{},d,y)}interpolate(){return!1}}class Pn{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new jt(0,{});for(const d in o){const y=o[d];y.specification.overridable&&this.overridableProperties.push(d);const E=this.defaultPropertyValues[d]=new Wt(y,void 0),S=this.defaultTransitionablePropertyValues[d]=new Qt(y);this.defaultTransitioningPropertyValues[d]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=E.possiblyEvaluate(u)}}}function br(a,o){return 256*(a=Se(Math.floor(a),0,255))+Se(Math.floor(o),0,255)}vt(en,"DataDrivenProperty"),vt(Vt,"DataConstantProperty"),vt(xn,"ColorRampProperty");const wi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gr{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class or{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ir(a,o=1){let u=0,d=0;return{members:a.map(y=>{const E=wi[y.type].BYTES_PER_ELEMENT,S=u=qi(u,Math.max(o,E)),D=y.components||1;return d=Math.max(d,E),u+=E*D,{name:y.name,type:y.type,components:D,offset:S}}),size:qi(u,Math.max(d,o)),alignment:o}}function qi(a,o){return Math.ceil(a/o)*o}class Br extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const d=this.length;return this.resize(d+1),this.emplace(d,o,u)}emplace(o,u,d){const y=2*o;return this.int16[y+0]=u,this.int16[y+1]=d,o}}Br.prototype.bytesPerElement=4,vt(Br,"StructArrayLayout2i4");class ns extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,d){const y=this.length;return this.resize(y+1),this.emplace(y,o,u,d)}emplace(o,u,d,y){const E=3*o;return this.int16[E+0]=u,this.int16[E+1]=d,this.int16[E+2]=y,o}}ns.prototype.bytesPerElement=6,vt(ns,"StructArrayLayout3i6");class rs extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,d,y){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,d,y)}emplace(o,u,d,y,E){const S=4*o;return this.int16[S+0]=u,this.int16[S+1]=d,this.int16[S+2]=y,this.int16[S+3]=E,o}}rs.prototype.bytesPerElement=8,vt(rs,"StructArrayLayout4i8");class fs extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S,D){const O=this.length;return this.resize(O+1),this.emplace(O,o,u,d,y,E,S,D)}emplace(o,u,d,y,E,S,D,O){const N=6*o,V=12*o,$=3*o;return this.int16[N+0]=u,this.int16[N+1]=d,this.uint8[V+4]=y,this.uint8[V+5]=E,this.uint8[V+6]=S,this.uint8[V+7]=D,this.float32[$+2]=O,o}}fs.prototype.bytesPerElement=12,vt(fs,"StructArrayLayout2i4ub1f12");class Rs extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d,y){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,d,y)}emplace(o,u,d,y,E){const S=4*o;return this.float32[S+0]=u,this.float32[S+1]=d,this.float32[S+2]=y,this.float32[S+3]=E,o}}Rs.prototype.bytesPerElement=16,vt(Rs,"StructArrayLayout4f16");class Fa extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,d,y,E)}emplace(o,u,d,y,E,S){const D=6*o,O=3*o;return this.uint16[D+0]=u,this.uint16[D+1]=d,this.uint16[D+2]=y,this.uint16[D+3]=E,this.float32[O+2]=S,o}}Fa.prototype.bytesPerElement=12,vt(Fa,"StructArrayLayout4ui1f12");class cu extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,d,y){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,d,y)}emplace(o,u,d,y,E){const S=4*o;return this.uint16[S+0]=u,this.uint16[S+1]=d,this.uint16[S+2]=y,this.uint16[S+3]=E,o}}cu.prototype.bytesPerElement=8,vt(cu,"StructArrayLayout4ui8");class Jl extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,u,d,y,E,S)}emplace(o,u,d,y,E,S,D){const O=6*o;return this.int16[O+0]=u,this.int16[O+1]=d,this.int16[O+2]=y,this.int16[O+3]=E,this.int16[O+4]=S,this.int16[O+5]=D,o}}Jl.prototype.bytesPerElement=12,vt(Jl,"StructArrayLayout6i12");class Bc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S,D,O,N,V,$,H){const J=this.length;return this.resize(J+1),this.emplace(J,o,u,d,y,E,S,D,O,N,V,$,H)}emplace(o,u,d,y,E,S,D,O,N,V,$,H,J){const ie=12*o;return this.int16[ie+0]=u,this.int16[ie+1]=d,this.int16[ie+2]=y,this.int16[ie+3]=E,this.uint16[ie+4]=S,this.uint16[ie+5]=D,this.uint16[ie+6]=O,this.uint16[ie+7]=N,this.int16[ie+8]=V,this.int16[ie+9]=$,this.int16[ie+10]=H,this.int16[ie+11]=J,o}}Bc.prototype.bytesPerElement=24,vt(Bc,"StructArrayLayout4i4ui4i24");class Vs extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,u,d,y,E,S)}emplace(o,u,d,y,E,S,D){const O=10*o,N=5*o;return this.int16[O+0]=u,this.int16[O+1]=d,this.int16[O+2]=y,this.float32[N+2]=E,this.float32[N+3]=S,this.float32[N+4]=D,o}}Vs.prototype.bytesPerElement=20,vt(Vs,"StructArrayLayout3i3f20");class xs extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}xs.prototype.bytesPerElement=4,vt(xs,"StructArrayLayout1ul4");class yo extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S,D,O,N,V,$,H,J){const ie=this.length;return this.resize(ie+1),this.emplace(ie,o,u,d,y,E,S,D,O,N,V,$,H,J)}emplace(o,u,d,y,E,S,D,O,N,V,$,H,J,ie){const pe=20*o,Ne=10*o;return this.int16[pe+0]=u,this.int16[pe+1]=d,this.int16[pe+2]=y,this.int16[pe+3]=E,this.int16[pe+4]=S,this.float32[Ne+3]=D,this.float32[Ne+4]=O,this.float32[Ne+5]=N,this.float32[Ne+6]=V,this.int16[pe+14]=$,this.uint32[Ne+8]=H,this.uint16[pe+18]=J,this.uint16[pe+19]=ie,o}}yo.prototype.bytesPerElement=40,vt(yo,"StructArrayLayout5i4f1i1ul2ui40");class ya extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S,D){const O=this.length;return this.resize(O+1),this.emplace(O,o,u,d,y,E,S,D)}emplace(o,u,d,y,E,S,D,O){const N=8*o;return this.int16[N+0]=u,this.int16[N+1]=d,this.int16[N+2]=y,this.int16[N+4]=E,this.int16[N+5]=S,this.int16[N+6]=D,this.int16[N+7]=O,o}}ya.prototype.bytesPerElement=16,vt(ya,"StructArrayLayout3i2i2i16");class nl extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,d,y,E)}emplace(o,u,d,y,E,S){const D=4*o,O=8*o;return this.float32[D+0]=u,this.float32[D+1]=d,this.float32[D+2]=y,this.int16[O+6]=E,this.int16[O+7]=S,o}}nl.prototype.bytesPerElement=16,vt(nl,"StructArrayLayout2f1f2i16");class ds extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d,y){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,d,y)}emplace(o,u,d,y,E){const S=12*o,D=3*o;return this.uint8[S+0]=u,this.uint8[S+1]=d,this.float32[D+1]=y,this.float32[D+2]=E,o}}ds.prototype.bytesPerElement=12,vt(ds,"StructArrayLayout2ub2f12");class Ha extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d){const y=this.length;return this.resize(y+1),this.emplace(y,o,u,d)}emplace(o,u,d,y){const E=3*o;return this.float32[E+0]=u,this.float32[E+1]=d,this.float32[E+2]=y,o}}Ha.prototype.bytesPerElement=12,vt(Ha,"StructArrayLayout3f12");class Wa extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,d){const y=this.length;return this.resize(y+1),this.emplace(y,o,u,d)}emplace(o,u,d,y){const E=3*o;return this.uint16[E+0]=u,this.uint16[E+1]=d,this.uint16[E+2]=y,o}}Wa.prototype.bytesPerElement=6,vt(Wa,"StructArrayLayout3ui6");class zc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne,Qe,ft,Ye,lt,Et){const pt=this.length;return this.resize(pt+1),this.emplace(pt,o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne,Qe,ft,Ye,lt,Et)}emplace(o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne,Qe,ft,Ye,lt,Et,pt){const Kt=30*o,Zt=15*o,fn=60*o;return this.int16[Kt+0]=u,this.int16[Kt+1]=d,this.int16[Kt+2]=y,this.float32[Zt+2]=E,this.float32[Zt+3]=S,this.uint16[Kt+8]=D,this.uint16[Kt+9]=O,this.uint32[Zt+5]=N,this.uint32[Zt+6]=V,this.uint32[Zt+7]=$,this.uint16[Kt+16]=H,this.uint16[Kt+17]=J,this.uint16[Kt+18]=ie,this.float32[Zt+10]=pe,this.float32[Zt+11]=Ne,this.uint8[fn+48]=Qe,this.uint8[fn+49]=ft,this.uint8[fn+50]=Ye,this.uint32[Zt+13]=lt,this.int16[Kt+28]=Et,this.uint8[fn+58]=pt,o}}zc.prototype.bytesPerElement=60,vt(zc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ih extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne,Qe,ft,Ye,lt,Et,pt,Kt,Zt,fn,Ln,nn,gn,wn,In){const Nn=this.length;return this.resize(Nn+1),this.emplace(Nn,o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne,Qe,ft,Ye,lt,Et,pt,Kt,Zt,fn,Ln,nn,gn,wn,In)}emplace(o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne,Qe,ft,Ye,lt,Et,pt,Kt,Zt,fn,Ln,nn,gn,wn,In,Nn){const an=38*o,Wn=19*o;return this.int16[an+0]=u,this.int16[an+1]=d,this.int16[an+2]=y,this.float32[Wn+2]=E,this.float32[Wn+3]=S,this.int16[an+8]=D,this.int16[an+9]=O,this.int16[an+10]=N,this.int16[an+11]=V,this.int16[an+12]=$,this.int16[an+13]=H,this.uint16[an+14]=J,this.uint16[an+15]=ie,this.uint16[an+16]=pe,this.uint16[an+17]=Ne,this.uint16[an+18]=Qe,this.uint16[an+19]=ft,this.uint16[an+20]=Ye,this.uint16[an+21]=lt,this.uint16[an+22]=Et,this.uint16[an+23]=pt,this.uint16[an+24]=Kt,this.uint16[an+25]=Zt,this.uint16[an+26]=fn,this.uint16[an+27]=Ln,this.uint16[an+28]=nn,this.uint32[Wn+15]=gn,this.float32[Wn+16]=wn,this.float32[Wn+17]=In,this.float32[Wn+18]=Nn,o}}ih.prototype.bytesPerElement=76,vt(ih,"StructArrayLayout3i2f6i15ui1ul3f76");class _l extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}_l.prototype.bytesPerElement=4,vt(_l,"StructArrayLayout1f4");class sc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,d,y,E){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,d,y,E)}emplace(o,u,d,y,E,S){const D=5*o;return this.float32[D+0]=u,this.float32[D+1]=d,this.float32[D+2]=y,this.float32[D+3]=E,this.float32[D+4]=S,o}}sc.prototype.bytesPerElement=20,vt(sc,"StructArrayLayout5f20");class Uc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,d,y){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,d,y)}emplace(o,u,d,y,E){const S=6*o;return this.uint32[3*o+0]=u,this.uint16[S+2]=d,this.uint16[S+3]=y,this.uint16[S+4]=E,o}}Uc.prototype.bytesPerElement=12,vt(Uc,"StructArrayLayout1ul3ui12");class Er extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const d=this.length;return this.resize(d+1),this.emplace(d,o,u)}emplace(o,u,d){const y=2*o;return this.uint16[y+0]=u,this.uint16[y+1]=d,o}}Er.prototype.bytesPerElement=4,vt(Er,"StructArrayLayout2ui4");class Ah extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}Ah.prototype.bytesPerElement=2,vt(Ah,"StructArrayLayout1ui2");class Uf extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const d=this.length;return this.resize(d+1),this.emplace(d,o,u)}emplace(o,u,d){const y=2*o;return this.float32[y+0]=u,this.float32[y+1]=d,o}}Uf.prototype.bytesPerElement=8,vt(Uf,"StructArrayLayout2f8");class Pw extends gr{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Pw.prototype.size=40;class Gv extends yo{get(o){return new Pw(this,o)}}vt(Gv,"CollisionBoxArray");class Rw extends gr{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Rw.prototype.size=60;class Ow extends zc{get(o){return new Rw(this,o)}}vt(Ow,"PlacedSymbolArray");class Lw extends gr{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Lw.prototype.size=76;class bd extends ih{get(o){return new Lw(this,o)}}vt(bd,"SymbolInstanceArray");class Nw extends _l{getoffsetX(o){return this.float32[1*o+0]}}vt(Nw,"GlyphOffsetArray");class kw extends Br{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}vt(kw,"SymbolLineVertexArray");class vl extends gr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}vl.prototype.size=12;class Mg extends Uc{get(o){return new vl(this,o)}}vt(Mg,"FeatureIndexArray");class Ed extends Er{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}vt(Ed,"FillExtrusionCentroidArray");const HT=Ir([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Fw=Ir([{name:"a_dash",components:4,type:"Uint16"}]);var Rl={},Ph={get exports(){return Rl},set exports(a){Rl=a}},Dg={};({get exports(){return Dg},set exports(a){Dg=a}}).exports=function(a,o){var u,d,y,E,S,D,O,N;for(d=a.length-(u=3&a.length),y=o,S=3432918353,D=461845907,N=0;N<d;)O=255&a.charCodeAt(N)|(255&a.charCodeAt(++N))<<8|(255&a.charCodeAt(++N))<<16|(255&a.charCodeAt(++N))<<24,++N,y=27492+(65535&(E=5*(65535&(y=(y^=O=(65535&(O=(O=(65535&O)*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*D+(((O>>>16)*D&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(O=0,u){case 3:O^=(255&a.charCodeAt(N+2))<<16;case 2:O^=(255&a.charCodeAt(N+1))<<8;case 1:y^=O=(65535&(O=(O=(65535&(O^=255&a.charCodeAt(N)))*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*D+(((O>>>16)*D&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var Cd={};({get exports(){return Cd},set exports(a){Cd=a}}).exports=function(a,o){for(var u,d=a.length,y=o^d,E=0;d>=4;)u=1540483477*(65535&(u=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24))+((1540483477*(u>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),d-=4,++E;switch(d){case 3:y^=(255&a.charCodeAt(E+2))<<16;case 2:y^=(255&a.charCodeAt(E+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(E)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var Sd=Dg,$v=Cd;Ph.exports=Sd,Rl.murmur3=Sd,Rl.murmur2=$v;class Ag{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,d,y){this.ids.push(qv(o)),this.positions.push(u,d,y)}getPositions(o){const u=qv(o);let d=0,y=this.ids.length-1;for(;d<y;){const S=d+y>>1;this.ids[S]>=u?y=S:d=S+1}const E=[];for(;this.ids[d]===u;)E.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return E}static serialize(o,u){const d=new Float64Array(o.ids),y=new Uint32Array(o.positions);return Hv(d,y,0,d.length-1),u&&u.push(d.buffer,y.buffer),{ids:d,positions:y}}static deserialize(o){const u=new Ag;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function qv(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Rl(String(a))}function Hv(a,o,u,d){for(;u<d;){const y=a[u+d>>1];let E=u-1,S=d+1;for(;;){do{E++}while(a[E]<y);do{S--}while(a[S]>y);if(E>=S)break;dy(a,E,S),dy(o,3*E,3*S),dy(o,3*E+1,3*S+1),dy(o,3*E+2,3*S+2)}S-u<d-S?(Hv(a,o,u,S),u=S+1):(Hv(a,o,S+1,d),d=S)}}function dy(a,o,u){const d=a[o];a[o]=a[u],a[u]=d}vt(Ag,"FeaturePositionMap");class oh{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,u),this.initialized=!0),!!this.location}}class wu extends oh{constructor(o){super(o),this.current=0}set(o,u,d){this.fetchUniformLocation(o,u)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Pg extends oh{constructor(o){super(o),this.current=[0,0,0,0]}set(o,u,d){this.fetchUniformLocation(o,u)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class Vf extends oh{constructor(o){super(o),this.current=sr.transparent}set(o,u,d){this.fetchUniformLocation(o,u)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const WT=new Float32Array(16),Wv=new Float32Array(9),Bw=new Float32Array(4);function py(a){return[br(255*a.r,255*a.g),br(255*a.b,255*a.a)]}class bp{constructor(o,u,d){this.value=o,this.uniformNames=u.map(y=>`u_${y}`),this.type=d}setUniform(o,u,d,y,E){u.set(o,E,y.constantOr(this.value))}getBinding(o,u){return"color"===this.type?new Vf(o):new wu(o)}}class Td{constructor(o,u){this.uniformNames=u.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,u,d,y,E){const S="u_pattern"===E||"u_dash"===E?this.pattern:"u_pixel_ratio"===E?this.pixelRatio:null;S&&u.set(o,E,S)}getBinding(o,u){return"u_pattern"===u||"u_dash"===u?new Pg(o):new wu(o)}}class Rh{constructor(o,u,d,y){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:"color"===d?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,u,d,y,E,S){const D=this.paintVertexArray.length,O=this.expression.evaluate(new jt(0),u,{},E,y,S);this.paintVertexArray.resize(o),this._setPaintValue(D,o,O)}updatePaintArray(o,u,d,y,E){const S=this.expression.evaluate({zoom:0},d,y,void 0,E);this._setPaintValue(o,u,S)}_setPaintValue(o,u,d){if("color"===this.type){const y=py(d);for(let E=o;E<u;E++)this.paintVertexArray.emplace(E,y[0],y[1])}else{for(let y=o;y<u;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vc{constructor(o,u,d,y,E,S){this.expression=o,this.uniformNames=u.map(D=>`u_${D}_t`),this.type=d,this.useIntegerZoom=y,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===d?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(o,u,d,y,E,S){const D=this.expression.evaluate(new jt(this.zoom),u,{},E,y,S),O=this.expression.evaluate(new jt(this.zoom+1),u,{},E,y,S),N=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(N,o,D,O)}updatePaintArray(o,u,d,y,E){const S=this.expression.evaluate({zoom:this.zoom},d,y,void 0,E),D=this.expression.evaluate({zoom:this.zoom+1},d,y,void 0,E);this._setPaintValue(o,u,S,D)}_setPaintValue(o,u,d,y){if("color"===this.type){const E=py(d),S=py(y);for(let D=o;D<u;D++)this.paintVertexArray.emplace(D,E[0],E[1],S[0],S[1])}else{for(let E=o;E<u;E++)this.paintVertexArray.emplace(E,d,y);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(y))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u,d,y,E){const S=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,D=Se(this.expression.interpolationFactor(S,this.zoom,this.zoom+1),0,1);u.set(o,E,D)}getBinding(o,u){return new wu(o)}}class sh{constructor(o,u,d,y,E){this.expression=o,this.layerId=E,this.paintVertexAttributes=("array"===d?Fw:HT).members;for(let S=0;S<u.length;++S);this.paintVertexArray=new y}populatePaintArray(o,u,d){const y=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(y,o,u.patterns&&u.patterns[this.layerId],d)}updatePaintArray(o,u,d,y,E,S){this._setPaintValues(o,u,d.patterns&&d.patterns[this.layerId],S)}_setPaintValues(o,u,d,y){if(!y||!d)return;const E=y[d];if(!E)return;const{tl:S,br:D,pixelRatio:O}=E;for(let N=o;N<u;N++)this.paintVertexArray.emplace(N,S[0],S[1],D[0],D[1],O)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jc{constructor(o,u,d=(()=>!0)){this.binders={},this._buffers=[];const y=[];for(const E in o.paint._values){if(!d(E))continue;const S=o.paint.get(E);if(!(S instanceof An&&Pa(S.property.specification)))continue;const D=gy(E,o.type),O=S.value,N=S.property.specification.type,V=S.property.useIntegerZoom,$="line-dasharray"===E||E.endsWith("pattern"),H="line-dasharray"===E&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==O.kind||H)if("source"===O.kind||H||$){const J=Xv(E,N,"source");this.binders[E]=$?new sh(O,D,N,J,o.id):new Rh(O,D,N,J),y.push(`/a_${E}`)}else{const J=Xv(E,N,"composite");this.binders[E]=new Vc(O,D,N,V,u,J),y.push(`/z_${E}`)}else this.binders[E]=$?new Td(O.value,D):new bp(O.value,D,N),y.push(`/u_${E}`)}this.cacheKey=y.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof Rh||u instanceof Vc?u.maxValue:0}populatePaintArrays(o,u,d,y,E,S){for(const D in this.binders){const O=this.binders[D];(O instanceof Rh||O instanceof Vc||O instanceof sh)&&O.populatePaintArray(o,u,d,y,E,S)}}setConstantPatternPositions(o){for(const u in this.binders){const d=this.binders[u];d instanceof Td&&d.setConstantPatternPositions(o)}}updatePaintArrays(o,u,d,y,E,S){let D=!1;for(const O in o){const N=u.getPositions(O);for(const V of N){const $=d.feature(V.index);for(const H in this.binders){const J=this.binders[H];if((J instanceof Rh||J instanceof Vc||J instanceof sh)&&!0===J.expression.isStateDependent){const ie=y.paint.get(H);J.expression=ie.value,J.updatePaintArray(V.start,V.end,$,o[O],E,S),D=!0}}}}return D}defines(){const o=[];for(const u in this.binders){const d=this.binders[u];(d instanceof bp||d instanceof Td)&&o.push(...d.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Rh||d instanceof Vc||d instanceof sh)for(let y=0;y<d.paintVertexAttributes.length;y++)o.push(d.paintVertexAttributes[y].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof bp||d instanceof Td||d instanceof Vc)for(const y of d.uniformNames)o.push(y)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const u=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof bp||y instanceof Td||y instanceof Vc)for(const E of y.uniformNames)u.push({name:E,property:d,binding:y.getBinding(o,E)})}return u}setUniforms(o,u,d,y,E){for(const{name:S,property:D,binding:O}of d)this.binders[D].setUniform(o,O,E,y.get(D),S)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const u=this.binders[o];(u instanceof Rh||u instanceof Vc||u instanceof sh)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const u in this.binders){const d=this.binders[u];(d instanceof Rh||d instanceof Vc||d instanceof sh)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof Rh||u instanceof Vc||u instanceof sh)&&u.destroy()}}}class Id{constructor(o,u,d=(()=>!0)){this.programConfigurations={};for(const y of o)this.programConfigurations[y.id]=new jc(y,u,d);this.needsUpload=!1,this._featureMap=new Ag,this._bufferOffset=0}populatePaintArrays(o,u,d,y,E,S,D){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(o,u,y,E,S,D);void 0!==u.id&&this._featureMap.add(u.id,d,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,d,y,E){for(const S of d)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,u,S,y,E)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const Ep={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gy(a,o){return Ep[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const Rg={"line-pattern":{source:Fa,composite:Fa},"fill-pattern":{source:Fa,composite:Fa},"fill-extrusion-pattern":{source:Fa,composite:Fa},"line-dasharray":{source:cu,composite:cu}},zw={color:{source:Uf,composite:Rs},number:{source:_l,composite:Uf}};function Xv(a,o,u){const d=Rg[a];return d&&d[u]||zw[o][u]}vt(bp,"ConstantBinder"),vt(Td,"PatternConstantBinder"),vt(Rh,"SourceExpressionBinder"),vt(sh,"PatternCompositeBinder"),vt(Vc,"CompositeExpressionBinder"),vt(jc,"ProgramConfiguration",{omit:["_buffers"]}),vt(Id,"ProgramConfigurationSet");const Og="-transition";class Ic extends Xi{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new sn(u.layout)),u.paint)){this._transitionablePaint=new Bn(u.paint);for(const d in o.paint)this.setPaintProperty(d,o.paint[d],{validate:!1});for(const d in o.layout)this.setLayoutProperty(d,o.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ht(u.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u,d={}){null!=u&&this._validate(I,`layers.${this.id}.layout.${o}`,o,u,d)||("visibility"!==o?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return At(o,Og)?this._transitionablePaint.getTransition(o.slice(0,-Og.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u,d={}){if(null!=u&&this._validate(w,`layers.${this.id}.paint.${o}`,o,u,d))return!1;if(At(o,Og))return this._transitionablePaint.setTransition(o.slice(0,-Og.length),u||void 0),!1;{const y=this._transitionablePaint._values[o],E=y.value.isDataDriven(),S=y.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const D=this._transitionablePaint._values[o].value,O=D.isDataDriven(),N=At(o,"pattern")||"line-dasharray"===o;return O||E||N||this._handleOverridablePaintPropertyUpdate(o,S,D)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,u,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Yn(o,(u,d)=>!(void 0===u||"layout"===d&&!Object.keys(u).length||"paint"===d&&!Object.keys(u).length))}_validate(o,u,d,y,E={}){return(!E||!1!==E.validate)&&q(this,o.call(_,{key:u,layerType:this.type,objectKey:d,value:y,styleSpec:Yt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof An&&Pa(u.property.specification)&&("source"===u.value.kind||"composite"===u.value.kind)&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=aa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Cp=Ir([{name:"a_pos",components:2,type:"Int16"}],4),Md=Ir([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Xa{constructor(o=[]){this.segments=o}prepareSegment(o,u,d,y){let E=this.segments[this.segments.length-1];return o>Xa.MAX_VERTEX_ARRAY_LENGTH&&Un(`Max vertices per segment is ${Xa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!E||E.vertexLength+o>Xa.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==y)&&(E={vertexOffset:u.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},void 0!==y&&(E.sortKey=y),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,d,y){return new Xa([{vertexOffset:o,primitiveOffset:u,vertexLength:d,primitiveLength:y,vaos:{},sortKey:0}])}}Xa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vt(Xa,"SegmentVector");var Gt=8192;class Oh{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof fo?new fo(o.lng,o.lat):fo.convert(o),this}setSouthWest(o){return this._sw=o instanceof fo?new fo(o.lng,o.lat):fo.convert(o),this}extend(o){const u=this._sw,d=this._ne;let y,E;if(o instanceof fo)y=o,E=o;else{if(!(o instanceof Oh))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Oh.convert(o)):this.extend(fo.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&o.hasOwnProperty("lon")?this.extend(fo.convert(o)):this;if(y=o._sw,E=o._ne,!y||!E)return this}return u||d?(u.lng=Math.min(y.lng,u.lng),u.lat=Math.min(y.lat,u.lat),d.lng=Math.max(E.lng,d.lng),d.lat=Math.max(E.lat,d.lat)):(this._sw=new fo(y.lng,y.lat),this._ne=new fo(E.lng,E.lat)),this}getCenter(){return new fo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fo(this.getWest(),this.getNorth())}getSouthEast(){return new fo(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:d}=fo.convert(o);let y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&y}static convert(o){return!o||o instanceof Oh?o:new Oh(o)}}var _a=1e-6,bu=typeof Float32Array<"u"?Float32Array:Array;function Dd(){var a=new bu(9);return bu!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Zv(a,o,u){var d=o[0],y=o[1],E=o[2],S=o[3],D=o[4],O=o[5],N=o[6],V=o[7],$=o[8],H=u[0],J=u[1],ie=u[2],pe=u[3],Ne=u[4],Qe=u[5],ft=u[6],Ye=u[7],lt=u[8];return a[0]=H*d+J*S+ie*N,a[1]=H*y+J*D+ie*V,a[2]=H*E+J*O+ie*$,a[3]=pe*d+Ne*S+Qe*N,a[4]=pe*y+Ne*D+Qe*V,a[5]=pe*E+Ne*O+Qe*$,a[6]=ft*d+Ye*S+lt*N,a[7]=ft*y+Ye*D+lt*V,a[8]=ft*E+Ye*O+lt*$,a}function Gc(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function my(a,o){var u=o[0],d=o[1],y=o[2],E=o[3],S=o[4],D=o[5],O=o[6],N=o[7],V=o[8],$=o[9],H=o[10],J=o[11],ie=o[12],pe=o[13],Ne=o[14],Qe=o[15],ft=u*D-d*S,Ye=u*O-y*S,lt=u*N-E*S,Et=d*O-y*D,pt=d*N-E*D,Kt=y*N-E*O,Zt=V*pe-$*ie,fn=V*Ne-H*ie,Ln=V*Qe-J*ie,nn=$*Ne-H*pe,gn=$*Qe-J*pe,wn=H*Qe-J*Ne,In=ft*wn-Ye*gn+lt*nn+Et*Ln-pt*fn+Kt*Zt;return In?(a[0]=(D*wn-O*gn+N*nn)*(In=1/In),a[1]=(y*gn-d*wn-E*nn)*In,a[2]=(pe*Kt-Ne*pt+Qe*Et)*In,a[3]=(H*pt-$*Kt-J*Et)*In,a[4]=(O*Ln-S*wn-N*fn)*In,a[5]=(u*wn-y*Ln+E*fn)*In,a[6]=(Ne*lt-ie*Kt-Qe*Ye)*In,a[7]=(V*Kt-H*lt+J*Ye)*In,a[8]=(S*gn-D*Ln+N*Zt)*In,a[9]=(d*Ln-u*gn-E*Zt)*In,a[10]=(ie*pt-pe*lt+Qe*ft)*In,a[11]=($*lt-V*pt-J*ft)*In,a[12]=(D*fn-S*nn-O*Zt)*In,a[13]=(u*nn-d*fn+y*Zt)*In,a[14]=(pe*Ye-ie*Et-Ne*ft)*In,a[15]=(V*Et-$*Ye+H*ft)*In,a):null}function Lh(a,o,u){var d=o[0],y=o[1],E=o[2],S=o[3],D=o[4],O=o[5],N=o[6],V=o[7],$=o[8],H=o[9],J=o[10],ie=o[11],pe=o[12],Ne=o[13],Qe=o[14],ft=o[15],Ye=u[0],lt=u[1],Et=u[2],pt=u[3];return a[0]=Ye*d+lt*D+Et*$+pt*pe,a[1]=Ye*y+lt*O+Et*H+pt*Ne,a[2]=Ye*E+lt*N+Et*J+pt*Qe,a[3]=Ye*S+lt*V+Et*ie+pt*ft,a[4]=(Ye=u[4])*d+(lt=u[5])*D+(Et=u[6])*$+(pt=u[7])*pe,a[5]=Ye*y+lt*O+Et*H+pt*Ne,a[6]=Ye*E+lt*N+Et*J+pt*Qe,a[7]=Ye*S+lt*V+Et*ie+pt*ft,a[8]=(Ye=u[8])*d+(lt=u[9])*D+(Et=u[10])*$+(pt=u[11])*pe,a[9]=Ye*y+lt*O+Et*H+pt*Ne,a[10]=Ye*E+lt*N+Et*J+pt*Qe,a[11]=Ye*S+lt*V+Et*ie+pt*ft,a[12]=(Ye=u[12])*d+(lt=u[13])*D+(Et=u[14])*$+(pt=u[15])*pe,a[13]=Ye*y+lt*O+Et*H+pt*Ne,a[14]=Ye*E+lt*N+Et*J+pt*Qe,a[15]=Ye*S+lt*V+Et*ie+pt*ft,a}function ah(a,o,u){var d,y,E,S,D,O,N,V,$,H,J,ie,pe=u[0],Ne=u[1],Qe=u[2];return o===a?(a[12]=o[0]*pe+o[4]*Ne+o[8]*Qe+o[12],a[13]=o[1]*pe+o[5]*Ne+o[9]*Qe+o[13],a[14]=o[2]*pe+o[6]*Ne+o[10]*Qe+o[14],a[15]=o[3]*pe+o[7]*Ne+o[11]*Qe+o[15]):(y=o[1],E=o[2],S=o[3],D=o[4],O=o[5],N=o[6],V=o[7],$=o[8],H=o[9],J=o[10],ie=o[11],a[0]=d=o[0],a[1]=y,a[2]=E,a[3]=S,a[4]=D,a[5]=O,a[6]=N,a[7]=V,a[8]=$,a[9]=H,a[10]=J,a[11]=ie,a[12]=d*pe+D*Ne+$*Qe+o[12],a[13]=y*pe+O*Ne+H*Qe+o[13],a[14]=E*pe+N*Ne+J*Qe+o[14],a[15]=S*pe+V*Ne+ie*Qe+o[15]),a}function hf(a,o,u){var d=u[0],y=u[1],E=u[2];return a[0]=o[0]*d,a[1]=o[1]*d,a[2]=o[2]*d,a[3]=o[3]*d,a[4]=o[4]*y,a[5]=o[5]*y,a[6]=o[6]*y,a[7]=o[7]*y,a[8]=o[8]*E,a[9]=o[9]*E,a[10]=o[10]*E,a[11]=o[11]*E,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function jf(a,o,u){var d=Math.sin(u),y=Math.cos(u),E=o[4],S=o[5],D=o[6],O=o[7],N=o[8],V=o[9],$=o[10],H=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=E*y+N*d,a[5]=S*y+V*d,a[6]=D*y+$*d,a[7]=O*y+H*d,a[8]=N*y-E*d,a[9]=V*y-S*d,a[10]=$*y-D*d,a[11]=H*y-O*d,a}function Lg(a,o,u){var d=Math.sin(u),y=Math.cos(u),E=o[0],S=o[1],D=o[2],O=o[3],N=o[8],V=o[9],$=o[10],H=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=E*y-N*d,a[1]=S*y-V*d,a[2]=D*y-$*d,a[3]=O*y-H*d,a[8]=E*d+N*y,a[9]=S*d+V*y,a[10]=D*d+$*y,a[11]=O*d+H*y,a}function yy(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ad(a,o,u){var d,y,E,S=u[0],D=u[1],O=u[2],N=Math.hypot(S,D,O);return N<_a?null:(S*=N=1/N,D*=N,O*=N,d=Math.sin(o),y=Math.cos(o),a[0]=S*S*(E=1-y)+y,a[1]=D*S*E+O*d,a[2]=O*S*E-D*d,a[3]=0,a[4]=S*D*E-O*d,a[5]=D*D*E+y,a[6]=O*D*E+S*d,a[7]=0,a[8]=S*O*E+D*d,a[9]=D*O*E-S*d,a[10]=O*O*E+y,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var Ng=Lh;function kg(){var a=new bu(3);return bu!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Yv(a){var o=new bu(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Sp(a){return Math.hypot(a[0],a[1],a[2])}function $c(a,o,u){var d=new bu(3);return d[0]=a,d[1]=o,d[2]=u,d}function ac(a,o,u){return a[0]=o[0]+u[0],a[1]=o[1]+u[1],a[2]=o[2]+u[2],a}function _y(a,o,u){return a[0]=o[0]-u[0],a[1]=o[1]-u[1],a[2]=o[2]-u[2],a}function Uw(a,o,u){return a[0]=o[0]*u[0],a[1]=o[1]*u[1],a[2]=o[2]*u[2],a}function Pd(a,o,u){return a[0]=Math.min(o[0],u[0]),a[1]=Math.min(o[1],u[1]),a[2]=Math.min(o[2],u[2]),a}function Tp(a,o,u){return a[0]=Math.max(o[0],u[0]),a[1]=Math.max(o[1],u[1]),a[2]=Math.max(o[2],u[2]),a}function Mc(a,o,u){return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a}function Ip(a,o,u,d){return a[0]=o[0]+u[0]*d,a[1]=o[1]+u[1]*d,a[2]=o[2]+u[2]*d,a}function Eu(a,o){var u=o[0],d=o[1],y=o[2],E=u*u+d*d+y*y;return E>0&&(E=1/Math.sqrt(E)),a[0]=o[0]*E,a[1]=o[1]*E,a[2]=o[2]*E,a}function Dc(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function Rd(a,o,u){var d=o[0],y=o[1],E=o[2],S=u[0],D=u[1],O=u[2];return a[0]=y*O-E*D,a[1]=E*S-d*O,a[2]=d*D-y*S,a}function Ca(a,o,u){var d=o[0],y=o[1],E=o[2],S=u[3]*d+u[7]*y+u[11]*E+u[15];return a[0]=(u[0]*d+u[4]*y+u[8]*E+u[12])/(S=S||1),a[1]=(u[1]*d+u[5]*y+u[9]*E+u[13])/S,a[2]=(u[2]*d+u[6]*y+u[10]*E+u[14])/S,a}function Kv(a,o,u){var d=u[0],y=u[1],E=u[2],S=o[0],D=o[1],O=o[2],N=y*O-E*D,V=E*S-d*O,$=d*D-y*S,H=y*$-E*V,J=E*N-d*$,ie=d*V-y*N,pe=2*u[3];return V*=pe,$*=pe,J*=2,ie*=2,a[0]=S+(N*=pe)+(H*=2),a[1]=D+V+J,a[2]=O+$+ie,a}var Od,lh=_y,Jv=Uw,XT=Sp;function Qv(a,o,u){return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a}function e0(a,o){var u=o[0],d=o[1],y=o[2],E=o[3],S=u*u+d*d+y*y+E*E;return S>0&&(S=1/Math.sqrt(S)),a[0]=u*S,a[1]=d*S,a[2]=y*S,a[3]=E*S,a}function Nh(a,o,u){var d=o[0],y=o[1],E=o[2],S=o[3];return a[0]=u[0]*d+u[4]*y+u[8]*E+u[12]*S,a[1]=u[1]*d+u[5]*y+u[9]*E+u[13]*S,a[2]=u[2]*d+u[6]*y+u[10]*E+u[14]*S,a[3]=u[3]*d+u[7]*y+u[11]*E+u[15]*S,a}function Vw(){var a=new bu(4);return bu!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function jw(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Fg(a,o,u){u*=.5;var d=o[0],y=o[1],E=o[2],S=o[3],D=Math.sin(u),O=Math.cos(u);return a[0]=d*O+S*D,a[1]=y*O+E*D,a[2]=E*O-y*D,a[3]=S*O-d*D,a}function Gw(a,o,u){u*=.5;var d=o[0],y=o[1],E=o[2],S=o[3],D=Math.sin(u),O=Math.cos(u);return a[0]=d*O-E*D,a[1]=y*O+S*D,a[2]=E*O+d*D,a[3]=S*O-y*D,a}kg(),Od=new bu(4),bu!=Float32Array&&(Od[0]=0,Od[1]=0,Od[2]=0,Od[3]=0);var ZT=e0;kg(),$c(1,0,0),$c(0,1,0),Vw(),Vw(),Dd();const YT=Ir([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$w}=YT,qw=Ir([{name:"a_pos_3",components:3,type:"Int16"}]);var Mp=Ir([{name:"a_pos",type:"Int16",components:2}]);class Bg{constructor(o,u){this.pos=o,this.dir=u}intersectsPlane(o,u,d){const y=Dc(u,this.dir);if(Math.abs(y)<1e-6)return!1;const E=((o[0]-this.pos[0])*u[0]+(o[1]-this.pos[1])*u[1]+(o[2]-this.pos[2])*u[2])/y;return d[0]=this.pos[0]+this.dir[0]*E,d[1]=this.pos[1]+this.dir[1]*E,d[2]=this.pos[2]+this.dir[2]*E,!0}closestPointOnSphere(o,u,d){if(pe=(J=this.pos)[0],Ne=J[1],Qe=J[2],ft=(ie=o)[0],Ye=ie[1],lt=ie[2],Math.abs(pe-ft)<=_a*Math.max(1,Math.abs(pe),Math.abs(ft))&&Math.abs(Ne-Ye)<=_a*Math.max(1,Math.abs(Ne),Math.abs(Ye))&&Math.abs(Qe-lt)<=_a*Math.max(1,Math.abs(Qe),Math.abs(lt))||0===u)return d[0]=d[1]=d[2]=0,!1;var J,ie,pe,Ne,Qe,ft,Ye,lt;const[y,E,S]=this.dir,D=this.pos[0]-o[0],O=this.pos[1]-o[1],N=this.pos[2]-o[2],V=y*y+E*E+S*S,$=2*(D*y+O*E+N*S),H=$*$-4*V*(D*D+O*O+N*N-u*u);if(H<0){const J=Math.max(-$/2,0),ie=D+y*J,pe=O+E*J,Ne=N+S*J,Qe=Math.hypot(ie,pe,Ne);return d[0]=ie*u/Qe,d[1]=pe*u/Qe,d[2]=Ne*u/Qe,!1}{const J=(-$-Math.sqrt(H))/(2*V);if(J<0){const ie=Math.hypot(D,O,N);return d[0]=D*u/ie,d[1]=O*u/ie,d[2]=N*u/ie,!1}return d[0]=D+y*J,d[1]=O+E*J,d[2]=N+S*J,!0}}}class Dp{constructor(o,u,d,y,E){this.TL=o,this.TR=u,this.BR=d,this.BL=y,this.horizon=E}static fromInvProjectionMatrix(o,u,d){const y=[-1,1,1],E=[1,1,1],S=[1,-1,1],D=[-1,-1,1],O=Ca(y,y,o),N=Ca(E,E,o),V=Ca(S,S,o),$=Ca(D,D,o);return new Dp(O,N,V,$,u/d)}}class zg{constructor(o,u){this.points=o,this.planes=u}static fromInvProjectionMatrix(o,u,d,y){const E=Math.pow(2,d),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const N=Nh([],O,o),V=1/N[3]/u*E;return($=N)[0]=(H=N)[0]*(J=[V,V,y?1/N[3]:V,V])[0],$[1]=H[1]*J[1],$[2]=H[2]*J[2],$[3]=H[3]*J[3],$;var $,H,J}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const N=Eu([],Rd([],lh([],S[O[0]],S[O[1]]),lh([],S[O[2]],S[O[1]]))),V=-Dc(N,S[O[1]]);return N.concat(V)});return new zg(S,D)}}class hu{static fromPoints(o){const u=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const y of o)Pd(u,u,y),Tp(d,d,y);return new hu(u,d)}static applyTransform(o,u){const d=o.getCorners();for(let y=0;y<d.length;++y)Ca(d[y],d[y],u);return hu.fromPoints(d)}constructor(o,u){this.min=o,this.max=u,this.center=Mc([],ac([],this.min,this.max),.5)}quadrant(o){const u=[o%2==0,o<2],d=Yv(this.min),y=Yv(this.max);for(let E=0;E<u.length;E++)d[E]=u[E]?this.min[E]:this.center[E],y[E]=u[E]?this.center[E]:this.max[E];return y[2]=this.max[2],new hu(d,y)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,u=this.max;return[[o[0],o[1],o[2]],[u[0],o[1],o[2]],[u[0],u[1],o[2]],[o[0],u[1],o[2]],[o[0],o[1],u[2]],[u[0],o[1],u[2]],[u[0],u[1],u[2]],[o[0],u[1],u[2]]]}intersects(o){const u=this.getCorners();let d=!0;for(let y=0;y<o.planes.length;y++){const E=o.planes[y];let S=0;for(let D=0;D<u.length;D++)S+=Dc(E,u[D])+E[3]>=0;if(0===S)return 0;S!==u.length&&(d=!1)}if(d)return 2;for(let y=0;y<3;y++){let E=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let D=0;D<o.points.length;D++){const O=o.points[D][y]-this.min[y];E=Math.min(E,O),S=Math.max(S,O)}if(S<0||E>this.max[y]-this.min[y])return 0}return 1}}const qc=Gt/Math.PI/2,Ap=[64,32,16],Ac=-qc,Pc=qc,t0=[new hu([Ac,Ac,Ac],[Pc,Pc,Pc]),new hu([Ac,Ac,Ac],[0,0,Pc]),new hu([0,Ac,Ac],[Pc,0,Pc]),new hu([Ac,0,Ac],[0,Pc,Pc]),new hu([0,0,Ac],[Pc,Pc,Pc])];function Ld(a){return a*qc/Op}function n0(a,o,u,d=!0){const y=Mc([],a._camera.position,a.worldSize),E=[o,u,1,1];Nh(E,E,a.pixelMatrixInverse),Qv(E,E,1/E[3]);const S=Eu([],lh([],E,y)),D=a.globeMatrix,O=[D[12],D[13],D[14]],N=lh([],O,y),V=Sp(N),$=Eu([],N),H=a.worldSize/(2*Math.PI),J=Dc($,S),ie=Math.asin(H/V);if(ie<Math.acos(J)){if(!d)return null;const Ln=[],nn=[];Mc(Ln,S,V/J),Eu(nn,lh(nn,Ln,N)),Eu(S,ac(S,N,Mc(S,nn,Math.tan(ie)*V)))}const pe=[];new Bg(y,S).closestPointOnSphere(O,H,pe);const Ne=Eu([],Le(D,0)),Qe=Eu([],Le(D,1)),ft=Eu([],Le(D,2)),Ye=Dc(Ne,pe),lt=Dc(Qe,pe),Et=Dc(ft,pe),pt=me(Math.asin(-lt/H));let Kt=me(Math.atan2(Ye,Et));Kt=a.center.lng+function(Ln,nn){const gn=(nn-Ln+180)%360-180;return gn<-180?gn+360:gn}(a.center.lng,Kt);const Zt=ch(Kt),fn=Se(hh(pt),0,1);return new qf(Zt,fn)}class Hw{constructor(o,u,d){this.a=lh([],o,d),this.b=lh([],u,d),this.center=d;const y=Eu([],this.a),E=Eu([],this.b);this.angle=Math.acos(Dc(y,E))}}function vy(a,o){if(0===a.angle)return null;let u;return u=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),u<0||u>1?null:function(d,y,E,S){const D=Math.sin(E);return d*(Math.sin((1-S)*E)/D)+y*(Math.sin(S*E)/D)}(a.a[o],a.b[o],a.angle,Se(u,0,1))+a.center[o]}function Hc(a){if(a.z<=1)return t0[a.z+2*a.y+a.x];const o=Rp(Pp(a));return hu.fromPoints(o)}function Gf(a,o,u){return Mc(a,a,1-u),Ip(a,a,o,u)}function r0(a,o){const u=Fd(o.zoom);if(0===u)return Hc(a);const d=Pp(a),y=Rp(d),E=ch(d.getWest())*o.worldSize,S=ch(d.getEast())*o.worldSize,D=hh(d.getNorth())*o.worldSize,O=hh(d.getSouth())*o.worldSize,N=[E,D,0],V=[S,D,0],$=[E,O,0],H=[S,O,0],J=my([],o.globeMatrix);return Ca(N,N,J),Ca(V,V,J),Ca($,$,J),Ca(H,H,J),y[0]=Gf(y[0],$,u),y[1]=Gf(y[1],H,u),y[2]=Gf(y[2],V,u),y[3]=Gf(y[3],N,u),hu.fromPoints(y)}function Cu(a,o,u){for(const d of a)Ca(d,d,o),Mc(d,d,u)}function Pp({x:a,y:o,z:u}){const d=1/(1<<u),y=new fo(Fu(a*d),Ol((o+1)*d)),E=new fo(Fu((a+1)*d),Ol(o*d));return new Oh(y,E)}function Rp(a){const o=le(a.getNorth()),u=le(a.getSouth()),d=Math.cos(o),y=Math.cos(u),E=Math.sin(o),S=Math.sin(u),D=a.getWest(),O=a.getEast();return[ul(y,S,D),ul(y,S,O),ul(d,E,O),ul(d,E,D)]}function ul(a,o,u,d=qc){return u=le(u),[a*Math.sin(u)*d,-o*d,a*Math.cos(u)*d]}function uh(a,o,u){return ul(Math.cos(le(a)),Math.sin(le(a)),o,u)}function Nd(a,o,u,d){const y=1<<u.z,E=(a/Gt+u.x)/y;return uh(Ol((o/Gt+u.y)/y),Fu(E),d)}function Ug({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const o0=new Float64Array(16);function kd(a){const o=Ug(a),u=yy(o0,[o,o,o]);return ah(u,u,((d=[])[0]=-(y=a.min)[0],d[1]=-y[1],d[2]=-y[2],d));var d,y}function wy(a){const o=(d=a.min,(u=o0)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=d[0],u[13]=d[1],u[14]=d[2],u[15]=1,u);var u,d;const y=1/Ug(a);return hf(o,o,[y,y,y])}function by(a,o,u,d,y){const E=function(O){const N=Gt/(2*Math.PI);return O/(2*Math.PI)/N}(u),S=[a,o,-u/(2*Math.PI)],D=Gc(new Float64Array(16));return ah(D,D,S),hf(D,D,[E,E,E]),jf(D,D,le(-y)),Lg(D,D,le(-d)),D}function Fd(a){return ln(5,6,a)}function Ey(a,o){const u=uh(o.lat,o.lng);return S=(y=_y([],function(ie){const pe=uh(ie._center.lat,ie._center.lng);let Ne=Rd([],$c(0,1,0),pe);const Qe=Ad([],-ie.angle,pe);Ne=Ca(Ne,Ne,Qe),Ad(Qe,-ie._pitch,Ne);const ft=Eu([],pe);return Mc(ft,ft,Ld(ie.cameraToCenterDistance/ie.pixelsPerMeter)),Ca(ft,ft,Qe),ac([],pe,ft)}(a),u))[0],D=y[1],O=y[2],N=(E=u)[0],V=E[1],$=E[2],J=(H=Math.sqrt(S*S+D*D+O*O)*Math.sqrt(N*N+V*V+$*$))&&Dc(y,E)/H,Math.acos(Math.min(Math.max(J,-1),1));var y,E,S,D,O,N,V,$,H,J}function Cy(a,o){return Ey(a,o)>Math.PI/2*1.01}const s0=le(85),Sy=Math.cos(s0),Ty=Math.sin(s0),Op=6371008.8,Iy=2*Math.PI*Op;class fo{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fo(Bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,d=this.lat*u,y=o.lat*u,E=Math.sin(d)*Math.sin(y)+Math.cos(d)*Math.cos(y)*Math.cos((o.lng-this.lng)*u);return Op*Math.acos(Math.min(E,1))}toBounds(o=0){const u=360*o/40075017,d=u/Math.cos(Math.PI/180*this.lat);return new Oh(new fo(this.lng-d,this.lat-u),new fo(this.lng+d,this.lat+u))}toEcef(o){const u=Ld(o);return uh(this.lat,this.lng,qc+u)}static convert(o){if(o instanceof fo)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new fo(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new fo(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function $f(a){return Iy*Math.cos(a*Math.PI/180)}function ch(a){return(180+a)/360}function hh(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function lc(a,o){return a/$f(o)}function Fu(a){return 360*a-180}function Ol(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ww(a,o){return a*$f(Ol(o))}const Za=85.051129;function Vg(a){return 1/Math.cos(a*Math.PI/180)}class qf{constructor(o,u,d=0){this.x=+o,this.y=+u,this.z=+d}static fromLngLat(o,u=0){const d=fo.convert(o);return new qf(ch(d.lng),hh(d.lat),lc(u,d.lat))}toLngLat(){return new fo(Fu(this.x),Ol(this.y))}toAltitude(){return Ww(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Iy*Vg(Ol(this.y))}}function My(a,o,u,d,y,E,S,D,O){const N=(o+d)/2,V=(u+y)/2,$=new Q(N,V);D($),function(H,J,ie,pe,Ne,Qe){const ft=ie-Ne,Ye=pe-Qe;return Math.abs((pe-J)*ft-(ie-H)*Ye)/Math.hypot(ft,Ye)}($.x,$.y,E.x,E.y,S.x,S.y)>=O?(My(a,o,u,N,V,E,$,D,O),My(a,N,V,d,y,$,S,D,O)):a.push(S)}function jg(a,o,u){let d=a[0],y=d.x,E=d.y;o(d);const S=[d];for(let D=1;D<a.length;D++){const O=a[D],{x:N,y:V}=O;o(O),My(S,y,E,N,V,d,O,o,u),y=N,E=V,d=O}return S}function Dy(a,o,u,d){if(d(o,u)){const y=o.add(u)._mult(.5);Dy(a,o,y,d),Dy(a,y,u,d)}else a.push(u)}function Xw(a,o){let u=a[0];const d=[u];for(let y=1;y<a.length;y++){const E=a[y];Dy(d,u,E,o),u=E}return d}const Ay=Math.pow(2,14)-1,a0=-Ay-1;function Zw(a,o){const u=Math.round(a.x*o),d=Math.round(a.y*o);return a.x=Se(u,a0,Ay),a.y=Se(d,a0,Ay),(u<a.x||u>a.x+1||d<a.y||d>a.y+1)&&Un("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function kh(a,o,u){const d=a.loadGeometry(),y=a.extent,E=Gt/y;if(o&&u&&u.projection.isReprojectedInTileSpace){const S=1<<o.z,{scale:D,x:O,y:N,projection:V}=u,$=H=>{const J=Fu((o.x+H.x/y)/S),ie=Ol((o.y+H.y/y)/S),pe=V.project(J,ie);H.x=(pe.x*D-O)*y,H.y=(pe.y*D-N)*y};for(let H=0;H<d.length;H++)if(1!==a.type)d[H]=jg(d[H],$,1);else{const J=[];for(const ie of d[H])ie.x<0||ie.x>=y||ie.y<0||ie.y>=y||($(ie),J.push(ie));d[H]=J}}for(const S of d)for(const D of S)Zw(D,E);return d}function ff(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?kh(a):[]}}function Bd(a,o,u,d,y){a.emplaceBack(2*o+(d+1)/2,2*u+(y+1)/2)}function Lp(a,o,u){a.emplaceBack(o.x,o.y,o.z,16384*u[0],16384*u[1],16384*u[2])}class Np{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Br,this.indexArray=new Wa,this.segments=new Xa,this.programConfigurations=new Id(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,d,y){const E=this.layers[0],S=[];let D=null;"circle"===E.type&&(D=E.layout.get("circle-sort-key"));for(const{feature:N,id:V,index:$,sourceLayerIndex:H}of o){const J=this.layers[0]._featureFilter.needGeometry,ie=ff(N,J);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),ie,d))continue;const pe=D?D.evaluate(ie,{},d):void 0,Ne={id:V,properties:N.properties,type:N.type,sourceLayerIndex:H,index:$,geometry:J?ie.geometry:kh(N,d,y),patterns:{},sortKey:pe};S.push(Ne)}D&&S.sort((N,V)=>N.sortKey-V.sortKey);let O=null;"globe"===y.projection.name&&(this.globeExtVertexArray=new Jl,O=y.projection);for(const N of S){const{geometry:V,index:$,sourceLayerIndex:H}=N,J=o[$].feature;this.addFeature(N,V,$,u.availableImages,d,O),u.featureIndex.insert(J,V,$,H,this.index)}}update(o,u,d,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,d,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Cp.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Md.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,u,d,y,E,S){for(const D of u)for(const O of D){const N=O.x,V=O.y;if(N<0||N>=Gt||V<0||V>=Gt)continue;if(S){const J=S.projectTilePoint(N,V,E),ie=S.upVector(E,N,V),pe=this.globeExtVertexArray;Lp(pe,J,ie),Lp(pe,J,ie),Lp(pe,J,ie),Lp(pe,J,ie)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),H=$.vertexLength;Bd(this.layoutVertexArray,N,V,-1,-1),Bd(this.layoutVertexArray,N,V,1,-1),Bd(this.layoutVertexArray,N,V,1,1),Bd(this.layoutVertexArray,N,V,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},y,E)}}function l0(a,o){for(let u=0;u<a.length;u++)if(fh(o,a[u]))return!0;for(let u=0;u<o.length;u++)if(fh(a,o[u]))return!0;return!!Fh(a,o)}function Yw(a,o,u){return!!fh(a,o)||!!Gg(o,a,u)}function Py(a,o){if(1===a.length)return Kw(o,a[0]);for(let u=0;u<o.length;u++){const d=o[u];for(let y=0;y<d.length;y++)if(fh(a,d[y]))return!0}for(let u=0;u<a.length;u++)if(Kw(o,a[u]))return!0;for(let u=0;u<o.length;u++)if(Fh(a,o[u]))return!0;return!1}function u0(a,o,u){if(a.length>1){if(Fh(a,o))return!0;for(let d=0;d<o.length;d++)if(Gg(o[d],a,u))return!0}for(let d=0;d<a.length;d++)if(Gg(a[d],o,u))return!0;return!1}function Fh(a,o){if(0===a.length||0===o.length)return!1;for(let u=0;u<a.length-1;u++){const d=a[u],y=a[u+1];for(let E=0;E<o.length-1;E++)if(c0(d,y,o[E],o[E+1]))return!0}return!1}function c0(a,o,u,d){return Rn(a,u,d)!==Rn(o,u,d)&&Rn(a,o,u)!==Rn(a,o,d)}function Gg(a,o,u){const d=u*u;if(1===o.length)return a.distSqr(o[0])<d;for(let y=1;y<o.length;y++)if(h0(a,o[y-1],o[y])<d)return!0;return!1}function h0(a,o,u){const d=o.distSqr(u);if(0===d)return a.distSqr(o);const y=((a.x-o.x)*(u.x-o.x)+(a.y-o.y)*(u.y-o.y))/d;return a.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Kw(a,o){let u,d,y,E=!1;for(let S=0;S<a.length;S++){u=a[S];for(let D=0,O=u.length-1;D<u.length;O=D++)d=u[D],y=u[O],d.y>o.y!=y.y>o.y&&o.x<(y.x-d.x)*(o.y-d.y)/(y.y-d.y)+d.x&&(E=!E)}return E}function fh(a,o){let u=!1;for(let d=0,y=a.length-1;d<a.length;y=d++){const E=a[d],S=a[y];E.y>o.y!=S.y>o.y&&o.x<(S.x-E.x)*(o.y-E.y)/(S.y-E.y)+E.x&&(u=!u)}return u}function f0(a,o,u,d,y){for(const S of a)if(o<=S.x&&u<=S.y&&d>=S.x&&y>=S.y)return!0;const E=[new Q(o,u),new Q(o,y),new Q(d,y),new Q(d,u)];if(a.length>2)for(const S of E)if(fh(a,S))return!0;for(let S=0;S<a.length-1;S++)if(d0(a[S],a[S+1],E))return!0;return!1}function d0(a,o,u){const d=u[0],y=u[2];if(a.x<d.x&&o.x<d.x||a.x>y.x&&o.x>y.x||a.y<d.y&&o.y<d.y||a.y>y.y&&o.y>y.y)return!1;const E=Rn(a,o,u[0]);return E!==Rn(a,o,u[1])||E!==Rn(a,o,u[2])||E!==Rn(a,o,u[3])}function Hf(a,o,u){const d=o.paint.get(a).value;return"constant"===d.kind?d.value:u.programConfigurations.get(o.id).getMaxValue(a)}function kp(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function $g(a,o,u,d,y){if(!o[0]&&!o[1])return a;const E=Q.convert(o)._mult(y);"viewport"===u&&E._rotate(-d);const S=[];for(let D=0;D<a.length;D++)S.push(a[D].sub(E));return S}function Ry(a,o,u,d){const y=Q.convert(a)._mult(d);return"viewport"===o&&y._rotate(-u),y}vt(Np,"CircleBucket",{omit:["layers"]});const qg=new Pn({"circle-sort-key":new en(Yt.layout_circle["circle-sort-key"])});var Hg={paint:new Pn({"circle-radius":new en(Yt.paint_circle["circle-radius"]),"circle-color":new en(Yt.paint_circle["circle-color"]),"circle-blur":new en(Yt.paint_circle["circle-blur"]),"circle-opacity":new en(Yt.paint_circle["circle-opacity"]),"circle-translate":new Vt(Yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(Yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(Yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(Yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new en(Yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new en(Yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new en(Yt.paint_circle["circle-stroke-opacity"])}),layout:qg};function Oy(a,o,u,d,y,E,S,D,O){if(E&&a.queryGeometry.isAboveHorizon)return!1;E&&(O*=a.pixelToTileUnitsFactor);const N=a.tileID.canonical,V=u.projection.upVectorScale(N,u.center.lat,u.worldSize).metersToTile;for(const $ of o)for(const H of $){const J=H.add(D),ie=y&&u.elevation?u.elevation.exaggeration()*y.getElevationAt(J.x,J.y,!0):0,pe=u.projection.projectTilePoint(J.x,J.y,N);if(ie>0){const Ye=u.projection.upVector(N,J.x,J.y);pe.x+=Ye[0]*V*ie,pe.y+=Ye[1]*V*ie,pe.z+=Ye[2]*V*ie}const Ne=E?J:Ly(pe.x,pe.y,pe.z,d),Qe=E?a.tilespaceRays.map(Ye=>Fp(Ye,ie)):a.queryGeometry.screenGeometry,ft=Nh([],[pe.x,pe.y,pe.z,1],d);if(!S&&E?O*=ft[3]/u.cameraToCenterDistance:S&&!E&&(O*=u.cameraToCenterDistance/ft[3]),E){const Ye=Ol((H.y/Gt+N.y)/(1<<N.z));O/=u.projection.pixelsPerMeter(Ye,1)/lc(1,Ye)}if(Yw(Qe,Ne,O))return!0}return!1}function Ly(a,o,u,d){const y=Nh([],[a,o,u,1],d);return new Q(y[0]/y[3],y[1]/y[3])}const Wg=$c(0,0,0),Ny=$c(0,0,1);function Fp(a,o){const u=kg();return Wg[2]=o,a.intersectsPlane(Wg,Ny,u),new Q(u[0],u[1])}class p0 extends Np{}function ky(a,{width:o,height:u},d,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==o*u*d)throw new RangeError("mismatched image size")}else y=new Uint8Array(o*u*d);return a.width=o,a.height=u,a.data=y,a}function g0(a,o,u){const{width:d,height:y}=o;d===a.width&&y===a.height||(Fy(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,d),height:Math.min(a.height,y)},u),a.width=d,a.height=y,a.data=o.data)}function Fy(a,o,u,d,y,E){if(0===y.width||0===y.height)return o;if(y.width>a.width||y.height>a.height||u.x>a.width-y.width||u.y>a.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||d.x>o.width-y.width||d.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,D=o.data;for(let O=0;O<y.height;O++){const N=((u.y+O)*a.width+u.x)*E,V=((d.y+O)*o.width+d.x)*E;for(let $=0;$<y.width*E;$++)D[V+$]=S[N+$]}return o}vt(p0,"HeatmapBucket",{omit:["layers"]});class dh{constructor(o,u){ky(this,o,1,u)}resize(o){g0(this,new dh(o),1)}clone(){return new dh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,d,y,E){Fy(o,u,d,y,E,1)}}class Su{constructor(o,u){ky(this,o,4,u)}resize(o){g0(this,new Su(o),4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Su({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,d,y,E){Fy(o,u,d,y,E,4)}}vt(dh,"AlphaImage"),vt(Su,"RGBAImage");var Xg={paint:new Pn({"heatmap-radius":new en(Yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new en(Yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(Yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xn(Yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(Yt.paint_heatmap["heatmap-opacity"])})};function Bp(a){const o={},u=a.resolution||256,d=a.clips?a.clips.length:1,y=a.image||new Su({width:u,height:d}),E=(S,D,O)=>{o[a.evaluationKey]=O;const N=a.expression.evaluate(o);y.data[S+D+0]=Math.floor(255*N.r/N.a),y.data[S+D+1]=Math.floor(255*N.g/N.a),y.data[S+D+2]=Math.floor(255*N.b/N.a),y.data[S+D+3]=Math.floor(255*N.a)};if(a.clips)for(let S=0,D=0;S<d;++S,D+=4*u)for(let O=0,N=0;O<u;O++,N+=4){const V=O/(u-1),{start:$,end:H}=a.clips[S];E(D,N,$*(1-V)+H*V)}else for(let S=0,D=0;S<u;S++,D+=4)E(0,D,S/(u-1));return y}var Wf={paint:new Pn({"hillshade-illumination-direction":new Vt(Yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(Yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(Yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(Yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(Yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(Yt.paint_hillshade["hillshade-accent-color"])})};const Jw=Ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qw}=Jw;var zp={};function Zg(a,o,u){u=u||2;var d,y,E,S,D,O,N,V=o&&o.length,$=V?o[0]*u:a.length,H=Yg(a,0,$,u,!0),J=[];if(!H||H.next===H.prev)return J;if(V&&(H=function(pe,Ne,Qe,ft){var Ye,lt,Et,pt=[];for(Ye=0,lt=Ne.length;Ye<lt;Ye++)(Et=Yg(pe,Ne[Ye]*ft,Ye<lt-1?Ne[Ye+1]*ft:pe.length,ft,!1))===Et.next&&(Et.steiner=!0),pt.push(tb(Et));for(pt.sort(_0),Ye=0;Ye<pt.length;Ye++)Qe=v0(pt[Ye],Qe);return Qe}(a,o,H,u)),a.length>80*u){d=E=a[0],y=S=a[1];for(var ie=u;ie<$;ie+=u)(D=a[ie])<d&&(d=D),(O=a[ie+1])<y&&(y=O),D>E&&(E=D),O>S&&(S=O);N=0!==(N=Math.max(E-d,S-y))?32767/N:0}return zd(H,J,u,d,y,N,0),J}function Yg(a,o,u,d,y){var E,S;if(y===Gy(a,o,u,d)>0)for(E=o;E<u;E+=d)S=ib(E,a[E],a[E+1],S);else for(E=u-d;E>=o;E-=d)S=ib(E,a[E],a[E+1],S);return S&&df(S,S.next)&&(Vd(S),S=S.next),S}function Xf(a,o){if(!a)return a;o||(o=a);var u,d=a;do{if(u=!1,d.steiner||!df(d,d.next)&&0!==js(d.prev,d,d.next))d=d.next;else{if(Vd(d),(d=o=d.prev)===d.next)break;u=!0}}while(u||d!==o);return o}function zd(a,o,u,d,y,E,S){if(a){!S&&E&&function(V,$,H,J){var ie=V;do{0===ie.z&&(ie.z=zy(ie.x,ie.y,$,H,J)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next}while(ie!==V);ie.prevZ.nextZ=null,ie.prevZ=null,function(pe){var Ne,Qe,ft,Ye,lt,Et,pt,Kt,Zt=1;do{for(Qe=pe,pe=null,lt=null,Et=0;Qe;){for(Et++,ft=Qe,pt=0,Ne=0;Ne<Zt&&(pt++,ft=ft.nextZ);Ne++);for(Kt=Zt;pt>0||Kt>0&&ft;)0!==pt&&(0===Kt||!ft||Qe.z<=ft.z)?(Ye=Qe,Qe=Qe.nextZ,pt--):(Ye=ft,ft=ft.nextZ,Kt--),lt?lt.nextZ=Ye:pe=Ye,Ye.prevZ=lt,lt=Ye;Qe=ft}lt.nextZ=null,Zt*=2}while(Et>1)}(ie)}(a,d,y,E);for(var D,O,N=a;a.prev!==a.next;)if(D=a.prev,O=a.next,E?By(a,d,y,E):Kg(a))o.push(D.i/u|0),o.push(a.i/u|0),o.push(O.i/u|0),Vd(a),a=O.next,N=O.next;else if((a=O)===N){S?1===S?zd(a=m0(Xf(a),o,u),o,u,d,y,E,2):2===S&&y0(a,o,u,d,y,E):zd(Xf(a),o,u,d,y,E,1);break}}}function Kg(a){var o=a.prev,u=a,d=a.next;if(js(o,u,d)>=0)return!1;for(var y=o.x,E=u.x,S=d.x,D=o.y,O=u.y,N=d.y,V=y<E?y<S?y:S:E<S?E:S,$=D<O?D<N?D:N:O<N?O:N,H=y>E?y>S?y:S:E>S?E:S,J=D>O?D>N?D:N:O>N?O:N,ie=d.next;ie!==o;){if(ie.x>=V&&ie.x<=H&&ie.y>=$&&ie.y<=J&&Ud(y,D,E,O,S,N,ie.x,ie.y)&&js(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function By(a,o,u,d){var y=a.prev,E=a,S=a.next;if(js(y,E,S)>=0)return!1;for(var D=y.x,O=E.x,N=S.x,V=y.y,$=E.y,H=S.y,J=D<O?D<N?D:N:O<N?O:N,ie=V<$?V<H?V:H:$<H?$:H,pe=D>O?D>N?D:N:O>N?O:N,Ne=V>$?V>H?V:H:$>H?$:H,Qe=zy(J,ie,o,u,d),ft=zy(pe,Ne,o,u,d),Ye=a.prevZ,lt=a.nextZ;Ye&&Ye.z>=Qe&&lt&&lt.z<=ft;){if(Ye.x>=J&&Ye.x<=pe&&Ye.y>=ie&&Ye.y<=Ne&&Ye!==y&&Ye!==S&&Ud(D,V,O,$,N,H,Ye.x,Ye.y)&&js(Ye.prev,Ye,Ye.next)>=0||(Ye=Ye.prevZ,lt.x>=J&&lt.x<=pe&&lt.y>=ie&&lt.y<=Ne&&lt!==y&&lt!==S&&Ud(D,V,O,$,N,H,lt.x,lt.y)&&js(lt.prev,lt,lt.next)>=0))return!1;lt=lt.nextZ}for(;Ye&&Ye.z>=Qe;){if(Ye.x>=J&&Ye.x<=pe&&Ye.y>=ie&&Ye.y<=Ne&&Ye!==y&&Ye!==S&&Ud(D,V,O,$,N,H,Ye.x,Ye.y)&&js(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.prevZ}for(;lt&&lt.z<=ft;){if(lt.x>=J&&lt.x<=pe&&lt.y>=ie&&lt.y<=Ne&&lt!==y&&lt!==S&&Ud(D,V,O,$,N,H,lt.x,lt.y)&&js(lt.prev,lt,lt.next)>=0)return!1;lt=lt.nextZ}return!0}function m0(a,o,u){var d=a;do{var y=d.prev,E=d.next.next;!df(y,E)&&x0(y,d,d.next,E)&&Jg(y,E)&&Jg(E,y)&&(o.push(y.i/u|0),o.push(d.i/u|0),o.push(E.i/u|0),Vd(d),Vd(d.next),d=a=E),d=d.next}while(d!==a);return Xf(d)}function y0(a,o,u,d,y,E){var S=a;do{for(var D=S.next.next;D!==S.prev;){if(S.i!==D.i&&nb(S,D)){var O=rb(S,D);return S=Xf(S,S.next),O=Xf(O,O.next),zd(S,o,u,d,y,E,0),void zd(O,o,u,d,y,E,0)}D=D.next}S=S.next}while(S!==a)}function _0(a,o){return a.x-o.x}function v0(a,o){var u=function(y,E){var S,D=E,O=y.x,N=y.y,V=-1/0;do{if(N<=D.y&&N>=D.next.y&&D.next.y!==D.y){var $=D.x+(N-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if($<=O&&$>V&&(V=$,S=D.x<D.next.x?D:D.next,$===O))return S}D=D.next}while(D!==E);if(!S)return null;var H,J=S,ie=S.x,pe=S.y,Ne=1/0;D=S;do{O>=D.x&&D.x>=ie&&O!==D.x&&Ud(N<pe?O:V,N,ie,pe,N<pe?V:O,N,D.x,D.y)&&(H=Math.abs(N-D.y)/(O-D.x),Jg(D,y)&&(H<Ne||H===Ne&&(D.x>S.x||D.x===S.x&&eb(S,D)))&&(S=D,Ne=H)),D=D.next}while(D!==J);return S}(a,o);if(!u)return o;var d=rb(u,a);return Xf(d,d.next),Xf(u,u.next)}function eb(a,o){return js(a.prev,a,o.prev)<0&&js(o.next,a,a.next)<0}function zy(a,o,u,d,y){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-u)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*y|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function tb(a){var o=a,u=a;do{(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next}while(o!==a);return u}function Ud(a,o,u,d,y,E,S,D){return(y-S)*(o-D)>=(a-S)*(E-D)&&(a-S)*(d-D)>=(u-S)*(o-D)&&(u-S)*(E-D)>=(y-S)*(d-D)}function nb(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(u,d){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==d.i&&y.next.i!==d.i&&x0(y,y.next,u,d))return!0;y=y.next}while(y!==u);return!1}(a,o)&&(Jg(a,o)&&Jg(o,a)&&function(u,d){var y=u,E=!1,S=(u.x+d.x)/2,D=(u.y+d.y)/2;do{y.y>D!=y.next.y>D&&y.next.y!==y.y&&S<(y.next.x-y.x)*(D-y.y)/(y.next.y-y.y)+y.x&&(E=!E),y=y.next}while(y!==u);return E}(a,o)&&(js(a.prev,a,o.prev)||js(a,o.prev,o))||df(a,o)&&js(a.prev,a,a.next)>0&&js(o.prev,o,o.next)>0)}function js(a,o,u){return(o.y-a.y)*(u.x-o.x)-(o.x-a.x)*(u.y-o.y)}function df(a,o){return a.x===o.x&&a.y===o.y}function x0(a,o,u,d){var y=Vy(js(a,o,u)),E=Vy(js(a,o,d)),S=Vy(js(u,d,a)),D=Vy(js(u,d,o));return y!==E&&S!==D||!(0!==y||!Uy(a,u,o))||!(0!==E||!Uy(a,d,o))||!(0!==S||!Uy(u,a,d))||!(0!==D||!Uy(u,o,d))}function Uy(a,o,u){return o.x<=Math.max(a.x,u.x)&&o.x>=Math.min(a.x,u.x)&&o.y<=Math.max(a.y,u.y)&&o.y>=Math.min(a.y,u.y)}function Vy(a){return a>0?1:a<0?-1:0}function Jg(a,o){return js(a.prev,a,a.next)<0?js(a,o,a.next)>=0&&js(a,a.prev,o)>=0:js(a,o,a.prev)<0||js(a,a.next,o)<0}function rb(a,o){var u=new jy(a.i,a.x,a.y),d=new jy(o.i,o.x,o.y),y=a.next,E=o.prev;return a.next=o,o.prev=a,u.next=y,y.prev=u,d.next=u,u.prev=d,E.next=d,d.prev=E,d}function ib(a,o,u,d){var y=new jy(a,o,u);return d?(y.next=d.next,y.prev=d,d.next.prev=y,d.next=y):(y.prev=y,y.next=y),y}function Vd(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function jy(a,o,u){this.i=a,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gy(a,o,u,d){for(var y=0,E=o,S=u-d;E<u;E+=d)y+=(a[S]-a[E])*(a[E+1]+a[S+1]),S=E;return y}function ob(a,o,u,d,y){w0(a,o,u||0,d||a.length-1,y||Bh)}function w0(a,o,u,d,y){for(;d>u;){if(d-u>600){var E=d-u+1,S=o-u+1,D=Math.log(E),O=.5*Math.exp(2*D/3),N=.5*Math.sqrt(D*O*(E-O)/E)*(S-E/2<0?-1:1);w0(a,o,Math.max(u,Math.floor(o-S*O/E+N)),Math.min(d,Math.floor(o+(E-S)*O/E+N)),y)}var V=a[o],$=u,H=d;for(Zf(a,u,o),y(a[d],V)>0&&Zf(a,u,d);$<H;){for(Zf(a,$,H),$++,H--;y(a[$],V)<0;)$++;for(;y(a[H],V)>0;)H--}0===y(a[u],V)?Zf(a,u,H):Zf(a,++H,d),H<=o&&(u=H+1),o<=H&&(d=H-1)}}function Zf(a,o,u){var d=a[o];a[o]=a[u],a[u]=d}function Bh(a,o){return a<o?-1:a>o?1:0}function Yf(a,o){const u=a.length;if(u<=1)return[a];const d=[];let y,E;for(let S=0;S<u;S++){const D=Jn(a[S]);0!==D&&(a[S].area=Math.abs(D),void 0===E&&(E=D<0),E===D<0?(y&&d.push(y),y=[a[S]]):y.push(a[S]))}if(y&&d.push(y),o>1)for(let S=0;S<d.length;S++)d[S].length<=o||(ob(d[S],o,1,d[S].length-1,b0),d[S]=d[S].slice(0,o));return d}function b0(a,o){return o.area-a.area}function Qg(a,o,u){const d=u.patternDependencies;let y=!1;for(const E of o){const S=E.paint.get(`${a}-pattern`);S.isConstant()||(y=!0);const D=S.constantOr(null);D&&(y=!0,d[D]=!0)}return y}function em(a,o,u,d,y){const E=y.patternDependencies;for(const S of o){const D=S.paint.get(`${a}-pattern`).value;if("constant"!==D.kind){let O=D.evaluate({zoom:d},u,{},y.availableImages);O=O&&O.name?O.name:O,E[O]=!0,u.patterns[S.id]=O}}return u}({get exports(){return zp},set exports(a){zp=a}}).exports=Zg,zp.default=Zg,Zg.deviation=function(a,o,u,d){var y=o&&o.length,E=Math.abs(Gy(a,0,y?o[0]*u:a.length,u));if(y)for(var S=0,D=o.length;S<D;S++)E-=Math.abs(Gy(a,o[S]*u,S<D-1?o[S+1]*u:a.length,u));var O=0;for(S=0;S<d.length;S+=3){var N=d[S]*u,V=d[S+1]*u,$=d[S+2]*u;O+=Math.abs((a[N]-a[$])*(a[V+1]-a[N+1])-(a[N]-a[V])*(a[$+1]-a[N+1]))}return 0===E&&0===O?0:Math.abs((O-E)/E)},Zg.flatten=function(a){for(var o=a[0][0].length,u={vertices:[],holes:[],dimensions:o},d=0,y=0;y<a.length;y++){for(var E=0;E<a[y].length;E++)for(var S=0;S<o;S++)u.vertices.push(a[y][E][S]);y>0&&u.holes.push(d+=a[y-1].length)}return u};class $y{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Br,this.indexArray=new Wa,this.indexArray2=new Er,this.programConfigurations=new Id(o.layers,o.zoom),this.segments=new Xa,this.segments2=new Xa,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=o.projection}populate(o,u,d,y){this.hasPattern=Qg("fill",this.layers,u);const E=this.layers[0].layout.get("fill-sort-key"),S=[];for(const{feature:D,id:O,index:N,sourceLayerIndex:V}of o){const $=this.layers[0]._featureFilter.needGeometry,H=ff(D,$);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),H,d))continue;const J=E?E.evaluate(H,{},d,u.availableImages):void 0,ie={id:O,properties:D.properties,type:D.type,sourceLayerIndex:V,index:N,geometry:$?H.geometry:kh(D,d,y),patterns:{},sortKey:J};S.push(ie)}E&&S.sort((D,O)=>D.sortKey-O.sortKey);for(const D of S){const{geometry:O,index:N,sourceLayerIndex:V}=D;if(this.hasPattern){const $=em("fill",this.layers,D,this.zoom,u);this.patternFeatures.push($)}else this.addFeature(D,O,N,d,{},u.availableImages);u.featureIndex.insert(o[N].feature,O,N,V,this.index)}}update(o,u,d,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,d,y)}addFeatures(o,u,d,y,E){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,d,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Qw),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,d,y,E,S=[]){for(const D of Yf(u,500)){let O=0;for(const ie of D)O+=ie.length;const N=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray),V=N.vertexLength,$=[],H=[];for(const ie of D){if(0===ie.length)continue;ie!==D[0]&&H.push($.length/2);const pe=this.segments2.prepareSegment(ie.length,this.layoutVertexArray,this.indexArray2),Ne=pe.vertexLength;this.layoutVertexArray.emplaceBack(ie[0].x,ie[0].y),this.indexArray2.emplaceBack(Ne+ie.length-1,Ne),$.push(ie[0].x),$.push(ie[0].y);for(let Qe=1;Qe<ie.length;Qe++)this.layoutVertexArray.emplaceBack(ie[Qe].x,ie[Qe].y),this.indexArray2.emplaceBack(Ne+Qe-1,Ne+Qe),$.push(ie[Qe].x),$.push(ie[Qe].y);pe.vertexLength+=ie.length,pe.primitiveLength+=ie.length}const J=zp($,H);for(let ie=0;ie<J.length;ie+=3)this.indexArray.emplaceBack(V+J[ie],V+J[ie+1],V+J[ie+2]);N.vertexLength+=O,N.primitiveLength+=J.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,E,S,y)}}vt($y,"FillBucket",{omit:["layers","patternFeatures"]});const KT=new Pn({"fill-sort-key":new en(Yt.layout_fill["fill-sort-key"])});var JT={paint:new Pn({"fill-antialias":new Vt(Yt.paint_fill["fill-antialias"]),"fill-opacity":new en(Yt.paint_fill["fill-opacity"]),"fill-color":new en(Yt.paint_fill["fill-color"]),"fill-outline-color":new en(Yt.paint_fill["fill-outline-color"]),"fill-translate":new Vt(Yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(Yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new en(Yt.paint_fill["fill-pattern"])}),layout:KT};const qy=Ir([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Hy=Ir([{name:"a_centroid_pos",components:2,type:"Uint16"}]),QT=Ir([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:eI}=qy;var Up={},sb=Q,E0=jd;function jd(a,o,u,d,y){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=y,a.readFields(ab,this,o)}function ab(a,o,u){1==a?o.id=u.readVarint():2==a?function(d,y){for(var E=d.readVarint()+d.pos;d.pos<E;){var S=y._keys[d.readVarint()],D=y._values[d.readVarint()];y.properties[S]=D}}(u,o):3==a?o.type=u.readVarint():4==a&&(o._geometry=u.pos)}function C0(a){for(var o,u,d=0,y=0,E=a.length,S=E-1;y<E;S=y++)d+=((u=a[S]).x-(o=a[y]).x)*(o.y+u.y);return d}jd.types=["Unknown","Point","LineString","Polygon"],jd.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,u=a.readVarint()+a.pos,d=1,y=0,E=0,S=0,D=[];a.pos<u;){if(y<=0){var O=a.readVarint();d=7&O,y=O>>3}if(y--,1===d||2===d)E+=a.readSVarint(),S+=a.readSVarint(),1===d&&(o&&D.push(o),o=[]),o.push(new sb(E,S));else{if(7!==d)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&D.push(o),D},jd.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,u=1,d=0,y=0,E=0,S=1/0,D=-1/0,O=1/0,N=-1/0;a.pos<o;){if(d<=0){var V=a.readVarint();u=7&V,d=V>>3}if(d--,1===u||2===u)(y+=a.readSVarint())<S&&(S=y),y>D&&(D=y),(E+=a.readSVarint())<O&&(O=E),E>N&&(N=E);else if(7!==u)throw new Error("unknown command "+u)}return[S,O,D,N]},jd.prototype.toGeoJSON=function(a,o,u){var d,y,E=this.extent*Math.pow(2,u),S=this.extent*a,D=this.extent*o,O=this.loadGeometry(),N=jd.types[this.type];function V(J){for(var ie=0;ie<J.length;ie++){var pe=J[ie];J[ie]=[360*(pe.x+S)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+D)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(d=0;d<O.length;d++)$[d]=O[d][0];V(O=$);break;case 2:for(d=0;d<O.length;d++)V(O[d]);break;case 3:for(O=function(J){var ie=J.length;if(ie<=1)return[J];for(var pe,Ne,Qe=[],ft=0;ft<ie;ft++){var Ye=C0(J[ft]);0!==Ye&&(void 0===Ne&&(Ne=Ye<0),Ne===Ye<0?(pe&&Qe.push(pe),pe=[J[ft]]):pe.push(J[ft]))}return pe&&Qe.push(pe),Qe}(O),d=0;d<O.length;d++)for(y=0;y<O[d].length;y++)V(O[d][y])}1===O.length?O=O[0]:N="Multi"+N;var H={type:"Feature",geometry:{type:N,coordinates:O},properties:this.properties};return"id"in this&&(H.id=this.id),H};var tm=E0,S0=nm;function nm(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(lb,this,o),this.length=this._features.length}function lb(a,o,u){15===a?o.version=u.readVarint():1===a?o.name=u.readString():5===a?o.extent=u.readVarint():2===a?o._features.push(u.pos):3===a?o._keys.push(u.readString()):4===a&&o._values.push(function(d){for(var y=null,E=d.readVarint()+d.pos;d.pos<E;){var S=d.readVarint()>>3;y=1===S?d.readString():2===S?d.readFloat():3===S?d.readDouble():4===S?d.readVarint64():5===S?d.readVarint():6===S?d.readSVarint():7===S?d.readBoolean():null}return y}(u))}nm.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new tm(this._pbf,o,this.extent,this._keys,this._values)};var wl=S0;function ub(a,o,u){if(3===a){var d=new wl(u,u.readVarint()+u.pos);d.length&&(o[d.name]=d)}}var Wy=Up.VectorTile=function(a,o){this.layers=a.readFields(ub,{},o)},Gd=Up.VectorTileFeature=E0;function Vp(a,o,u,d){const y=[],E=0===d?(S,D,O,N,V,$)=>{S.push(new Q($,O+($-D)/(N-D)*(V-O)))}:(S,D,O,N,V,$)=>{S.push(new Q(D+($-O)/(V-O)*(N-D),$))};for(const S of a){const D=[];for(const O of S){if(O.length<=2)continue;const N=[];for(let H=0;H<O.length-1;H++){const J=O[H].x,ie=O[H].y,pe=O[H+1].x,Ne=O[H+1].y,Qe=0===d?J:ie,ft=0===d?pe:Ne;Qe<o?ft>o&&E(N,J,ie,pe,Ne,o):Qe>u?ft<u&&E(N,J,ie,pe,Ne,u):N.push(O[H]),ft<o&&Qe>=o&&E(N,J,ie,pe,Ne,o),ft>u&&Qe<=u&&E(N,J,ie,pe,Ne,u)}let V=O[O.length-1];const $=0===d?V.x:V.y;$>=o&&$<=u&&N.push(V),N.length&&(V=N[N.length-1],N[0].x===V.x&&N[0].y===V.y||N.push(N[0]),D.push(N))}D.length&&y.push(D)}return y}Up.VectorTileLayer=S0;const cb=Gd.types,hb=Math.pow(2,13);function jp(a,o,u,d,y,E,S,D){a.emplaceBack((o<<1)+S,(u<<1)+E,(Math.floor(d*hb)<<1)+y,Math.round(D))}function Gp(a,o,u){a.emplaceBack(o.x,o.y,o.z,16384*u[0],16384*u[1],16384*u[2])}class T0{constructor(){this.acc=new Q(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Q(o.x,o.y),this.max=new Q(o.x,o.y))}append(o,u){this.currentPolyCount.edges++,this.acc._add(o);const d=this.min,y=this.max;o.x<d.x?d.x=o.x:o.x>y.x&&(y.x=o.x),o.y<d.y?d.y=o.y:o.y>y.y&&(y.y=o.y),((0===o.x||o.x===Gt)&&o.x===u.x)!=((0===o.y||o.y===Gt)&&o.y===u.y)&&this.processBorderOverlap(o,u),u.x<0!=o.x<0&&this.addBorderIntersection(0,er(u.y,o.y,(0-u.x)/(o.x-u.x))),u.x>Gt!=o.x>Gt&&this.addBorderIntersection(1,er(u.y,o.y,(Gt-u.x)/(o.x-u.x))),u.y<0!=o.y<0&&this.addBorderIntersection(2,er(u.x,o.x,(0-u.y)/(o.y-u.y))),u.y>Gt!=o.y>Gt&&this.addBorderIntersection(3,er(u.x,o.x,(Gt-u.y)/(o.y-u.y)))}addBorderIntersection(o,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[o];u<d[0]&&(d[0]=u),u>d[1]&&(d[1]=u)}processBorderOverlap(o,u){if(o.x===u.x){if(o.y===u.y)return;const d=0===o.x?0:1;this.addBorderIntersection(d,u.y),this.addBorderIntersection(d,o.y)}else{const d=0===o.y?2:3;this.addBorderIntersection(d,u.x),this.addBorderIntersection(d,o.x)}}centroid(){const o=this.polyCount.reduce((u,d)=>u+d.edges,0);return 0!==o?this.acc.div(o)._round():new Q(0,0)}span(){return new Q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,u)=>o+ +(u[0]!==Number.MAX_VALUE),0)}}class rm{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new rs,this.centroidVertexArray=new Ed,this.indexArray=new Wa,this.programConfigurations=new Id(o.layers,o.zoom),this.segments=new Xa,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.enableTerrain=o.enableTerrain}populate(o,u,d,y){this.features=[],this.hasPattern=Qg("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(E){const S=Math.exp(Math.PI*(1-E.y/(1<<E.z)*2));return 80150034*S/(S*S+1)/Gt/(1<<E.z)}(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:E,id:S,index:D,sourceLayerIndex:O}of o){const N=this.layers[0]._featureFilter.needGeometry,V=ff(E,N);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),V,d))continue;const $={id:S,sourceLayerIndex:O,index:D,geometry:N?V.geometry:kh(E,d,y),properties:E.properties,type:E.type,patterns:{}},H=this.layoutVertexArray.length;this.hasPattern?this.features.push(em("fill-extrusion",this.layers,$,this.zoom,u)):this.addFeature($,$.geometry,D,d,{},u.availableImages,y),u.featureIndex.insert(E,$.geometry,D,O,this.index,H)}this.sortBorders()}addFeatures(o,u,d,y,E){for(const S of this.features){const{geometry:D}=S;this.addFeature(S,D,S.index,u,d,y,E)}this.sortBorders()}update(o,u,d,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,d,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,eI),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,QT.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Hy.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,d,y,E,S,D){const O=[new Q(0,0),new Q(Gt,Gt)],N=D.projection,V="globe"===N.name,$=this.enableTerrain&&!V?new T0:null,H="Polygon"===cb[o.type];V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Jl);const J=Yf(u,500);for(let Qe=J.length-1;Qe>=0;Qe--){const ft=J[Qe];(0===ft.length||(ie=ft[0]).every(Ye=>Ye.x<=0)||ie.every(Ye=>Ye.x>=Gt)||ie.every(Ye=>Ye.y<=0)||ie.every(Ye=>Ye.y>=Gt))&&J.splice(Qe,1)}var ie;let pe;if(V)pe=Ky(J,O,y);else{pe=[];for(const Qe of J)pe.push({polygon:Qe,bounds:O})}const Ne=H?this.edgeRadius:0;for(const{polygon:Qe,bounds:ft}of pe){let Ye=0,lt=0;for(const pt of Qe)H&&!pt[0].equals(pt[pt.length-1])&&pt.push(pt[0]),lt+=H?pt.length-1:pt.length;const Et=this.segments.prepareSegment((H?5:4)*lt,this.layoutVertexArray,this.indexArray);if(H){const pt=[],Kt=[];Ye=Et.vertexLength;for(const fn of Qe){let Ln,nn;fn.length&&fn!==Qe[0]&&Kt.push(pt.length/2),Ln=fn[1].sub(fn[0])._perp()._unit();for(let gn=1;gn<fn.length;gn++){const wn=fn[gn],In=fn[gn===fn.length-1?1:gn+1];let{x:Nn,y:an}=wn;if(Ne){nn=In.sub(wn)._perp()._unit();const Wn=Ln.add(nn)._unit(),$r=Ne*Math.min(4,1/(Ln.x*Wn.x+Ln.y*Wn.y));Nn+=$r*Wn.x,an+=$r*Wn.y,Ln=nn}jp(this.layoutVertexArray,Nn,an,0,0,1,1,0),Et.vertexLength++,pt.push(wn.x,wn.y),V&&Gp(this.layoutVertexExtArray,N.projectTilePoint(Nn,an,y),N.upVector(y,Nn,an))}}const Zt=zp(pt,Kt);for(let fn=0;fn<Zt.length;fn+=3)this.indexArray.emplaceBack(Ye+Zt[fn],Ye+Zt[fn+2],Ye+Zt[fn+1]),Et.primitiveLength++}for(const pt of Qe){$&&pt.length&&$.startRing(pt[0]);let Kt,Zt,fn,Ln=pt.length>4&&Zy(pt[pt.length-2],pt[0],pt[1]),nn=Ne?$p(pt[pt.length-2],pt[0],pt[1],Ne):0;Zt=pt[1].sub(pt[0])._perp()._unit();let gn=!0;for(let wn=1,In=0;wn<pt.length;wn++){let Nn=pt[wn-1],an=pt[wn];const Wn=pt[wn===pt.length-1?1:wn+1];if($&&H&&$.currentPolyCount.top++,Xy(an,Nn,ft)){Ne&&(Zt=Wn.sub(an)._perp()._unit(),gn=!gn);continue}$&&$.append(an,Nn);const $r=an.sub(Nn)._perp(),rr=$r.x/(Math.abs($r.x)+Math.abs($r.y)),vr=$r.y>0?1:0,Vn=Nn.dist(an);if(In+Vn>32768&&(In=0),Ne){fn=Wn.sub(an)._perp()._unit();let Vi=im(Nn,an,Wn,fb(Zt,fn),Ne);isNaN(Vi)&&(Vi=0);const Wr=an.sub(Nn)._unit();Nn=Nn.add(Wr.mult(nn))._round(),an=an.add(Wr.mult(-Vi))._round(),nn=Vi,Zt=fn}const qr=Et.vertexLength,zi=pt.length>4&&Zy(Nn,an,Wn);let Ii=Yy(In,Ln,gn);if(jp(this.layoutVertexArray,Nn.x,Nn.y,rr,vr,0,0,Ii),jp(this.layoutVertexArray,Nn.x,Nn.y,rr,vr,0,1,Ii),In+=Vn,Ii=Yy(In,zi,!gn),Ln=zi,jp(this.layoutVertexArray,an.x,an.y,rr,vr,0,0,Ii),jp(this.layoutVertexArray,an.x,an.y,rr,vr,0,1,Ii),Et.vertexLength+=4,this.indexArray.emplaceBack(qr+0,qr+1,qr+2),this.indexArray.emplaceBack(qr+1,qr+3,qr+2),Et.primitiveLength+=2,Ne){const Vi=Ye+(1===wn?pt.length-2:wn-2),Wr=1===wn?Ye:Vi+1;if(this.indexArray.emplaceBack(qr+1,Vi,qr+3),this.indexArray.emplaceBack(Vi,Wr,qr+3),Et.primitiveLength+=2,void 0===Kt&&(Kt=qr),!Xy(Wn,pt[wn],ft)){const ps=wn===pt.length-1?Kt:Et.vertexLength;this.indexArray.emplaceBack(qr+2,qr+3,ps),this.indexArray.emplaceBack(qr+3,ps+1,ps),this.indexArray.emplaceBack(qr+3,Wr,ps+1),Et.primitiveLength+=3}gn=!gn}if(V){const Vi=this.layoutVertexExtArray,Wr=N.projectTilePoint(Nn.x,Nn.y,y),ps=N.projectTilePoint(an.x,an.y,y),hi=N.upVector(y,Nn.x,Nn.y),Ki=N.upVector(y,an.x,an.y);Gp(Vi,Wr,hi),Gp(Vi,Wr,hi),Gp(Vi,ps,Ki),Gp(Vi,ps,Ki)}}H&&(Ye+=pt.length-1)}}if($&&$.polyCount.length>0){if($.borders){$.vertexArrayOffset=this.centroidVertexArray.length;const Qe=$.borders,ft=this.featuresOnBorder.push($)-1;for(let Ye=0;Ye<4;Ye++)Qe[Ye][0]!==Number.MAX_VALUE&&this.borders[Ye].push(ft)}this.encodeCentroid($.borders?void 0:$.centroid(),$)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,E,S,y)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((u,d)=>this.featuresOnBorder[u].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}encodeCentroid(o,u,d=!0){let y,E;if(o)if(0!==o.y){const D=u.span()._mult(this.tileToMeter);y=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(D.x/10)),E=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(D.y/10))}else y=Math.ceil(7*(o.x+450)),E=0;else y=0,E=+d;let S=d?this.centroidVertexArray.length:u.vertexArrayOffset;for(const D of u.polyCount){d&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*D.edges+D.top);for(let O=0;O<D.top;O++)this.centroidVertexArray.emplace(S++,y,E);for(let O=0;O<2*D.edges;O++)this.centroidVertexArray.emplace(S++,0,E),this.centroidVertexArray.emplace(S++,y,E)}}}function fb(a,o){const u=a.add(o)._unit();return a.x*u.x+a.y*u.y}function $p(a,o,u,d){const y=o.sub(a)._perp()._unit(),E=u.sub(o)._perp()._unit();return im(a,o,u,fb(y,E),d)}function im(a,o,u,d,y){const E=Math.sqrt(1-d*d);return Math.min(a.dist(o)/3,o.dist(u)/3,y*E/d)}function Xy(a,o,u){return a.x<u[0].x&&o.x<u[0].x||a.x>u[1].x&&o.x>u[1].x||a.y<u[0].y&&o.y<u[0].y||a.y>u[1].y&&o.y>u[1].y}function Zy(a,o,u){if(a.x<0||a.x>=Gt||o.x<0||o.x>=Gt||u.x<0||u.x>=Gt)return!1;const d=u.sub(o),y=d.perp(),E=a.sub(o);return(d.x*E.x+d.y*E.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(E.x*E.x+E.y*E.y))>-.866&&y.x*E.x+y.y*E.y<0}function Yy(a,o,u){const d=o?2|a:-3&a;return u?1|d:-2&d}function I0(){const a=Math.PI/32,o=Math.tan(a),u=Op;return u*Math.sqrt(1+2*o*o)-u}function Ky(a,o,u){const d=1<<u.z,y=Fu(u.x/d),E=Fu((u.x+1)/d),S=Ol(u.y/d),D=Ol((u.y+1)/d);return function(O,N,V,$,H=0,J){const ie=[];if(!O.length||!V||!$)return ie;const pe=(pt,Kt)=>{for(const Zt of pt)ie.push({polygon:Zt,bounds:Kt})},Ne=Math.ceil(Math.log2(V)),Qe=Math.ceil(Math.log2($)),ft=Ne-Qe,Ye=[];for(let pt=0;pt<Math.abs(ft);pt++)Ye.push(ft>0?0:1);for(let pt=0;pt<Math.min(Ne,Qe);pt++)Ye.push(0),Ye.push(1);let lt=O;if(lt=Vp(lt,N[0].y-H,N[1].y+H,1),lt=Vp(lt,N[0].x-H,N[1].x+H,0),!lt.length)return ie;const Et=[];for(Ye.length?Et.push({polygons:lt,bounds:N,depth:0}):pe(lt,N);Et.length;){const pt=Et.pop(),Kt=pt.depth,Zt=Ye[Kt],fn=pt.bounds[0],Ln=pt.bounds[1],nn=0===Zt?fn.x:fn.y,gn=0===Zt?Ln.x:Ln.y,wn=J?J(Zt,nn,gn):.5*(nn+gn),In=Vp(pt.polygons,nn-H,wn+H,Zt),Nn=Vp(pt.polygons,wn-H,gn+H,Zt);if(In.length){const an=[fn,new Q(0===Zt?wn:Ln.x,1===Zt?wn:Ln.y)];Ye.length>Kt+1?Et.push({polygons:In,bounds:an,depth:Kt+1}):pe(In,an)}if(Nn.length){const an=[new Q(0===Zt?wn:fn.x,1===Zt?wn:fn.y),Ln];Ye.length>Kt+1?Et.push({polygons:Nn,bounds:an,depth:Kt+1}):pe(Nn,an)}}return ie}(a,o,Math.ceil((E-y)/11.25),Math.ceil((S-D)/11.25),1,(O,N,V)=>{if(0===O)return.5*(N+V);{const $=Ol((u.y+N/Gt)/d);return(hh(.5*(Ol((u.y+V/Gt)/d)+$))*d-u.y)*Gt}})}vt(rm,"FillExtrusionBucket",{omit:["layers","features"]}),vt(T0,"PartMetadata");const M0=new Pn({"fill-extrusion-edge-radius":new Vt(Yt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Jy={paint:new Pn({"fill-extrusion-opacity":new Vt(Yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new en(Yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(Yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(Yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new en(Yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new en(Yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new en(Yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(Yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Vt(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Vt(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:M0};function db(a,o,u){var d=2*Math.PI*6378137/256/Math.pow(2,u);return[a*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}class om{constructor(o,u,d){this.z=o,this.x=u,this.y=d,this.key=$d(0,o,o,u,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u){const d=(S=this.y,D=this.z,O=db(256*(E=this.x),256*(S=Math.pow(2,D)-S-1),D),N=db(256*(E+1),256*(S+1),D),O[0]+","+O[1]+","+N[0]+","+N[1]),y=function(E,S,D){let O,N="";for(let V=E;V>0;V--)O=1<<V-1,N+=(S&O?1:0)+(D&O?2:0);return N}(this.z,this.x,this.y);var E,S,D,O,N;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===u?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",y).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sm{constructor(o,u){this.wrap=o,this.canonical=u,this.key=$d(o,u.z,u.z,u.x,u.y)}}class fu{constructor(o,u,d,y,E){this.overscaledZ=o,this.wrap=u,this.canonical=new om(d,+y,+E),this.key=0===u&&o===d?this.canonical.key:$d(u,o,d,y,E)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const u=this.canonical.z-o;return o>this.canonical.z?new fu(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fu(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u=!0){if(this.overscaledZ===o&&u)return this.key;if(o>this.canonical.z)return $d(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-o;return $d(this.wrap*+u,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new fu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,d=2*this.canonical.x,y=2*this.canonical.y;return[new fu(u,this.wrap,u,d,y),new fu(u,this.wrap,u,d+1,y),new fu(u,this.wrap,u,d,y+1),new fu(u,this.wrap,u,d+1,y+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new fu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new fu(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $d(a,o,u,d,y){const E=1<<Math.min(u,22);let S=E*(y%E)+d%E;return a&&u<22&&(S+=E*E*((a<0?-2*a-1:2*a)%(1<<2*(22-u)))),16*(32*S+u)+(o-u)}vt(om,"CanonicalTileID"),vt(fu,"OverscaledTileID",{omit:["projMatrix"]});class Rc extends Q{constructor(o,u,d){super(o,u),this.z=d}}function qp(a,o){return a.x*o.x+a.y*o.y}function am(a,o){if(1===a.length){let u=0;const d=o[u++];let y;for(;!y||d.equals(y);)if(y=o[u++],!y)return 1/0;for(;u<o.length;u++){const E=o[u],S=a[0],D=y.sub(d),O=E.sub(d),N=S.sub(d),V=qp(D,D),$=qp(D,O),H=qp(O,O),J=qp(N,D),ie=qp(N,O),pe=V*H-$*$,Ne=(H*J-$*ie)/pe,Qe=(V*ie-$*J)/pe,ft=d.z*(1-Ne-Qe)+y.z*Ne+E.z*Qe;if(isFinite(ft))return ft}return 1/0}{let u=1/0;for(const d of o)u=Math.min(u,d.z);return u}}function Hp(a,o,u,d,y,E,S,D){const O=S*y.getElevationAt(a,o,!0,!0),N=0!==E[0],V=N?0===E[1]?S*(E[0]/7-450):S*function($,H,J){const ie=Math.floor(H[0]/8),pe=Math.floor(H[1]/8),Ne=10*(H[0]-8*ie),Qe=10*(H[1]-8*pe),ft=$.getElevationAt(ie,pe,!0,!0),Ye=$.getMeterToDEM(J),lt=Math.floor(.5*(Ne*Ye-1)),Et=Math.floor(.5*(Qe*Ye-1)),pt=$.tileCoordToPixel(ie,pe),Kt=2*lt+1,Zt=2*Et+1,fn=($r=Kt,rr=Zt,[(Nn=$).getElevationAtPixel(an=pt.x-lt,Wn=pt.y-Et,!0),Nn.getElevationAtPixel(an+rr,Wn,!0),Nn.getElevationAtPixel(an,Wn+rr,!0),Nn.getElevationAtPixel(an+$r,Wn+rr,!0)]),Ln=Math.abs(fn[0]-fn[1]),nn=Math.abs(fn[2]-fn[3]),gn=Math.abs(fn[0]-fn[2])+Math.abs(fn[1]-fn[3]),wn=Math.min(.25,.5*Ye*(Ln+nn)/Kt),In=Math.min(.25,.5*Ye*gn/Zt);var Nn,an,Wn,$r,rr;return ft+Math.max(wn*Ne,In*Qe)}(y,E,D):O;return{base:O+(0===u)?-1:u,top:N?Math.max(V+d,O+u+2):O+d}}const pb=Ir([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Qy}=pb,lm=Ir([{name:"a_packed",components:4,type:"Float32"}]),{members:pf}=lm,D0=Gd.types,e_=Math.cos(Math.PI/180*37.5);class um{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new fs,this.layoutVertexArray2=new Rs,this.indexArray=new Wa,this.programConfigurations=new Id(o.layers,o.zoom),this.segments=new Xa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,d,y){this.hasPattern=Qg("line",this.layers,u);const E=this.layers[0].layout.get("line-sort-key"),S=[];for(const{feature:V,id:$,index:H,sourceLayerIndex:J}of o){const ie=this.layers[0]._featureFilter.needGeometry,pe=ff(V,ie);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),pe,d))continue;const Ne=E?E.evaluate(pe,{},d):void 0,Qe={id:$,properties:V.properties,type:V.type,sourceLayerIndex:J,index:H,geometry:ie?pe.geometry:kh(V,d,y),patterns:{},sortKey:Ne};S.push(Qe)}E&&S.sort((V,$)=>V.sortKey-$.sortKey);const{lineAtlas:D,featureIndex:O}=u,N=this.addConstantDashes(D);for(const V of S){const{geometry:$,index:H,sourceLayerIndex:J}=V;if(N&&this.addFeatureDashes(V,D),this.hasPattern){const ie=em("line",this.layers,V,this.zoom,u);this.patternFeatures.push(ie)}else this.addFeature(V,$,H,d,D.positions,u.availableImages);O.insert(o[H].feature,$,H,J,this.index)}}addConstantDashes(o){let u=!1;for(const d of this.layers){const y=d.paint.get("line-dasharray").value,E=d.layout.get("line-cap").value;if("constant"!==y.kind||"constant"!==E.kind)u=!0;else{const S=E.value,D=y.value;if(!D)continue;o.addDash(D,S)}}return u}addFeatureDashes(o,u){const d=this.zoom;for(const y of this.layers){const E=y.paint.get("line-dasharray").value,S=y.layout.get("line-cap").value;if("constant"===E.kind&&"constant"===S.kind)continue;let D,O;if("constant"===E.kind){if(D=E.value,!D)continue}else D=E.evaluate({zoom:d},o);O="constant"===S.kind?S.value:S.evaluate({zoom:d},o),u.addDash(D,O),o.patterns[y.id]=u.getKey(D,O)}}update(o,u,d,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,d,y)}addFeatures(o,u,d,y,E){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,d,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,pf)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Qy),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,d,y,E,S){const D=this.layers[0].layout,O=D.get("line-join").evaluate(o,{}),N=D.get("line-cap").evaluate(o,{}),V=D.get("line-miter-limit"),$=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const H of u)this.addLine(H,o,O,N,V,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,E,S,y)}addLine(o,u,d,y,E,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Qe=0;Qe<o.length-1;Qe++)this.totalDistance+=o[Qe].dist(o[Qe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===D0[u.type];let O=o.length;for(;O>=2&&o[O-1].equals(o[O-2]);)O--;let N=0;for(;N<O-1&&o[N].equals(o[N+1]);)N++;if(O<(D?3:2))return;"bevel"===d&&(E=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let H,J,ie,pe,Ne;this.e1=this.e2=-1,D&&(H=o[O-2],Ne=o[N].sub(H)._unit()._perp());for(let Qe=N;Qe<O;Qe++){if(ie=Qe===O-1?D?o[N+1]:void 0:o[Qe+1],ie&&o[Qe].equals(ie))continue;Ne&&(pe=Ne),H&&(J=H),H=o[Qe],Ne=ie?ie.sub(H)._unit()._perp():pe,pe=pe||Ne;let ft=pe.add(Ne);0===ft.x&&0===ft.y||ft._unit();const Ye=pe.x*Ne.x+pe.y*Ne.y,lt=ft.x*Ne.x+ft.y*Ne.y,Et=0!==lt?1/lt:1/0,pt=2*Math.sqrt(2-2*lt),Kt=lt<e_&&J&&ie,Zt=pe.x*Ne.y-pe.y*Ne.x>0;if(Kt&&Qe>N){const nn=H.dist(J);if(nn>2*V){const gn=H.sub(H.sub(J)._mult(V/nn)._round());this.updateDistance(J,gn),this.addCurrentVertex(gn,pe,0,0,$),J=gn}}const fn=J&&ie;let Ln=fn?d:D?"butt":y;if(fn&&"round"===Ln&&(Et<S?Ln="miter":Et<=2&&(Ln="fakeround")),"miter"===Ln&&Et>E&&(Ln="bevel"),"bevel"===Ln&&(Et>2&&(Ln="flipbevel"),Et<E&&(Ln="miter")),J&&this.updateDistance(J,H),"miter"===Ln)ft._mult(Et),this.addCurrentVertex(H,ft,0,0,$);else if("flipbevel"===Ln){if(Et>100)ft=Ne.mult(-1);else{const nn=Et*pe.add(Ne).mag()/pe.sub(Ne).mag();ft._perp()._mult(nn*(Zt?-1:1))}this.addCurrentVertex(H,ft,0,0,$),this.addCurrentVertex(H,ft.mult(-1),0,0,$)}else if("bevel"===Ln||"fakeround"===Ln){const nn=-Math.sqrt(Et*Et-1),gn=Zt?nn:0,wn=Zt?0:nn;if(J&&this.addCurrentVertex(H,pe,gn,wn,$),"fakeround"===Ln){const In=Math.round(180*pt/Math.PI/20);for(let Nn=1;Nn<In;Nn++){let an=Nn/In;if(.5!==an){const $r=an-.5;an+=an*$r*(an-1)*((1.0904+Ye*(Ye*(3.55645-1.43519*Ye)-3.2452))*$r*$r+(.848013+Ye*(.215638*Ye-1.06021)))}const Wn=Ne.sub(pe)._mult(an)._add(pe)._unit()._mult(Zt?-1:1);this.addHalfVertex(H,Wn.x,Wn.y,!1,Zt,0,$)}}ie&&this.addCurrentVertex(H,Ne,-gn,-wn,$)}else if("butt"===Ln)this.addCurrentVertex(H,ft,0,0,$);else if("square"===Ln){const nn=J?1:-1;J||this.addCurrentVertex(H,ft,nn,nn,$),this.addCurrentVertex(H,ft,0,0,$),J&&this.addCurrentVertex(H,ft,nn,nn,$)}else"round"===Ln&&(J&&(this.addCurrentVertex(H,pe,0,0,$),this.addCurrentVertex(H,pe,1,1,$,!0)),ie&&(this.addCurrentVertex(H,Ne,-1,-1,$,!0),this.addCurrentVertex(H,Ne,0,0,$)));if(Kt&&Qe<O-1){const nn=H.dist(ie);if(nn>2*V){const gn=H.add(ie.sub(H)._mult(V/nn)._round());this.updateDistance(H,gn),this.addCurrentVertex(gn,Ne,0,0,$),H=gn}}}}addCurrentVertex(o,u,d,y,E,S=!1){const D=u.y*y-u.x,O=-u.y-u.x*y;this.addHalfVertex(o,u.x+u.y*d,u.y-u.x*d,S,!1,d,E),this.addHalfVertex(o,D,O,S,!0,-y,E)}addHalfVertex({x:o,y:u},d,y,E,S,D,O){this.layoutVertexArray.emplaceBack((o<<1)+(E?1:0),(u<<1)+(S?1:0),Math.round(63*d)+128,Math.round(63*y)+128,1+(0===D?0:D<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const N=O.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),O.primitiveLength++),S?this.e2=N:this.e1=N}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}vt(um,"LineBucket",{omit:["layers","patternFeatures"]});const gb=new Pn({"line-cap":new en(Yt.layout_line["line-cap"]),"line-join":new en(Yt.layout_line["line-join"]),"line-miter-limit":new Vt(Yt.layout_line["line-miter-limit"]),"line-round-limit":new Vt(Yt.layout_line["line-round-limit"]),"line-sort-key":new en(Yt.layout_line["line-sort-key"])});var t_={paint:new Pn({"line-opacity":new en(Yt.paint_line["line-opacity"]),"line-color":new en(Yt.paint_line["line-color"]),"line-translate":new Vt(Yt.paint_line["line-translate"]),"line-translate-anchor":new Vt(Yt.paint_line["line-translate-anchor"]),"line-width":new en(Yt.paint_line["line-width"]),"line-gap-width":new en(Yt.paint_line["line-gap-width"]),"line-offset":new en(Yt.paint_line["line-offset"]),"line-blur":new en(Yt.paint_line["line-blur"]),"line-dasharray":new en(Yt.paint_line["line-dasharray"]),"line-pattern":new en(Yt.paint_line["line-pattern"]),"line-gradient":new xn(Yt.paint_line["line-gradient"]),"line-trim-offset":new Vt(Yt.paint_line["line-trim-offset"])}),layout:gb};const Kf=new class extends en{possiblyEvaluate(a,o){return o=new jt(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,u,d){return o=Xe({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,u,d)}}(t_.paint.properties["line-width"].specification);function A0(a,o){return o>0?o+2*a:a}Kf.useIntegerZoom=!0;const mb=Ir([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yb=Ir([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_b=Ir([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ir([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const n_=Ir([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),vb=Ir([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ir([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const r_=Ir([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xb=Ir([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ir([{name:"triangle",components:3,type:"Uint16"}]),Ir([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ir([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ir([{type:"Float32",name:"offsetX"}]),Ir([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const zh=128;function i_(a,o){const{expression:u}=o;if("constant"===u.kind)return{kind:"constant",layoutSize:u.evaluate(new jt(a+1))};if("source"===u.kind)return{kind:"source"};{const{zoomStops:d,interpolationType:y}=u;let E=0;for(;E<d.length&&d[E]<=a;)E++;E=Math.max(0,E-1);let S=E;for(;S<d.length&&d[S]<a+1;)S++;S=Math.min(d.length-1,S);const D=d[E],O=d[S];return"composite"===u.kind?{kind:"composite",minZoom:D,maxZoom:O,interpolationType:y}:{kind:"camera",minZoom:D,maxZoom:O,minSize:u.evaluate(new jt(D)),maxSize:u.evaluate(new jt(O)),interpolationType:y}}}function ph(a,{uSize:o,uSizeT:u},{lowerSize:d,upperSize:y}){return"source"===a.kind?d/zh:"composite"===a.kind?er(d/zh,y/zh,u):o}function qd(a,o){let u=0,d=0;if("constant"===a.kind)d=a.layoutSize;else if("source"!==a.kind){const{interpolationType:y,minZoom:E,maxZoom:S}=a,D=y?Se(Ds.interpolationFactor(y,o,E,S),0,1):0;"camera"===a.kind?d=er(a.minSize,a.maxSize,D):u=D}return{uSizeT:u,uSize:d}}var Hd=Object.freeze({__proto__:null,getSizeData:i_,evaluateSizeForFeature:ph,evaluateSizeForZoom:qd,SIZE_PACK_FACTOR:zh});function Oc(a,o,u){return a.sections.forEach(d=>{d.text=function(y,E,S){const D=E.layout.get("text-transform").evaluate(S,{});return"uppercase"===D?y=y.toLocaleUpperCase():"lowercase"===D&&(y=y.toLocaleLowerCase()),It.applyArabicShaping&&(y=It.applyArabicShaping(y)),y}(d.text,o,u)}),a}const Wp={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function tI(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Xp(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var gf=Io,P0=function(a,o,u,d,y){var E,S,D=8*y-d-1,O=(1<<D)-1,N=O>>1,V=-7,$=u?y-1:0,H=u?-1:1,J=a[o+$];for($+=H,E=J&(1<<-V)-1,J>>=-V,V+=D;V>0;E=256*E+a[o+$],$+=H,V-=8);for(S=E&(1<<-V)-1,E>>=-V,V+=d;V>0;S=256*S+a[o+$],$+=H,V-=8);if(0===E)E=1-N;else{if(E===O)return S?NaN:1/0*(J?-1:1);S+=Math.pow(2,d),E-=N}return(J?-1:1)*S*Math.pow(2,E-d)},R0=function(a,o,u,d,y,E){var S,D,O,N=8*E-y-1,V=(1<<N)-1,$=V>>1,H=23===y?Math.pow(2,-24)-Math.pow(2,-77):0,J=d?0:E-1,ie=d?1:-1,pe=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(D=isNaN(o)?1:0,S=V):(S=Math.floor(Math.log(o)/Math.LN2),o*(O=Math.pow(2,-S))<1&&(S--,O*=2),(o+=S+$>=1?H/O:H*Math.pow(2,1-$))*O>=2&&(S++,O/=2),S+$>=V?(D=0,S=V):S+$>=1?(D=(o*O-1)*Math.pow(2,y),S+=$):(D=o*Math.pow(2,$-1)*Math.pow(2,y),S=0));y>=8;a[u+J]=255&D,J+=ie,D/=256,y-=8);for(S=S<<y|D,N+=y;N>0;a[u+J]=255&S,J+=ie,S/=256,N-=8);a[u+J-ie]|=128*pe};function Io(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Io.Varint=0,Io.Fixed64=1,Io.Bytes=2,Io.Fixed32=5;var o_=4294967296,cm=1/o_,hm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Uh(a){return a.type===Io.Bytes?a.readVarint()+a.pos:a.pos+1}function Jf(a,o,u){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(d);for(var y=u.pos-1;y>=a;y--)u.buf[y+d]=u.buf[y]}function wb(a,o){for(var u=0;u<a.length;u++)o.writeVarint(a[u])}function bb(a,o){for(var u=0;u<a.length;u++)o.writeSVarint(a[u])}function Eb(a,o){for(var u=0;u<a.length;u++)o.writeFloat(a[u])}function Cb(a,o){for(var u=0;u<a.length;u++)o.writeDouble(a[u])}function Sb(a,o){for(var u=0;u<a.length;u++)o.writeBoolean(a[u])}function Tb(a,o){for(var u=0;u<a.length;u++)o.writeFixed32(a[u])}function Ib(a,o){for(var u=0;u<a.length;u++)o.writeSFixed32(a[u])}function Wd(a,o){for(var u=0;u<a.length;u++)o.writeFixed64(a[u])}function Vh(a,o){for(var u=0;u<a.length;u++)o.writeSFixed64(a[u])}function fm(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function Xd(a,o,u){a[u]=o,a[u+1]=o>>>8,a[u+2]=o>>>16,a[u+3]=o>>>24}function Mb(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}function nI(a,o,u){o.glyphs=[],1===a&&u.readMessage(O0,o)}function O0(a,o,u){if(3===a){const{id:d,bitmap:y,width:E,height:S,left:D,top:O,advance:N}=u.readMessage(rI,{});o.glyphs.push({id:d,bitmap:new dh({width:E+6,height:S+6},y),metrics:{width:E,height:S,left:D,top:O,advance:N}})}else 4===a?o.ascender=u.readSVarint():5===a&&(o.descender=u.readSVarint())}function rI(a,o,u){1===a?o.id=u.readVarint():2===a?o.bitmap=u.readBytes():3===a?o.width=u.readVarint():4===a?o.height=u.readVarint():5===a?o.left=u.readSVarint():6===a?o.top=u.readSVarint():7===a&&(o.advance=u.readVarint())}function dm(a){let o=0,u=0;for(const S of a)o+=S.w*S.h,u=Math.max(u,S.w);a.sort((S,D)=>D.h-S.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let y=0,E=0;for(const S of a)for(let D=d.length-1;D>=0;D--){const O=d[D];if(!(S.w>O.w||S.h>O.h)){if(S.x=O.x,S.y=O.y,E=Math.max(E,S.y+S.h),y=Math.max(y,S.x+S.w),S.w===O.w&&S.h===O.h){const N=d.pop();D<d.length&&(d[D]=N)}else S.h===O.h?(O.x+=S.w,O.w-=S.w):S.w===O.w?(O.y+=S.h,O.h-=S.h):(d.push({x:O.x+S.w,y:O.y,w:O.w-S.w,h:S.h}),O.y+=S.h,O.h-=S.h);break}}return{w:y,h:E,fill:o/(y*E)||0}}Io.prototype={destroy:function(){this.buf=null},readFields:function(a,o,u){for(u=u||this.length;this.pos<u;){var d=this.readVarint(),y=d>>3,E=this.pos;this.type=7&d,a(y,o,this),this.pos===E&&this.skip(d)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=fm(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Mb(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=fm(this.buf,this.pos)+fm(this.buf,this.pos+4)*o_;return this.pos+=8,a},readSFixed64:function(){var a=fm(this.buf,this.pos)+Mb(this.buf,this.pos+4)*o_;return this.pos+=8,a},readFloat:function(){var a=P0(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=P0(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,u,d=this.buf;return o=127&(u=d[this.pos++]),u<128?o:(o|=(127&(u=d[this.pos++]))<<7,u<128?o:(o|=(127&(u=d[this.pos++]))<<14,u<128?o:(o|=(127&(u=d[this.pos++]))<<21,u<128?o:function(y,E,S){var D,O,N=S.buf;if(D=(112&(O=N[S.pos++]))>>4,O<128||(D|=(127&(O=N[S.pos++]))<<3,O<128)||(D|=(127&(O=N[S.pos++]))<<10,O<128)||(D|=(127&(O=N[S.pos++]))<<17,O<128)||(D|=(127&(O=N[S.pos++]))<<24,O<128)||(D|=(1&(O=N[S.pos++]))<<31,O<128))return function mf(a,o,u){return u?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(y,D,E);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&hm?hm.decode(this.buf.subarray(o,a)):function(u,d,y){for(var E="",S=d;S<y;){var D,O,N,V=u[S],$=null,H=V>239?4:V>223?3:V>191?2:1;if(S+H>y)break;1===H?V<128&&($=V):2===H?128==(192&(D=u[S+1]))&&($=(31&V)<<6|63&D)<=127&&($=null):3===H?(O=u[S+2],128==(192&(D=u[S+1]))&&128==(192&O)&&(($=(15&V)<<12|(63&D)<<6|63&O)<=2047||$>=55296&&$<=57343)&&($=null)):4===H&&(O=u[S+2],N=u[S+3],128==(192&(D=u[S+1]))&&128==(192&O)&&128==(192&N)&&(($=(15&V)<<18|(63&D)<<12|(63&O)<<6|63&N)<=65535||$>=1114112)&&($=null)),null===$?($=65533,H=1):$>65535&&($-=65536,E+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),E+=String.fromCharCode($),S+=H}return E}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==Io.Bytes)return a.push(this.readVarint(o));var u=Uh(this);for(a=a||[];this.pos<u;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==Io.Bytes)return a.push(this.readSVarint());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Io.Bytes)return a.push(this.readBoolean());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Io.Bytes)return a.push(this.readFloat());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Io.Bytes)return a.push(this.readDouble());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Io.Bytes)return a.push(this.readFixed32());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Io.Bytes)return a.push(this.readSFixed32());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Io.Bytes)return a.push(this.readFixed64());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Io.Bytes)return a.push(this.readSFixed64());var o=Uh(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===Io.Varint)for(;this.buf[this.pos++]>127;);else if(o===Io.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Io.Fixed32)this.pos+=4;else{if(o!==Io.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Xd(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Xd(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Xd(this.buf,-1&a,this.pos),Xd(this.buf,Math.floor(a*cm),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Xd(this.buf,-1&a,this.pos),Xd(this.buf,Math.floor(a*cm),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,u){var d,y,E,D;if(o>=0?(d=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,y=y+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),E=d,(D=u).buf[D.pos++]=127&E|128,E>>>=7,D.buf[D.pos++]=127&E|128,E>>>=7,D.buf[D.pos++]=127&E|128,E>>>=7,D.buf[D.pos++]=127&E|128,D.buf[D.pos]=127&(E>>>=7),function(E,S){var D=(7&E)<<4;S.buf[S.pos++]|=D|((E>>>=3)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E)))))}(y,u)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(d,y,E){for(var S,D,O=0;O<y.length;O++){if((S=y.charCodeAt(O))>55295&&S<57344){if(!D){S>56319||O+1===y.length?(d[E++]=239,d[E++]=191,d[E++]=189):D=S;continue}if(S<56320){d[E++]=239,d[E++]=191,d[E++]=189,D=S;continue}S=D-55296<<10|S-56320|65536,D=null}else D&&(d[E++]=239,d[E++]=191,d[E++]=189,D=null);S<128?d[E++]=S:(S<2048?d[E++]=S>>6|192:(S<65536?d[E++]=S>>12|224:(d[E++]=S>>18|240,d[E++]=S>>12&63|128),d[E++]=S>>6&63|128),d[E++]=63&S|128)}return E}(this.buf,a,this.pos);var u=this.pos-o;u>=128&&Jf(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(a){this.realloc(4),R0(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),R0(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=a[u]},writeRawMessage:function(a,o){this.pos++;var u=this.pos;a(o,this);var d=this.pos-u;d>=128&&Jf(u,d,this),this.pos=u-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,o,u){this.writeTag(a,Io.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,wb,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,bb,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,Sb,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,Eb,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,Cb,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,Tb,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,Ib,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,Wd,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,Vh,o)},writeBytesField:function(a,o){this.writeTag(a,Io.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,Io.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,Io.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,Io.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,Io.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,Io.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,Io.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,Io.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,Io.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,Io.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};class L0{constructor(o,{pixelRatio:u,version:d,stretchX:y,stretchY:E,content:S}){this.paddedRect=o,this.pixelRatio=u,this.stretchX=y,this.stretchY=E,this.content=S,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class s_{constructor(o,u){const d={},y={};this.haveRenderCallbacks=[];const E=[];this.addImages(o,d,E),this.addImages(u,y,E);const{w:S,h:D}=dm(E),O=new Su({width:S||1,height:D||1});for(const N in o){const V=o[N],$=d[N].paddedRect;Su.copy(V.data,O,{x:0,y:0},{x:$.x+1,y:$.y+1},V.data)}for(const N in u){const V=u[N],$=y[N].paddedRect,H=$.x+1,J=$.y+1,ie=V.data.width,pe=V.data.height;Su.copy(V.data,O,{x:0,y:0},{x:H,y:J},V.data),Su.copy(V.data,O,{x:0,y:pe-1},{x:H,y:J-1},{width:ie,height:1}),Su.copy(V.data,O,{x:0,y:0},{x:H,y:J+pe},{width:ie,height:1}),Su.copy(V.data,O,{x:ie-1,y:0},{x:H-1,y:J},{width:1,height:pe}),Su.copy(V.data,O,{x:0,y:0},{x:H+ie,y:J},{width:1,height:pe})}this.image=O,this.iconPositions=d,this.patternPositions=y}addImages(o,u,d){for(const y in o){const E=o[y],S={x:0,y:0,w:E.data.width+2,h:E.data.height+2};d.push(S),u[y]=new L0(S,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>o.hasImage(d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in o.updatedImages)this.patchUpdatedImage(this.iconPositions[d],o.getImage(d),u),this.patchUpdatedImage(this.patternPositions[d],o.getImage(d),u)}patchUpdatedImage(o,u,d){if(!o||!u||o.version===u.version)return;o.version=u.version;const[y,E]=o.tl;d.update(u.data,void 0,{x:y,y:E})}}vt(L0,"ImagePosition"),vt(s_,"ImageAtlas");const uc={horizontal:1,vertical:2,horizontalOnly:3};class Zd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const d=new Zd;return d.scale=o||1,d.fontStack=u,d}static forImage(o){const u=new Zd;return u.imageName=o,u}}class Yd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const d=new Yd;for(let y=0;y<o.sections.length;y++){const E=o.sections[y];E.image?d.addImageSection(E):d.addTextSection(E,u)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(u,d){let y="";for(let E=0;E<u.length;E++){const S=u.charCodeAt(E+1)||null,D=u.charCodeAt(E-1)||null;y+=!d&&(S&&j(S)&&!Wp[u[E+1]]||D&&j(D)&&!Wp[u[E-1]])||!Wp[u[E]]?u[E]:Wp[u[E]]}return y}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&Xu[this.text.charCodeAt(d)];d++)o++;let u=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&Xu[this.text.charCodeAt(d)];d--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const d=new Yd;return d.text=this.text.substring(o,u),d.sectionIndex=this.sectionIndex.slice(o,u),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(Zd.forText(o.scale,o.fontStack||u));const d=this.sections.length-1;for(let y=0;y<o.text.length;++y)this.sectionIndex.push(d)}addImageSection(o){const u=o.image?o.image.name:"";if(0===u.length)return void Un("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Zd.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Un("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function a_(a,o,u,d,y,E,S,D,O,N,V,$,H,J,ie){const pe=Yd.fromFeature(a,y);$===uc.vertical&&pe.verticalizePunctuation(H);let Ne=[];const Qe=function(pt,Kt,Zt,fn,Ln,nn){if(!pt)return[];const gn=[],wn=function(Wn,$r,rr,vr,Vn,qr){let zi=0;for(let Ii=0;Ii<Wn.length();Ii++){const Vi=Wn.getSection(Ii);zi+=l_(Wn.getCharCode(Ii),Vi,vr,Vn,$r,qr)}return zi/Math.max(1,Math.ceil(zi/rr))}(pt,Kt,Zt,fn,Ln,nn),In=pt.text.indexOf("\u200b")>=0;let Nn=0;for(let Wn=0;Wn<pt.length();Wn++){const $r=pt.getSection(Wn),rr=pt.getCharCode(Wn);if(Xu[rr]||(Nn+=l_(rr,$r,fn,Ln,Kt,nn)),Wn<pt.length()-1){const vr=!((an=rr)<11904||!(xp(an)||Ff(an)||b(an)||Ig(an)||Cg(an)||ka(an)||wp(an)||Sc(an)||Kl(an)||Tc(an)||Eg(an)||C(an)||cf(an)||ku(an)||Pl(an)||Bf(an)||Dh(an)||zf(an)||Sg(an)||ma(an)));(Db[rr]||vr||$r.imageName)&&gn.push(k0(Wn+1,Nn,wn,gn,Ab(rr,pt.getCharCode(Wn+1),vr&&In),!1))}}var an;return F0(k0(pt.length(),Nn,wn,gn,0,!0))}(pe,N,E,o,d,J),{processBidirectionalText:ft,processStyledBidirectionalText:Ye}=It;if(ft&&1===pe.sections.length){const pt=ft(pe.toString(),Qe);for(const Kt of pt){const Zt=new Yd;Zt.text=Kt,Zt.sections=pe.sections;for(let fn=0;fn<Kt.length;fn++)Zt.sectionIndex.push(0);Ne.push(Zt)}}else if(Ye){const pt=Ye(pe.text,pe.sectionIndex,Qe);for(const Kt of pt){const Zt=new Yd;Zt.text=Kt[0],Zt.sectionIndex=Kt[1],Zt.sections=pe.sections,Ne.push(Zt)}}else Ne=function(pt,Kt){const Zt=[],fn=pt.text;let Ln=0;for(const nn of Kt)Zt.push(pt.substring(Ln,nn)),Ln=nn;return Ln<fn.length&&Zt.push(pt.substring(Ln,fn.length)),Zt}(pe,Qe);const lt=[],Et={positionedLines:lt,text:pe.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:$,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(pt,Kt,Zt,fn,Ln,nn,gn,wn,In,Nn,an,Wn){let $r=0,rr=0,vr=0;const Vn="right"===wn?1:"left"===wn?0:.5;let qr=!1;for(const hi of Ln){const Ki=hi.getSections();for(const Mo of Ki){if(Mo.imageName)continue;const Gs=Kt[Mo.fontStack];if(Gs&&(qr=void 0!==Gs.ascender&&void 0!==Gs.descender,!qr))break}if(!qr)break}let zi=0;for(const hi of Ln){hi.trim();const Ki=hi.getMaxScale(),Mo=24*(Ki-1),Gs={positionedGlyphs:[],lineOffset:0};pt.positionedLines[zi]=Gs;const $s=Gs.positionedGlyphs;let qs=0;if(!hi.length()){rr+=nn,++zi;continue}let na=0,Sa=0;for(let ws=0;ws<hi.length();ws++){const Ya=hi.getSection(ws),la=hi.getSectionIndex(ws),_o=hi.getCharCode(ws);let Js=Ya.scale,cl=null,Ss=null,Ba=null,pu=24,kl=0;const Fl=!(In===uc.horizontal||!an&&!z(_o)||an&&(Xu[_o]||(Ii=_o,Lr(Ii)||to(Ii)||Ps(Ii)||wd(Ii)||m(Ii))));if(Ya.imageName){const Bl=fn[Ya.imageName];if(!Bl)continue;Ba=Ya.imageName,pt.iconsInText=pt.iconsInText||!0,Ss=Bl.paddedRect;const Ta=Bl.displaySize;Js=24*Js/Wn,cl={width:Ta[0],height:Ta[1],left:1,top:-3,advance:Fl?Ta[1]:Ta[0],localGlyph:!1},kl=qr?-cl.height*Js:24*Ki-17-Ta[1]*Js,pu=cl.advance;const xf=(Fl?Ta[0]:Ta[1])*Js-24*Ki;xf>0&&xf>qs&&(qs=xf)}else{const Bl=Zt[Ya.fontStack];if(!Bl)continue;Bl[_o]&&(Ss=Bl[_o]);const Ta=Kt[Ya.fontStack];if(!Ta)continue;const xf=Ta.glyphs[_o];if(!xf)continue;if(cl=xf.metrics,pu=8203!==_o?24:0,qr){const gh=void 0!==Ta.ascender?Math.abs(Ta.ascender):0,tg=void 0!==Ta.descender?Math.abs(Ta.descender):0,ng=(gh+tg)*Js;na<ng&&(na=ng,Sa=(gh-tg)/2*Js),kl=-gh*Js}else kl=24*(Ki-Js)-17}Fl?(pt.verticalizable=!0,$s.push({glyph:_o,imageName:Ba,x:$r,y:rr+kl,vertical:Fl,scale:Js,localGlyph:cl.localGlyph,fontStack:Ya.fontStack,sectionIndex:la,metrics:cl,rect:Ss}),$r+=pu*Js+Nn):($s.push({glyph:_o,imageName:Ba,x:$r,y:rr+kl,vertical:Fl,scale:Js,localGlyph:cl.localGlyph,fontStack:Ya.fontStack,sectionIndex:la,metrics:cl,rect:Ss}),$r+=cl.advance*Js+Nn)}0!==$s.length&&(vr=Math.max($r-Nn,vr),qr?B0($s,Vn,qs,Sa,nn*Ki/2):B0($s,Vn,qs,0,nn/2)),$r=0;const Nl=nn*Ki+qs;Gs.lineOffset=Math.max(qs,Mo),rr+=Nl,++zi}var Ii;const Vi=rr,{horizontalAlign:Wr,verticalAlign:ps}=pm(gn);(function(hi,Ki,Mo,Gs,$s,qs){const na=(Ki-Mo)*$s,Sa=-qs*Gs;for(const Nl of hi)for(const ws of Nl.positionedGlyphs)ws.x+=na,ws.y+=Sa})(pt.positionedLines,Vn,Wr,ps,vr,Vi),pt.top+=-ps*Vi,pt.bottom=pt.top+Vi,pt.left+=-Wr*vr,pt.right=pt.left+vr,pt.hasBaseline=qr}(Et,o,u,d,Ne,S,D,O,$,N,H,ie),!function(pt){for(const Kt of pt)if(0!==Kt.positionedGlyphs.length)return!1;return!0}(lt)&&Et}const Xu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Db={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function l_(a,o,u,d,y,E){if(o.imageName){const S=d[o.imageName];return S?S.displaySize[0]*o.scale*24/E+y:0}{const S=u[o.fontStack],D=S&&S.glyphs[a];return D?D.metrics.advance*o.scale+y:0}}function N0(a,o,u,d){const y=Math.pow(a-o,2);return d?a<o?y/2:2*y:y+Math.abs(u)*u}function Ab(a,o,u){let d=0;return 10===a&&(d-=1e4),u&&(d+=150),40!==a&&65288!==a||(d+=50),41!==o&&65289!==o||(d+=50),d}function k0(a,o,u,d,y,E){let S=null,D=N0(o,u,y,E);for(const O of d){const N=N0(o-O.x,u,y,E)+O.badness;N<=D&&(S=O,D=N)}return{index:a,x:o,priorBreak:S,badness:D}}function F0(a){return a?F0(a.priorBreak).concat(a.index):[]}function pm(a){let o=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function B0(a,o,u,d,y){if(!(o||u||d||y))return;const E=a.length-1,S=a[E],D=(S.x+S.metrics.advance*S.scale)*o;for(let O=0;O<=E;O++)a[O].x-=D,a[O].y+=u+d+y}function Pb(a,o,u){const{horizontalAlign:d,verticalAlign:y}=pm(u),E=o[0]-a.displaySize[0]*d,S=o[1]-a.displaySize[1]*y;return{image:a,top:S,bottom:S+a.displaySize[1],left:E,right:E+a.displaySize[0]}}function z0(a,o,u,d,y,E){const S=a.image;let D;if(S.content){const Ne=S.content,Qe=S.pixelRatio||1;D=[Ne[0]/Qe,Ne[1]/Qe,S.displaySize[0]-Ne[2]/Qe,S.displaySize[1]-Ne[3]/Qe]}const O=o.left*E,N=o.right*E;let V,$,H,J;"width"===u||"both"===u?(J=y[0]+O-d[3],$=y[0]+N+d[1]):(J=y[0]+(O+N-S.displaySize[0])/2,$=J+S.displaySize[0]);const ie=o.top*E,pe=o.bottom*E;return"height"===u||"both"===u?(V=y[1]+ie-d[0],H=y[1]+pe+d[2]):(V=y[1]+(ie+pe-S.displaySize[1])/2,H=V+S.displaySize[1]),{image:S,top:V,right:$,bottom:H,left:J,collisionPadding:D}}class yi extends Q{constructor(o,u,d,y,E){super(o,u),this.angle=y,this.z=d,void 0!==E&&(this.segment=E)}clone(){return new yi(this.x,this.y,this.z,this.angle,this.segment)}}function gm(a,o,u,d,y){if(void 0===o.segment)return!0;let E=o,S=o.segment+1,D=0;for(;D>-u/2;){if(S--,S<0)return!1;D-=a[S].dist(E),E=a[S]}D+=a[S].dist(a[S+1]),S++;const O=[];let N=0;for(;D<u/2;){const V=a[S],$=a[S+1];if(!$)return!1;let H=a[S-1].angleTo(V)-V.angleTo($);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:D,angleDelta:H}),N+=H;D-O[0].distance>d;)N-=O.shift().angleDelta;if(N>y)return!1;S++,D+=V.dist($)}return!0}function u_(a){let o=0;for(let u=0;u<a.length-1;u++)o+=a[u].dist(a[u+1]);return o}function c_(a,o,u){return a?.6*o*u:0}function U0(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function Rb(a,o,u,d,y,E){const S=c_(u,y,E),D=U0(u,d)*E;let O=0;const N=u_(a)/2;for(let V=0;V<a.length-1;V++){const $=a[V],H=a[V+1],J=$.dist(H);if(O+J>N){const ie=(N-O)/J,pe=er($.x,H.x,ie),Ne=er($.y,H.y,ie),Qe=new yi(pe,Ne,0,H.angleTo($),V);return!S||gm(a,Qe,D,S,o)?Qe:void 0}O+=J}}function V0(a,o,u,d,y,E,S,D,O){const N=c_(d,E,S),V=U0(d,y),$=V*S,H=0===a[0].x||a[0].x===O||0===a[0].y||a[0].y===O;return o-$<o/4&&(o=$+o/4),j0(a,H?o/2*D%o:(V/2+2*E)*S*D%o,o,N,u,$,H,!1,O)}function j0(a,o,u,d,y,E,S,D,O){const N=E/2,V=u_(a);let $=0,H=o-u,J=[];for(let ie=0;ie<a.length-1;ie++){const pe=a[ie],Ne=a[ie+1],Qe=pe.dist(Ne),ft=Ne.angleTo(pe);for(;H+u<$+Qe;){H+=u;const Ye=(H-$)/Qe,lt=er(pe.x,Ne.x,Ye),Et=er(pe.y,Ne.y,Ye);if(lt>=0&&lt<O&&Et>=0&&Et<O&&H-N>=0&&H+N<=V){const pt=new yi(lt,Et,0,ft,ie);pt._round(),d&&!gm(a,pt,E,d,y)||J.push(pt)}}$+=Qe}return D||J.length||S||(J=j0(a,$/2,u,d,y,E,S,!0,O)),J}function h_(a,o,u,d,y){const E=[];for(let S=0;S<a.length;S++){const D=a[S];let O;for(let N=0;N<D.length-1;N++){let V=D[N],$=D[N+1];V.x<o&&$.x<o||(V.x<o?V=new Q(o,V.y+(o-V.x)/($.x-V.x)*($.y-V.y))._round():$.x<o&&($=new Q(o,V.y+(o-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y<u&&$.y<u||(V.y<u?V=new Q(V.x+(u-V.y)/($.y-V.y)*($.x-V.x),u)._round():$.y<u&&($=new Q(V.x+(u-V.y)/($.y-V.y)*($.x-V.x),u)._round()),V.x>=d&&$.x>=d||(V.x>=d?V=new Q(d,V.y+(d-V.x)/($.x-V.x)*($.y-V.y))._round():$.x>=d&&($=new Q(d,V.y+(d-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y>=y&&$.y>=y||(V.y>=y?V=new Q(V.x+(y-V.y)/($.y-V.y)*($.x-V.x),y)._round():$.y>=y&&($=new Q(V.x+(y-V.y)/($.y-V.y)*($.x-V.x),y)._round()),O&&V.equals(O[O.length-1])||(O=[V],E.push(O)),O.push($)))))}}return E}vt(yi,"Anchor");const Zp=1e20;function G0(a,o,u,d,y,E,S,D,O){for(let N=o;N<o+d;N++)Ob(a,u*E+N,E,y,S,D,O);for(let N=u;N<u+y;N++)Ob(a,N*E+o,1,d,S,D,O)}function Ob(a,o,u,d,y,E,S){E[0]=0,S[0]=-Zp,S[1]=Zp,y[0]=a[o];for(let D=1,O=0,N=0;D<d;D++){y[D]=a[o+D*u];const V=D*D;do{const $=E[O];N=(y[D]-y[$]+V-$*$)/(D-$)/2}while(N<=S[O]&&--O>-1);O++,E[O]=D,S[O]=N,S[O+1]=Zp}for(let D=0,O=0;D<d;D++){for(;S[O+1]<D;)O++;const N=E[O],V=D-N;a[o+D*u]=y[N]+V*V}}const mm={none:0,ideographs:1,all:2};class Qf{constructor(o,u,d){this.requestManager=o,this.localGlyphMode=u,this.localFontFamily=d,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,u){const d=[];for(const y in o)for(const E of o[y])d.push({stack:y,id:E});$e(d,({stack:y,id:E},S)=>{let D=this.entries[y];D||(D=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let O=D.glyphs[E];if(void 0!==O)return void S(null,{stack:y,id:E,glyph:O});if(O=this._tinySDF(D,y,E),O)return D.glyphs[E]=O,void S(null,{stack:y,id:E,glyph:O});const N=Math.floor(E/256);if(256*N>65535)return void S(new Error("glyphs > 65535 not supported"));if(D.ranges[N])return void S(null,{stack:y,id:E,glyph:O});let V=D.requests[N];V||(V=D.requests[N]=[],Qf.loadGlyphRange(y,N,this.url,this.requestManager,($,H)=>{if(H){D.ascender=H.ascender,D.descender=H.descender;for(const J in H.glyphs)this._doesCharSupportLocalGlyph(+J)||(D.glyphs[+J]=H.glyphs[+J]);D.ranges[N]=!0}for(const J of V)J($,H);delete D.requests[N]})),V.push(($,H)=>{$?S($):H&&S(null,{stack:y,id:E,glyph:H.glyphs[E]||null})})},(y,E)=>{if(y)u(y);else if(E){const S={};for(const{stack:D,id:O,glyph:N}of E)void 0===S[D]&&(S[D]={}),void 0===S[D].glyphs&&(S[D].glyphs={}),S[D].glyphs[O]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics},S[D].ascender=this.entries[D].ascender,S[D].descender=this.entries[D].descender;u(null,S)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==mm.none&&(this.localGlyphMode===mm.all?!!this.localFontFamily:!!this.localFontFamily&&(Tc(o)||Tg(o)||cf(o)||Dh(o)||Sc(o)))}_tinySDF(o,u,d){const y=this.localFontFamily;if(!y||!this._doesCharSupportLocalGlyph(d))return;let E=o.tinySDF;if(!E){let pe="400";/bold/i.test(u)?pe="900":/medium/i.test(u)?pe="500":/light/i.test(u)&&(pe="200"),E=o.tinySDF=new Qf.TinySDF({fontFamily:y,fontWeight:pe,fontSize:48,buffer:6,radius:16}),E.fontWeight=pe}if(this.localGlyphs[E.fontWeight][d])return this.localGlyphs[E.fontWeight][d];const S=String.fromCharCode(d),{data:D,width:O,height:N,glyphWidth:V,glyphHeight:$,glyphLeft:H,glyphTop:J,glyphAdvance:ie}=E.draw(S);return this.localGlyphs[E.fontWeight][d]={id:d,bitmap:new dh({width:O,height:N},D),metrics:{width:V/2,height:$/2,left:H/2,top:J/2-27,advance:ie/2,localGlyph:!0}}}}function du(a,o,u,d){const y=[],E=a.image,S=E.pixelRatio,D=E.paddedRect.w-2,O=E.paddedRect.h-2,N=a.right-a.left,V=a.bottom-a.top,$=E.stretchX||[[0,D]],H=E.stretchY||[[0,O]],J=(nn,gn)=>nn+gn[1]-gn[0],ie=$.reduce(J,0),pe=H.reduce(J,0),Ne=D-ie,Qe=O-pe;let ft=0,Ye=ie,lt=0,Et=pe,pt=0,Kt=Ne,Zt=0,fn=Qe;if(E.content&&d){const nn=E.content;ft=ym($,0,nn[0]),lt=ym(H,0,nn[1]),Ye=ym($,nn[0],nn[2]),Et=ym(H,nn[1],nn[3]),pt=nn[0]-ft,Zt=nn[1]-lt,Kt=nn[2]-nn[0]-Ye,fn=nn[3]-nn[1]-Et}const Ln=(nn,gn,wn,In)=>{const Nn=Kd(nn.stretch-ft,Ye,N,a.left),an=vm(nn.fixed-pt,Kt,nn.stretch,ie),Wn=Kd(gn.stretch-lt,Et,V,a.top),$r=vm(gn.fixed-Zt,fn,gn.stretch,pe),rr=Kd(wn.stretch-ft,Ye,N,a.left),vr=vm(wn.fixed-pt,Kt,wn.stretch,ie),Vn=Kd(In.stretch-lt,Et,V,a.top),qr=vm(In.fixed-Zt,fn,In.stretch,pe),zi=new Q(Nn,Wn),Ii=new Q(rr,Wn),Vi=new Q(rr,Vn),Wr=new Q(Nn,Vn),ps=new Q(an/S,$r/S),hi=new Q(vr/S,qr/S),Ki=o*Math.PI/180;if(Ki){const $s=Math.sin(Ki),qs=Math.cos(Ki),na=[qs,-$s,$s,qs];zi._matMult(na),Ii._matMult(na),Wr._matMult(na),Vi._matMult(na)}const Mo=nn.stretch+nn.fixed,Gs=gn.stretch+gn.fixed;return{tl:zi,tr:Ii,bl:Wr,br:Vi,tex:{x:E.paddedRect.x+1+Mo,y:E.paddedRect.y+1+Gs,w:wn.stretch+wn.fixed-Mo,h:In.stretch+In.fixed-Gs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ps,pixelOffsetBR:hi,minFontScaleX:Kt/S/N,minFontScaleY:fn/S/V,isSDF:u}};if(d&&(E.stretchX||E.stretchY)){const nn=_m($,Ne,ie),gn=_m(H,Qe,pe);for(let wn=0;wn<nn.length-1;wn++){const In=nn[wn],Nn=nn[wn+1];for(let an=0;an<gn.length-1;an++)y.push(Ln(In,gn[an],Nn,gn[an+1]))}}else y.push(Ln({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:O+1}));return y}function ym(a,o,u){let d=0;for(const y of a)d+=Math.max(o,Math.min(u,y[1]))-Math.max(o,Math.min(u,y[0]));return d}function _m(a,o,u){const d=[{fixed:-1,stretch:0}];for(const[y,E]of a){const S=d[d.length-1];d.push({fixed:y-S.stretch,stretch:S.stretch}),d.push({fixed:y-S.stretch,stretch:S.stretch+(E-y)})}return d.push({fixed:o+1,stretch:u}),d}function Kd(a,o,u,d){return a/o*u+d}function vm(a,o,u,d){return a-o*u/d}function iI(a,o,u,d){const y=o+a.positionedLines[d].lineOffset;return 0===d?u+y/2:u+(y+(o+a.positionedLines[d-1].lineOffset))/2}Qf.loadGlyphRange=function(a,o,u,d,y){const E=256*o,S=E+255,D=d.transformRequest(d.normalizeGlyphsURL(u).replace("{fontstack}",a).replace("{range}",`${E}-${S}`),Xr.Glyphs);li(D,(O,N)=>{if(O)y(O);else if(N){const V={},$=new gf(N).readFields(nI,{});for(const H of $.glyphs)V[H.id]=H;y(null,{glyphs:V,ascender:$.ascender,descender:$.descender})}})},Qf.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:u=8,cutoff:d=.25,fontFamily:y="sans-serif",fontWeight:E="normal",fontStyle:S="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=u;const D=this.size=a+4*o,O=this._createCanvas(D),N=this.ctx=O.getContext("2d",{willReadFrequently:!0});N.font=`${S} ${E} ${a}px ${y}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:d,actualBoundingBoxLeft:y,actualBoundingBoxRight:E}=this.ctx.measureText(a),S=Math.ceil(u),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-y))),O=Math.min(this.size-this.buffer,S+Math.ceil(d)),N=D+2*this.buffer,V=O+2*this.buffer,$=Math.max(N*V,0),H=new Uint8ClampedArray($),J={data:H,width:N,height:V,glyphWidth:D,glyphHeight:O,glyphTop:S,glyphLeft:0,glyphAdvance:o};if(0===D||0===O)return J;const{ctx:ie,buffer:pe,gridInner:Ne,gridOuter:Qe}=this;ie.clearRect(pe,pe,D,O),ie.fillText(a,pe,pe+S);const ft=ie.getImageData(pe,pe,D,O);Qe.fill(Zp,0,$),Ne.fill(0,0,$);for(let Ye=0;Ye<O;Ye++)for(let lt=0;lt<D;lt++){const Et=ft.data[4*(Ye*D+lt)+3]/255;if(0===Et)continue;const pt=(Ye+pe)*N+lt+pe;if(1===Et)Qe[pt]=0,Ne[pt]=Zp;else{const Kt=.5-Et;Qe[pt]=Kt>0?Kt*Kt:0,Ne[pt]=Kt<0?Kt*Kt:0}}G0(Qe,0,0,N,V,N,this.f,this.v,this.z),G0(Ne,pe,pe,D,O,N,this.f,this.v,this.z);for(let Ye=0;Ye<$;Ye++){const lt=Math.sqrt(Qe[Ye])-Math.sqrt(Ne[Ye]);H[Ye]=Math.round(255-255*(lt/this.radius+this.cutoff))}return J}};class oI{constructor(o=[],u=sI){if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:d}=this,y=u[o];for(;o>0;){const E=o-1>>1,S=u[E];if(d(y,S)>=0)break;u[o]=S,o=E}u[o]=y}_down(o){const{data:u,compare:d}=this,y=this.length>>1,E=u[o];for(;o<y;){let S=1+(o<<1),D=u[S];const O=S+1;if(O<this.length&&d(u[O],D)<0&&(S=O,D=u[O]),d(D,E)>=0)break;u[o]=D,o=S}u[o]=E}}function sI(a,o){return a<o?-1:a>o?1:0}function Lb(a,o=1,u=!1){let d=1/0,y=1/0,E=-1/0,S=-1/0;const D=a[0];for(let J=0;J<D.length;J++){const ie=D[J];(!J||ie.x<d)&&(d=ie.x),(!J||ie.y<y)&&(y=ie.y),(!J||ie.x>E)&&(E=ie.x),(!J||ie.y>S)&&(S=ie.y)}const O=Math.min(E-d,S-y);let N=O/2;const V=new oI([],$0);if(0===O)return new Q(d,y);for(let J=d;J<E;J+=O)for(let ie=y;ie<S;ie+=O)V.push(new Yp(J+N,ie+N,N,a));let $=function(J){let ie=0,pe=0,Ne=0;const Qe=J[0];for(let ft=0,Ye=Qe.length,lt=Ye-1;ft<Ye;lt=ft++){const Et=Qe[ft],pt=Qe[lt],Kt=Et.x*pt.y-pt.x*Et.y;pe+=(Et.x+pt.x)*Kt,Ne+=(Et.y+pt.y)*Kt,ie+=3*Kt}return new Yp(pe/ie,Ne/ie,0,J)}(a),H=V.length;for(;V.length;){const J=V.pop();(J.d>$.d||!$.d)&&($=J,u&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,H)),J.max-$.d<=o||(N=J.h/2,V.push(new Yp(J.p.x-N,J.p.y-N,N,a)),V.push(new Yp(J.p.x+N,J.p.y-N,N,a)),V.push(new Yp(J.p.x-N,J.p.y+N,N,a)),V.push(new Yp(J.p.x+N,J.p.y+N,N,a)),H+=4)}return u&&(console.log(`num probes: ${H}`),console.log(`best distance: ${$.d}`)),$.p}function $0(a,o){return o.max-a.max}function Yp(a,o,u,d){this.p=new Q(a,o),this.h=u,this.d=function(y,E){let S=!1,D=1/0;for(let O=0;O<E.length;O++){const N=E[O];for(let V=0,$=N.length,H=$-1;V<$;H=V++){const J=N[V],ie=N[H];J.y>y.y!=ie.y>y.y&&y.x<(ie.x-J.x)*(y.y-J.y)/(ie.y-J.y)+J.x&&(S=!S),D=Math.min(D,h0(y,J,ie))}}return(S?1:-1)*Math.sqrt(D)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const f_=Number.POSITIVE_INFINITY,Jd=Math.sqrt(2);function q0(a,[o,u]){let d=0,y=0;if(u===f_){o<0&&(o=0);const E=o/Jd;switch(a){case"top-right":case"top-left":y=E-7;break;case"bottom-right":case"bottom-left":y=7-E;break;case"bottom":y=7-o;break;case"top":y=o-7}switch(a){case"top-right":case"bottom-right":d=-E;break;case"top-left":case"bottom-left":d=E;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),u=Math.abs(u),a){case"top-right":case"top-left":case"top":y=u-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-u}switch(a){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,y]}function H0(a,o,u,d,y,E,S,D,O,N){a.createArrays(),a.tilePixelRatio=Gt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const V=a.layers[0].layout,$=a.layers[0]._unevaluatedLayout._values,H={};if("composite"===a.textSizeData.kind){const{minZoom:pe,maxZoom:Ne}=a.textSizeData;H.compositeTextSizes=[$["text-size"].possiblyEvaluate(new jt(pe),D),$["text-size"].possiblyEvaluate(new jt(Ne),D)]}if("composite"===a.iconSizeData.kind){const{minZoom:pe,maxZoom:Ne}=a.iconSizeData;H.compositeIconSizes=[$["icon-size"].possiblyEvaluate(new jt(pe),D),$["icon-size"].possiblyEvaluate(new jt(Ne),D)]}H.layoutTextSize=$["text-size"].possiblyEvaluate(new jt(O+1),D),H.layoutIconSize=$["icon-size"].possiblyEvaluate(new jt(O+1),D),H.textMaxSize=$["text-size"].possiblyEvaluate(new jt(18),D);const J="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),ie=V.get("text-size");for(const pe of a.features){const Ne=V.get("text-font").evaluate(pe,{},D).join(","),Qe=ie.evaluate(pe,{},D),ft=H.layoutTextSize.evaluate(pe,{},D),Ye=(H.layoutIconSize.evaluate(pe,{},D),{horizontal:{},vertical:void 0}),lt=pe.text;let Et,pt=[0,0];if(lt){const fn=lt.toString(),Ln=24*V.get("text-letter-spacing").evaluate(pe,{},D),nn=24*V.get("text-line-height").evaluate(pe,{},D),gn=P(fn)?Ln:0,wn=V.get("text-anchor").evaluate(pe,{},D),In=V.get("text-variable-anchor");if(!In){const rr=V.get("text-radial-offset").evaluate(pe,{},D);pt=rr?q0(wn,[24*rr,f_]):V.get("text-offset").evaluate(pe,{},D).map(vr=>24*vr)}let Nn=J?"center":V.get("text-justify").evaluate(pe,{},D);const an="point"===V.get("symbol-placement"),Wn=an?24*V.get("text-max-width").evaluate(pe,{},D):1/0,$r=rr=>{a.allowVerticalPlacement&&T(fn)&&(Ye.vertical=a_(lt,o,u,y,Ne,Wn,nn,wn,rr,gn,pt,uc.vertical,!0,ft,Qe))};if(!J&&In){const rr="auto"===Nn?In.map(Vn=>Qd(Vn)):[Nn];let vr=!1;for(let Vn=0;Vn<rr.length;Vn++){const qr=rr[Vn];if(!Ye.horizontal[qr])if(vr)Ye.horizontal[qr]=Ye.horizontal[0];else{const zi=a_(lt,o,u,y,Ne,Wn,nn,"center",qr,gn,pt,uc.horizontal,!1,ft,Qe);zi&&(Ye.horizontal[qr]=zi,vr=1===zi.positionedLines.length)}}$r("left")}else{if("auto"===Nn&&(Nn=Qd(wn)),an||V.get("text-writing-mode").indexOf("horizontal")>=0||!T(fn)){const rr=a_(lt,o,u,y,Ne,Wn,nn,wn,Nn,gn,pt,uc.horizontal,!1,ft,Qe);rr&&(Ye.horizontal[Nn]=rr)}$r(an?"left":Nn)}}let Kt=!1;if(pe.icon&&pe.icon.name){const fn=d[pe.icon.name];fn&&(Et=Pb(y[pe.icon.name],V.get("icon-offset").evaluate(pe,{},D),V.get("icon-anchor").evaluate(pe,{},D)),Kt=fn.sdf,void 0===a.sdfIcons?a.sdfIcons=fn.sdf:a.sdfIcons!==fn.sdf&&Un("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fn.pixelRatio!==a.pixelRatio||0!==V.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Zt=X0(Ye.horizontal)||Ye.vertical;a.iconsInText||(a.iconsInText=!!Zt&&Zt.iconsInText),(Zt||Et)&&Nb(a,pe,Ye,Et,d,H,ft,0,pt,Kt,S,D,N)}E&&a.generateCollisionDebugBuffers(O,a.collisionBoxArray)}function Qd(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nb(a,o,u,d,y,E,S,D,O,N,V,$,H){let J=E.textMaxSize.evaluate(o,{},$);void 0===J&&(J=S);const ie=a.layers[0].layout,pe=ie.get("icon-offset").evaluate(o,{},$),Ne=X0(u.horizontal)||u.vertical,Qe="globe"===H.name,ft=S/24,Ye=a.tilePixelRatio*J/24,lt=(gn=a.overscaling,a.zoom>18&&gn>2&&(gn>>=1),Math.max(Gt/(512*gn),1)*ie.get("symbol-spacing")),Et=ie.get("text-padding")*a.tilePixelRatio,pt=ie.get("icon-padding")*a.tilePixelRatio,Kt=le(ie.get("text-max-angle")),Zt="map"===ie.get("text-rotation-alignment")&&"point"!==ie.get("symbol-placement"),fn="map"===ie.get("icon-rotation-alignment")&&"point"!==ie.get("symbol-placement"),Ln=ie.get("symbol-placement"),nn=lt/2;var gn;const wn=ie.get("icon-text-fit");let In;d&&"none"!==wn&&(a.allowVerticalPlacement&&u.vertical&&(In=z0(d,u.vertical,wn,ie.get("icon-text-fit-padding"),pe,ft)),Ne&&(d=z0(d,Ne,wn,ie.get("icon-text-fit-padding"),pe,ft)));const Nn=(an,Wn,$r)=>{if(Wn.x<0||Wn.x>=Gt||Wn.y<0||Wn.y>=Gt)return;let rr=null;if(Qe){const{x:vr,y:Vn,z:qr}=H.projectTilePoint(Wn.x,Wn.y,$r);rr={anchor:new yi(vr,Vn,qr,0,void 0),up:H.upVector($r,Wn.x,Wn.y)}}!function(vr,Vn,qr,zi,Ii,Vi,Wr,ps,hi,Ki,Mo,Gs,$s,qs,na,Sa,Nl,ws,Ya,la,_o,Js,cl,Ss,Ba){const pu=vr.addToLineVertexArray(Vn,zi);let kl,Fl,Bl,Ta,xf,gh,tg,ng=0,km=0,d1=0,Yc=0,id=-1,Ql=-1;const Tu={};let rg=Rl("");const eu=qr?qr.anchor:Vn;let ip=0,wf=0;if(void 0===hi._unevaluatedLayout.getValue("text-radial-offset")?[ip,wf]=hi.layout.get("text-offset").evaluate(_o,{},Ba).map(zl=>24*zl):(ip=24*hi.layout.get("text-radial-offset").evaluate(_o,{},Ba),wf=f_),vr.allowVerticalPlacement&&Ii.vertical){const zl=Ii.vertical;if(na)gh=d_(zl),ps&&(tg=d_(ps));else{const Ul=hi.layout.get("text-rotate").evaluate(_o,{},Ba)+90;Bl=xm(Ki,eu,Vn,Mo,Gs,$s,zl,qs,Ul,Sa),ps&&(Ta=xm(Ki,eu,Vn,Mo,Gs,$s,ps,ws,Ul))}}if(Vi){const zl=hi.layout.get("icon-rotate").evaluate(_o,{},Ba),Ul="none"!==hi.layout.get("icon-text-fit"),mh=du(Vi,zl,cl,Ul),Ef=ps?du(ps,zl,cl,Ul):void 0;Fl=xm(Ki,eu,Vn,Mo,Gs,$s,Vi,ws,zl),ng=4*mh.length;const od=vr.iconSizeData;let Cf=null;"source"===od.kind?(Cf=[zh*hi.layout.get("icon-size").evaluate(_o,{},Ba)],Cf[0]>jh&&Un(`${vr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===od.kind&&(Cf=[zh*Js.compositeIconSizes[0].evaluate(_o,{},Ba),zh*Js.compositeIconSizes[1].evaluate(_o,{},Ba)],(Cf[0]>jh||Cf[1]>jh)&&Un(`${vr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vr.addSymbols(vr.icon,mh,Cf,la,Ya,_o,!1,qr,Vn,pu.lineStartIndex,pu.lineLength,-1,Ss,Ba),id=vr.icon.placedSymbolArray.length-1,Ef&&(km=4*Ef.length,vr.addSymbols(vr.icon,Ef,Cf,la,Ya,_o,uc.vertical,qr,Vn,pu.lineStartIndex,pu.lineLength,-1,Ss,Ba),Ql=vr.icon.placedSymbolArray.length-1)}for(const zl in Ii.horizontal){const Ul=Ii.horizontal[zl];kl||(rg=Rl(Ul.text),na?xf=d_(Ul):kl=xm(Ki,eu,Vn,Mo,Gs,$s,Ul,qs,hi.layout.get("text-rotate").evaluate(_o,{},Ba),Sa));const mh=1===Ul.positionedLines.length;if(d1+=W0(vr,qr,Vn,Ul,Wr,hi,na,_o,Sa,pu,Ii.vertical?uc.horizontal:uc.horizontalOnly,mh?Object.keys(Ii.horizontal):[zl],Tu,id,Js,Ss,Ba),mh)break}Ii.vertical&&(Yc+=W0(vr,qr,Vn,Ii.vertical,Wr,hi,na,_o,Sa,pu,uc.vertical,["vertical"],Tu,Ql,Js,Ss,Ba));let fc=-1;const bf=(zl,Ul)=>zl?Math.max(zl,Ul):Ul;fc=bf(xf,fc),fc=bf(gh,fc),fc=bf(tg,fc);const op=fc>-1?1:0;vr.glyphOffsetArray.length>=yf.MAX_GLYPHS&&Un("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==_o.sortKey&&vr.addToSortKeyRanges(vr.symbolInstances.length,_o.sortKey),vr.symbolInstances.emplaceBack(eu.x,eu.y,eu.z,Vn.x,Vn.y,Tu.right>=0?Tu.right:-1,Tu.center>=0?Tu.center:-1,Tu.left>=0?Tu.left:-1,Tu.vertical>=0?Tu.vertical:-1,id,Ql,rg,void 0!==kl?kl:vr.collisionBoxArray.length,void 0!==kl?kl+1:vr.collisionBoxArray.length,void 0!==Bl?Bl:vr.collisionBoxArray.length,void 0!==Bl?Bl+1:vr.collisionBoxArray.length,void 0!==Fl?Fl:vr.collisionBoxArray.length,void 0!==Fl?Fl+1:vr.collisionBoxArray.length,Ta||vr.collisionBoxArray.length,Ta?Ta+1:vr.collisionBoxArray.length,Mo,d1,Yc,ng,km,op,0,ip,wf,fc)}(a,Wn,rr,an,u,d,y,In,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,Et,Zt,O,0,pt,fn,pe,o,E,N,V,$)};if("line"===Ln)for(const an of h_(o.geometry,0,0,Gt,Gt)){const Wn=V0(an,lt,Kt,u.vertical||Ne,d,24,Ye,a.overscaling,Gt);for(const $r of Wn){const rr=Ne;rr&&kb(a,rr.text,nn,$r)||Nn(an,$r,$)}}else if("line-center"===Ln){for(const an of o.geometry)if(an.length>1){const Wn=Rb(an,Kt,u.vertical||Ne,d,24,Ye);Wn&&Nn(an,Wn,$)}}else if("Polygon"===o.type)for(const an of Yf(o.geometry,0)){const Wn=Lb(an,16);Nn(an[0],new yi(Wn.x,Wn.y,0,0,void 0),$)}else if("LineString"===o.type)for(const an of o.geometry)Nn(an,new yi(an[0].x,an[0].y,0,0,void 0),$);else if("Point"===o.type)for(const an of o.geometry)for(const Wn of an)Nn([Wn],new yi(Wn.x,Wn.y,0,0,void 0),$)}const jh=32640;function W0(a,o,u,d,y,E,S,D,O,N,V,$,H,J,ie,pe,Ne){const Qe=function(lt,Et,pt,Kt,Zt,fn,Ln,nn){const gn=[];if(0===Et.positionedLines.length)return gn;const wn=Kt.layout.get("text-rotate").evaluate(fn,{})*Math.PI/180,In=function(rr){const vr=rr[0],Vn=rr[1],qr=vr*Vn;return qr>0?[vr,-Vn]:qr<0?[-vr,Vn]:0===vr?[Vn,vr]:[Vn,-vr]}(pt);let Nn=Math.abs(Et.top-Et.bottom);for(const rr of Et.positionedLines)Nn-=rr.lineOffset;const an=Et.positionedLines.length,Wn=Nn/an;let $r=Et.top-pt[1];for(let rr=0;rr<an;++rr){const vr=Et.positionedLines[rr];$r=iI(Et,Wn,$r,rr);for(const Vn of vr.positionedGlyphs){if(!Vn.rect)continue;const qr=Vn.rect||{};let zi=4,Ii=!0,Vi=1,Wr=0;if(Vn.imageName){const Ss=Ln[Vn.imageName];if(!Ss)continue;if(Ss.sdf){Un("SDF images are not supported in formatted text and will be ignored.");continue}Ii=!1,Vi=Ss.pixelRatio,zi=1/Vi}const ps=(Zt||nn)&&Vn.vertical,hi=Vn.metrics.advance*Vn.scale/2,Ki=Vn.metrics,Mo=Vn.rect;if(null===Mo)continue;nn&&Et.verticalizable&&(Wr=Vn.imageName?hi-Vn.metrics.width*Vn.scale/2:0);const Gs=Zt?[Vn.x+hi,Vn.y]:[0,0];let $s=[0,0],qs=[0,0],na=!1;Zt||(ps?(qs=[Vn.x+hi+In[0],Vn.y+In[1]-Wr],na=!0):$s=[Vn.x+hi+pt[0],Vn.y+pt[1]-Wr]);const Sa=Mo.w*Vn.scale/(Vi*(Vn.localGlyph?2:1)),Nl=Mo.h*Vn.scale/(Vi*(Vn.localGlyph?2:1));let ws,Ya,la,_o;if(ps){const Ss=Vn.y-$r,Ba=new Q(-hi,hi-Ss),pu=-Math.PI/2,kl=new Q(...qs);ws=new Q(-hi+$s[0],$s[1]),ws._rotateAround(pu,Ba)._add(kl),ws.x+=-Ss+hi,ws.y-=(Ki.left-zi)*Vn.scale;const Fl=Vn.imageName?Ki.advance*Vn.scale:24*Vn.scale,Bl=String.fromCharCode(Vn.glyph);tI(Bl)?ws.x+=(1-zi)*Vn.scale:Xp(Bl)?ws.x+=Fl-Ki.height*Vn.scale+(-zi-1)*Vn.scale:ws.x+=Vn.imageName||Ki.width+2*zi===Mo.w&&Ki.height+2*zi===Mo.h?(Fl-Nl)/2:(Fl-(Ki.height+2*zi)*Vn.scale)/2,Ya=new Q(ws.x,ws.y-Sa),la=new Q(ws.x+Nl,ws.y),_o=new Q(ws.x+Nl,ws.y-Sa)}else{const Ss=(Ki.left-zi)*Vn.scale-hi+$s[0],Ba=(-Ki.top-zi)*Vn.scale+$s[1],pu=Ss+Sa,kl=Ba+Nl;ws=new Q(Ss,Ba),Ya=new Q(pu,Ba),la=new Q(Ss,kl),_o=new Q(pu,kl)}if(wn){let Ss;Ss=Zt?new Q(0,0):na?new Q(In[0],In[1]):new Q(pt[0],pt[1]),ws._rotateAround(wn,Ss),Ya._rotateAround(wn,Ss),la._rotateAround(wn,Ss),_o._rotateAround(wn,Ss)}const Js=new Q(0,0),cl=new Q(0,0);gn.push({tl:ws,tr:Ya,bl:la,br:_o,tex:qr,writingMode:Et.writingMode,glyphOffset:Gs,sectionIndex:Vn.sectionIndex,isSDF:Ii,pixelOffsetTL:Js,pixelOffsetBR:cl,minFontScaleX:0,minFontScaleY:0})}}return gn}(0,d,O,E,S,D,y,a.allowVerticalPlacement),ft=a.textSizeData;let Ye=null;"source"===ft.kind?(Ye=[zh*E.layout.get("text-size").evaluate(D,{},Ne)],Ye[0]>jh&&Un(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ft.kind&&(Ye=[zh*ie.compositeTextSizes[0].evaluate(D,{},Ne),zh*ie.compositeTextSizes[1].evaluate(D,{},Ne)],(Ye[0]>jh||Ye[1]>jh)&&Un(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,Qe,Ye,O,S,D,V,o,u,N.lineStartIndex,N.lineLength,J,pe,Ne);for(const lt of $)H[lt]=a.text.placedSymbolArray.length-1;return 4*Qe.length}function X0(a){for(const o in a)return a[o];return null}function xm(a,o,u,d,y,E,S,D,O,N){let V=S.top,$=S.bottom,H=S.left,J=S.right;const ie=S.collisionPadding;if(ie&&(H-=ie[0],V-=ie[1],J+=ie[2],$+=ie[3]),O){const pe=new Q(H,V),Ne=new Q(J,V),Qe=new Q(H,$),ft=new Q(J,$),Ye=le(O);let lt=new Q(0,0);N&&(lt=new Q(N[0],N[1])),pe._rotateAround(Ye,lt),Ne._rotateAround(Ye,lt),Qe._rotateAround(Ye,lt),ft._rotateAround(Ye,lt),H=Math.min(pe.x,Ne.x,Qe.x,ft.x),J=Math.max(pe.x,Ne.x,Qe.x,ft.x),V=Math.min(pe.y,Ne.y,Qe.y,ft.y),$=Math.max(pe.y,Ne.y,Qe.y,ft.y)}return a.emplaceBack(o.x,o.y,o.z,u.x,u.y,H,V,J,$,D,d,y,E),a.length-1}function d_(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function kb(a,o,u,d){const y=a.compareText;if(o in y){const E=y[o];for(let S=E.length-1;S>=0;S--)if(d.dist(E[S])<u)return!0}else y[o]=[];return y[o].push(d),!1}function p_(a,o){const u=a.fovAboveCenter,d=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,y=(a._camera.position[2]*a.worldSize-d)/Math.cos(a._pitch),E=Math.sin(u)*y/Math.sin(Math.max(Math.PI/2-a._pitch-u,.01)),S=Math.sin(a._pitch)*E+y;return Math.min(1.01*S,y*(1/a._horizonShift))}function ed(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const u=Math.pow(2,-a.z),d=a.x*u,y=(a.x+1)*u,E=a.y*u,S=(a.y+1)*u,D=Fu(d),O=Fu(y),N=Ol(E),V=Ol(S),$=o.project(D,N),H=o.project(O,N),J=o.project(O,V),ie=o.project(D,V);let pe=Math.min($.x,H.x,J.x,ie.x),Ne=Math.min($.y,H.y,J.y,ie.y),Qe=Math.max($.x,H.x,J.x,ie.x),ft=Math.max($.y,H.y,J.y,ie.y);const Ye=u/16;function lt(pt,Kt,Zt,fn,Ln,nn){const gn=(Zt+Ln)/2,wn=(fn+nn)/2,In=o.project(Fu(gn),Ol(wn)),Nn=Math.max(0,pe-In.x,Ne-In.y,In.x-Qe,In.y-ft);pe=Math.min(pe,In.x),Qe=Math.max(Qe,In.x),Ne=Math.min(Ne,In.y),ft=Math.max(ft,In.y),Nn>Ye&&(lt(pt,In,Zt,fn,gn,wn),lt(In,Kt,gn,wn,Ln,nn))}lt($,H,d,E,y,E),lt(H,J,y,E,y,S),lt(J,ie,y,S,d,S),lt(ie,$,d,S,d,E),pe-=Ye,Ne-=Ye,Qe+=Ye,ft+=Ye;const Et=1/Math.max(Qe-pe,ft-Ne);return{scale:Et,x:pe*Et,y:Ne*Et,x2:Qe*Et,y2:ft*Et,projection:o}}const Z0=Gc(new Float32Array(16));class Gh{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,u){return{x:0,y:0,z:0}}unproject(o,u){return new fo(0,0)}projectTilePoint(o,u,d){return{x:o,y:u,z:0}}locationPoint(o,u,d=!0){return o._coordinatePoint(o.locationCoordinate(u),d)}pixelsPerMeter(o,u){return lc(1,o)*u}pixelSpaceConversion(o,u,d){return 1}farthestPixelDistance(o){return p_(o,o.pixelsPerMeter)}pointCoordinate(o,u,d,y){const E=o.horizonLineFromTop(!1),S=new Q(u,Math.max(E,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(S,y))}pointCoordinate3D(o,u,d){const y=new Q(u,d);if(o.elevation)return o.elevation.pointCoordinate(y);{const E=this.pointCoordinate(o,y.x,y.y,0);return[E.x,E.y,E.z]}}isPointAboveHorizon(o,u){if(o.elevation)return!this.pointCoordinate3D(o,u.x,u.y);const d=o.horizonLineFromTop();return u.y<d}createInversionMatrix(o,u){return Z0}createTileMatrix(o,u,d){let y,E,S;const D=d.canonical,O=Gc(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=ed(D,this);y=1,E=N.x+d.wrap*N.scale,S=N.y,hf(O,O,[y/N.scale,y/N.scale,o.pixelsPerMeter/u])}else y=u/o.zoomScale(D.z),E=(D.x+Math.pow(2,D.z)*d.wrap)*y,S=D.y*y;return ah(O,O,[E,S,0]),hf(O,O,[y/Gt,y/Gt,1]),O}upVector(o,u,d){return[0,0,1]}upVectorScale(o,u,d){return{metersToTile:1}}}class g_ extends Gh{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[u,d]=this.parallels=o.parallels||[29.5,45.5],y=Math.sin(le(u));this.n=(y+Math.sin(le(d)))/2,this.c=1+y*(2*this.n-y),this.r0=Math.sqrt(this.c)/this.n}project(o,u){const{n:d,c:y,r0:E}=this,S=le(o-this.center[0]),D=le(u),O=Math.sqrt(y-2*d*Math.sin(D))/d;return{x:O*Math.sin(S*d),y:O*Math.cos(S*d)-E,z:0}}unproject(o,u){const{n:d,c:y,r0:E}=this,S=E+u;let D=Math.atan2(o,Math.abs(S))*Math.sign(S);S*d<0&&(D-=Math.PI*Math.sign(o)*Math.sign(S));const O=le(this.center[0])*d;D=Bt(D,-Math.PI-O,Math.PI-O);const N=Se(me(D/d)+this.center[0],-180,180),V=Math.asin(Se((y-(o*o+S*S)*d*d)/(2*d),-1,1)),$=Se(me(V),-Za,Za);return new fo(N,$)}}const wm=1.340264,td=-.081106,Kp=893e-6,bm=.003796,Tr=Math.sqrt(3)/2;class Em extends Gh{project(o,u){u=u/180*Math.PI,o=o/180*Math.PI;const d=Math.asin(Tr*Math.sin(u)),y=d*d,E=y*y*y;return{x:.5*(o*Math.cos(d)/(Tr*(wm+3*td*y+E*(7*Kp+9*bm*y)))/Math.PI+.5),y:1-.5*(d*(wm+td*y+E*(Kp+bm*y))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let d=u=(2*(1-u)-1)*Math.PI,y=d*d,E=y*y*y;for(let V,$,H,J=0;J<12&&($=d*(wm+td*y+E*(Kp+bm*y))-u,H=wm+3*td*y+E*(7*Kp+9*bm*y),V=$/H,d=Se(d-V,-Math.PI/3,Math.PI/3),y=d*d,E=y*y*y,!(Math.abs(V)<1e-12));++J);const S=Tr*o*(wm+3*td*y+E*(7*Kp+9*bm*y))/Math.cos(d),D=Math.asin(Math.sin(d)/Tr),O=Se(180*S/Math.PI,-180,180),N=Se(180*D/Math.PI,-Za,Za);return new fo(O,N)}}class Y0 extends Gh{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){return{x:.5+o/360,y:.5-u/360,z:0}}unproject(o,u){const d=360*(o-.5),y=Se(360*(.5-u),-Za,Za);return new fo(d,y)}}const $h=Math.PI/2;function Zu(a){return Math.tan(($h+a)/2)}class K0 extends Gh{constructor(o){super(o),this.center=o.center||[0,30];const[u,d]=this.parallels=o.parallels||[30,30];let y=le(u),E=le(d);this.southernCenter=y+E<0,this.southernCenter&&(y=-y,E=-E);const S=Math.cos(y),D=Zu(y);this.n=y===E?Math.sin(y):Math.log(S/Math.cos(E))/Math.log(Zu(E)/D),this.f=S*Math.pow(Zu(y),this.n)/this.n}project(o,u){u=le(u),this.southernCenter&&(u=-u),o=le(o-this.center[0]);const d=1e-6,{n:y,f:E}=this;E>0?u<-$h+d&&(u=-$h+d):u>$h-d&&(u=$h-d);const S=E/Math.pow(Zu(u),y);let D=S*Math.sin(y*o),O=E-S*Math.cos(y*o);return D=.5*(D/Math.PI+.5),O=.5*(O/Math.PI+.5),{x:D,y:this.southernCenter?O:1-O,z:0}}unproject(o,u){o=(2*o-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:d,f:y}=this,E=y-u,S=Math.sign(E),D=Math.sign(d)*Math.sqrt(o*o+E*E);let O=Math.atan2(o,Math.abs(E))*S;E*d<0&&(O-=Math.PI*Math.sign(o)*S);const N=Se(me(O/d)+this.center[0],-180,180),V=Se(me(2*Math.atan(Math.pow(y/D,1/d))-$h),-Za,Za);return new fo(N,this.southernCenter?-V:V)}}class J0 extends Gh{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,u){return{x:ch(o),y:hh(u),z:0}}unproject(o,u){const d=Fu(o),y=Ol(u);return new fo(d,y)}}const Cm=le(Za);class qh extends Gh{project(o,u){const d=(u=le(u))*u,y=d*d;return{x:.5*((o=le(o))*(.8707-.131979*d+y*(y*(.003971*d-.001529*y)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+d*(.015085+y*(.028874*d-.044475-.005916*y)))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let d=u=(2*(1-u)-1)*Math.PI,y=25,E=0,S=d*d;do{S=d*d;const N=S*S;E=(d*(1.007226+S*(.015085+N*(.028874*S-.044475-.005916*N)))-u)/(1.007226+S*(.045255+N*(.259866*S-.311325-.005916*11*N))),d=Se(d-E,-Cm,Cm)}while(Math.abs(E)>1e-6&&--y>0);S=d*d;const D=Se(me(o/(.8707+S*(S*(S*S*S*(.003971-.001529*S)-.013791)-.131979))),-180,180),O=me(d);return new fo(D,O)}}const Sm=le(Za);class Q0 extends Gh{project(o,u){u=le(u),o=le(o);const d=Math.cos(u),y=2/Math.PI,E=Math.acos(d*Math.cos(o/2)),S=Math.sin(E)/E,D=.5*(o*y+2*d*Math.sin(o/2)/S)||0,O=.5*(u+Math.sin(u)/S)||0;return{x:.5*(D/Math.PI+.5),y:1-.5*(O/Math.PI+1),z:0}}unproject(o,u){let d=o=(2*o-.5)*Math.PI,y=u=(2*(1-u)-1)*Math.PI,E=25;const S=1e-6;let D=0,O=0;do{const N=Math.cos(y),V=Math.sin(y),$=2*V*N,H=V*V,J=N*N,ie=Math.cos(d/2),pe=Math.sin(d/2),Ne=2*ie*pe,Qe=pe*pe,ft=1-J*ie*ie,Ye=ft?1/ft:0,lt=ft?Math.acos(N*ie)*Math.sqrt(1/ft):0,Et=.5*(2*lt*N*pe+2*d/Math.PI)-o,pt=.5*(lt*V+y)-u,Kt=.5*Ye*(J*Qe+lt*N*ie*H)+1/Math.PI,Zt=Ye*(Ne*$/4-lt*V*pe),fn=.125*Ye*($*pe-lt*V*J*Ne),Ln=.5*Ye*(H*ie+lt*Qe*N)+.5,nn=Zt*fn-Ln*Kt;D=(pt*Zt-Et*Ln)/nn,O=(Et*fn-pt*Kt)/nn,d=Se(d-D,-Math.PI,Math.PI),y=Se(y-O,-Sm,Sm)}while((Math.abs(D)>S||Math.abs(O)>S)&&--E>0);return new fo(me(d),me(y))}}class Tm extends Gh{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(le(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){const{scale:d,cosPhi:y}=this;return{x:le(o)*y*d+.5,y:-Math.sin(le(u))/y*d+.5,z:0}}unproject(o,u){const{scale:d,cosPhi:y}=this,E=-(u-.5)/d,S=Se(me((o-.5)/d)/y,-180,180),D=Math.asin(Se(E*y,-1,1)),O=Se(me(D),-Za,Za);return new fo(S,O)}}class aI extends J0{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,u,d){const y=Nd(o,u,d);return Ca(y,y,kd(Hc(d))),{x:y[0],y:y[1],z:y[2]}}locationPoint(o,u){const d=uh(u.lat,u.lng),y=Eu([],d),E=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(u),o._centerAltitude):o._centerAltitude;Ip(d,d,y,lc(1,0)*Gt*E);const S=Gc(new Float64Array(16));return Lh(S,o.pixelMatrix,o.globeMatrix),Ca(d,d,S),new Q(d[0],d[1])}pixelsPerMeter(o,u){return lc(1,0)*u}pixelSpaceConversion(o,u,d){const y=lc(1,o)*u,E=er(lc(1,45)*u,y,d);return this.pixelsPerMeter(o,u)/E}createTileMatrix(o,u,d){const y=wy(Hc(d.canonical));return Lh(new Float64Array(16),o.globeMatrix,y)}createInversionMatrix(o,u){const{center:d}=o,y=kd(Hc(u));return Lg(y,y,le(d.lng)),jf(y,y,le(d.lat)),hf(y,y,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(y)}pointCoordinate(o,u,d,y){return n0(o,u,d,!0)||new qf(0,0)}pointCoordinate3D(o,u,d){const y=this.pointCoordinate(o,u,d,0);return[y.x,y.y,y.z]}isPointAboveHorizon(o,u){return!n0(o,u.x,u.y,!1)}farthestPixelDistance(o){const u=function(y,E){const S=y.cameraToCenterDistance,D=y._centerAltitude*E,O=y._camera,N=y._camera.forward(),V=ac([],Mc([],N,-S),[0,0,D]),$=y.worldSize/(2*Math.PI),H=[0,0,-$],J=y.width/y.height,ie=Math.tan(y.fovAboveCenter),pe=Mc([],O.up(),ie),Ne=Mc([],O.right(),ie*J),Qe=Eu([],ac([],ac([],N,pe),Ne)),ft=[];let Ye;if(new Bg(V,Qe).closestPointOnSphere(H,$,ft)){const lt=ac([],ft,H),Et=lh([],lt,V);Ye=Math.cos(y.fovAboveCenter)*Sp(Et)}else{const lt=lh([],V,H),Et=lh([],H,V);Eu(Et,Et);const pt=Sp(lt)-$;Ye=Math.sqrt(pt*(pt+2*$));const Kt=Math.acos(Ye/($+pt))-Math.acos(Dc(N,Et));Ye*=Math.cos(Kt)}return 1.01*Ye}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=Fd(o.zoom);if(d>0){const y=p_(o,lc(1,o.center.lat)*o.worldSize),E=o.worldSize/(2*Math.PI),S=Math.max(o.width,o.height)/o.worldSize*Math.PI;return er(u,y+E*(1-Math.cos(S)),Math.pow(d,10))}return u}upVector(o,u,d){return Nd(u,d,o,1)}upVectorScale(o){return{metersToTile:Ld(Ug(Hc(o)))}}}function m_(a){const o=a.parallels,u=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new J0(a);case"equirectangular":return new Y0(a);case"naturalEarth":return new qh(a);case"equalEarth":return new Em(a);case"winkelTripel":return new Q0(a);case"albers":return u?new Tm(a):new g_(a);case"lambertConformalConic":return u?new Tm(a):new K0(a);case"globe":return new aI(a)}throw new Error(`Invalid projection name: ${a.name}`)}const lI=Gd.types,Im=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nd(a,o,u,d,y,E,S,D,O,N,V,$,H){const J=D?Math.min(jh,Math.round(D[0])):0,ie=D?Math.min(jh,Math.round(D[1])):0;a.emplaceBack(o,u,Math.round(32*d),Math.round(32*y),E,S,(J<<1)+(O?1:0),ie,16*N,16*V,256*$,256*H)}function ep(a,o,u,d,y,E,S){a.emplaceBack(o,u,d,y,E,S)}function tp(a,o,u,d,y){a.emplaceBack(o,u,d,y),a.emplaceBack(o,u,d,y),a.emplaceBack(o,u,d,y),a.emplaceBack(o,u,d,y)}function y_(a){for(const o of a.sections)if(fe(o.text))return!0;return!1}class e1{constructor(o){this.layoutVertexArray=new Bc,this.indexArray=new Wa,this.programConfigurations=o,this.segments=new Xa,this.dynamicLayoutVertexArray=new Rs,this.opacityVertexArray=new xs,this.placedSymbolArray=new Ow,this.globeExtVertexArray=new Vs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,u,d,y){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,mb.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,_b.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Im,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,yb.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||y)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}vt(e1,"SymbolBuffers");class __{constructor(o,u,d){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new d,this.segments=new Xa,this.collisionVertexArray=new ds,this.collisionVertexArrayExt=new Ha}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,n_.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,vb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}vt(__,"CollisionBuffers");class yf{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(S=>S.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gc([]),this.placementViewportMatrix=Gc([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i_(this.zoom,u["text-size"]),this.iconSizeData=i_(this.zoom,u["icon-size"]);const d=this.layers[0].layout,y=d.get("symbol-sort-key"),E=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==E&&void 0!==y.constantOr(1),this.sortFeaturesByY=("viewport-y"===E||"auto"===E&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(S=>uc[S]),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new e1(new Id(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new e1(new Id(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Nw,this.lineVertexArray=new kw,this.symbolInstances=new bd}calculateGlyphDependencies(o,u,d,y,E){for(let S=0;S<o.length;S++)if(u[o.charCodeAt(S)]=!0,y&&E){const D=Wp[o.charAt(S)];D&&(u[D.charCodeAt(0)]=!0)}}populate(o,u,d,y){const E=this.layers[0],S=E.layout,D="globe"===this.projection.name,O=S.get("text-font"),N=S.get("text-field"),V=S.get("icon-image"),$=("constant"!==N.value.kind||N.value.value instanceof vi&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&("constant"!==O.value.kind||O.value.value.length>0),H="constant"!==V.value.kind||!!V.value.value||Object.keys(V.parameters).length>0,J=S.get("symbol-sort-key");if(this.features=[],!$&&!H)return;const ie=u.iconDependencies,pe=u.glyphDependencies,Ne=u.availableImages,Qe=new jt(this.zoom);for(const{feature:ft,id:Ye,index:lt,sourceLayerIndex:Et}of o){const pt=E._featureFilter.needGeometry,Kt=ff(ft,pt);if(!E._featureFilter.filter(Qe,Kt,d))continue;if(pt||(Kt.geometry=kh(ft,d,y)),D&&1!==ft.type&&d.z<=5){const nn=Kt.geometry,gn=.98078528056,wn=(In,Nn)=>Dc(Nd(In.x,In.y,d,1),Nd(Nn.x,Nn.y,d,1))<gn;for(let In=0;In<nn.length;In++)nn[In]=Xw(nn[In],wn)}let Zt,fn;if($){const nn=E.getValueAndResolveTokens("text-field",Kt,d,Ne),gn=vi.factory(nn);y_(gn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ct()||this.hasRTLText&&It.isParsed())&&(Zt=Oc(gn,E,Kt))}if(H){const nn=E.getValueAndResolveTokens("icon-image",Kt,d,Ne);fn=nn instanceof pl?nn:pl.fromString(nn)}if(!Zt&&!fn)continue;const Ln=this.sortFeaturesByKey?J.evaluate(Kt,{},d):void 0;if(this.features.push({id:Ye,text:Zt,icon:fn,index:lt,sourceLayerIndex:Et,geometry:Kt.geometry,properties:ft.properties,type:lI[ft.type],sortKey:Ln}),fn&&(ie[fn.name]=!0),Zt){const nn=O.evaluate(Kt,{},d).join(","),gn="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(uc.vertical)>=0;for(const wn of Zt.sections)if(wn.image)ie[wn.image.name]=!0;else{const In=T(Zt.toString()),Nn=wn.fontStack||nn,an=pe[Nn]=pe[Nn]||{};this.calculateGlyphDependencies(wn.text,an,gn,this.allowVerticalPlacement,In)}}}"line"===S.get("symbol-placement")&&(this.features=function(ft){const Ye={},lt={},Et=[];let pt=0;function Kt(nn){Et.push(ft[nn]),pt++}function Zt(nn,gn,wn){const In=lt[nn];return delete lt[nn],lt[gn]=In,Et[In].geometry[0].pop(),Et[In].geometry[0]=Et[In].geometry[0].concat(wn[0]),In}function fn(nn,gn,wn){const In=Ye[gn];return delete Ye[gn],Ye[nn]=In,Et[In].geometry[0].shift(),Et[In].geometry[0]=wn[0].concat(Et[In].geometry[0]),In}function Ln(nn,gn,wn){const In=wn?gn[0][gn[0].length-1]:gn[0][0];return`${nn}:${In.x}:${In.y}`}for(let nn=0;nn<ft.length;nn++){const gn=ft[nn],wn=gn.geometry,In=gn.text?gn.text.toString():null;if(!In){Kt(nn);continue}const Nn=Ln(In,wn),an=Ln(In,wn,!0);if(Nn in lt&&an in Ye&&lt[Nn]!==Ye[an]){const Wn=fn(Nn,an,wn),$r=Zt(Nn,an,Et[Wn].geometry);delete Ye[Nn],delete lt[an],lt[Ln(In,Et[$r].geometry,!0)]=$r,Et[Wn].geometry=null}else Nn in lt?Zt(Nn,an,wn):an in Ye?fn(Nn,an,wn):(Kt(nn),Ye[Nn]=pt-1,lt[an]=pt-1)}return Et.filter(nn=>nn.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ft,Ye)=>ft.sortKey-Ye.sortKey)}update(o,u,d,y){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,d,y),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,d,y))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=m_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const d=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:y,y:E}of u)this.lineVertexArray.emplaceBack(y,E);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,u,d,y,E,S,D,O,N,V,$,H,J,ie){const pe=o.indexArray,Ne=o.layoutVertexArray,Qe=o.globeExtVertexArray,ft=o.segments.prepareSegment(4*u.length,Ne,pe,this.canOverlap?S.sortKey:void 0),Ye=this.glyphOffsetArray.length,lt=ft.vertexLength,Et=this.allowVerticalPlacement&&D===uc.vertical?Math.PI/2:0,pt=S.text&&S.text.sections;for(let Zt=0;Zt<u.length;Zt++){const{tl:fn,tr:Ln,bl:nn,br:gn,tex:wn,pixelOffsetTL:In,pixelOffsetBR:Nn,minFontScaleX:an,minFontScaleY:Wn,glyphOffset:$r,isSDF:rr,sectionIndex:vr}=u[Zt],Vn=ft.vertexLength,qr=$r[1];if(nd(Ne,N.x,N.y,fn.x,qr+fn.y,wn.x,wn.y,d,rr,In.x,In.y,an,Wn),nd(Ne,N.x,N.y,Ln.x,qr+Ln.y,wn.x+wn.w,wn.y,d,rr,Nn.x,In.y,an,Wn),nd(Ne,N.x,N.y,nn.x,qr+nn.y,wn.x,wn.y+wn.h,d,rr,In.x,Nn.y,an,Wn),nd(Ne,N.x,N.y,gn.x,qr+gn.y,wn.x+wn.w,wn.y+wn.h,d,rr,Nn.x,Nn.y,an,Wn),O){const{x:zi,y:Ii,z:Vi}=O.anchor,[Wr,ps,hi]=O.up;ep(Qe,zi,Ii,Vi,Wr,ps,hi),ep(Qe,zi,Ii,Vi,Wr,ps,hi),ep(Qe,zi,Ii,Vi,Wr,ps,hi),ep(Qe,zi,Ii,Vi,Wr,ps,hi),tp(o.dynamicLayoutVertexArray,zi,Ii,Vi,Et)}else tp(o.dynamicLayoutVertexArray,N.x,N.y,N.z,Et);pe.emplaceBack(Vn,Vn+1,Vn+2),pe.emplaceBack(Vn+1,Vn+2,Vn+3),ft.vertexLength+=4,ft.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($r[0]),Zt!==u.length-1&&vr===u[Zt+1].sectionIndex||o.programConfigurations.populatePaintArrays(Ne.length,S,S.index,{},J,ie,pt&&pt[vr])}const Kt=O?O.anchor:N;o.placedSymbolArray.emplaceBack(Kt.x,Kt.y,Kt.z,N.x,N.y,Ye,this.glyphOffsetArray.length-Ye,lt,V,$,N.segment,d?d[0]:0,d?d[1]:0,y[0],y[1],D,0,!1,0,H,0)}_commitLayoutVertex(o,u,d,y,E,S,D){o.emplaceBack(u,d,y,E,S,Math.round(D.x),Math.round(D.y))}_addCollisionDebugVertices(o,u,d,y,E,S,D){const O=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),N=O.vertexLength,V=D.tileAnchorX,$=D.tileAnchorY;for(let J=0;J<4;J++)d.collisionVertexArray.emplaceBack(0,0,0,0);d.collisionVertexArrayExt.emplaceBack(u,-o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(u,o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(u,o.padding,o.padding),d.collisionVertexArrayExt.emplaceBack(u,-o.padding,o.padding),this._commitLayoutVertex(d.layoutVertexArray,y,E,S,V,$,new Q(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,y,E,S,V,$,new Q(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,y,E,S,V,$,new Q(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,y,E,S,V,$,new Q(o.x1,o.y2)),O.vertexLength+=4;const H=d.indexArray;H.emplaceBack(N,N+1),H.emplaceBack(N+1,N+2),H.emplaceBack(N+2,N+3),H.emplaceBack(N+3,N),O.primitiveLength+=4}_addTextDebugCollisionBoxes(o,u,d,y,E,S){for(let D=y;D<E;D++){const O=d.get(D),N=this.getSymbolInstanceTextSize(o,S,u,D);this._addCollisionDebugVertices(O,N,this.textCollisionBox,O.projectedAnchorX,O.projectedAnchorY,O.projectedAnchorZ,S)}}_addIconDebugCollisionBoxes(o,u,d,y,E,S){for(let D=y;D<E;D++){const O=d.get(D),N=this.getSymbolInstanceIconSize(o,u,S.placedIconSymbolIndex);this._addCollisionDebugVertices(O,N,this.iconCollisionBox,O.projectedAnchorX,O.projectedAnchorY,O.projectedAnchorZ,S)}}generateCollisionDebugBuffers(o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new __(ya,r_.members,Er),this.iconCollisionBox=new __(ya,r_.members,Er);const d=qd(this.iconSizeData,o),y=qd(this.textSizeData,o);for(let E=0;E<this.symbolInstances.length;E++){const S=this.symbolInstances.get(E);this._addTextDebugCollisionBoxes(y,o,u,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(y,o,u,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,o,u,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,o,u,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(o,u,d,y){const E=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:y),S=ph(this.textSizeData,o,E)/24;return this.tilePixelRatio*S}getSymbolInstanceIconSize(o,u,d){const y=this.icon.placedSymbolArray.get(d),E=ph(this.iconSizeData,o,y);return this.tilePixelRatio*E}_commitDebugCollisionVertexUpdate(o,u,d){o.emplaceBack(u,-d,-d),o.emplaceBack(u,d,-d),o.emplaceBack(u,d,d),o.emplaceBack(u,-d,d)}_updateTextDebugCollisionBoxes(o,u,d,y,E,S){for(let D=y;D<E;D++){const O=d.get(D),N=this.getSymbolInstanceTextSize(o,S,u,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,N,O.padding)}}_updateIconDebugCollisionBoxes(o,u,d,y,E,S){for(let D=y;D<E;D++){const O=d.get(D),N=this.getSymbolInstanceIconSize(o,u,S);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,O.padding)}}updateCollisionDebugBuffers(o,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=qd(this.iconSizeData,o),y=qd(this.textSizeData,o);for(let E=0;E<this.symbolInstances.length;E++){const S=this.symbolInstances.get(E);this._updateTextDebugCollisionBoxes(y,o,u,S.textBoxStartIndex,S.textBoxEndIndex,S),this._updateTextDebugCollisionBoxes(y,o,u,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._updateIconDebugCollisionBoxes(d,o,u,S.iconBoxStartIndex,S.iconBoxEndIndex,S.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(d,o,u,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,u,d,y,E,S,D,O,N){const V={};if(u<d){const{x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt,featureIndex:Et}=o.get(u);V.textBox={x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt},V.textFeatureIndex=Et}if(y<E){const{x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt,featureIndex:Et}=o.get(y);V.verticalTextBox={x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt},V.verticalTextFeatureIndex=Et}if(S<D){const{x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt,featureIndex:Et}=o.get(S);V.iconBox={x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt},V.iconFeatureIndex=Et}if(O<N){const{x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt,featureIndex:Et}=o.get(O);V.verticalIconBox={x1:$,y1:H,x2:J,y2:ie,padding:pe,projectedAnchorX:Ne,projectedAnchorY:Qe,projectedAnchorZ:ft,tileAnchorX:Ye,tileAnchorY:lt},V.verticalIconFeatureIndex=Et}return V}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const d=o.placedSymbolArray.get(u),y=d.vertexStartIndex+4*d.numGlyphs;for(let E=d.vertexStartIndex;E<y;E+=4)o.indexArray.emplaceBack(E,E+1,E+2),o.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const u=Math.sin(o),d=Math.cos(o),y=[],E=[],S=[];for(let D=0;D<this.symbolInstances.length;++D){S.push(D);const O=this.symbolInstances.get(D);y.push(0|Math.round(u*O.tileAnchorX+d*O.tileAnchorY)),E.push(O.featureIndex)}return S.sort((D,O)=>y[D]-y[O]||E[O]-E[D]),S}addToSortKeyRanges(o,u){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===u?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const d=this.symbolInstances.get(u);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:E,leftJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:D,placedIconSymbolIndex:O,verticalPlacedIconSymbolIndex:N}=d;y>=0&&this.addIndicesForPlacedSymbol(this.text,y),E>=0&&E!==y&&this.addIndicesForPlacedSymbol(this.text,E),S>=0&&S!==E&&S!==y&&this.addIndicesForPlacedSymbol(this.text,S),D>=0&&this.addIndicesForPlacedSymbol(this.text,D),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}vt(yf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),yf.MAX_GLYPHS=65535,yf.addDynamicAttributes=tp;const Fb=new Pn({"symbol-placement":new Vt(Yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(Yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(Yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new en(Yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(Yt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(Yt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Vt(Yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(Yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(Yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new en(Yt.layout_symbol["icon-size"]),"icon-text-fit":new Vt(Yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new en(Yt.layout_symbol["icon-image"]),"icon-rotate":new en(Yt.layout_symbol["icon-rotate"]),"icon-padding":new Vt(Yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(Yt.layout_symbol["icon-keep-upright"]),"icon-offset":new en(Yt.layout_symbol["icon-offset"]),"icon-anchor":new en(Yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(Yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(Yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(Yt.layout_symbol["text-rotation-alignment"]),"text-field":new en(Yt.layout_symbol["text-field"]),"text-font":new en(Yt.layout_symbol["text-font"]),"text-size":new en(Yt.layout_symbol["text-size"]),"text-max-width":new en(Yt.layout_symbol["text-max-width"]),"text-line-height":new en(Yt.layout_symbol["text-line-height"]),"text-letter-spacing":new en(Yt.layout_symbol["text-letter-spacing"]),"text-justify":new en(Yt.layout_symbol["text-justify"]),"text-radial-offset":new en(Yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(Yt.layout_symbol["text-variable-anchor"]),"text-anchor":new en(Yt.layout_symbol["text-anchor"]),"text-max-angle":new Vt(Yt.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(Yt.layout_symbol["text-writing-mode"]),"text-rotate":new en(Yt.layout_symbol["text-rotate"]),"text-padding":new Vt(Yt.layout_symbol["text-padding"]),"text-keep-upright":new Vt(Yt.layout_symbol["text-keep-upright"]),"text-transform":new en(Yt.layout_symbol["text-transform"]),"text-offset":new en(Yt.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(Yt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Vt(Yt.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(Yt.layout_symbol["text-optional"])});var v_={paint:new Pn({"icon-opacity":new en(Yt.paint_symbol["icon-opacity"]),"icon-color":new en(Yt.paint_symbol["icon-color"]),"icon-halo-color":new en(Yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new en(Yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new en(Yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(Yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(Yt.paint_symbol["icon-translate-anchor"]),"text-opacity":new en(Yt.paint_symbol["text-opacity"]),"text-color":new en(Yt.paint_symbol["text-color"],{runtimeType:On,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new en(Yt.paint_symbol["text-halo-color"]),"text-halo-width":new en(Yt.paint_symbol["text-halo-width"]),"text-halo-blur":new en(Yt.paint_symbol["text-halo-blur"]),"text-translate":new Vt(Yt.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(Yt.paint_symbol["text-translate-anchor"])}),layout:Fb};class x_{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:ao,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vt(x_,"FormatSectionOverride",{omit:["defaultValue"]});class w_ extends Ic{constructor(o){super(o,v_)}recalculate(o,u){super.recalculate(o,u),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const y=[];for(const E of d)y.indexOf(E)<0&&y.push(E);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,u,d,y){const E=this.layout.get(o).evaluate(u,{},d,y),S=this._unevaluatedLayout._values[o];return S.isDataDriven()||sa(S.value)||!E?E:(D=u.properties,E.replace(/{([^{}]+)}/g,(N,V)=>V in D?String(D[V]):""));var D}createBucket(o){return new yf(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of v_.paint.overridableProperties){if(!w_.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),d=new x_(u),y=new Dl(d,u.property.specification);let E=null;E="constant"===u.value.kind||"source"===u.value.kind?new As("source",y):new qu("composite",y,u.value.zoomStops,u.value._interpolationType),this.paint._values[o]=new An(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,d){return!(!this.layout||u.isDataDriven()||d.isDataDriven())&&w_.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const d=o.get("text-field"),y=v_.paint.properties[u];let E=!1;const S=D=>{for(const O of D)if(y.overrides&&y.overrides.hasOverride(O))return void(E=!0)};if("constant"===d.value.kind&&d.value.value instanceof vi)S(d.value.value.sections);else if("source"===d.value.kind){const D=N=>{E||(N instanceof bs&&zn(N.value)===st?S(N.value.sections):N instanceof ou?S(N.sections):N.eachChild(D))},O=d.value;O._styleExpression&&D(O._styleExpression.expression)}return E}getProgramConfiguration(o){return new jc(this,o)}}var Bb={paint:new Pn({"background-color":new Vt(Yt.paint_background["background-color"]),"background-pattern":new Vt(Yt.paint_background["background-pattern"]),"background-opacity":new Vt(Yt.paint_background["background-opacity"])})},uI={paint:new Pn({"raster-opacity":new Vt(Yt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(Yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(Yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(Yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(Yt.paint_raster["raster-saturation"]),"raster-contrast":new Vt(Yt.paint_raster["raster-contrast"]),"raster-resampling":new Vt(Yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(Yt.paint_raster["raster-fade-duration"])})};class t1 extends Ic{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var n1={paint:new Pn({"sky-type":new Vt(Yt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Vt(Yt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Vt(Yt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Vt(Yt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Vt(Yt.paint_sky["sky-gradient-radius"]),"sky-gradient":new xn(Yt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Vt(Yt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Vt(Yt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Vt(Yt.paint_sky["sky-opacity"])})};function b_(a,o,u){const d=[0,0,1],y=jw([]);return Gw(y,y,u?-le(a)+Math.PI:le(a)),Fg(y,y,-le(o)),Kv(d,d,y),Eu(d,d)}const E_={circle:class extends Ic{constructor(a){super(a,Hg)}createBucket(a){return new Np(a)}queryRadius(a){const o=a;return Hf("circle-radius",this,o)+Hf("circle-stroke-width",this,o)+kp(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,u,d,y,E,S,D){const O=Ry(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u);return Oy(a,d,E,S,D,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),O,N)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new jc(this,a)}},heatmap:class extends Ic{createBucket(a){return new p0(a)}constructor(a){super(a,Xg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Hf("heatmap-radius",this,a)}queryIntersectsFeature(a,o,u,d,y,E,S,D){const O=this.paint.get("heatmap-radius").evaluate(o,u);return Oy(a,d,E,S,D,!0,!0,new Q(0,0),O)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new jc(this,a)}},hillshade:class extends Ic{constructor(a){super(a,Wf)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ic{constructor(a){super(a,JT)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),u=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(a){return new jc(this,a)}recalculate(a,o){super.recalculate(a,o);const u=this.paint._values["fill-outline-color"];"constant"===u.value.kind&&void 0===u.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new $y(a)}queryRadius(){return kp(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,u,d,y,E){return!a.queryGeometry.isAboveHorizon&&Py($g(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends Ic{constructor(a){super(a,Jy)}createBucket(a){return new rm(a)}queryRadius(){return kp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new jc(this,a)}queryIntersectsFeature(a,o,u,d,y,E,S,D,O){const N=Ry(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),V=this.paint.get("fill-extrusion-height").evaluate(o,u),$=this.paint.get("fill-extrusion-base").evaluate(o,u),H=[0,0],J=D&&E.elevation,ie=E.elevation?E.elevation.exaggeration():1,pe=a.tile.getBucket(this);if(J&&pe instanceof rm){const lt=pe.centroidVertexArray,Et=O+1;Et<lt.length&&(H[0]=lt.geta_centroid_pos0(Et),H[1]=lt.geta_centroid_pos1(Et))}if(0===H[0]&&1===H[1])return!1;"globe"===E.projection.name&&(d=Ky([d],[new Q(0,0),new Q(Gt,Gt)],a.tileID.canonical).map(lt=>lt.polygon).flat());const Ne=J?D:null,[Qe,ft]=(Et=d,pt=$,Kt=V,Zt=N,fn=S,Ln=Ne,nn=H,gn=ie,wn=E.center.lat,"globe"===(lt=E).projection.name?function(Nn,an,Wn,$r,rr,vr,Vn,qr,zi,Ii,Vi){const Wr=[],ps=[],hi=Nn.projection.upVectorScale(Vi,Nn.center.lat,Nn.worldSize).metersToTile,Ki=[0,0,0,1],Mo=[0,0,0,1],Gs=(qs,na,Sa,Nl)=>{qs[0]=na,qs[1]=Sa,qs[2]=Nl,qs[3]=1},$s=I0();Wn>0&&(Wn+=$s),$r+=$s;for(const qs of an){const na=[],Sa=[];for(const Nl of qs){const ws=Nl.x+rr.x,Ya=Nl.y+rr.y,la=Nn.projection.projectTilePoint(ws,Ya,Vi),_o=Nn.projection.upVector(Vi,Nl.x,Nl.y);let Js=Wn,cl=$r;if(Vn){const Ss=Hp(ws,Ya,Wn,$r,Vn,qr,zi,Ii);Js+=Ss.base,cl+=Ss.top}0!==Wn?Gs(Ki,la.x+_o[0]*hi*Js,la.y+_o[1]*hi*Js,la.z+_o[2]*hi*Js):Gs(Ki,la.x,la.y,la.z),Gs(Mo,la.x+_o[0]*hi*cl,la.y+_o[1]*hi*cl,la.z+_o[2]*hi*cl),Ca(Ki,Ki,vr),Ca(Mo,Mo,vr),na.push(new Rc(Ki[0],Ki[1],Ki[2])),Sa.push(new Rc(Mo[0],Mo[1],Mo[2]))}Wr.push(na),ps.push(Sa)}return[Wr,ps]}(lt,Et,pt,Kt,Zt,fn,Ln,nn,gn,wn,a.tileID.canonical):Ln?function(Nn,an,Wn,$r,rr,vr,Vn,qr,zi){const Ii=[],Vi=[],Wr=[0,0,0,1];for(const ps of Nn){const hi=[],Ki=[];for(const Mo of ps){const Gs=Mo.x+$r.x,$s=Mo.y+$r.y,qs=Hp(Gs,$s,an,Wn,vr,Vn,qr,zi);Wr[0]=Gs,Wr[1]=$s,Wr[2]=qs.base,Wr[3]=1,Nh(Wr,Wr,rr),Wr[3]=Math.max(Wr[3],1e-5);const na=new Rc(Wr[0]/Wr[3],Wr[1]/Wr[3],Wr[2]/Wr[3]);Wr[0]=Gs,Wr[1]=$s,Wr[2]=qs.top,Wr[3]=1,Nh(Wr,Wr,rr),Wr[3]=Math.max(Wr[3],1e-5);const Sa=new Rc(Wr[0]/Wr[3],Wr[1]/Wr[3],Wr[2]/Wr[3]);hi.push(na),Ki.push(Sa)}Ii.push(hi),Vi.push(Ki)}return[Ii,Vi]}(Et,pt,Kt,Zt,fn,Ln,nn,gn,wn):function(Nn,an,Wn,$r,rr){const vr=[],Vn=[],qr=rr[8]*an,zi=rr[9]*an,Ii=rr[10]*an,Vi=rr[11]*an,Wr=rr[8]*Wn,ps=rr[9]*Wn,hi=rr[10]*Wn,Ki=rr[11]*Wn;for(const Mo of Nn){const Gs=[],$s=[];for(const qs of Mo){const na=qs.x+$r.x,Sa=qs.y+$r.y,Nl=rr[0]*na+rr[4]*Sa+rr[12],ws=rr[1]*na+rr[5]*Sa+rr[13],Ya=rr[2]*na+rr[6]*Sa+rr[14],la=rr[3]*na+rr[7]*Sa+rr[15],_o=Nl+qr,Js=ws+zi,cl=Ya+Ii,Ss=Math.max(la+Vi,1e-5),Ba=Nl+Wr,pu=ws+ps,kl=Ya+hi,Fl=Math.max(la+Ki,1e-5);Gs.push(new Rc(_o/Ss,Js/Ss,cl/Ss)),$s.push(new Rc(Ba/Fl,pu/Fl,kl/Fl))}vr.push(Gs),Vn.push($s)}return[vr,Vn]}(Et,pt,Kt,Zt,fn)),Ye=a.queryGeometry;var lt,Et,pt,Kt,Zt,fn,Ln,nn,gn,wn;return function(lt,Et,pt){let Kt=1/0;Py(pt,Et)&&(Kt=am(pt,Et[0]));for(let Zt=0;Zt<Et.length;Zt++){const fn=Et[Zt],Ln=lt[Zt];for(let nn=0;nn<fn.length-1;nn++){const gn=fn[nn],wn=[gn,fn[nn+1],Ln[nn+1],Ln[nn],gn];l0(pt,wn)&&(Kt=Math.min(Kt,am(pt,wn)))}}return Kt!==1/0&&Kt}(Qe,ft,Ye.isPointQuery()?Ye.screenBounds:Ye.screenGeometry)}},line:class extends Ic{constructor(a){super(a,t_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Eo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=Kf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new um(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new jc(this,a)}queryRadius(a){const o=a,u=A0(Hf("line-width",this,o),Hf("line-gap-width",this,o)),d=Hf("line-offset",this,o);return u/2+Math.abs(d)+kp(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,u,d,y,E){if(a.queryGeometry.isAboveHorizon)return!1;const S=$g(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),D=a.pixelToTileUnitsFactor/2*A0(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),O=this.paint.get("line-offset").evaluate(o,u);return O&&(d=function(N,V){const $=[],H=new Q(0,0);for(let J=0;J<N.length;J++){const ie=N[J],pe=[];for(let Ne=0;Ne<ie.length;Ne++){const Qe=ie[Ne-1],ft=ie[Ne],Ye=ie[Ne+1],lt=0===Ne?H:ft.sub(Qe)._unit()._perp(),Et=Ne===ie.length-1?H:Ye.sub(ft)._unit()._perp(),pt=lt._add(Et)._unit();pt._mult(1/(pt.x*Et.x+pt.y*Et.y)),pe.push(pt._mult(V)._add(ft))}$.push(pe)}return $}(d,O*a.pixelToTileUnitsFactor)),function(N,V,$){for(let H=0;H<V.length;H++){const J=V[H];if(N.length>=3)for(let ie=0;ie<J.length;ie++)if(fh(N,J[ie]))return!0;if(u0(N,J,$))return!0}return!1}(S,d,D)}isTileClipped(){return!0}},symbol:w_,background:class extends Ic{constructor(a){super(a,Bb)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ic{constructor(a){super(a,uI)}getProgramIds(){return["raster"]}},sky:class extends Ic{constructor(a){super(a,n1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const d=this.paint.get("sky-atmosphere-sun"),y=!d,E=a.style.light,S=E.properties.get("position");return y&&"viewport"===E.properties.get("anchor")&&Un("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),y?b_(S.azimuthal,90-S.polar,o):b_(d[0],90-d[1],o)}const u=this.paint.get("sky-gradient-center");return b_(u[0],90-u[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Mm{constructor(o,u,d,y){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(u,y)}update(o,u,d){const{width:y,height:E}=o,{context:S}=this,{gl:D}=S,{HTMLImageElement:O,HTMLCanvasElement:N,HTMLVideoElement:V,ImageData:$,ImageBitmap:H}=K;if(D.bindTexture(D.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!u||!1!==u.premultiply)),d||this.size&&this.size[0]===y&&this.size[1]===E){const{x:J,y:ie}=d||{x:0,y:0};o instanceof O||o instanceof N||o instanceof V||o instanceof $||H&&o instanceof H?D.texSubImage2D(D.TEXTURE_2D,0,J,ie,D.RGBA,D.UNSIGNED_BYTE,o):D.texSubImage2D(D.TEXTURE_2D,0,J,ie,y,E,D.RGBA,D.UNSIGNED_BYTE,o.data)}else this.size=[y,E],o instanceof O||o instanceof N||o instanceof V||o instanceof $||H&&o instanceof H?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,o):D.texImage2D(D.TEXTURE_2D,0,this.format,y,E,0,this.format,D.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&D.generateMipmap(D.TEXTURE_2D)}bind(o,u){const{context:d}=this,{gl:y}=d;y.bindTexture(y.TEXTURE_2D,this.texture),o!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,o),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?o===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_NEAREST:o),this.filter=o),u!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,u),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class cI{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class hI{constructor(){this.tasks={},this.taskQueue=[],pn(["process"],this),this.invoker=new cI(this.process),this.nextId=0}add(o,u){const d=this.nextId++,y=function({type:E,isSymbolTile:S,zoom:D}){return D=D||0,"message"===E?0:"maybePrepare"!==E||S?"parseTile"!==E||S?"parseTile"===E&&S?300-D:"maybePrepare"===E&&S?400-D:500:200-D:100-D}(u);if(0===y){Ei();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[d]={fn:o,metadata:u,priority:y,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){Ei();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const u=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let o=null,u=1/0;for(let y=0;y<this.taskQueue.length;y++){const E=this.tasks[this.taskQueue[y]];E.priority<u&&(u=E.priority,o=y)}if(null===o)return null;const d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class zb{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const d=o[u];this._stringToNumber[d]=u,this._numberToString[u]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const fI=["tile","layer","source","sourceLayer","state"];class Ub{constructor(o,u,d,y,E){this.type="Feature",this._vectorTileFeature=o,this._z=u,this._x=d,this._y=y,this.properties=o.properties,this.id=E}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const u of fI)void 0!==this[u]&&(o[u]=this[u]);return o}}const rd=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,u=0,d=0,y=0,E=0,S=0,D=0;for(1&o?y=E=S=32:u=d=D=32;(o>>=1)>1;){const N=u+y>>1,V=d+E>>1;1&o?(y=u,E=d,u=S,d=D):(u=y,d=E,y=S,E=D),S=N,D=V}const O=4*a;rd[O+0]=u,rd[O+1]=d,rd[O+2]=y,rd[O+3]=E}const Wh=new Uint16Array(2178),Bu=new Uint8Array(1089),np=new Uint16Array(1089);function r1(a){return 0===a?-.03125:32===a?.03125:0}var C_=Ir([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Dm={type:2,extent:Gt,loadGeometry:()=>[[new Q(0,0),new Q(8193,0),new Q(8193,8193),new Q(0,8193),new Q(0,0)]]};class Am{constructor(o,u,d,y,E){this.tileID=o,this.uid=xt(),this.uses=0,this.tileSize=u,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(o){const u=o+this.timeAdded;u<Vr.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ed(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,u,d){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(y,E){const S={};if(!E)return S;for(const D of y){const O=D.layerIds.map(N=>E.getLayer(N)).filter(Boolean);if(0!==O.length){D.layers=O,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(N=>O.filter(V=>V.id===N)[0]));for(const N of O)S[N.id]=D}}return S}(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const E=this.buckets[y];if(E instanceof yf){if(this.hasSymbolBuckets=!0,!d)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const E=this.buckets[y];if(E instanceof yf&&E.hasRTLText){this.hasRTLText=!0,It.isLoading()||It.isLoaded()||"deferred"!==Ct()||_t();break}}this.queryPadding=0;for(const y in this.buckets){const E=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(y).queryRadius(E))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new Gv}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const y=this.buckets[d];y.uploadPending()&&y.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mm(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mm(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mm(o,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,d,y,E,S,D,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:y,pixelPosMatrix:D,transform:S,params:E,tileTransform:this.tileTransform},o,u,d):{}}querySourceFeatures(o,u){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),E=u?u.sourceLayer:"",S=y._geojsonTileLayer||y[E];if(!S)return;const D=aa(u&&u.filter),{z:O,x:N,y:V}=this.tileID.canonical,$={z:O,x:N,y:V};for(let H=0;H<S.length;H++){const J=S.feature(H);if(D.needGeometry){const Ne=ff(J,!0);if(!D.filter(new jt(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!D.filter(new jt(this.tileID.overscaledZ),J))continue;const ie=d.getId(J,E),pe=new Ub(J,O,N,V,ie);pe.tile=$,o.push(pe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const d=Ai(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(u)if(this.expirationTime<u)y=!0;else{const E=this.expirationTime-u;E?this.expirationTime=d+Math.max(E,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!u)return;const d=this.latestFeatureIndex.loadVTLayers(),y=u.style.listImages();for(const E in this.buckets){if(!u.style.hasLayer(E))continue;const S=this.buckets[E],D=S.layers[0].sourceLayer||"_geojsonTileLayer",O=d[D],N=o[D];if(!O||!N||0===Object.keys(N).length)continue;if(S.update(N,O,y,this.imageAtlas&&this.imageAtlas.patternPositions||{}),S instanceof um||S instanceof $y){const $=u.style._getSourceCache(S.layers[0].source);u._terrain&&u._terrain.enabled&&$&&S.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile($.id,this.tileID)}const V=u&&u.style&&u.style.getLayer(E);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(S)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Vr.now()+o}setTexture(o,u){const d=u.context,y=d.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Mm(d,o,y.RGBA,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),d.extTextureFilterAnisotropic&&y.texParameterf(y.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax))}setDependencies(o,u){const d={};for(const y of u)d[y]=!0;this.dependencies[o]=d}hasDependency(o,u){for(const d of o){const y=this.dependencies[d];if(y)for(const E of u)if(y[E])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,u){if(!u||"mercator"===u.name||this._tileDebugBuffer)return;const d=kh(Dm,this.tileID.canonical,this.tileTransform)[0],y=new Br,E=new Ah;for(let S=0;S<d.length;S++){const{x:D,y:O}=d[S];y.emplaceBack(D,O),E.emplaceBack(S)}E.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(E),this._tileDebugBuffer=o.createVertexBuffer(y,Mp.members),this._tileDebugSegments=Xa.simpleSegment(0,0,y.length,E.length)}_makeTileBoundsBuffers(o,u){if(this._tileBoundsBuffer||!u||"mercator"===u.name)return;const d=kh(Dm,this.tileID.canonical,this.tileTransform)[0];let y,E;if(this.isRaster){const S=function(D,O){const N=ed(D,O),V=Math.pow(2,D.z);for(let Ne=0;Ne<33;Ne++)for(let Qe=0;Qe<33;Qe++){const ft=Fu((D.x+(Qe+r1(Qe))/32)/V),Ye=Ol((D.y+(Ne+r1(Ne))/32)/V),lt=O.project(ft,Ye),Et=33*Ne+Qe;Wh[2*Et+0]=Math.round((lt.x*N.scale-N.x)*Gt),Wh[2*Et+1]=Math.round((lt.y*N.scale-N.y)*Gt)}Bu.fill(0),np.fill(0);for(let Ne=2045;Ne>=0;Ne--){const Qe=4*Ne,ft=rd[Qe+0],Ye=rd[Qe+1],lt=rd[Qe+2],Et=rd[Qe+3],pt=ft+lt>>1,Kt=Ye+Et>>1,Zt=pt+Kt-Ye,fn=Kt+ft-pt,Ln=33*Ye+ft,nn=33*Et+lt,gn=33*Kt+pt,wn=Math.hypot((Wh[2*Ln+0]+Wh[2*nn+0])/2-Wh[2*gn+0],(Wh[2*Ln+1]+Wh[2*nn+1])/2-Wh[2*gn+1])>=16;if(Bu[gn]=Bu[gn]||(wn?1:0),Ne<1022){const In=33*(Ye+fn>>1)+(ft+Zt>>1),Nn=33*(Et+fn>>1)+(lt+Zt>>1);Bu[gn]=Bu[gn]||Bu[In]||Bu[Nn]}}const $=new rs,H=new Wa;let J=0;function ie(Ne,Qe){const ft=33*Qe+Ne;return 0===np[ft]&&($.emplaceBack(Wh[2*ft+0],Wh[2*ft+1],Ne*Gt/32,Qe*Gt/32),np[ft]=++J),np[ft]-1}function pe(Ne,Qe,ft,Ye,lt,Et){const pt=Ne+ft>>1,Kt=Qe+Ye>>1;if(Math.abs(Ne-lt)+Math.abs(Qe-Et)>1&&Bu[33*Kt+pt])pe(lt,Et,Ne,Qe,pt,Kt),pe(ft,Ye,lt,Et,pt,Kt);else{const Zt=ie(Ne,Qe),fn=ie(ft,Ye),Ln=ie(lt,Et);H.emplaceBack(Zt,fn,Ln)}}return pe(0,0,32,32,32,0),pe(32,32,0,0,0,32),{vertices:$,indices:H}}(this.tileID.canonical,u);y=S.vertices,E=S.indices}else{y=new rs,E=new Wa;for(const{x:D,y:O}of d)y.emplaceBack(D,O,0,0);const S=zp(y.int16,void 0,4);for(let D=0;D<S.length;D+=3)E.emplaceBack(S[D],S[D+1],S[D+2])}this._tileBoundsBuffer=o.createVertexBuffer(y,C_.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(E),this._tileBoundsSegments=Xa.simpleSegment(0,0,y.length,E.length)}_makeGlobeTileDebugBuffers(o,u){const d=u.projection;if(!d||"globe"!==d.name||u.freezeTileCoverage)return;const y=this.tileID.canonical,E=kd(r0(y,u)),S=Fd(u.zoom);let D;S>0&&(D=my(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,y,u,E,D,S),this._makeGlobeTileDebugTextBuffer(o,y,u,E,D,S)}_globePoint(o,u,d,y,E,S,D){let O=Nd(o,u,d);if(S){const N=1<<d.z,V=ch(y.center.lng),$=hh(y.center.lat),H=(d.x+.5)/N-V;let J=0;H>.5?J=-1:H<-.5&&(J=1);let ie=(o/Gt+d.x)/N+J,pe=(u/Gt+d.y)/N;ie=(ie-V)*y._pixelsPerMercatorPixel+V,pe=(pe-$)*y._pixelsPerMercatorPixel+$;const Ne=[ie*y.worldSize,pe*y.worldSize,0];Ca(Ne,Ne,S),O=Gf(O,Ne,D)}return Ca(O,O,E)}_makeGlobeTileDebugBorderBuffer(o,u,d,y,E,S){const D=new Br,O=new Ah,N=new ns,V=(H,J,ie,pe,Ne)=>{const Qe=(ie-H)/(Ne-1),ft=(pe-J)/(Ne-1),Ye=D.length;for(let lt=0;lt<Ne;lt++){const Et=H+lt*Qe,pt=J+lt*ft;D.emplaceBack(Et,pt);const Kt=this._globePoint(Et,pt,u,d,y,E,S);N.emplaceBack(Kt[0],Kt[1],Kt[2]),O.emplaceBack(Ye+lt)}},$=Gt;V(0,0,$,0,16),V($,0,$,$,16),V($,$,0,$,16),V(0,$,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(O),this._tileDebugBuffer=o.createVertexBuffer(D,Mp.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(N,qw.members),this._tileDebugSegments=Xa.simpleSegment(0,0,D.length,O.length)}_makeGlobeTileDebugTextBuffer(o,u,d,y,E,S){const D=new Br,O=new Wa,N=new ns,V=25;O.reserve(32),D.reserve(V),N.reserve(V);const $=(H,J)=>V*H+J;for(let H=0;H<V;H++){const J=2048*H;for(let ie=0;ie<V;ie++){const pe=2048*ie;D.emplaceBack(pe,J);const Ne=this._globePoint(pe,J,u,d,y,E,S);N.emplaceBack(Ne[0],Ne[1],Ne[2])}}for(let H=0;H<4;H++)for(let J=0;J<4;J++){const ie=$(H,J),pe=$(H,J+1),Ne=$(H+1,J),Qe=$(H+1,J+1);O.emplaceBack(ie,pe,Ne),O.emplaceBack(Ne,pe,Qe)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(O),this._tileDebugTextBuffer=o.createVertexBuffer(D,Mp.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(N,qw.members),this._tileDebugTextSegments=Xa.simpleSegment(0,0,V,32)}}class S_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,d){const y=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][y]=this.stateChanges[o][y]||{},Xe(this.stateChanges[o][y],d),null===this.deletedStates[o]){this.deletedStates[o]={};for(const E in this.state[o])E!==y&&(this.deletedStates[o][E]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][y]){this.deletedStates[o][y]={};for(const E in this.state[o][y])d[E]||(this.deletedStates[o][y][E]=null)}else for(const E in d)this.deletedStates[o]&&this.deletedStates[o][y]&&null===this.deletedStates[o][y][E]&&delete this.deletedStates[o][y][E]}removeFeatureState(o,u,d){if(null===this.deletedStates[o])return;const y=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&void 0!==u)null!==this.deletedStates[o][y]&&(this.deletedStates[o][y]=this.deletedStates[o][y]||{},this.deletedStates[o][y][d]=null);else if(void 0!==u)if(this.stateChanges[o]&&this.stateChanges[o][y])for(d in this.deletedStates[o][y]={},this.stateChanges[o][y])this.deletedStates[o][y][d]=null;else this.deletedStates[o][y]=null;else this.deletedStates[o]=null}getState(o,u){const d=String(u),y=Xe({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const E=this.deletedStates[o][u];if(null===E)return{};for(const S in E)delete y[S]}return y}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const E={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),Xe(this.state[y][S],this.stateChanges[y][S]),E[S]=this.state[y][S];d[y]=E}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const E={};if(null===this.deletedStates[y])for(const S in this.state[y])E[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(null===this.deletedStates[y][S])this.state[y][S]={};else if(this.state[y][S])for(const D of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][D];E[S]=this.state[y][S]}d[y]=d[y]||{},Xe(d[y],E)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const y in o)o[y].setFeatureState(d,u)}}class i1{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,u){const d=this.toIdx(o,u);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,u){return this.leaves[this.toIdx(o,u)]}toIdx(o,u){return u*this.size+o}}function Xh(a,o,u,d){let y=0,E=Number.MAX_VALUE;for(let S=0;S<3;S++)if(Math.abs(d[S])<1e-15){if(u[S]<a[S]||u[S]>o[S])return null}else{const D=1/d[S];let O=(a[S]-u[S])*D,N=(o[S]-u[S])*D;if(O>N){const V=O;O=N,N=V}if(O>y&&(y=O),N<E&&(E=N),y>E)return null}return y}function T_(a,o,u,d,y,E,S,D,O,N,V){const $=d-a,H=y-o,J=E-u,ie=S-a,pe=D-o,Ne=O-u,Qe=V[1]*Ne-V[2]*pe,ft=V[2]*ie-V[0]*Ne,Ye=V[0]*pe-V[1]*ie,lt=$*Qe+H*ft+J*Ye;if(Math.abs(lt)<1e-15)return null;const Et=1/lt,pt=N[0]-a,Kt=N[1]-o,Zt=N[2]-u,fn=(pt*Qe+Kt*ft+Zt*Ye)*Et;if(fn<0||fn>1)return null;const Ln=Kt*J-Zt*H,nn=Zt*$-pt*J,gn=pt*H-Kt*$,wn=(V[0]*Ln+V[1]*nn+V[2]*gn)*Et;return wn<0||fn+wn>1?null:(ie*Ln+pe*nn+Ne*gn)*Et}function o1(a,o,u){return(a-o)/(u-o)}function s1(a,o,u,d,y,E,S,D,O){const N=1<<u,V=E-d,$=S-y,H=(a+1)/N*V+d,J=(o+0)/N*$+y,ie=(o+1)/N*$+y;D[0]=(a+0)/N*V+d,D[1]=J,O[0]=H,O[1]=ie}class I_{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(E){const S=Math.ceil(Math.log2(E.dim/8)),D=[];let O=Math.ceil(Math.pow(2,S));const N=1/O,V=(J,ie,pe,Ne,Qe)=>{const ft=Ne?1:0,Ye=(J+1)*pe-ft,lt=ie*pe,Et=(ie+1)*pe-ft;Qe[0]=J*pe,Qe[1]=lt,Qe[2]=Ye,Qe[3]=Et};let $=new i1(O);const H=[];for(let J=0;J<O*O;J++){V(J%O,Math.floor(J/O),N,!1,H);const ie=_f(H[0],H[1],E),pe=_f(H[2],H[1],E),Ne=_f(H[2],H[3],E),Qe=_f(H[0],H[3],E);$.minimums.push(Math.min(ie,pe,Ne,Qe)),$.maximums.push(Math.max(ie,pe,Ne,Qe)),$.leaves.push(1)}for(D.push($),O/=2;O>=1;O/=2){const J=D[D.length-1];$=new i1(O);for(let ie=0;ie<O*O;ie++){V(ie%O,Math.floor(ie/O),2,!0,H);const pe=J.getElevation(H[0],H[1]),Ne=J.getElevation(H[2],H[1]),Qe=J.getElevation(H[2],H[3]),ft=J.getElevation(H[0],H[3]),Ye=J.isLeaf(H[0],H[1]),lt=J.isLeaf(H[2],H[1]),Et=J.isLeaf(H[2],H[3]),pt=J.isLeaf(H[0],H[3]),Kt=Math.min(pe.min,Ne.min,Qe.min,ft.min),Zt=Math.max(pe.max,Ne.max,Qe.max,ft.max),fn=Ye&&lt&&Et&&pt;$.maximums.push(Zt),$.minimums.push(Kt),$.leaves.push(Zt-Kt<=5&&fn?1:0)}D.push($)}return D}(this.dem),d=u.length-1,y=u[d];this._addNode(y.minimums[0],y.maximums[0],y.leaves[0]),this._construct(u,0,0,d,0)}raycastRoot(o,u,d,y,E,S,D=1){return Xh([o,u,-100],[d,y,this.maximums[0]*D],E,S)}raycast(o,u,d,y,E,S,D=1){if(!this.nodeCount)return null;const O=this.raycastRoot(o,u,d,y,E,S,D);if(null==O)return null;const N=[],V=[],$=[],H=[],J=[{idx:0,t:O,nodex:0,nodey:0,depth:0}];for(;J.length>0;){const{idx:ie,t:pe,nodex:Ne,nodey:Qe,depth:ft}=J.pop();if(this.leaves[ie]){s1(Ne,Qe,ft,o,u,d,y,$,H);const lt=1<<ft,Et=(Ne+0)/lt,pt=(Ne+1)/lt,Kt=(Qe+0)/lt,Zt=(Qe+1)/lt,fn=_f(Et,Kt,this.dem)*D,Ln=_f(pt,Kt,this.dem)*D,nn=_f(pt,Zt,this.dem)*D,gn=_f(Et,Zt,this.dem)*D,wn=T_($[0],$[1],fn,H[0],$[1],Ln,H[0],H[1],nn,E,S),In=T_(H[0],H[1],nn,$[0],H[1],gn,$[0],$[1],fn,E,S),Nn=Math.min(null!==wn?wn:Number.MAX_VALUE,null!==In?In:Number.MAX_VALUE);if(Nn!==Number.MAX_VALUE)return Nn;{const an=Ip([],E,S,pe);if(a1(fn,Ln,gn,nn,o1(an[0],$[0],H[0]),o1(an[1],$[1],H[1]))>=an[2])return pe}continue}let Ye=0;for(let lt=0;lt<this._siblingOffset.length;lt++){s1((Ne<<1)+this._siblingOffset[lt][0],(Qe<<1)+this._siblingOffset[lt][1],ft+1,o,u,d,y,$,H),$[2]=-100,H[2]=this.maximums[this.childOffsets[ie]+lt]*D;const Et=Xh($,H,E,S);if(null!=Et){const pt=Et;N[lt]=pt;let Kt=!1;for(let Zt=0;Zt<Ye&&!Kt;Zt++)pt>=N[V[Zt]]&&(V.splice(Zt,0,lt),Kt=!0);Kt||(V[Ye]=lt),Ye++}}for(let lt=0;lt<Ye;lt++){const Et=V[lt];J.push({idx:this.childOffsets[ie]+Et,t:N[Et],nodex:(Ne<<1)+this._siblingOffset[Et][0],nodey:(Qe<<1)+this._siblingOffset[Et][1],depth:ft+1})}}return null}_addNode(o,u,d){return this.minimums.push(o),this.maximums.push(u),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,u,d,y,E){if(1===o[y].isLeaf(u,d))return;this.childOffsets[E]||(this.childOffsets[E]=this.nodeCount);const S=y-1,D=o[S];let O=0,N=0;for(let V=0;V<this._siblingOffset.length;V++){const $=2*u+this._siblingOffset[V][0],H=2*d+this._siblingOffset[V][1],J=D.getElevation($,H),ie=D.isLeaf($,H),pe=this._addNode(J.min,J.max,ie);ie&&(O|=1<<V),N||(N=pe)}for(let V=0;V<this._siblingOffset.length;V++)O&1<<V||this._construct(o,2*u+this._siblingOffset[V][0],2*d+this._siblingOffset[V][1],S,N+V)}}function a1(a,o,u,d,y,E){return er(er(a,u,E),er(o,d,E),y)}function _f(a,o,u){const d=u.dim,y=Se(a*d-.5,0,d-1),E=Se(o*d-.5,0,d-1),S=Math.floor(y),D=Math.floor(E),O=Math.min(S+1,d-1),N=Math.min(D+1,d-1);return a1(u.get(S,D),u.get(O,D),u.get(S,N),u.get(O,N),y-S,E-D)}const Jp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Zh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,u,d,y=!1,E=!1){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return Un(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const S=this.dim=u.height-2,D=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=d||"mapbox",this.borderReady=y,!y){for(let O=0;O<S;O++)D[this._idx(-1,O)]=D[this._idx(0,O)],D[this._idx(S,O)]=D[this._idx(S-1,O)],D[this._idx(O,-1)]=D[this._idx(O,0)],D[this._idx(O,S)]=D[this._idx(O,S-1)];D[this._idx(-1,-1)]=D[this._idx(0,0)],D[this._idx(S,-1)]=D[this._idx(S-1,0)],D[this._idx(-1,S)]=D[this._idx(0,S-1)],D[this._idx(S,S)]=D[this._idx(S-1,S-1)],E&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new I_(this)}get(o,u,d=!1){d&&(o=Se(o,-1,this.dim),u=Se(u,-1,this.dim));const y=4*this._idx(o,u);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}static getUnpackVector(o){return Jp[o]}get unpackVector(){return Jp[this.encoding]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}_unpackMapbox(o,u,d){return(256*o*256+256*u+d)/10-1e4}_unpackTerrarium(o,u,d){return 256*o+u+d/256-32768}static pack(o,u){const d=[0,0,0,0],y=Zh.getUnpackVector(u);let E=Math.floor((o+y[3])/y[2]);return d[2]=E%256,E=Math.floor(E/256),d[1]=E%256,E=Math.floor(E/256),d[0]=E,d}getPixels(){return new Su({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,u,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,E=u*this.dim+this.dim,S=d*this.dim,D=d*this.dim+this.dim;switch(u){case-1:y=E-1;break;case 1:E=y+1}switch(d){case-1:S=D-1;break;case 1:D=S+1}const O=-u*this.dim,N=-d*this.dim;for(let V=S;V<D;V++)for(let $=y;$<E;$++){const H=4*this._idx($,V),J=4*this._idx($+O,V+N);this.pixels[H+0]=o.pixels[J+0],this.pixels[H+1]=o.pixels[J+1],this.pixels[H+2]=o.pixels[J+2],this.pixels[H+3]=o.pixels[J+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}vt(Zh,"DEMData"),vt(I_,"DemMinMaxQuadTree",{omit:["dem"]});class M_{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,d){const y=o.wrapped().key;void 0===this.data[y]&&(this.data[y]=[]);const E={value:u,timeout:void 0};if(void 0!==d&&(E.timeout=setTimeout(()=>{this.remove(o,E)},d)),this.data[y].push(E),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const d=o.wrapped().key,y=void 0===u?0:this.data[d].indexOf(u),E=this.data[d][y];return this.data[d].splice(y,1),E.timeout&&clearTimeout(E.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(E.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const d in this.data)for(const y of this.data[d])o(y.value)||u.push(y);for(const d of u)this.remove(d.value.tileID,d)}}class Xc{constructor(o,u,d){this.func=o,this.mask=u,this.range=d}}Xc.ReadOnly=!1,Xc.ReadWrite=!0,Xc.disabled=new Xc(519,Xc.ReadOnly,[0,1]);class rp{constructor(o,u,d,y,E,S){this.test=o,this.ref=u,this.mask=d,this.fail=y,this.depthFail=E,this.pass=S}}rp.disabled=new rp({func:519,mask:0},0,0,7680,7680,7680);class Zc{constructor(o,u,d){this.blendFunction=o,this.blendColor=u,this.mask=d}}Zc.Replace=[1,0],Zc.disabled=new Zc(Zc.Replace,sr.transparent,[!1,!1,!1,!1]),Zc.unblended=new Zc(Zc.Replace,sr.transparent,[!0,!0,!0,!0]),Zc.alphaBlended=new Zc([1,771],sr.transparent,[!0,!0,!0,!0]);class cc{constructor(o,u,d){this.enable=o,this.mode=u,this.frontFace=d}}cc.disabled=new cc(!1,1029,2305),cc.backCCW=new cc(!0,1029,2305),cc.backCW=new cc(!0,1029,2304),cc.frontCW=new cc(!0,1028,2304),cc.frontCCW=new cc(!0,1028,2305);class vf extends Xi{constructor(o,u,d){super(),this.id=o,this._onlySymbols=d,u.on("data",y=>{"source"===y.dataType&&"metadata"===y.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===y.dataType&&"content"===y.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new M_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new S_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const u=this._tiles[o];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const d=this._tiles[u];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return Tt(this._tiles).map(o=>o.tileID).sort(Rm).map(o=>o.key)}getRenderableIds(o){const u=[];for(const d in this._tiles)this._isIdRenderable(+d,o)&&u.push(this._tiles[d]);return o?u.sort((d,y)=>{const E=d.tileID,S=y.tileID,D=new Q(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),O=new Q(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-S.overscaledZ||O.y-D.y||O.x-D.x}).map(d=>d.tileID.key):u.map(d=>d.tileID).sort(Rm).map(d=>d.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,u){const d=this._tiles[o];d&&("loading"!==d.state&&(d.state=u),this._loadTile(d,this._tileLoaded.bind(this,d,o,u)))}_tileLoaded(o,u,d,y){if(y)if(o.state="errored",404!==y.status)this._source.fire(new Wi(y,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Vr.now(),"expired"===d&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Zr("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const u=this.getRenderableIds();for(let y=0;y<u.length;y++){const E=u[y];if(o.neighboringTiles&&o.neighboringTiles[E]){const S=this.getTileByID(E);d(o,S),d(S,o)}}function d(y,E){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=E.tileID.canonical.x-y.tileID.canonical.x;const D=E.tileID.canonical.y-y.tileID.canonical.y,O=Math.pow(2,y.tileID.canonical.z),N=E.tileID.key;0===S&&0===D||Math.abs(D)>1||(Math.abs(S)>1&&(1===Math.abs(S+O)?S+=O:1===Math.abs(S-O)&&(S-=O)),E.dem&&y.dem&&(y.dem.backfillBorder(E.dem,S,D),y.neighboringTiles&&y.neighboringTiles[N]&&(y.neighboringTiles[N].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,d,y){for(const E in this._tiles){let S=this._tiles[E];if(y[E]||!S.hasData()||S.tileID.overscaledZ<=u||S.tileID.overscaledZ>d)continue;let D=S.tileID;for(;S&&S.tileID.overscaledZ>u+1;){const N=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[N.key],S&&S.hasData()&&(D=N)}let O=D;for(;O.overscaledZ>u;)if(O=O.scaledTo(O.overscaledZ-1),o[O.key]){y[D.key]=D;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=u?d:null}for(let d=o.overscaledZ-1;d>=u;d--){const y=o.scaledTo(d),E=this._getLoadedTile(y);if(E)return E}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,u){u=u||this._source.tileSize;const d=Math.ceil(o.width/u)+1,y=Math.ceil(o.height/u)+1,E=Math.floor(d*y*5),S="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,E):E,D="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(D)}handleWrapJump(o){const u=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,u){const d={};for(const y in this._tiles){const E=this._tiles[y];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),d[E.tileID.key]=E}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(o,u,d){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let y;this.updateCacheSize(o,u),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new fu(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(y=o.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(y=y.filter(D=>this._source.hasTile(D)))):y=[];const E=this._updateRetainedTiles(y);if(l1(this._source.type)&&0!==y.length){const D={},O={},N=Object.keys(E);for(const $ of N){const H=E[$],J=this._tiles[$];if(!J||J.fadeEndTime&&J.fadeEndTime<=Vr.now())continue;const ie=this.findLoadedParent(H,Math.max(H.overscaledZ-vf.maxOverzooming,this._source.minzoom));ie&&(this._addTile(ie.tileID),D[ie.tileID.key]=ie.tileID),O[$]=H}const V=y[y.length-1].overscaledZ;for(const $ in this._tiles){const H=this._tiles[$];if(E[$]||!H.hasData())continue;let J=H.tileID;for(;J.overscaledZ>V;){J=J.scaledTo(J.overscaledZ-1);const ie=this._tiles[J.key];if(ie&&ie.hasData()&&O[J.key]){E[$]=H.tileID;break}}}for(const $ in D)E[$]||(this._coveredTiles[$]=!0,E[$]=D[$])}for(const D in E)this._tiles[D].clearFadeHold();const S=function(D,O){const N=[];for(const V in D)V in O||N.push(V);return N}(this._tiles,E);for(const D of S){const O=this._tiles[D];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const u={};if(0===o.length)return u;const d={},y=o.reduce((N,V)=>Math.min(N,V.overscaledZ),1/0),E=o[0].overscaledZ,S=Math.max(E-vf.maxOverzooming,this._source.minzoom),D=Math.max(E+vf.maxUnderzooming,this._source.minzoom),O={};for(const N of o){const V=this._addTile(N);u[N.key]=N,V.hasData()||y<this._source.maxzoom&&(O[N.key]=N)}this._retainLoadedChildren(O,y,D,u);for(const N of o){let V=this._tiles[N.key];if(V.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const H=N.children(this._source.maxzoom)[0],J=this.getTile(H);if(J&&J.hasData()){u[H.key]=H;continue}}else{const H=N.children(this._source.maxzoom);if(u[H[0].key]&&u[H[1].key]&&u[H[2].key]&&u[H[3].key])continue}let $=V.wasRequested();for(let H=N.overscaledZ-1;H>=S;--H){const J=N.scaledTo(H);if(d[J.key]||(d[J.key]=!0,V=this.getTile(J),!V&&$&&(V=this._addTile(J)),V&&(u[J.key]=J,$=V.wasRequested(),V.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let d,y=this._tiles[o].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}u.push(y.key);const E=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(E),d)break;y=E}for(const E of u)this._loadedParentTiles[E]=d}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const d=Boolean(u);if(!d){const y=this.map?this.map.painter:null;u=new Am(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,y,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))}return u?(u.uses++,this._tiles[o.key]=u,d||this._source.fire(new Zr("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=u.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,u,d){const y=[],E=this.transform;if(!E)return y;const S="globe"===E.projection.name,D=ch(E.center.lng);for(const O in this._tiles){const N=this._tiles[O];if(d&&N.clearQueryDebugViz(),N.holdingForFade())continue;let V;if(S){const $=N.tileID.canonical;if(0===$.z){const H=[Math.abs(Se(D,...Om($,-1))-D),Math.abs(Se(D,...Om($,1))-D)];V=[0,2*H.indexOf(Math.min(...H))-1]}else{const H=[Math.abs(Se(D,...Om($,-1))-D),Math.abs(Se(D,...Om($,0))-D),Math.abs(Se(D,...Om($,1))-D)];V=[H.indexOf(Math.min(...H))-1]}}else V=[0];for(const $ of V){const H=o.containsTile(N,E,u,$);H&&y.push(H)}}return y}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of u)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(l1(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=Vr.now())return!0}return!1}setFeatureState(o,u,d){this._state.updateState(o=o||"_geojsonTileLayer",u,d)}removeFeatureState(o,u,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,d)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,d){const y=this._tiles[o];y&&y.setDependencies(u,d)}reloadTilesForDependencies(o,u){for(const d in this._tiles)this._tiles[d].hasDependency(o,u)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(o,u))}_preloadTiles(o,u){const d=new Map,y=Array.isArray(o)?o:[o],E=this.map.painter.terrain,S=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const D of y){const O=D.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const N of O)d.set(N.key,N);this.usedForTerrain&&D.updateElevation(!1)}$e(Array.from(d.values()),(D,O)=>{const N=new Am(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(N,V=>{"raster-dem"===this._source.type&&N.dem&&this._backfillDEM(N),O(V,N)})},u)}}function Rm(a,o){const u=Math.abs(2*a.wrap)-+(a.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||d-u||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function l1(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Om(a,o){const u=1<<a.z;return[a.x/u+o,(a.x+1)/u+o]}vf.maxOverzooming=10,vf.maxUnderzooming=3;class Lm{constructor(o,u,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=u,this._offset=d}static create(o,u,d){const y=d||o.findDEMTileFor(u);if(!y||!y.dem)return;const E=y.dem,S=y.tileID,D=1<<u.canonical.z-S.canonical.z;return new Lm(y,y.tileSize/Gt/D,[(u.canonical.x/D-S.canonical.x)*E.dim,(u.canonical.y/D-S.canonical.y)*E.dim])}tileCoordToPixel(o,u){const d=u*this._scale+this._offset[1],y=Math.floor(o*this._scale+this._offset[0]),E=Math.floor(d);return new Q(y,E)}getElevationAt(o,u,d,y){const E=o*this._scale+this._offset[0],S=u*this._scale+this._offset[1],D=Math.floor(E),O=Math.floor(S),N=this._dem;return y=!!y,d?er(er(N.get(D,O,y),N.get(D,O+1,y),S-O),er(N.get(D+1,O,y),N.get(D+1,O+1,y),S-O),E-D):N.get(D,O,y)}getElevationAtPixel(o,u,d){return this._dem.get(o,u,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*lc(1,o)*this._dem.stride}}class D_{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new he(Gt,16,0),this.featureIndexArray=new Mg,this.promoteId=u}insert(o,u,d,y,E,S=0){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,y,E,S);const O=this.grid;for(let N=0;N<u.length;N++){const V=u[N],$=[1/0,1/0,-1/0,-1/0];for(let H=0;H<V.length;H++){const J=V[H];$[0]=Math.min($[0],J.x),$[1]=Math.min($[1],J.y),$[2]=Math.max($[2],J.x),$[3]=Math.max($[3],J.y)}$[0]<Gt&&$[1]<Gt&&$[2]>=0&&$[3]>=0&&O.insert(D,$[0],$[1],$[2],$[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wy(new gf(this.rawTileData)).layers,this.sourceLayerCoder=new zb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,u,d,y){this.loadVTLayers();const E=o.params||{},S=aa(E.filter),D=o.tileResult,O=o.transform,N=D.bufferedTilespaceBounds,V=this.grid.query(N.min.x,N.min.y,N.max.x,N.max.y,(ie,pe,Ne,Qe)=>f0(D.bufferedTilespaceGeometry,ie,pe,Ne,Qe));V.sort(c1);let $=null;O.elevation&&V.length>0&&($=Lm.create(O.elevation,this.tileID));const H={};let J;for(let ie=0;ie<V.length;ie++){const pe=V[ie];if(pe===J)continue;J=pe;const Ne=this.featureIndexArray.get(pe);let Qe=null;this.loadMatchingFeature(H,Ne,S,E.layers,E.availableImages,u,d,y,(ft,Ye,lt,Et=0)=>(Qe||(Qe=kh(ft,this.tileID.canonical,o.tileTransform)),Ye.queryIntersectsFeature(D,ft,lt,Qe,this.z,o.transform,o.pixelPosMatrix,$,Et)))}return H}loadMatchingFeature(o,u,d,y,E,S,D,O,N){const{featureIndex:V,bucketIndex:$,sourceLayerIndex:H,layoutVertexArrayOffset:J}=u,ie=this.bucketLayerIDs[$];if(y&&!function(ft,Ye){for(let lt=0;lt<ft.length;lt++)if(Ye.indexOf(ft[lt])>=0)return!0;return!1}(y,ie))return;const pe=this.sourceLayerCoder.decode(H),Ne=this.vtLayers[pe].feature(V);if(d.needGeometry){const ft=ff(Ne,!0);if(!d.filter(new jt(this.tileID.overscaledZ),ft,this.tileID.canonical))return}else if(!d.filter(new jt(this.tileID.overscaledZ),Ne))return;const Qe=this.getId(Ne,pe);for(let ft=0;ft<ie.length;ft++){const Ye=ie[ft];if(y&&y.indexOf(Ye)<0)continue;const lt=S[Ye];if(!lt)continue;let Et={};void 0!==Qe&&O&&(Et=O.getState(lt.sourceLayer||"_geojsonTileLayer",Qe));const pt=Xe({},D[Ye]);pt.paint=u1(pt.paint,lt.paint,Ne,Et,E),pt.layout=u1(pt.layout,lt.layout,Ne,Et,E);const Kt=!N||N(Ne,lt,Et,J);if(!Kt)continue;const Zt=new Ub(Ne,this.z,this.x,this.y,Qe);Zt.layer=pt;let fn=o[Ye];void 0===fn&&(fn=o[Ye]=[]),fn.push({featureIndex:V,feature:Zt,intersectionZ:Kt})}}lookupSymbolFeatures(o,u,d,y,E,S,D,O){const N={};this.loadVTLayers();const V=aa(E);for(const $ of o)this.loadMatchingFeature(N,{bucketIndex:d,sourceLayerIndex:y,featureIndex:$,layoutVertexArrayOffset:0},V,S,D,O,u);return N}loadFeature(o){const{featureIndex:u,sourceLayerIndex:d}=o;this.loadVTLayers();const y=this.sourceLayerCoder.decode(d),E=this.vtFeatures[y];if(E[u])return E[u];const S=this.vtLayers[y].feature(u);return E[u]=S,S}hasLayer(o){for(const u of this.bucketLayerIDs)for(const d of u)if(o===d)return!0;return!1}getId(o,u){let d=o.id;if(this.promoteId){const y="string"==typeof this.promoteId?this.promoteId:this.promoteId[u];null!=y&&(d=o.properties[y]),"boolean"==typeof d&&(d=Number(d))}return d}}function u1(a,o,u,d,y){return Sn(a,(E,S)=>{const D=o instanceof Ht?o.get(S):null;return D&&D.evaluate?D.evaluate(u,d,y):D})}function c1(a,o){return o-a}vt(D_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class A_{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.image=new dh({width:o,height:u}),this.positions={},this.uploaded=!1}getDash(o,u){const d=this.getKey(o,u);return this.positions[d]}trim(){const o=this.width,u=this.height=qt(this.nextRow);this.image.resize({width:o,height:u})}getKey(o,u){return o.join(",")+u}getDashRanges(o,u,d){const y=[];let E=o.length%2==1?-o[o.length-1]*d:0,S=o[0]*d,D=!0;y.push({left:E,right:S,isDash:D,zeroLength:0===o[0]});let O=o[0];for(let N=1;N<o.length;N++){D=!D;const V=o[N];E=O*d,O+=V,S=O*d,y.push({left:E,right:S,isDash:D,zeroLength:0===V})}return y}addRoundDash(o,u,d){const y=u/2;for(let E=-d;E<=d;E++){const S=this.width*(this.nextRow+d+E);let D=0,O=o[D];for(let N=0;N<this.width;N++){N/O.right>1&&(O=o[++D]);const V=Math.abs(N-O.left),$=Math.abs(N-O.right),H=Math.min(V,$);let J;const ie=E/d*(y+1);if(O.isDash){const pe=y-Math.abs(ie);J=Math.sqrt(H*H+pe*pe)}else J=y-Math.sqrt(H*H+ie*ie);this.image.data[S+N]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(o,u){for(let O=o.length-1;O>=0;--O){const N=o[O],V=o[O+1];N.zeroLength?o.splice(O,1):V&&V.isDash===N.isDash&&(V.left=N.left,o.splice(O,1))}const d=o[0],y=o[o.length-1];d.isDash===y.isDash&&(d.left=y.left-this.width,y.right=d.right+this.width);const E=this.width*this.nextRow;let S=0,D=o[S];for(let O=0;O<this.width;O++){O/D.right>1&&(D=o[++S]);const N=Math.abs(O-D.left),V=Math.abs(O-D.right),$=Math.min(N,V);this.image.data[E+O]=Math.max(0,Math.min(255,(D.isDash?$:-$)+u+128))}}addDash(o,u){const d=this.getKey(o,u);if(this.positions[d])return this.positions[d];const y="round"===u,E=y?7:0,S=2*E+1;if(this.nextRow+S>this.height)return Un("LineAtlas out of space"),null;0===o.length&&o.push(1);let D=0;for(let V=0;V<o.length;V++)o[V]<0&&(Un("Negative value is found in line dasharray, replacing values with 0"),o[V]=0),D+=o[V];if(0!==D){const V=this.width/D,$=this.getDashRanges(o,this.width,V);y?this.addRoundDash($,V,E):this.addRegularDash($,"square"===u?.5*V:0)}const O=this.nextRow+E;this.nextRow+=S;const N={tl:[O,E],br:[D,0]};return this.positions[d]=N,N}}vt(A_,"LineAtlas");class h1{constructor(o){const u={},d=[];for(const D in o){const O=o[D],N=u[D]={};for(const V in O.glyphs){const $=O.glyphs[+V];if(!$||0===$.bitmap.width||0===$.bitmap.height)continue;const H=$.metrics.localGlyph?2:1,J={x:0,y:0,w:$.bitmap.width+2*H,h:$.bitmap.height+2*H};d.push(J),N[V]=J}}const{w:y,h:E}=dm(d),S=new dh({width:y||1,height:E||1});for(const D in o){const O=o[D];for(const N in O.glyphs){const V=O.glyphs[+N];if(!V||0===V.bitmap.width||0===V.bitmap.height)continue;const $=u[D][N],H=V.metrics.localGlyph?2:1;dh.copy(V.bitmap,S,{x:0,y:0},{x:$.x+H,y:$.y+H},V.bitmap)}}this.image=S,this.positions=u}}vt(h1,"GlyphAtlas");class hc{constructor(o){this.tileID=new fu(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=ed(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,u,d,y,E){this.status="parsing",this.data=o,this.collisionBoxArray=new Gv;const S=new zb(Object.keys(o.layers).sort()),D=new D_(this.tileID,this.promoteId);D.bucketLayerIDs=[];const O={},N=new A_(256,256),V={featureIndex:D,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:N,availableImages:d},$=u.familiesBySource[this.source];for(const Et in $){const pt=o.layers[Et];if(!pt)continue;let Kt=!1,Zt=!1;for(const nn of $[Et])"symbol"===nn[0].type?Kt=!0:Zt=!0;if(!0===this.isSymbolTile&&!Kt||!1===this.isSymbolTile&&!Zt)continue;1===pt.version&&Un(`Vector tile source "${this.source}" layer "${Et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fn=S.encode(Et),Ln=[];for(let nn=0;nn<pt.length;nn++){const gn=pt.feature(nn),wn=D.getId(gn,Et);Ln.push({feature:gn,id:wn,index:nn,sourceLayerIndex:fn})}for(const nn of $[Et]){const gn=nn[0];void 0!==this.isSymbolTile&&"symbol"===gn.type!==this.isSymbolTile||gn.minzoom&&this.zoom<Math.floor(gn.minzoom)||gn.maxzoom&&this.zoom>=gn.maxzoom||"none"!==gn.visibility&&(Nm(nn,this.zoom,d),(O[gn.id]=gn.createBucket({index:D.bucketLayerIDs.length,layers:nn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:d})).populate(Ln,V,this.tileID.canonical,this.tileTransform),D.bucketLayerIDs.push(nn.map(wn=>wn.id)))}}let H,J,ie,pe;N.trim();const Ne={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Qe=Sn(V.glyphDependencies,Et=>Object.keys(Et).map(Number));Object.keys(Qe).length?y.send("getGlyphs",{uid:this.uid,stacks:Qe},(Et,pt)=>{H||(H=Et,J=pt,lt.call(this))},void 0,!1,Ne):J={};const ft=Object.keys(V.iconDependencies);ft.length?y.send("getImages",{icons:ft,source:this.source,tileID:this.tileID,type:"icons"},(Et,pt)=>{H||(H=Et,ie=pt,lt.call(this))},void 0,!1,Ne):ie={};const Ye=Object.keys(V.patternDependencies);function lt(){if(H)return E(H);if(J&&ie&&pe){const Et=new h1(J),pt=new s_(ie,pe);for(const Kt in O){const Zt=O[Kt];Zt instanceof yf?(Nm(Zt.layers,this.zoom,d),H0(Zt,J,Et.positions,ie,pt.iconPositions,this.showCollisionBoxes,d,this.tileID.canonical,this.tileZoom,this.projection)):Zt.hasPattern&&(Zt instanceof um||Zt instanceof $y||Zt instanceof rm)&&(Nm(Zt.layers,this.zoom,d),Zt.addFeatures(V,this.tileID.canonical,pt.patternPositions,d,this.tileTransform))}this.status="done",E(null,{buckets:Tt(O).filter(Kt=>!Kt.isEmpty()),featureIndex:D,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Et.image,lineAtlas:N,imageAtlas:pt,glyphMap:this.returnDependencies?J:null,iconMap:this.returnDependencies?ie:null,glyphPositions:this.returnDependencies?Et.positions:null})}}Ye.length?y.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"patterns"},(Et,pt)=>{H||(H=Et,pe=pt,lt.call(this))},void 0,!1,Ne):pe={},lt.call(this)}}function Nm(a,o,u){const d=new jt(o);for(const y of a)y.recalculate(d,u)}class f1{constructor(o){this.entries={},this.scheduler=o}request(o,u,d,y){const E=this.entries[o]=this.entries[o]||{callbacks:[]};if(E.result){const[S,D]=E.result;return this.scheduler?this.scheduler.add(()=>{y(S,D)},u):y(S,D),()=>{}}return E.callbacks.push(y),E.cancel||(E.cancel=d((S,D)=>{E.result=[S,D];for(const O of E.callbacks)this.scheduler?this.scheduler.add(()=>{O(S,D)},u):O(S,D);setTimeout(()=>delete this.entries[o],3e3)})),()=>{E.result||(E.callbacks=E.callbacks.filter(S=>S!==y),E.callbacks.length||(E.cancel(),delete this.entries[o]))}}}function Vb(a,o,u){const d=JSON.stringify(a.request);return a.data&&(this.deduped.entries[d]={result:[null,a.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},y=>{const E=li(a.request,(S,D,O,N)=>{S?y(S):D&&y(null,{vectorTile:u?void 0:new Wy(new gf(D)),rawData:D,cacheControl:O,expires:N})});return()=>{E.cancel(),y()}},o)}p.ARRAY_TYPE=bu,p.AUTH_ERR_MSG=Bs,p.Aabb=hu,p.Actor=class{constructor(a,o,u){this.target=a,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},pn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ei()?a:K,this.scheduler=new hI}send(a,o,u,d,y=!1,E){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=E,this.callbacks[S]=u);const D=zr(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:a,hasCallback:!!u,targetMapId:d,mustQueue:y,sourceMapId:this.mapId,data:qn(o,D)},D),{cancel:()=>{u&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const o=a.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(o.mustQueue||Ei()){const d=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add(()=>this.processTask(u,o),d&&d.metadata||{type:"message"})}else this.processTask(u,o)}processTask(a,o){if("<response>"===o.type){const u=this.callbacks[a];delete this.callbacks[a],u&&(o.error?u(hr(o.error)):u(null,hr(o.data)))}else{const u=zr(this.globalScope)?void 0:[],d=o.hasCallback?(E,S)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:E?qn(E):null,data:qn(S,u)},u)}:E=>{},y=hr(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,y,d);else if(this.parent.getWorkerSource){const E=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,E[0],y.source)[E[1]](y,d)}else d(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=om,p.Color=sr,p.ColorMode=Zc,p.CullFaceMode=cc,p.DEMData=Zh,p.DataConstantProperty=Vt,p.DedupedRequest=f1,p.DepthMode=Xc,p.EXTENT=Gt,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const u=o.getSource().maxzoom,d=1<<u,y=Math.floor(a.x),E=Math.floor((a.x-y)*d),S=Math.floor(a.y*d),D=this.findDEMTileFor(new fu(u,y,u,E,S));return!(!D||!D.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,u=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const d=this._source();if(!d||a.y<0||a.y>1)return o;const y=d.getSource().maxzoom,E=1<<y,S=Math.floor(a.x),D=a.x-S,O=new fu(y,S,y,Math.floor(D*E),Math.floor(a.y*E)),N=this.findDEMTileFor(O);if(!N||!N.dem)return o;const V=N.dem,$=1<<N.tileID.canonical.z,H=(D*$-N.tileID.canonical.x)*V.dim,J=(a.y*$-N.tileID.canonical.y)*V.dim,ie=Math.floor(H),pe=Math.floor(J);return(u?this.exaggeration():1)*er(er(V.get(ie,pe),V.get(ie,pe+1),J-pe),er(V.get(ie+1,pe),V.get(ie+1,pe+1),J-pe),H-ie)}getAtTileOffset(a,o,u){const d=1<<a.canonical.z;return this.getAtPointOrZero(new qf(a.wrap+(a.canonical.x+o/Gt)/d,(a.canonical.y+u/Gt)/d))}getAtTileOffsetFunc(a,o,u,d){return y=>{const E=this.getAtTileOffset(a,y.x,y.y),S=d.upVector(a.canonical,y.x,y.y);return Mc(S,S,E*d.upVectorScale(a.canonical,o,u).metersToTile),S}}getForTilePoints(a,o,u,d){if(this.isUsingMockSource())return!1;const y=Lm.create(this,a,d);return!!y&&(o.forEach(E=>{E[2]=this.exaggeration()*y.getElevationAt(E[0],E[1],u)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const u=o.dem.tree,d=o.tileID,y=1<<a.canonical.z-d.canonical.z;let E=a.canonical.x/y-d.canonical.x,S=a.canonical.y/y-d.canonical.y,D=0;for(let O=0;O<a.canonical.z-d.canonical.z&&!u.leaves[D];O++){E*=2,S*=2;const N=2*Math.floor(S)+Math.floor(E);D=u.childOffsets[D]+N,E%=1,S%=1}return{min:this.exaggeration()*u.minimums[D],max:this.exaggeration()*u.maximums[D]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,u){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Wi,p.EvaluationParameters=jt,p.Event=Zr,p.Evented=Xi,p.FillExtrusionBucket=rm,p.Frustum=zg,p.FrustumCorners=Dp,p.GLOBE_RADIUS=qc,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const u=new Br,d=new Wa,y=[],E=a+1+2,S=o[0]+1,D=o[0]+1+(1+o.length),O=(N,V,$)=>{let H=N===E-1?N-2:0===N?N:N-1;return H+=$?24575:0,[H,V]};for(let N=0;N<E;++N)u.emplaceBack(...O(N,0,!0));for(let N=0;N<S;++N)for(let V=0;V<E;++V)u.emplaceBack(...O(V,N,(0===V||V===E-1)&&!0));for(let N=0;N<o.length;++N){const V=o[N];for(let $=0;$<E;++$)u.emplaceBack(...O($,V,!0))}for(let N=0;N<o.length;++N){const V=d.length,$=o[N]+1+2,H=new Wa;for(let pe=0;pe<$-1;pe++){const Ne=pe===$-2,Qe=Ne?E*(D-o.length+N-pe):E;for(let ft=0;ft<E-1;ft++){const Ye=pe*E+ft;0===pe||Ne||0===ft||ft===E-2?(H.emplaceBack(Ye+1,Ye,Ye+Qe),H.emplaceBack(Ye+Qe,Ye+Qe+1,Ye+1)):(d.emplaceBack(Ye+1,Ye,Ye+Qe),d.emplaceBack(Ye+Qe,Ye+Qe+1,Ye+1))}}const J=Xa.simpleSegment(0,V,u.length,d.length-V);for(let pe=0;pe<H.uint16.length;pe+=3)d.emplaceBack(H.uint16[pe],H.uint16[pe+1],H.uint16[pe+2]);const ie=Xa.simpleSegment(0,V,u.length,d.length-V);y.push({withoutSkirts:J,withSkirts:ie})}return{vertices:u,indices:d,segments:y}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Ap);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Mp.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new Wa;for(let y=0;y<=64;y++)o.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const u=new sc,d=new sc;this._poleSegments=[];for(let y=0,E=0;y<5;y++){const S=360/(1<<y);u.emplaceBack(0,-qc,0,.5,0),d.emplaceBack(0,-qc,0,.5,1);for(let D=0;D<=64;D++){const O=D/64,N=er(0,S,O),[V,$,H]=ul(Sy,Ty,N,qc);u.emplaceBack(V,$,H,O,0),d.emplaceBack(V,$,H,O,1)}this._poleSegments.push(Xa.simpleSegment(E,0,66,64)),E+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(u,$w,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(d,$w,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const u=new Er,d=64,y=d+1+2,E=1;this._wireframeSegments=[];for(let S=0,D=0;S<Ap.length;S++){const O=Ap[S];for(let V=E;V<O+E;V++)for(let $=E;$<d+E;$++){const H=V*y+$;u.emplaceBack(H,H+1),u.emplaceBack(H,H+y),u.emplaceBack(H,H+y+1)}const N=O*d*3;this._wireframeSegments.push(Xa.simpleSegment(0,D,(O+1)*y,N)),D+=N}this._wireframeIndexBuffer=a.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=Qf,p.ImagePosition=L0,p.LivePerformanceUtils=dn,p.LngLat=fo,p.LngLatBounds=Oh,p.LocalGlyphMode=mm,p.MAX_MERCATOR_LATITUDE=Za,p.MercatorCoordinate=qf,p.ONE_EM=24,p.OverscaledTileID=fu,p.PerformanceMarkers=zt,p.Properties=Pn,p.RGBAImage=Su,p.Ray=Bg,p.RequestManager=class{constructor(a,o,u){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ae,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Li(a))return a;const u=Fr(a);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Li(a))return a;const u=Fr(a);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeSourceURL(a,o,u,d){if(!Li(a))return a;const y=Fr(a);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),u&&y.params.push(`language=${u}`),d&&y.params.push(`worldview=${d}`),this._makeAPIURL(y,this._customAccessToken||o)}normalizeSpriteURL(a,o,u,d){const y=Fr(a);return Li(a)?(y.path=`/styles/v1${y.path}/sprite${o}${u}`,this._makeAPIURL(y,this._customAccessToken||d)):(y.path+=`${o}${u}`,Ua(y))}normalizeTileURL(a,o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Li(a))return a;const d=Fr(a);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||u&&"raster"!==d.authority&&512===u?"@2x":""}${Fe.supported?".webp":"$1"}`),"raster"===d.authority?d.path=`/${Pe.RASTER_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${Pe.TILE_URL_VERSION}${d.path}`);const y=this._customAccessToken||function(E){for(const S of E){const D=S.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(d.params)||Pe.ACCESS_TOKEN;return Pe.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,y)}canonicalizeTileURL(a,o){const u=Fr(a);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return a;let d="mapbox://";u.path.match(/^\/raster\/v1\//)?d+=`raster/${u.path.replace(`/${Pe.RASTER_URL_PREFIX}/`,"")}`:d+=`tiles/${u.path.replace(`/${Pe.TILE_URL_VERSION}/`,"")}`;let y=u.params;return o&&(y=y.filter(E=>!E.match(/^access_token=/))),y.length&&(d+=`?${y.join("&")}`),d}canonicalizeTileset(a,o){const u=!!o&&Li(o),d=[];for(const y of a.tiles||[])ra(y)?d.push(this.canonicalizeTileURL(y,u)):d.push(y);return d}_makeAPIURL(a,o){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=Fr(Pe.API_URL);if(a.protocol=d.protocol,a.authority=d.authority,"http"===a.protocol){const y=a.params.indexOf("secure");y>=0&&a.params.splice(y,1)}if("/"!==d.path&&(a.path=`${d.path}${a.path}`),!Pe.REQUIRE_ACCESS_TOKEN)return Ua(a);if(o=o||Pe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return a.params=a.params.filter(y=>-1===y.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Ua(a)}},p.ResourceType=Xr,p.SegmentVector=Xa,p.SourceCache=vf,p.StencilMode=rp,p.StructArrayLayout1ui2=Ah,p.StructArrayLayout2f1f2i16=nl,p.StructArrayLayout2i4=Br,p.StructArrayLayout2ui4=Er,p.StructArrayLayout3f12=Ha,p.StructArrayLayout3ui6=Wa,p.StructArrayLayout4i8=rs,p.StructArrayLayout5f20=sc,p.Texture=Mm,p.Tile=Am,p.Transitionable=Bn,p.Uniform1f=wu,p.Uniform1i=class extends oh{constructor(a){super(a),this.current=0}set(a,o,u){this.fetchUniformLocation(a,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},p.Uniform2f=class extends oh{constructor(a){super(a),this.current=[0,0]}set(a,o,u){this.fetchUniformLocation(a,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},p.Uniform3f=class extends oh{constructor(a){super(a),this.current=[0,0,0]}set(a,o,u){this.fetchUniformLocation(a,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},p.Uniform4f=Pg,p.UniformColor=Vf,p.UniformMatrix2f=class extends oh{constructor(a){super(a),this.current=Bw}set(a,o,u){if(this.fetchUniformLocation(a,o))for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}},p.UniformMatrix3f=class extends oh{constructor(a){super(a),this.current=Wv}set(a,o,u){if(this.fetchUniformLocation(a,o))for(let d=0;d<9;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}},p.UniformMatrix4f=class extends oh{constructor(a){super(a),this.current=WT}set(a,o,u){if(this.fetchUniformLocation(a,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},p.UnwrappedTileID=sm,p.ValidationError=tr,p.VectorTileFeature=Gd,p.VectorTileWorkerSource=class extends Xi{constructor(a,o,u,d,y){super(),this.actor=a,this.layerIndex=o,this.availableImages=u,this.loadVectorData=y||Vb,this.loading={},this.loaded={},this.deduped=new f1(a.scheduler),this.isSpriteLoaded=d,this.scheduler=a.scheduler}loadTile(a,o){const u=a.uid,d=a&&a.request,y=d&&d.collectResourceTiming,E=this.loading[u]=new hc(a);E.abort=this.loadVectorData(a,(S,D)=>{const O=!this.loading[u];if(delete this.loading[u],O||S||!D)return E.status="done",O||(this.loaded[u]=E),o(S);const N=D.rawData,V={};D.expires&&(V.expires=D.expires),D.cacheControl&&(V.cacheControl=D.cacheControl),E.vectorTile=D.vectorTile||new Wy(new gf(N));const $=()=>{E.parse(E.vectorTile,this.layerIndex,this.availableImages,this.actor,(H,J)=>{if(H||!J)return o(H);const ie={};if(y){const pe=yr(d);pe.length>0&&(ie.resourceTiming=JSON.parse(JSON.stringify(pe)))}o(null,Xe({rawTileData:N.slice(0)},J,V,ie))})};this.isSpriteLoaded?$():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add($,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):$()}),this.loaded=this.loaded||{},this.loaded[u]=E})}reloadTile(a,o){const u=this.loaded,d=a.uid,y=this;if(u&&u[d]){const E=u[d];E.showCollisionBoxes=a.showCollisionBoxes,E.enableTerrain=!!a.enableTerrain,E.projection=a.projection,E.tileTransform=ed(a.tileID.canonical,a.projection);const S=(D,O)=>{const N=E.reloadCallback;N&&(delete E.reloadCallback,E.parse(E.vectorTile,y.layerIndex,this.availableImages,y.actor,N)),o(D,O)};"parsing"===E.status?E.reloadCallback=S:"done"===E.status&&(E.vectorTile?E.parse(E.vectorTile,this.layerIndex,this.availableImages,this.actor,S):S())}}abortTile(a,o){const u=a.uid,d=this.loading[u];d&&(d.abort&&d.abort(),delete this.loading[u]),o()}removeTile(a,o){const u=this.loaded,d=a.uid;u&&u[d]&&delete u[d],o()}},p.WritingMode=uc,p.ZoomDependentExpression=qu,p.add=ac,p.addDynamicAttributes=tp,p.adjoint=function(a,o){var u=o[0],d=o[1],y=o[2],E=o[3],S=o[4],D=o[5],O=o[6],N=o[7],V=o[8];return a[0]=S*V-D*N,a[1]=y*N-d*V,a[2]=d*D-y*S,a[3]=D*O-E*V,a[4]=u*V-y*O,a[5]=y*E-u*D,a[6]=E*N-S*O,a[7]=d*O-u*N,a[8]=u*S-d*E,a},p.asyncAll=$e,p.bezier=je,p.bindAll=pn,p.boundsAttributes=C_,p.bufferConvexPolygon=function(a,o){const u=[];for(let d=0;d<a.length;d++){const y=Bt(d-1,-1,a.length-1),E=Bt(d+1,-1,a.length-1),S=a[d],D=a[E],O=a[y].sub(S).unit(),N=D.sub(S).unit(),V=N.angleWithSep(O.x,O.y),$=O.add(N).unit().mult(-1*o/Math.sin(V/2));u.push(S.add($))}return u},p.cacheEntryPossiblyAdded=function(a){kr++,kr>Jt&&(a.getActor().send("enforceCacheSizeLimit",St),kr=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:u,y:d}=a.point,y=by(u,d,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Lh(y,y,wy(Hc(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:u}=a.point,{lng:d,lat:y}=a._center;return by(o,u,a.worldSize,d,y)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,u=o/lc(1,a.center.lat),d=Gc(new Float64Array(16));return ah(d,d,[a.point.x,a.point.y,0]),hf(d,d,[u,u,o]),Float32Array.from(d)},p.circumferenceAtLatitude=$f,p.clamp=Se,p.clearTileCache=function(a){if(!En())return;const o=K.caches.delete(De);a&&o.catch(a).then(()=>a())},p.clipLine=h_,p.clone=function(a){var o=new bu(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=Kn,p.collisionCircleLayout=xb,p.config=Pe,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new bu(16);return bu!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=Dd,p.createExpression=ll,p.createLayout=Ir,p.createStyleLayer=function(a){return"custom"===a.type?new t1(a):new E_[a.type](a)},p.cross=Rd,p.degToRad=le,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,u){return a[0]=o[0]/u[0],a[1]=o[1]/u[1],a[2]=o[2]/u[2],a},p.dot=Dc,p.earthRadius=Op,p.ease=We,p.easeCubicInOut=ct,p.ecefToLatLng=function([a,o,u]){const d=Math.hypot(a,o,u),y=Math.atan2(a,u),E=.5*Math.PI-Math.acos(-o/d);return new fo(me(y),me(E))},p.emitValidationErrors=q,p.endsWith=At,p.enforceCacheSizeLimit=function(a){vn(),Me&&Me.then(o=>{o.keys().then(u=>{for(let d=0;d<u.length-a;d++)o.delete(u[d])})})},p.evaluateSizeForFeature=ph,p.evaluateSizeForZoom=qd,p.evaluateVariableOffset=q0,p.evented=ot,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=Vr,p.exported$1=Fe,p.extend=Xe,p.extend$1=ca,p.fillExtrusionHeightLift=I0,p.filterObject=Yn,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var u=o[0],d=o[1],y=o[2],E=o[3],S=u+u,D=d+d,O=y+y,N=u*S,V=d*S,$=d*D,H=y*S,J=y*D,ie=y*O,pe=E*S,Ne=E*D,Qe=E*O;return a[0]=1-$-ie,a[1]=V+Qe,a[2]=H-Ne,a[3]=0,a[4]=V-Qe,a[5]=1-N-ie,a[6]=J+pe,a[7]=0,a[8]=H+Ne,a[9]=J-pe,a[10]=1-N-$,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var u=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=u,a[2]=0,a[3]=-u,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=yy,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return ne[o]},p.getAABBPointSquareDist=function(a,o,u){let d=0;for(let y=0;y<2;++y){const E=u?u[y]:0;a[y]>E&&(d+=(a[y]-E)*(a[y]-E)),o[y]<E&&(d+=(E-o[y])*(E-o[y]))}return d},p.getAnchorAlignment=pm,p.getAnchorJustification=Qd,p.getBounds=function(a){let o=1/0,u=1/0,d=-1/0,y=-1/0;for(const E of a)o=Math.min(o,E.x),u=Math.min(u,E.y),d=Math.max(d,E.x),y=Math.max(y,E.y);return{min:new Q(o,u),max:new Q(d,y)}},p.getColumn=Le,p.getGridMatrix=function(a,o,u,d){const y=o.getNorth(),E=o.getSouth(),S=o.getWest(),D=o.getEast(),O=1<<a.z,N=D-S,V=y-E,$=N/64,H=-V/Ap[u],J=[0,$,0,H,0,0,y,S,0];if(a.z>0){const ie=180/d;Zv(J,J,[ie/N+1,0,0,0,ie/V+1,0,-.5*ie/$,.5*ie/H,1])}return J[2]=O,J[5]=a.x,J[8]=a.y,J},p.getImage=wo,p.getJSON=function(a,o){return Hi(Xe(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=Za-5;a=Se(a,-o,o)/o*90;const u=Math.pow(Math.abs(Math.sin(le(a))),3);return Math.round(u*(Ap.length-1))},p.getMapSessionAPI=Pt,p.getPerformanceMeasurement=yr,p.getProjection=m_,p.getRTLTextPluginStatus=Ct,p.getReferrer=ri,p.getTilePoint=function(a,{x:o,y:u},d=0){return new Q(((o-d)*a.scale-a.x)*Gt,(u*a.scale-a.y)*Gt)},p.getTileVec3=function(a,o,u=0){return $c(((o.x-u)*a.scale-a.x)*Gt,(o.y*a.scale-a.y)*Gt,Ww(o.z,o.y))},p.getVideo=function(a,o){const u=K.document.createElement("video");u.muted=!0,u.onloadstart=function(){o(null,u)};for(let d=0;d<a.length;d++){const y=K.document.createElement("source");gi(a[d])||(u.crossOrigin="Anonymous"),y.src=a[d],u.appendChild(y)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],u=Gc(new Float64Array(16));return Lh(u,a.pixelMatrix,a.globeMatrix),Ca(o,o,u),new Q(o[0],o[1])},p.globeDenormalizeECEF=wy,p.globeECEFOrigin=function(a,o){const u=[0,0,0];return Ca(u,u,kd(Hc(o.canonical))),Ca(u,u,a),u},p.globeMetersToEcef=Ld,p.globeNormalizeECEF=kd,p.globePixelsToTileUnits=function(a,o){return Gt/(512*Math.pow(2,a))*Ug(Hc(o))},p.globePoleMatrixForTile=function(a,o,u){const d=Gc(new Float64Array(16)),y=(o/(1<<a)-.5)*Math.PI*2;return Lg(d,u.globeMatrix,y),Float32Array.from(d)},p.globeTileBounds=Hc,p.globeTiltAtLngLat=Ey,p.globeToMercatorTransition=Fd,p.globeUseCustomAntiAliasing=function(a,o,u){const d=Fd(u.zoom),y=a.style.map._antialias,E=!!o.extStandardDerivatives,S=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===d&&!y&&!S&&E},p.identity=Gc,p.identity$1=jw,p.invert=my,p.isFullscreen=function(){return!!K.document.fullscreenElement||!!K.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Cy,p.isMapAuthenticated=function(a){return ht.has(a)},p.isMapboxURL=Li,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!zr(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Ol,p.latLngToECEF=uh,p.len=XT,p.length=Sp,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=Fu,p.loadVectorTile=Vb,p.makeRequest=Hi,p.mapValue=function(a,o,u,d,y){return Se((a-o)/(u-o)*(y-d)+d,d,y)},p.mercatorScale=Vg,p.mercatorXfromLng=ch,p.mercatorYfromLat=hh,p.mercatorZfromAltitude=lc,p.mul=Ng,p.mul$1=Jv,p.multiply=Lh,p.multiply$1=Zv,p.multiply$2=Uw,p.nextPowerOfTwo=qt,p.normalize=Eu,p.normalize$1=ZT,p.normalize$2=e0,p.number=er,p.ortho=function(a,o,u,d,y,E,S){var D=1/(o-u),O=1/(d-y),N=1/(E-S);return a[0]=-2*D,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*O,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*N,a[11]=0,a[12]=(o+u)*D,a[13]=(y+d)*O,a[14]=(S+E)*N,a[15]=1,a},p.pbf=gf,p.perspective=function(a,o,u,d,y){var E,S=1/Math.tan(o/2);return a[0]=S/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=y&&y!==1/0?(a[10]=(y+d)*(E=1/(d-y)),a[14]=2*y*d*E):(a[10]=-1,a[14]=-2*d),a},p.pick=function(a,o){const u={};for(let d=0;d<o.length;d++){const y=o[d];y in a&&(u[y]=a[y])}return u},p.plugin=It,p.pointGeometry=Q,p.polesInViewport=function(a){const o=Gc(new Float64Array(16));Lh(o,a.pixelMatrix,a.globeMatrix);const u=[0,Ac,0],d=[0,Pc,0];return Ca(u,u,o),Ca(d,d,o),[u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!Cy(a,new fo(a.center.lat,90)),d[0]>0&&d[0]<=a.width&&d[1]>0&&d[1]<=a.height&&!Cy(a,new fo(a.center.lat,-90))]},p.polygonContainsPoint=fh,p.polygonIntersectsBox=f0,p.polygonIntersectsPolygon=l0,p.polygonizeBounds=function(a,o,u=0,d=!0){const y=new Q(u,u),E=a.sub(y),S=o.add(y),D=[E,new Q(S.x,E.y),S,new Q(E.x,S.y)];return d&&D.push(E.clone()),D},p.posAttributes=Mp,p.postMapLoadEvent=ze,p.postPerformanceEvent=yt,p.postTurnstileEvent=ce,p.potpack=dm,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=me,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:qe,pluginURL:Ie}),ot.on("pluginStateChange",a),a},p.removeAuthState=function(a){ht.delete(a)},p.renderColorRamp=Bp,p.resample=jg,p.rotateX=jf,p.rotateX$1=Fg,p.rotateY=Lg,p.rotateY$1=Gw,p.rotateZ=function(a,o,u){var d=Math.sin(u),y=Math.cos(u),E=o[0],S=o[1],D=o[2],O=o[3],N=o[4],V=o[5],$=o[6],H=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=E*y+N*d,a[1]=S*y+V*d,a[2]=D*y+$*d,a[3]=O*y+H*d,a[4]=N*y-E*d,a[5]=V*y-S*d,a[6]=$*y-D*d,a[7]=H*y-O*d,a},p.rotateZ$1=function(a,o,u){u*=.5;var d=o[0],y=o[1],E=o[2],S=o[3],D=Math.sin(u),O=Math.cos(u);return a[0]=d*O+y*D,a[1]=y*O-d*D,a[2]=E*O+S*D,a[3]=S*O-E*D,a},p.scale=hf,p.scale$1=Qv,p.scale$2=Mc,p.scaleAndAdd=Ip,p.set=function(a,o,u,d){return a[0]=o,a[1]=u,a[2]=d,a},p.setCacheLimits=function(a,o){St=a,Jt=o},p.setColumn=function(a,o,u){a[4*o+0]=u[0],a[4*o+1]=u[1],a[4*o+2]=u[2],a[4*o+3]=u[3]},p.setRTLTextPlugin=function(a,o,u=!1){if(qe===Ae||qe===Ve||qe===Ue)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ie=Vr.resolveURL(a),qe=Ae,Ge=o,Je(),u||_t()},p.smoothstep=ln,p.spec=Yt,p.squaredLength=function(a){var o=a[0],u=a[1],d=a[2];return o*o+u*u+d*d},p.storeAuthState=function(a,o){o?ht.add(a):ht.delete(a)},p.sub=lh,p.subtract=_y,p.symbolSize=Hd,p.tileAABB=function(a,o,u,d,y,E,S,D,O){if("globe"===O.name)return function xy(a,o,u){const d=o/a.worldSize,y=a.globeMatrix;if(u.z<=1){const Zt=Hc(u).getCorners();return Cu(Zt,y,d),hu.fromPoints(Zt)}const E=Pp(u),S=Rp(E);Cu(S,y,d);const D=Number.MAX_VALUE,O=[-D,-D,-D],N=[D,D,D];if(E.contains(a.center)){for(const Ln of S)Pd(N,N,Ln),Tp(O,O,Ln);O[2]=0;const Zt=a.point,fn=[Zt.x*d,Zt.y*d,0];return Pd(N,N,fn),Tp(O,O,fn),new hu(N,O)}const V=[y[12]*d,y[13]*d,y[14]*d],$=E.getCenter(),H=Se(a.center.lat,-Za,Za),J=Se($.lat,-Za,Za),ie=ch(a.center.lng),pe=hh(H);let Ne=ie-ch($.lng);const Qe=pe-hh(J);Ne>.5?Ne-=1:Ne<-.5&&(Ne+=1);let ft=0;Math.abs(Ne)>Math.abs(Qe)?ft=Ne>=0?1:3:(ft=Qe>=0?0:2,Ip(V,V,[y[4]*d,y[5]*d,y[6]*d],-Math.sin(le(Qe>=0?E.getSouth():E.getNorth()))*qc));const Ye=S[ft],lt=S[(ft+1)%4],Et=new Hw(Ye,lt,V),pt=[vy(Et,0)||Ye[0],vy(Et,1)||Ye[1],vy(Et,2)||Ye[2]],Kt=Fd(a.zoom);if(Kt>0){const Zt=function({x:Ln,y:nn,z:gn},wn,In,Nn,an){const Wn=1/(1<<gn);let $r=Ln*Wn,rr=$r+Wn,vr=nn*Wn,Vn=vr+Wn,qr=0;const zi=($r+rr)/2-Nn;return zi>.5?qr=-1:zi<-.5&&(qr=1),$r=(($r+qr)*wn-(Nn*=wn))*In+Nn,rr=((rr+qr)*wn-Nn)*In+Nn,vr=(vr*wn-(an*=wn))*In+an,Vn=(Vn*wn-an)*In+an,[[$r,Vn,0],[rr,Vn,0],[rr,vr,0],[$r,vr,0]]}(u,o,a._pixelsPerMercatorPixel,ie,pe);for(let Ln=0;Ln<S.length;Ln++)Gf(S[Ln],Zt[Ln],Kt);const fn=ac([],Zt[ft],Zt[(ft+1)%4]);Mc(fn,fn,.5),Gf(pt,fn,Kt)}for(const Zt of S)Pd(N,N,Zt),Tp(O,O,Zt);return N[2]=Math.min(Ye[2],lt[2]),Pd(N,N,pt),Tp(O,O,pt),new hu(N,O)}(a,o,new om(u,d,y));const N=ed({z:u,x:d,y},O);return new hu([(E+N.x/N.scale)*o,o*(N.y/N.scale),S],[(E+N.x2/N.scale)*o,o*(N.y2/N.scale),D])},p.tileCornersToBounds=Pp,p.tileTransform=ed,p.transformMat3=function(a,o,u){var d=o[0],y=o[1],E=o[2];return a[0]=d*u[0]+y*u[3]+E*u[6],a[1]=d*u[1]+y*u[4]+E*u[7],a[2]=d*u[2]+y*u[5]+E*u[8],a},p.transformMat4=Ca,p.transformMat4$1=Nh,p.transformQuat=Kv,p.transitionTileAABBinECEF=r0,p.translate=ah,p.transpose=function(a,o){if(a===o){var u=o[1],d=o[2],y=o[5];a[1]=o[3],a[2]=o[6],a[3]=u,a[5]=o[7],a[6]=d,a[7]=y}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=tt,p.uniqueId=xt,p.updateGlobeVertexNormal=function(a,o,u,d,y){const E=5*o+2;a.float32[E+0]=u,a.float32[E+1]=d,a.float32[E+2]=y},p.validateCustomStyleLayer=function(a){const o=[],u=a.id;return void 0===u&&o.push({message:`layers.${u}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${u}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>U(rc(a)),p.validateFog=a=>U(uf(a)),p.validateLayer=a=>U(Lu(a)),p.validateLight=a=>U(yl(a)),p.validateSource=a=>U(si(a)),p.validateStyle=_,p.validateTerrain=a=>U(Oi(a)),p.values=Tt,p.vectorTile=Up,p.version=ge,p.warnOnce=Un,p.window=K,p.wrap=Bt}),ye(0,function(p){function K(Ze){if("number"==typeof Ze||"boolean"==typeof Ze||"string"==typeof Ze||null==Ze)return JSON.stringify(Ze);if(Array.isArray(Ze)){let be="[";for(const ze of Ze)be+=`${K(ze)},`;return`${be}]`}let ce="{";for(const be of Object.keys(Ze).sort())ce+=`${be}:${K(Ze[be])},`;return`${ce}}`}function ge(Ze){let ce="";for(const be of p.refProperties)ce+=`/${K(Ze[be])}`;return ce}class Te{constructor(ce){this.keyCache={},ce&&this.replace(ce)}replace(ce){this._layerConfigs={},this._layers={},this.update(ce,[])}update(ce,be){for(const et of ce)this._layerConfigs[et.id]=et,(this._layers[et.id]=p.createStyleLayer(et)).compileFilter(),this.keyCache[et.id]&&delete this.keyCache[et.id];for(const et of be)delete this.keyCache[et],delete this._layerConfigs[et],delete this._layers[et];this.familiesBySource={};const ze=function(et,yt){const Ut={};for(let ht=0;ht<et.length;ht++){const zt=yt&&yt[et[ht].id]||ge(et[ht]);yt&&(yt[et[ht].id]=zt);let dn=Ut[zt];dn||(dn=Ut[zt]=[]),dn.push(et[ht])}const Pt=[];for(const ht in Ut)Pt.push(Ut[ht]);return Pt}(p.values(this._layerConfigs),this.keyCache);for(const et of ze){const yt=et.map(Fn=>this._layers[Fn.id]),Ut=yt[0];if("none"===Ut.visibility)continue;const Pt=Ut.source||"";let ht=this.familiesBySource[Pt];ht||(ht=this.familiesBySource[Pt]={});const zt=Ut.sourceLayer||"_geojsonTileLayer";let dn=ht[zt];dn||(dn=ht[zt]=[]),dn.push(yt)}}}class Pe{loadTile(ce,be){const{uid:ze,encoding:et,rawImageData:yt,padding:Ut,buildQuadTree:Pt}=ce,ht=p.window.ImageBitmap&&yt instanceof p.window.ImageBitmap?this.getImageData(yt,Ut):yt;be(null,new p.DEMData(ze,ht,et,Ut<1,Pt))}getImageData(ce,be){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ce.width,ce.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ce.width,this.offscreenCanvas.height=ce.height,this.offscreenCanvasContext.drawImage(ce,0,0,ce.width,ce.height);const ze=this.offscreenCanvasContext.getImageData(-be,-be,ce.width+2*be,ce.height+2*be);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ze}}var Fe=function Ze(ce,be){var ze,et=ce&&ce.type;if("FeatureCollection"===et)for(ze=0;ze<ce.features.length;ze++)Ze(ce.features[ze],be);else if("GeometryCollection"===et)for(ze=0;ze<ce.geometries.length;ze++)Ze(ce.geometries[ze],be);else if("Feature"===et)Ze(ce.geometry,be);else if("Polygon"===et)bt(ce.coordinates,be);else if("MultiPolygon"===et)for(ze=0;ze<ce.coordinates.length;ze++)bt(ce.coordinates[ze],be);return ce};function bt(Ze,ce){if(0!==Ze.length){nt(Ze[0],ce);for(var be=1;be<Ze.length;be++)nt(Ze[be],!ce)}}function nt(Ze,ce){for(var be=0,ze=0,et=0,yt=Ze.length,Ut=yt-1;et<yt;Ut=et++){var Pt=(Ze[et][0]-Ze[Ut][0])*(Ze[Ut][1]+Ze[et][1]),ht=be+Pt;ze+=Math.abs(be)>=Math.abs(Pt)?be-ht+Pt:Pt-ht+be,be=ht}be+ze>=0!=!!ce&&Ze.reverse()}const He=p.VectorTileFeature.prototype.toGeoJSON;class dt{constructor(ce){this._feature=ce,this.extent=p.EXTENT,this.type=ce.type,this.properties=ce.tags,"id"in ce&&!isNaN(ce.id)&&(this.id=parseInt(ce.id,10))}loadGeometry(){if(1===this._feature.type){const ce=[];for(const be of this._feature.geometry)ce.push([new p.pointGeometry(be[0],be[1])]);return ce}{const ce=[];for(const be of this._feature.geometry){const ze=[];for(const et of be)ze.push(new p.pointGeometry(et[0],et[1]));ce.push(ze)}return ce}}toGeoJSON(ce,be,ze){return He.call(this,ce,be,ze)}}class Rt{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=ce.length,this._features=ce}feature(ce){return new dt(this._features[ce])}}var ae={},X={get exports(){return ae},set exports(Ze){ae=Ze}},re=p.pointGeometry,Q=p.vectorTile.VectorTileFeature,te=ue;function ue(Ze,ce){this.options=ce||{},this.features=Ze,this.length=Ze.length}function oe(Ze,ce){this.id="number"==typeof Ze.id?Ze.id:void 0,this.type=Ze.type,this.rawGeometry=1===Ze.type?[Ze.geometry]:Ze.geometry,this.properties=Ze.tags,this.extent=ce||4096}ue.prototype.feature=function(Ze){return new oe(this.features[Ze],this.options.extent)},oe.prototype.loadGeometry=function(){var Ze=this.rawGeometry;this.geometry=[];for(var ce=0;ce<Ze.length;ce++){for(var be=Ze[ce],ze=[],et=0;et<be.length;et++)ze.push(new re(be[et][0],be[et][1]));this.geometry.push(ze)}return this.geometry},oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ze=this.geometry,ce=1/0,be=-1/0,ze=1/0,et=-1/0,yt=0;yt<Ze.length;yt++)for(var Ut=Ze[yt],Pt=0;Pt<Ut.length;Pt++){var ht=Ut[Pt];ce=Math.min(ce,ht.x),be=Math.max(be,ht.x),ze=Math.min(ze,ht.y),et=Math.max(et,ht.y)}return[ce,ze,be,et]},oe.prototype.toGeoJSON=Q.prototype.toGeoJSON;var le=p.pbf,me=te;function ne(Ze){var ce=new le;return function(be,ze){for(var et in be.layers)ze.writeMessage(3,ct,be.layers[et])}(Ze,ce),ce.finish()}function ct(Ze,ce){var be;ce.writeVarintField(15,Ze.version||1),ce.writeStringField(1,Ze.name||""),ce.writeVarintField(5,Ze.extent||4096);var ze={keys:[],values:[],keycache:{},valuecache:{}};for(be=0;be<Ze.length;be++)ze.feature=Ze.feature(be),ce.writeMessage(2,je,ze);var et=ze.keys;for(be=0;be<et.length;be++)ce.writeStringField(3,et[be]);var yt=ze.values;for(be=0;be<yt.length;be++)ce.writeMessage(4,$e,yt[be])}function je(Ze,ce){var be=Ze.feature;void 0!==be.id&&ce.writeVarintField(1,be.id),ce.writeMessage(2,We,Ze),ce.writeVarintField(3,be.type),ce.writeMessage(4,Bt,be)}function We(Ze,ce){var be=Ze.feature,ze=Ze.keys,et=Ze.values,yt=Ze.keycache,Ut=Ze.valuecache;for(var Pt in be.properties){var ht=be.properties[Pt],zt=yt[Pt];if(null!==ht){void 0===zt&&(ze.push(Pt),yt[Pt]=zt=ze.length-1),ce.writeVarint(zt);var dn=typeof ht;"string"!==dn&&"boolean"!==dn&&"number"!==dn&&(ht=JSON.stringify(ht));var Fn=dn+":"+ht,mn=Ut[Fn];void 0===mn&&(et.push(ht),Ut[Fn]=mn=et.length-1),ce.writeVarint(mn)}}}function Se(Ze,ce){return(ce<<3)+(7&Ze)}function ln(Ze){return Ze<<1^Ze>>31}function Bt(Ze,ce){for(var be=Ze.loadGeometry(),ze=Ze.type,et=0,yt=0,Ut=be.length,Pt=0;Pt<Ut;Pt++){var ht=be[Pt],zt=1;1===ze&&(zt=ht.length),ce.writeVarint(Se(1,zt));for(var dn=3===ze?ht.length-1:ht.length,Fn=0;Fn<dn;Fn++){1===Fn&&1!==ze&&ce.writeVarint(Se(2,dn-1));var mn=ht[Fn].x-et,yr=ht[Fn].y-yt;ce.writeVarint(ln(mn)),ce.writeVarint(ln(yr)),et+=mn,yt+=yr}3===ze&&ce.writeVarint(Se(7,1))}}function $e(Ze,ce){var be=typeof Ze;"string"===be?ce.writeStringField(1,Ze):"boolean"===be?ce.writeBooleanField(7,Ze):"number"===be&&(Ze%1!=0?ce.writeDoubleField(3,Ze):Ze<0?ce.writeSVarintField(6,Ze):ce.writeVarintField(5,Ze))}function Tt(Ze,ce,be,ze,et,yt){if(et-ze<=be)return;const Ut=ze+et>>1;Xe(Ze,ce,Ut,ze,et,yt%2),Tt(Ze,ce,be,ze,Ut-1,yt+1),Tt(Ze,ce,be,Ut+1,et,yt+1)}function Xe(Ze,ce,be,ze,et,yt){for(;et>ze;){if(et-ze>600){const zt=et-ze+1,dn=be-ze+1,Fn=Math.log(zt),mn=.5*Math.exp(2*Fn/3),yr=.5*Math.sqrt(Fn*mn*(zt-mn)/zt)*(dn-zt/2<0?-1:1);Xe(Ze,ce,be,Math.max(ze,Math.floor(be-dn*mn/zt+yr)),Math.min(et,Math.floor(be+(zt-dn)*mn/zt+yr)),yt)}const Ut=ce[2*be+yt];let Pt=ze,ht=et;for(gt(Ze,ce,ze,be),ce[2*et+yt]>Ut&&gt(Ze,ce,ze,et);Pt<ht;){for(gt(Ze,ce,Pt,ht),Pt++,ht--;ce[2*Pt+yt]<Ut;)Pt++;for(;ce[2*ht+yt]>Ut;)ht--}ce[2*ze+yt]===Ut?gt(Ze,ce,ze,ht):(ht++,gt(Ze,ce,ht,et)),ht<=be&&(ze=ht+1),be<=ht&&(et=ht-1)}}function gt(Ze,ce,be,ze){xt(Ze,be,ze),xt(ce,2*be,2*ze),xt(ce,2*be+1,2*ze+1)}function xt(Ze,ce,be){const ze=Ze[ce];Ze[ce]=Ze[be],Ze[be]=ze}function Be(Ze,ce,be,ze){const et=Ze-be,yt=ce-ze;return et*et+yt*yt}X.exports=ne,ae.fromVectorTileJs=ne,ae.fromGeojsonVt=function(Ze,ce){ce=ce||{};var be={};for(var ze in Ze)be[ze]=new me(Ze[ze].features,ce),be[ze].name=ze,be[ze].version=ce.version,be[ze].extent=ce.extent;return ne({layers:be})},ae.GeoJSONWrapper=me;const qt=Ze=>Ze[0],$t=Ze=>Ze[1];class pn{constructor(ce,be=qt,ze=$t,et=64,yt=Float64Array){this.nodeSize=et,this.points=ce;const Ut=ce.length<65536?Uint16Array:Uint32Array,Pt=this.ids=new Ut(ce.length),ht=this.coords=new yt(2*ce.length);for(let zt=0;zt<ce.length;zt++)Pt[zt]=zt,ht[2*zt]=be(ce[zt]),ht[2*zt+1]=ze(ce[zt]);Tt(Pt,ht,et,0,Pt.length-1,0)}range(ce,be,ze,et){return function(yt,Ut,Pt,ht,zt,dn,Fn){const mn=[0,yt.length-1,0],yr=[];let ir,xr;for(;mn.length;){const _r=mn.pop(),Dr=mn.pop(),Vr=mn.pop();if(Dr-Vr<=Fn){for(let Zr=Vr;Zr<=Dr;Zr++)ir=Ut[2*Zr],xr=Ut[2*Zr+1],ir>=Pt&&ir<=zt&&xr>=ht&&xr<=dn&&yr.push(yt[Zr]);continue}const nr=Math.floor((Vr+Dr)/2);ir=Ut[2*nr],xr=Ut[2*nr+1],ir>=Pt&&ir<=zt&&xr>=ht&&xr<=dn&&yr.push(yt[nr]);const Pi=(_r+1)%2;(0===_r?Pt<=ir:ht<=xr)&&(mn.push(Vr),mn.push(nr-1),mn.push(Pi)),(0===_r?zt>=ir:dn>=xr)&&(mn.push(nr+1),mn.push(Dr),mn.push(Pi))}return yr}(this.ids,this.coords,ce,be,ze,et,this.nodeSize)}within(ce,be,ze){return function(et,yt,Ut,Pt,ht,zt){const dn=[0,et.length-1,0],Fn=[],mn=ht*ht;for(;dn.length;){const yr=dn.pop(),ir=dn.pop(),xr=dn.pop();if(ir-xr<=zt){for(let Pi=xr;Pi<=ir;Pi++)Be(yt[2*Pi],yt[2*Pi+1],Ut,Pt)<=mn&&Fn.push(et[Pi]);continue}const _r=Math.floor((xr+ir)/2),Dr=yt[2*_r],Vr=yt[2*_r+1];Be(Dr,Vr,Ut,Pt)<=mn&&Fn.push(et[_r]);const nr=(yr+1)%2;(0===yr?Ut-ht<=Dr:Pt-ht<=Vr)&&(dn.push(xr),dn.push(_r-1),dn.push(nr)),(0===yr?Ut+ht>=Dr:Pt+ht>=Vr)&&(dn.push(_r+1),dn.push(ir),dn.push(nr))}return Fn}(this.ids,this.coords,ce,be,ze,this.nodeSize)}}const At={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ze=>Ze},Sn=Math.fround||(Yn=new Float32Array(1),Ze=>(Yn[0]=+Ze,Yn[0]));var Yn;class Kn{constructor(ce){this.options=zr(Object.create(At),ce),this.trees=new Array(this.options.maxZoom+1)}load(ce){const{log:be,minZoom:ze,maxZoom:et,nodeSize:yt}=this.options;be&&console.time("total time");const Ut=`prepare ${ce.length} points`;be&&console.time(Ut),this.points=ce;let Pt=[];for(let ht=0;ht<ce.length;ht++)ce[ht].geometry&&Pt.push(Un(ce[ht],ht));this.trees[et+1]=new pn(Pt,Nt,Le,yt,Float32Array),be&&console.timeEnd(Ut);for(let ht=et;ht>=ze;ht--){const zt=+Date.now();Pt=this._cluster(Pt,ht),this.trees[ht]=new pn(Pt,Nt,Le,yt,Float32Array),be&&console.log("z%d: %d clusters in %dms",ht,Pt.length,+Date.now()-zt)}return be&&console.timeEnd("total time"),this}getClusters(ce,be){let ze=((ce[0]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,ce[1]));let yt=180===ce[2]?180:((ce[2]+180)%360+360)%360-180;const Ut=Math.max(-90,Math.min(90,ce[3]));if(ce[2]-ce[0]>=360)ze=-180,yt=180;else if(ze>yt){const dn=this.getClusters([ze,et,180,Ut],be),Fn=this.getClusters([-180,et,yt,Ut],be);return dn.concat(Fn)}const Pt=this.trees[this._limitZoom(be)],ht=Pt.range(Ei(ze),Ai(Ut),Ei(yt),Ai(et)),zt=[];for(const dn of ht){const Fn=Pt.points[dn];zt.push(Fn.numPoints?Rn(Fn):this.points[Fn.index])}return zt}getChildren(ce){const be=this._getOriginId(ce),ze=this._getOriginZoom(ce),et="No cluster with the specified id.",yt=this.trees[ze];if(!yt)throw new Error(et);const Ut=yt.points[be];if(!Ut)throw new Error(et);const Pt=this.options.radius/(this.options.extent*Math.pow(2,ze-1)),ht=yt.within(Ut.x,Ut.y,Pt),zt=[];for(const dn of ht){const Fn=yt.points[dn];Fn.parentId===ce&&zt.push(Fn.numPoints?Rn(Fn):this.points[Fn.index])}if(0===zt.length)throw new Error(et);return zt}getLeaves(ce,be,ze){const et=[];return this._appendLeaves(et,ce,be=be||10,ze=ze||0,0),et}getTile(ce,be,ze){const et=this.trees[this._limitZoom(ce)],yt=Math.pow(2,ce),{extent:Ut,radius:Pt}=this.options,ht=Pt/Ut,zt=(ze-ht)/yt,dn=(ze+1+ht)/yt,Fn={features:[]};return this._addTileFeatures(et.range((be-ht)/yt,zt,(be+1+ht)/yt,dn),et.points,be,ze,yt,Fn),0===be&&this._addTileFeatures(et.range(1-ht/yt,zt,1,dn),et.points,yt,ze,yt,Fn),be===yt-1&&this._addTileFeatures(et.range(0,zt,ht/yt,dn),et.points,-1,ze,yt,Fn),Fn.features.length?Fn:null}getClusterExpansionZoom(ce){let be=this._getOriginZoom(ce)-1;for(;be<=this.options.maxZoom;){const ze=this.getChildren(ce);if(be++,1!==ze.length)break;ce=ze[0].properties.cluster_id}return be}_appendLeaves(ce,be,ze,et,yt){const Ut=this.getChildren(be);for(const Pt of Ut){const ht=Pt.properties;if(ht&&ht.cluster?yt+ht.point_count<=et?yt+=ht.point_count:yt=this._appendLeaves(ce,ht.cluster_id,ze,et,yt):yt<et?yt++:ce.push(Pt),ce.length===ze)break}return yt}_addTileFeatures(ce,be,ze,et,yt,Ut){for(const Pt of ce){const ht=be[Pt],zt=ht.numPoints;let dn,Fn,mn;if(zt)dn=Jn(ht),Fn=ht.x,mn=ht.y;else{const xr=this.points[ht.index];dn=xr.properties,Fn=Ei(xr.geometry.coordinates[0]),mn=Ai(xr.geometry.coordinates[1])}const yr={type:1,geometry:[[Math.round(this.options.extent*(Fn*yt-ze)),Math.round(this.options.extent*(mn*yt-et))]],tags:dn};let ir;zt?ir=ht.id:this.options.generateId?ir=ht.index:this.points[ht.index].id&&(ir=this.points[ht.index].id),void 0!==ir&&(yr.id=ir),Ut.features.push(yr)}}_limitZoom(ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+ce),this.options.maxZoom+1))}_cluster(ce,be){const ze=[],{radius:et,extent:yt,reduce:Ut,minPoints:Pt}=this.options,ht=et/(yt*Math.pow(2,be));for(let zt=0;zt<ce.length;zt++){const dn=ce[zt];if(dn.zoom<=be)continue;dn.zoom=be;const Fn=this.trees[be+1],mn=Fn.within(dn.x,dn.y,ht),yr=dn.numPoints||1;let ir=yr;for(const xr of mn){const _r=Fn.points[xr];_r.zoom>be&&(ir+=_r.numPoints||1)}if(ir>yr&&ir>=Pt){let xr=dn.x*yr,_r=dn.y*yr,Dr=Ut&&yr>1?this._map(dn,!0):null;const Vr=(zt<<5)+(be+1)+this.points.length;for(const nr of mn){const Pi=Fn.points[nr];if(Pi.zoom<=be)continue;Pi.zoom=be;const Zr=Pi.numPoints||1;xr+=Pi.x*Zr,_r+=Pi.y*Zr,Pi.parentId=Vr,Ut&&(Dr||(Dr=this._map(dn,!0)),Ut(Dr,this._map(Pi)))}dn.parentId=Vr,ze.push(pr(xr/ir,_r/ir,Vr,ir,Dr))}else if(ze.push(dn),ir>1)for(const xr of mn){const _r=Fn.points[xr];_r.zoom<=be||(_r.zoom=be,ze.push(_r))}}return ze}_getOriginId(ce){return ce-this.points.length>>5}_getOriginZoom(ce){return(ce-this.points.length)%32}_map(ce,be){if(ce.numPoints)return be?zr({},ce.properties):ce.properties;const ze=this.points[ce.index].properties,et=this.options.map(ze);return be&&et===ze?zr({},et):et}}function pr(Ze,ce,be,ze,et){return{x:Sn(Ze),y:Sn(ce),zoom:1/0,id:be,parentId:-1,numPoints:ze,properties:et}}function Un(Ze,ce){const[be,ze]=Ze.geometry.coordinates;return{x:Sn(Ei(be)),y:Sn(Ai(ze)),zoom:1/0,index:ce,parentId:-1}}function Rn(Ze){return{type:"Feature",id:Ze.id,properties:Jn(Ze),geometry:{type:"Point",coordinates:[(ce=Ze.x,360*(ce-.5)),Sr(Ze.y)]}};var ce}function Jn(Ze){const ce=Ze.numPoints,be=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce;return zr(zr({},Ze.properties),{cluster:!0,cluster_id:Ze.id,point_count:ce,point_count_abbreviated:be})}function Ei(Ze){return Ze/360+.5}function Ai(Ze){const ce=Math.sin(Ze*Math.PI/180),be=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return be<0?0:be>1?1:be}function Sr(Ze){const ce=(180-360*Ze)*Math.PI/180;return 360*Math.atan(Math.exp(ce))/Math.PI-90}function zr(Ze,ce){for(const be in ce)Ze[be]=ce[be];return Ze}function Nt(Ze){return Ze.x}function Le(Ze){return Ze.y}function De(Ze,ce,be,ze){for(var et,yt=ze,Ut=be-ce>>1,Pt=be-ce,ht=Ze[ce],zt=Ze[ce+1],dn=Ze[be],Fn=Ze[be+1],mn=ce+3;mn<be;mn+=3){var yr=Me(Ze[mn],Ze[mn+1],ht,zt,dn,Fn);if(yr>yt)et=mn,yt=yr;else if(yr===yt){var ir=Math.abs(mn-Ut);ir<Pt&&(et=mn,Pt=ir)}}yt>ze&&(et-ce>3&&De(Ze,ce,et,ze),Ze[et+2]=yt,be-et>3&&De(Ze,et,be,ze))}function Me(Ze,ce,be,ze,et,yt){var Ut=et-be,Pt=yt-ze;if(0!==Ut||0!==Pt){var ht=((Ze-be)*Ut+(ce-ze)*Pt)/(Ut*Ut+Pt*Pt);ht>1?(be=et,ze=yt):ht>0&&(be+=Ut*ht,ze+=Pt*ht)}return(Ut=Ze-be)*Ut+(Pt=ce-ze)*Pt}function Ke(Ze,ce,be,ze){var et={id:void 0===Ze?null:Ze,type:ce,geometry:be,tags:ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(yt){var Ut=yt.geometry,Pt=yt.type;if("Point"===Pt||"MultiPoint"===Pt||"LineString"===Pt)St(yt,Ut);else if("Polygon"===Pt||"MultiLineString"===Pt)for(var ht=0;ht<Ut.length;ht++)St(yt,Ut[ht]);else if("MultiPolygon"===Pt)for(ht=0;ht<Ut.length;ht++)for(var zt=0;zt<Ut[ht].length;zt++)St(yt,Ut[ht][zt])}(et),et}function St(Ze,ce){for(var be=0;be<ce.length;be+=3)Ze.minX=Math.min(Ze.minX,ce[be]),Ze.minY=Math.min(Ze.minY,ce[be+1]),Ze.maxX=Math.max(Ze.maxX,ce[be]),Ze.maxY=Math.max(Ze.maxY,ce[be+1])}function Jt(Ze,ce,be,ze){if(ce.geometry){var et=ce.geometry.coordinates,yt=ce.geometry.type,Ut=Math.pow(be.tolerance/((1<<be.maxZoom)*be.extent),2),Pt=[],ht=ce.id;if(be.promoteId?ht=ce.properties[be.promoteId]:be.generateId&&(ht=ze||0),"Point"===yt)En(et,Pt);else if("MultiPoint"===yt)for(var zt=0;zt<et.length;zt++)En(et[zt],Pt);else if("LineString"===yt)vn(et,Pt,Ut,!1);else if("MultiLineString"===yt){if(be.lineMetrics){for(zt=0;zt<et.length;zt++)vn(et[zt],Pt=[],Ut,!1),Ze.push(Ke(ht,"LineString",Pt,ce.properties));return}un(et,Pt,Ut,!1)}else if("Polygon"===yt)un(et,Pt,Ut,!0);else{if("MultiPolygon"!==yt){if("GeometryCollection"===yt){for(zt=0;zt<ce.geometry.geometries.length;zt++)Jt(Ze,{id:ht,geometry:ce.geometry.geometries[zt],properties:ce.properties},be,ze);return}throw new Error("Input data is not a valid GeoJSON object.")}for(zt=0;zt<et.length;zt++){var dn=[];un(et[zt],dn,Ut,!0),Pt.push(dn)}}Ze.push(Ke(ht,yt,Pt,ce.properties))}}function En(Ze,ce){ce.push(kr(Ze[0])),ce.push(Xr(Ze[1])),ce.push(0)}function vn(Ze,ce,be,ze){for(var et,yt,Ut=0,Pt=0;Pt<Ze.length;Pt++){var ht=kr(Ze[Pt][0]),zt=Xr(Ze[Pt][1]);ce.push(ht),ce.push(zt),ce.push(0),Pt>0&&(Ut+=ze?(et*zt-ht*yt)/2:Math.sqrt(Math.pow(ht-et,2)+Math.pow(zt-yt,2))),et=ht,yt=zt}var dn=ce.length-3;ce[2]=1,De(ce,0,dn,be),ce[dn+2]=1,ce.size=Math.abs(Ut),ce.start=0,ce.end=ce.size}function un(Ze,ce,be,ze){for(var et=0;et<Ze.length;et++){var yt=[];vn(Ze[et],yt,be,ze),ce.push(yt)}}function kr(Ze){return Ze/360+.5}function Xr(Ze){var ce=Math.sin(Ze*Math.PI/180),be=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return be<0?0:be>1?1:be}function kn(Ze,ce,be,ze,et,yt,Ut,Pt){if(ze/=ce,yt>=(be/=ce)&&Ut<ze)return Ze;if(Ut<be||yt>=ze)return null;for(var ht=[],zt=0;zt<Ze.length;zt++){var dn=Ze[zt],Fn=dn.geometry,mn=dn.type,yr=0===et?dn.minX:dn.minY,ir=0===et?dn.maxX:dn.maxY;if(yr>=be&&ir<ze)ht.push(dn);else if(!(ir<be||yr>=ze)){var xr=[];if("Point"===mn||"MultiPoint"===mn)ri(Fn,xr,be,ze,et);else if("LineString"===mn)Hi(Fn,xr,be,ze,et,!1,Pt.lineMetrics);else if("MultiLineString"===mn)gi(Fn,xr,be,ze,et,!1);else if("Polygon"===mn)gi(Fn,xr,be,ze,et,!0);else if("MultiPolygon"===mn)for(var _r=0;_r<Fn.length;_r++){var Dr=[];gi(Fn[_r],Dr,be,ze,et,!0),Dr.length&&xr.push(Dr)}if(xr.length){if(Pt.lineMetrics&&"LineString"===mn){for(_r=0;_r<xr.length;_r++)ht.push(Ke(dn.id,mn,xr[_r],dn.tags));continue}"LineString"!==mn&&"MultiLineString"!==mn||(1===xr.length?(mn="LineString",xr=xr[0]):mn="MultiLineString"),"Point"!==mn&&"MultiPoint"!==mn||(mn=3===xr.length?"Point":"MultiPoint"),ht.push(Ke(dn.id,mn,xr,dn.tags))}}}return ht.length?ht:null}function ri(Ze,ce,be,ze,et){for(var yt=0;yt<Ze.length;yt+=3){var Ut=Ze[yt+et];Ut>=be&&Ut<=ze&&(ce.push(Ze[yt]),ce.push(Ze[yt+1]),ce.push(Ze[yt+2]))}}function Hi(Ze,ce,be,ze,et,yt,Ut){for(var Pt,ht,zt=li(Ze),dn=0===et?xo:eo,Fn=Ze.start,mn=0;mn<Ze.length-3;mn+=3){var yr=Ze[mn],ir=Ze[mn+1],xr=Ze[mn+2],_r=Ze[mn+3],Dr=Ze[mn+4],Vr=0===et?yr:ir,nr=0===et?_r:Dr,Pi=!1;Ut&&(Pt=Math.sqrt(Math.pow(yr-_r,2)+Math.pow(ir-Dr,2))),Vr<be?nr>be&&(ht=dn(zt,yr,ir,_r,Dr,be),Ut&&(zt.start=Fn+Pt*ht)):Vr>ze?nr<ze&&(ht=dn(zt,yr,ir,_r,Dr,ze),Ut&&(zt.start=Fn+Pt*ht)):oo(zt,yr,ir,xr),nr<be&&Vr>=be&&(ht=dn(zt,yr,ir,_r,Dr,be),Pi=!0),nr>ze&&Vr<=ze&&(ht=dn(zt,yr,ir,_r,Dr,ze),Pi=!0),!yt&&Pi&&(Ut&&(zt.end=Fn+Pt*ht),ce.push(zt),zt=li(Ze)),Ut&&(Fn+=Pt)}var Zr=Ze.length-3;yr=Ze[Zr],ir=Ze[Zr+1],xr=Ze[Zr+2],(Vr=0===et?yr:ir)>=be&&Vr<=ze&&oo(zt,yr,ir,xr),Zr=zt.length-3,yt&&Zr>=3&&(zt[Zr]!==zt[0]||zt[Zr+1]!==zt[1])&&oo(zt,zt[0],zt[1],zt[2]),zt.length&&ce.push(zt)}function li(Ze){var ce=[];return ce.size=Ze.size,ce.start=Ze.start,ce.end=Ze.end,ce}function gi(Ze,ce,be,ze,et,yt){for(var Ut=0;Ut<Ze.length;Ut++)Hi(Ze[Ut],ce,be,ze,et,yt,!1)}function oo(Ze,ce,be,ze){Ze.push(ce),Ze.push(be),Ze.push(ze)}function xo(Ze,ce,be,ze,et,yt){var Ut=(yt-ce)/(ze-ce);return Ze.push(yt),Ze.push(be+(et-be)*Ut),Ze.push(1),Ut}function eo(Ze,ce,be,ze,et,yt){var Ut=(yt-be)/(et-be);return Ze.push(ce+(ze-ce)*Ut),Ze.push(yt),Ze.push(1),Ut}function wo(Ze,ce){for(var be=[],ze=0;ze<Ze.length;ze++){var et,yt=Ze[ze],Ut=yt.type;if("Point"===Ut||"MultiPoint"===Ut||"LineString"===Ut)et=Bs(yt.geometry,ce);else if("MultiLineString"===Ut||"Polygon"===Ut){et=[];for(var Pt=0;Pt<yt.geometry.length;Pt++)et.push(Bs(yt.geometry[Pt],ce))}else if("MultiPolygon"===Ut)for(et=[],Pt=0;Pt<yt.geometry.length;Pt++){for(var ht=[],zt=0;zt<yt.geometry[Pt].length;zt++)ht.push(Bs(yt.geometry[Pt][zt],ce));et.push(ht)}be.push(Ke(yt.id,Ut,et,yt.tags))}return be}function Bs(Ze,ce){var be=[];be.size=Ze.size,void 0!==Ze.start&&(be.start=Ze.start,be.end=Ze.end);for(var ze=0;ze<Ze.length;ze+=3)be.push(Ze[ze]+ce,Ze[ze+1],Ze[ze+2]);return be}function Li(Ze,ce){if(Ze.transformed)return Ze;var be,ze,et,yt=1<<Ze.z,Ut=Ze.x,Pt=Ze.y;for(be=0;be<Ze.features.length;be++){var ht=Ze.features[be],zt=ht.geometry,dn=ht.type;if(ht.geometry=[],1===dn)for(ze=0;ze<zt.length;ze+=2)ht.geometry.push(ra(zt[ze],zt[ze+1],ce,yt,Ut,Pt));else for(ze=0;ze<zt.length;ze++){var Fn=[];for(et=0;et<zt[ze].length;et+=2)Fn.push(ra(zt[ze][et],zt[ze][et+1],ce,yt,Ut,Pt));ht.geometry.push(Fn)}}return Ze.transformed=!0,Ze}function ra(Ze,ce,be,ze,et,yt){return[Math.round(be*(Ze*ze-et)),Math.round(be*(ce*ze-yt))]}function Ls(Ze,ce,be,ze,et){for(var yt=ce===et.maxZoom?0:et.tolerance/((1<<ce)*et.extent),Ut={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:be,y:ze,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pt=0;Pt<Ze.length;Pt++){Ut.numFeatures++,Tn(Ut,Ze[Pt],yt,et);var ht=Ze[Pt].minX,zt=Ze[Pt].minY,dn=Ze[Pt].maxX,Fn=Ze[Pt].maxY;ht<Ut.minX&&(Ut.minX=ht),zt<Ut.minY&&(Ut.minY=zt),dn>Ut.maxX&&(Ut.maxX=dn),Fn>Ut.maxY&&(Ut.maxY=Fn)}return Ut}function Tn(Ze,ce,be,ze){var et=ce.geometry,yt=ce.type,Ut=[];if("Point"===yt||"MultiPoint"===yt)for(var Pt=0;Pt<et.length;Pt+=3)Ut.push(et[Pt]),Ut.push(et[Pt+1]),Ze.numPoints++,Ze.numSimplified++;else if("LineString"===yt)il(Ut,et,Ze,be,!1,!1);else if("MultiLineString"===yt||"Polygon"===yt)for(Pt=0;Pt<et.length;Pt++)il(Ut,et[Pt],Ze,be,"Polygon"===yt,0===Pt);else if("MultiPolygon"===yt)for(var ht=0;ht<et.length;ht++){var zt=et[ht];for(Pt=0;Pt<zt.length;Pt++)il(Ut,zt[Pt],Ze,be,!0,0===Pt)}if(Ut.length){var dn=ce.tags||null;if("LineString"===yt&&ze.lineMetrics){for(var Fn in dn={},ce.tags)dn[Fn]=ce.tags[Fn];dn.mapbox_clip_start=et.start/et.size,dn.mapbox_clip_end=et.end/et.size}var mn={geometry:Ut,type:"Polygon"===yt||"MultiPolygon"===yt?3:"LineString"===yt||"MultiLineString"===yt?2:1,tags:dn};null!==ce.id&&(mn.id=ce.id),Ze.features.push(mn)}}function il(Ze,ce,be,ze,et,yt){var Ut=ze*ze;if(ze>0&&ce.size<(et?Ut:ze))be.numPoints+=ce.length/3;else{for(var Pt=[],ht=0;ht<ce.length;ht+=3)(0===ze||ce[ht+2]>Ut)&&(be.numSimplified++,Pt.push(ce[ht]),Pt.push(ce[ht+1])),be.numPoints++;et&&function(zt,dn){for(var Fn=0,mn=0,yr=zt.length,ir=yr-2;mn<yr;ir=mn,mn+=2)Fn+=(zt[mn]-zt[ir])*(zt[mn+1]+zt[ir+1]);if(Fn>0===dn)for(mn=0,yr=zt.length;mn<yr/2;mn+=2){var xr=zt[mn],_r=zt[mn+1];zt[mn]=zt[yr-2-mn],zt[mn+1]=zt[yr-1-mn],zt[yr-2-mn]=xr,zt[yr-1-mn]=_r}}(Pt,yt),Ze.push(Pt)}}function va(Ze,ce){var be=(ce=this.options=function(et,yt){for(var Ut in yt)et[Ut]=yt[Ut];return et}(Object.create(this.options),ce)).debug;if(be&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var et,yt,Ut,Pt,ht,zt,ze=function(et,yt){var Ut=[];if("FeatureCollection"===et.type)for(var Pt=0;Pt<et.features.length;Pt++)Jt(Ut,et.features[Pt],yt,Pt);else Jt(Ut,"Feature"===et.type?et:{geometry:et},yt);return Ut}(Ze,ce);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pt=et=ze,ht=kn(et,1,-1-(Ut=(yt=ce).buffer/yt.extent),Ut,0,-1,2,yt),zt=kn(et,1,1-Ut,2+Ut,0,-1,2,yt),(ht||zt)&&(Pt=kn(et,1,-Ut,1+Ut,0,-1,2,yt)||[],ht&&(Pt=wo(ht,1).concat(Pt)),zt&&(Pt=Pt.concat(wo(zt,-1)))),(ze=Pt).length&&this.splitTile(ze,0,0,0),be&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fr(Ze,ce,be){return 32*((1<<Ze)*be+ce)+Ze}function Ua(Ze,ce){const be=Ze.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);const ze=this._geoJSONIndex.getTile(be.z,be.x,be.y);if(!ze)return ce(null,null);const et=new Rt(ze.features);let yt=ae(et);0===yt.byteOffset&&yt.byteLength===yt.buffer.byteLength||(yt=new Uint8Array(yt)),ce(null,{vectorTile:et,rawData:yt.buffer})}va.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},va.prototype.splitTile=function(Ze,ce,be,ze,et,yt,Ut){for(var Pt=[Ze,ce,be,ze],ht=this.options,zt=ht.debug;Pt.length;){ze=Pt.pop(),be=Pt.pop(),ce=Pt.pop(),Ze=Pt.pop();var dn=1<<ce,Fn=Fr(ce,be,ze),mn=this.tiles[Fn];if(!mn&&(zt>1&&console.time("creation"),mn=this.tiles[Fn]=Ls(Ze,ce,be,ze,ht),this.tileCoords.push({z:ce,x:be,y:ze}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,be,ze,mn.numFeatures,mn.numPoints,mn.numSimplified),console.timeEnd("creation"));var yr="z"+ce;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if(mn.source=Ze,et){if(ce===ht.maxZoom||ce===et)continue;var ir=1<<et-ce;if(be!==Math.floor(yt/ir)||ze!==Math.floor(Ut/ir))continue}else if(ce===ht.indexMaxZoom||mn.numPoints<=ht.indexMaxPoints)continue;if(mn.source=null,0!==Ze.length){zt>1&&console.time("clipping");var xr,_r,Dr,Vr,nr,Pi,Zr=.5*ht.buffer/ht.extent,Wi=.5-Zr,Xi=.5+Zr,Yt=1+Zr;xr=_r=Dr=Vr=null,nr=kn(Ze,dn,be-Zr,be+Xi,0,mn.minX,mn.maxX,ht),Pi=kn(Ze,dn,be+Wi,be+Yt,0,mn.minX,mn.maxX,ht),Ze=null,nr&&(xr=kn(nr,dn,ze-Zr,ze+Xi,1,mn.minY,mn.maxY,ht),_r=kn(nr,dn,ze+Wi,ze+Yt,1,mn.minY,mn.maxY,ht),nr=null),Pi&&(Dr=kn(Pi,dn,ze-Zr,ze+Xi,1,mn.minY,mn.maxY,ht),Vr=kn(Pi,dn,ze+Wi,ze+Yt,1,mn.minY,mn.maxY,ht),Pi=null),zt>1&&console.timeEnd("clipping"),Pt.push(xr||[],ce+1,2*be,2*ze),Pt.push(_r||[],ce+1,2*be,2*ze+1),Pt.push(Dr||[],ce+1,2*be+1,2*ze),Pt.push(Vr||[],ce+1,2*be+1,2*ze+1)}}},va.prototype.getTile=function(Ze,ce,be){var ze=this.options,et=ze.extent,yt=ze.debug;if(Ze<0||Ze>24)return null;var Ut=1<<Ze,Pt=Fr(Ze,ce=(ce%Ut+Ut)%Ut,be);if(this.tiles[Pt])return Li(this.tiles[Pt],et);yt>1&&console.log("drilling down to z%d-%d-%d",Ze,ce,be);for(var ht,zt=Ze,dn=ce,Fn=be;!ht&&zt>0;)zt--,dn=Math.floor(dn/2),Fn=Math.floor(Fn/2),ht=this.tiles[Fr(zt,dn,Fn)];return ht&&ht.source?(yt>1&&console.log("found parent tile z%d-%d-%d",zt,dn,Fn),yt>1&&console.time("drilling down"),this.splitTile(ht.source,zt,dn,Fn,Ze,ce,be),yt>1&&console.timeEnd("drilling down"),this.tiles[Pt]?Li(this.tiles[Pt],et):null):null};class Is extends p.VectorTileWorkerSource{constructor(ce,be,ze,et,yt){super(ce,be,ze,et,Ua),yt&&(this.loadGeoJSON=yt)}loadData(ce,be){const ze=ce&&ce.request,et=ze&&ze.collectResourceTiming;this.loadGeoJSON(ce,(yt,Ut)=>{if(yt||!Ut)return be(yt);if("object"!=typeof Ut)return be(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));{Fe(Ut,!0);try{if(ce.filter){const ht=p.createExpression(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ht.result)throw new Error(ht.value.map(dn=>`${dn.key}: ${dn.message}`).join(", "));const zt=Ut.features.filter(dn=>ht.value.evaluate({zoom:0},dn));Ut={type:"FeatureCollection",features:zt}}this._geoJSONIndex=ce.cluster?new Kn(function({superclusterOptions:ht,clusterProperties:zt}){if(!zt||!ht)return ht;const dn={},Fn={},mn={accumulated:null,zoom:0},yr={properties:null},ir=Object.keys(zt);for(const xr of ir){const[_r,Dr]=zt[xr],Vr=p.createExpression(Dr),nr=p.createExpression("string"==typeof _r?[_r,["accumulated"],["get",xr]]:_r);dn[xr]=Vr.value,Fn[xr]=nr.value}return ht.map=xr=>{yr.properties=xr;const _r={};for(const Dr of ir)_r[Dr]=dn[Dr].evaluate(mn,yr);return _r},ht.reduce=(xr,_r)=>{yr.properties=_r;for(const Dr of ir)mn.accumulated=xr[Dr],xr[Dr]=Fn[Dr].evaluate(mn,yr)},ht}(ce)).load(Ut.features):new va(ht=Ut,ce.geojsonVtOptions)}catch(ht){return be(ht)}this.loaded={};const Pt={};if(et){const ht=p.getPerformanceMeasurement(ze);ht&&(Pt.resourceTiming={},Pt.resourceTiming[ce.source]=JSON.parse(JSON.stringify(ht)))}be(null,Pt)}var ht})}reloadTile(ce,be){const ze=this.loaded;return ze&&ze[ce.uid]?super.reloadTile(ce,be):this.loadTile(ce,be)}loadGeoJSON(ce,be){if(ce.request)p.getJSON(ce.request,be);else{if("string"!=typeof ce.data)return be(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));try{return be(null,JSON.parse(ce.data))}catch{return be(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ce,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(ze){be(ze)}}getClusterChildren(ce,be){try{be(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(ze){be(ze)}}getClusterLeaves(ce,be){try{be(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(ze){be(ze)}}}class Va{constructor(ce){this.self=ce,this.actor=new p.Actor(ce,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Is},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(be,ze)=>{if(this.workerSourceTypes[be])throw new Error(`Worker source with name "${be}" already registered.`);this.workerSourceTypes[be]=ze},this.self.registerRTLTextPlugin=be=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=be.applyArabicShaping,p.plugin.processBidirectionalText=be.processBidirectionalText,p.plugin.processStyledBidirectionalText=be.processStyledBidirectionalText}}clearCaches(ce,be,ze){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce],ze()}checkIfReady(ce,be,ze){ze()}setReferrer(ce,be){this.referrer=be}spriteLoaded(ce,be){this.isSpriteLoaded[ce]=be;for(const ze in this.workerSources[ce]){const et=this.workerSources[ce][ze];for(const yt in et)et[yt]instanceof p.VectorTileWorkerSource&&(et[yt].isSpriteLoaded=be,et[yt].fire(new p.Event("isSpriteLoaded")))}}setImages(ce,be,ze){this.availableImages[ce]=be;for(const et in this.workerSources[ce]){const yt=this.workerSources[ce][et];for(const Ut in yt)yt[Ut].availableImages=be}ze()}enableTerrain(ce,be,ze){this.terrain=be,ze()}setProjection(ce,be){this.projections[ce]=p.getProjection(be)}setLayers(ce,be,ze){this.getLayerIndex(ce).replace(be),ze()}updateLayers(ce,be,ze){this.getLayerIndex(ce).update(be.layers,be.removedIds),ze()}loadTile(ce,be,ze){const et=this.enableTerrain?p.extend({enableTerrain:this.terrain},be):be;et.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,be.type,be.source).loadTile(et,ze)}loadDEMTile(ce,be,ze){const et=this.enableTerrain?p.extend({buildQuadTree:this.terrain},be):be;this.getDEMWorkerSource(ce,be.source).loadTile(et,ze)}reloadTile(ce,be,ze){const et=this.enableTerrain?p.extend({enableTerrain:this.terrain},be):be;et.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,be.type,be.source).reloadTile(et,ze)}abortTile(ce,be,ze){this.getWorkerSource(ce,be.type,be.source).abortTile(be,ze)}removeTile(ce,be,ze){this.getWorkerSource(ce,be.type,be.source).removeTile(be,ze)}removeSource(ce,be,ze){if(!this.workerSources[ce]||!this.workerSources[ce][be.type]||!this.workerSources[ce][be.type][be.source])return;const et=this.workerSources[ce][be.type][be.source];delete this.workerSources[ce][be.type][be.source],void 0!==et.removeSource?et.removeSource(be,ze):ze()}loadWorkerSource(ce,be,ze){try{this.self.importScripts(be.url),ze()}catch(et){ze(et.toString())}}syncRTLPluginState(ce,be,ze){try{p.plugin.setState(be);const et=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=et){this.self.importScripts(et);const yt=p.plugin.isParsed();ze(yt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${et}`),yt)}}catch(et){ze(et.toString())}}getAvailableImages(ce){let be=this.availableImages[ce];return be||(be=[]),be}getLayerIndex(ce){let be=this.layerIndexes[ce];return be||(be=this.layerIndexes[ce]=new Te),be}getWorkerSource(ce,be,ze){return this.workerSources[ce]||(this.workerSources[ce]={}),this.workerSources[ce][be]||(this.workerSources[ce][be]={}),this.workerSources[ce][be][ze]||(this.workerSources[ce][be][ze]=new this.workerSourceTypes[be]({send:(yt,Ut,Pt,ht,zt,dn)=>{this.actor.send(yt,Ut,Pt,ce,zt,dn)},scheduler:this.actor.scheduler},this.getLayerIndex(ce),this.getAvailableImages(ce),this.isSpriteLoaded[ce])),this.workerSources[ce][be][ze]}getDEMWorkerSource(ce,be){return this.demWorkerSources[ce]||(this.demWorkerSources[ce]={}),this.demWorkerSources[ce][be]||(this.demWorkerSources[ce][be]=new Pe),this.demWorkerSources[ce][be]}enforceCacheSizeLimit(ce,be){p.enforceCacheSizeLimit(be)}getWorkerPerformanceMetrics(ce,be,ze){ze(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Va(self)),Va}),ye(0,function(p){function K(b,c){if(Array.isArray(b)){if(!Array.isArray(c)||b.length!==c.length)return!1;for(let m=0;m<b.length;m++)if(!K(b[m],c[m]))return!1;return!0}if("object"==typeof b&&null!==b&&null!==c){if("object"!=typeof c||Object.keys(b).length!==Object.keys(c).length)return!1;for(const m in b)if(!K(b[m],c[m]))return!1;return!0}return b===c}var ge=Te;function Te(b){return c=b,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,T,P=new Blob([""],{type:"text/javascript"}),F=URL.createObjectURL(P);try{T=new Worker(F),C=!0}catch{C=!1}return T&&T.terminate(),URL.revokeObjectURL(F),C}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var C=document.createElement("canvas");C.width=C.height=1;var T=C.getContext("2d");if(!T)return!1;var P=T.getImageData(0,0,1,1);return P&&P.width===C.width}()||(void 0===Pe[m=c&&c.failIfMajorPerformanceCaveat]&&(Pe[m]=function(C){var T,F,z,j,P=(F=C,z=document.createElement("canvas"),(j=Object.create(Te.webGLContextAttributes)).failIfMajorPerformanceCaveat=F,z.getContext("webgl",j)||z.getContext("experimental-webgl",j));if(!P)return!1;try{T=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!T||P.isContextLost())&&(P.shaderSource(T,"void main() {}"),P.compileShader(T),!0===P.getShaderParameter(T,P.COMPILE_STATUS))}(m)),!Pe[m]||document.documentMode));var c,m}var Pe={};function Fe(b,c,m){const C=p.window.document.createElement(b);return void 0!==c&&(C.className=c),m&&m.appendChild(C),C}function bt(b,c,m){const C=p.window.document.createElementNS("http://www.w3.org/2000/svg",b);for(const T of Object.keys(c))C.setAttributeNS(null,T,c[T]);return m&&m.appendChild(C),C}Te.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const nt=p.window.document&&p.window.document.documentElement.style,He=nt&&void 0!==nt.userSelect?"userSelect":"WebkitUserSelect";let dt;function Rt(){nt&&He&&(dt=nt[He],nt[He]="none")}function ae(){nt&&He&&(nt[He]=dt)}function X(b){b.preventDefault(),b.stopPropagation(),p.window.removeEventListener("click",X,!0)}function re(){p.window.addEventListener("click",X,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",X,!0)},0)}function Q(b,c){const m=b.getBoundingClientRect();return oe(b,m,c)}function te(b,c){const m=b.getBoundingClientRect(),C=[];for(let T=0;T<c.length;T++)C.push(oe(b,m,c[T]));return C}function ue(b){return void 0!==p.window.InstallTrigger&&2===b.button&&b.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:b.button}function oe(b,c,m){const C=b.offsetWidth===c.width?1:b.offsetWidth/c.width;return new p.pointGeometry((m.clientX-c.left)*C,(m.clientY-c.top)*C)}function le(b,c){var m=c[0],C=c[1],T=c[2],P=c[3],F=m*P-T*C;return F?(b[0]=P*(F=1/F),b[1]=-C*F,b[2]=-T*F,b[3]=m*F,b):null}function me(b){const{userImage:c}=b;return!!(c&&c.render&&c.render())&&(b.data.replace(new Uint8Array(c.data.buffer)),!0)}class ne extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:m,callback:C}of this.requestors)this._notify(m,C);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,m){this._validate(c,m)&&(this.images[c]=m)}_validate(c,m){let C=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),C=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),C=!1),this._validateContent(m.content,m)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),C=!1),C}_validateStretch(c,m){if(!c)return!0;let C=0;for(const T of c){if(T[0]<C||T[1]<T[0]||m<T[1])return!1;C=T[1]}return!0}_validateContent(c,m){return!(c&&(4!==c.length||c[0]<0||m.data.width<c[0]||c[1]<0||m.data.height<c[1]||c[2]<0||m.data.width<c[2]||c[3]<0||m.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,m){m.version=this.images[c].version+1,this.images[c]=m,this.updatedImages[c]=!0}removeImage(c){const m=this.images[c];delete this.images[c],delete this.patterns[c],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,m){let C=!0;if(!this.isLoaded())for(const T of c)this.images[T]||(C=!1);this.isLoaded()||C?this._notify(c,m):this.requestors.push({ids:c,callback:m})}_notify(c,m){const C={};for(const T of c){this.images[T]||this.fire(new p.Event("styleimagemissing",{id:T}));const P=this.images[T];P?C[T]={data:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:Boolean(P.userImage&&P.userImage.render)}:p.warnOnce(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,C)}getPixelSize(){const{width:c,height:m}=this.atlasImage;return{width:c,height:m}}getPattern(c){const m=this.patterns[c],C=this.getImage(c);if(!C)return null;if(m&&m.position.version===C.version)return m.position;if(m)m.position.version=C.version;else{const T={w:C.data.width+2,h:C.data.height+2,x:0,y:0},P=new p.ImagePosition(T,C);this.patterns[c]={bin:T,position:P}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const m=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const P in this.patterns)c.push(this.patterns[P].bin);const{w:m,h:C}=p.potpack(c),T=this.atlasImage;T.resize({width:m||1,height:C||1});for(const P in this.patterns){const{bin:F}=this.patterns[P],z=F.x+1,j=F.y+1,W=this.images[P].data,Y=W.width,fe=W.height;p.RGBAImage.copy(W,T,{x:0,y:0},{x:z,y:j},{width:Y,height:fe}),p.RGBAImage.copy(W,T,{x:0,y:fe-1},{x:z,y:j-1},{width:Y,height:1}),p.RGBAImage.copy(W,T,{x:0,y:0},{x:z,y:j+fe},{width:Y,height:1}),p.RGBAImage.copy(W,T,{x:Y-1,y:0},{x:z-1,y:j},{width:1,height:fe}),p.RGBAImage.copy(W,T,{x:0,y:0},{x:z+Y,y:j},{width:1,height:fe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const m of c){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;const C=this.images[m];me(C)&&this.updateImage(m,C)}}}const ct=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(b,c){return function([m,C,T]){const P=p.degToRad(C+90),F=p.degToRad(T);return{x:m*Math.cos(P)*Math.sin(F),y:m*Math.sin(P)*Math.sin(F),z:m*Math.cos(F),azimuthal:C,polar:T}}(b.expression.evaluate(c))}interpolate(b,c,m){return{x:p.number(b.x,c.x,m),y:p.number(b.y,c.y,m),z:p.number(b.z,c.z,m),azimuthal:p.number(b.azimuthal,c.azimuthal,m),polar:p.number(b.polar,c.polar,m)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),je="-transition";class We extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(ct),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,m={}){if(!this._validate(p.validateLight,c,m))for(const C in c){const T=c[C];p.endsWith(C,je)?this._transitionable.setTransition(C.slice(0,-je.length),T):this._transitionable.setValue(C,T)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,m,C){return(!C||!1!==C.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Se=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),ln="-transition";class Bt extends p.Evented{constructor(c,m){super(),this._transitionable=new p.Transitionable(Se),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=m}get(){return this._transitionable.serialize()}set(c){for(const m in c){const C=c[m];p.endsWith(m,ln)?this._transitionable.setTransition(m.slice(0,-ln.length),C):this._transitionable.setValue(m,C)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}}function $e(b,c,m,C){const T=p.smoothstep(45,65,m),[P,F]=Tt(b,C),z=p.length(c);let j=1-Math.min(1,Math.exp((z-P)/(F-P)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*T*b.alpha}function Tt(b,c){const m=.5/Math.tan(.5*c);return[b.range[0]+m,b.range[1]+m]}const Xe=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])}),gt="-transition";class xt extends p.Evented{constructor(c,m){super(),this._transitionable=new p.Transitionable(Xe),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=m}get state(){const c=this._transform,m="globe"===c.projection.name,C=p.globeToMercatorTransition(c.zoom),T=this.properties.get("range"),P=[.5,3];return{range:m?[p.number(P[0],T[0],C),p.number(P[1],T[1],C)]:T,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,m={}){if(!this._validate(p.validateFog,c,m)){for(const C of Object.keys(p.spec.fog))c&&void 0===c[C]&&(c[C]=p.spec.fog[C].default);for(const C in c){const T=c[C];p.endsWith(C,gt)?this._transitionable.setTransition(C.slice(0,-gt.length),T):this._transitionable.setValue(C,T)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const m=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*m.a}getOpacityAtLatLng(c,m){return this._transform.projection.supportsFog?function(C,T,P){const F=p.MercatorCoordinate.fromLngLat(T),z=P.elevation?P.elevation.getAtPointOrZero(F):0,j=[F.x,F.y,z];return p.transformMat4(j,j,P.mercatorFogMatrix),$e(C,j,P.pitch,P._fov)}(this.state,c,m):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Tt(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,m,C){return(!C||!1!==C.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Be{constructor(c,m){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const C=this.workerPool.acquire(this.id);for(let T=0;T<C.length;T++){const P=new Be.Actor(C[T],m,this.id);P.name=`Worker ${T}`,this.actors.push(P)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,m,C){p.asyncAll(this.actors,(T,P)=>{T.send(c,m,P)},C=C||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qt(b,c,m){return c*(p.EXTENT/(b.tileSize*Math.pow(2,m-b.tileID.overscaledZ)))}Be.Actor=p.Actor;class $t{constructor(c,m,C,T){this.screenBounds=c,this.cameraPoint=m,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=C,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,T)}static createFromScreenPoints(c,m){let C,T;if(c instanceof p.pointGeometry||"number"==typeof c[0]){const P=p.pointGeometry.convert(c);C=[P],T=m.isPointAboveHorizon(P)}else{const P=p.pointGeometry.convert(c[0]),F=p.pointGeometry.convert(c[1]);C=[P,F],T=p.polygonizeBounds(P,F).every(z=>m.isPointAboveHorizon(z))}return new $t(C,m.getCameraPoint(),T,m)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const m=this.screenBounds[0],C=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],T=p.polygonizeBounds(m,C,0,!1);return this.cameraPoint.y>C.y&&(this.cameraPoint.x>m.x&&this.cameraPoint.x<C.x?T.splice(3,0,this.cameraPoint):this.cameraPoint.x>=C.x?T[2]=this.cameraPoint:this.cameraPoint.x<=m.x&&(T[3]=this.cameraPoint)),p.bufferConvexPolygon(T,c)}bufferedCameraGeometryGlobe(c){const m=this.screenBounds[0],C=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],T=p.polygonizeBounds(m,C,c),P=this.cameraPoint.clone();switch(3*((P.y>m.y)+(P.y>C.y))+((P.x>m.x)+(P.x>C.x))){case 0:T[0]=P,T[4]=P.clone();break;case 1:T.splice(1,0,P);break;case 2:T[1]=P;break;case 3:T.splice(4,0,P);break;case 5:T.splice(2,0,P);break;case 6:T[3]=P;break;case 7:T.splice(3,0,P);break;case 8:T[2]=P}return T}containsTile(c,m,C,T=0){const P=c.queryPadding/m._pixelsPerMercatorPixel+1,F=C?this._bufferedCameraMercator(P,m):this._bufferedScreenMercator(P,m);let z=c.tileID.wrap+(F.unwrapped?T:0);const j=F.polygon.map(qe=>p.getTilePoint(c.tileTransform,qe,z));if(!p.polygonIntersectsBox(j,0,0,p.EXTENT,p.EXTENT))return;z=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?T:0);const W=this.screenGeometryMercator.polygon.map(qe=>p.getTileVec3(c.tileTransform,qe,z)),Y=W.map(qe=>new p.pointGeometry(qe[0],qe[1])),fe=m.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Ae=p.getTileVec3(c.tileTransform,fe,z),Ve=W.map(qe=>{const Ie=p.sub(qe,qe,Ae);return p.normalize(Ie,Ie),new p.Ray(Ae,Ie)}),Ue=qt(c,1,m.zoom)*m._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Y,tilespaceRays:Ve,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(Ge=p.getBounds(j),Ge.min.x=p.clamp(Ge.min.x,0,p.EXTENT),Ge.min.y=p.clamp(Ge.min.y,0,p.EXTENT),Ge.max.x=p.clamp(Ge.max.x,0,p.EXTENT),Ge.max.y=p.clamp(Ge.max.y,0,p.EXTENT),Ge),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Ue};var Ge}_bufferedScreenMercator(c,m){const C=Sn(c);if(this._screenRaycastCache[C])return this._screenRaycastCache[C];{let T;return T="globe"===m.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),m):{polygon:this.bufferedScreenGeometry(c).map(P=>m.pointCoordinate3D(P)),unwrapped:!0},this._screenRaycastCache[C]=T,T}}_bufferedCameraMercator(c,m){const C=Sn(c);if(this._cameraRaycastCache[C])return this._cameraRaycastCache[C];{let T;return T="globe"===m.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),m):{polygon:this.bufferedCameraGeometry(c).map(P=>m.pointCoordinate3D(P)),unwrapped:!0},this._cameraRaycastCache[C]=T,T}}_projectAndResample(c,m){const C=function(P,F){const z=p.multiply([],F.pixelMatrix,F.globeMatrix),j=[0,-p.GLOBE_RADIUS,0,1],W=[0,p.GLOBE_RADIUS,0,1],Y=[0,0,0,1];p.transformMat4$1(j,j,z),p.transformMat4$1(W,W,z),p.transformMat4$1(Y,Y,z);const fe=new p.pointGeometry(j[0]/j[3],j[1]/j[3]),Ae=new p.pointGeometry(W[0]/W[3],W[1]/W[3]),Ve=p.polygonContainsPoint(P,fe)&&j[3]<Y[3],Ue=p.polygonContainsPoint(P,Ae)&&W[3]<Y[3];if(!Ve&&!Ue)return null;const Ge=function(It,jt,Wt){for(let Qt=1;Qt<It.length;Qt++){const Bn=At(jt.pointCoordinate3D(It[Qt-1]).x),Xt=At(jt.pointCoordinate3D(It[Qt]).x);if(Wt<0){if(Bn<Xt)return{idx:Qt,t:-Bn/(Xt-1-Bn)}}else if(Xt<Bn)return{idx:Qt,t:(1-Bn)/(Xt+1-Bn)}}return null}(P,F,Ve?-1:1);if(!Ge)return null;const{idx:qe,t:Ie}=Ge;let tt=qe>1?pn(P.slice(0,qe),F):[],Je=qe<P.length?pn(P.slice(qe),F):[];tt=tt.map(It=>new p.pointGeometry(At(It.x),It.y)),Je=Je.map(It=>new p.pointGeometry(At(It.x),It.y));const ot=[...tt];0===ot.length&&ot.push(Je[Je.length-1]);const Ct=p.number(ot[ot.length-1].y,(0===Je.length?tt[0]:Je[0]).y,Ie);let _t;return _t=Ve?[new p.pointGeometry(0,Ct),new p.pointGeometry(0,0),new p.pointGeometry(1,0),new p.pointGeometry(1,Ct)]:[new p.pointGeometry(1,Ct),new p.pointGeometry(1,1),new p.pointGeometry(0,1),new p.pointGeometry(0,Ct)],ot.push(..._t),0===Je.length?ot.push(tt[0]):ot.push(...Je),{polygon:ot.map(It=>new p.MercatorCoordinate(It.x,It.y)),unwrapped:!1}}(c,m);if(C)return C;const T=function(P,F){let z=!1,j=-1/0,W=0;for(let fe=0;fe<P.length-1;fe++)P[fe].x>j&&(j=P[fe].x,W=fe);for(let fe=0;fe<P.length-1;fe++){const Ae=(W+fe)%(P.length-1),Ve=P[Ae],Ue=P[Ae+1];Math.abs(Ve.x-Ue.x)>.5&&(Ve.x<Ue.x?(Ve.x+=1,0===Ae&&(P[P.length-1].x+=1)):(Ue.x+=1,Ae+1===P.length-1&&(P[0].x+=1)),z=!0)}const Y=p.mercatorXfromLng(F.center.lng);return z&&Y<Math.abs(Y-1)&&P.forEach(fe=>{fe.x-=1}),{polygon:P,unwrapped:z}}(pn(c,m).map(P=>new p.pointGeometry(At(P.x),P.y)),m);return{polygon:T.polygon.map(P=>new p.MercatorCoordinate(P.x,P.y)),unwrapped:T.unwrapped}}}function pn(b,c){return p.resample(b,m=>{const C=c.pointCoordinate3D(m);m.x=C.x,m.y=C.y},1/256)}function At(b){return b<0?1+b%1:b%1}function Sn(b){return 100*b|0}function Yn(b,c,m,C,T){const P=function(F,z){if(F)return T(F);if(z){b.url&&z.tiles&&b.tiles&&delete b.tiles;const j=p.pick(p.extend(z,b),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(j.vectorLayers=z.vector_layers,j.vectorLayerIds=j.vectorLayers.map(W=>W.id)),j.tiles=c.canonicalizeTileset(j,b.url),T(null,j)}};return b.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(b.url,null,m,C),p.ResourceType.Source),P):p.exported.frame(()=>P(null,b))}class Kn{constructor(c,m,C){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=m||0,this.maxzoom=C||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const m=Math.pow(2,c.z),C=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*m),T=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*m),P=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*m),F=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*m);return c.x>=C&&c.x<P&&c.y>=T&&c.y<F}}class pr{constructor(c,m,C){this.context=c;const T=c.gl;this.buffer=T.createBuffer(),this.dynamicDraw=Boolean(C),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||m.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const m=this.context.gl;this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Un={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Rn{constructor(c,m,C,T){this.length=m.length,this.attributes=C,this.itemSize=m.bytesPerElement,this.dynamicDraw=T,this.context=c;const P=c.gl;this.buffer=P.createBuffer(),c.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||m.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,m){for(let C=0;C<this.attributes.length;C++){const T=m.attributes[this.attributes[C].name];void 0!==T&&c.enableVertexAttribArray(T)}}setVertexAttribPointers(c,m,C){for(let T=0;T<this.attributes.length;T++){const P=this.attributes[T],F=m.attributes[P.name];void 0!==F&&c.vertexAttribPointer(F,P.components,c[Un[P.type]],!1,this.itemSize,P.offset+this.itemSize*(C||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ei extends Jn{getDefault(){return p.Color.transparent}set(c){const m=this.current;(c.r!==m.r||c.g!==m.g||c.b!==m.b||c.a!==m.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Ai extends Jn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Sr extends Jn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class zr extends Jn{getDefault(){return[!0,!0,!0,!0]}set(c){const m=this.current;(c[0]!==m[0]||c[1]!==m[1]||c[2]!==m[2]||c[3]!==m[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Nt extends Jn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Le extends Jn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class De extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const m=this.current;(c.func!==m.func||c.ref!==m.ref||c.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Me extends Jn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const m=this.current;(c[0]!==m[0]||c[1]!==m[1]||c[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Ke extends Jn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;c?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=c,this.dirty=!1}}class St extends Jn{getDefault(){return[0,1]}set(c){const m=this.current;(c[0]!==m[0]||c[1]!==m[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Jt extends Jn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;c?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=c,this.dirty=!1}}class En extends Jn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class vn extends Jn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;c?m.enable(m.BLEND):m.disable(m.BLEND),this.current=c,this.dirty=!1}}class un extends Jn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const m=this.current;(c[0]!==m[0]||c[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class kr extends Jn{getDefault(){return p.Color.transparent}set(c){const m=this.current;(c.r!==m.r||c.g!==m.g||c.b!==m.b||c.a!==m.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Xr extends Jn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class kn extends Jn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;c?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=c,this.dirty=!1}}class ri extends Jn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Hi extends Jn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class li extends Jn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class gi extends Jn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class oo extends Jn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const m=this.current;(c[0]!==m[0]||c[1]!==m[1]||c[2]!==m[2]||c[3]!==m[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class xo extends Jn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class eo extends Jn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class wo extends Jn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.bindTexture(m.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Bs extends Jn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Li extends Jn{getDefault(){return null}set(c){const m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ra extends Jn{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class Ls extends Jn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Tn extends Jn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class il extends Jn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class va extends Jn{constructor(c,m){super(c),this.context=c,this.parent=m}getDefault(){return null}}class Fr extends va{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ua extends va{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,this.attachment(),m.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Is extends Ua{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Va{constructor(c,m,C,T){this.context=c,this.width=m,this.height=C;const P=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Fr(c,P),T&&(this.depthAttachment=new Ua(c,P))}destroy(){const c=this.context.gl,m=this.colorAttachment.get();if(m&&c.deleteTexture(m),this.depthAttachment){const C=this.depthAttachment.get();C&&c.deleteRenderbuffer(C)}c.deleteFramebuffer(this.framebuffer)}}class Ze{constructor(c,m=!1){if(this.gl=c,this.isWebGL2=m,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),m){const C=c;this.extVertexArrayObject={createVertexArrayOES:C.createVertexArray.bind(c),deleteVertexArrayOES:C.deleteVertexArray.bind(c),bindVertexArrayOES:C.bindVertexArray.bind(c)}}this.clearColor=new Ei(this),this.clearDepth=new Ai(this),this.clearStencil=new Sr(this),this.colorMask=new zr(this),this.depthMask=new Nt(this),this.stencilMask=new Le(this),this.stencilFunc=new De(this),this.stencilOp=new Me(this),this.stencilTest=new Ke(this),this.depthRange=new St(this),this.depthTest=new Jt(this),this.depthFunc=new En(this),this.blend=new vn(this),this.blendFunc=new un(this),this.blendColor=new kr(this),this.blendEquation=new Xr(this),this.cullFace=new kn(this),this.cullFaceSide=new ri(this),this.frontFace=new Hi(this),this.program=new li(this),this.activeTexture=new gi(this),this.viewport=new oo(this),this.bindFramebuffer=new xo(this),this.bindRenderbuffer=new eo(this),this.bindTexture=new wo(this),this.bindVertexBuffer=new Bs(this),this.bindElementBuffer=new Li(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ra(this),this.pixelStoreUnpack=new Ls(this),this.pixelStoreUnpackPremultiplyAlpha=new Tn(this),this.pixelStoreUnpackFlipY=new il(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),m||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(m||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=m||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,m){return new pr(this,c,m)}createVertexBuffer(c,m,C){return new Rn(this,c,m,C)}createRenderbuffer(c,m,C){const T=this.gl,P=T.createRenderbuffer();return this.bindRenderbuffer.set(P),T.renderbufferStorage(T.RENDERBUFFER,c,m,C),this.bindRenderbuffer.set(null),P}createFramebuffer(c,m,C){return new Va(this,c,m,C)}clear({color:c,depth:m,stencil:C}){const T=this.gl;let P=0;c&&(P|=T.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==m&&(P|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),void 0!==C&&(P|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(C),this.stencilMask.set(255)),T.clear(P)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){K(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ce extends p.Evented{constructor(c,m,C,T){if(super(),this.id=c,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(m,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const m=Array.isArray(this.map._language)?this.map._language.join():this.map._language,C=this.map._worldview;this._tileJSONRequest=Yn(this._options,this.map._requestManager,m,C,(T,P)=>{this._tileJSONRequest=null,this._loaded=!0,T?(m&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${m}`),C&&2!==C.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${C}`),this.fire(new p.ErrorEvent(T))):P&&(p.extend(this,P),P.bounds&&(this.tileBounds=new Kn(P.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(P.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(T)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,m){const C=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(C,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(T.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=m:c.request=c.actor.send("reloadTile",T,P.bind(this));else if(c.actor=this._tileWorkers[C]=this._tileWorkers[C]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",T,P.bind(this),void 0,!0);else{const F=p.loadVectorTile.call({deduped:this._deduped},T,(z,j)=>{z||!j?P.call(this,z):(T.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},c.actor&&c.actor.send("loadTile",T,P.bind(this),void 0,!0))},!0);c.request={cancel:F}}function P(F,z){return delete c.request,c.aborted?m(null):F&&404!==F.status?m(F):(z&&z.resourceTiming&&(c.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&c.setExpiryData(z),c.loadVectorData(z,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class be extends p.Evented{constructor(c,m,C,T){super(),this.id=c,this.dispatcher=C,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},m),p.extend(this,p.pick(m,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yn(this._options,this.map._requestManager,null,null,(m,C)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new p.ErrorEvent(m)):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new Kn(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(m)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,m){const C=p.exported.devicePixelRatio>=2,T=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),C,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(T,p.ResourceType.Tile),(P,F,z,j)=>(delete c.request,c.aborted?(c.state="unloaded",m(null)):P?(c.state="errored",m(P)):F?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:z,expires:j}),c.setTexture(F,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void m(null)):m(null)))}static loadTileData(c,m,C){c.setTexture(m,C)}static unloadTileData(c,m){c.texture&&m.saveTileTexture(c.texture)}abortTile(c,m){c.request&&(c.request.cancel(),delete c.request),m()}unloadTile(c,m){c.texture&&this.map.painter.saveTileTexture(c.texture),m()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ze;function et(b,c,m,C,T,P,F,z){const j=[b,m,T,c,C,P,1,1,1],W=[F,z,1],Y=p.adjoint([],j),[fe,Ae,Ve]=p.transformMat3(W,W,p.transpose(Y,Y));return p.multiply$1(j,[fe,0,0,0,Ae,0,0,0,Ve],j)}class yt extends p.Evented{constructor(c,m,C,T){super(),this.id=c,this.dispatcher=C,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=m,this._dirty=!1}load(c,m){this._loaded=m||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(C,T)=>{if(this._imageRequest=null,this._loaded=!0,C)this.fire(new p.ErrorEvent(C));else if(T){const{HTMLImageElement:P}=p.window;this.image=T instanceof P?p.exported.getImageData(T):T,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const m=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(C){let T=1/0,P=1/0,F=-1/0,z=-1/0;for(const fe of C)T=Math.min(T,fe.x),P=Math.min(P,fe.y),F=Math.max(F,fe.x),z=Math.max(z,fe.y);const j=Math.max(F-T,z-P),W=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),Y=Math.pow(2,W);return new p.CanonicalTileID(W,Math.floor((T+F)/2*Y),Math.floor((P+z)/2*Y))}(m),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const j in this.tiles){const W=this.tiles[j];"loaded"!==W.state&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray)return;const m=p.tileTransform(this.tileID,this.map.transform.projection),[C,T,P,F]=this.coordinates.map(j=>{const W=m.projection.project(j[0],j[1]);return p.getTilePoint(m,W)._round()});this.perspectiveTransform=function(j,W,Y,fe,Ae,Ve,Ue,Ge,qe,Ie){const tt=et(0,0,j,0,0,W,j,W),Je=et(Y,fe,Ae,Ve,Ue,Ge,qe,Ie);return p.multiply$1(Je,p.adjoint(tt,tt),Je),[Je[6]/Je[8]*j/p.EXTENT,Je[7]/Je[8]*W/p.EXTENT]}(this.width,this.height,C.x,C.y,T.x,T.y,F.x,F.y,P.x,P.y);const z=this._boundsArray=new p.StructArrayLayout4i8;z.emplaceBack(C.x,C.y,0,0),z.emplaceBack(T.x,T.y,p.EXTENT,0),z.emplaceBack(F.x,F.y,0,p.EXTENT),z.emplaceBack(P.x,P.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(z,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,m=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,m){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},m(null)):(c.state="errored",m(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ut={vector:ce,raster:be,"raster-dem":class extends be{constructor(b,c,m,C){super(b,c,m,C),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(b,c){const m=this.map._requestManager.normalizeTileURL(b.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function C(T,P){T&&(b.state="errored",c(T)),P&&(b.dem=P,b.dem.onDeserialize(),b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0,b.state="loaded",c(null))}b.request=p.getImage(this.map._requestManager.transformRequest(m,p.ResourceType.Tile),function(T,P,F,z){if(delete b.request,b.aborted)b.state="unloaded",c(null);else if(T)b.state="errored",c(T);else if(P){this.map._refreshExpiredTiles&&b.setExpiryData({cacheControl:F,expires:z});const j=p.window.ImageBitmap&&P instanceof p.window.ImageBitmap&&(null==ze&&(ze=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),ze),W=1-(P.width-p.prevPowerOfTwo(P.width))/2;W<1||b.neighboringTiles||(b.neighboringTiles=this._getNeighboringTiles(b.tileID));const Y=j?P:p.exported.getImageData(P,W),fe={uid:b.uid,coord:b.tileID,source:this.id,rawImageData:Y,encoding:this.encoding,padding:W};b.actor&&"expired"!==b.state||(b.actor=this.dispatcher.getActor(),b.actor.send("loadDEMTile",fe,C.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(b){const c=b.canonical,m=Math.pow(2,c.z),C=(c.x-1+m)%m,T=0===c.x?b.wrap-1:b.wrap,P=(c.x+1+m)%m,F=c.x+1===m?b.wrap+1:b.wrap,z={};return z[new p.OverscaledTileID(b.overscaledZ,T,c.z,C,c.y).key]={backfilled:!1},z[new p.OverscaledTileID(b.overscaledZ,F,c.z,P,c.y).key]={backfilled:!1},c.y>0&&(z[new p.OverscaledTileID(b.overscaledZ,T,c.z,C,c.y-1).key]={backfilled:!1},z[new p.OverscaledTileID(b.overscaledZ,b.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},z[new p.OverscaledTileID(b.overscaledZ,F,c.z,P,c.y-1).key]={backfilled:!1}),c.y+1<m&&(z[new p.OverscaledTileID(b.overscaledZ,T,c.z,C,c.y+1).key]={backfilled:!1},z[new p.OverscaledTileID(b.overscaledZ,b.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},z[new p.OverscaledTileID(b.overscaledZ,F,c.z,P,c.y+1).key]={backfilled:!1}),z}unloadTile(b){b.demTexture&&this.map.painter.saveTileTexture(b.demTexture),b.fbo&&(b.fbo.destroy(),delete b.fbo),b.dem&&delete b.dem,delete b.neighboringTiles,b.state="unloaded"}},geojson:class extends p.Evented{constructor(b,c,m,C){super(),this.id=b,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=m.getActor(),this.setEventedParent(C),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*T,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*T,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(b){this.map=b,this.setData(this._data)}setData(b){return this._data=b,this._updateWorkerData(),this}getClusterExpansionZoom(b,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:b,source:this.id},c),this}getClusterChildren(b,c){return this.actor.send("geojson.getClusterChildren",{clusterId:b,source:this.id},c),this}getClusterLeaves(b,c,m,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:b,limit:c,offset:m},C),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const b=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(b.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,b,(m,C)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new p.ErrorEvent(m));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&C&&C.resourceTiming&&C.resourceTiming[this.id]&&(T.resourceTiming=C.resourceTiming[this.id]),this.fire(new p.Event("data",T)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(b,c){const m=b.actor?"reloadTile":"loadTile";b.actor=this.actor,b.request=this.actor.send(m,{type:this.type,uid:b.uid,tileID:b.tileID,tileZoom:b.tileZoom,zoom:b.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(C,T)=>(delete b.request,b.unloadVectorData(),b.aborted?c(null):C?c(C):(b.loadVectorData(T,this.map.painter,"reloadTile"===m),c(null))),void 0,"loadTile"===m)}abortTile(b){b.request&&(b.request.cancel(),delete b.request),b.aborted=!0}unloadTile(b){b.unloadVectorData(),this.actor.send("removeTile",{uid:b.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends yt{constructor(b,c,m,C){super(b,c,m,C),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const b=this.options;this.urls=[];for(const c of b.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,m)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):m&&(this.video=m,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(b){if(this.video){const c=this.video.seekable;b<c.start(0)||b>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=b}}getVideo(){return this.video}onAdd(b){this.map||(this.map=b,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const b=this.map.painter.context,c=b.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(b,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(b)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:yt,canvas:class extends yt{constructor(b,c,m,C){super(b,c,m,C),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(T=>!Array.isArray(T)||2!==T.length||T.some(P=>"number"!=typeof P))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${b}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${b}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${b}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${b}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${b}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(b){this.map=b,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(b||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const b of[this.canvas.width,this.canvas.height])if(isNaN(b)||b<=0)return!0;return!1}},custom:class extends p.Evented{constructor(b,c,m,C){super(),this.id=b,this.type="custom",this._dataType="raster",this._dispatcher=m,this._implementation=c,this.setEventedParent(C),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kn(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(b){this._map=b,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(b),this.load()}onRemove(b){this._implementation.onRemove&&this._implementation.onRemove(b)}hasTile(b){if(this._implementation.hasTile){const{x:c,y:m,z:C}=b.canonical;return this._implementation.hasTile({x:c,y:m,z:C})}return!this.tileBounds||this.tileBounds.contains(b.canonical)}loadTile(b,c){const{x:m,y:C,z:T}=b.tileID.canonical,P=new p.window.AbortController;b.request=Promise.resolve(this._implementation.loadTile({x:m,y:C,z:T},{signal:P.signal})).then(function(F){return delete b.request,b.aborted?(b.state="unloaded",c(null)):void 0===F?(b.state="errored",c(null)):null===F?(this.loadTileData(b,{width:this.tileSize,height:this.tileSize,data:null}),b.state="loaded",c(null)):(z=F)instanceof p.window.ImageData||z instanceof p.window.HTMLCanvasElement||z instanceof p.window.ImageBitmap||z instanceof p.window.HTMLImageElement?(this.loadTileData(b,F),b.state="loaded",void c(null)):(b.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var z}.bind(this)).catch(F=>{20!==F.code&&(b.state="errored",c(F))}),b.request.cancel=()=>P.abort()}loadTileData(b,c){be.loadTileData(b,c,this._map.painter)}unloadTileData(b){be.unloadTileData(b,this._map.painter)}unloadTile(b,c){if(this.unloadTileData(b),this._implementation.unloadTile){const{x:m,y:C,z:T}=b.tileID.canonical;this._implementation.unloadTile({x:m,y:C,z:T})}c()}abortTile(b,c){b.request&&b.request.cancel&&(b.request.cancel(),delete b.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(b=>({x:b.canonical.x,y:b.canonical.y,z:b.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Pt=function(b,c,m,C){const T=new Ut[c.type](b,c,m,C);if(T.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${T.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],T),T};function ht(b,c){const m=p.identity([]);return p.scale(m,m,[.5*b.width,.5*-b.height,1]),p.translate(m,m,[1,-1,0]),p.multiply(m,m,b.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(m)}function zt(b,c,m,C,T,P,F,z=!1){const j=b.tilesIn(C,F,z);j.sort(Fn);const W=[];for(const fe of j)W.push({wrappedTileID:fe.tile.tileID.wrapped().key,queryResults:fe.tile.queryRenderedFeatures(c,m,b._state,fe,T,P,ht(b.transform,fe.tile.tileID),z)});const Y=function(fe){const Ae={},Ve={};for(const Ue of fe){const Ge=Ue.queryResults,qe=Ue.wrappedTileID,Ie=Ve[qe]=Ve[qe]||{};for(const tt in Ge){const Je=Ge[tt],ot=Ie[tt]=Ie[tt]||{},Ct=Ae[tt]=Ae[tt]||[];for(const _t of Je)ot[_t.featureIndex]||(ot[_t.featureIndex]=!0,Ct.push(_t))}}return Ae}(W);for(const fe in Y)Y[fe].forEach(Ae=>{const Ve=Ae.feature,Ue=Ve.layer;Ue&&"background"!==Ue.type&&"sky"!==Ue.type&&(Ve.source=Ue.source,Ue["source-layer"]&&(Ve.sourceLayer=Ue["source-layer"]),Ve.state=void 0!==Ve.id?b.getFeatureState(Ue["source-layer"],Ve.id):{})});return Y}function dn(b,c){const m=b.getRenderableIds().map(P=>b.getTileByID(P)),C=[],T={};for(let P=0;P<m.length;P++){const F=m[P],z=F.tileID.canonical.key;T[z]||(T[z]=!0,F.querySourceFeatures(C,c))}return C}function Fn(b,c){const m=b.tileID,C=c.tileID;return m.overscaledZ-C.overscaledZ||m.canonical.y-C.canonical.y||m.wrap-C.wrap||m.canonical.x-C.canonical.x}function mn(){return null!=zf.workerClass?new zf.workerClass:new p.window.Worker(zf.workerUrl)}const yr="mapboxgl_preloaded_worker_pool";class ir{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<ir.workerCount;)this.workers.push(new mn);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(m=>{m.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yr]}numActive(){return Object.keys(this.active).length}}let xr;function _r(){return xr||(xr=new ir),xr}function Dr(b,c){const m={};for(const C in b)"ref"!==C&&(m[C]=b[C]);return p.refProperties.forEach(C=>{C in c&&(m[C]=c[C])}),m}function Vr(b){b=b.slice();const c=Object.create(null);for(let m=0;m<b.length;m++)c[b[m].id]=b[m];for(let m=0;m<b.length;m++)"ref"in b[m]&&(b[m]=Dr(b[m],c[b[m].ref]));return b}ir.workerCount=2;const nr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pi(b,c,m){m.push({command:nr.addSource,args:[b,c[b]]})}function Zr(b,c,m){c.push({command:nr.removeSource,args:[b]}),m[b]=!0}function Wi(b,c,m,C){Zr(b,m,C),Pi(b,c,m)}function Xi(b,c,m){let C;for(C in b[m])if(b[m].hasOwnProperty(C)&&"data"!==C&&!K(b[m][C],c[m][C]))return!1;for(C in c[m])if(c[m].hasOwnProperty(C)&&"data"!==C&&!K(b[m][C],c[m][C]))return!1;return!0}function Yt(b,c,m,C,T,P){let F;for(F in c=c||{},b=b||{})b.hasOwnProperty(F)&&(K(b[F],c[F])||m.push({command:P,args:[C,F,c[F],T]}));for(F in c)c.hasOwnProperty(F)&&!b.hasOwnProperty(F)&&(K(b[F],c[F])||m.push({command:P,args:[C,F,c[F],T]}))}function ca(b){return b.id}function so(b,c){return b[c.id]=c,b}class di{constructor(c,m){this.reset(c,m)}reset(c,m){this.points=c||[],this._distances=[0];for(let C=1;C<this.points.length;C++)this._distances[C]=this._distances[C-1]+this.points[C].dist(this.points[C-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let m=1,C=this._distances[m];const T=c*this.paddedLength+this.padding;for(;C<T&&m<this._distances.length;)C=this._distances[++m];const P=m-1,F=this._distances[P],z=C-F,j=z>0?(T-F)/z:0;return this.points[P].mult(1-j).add(this.points[m].mult(j))}}class Qu{constructor(c,m,C){const T=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(c/C),this.yCellCount=Math.ceil(m/C);for(let F=0;F<this.xCellCount*this.yCellCount;F++)T.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=m,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,m,C,T,P){this._forEachCell(m,C,T,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(m),this.bboxes.push(C),this.bboxes.push(T),this.bboxes.push(P)}insertCircle(c,m,C,T){this._forEachCell(m-T,C-T,m+T,C+T,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(m),this.circles.push(C),this.circles.push(T)}_insertBoxCell(c,m,C,T,P,F){this.boxCells[P].push(F)}_insertCircleCell(c,m,C,T,P,F){this.circleCells[P].push(F)}_query(c,m,C,T,P,F){if(C<0||c>this.width||T<0||m>this.height)return!P&&[];const z=[];if(c<=0&&m<=0&&this.width<=C&&this.height<=T){if(P)return!0;for(let j=0;j<this.boxKeys.length;j++)z.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const W=this.circles[3*j],Y=this.circles[3*j+1],fe=this.circles[3*j+2];z.push({key:this.circleKeys[j],x1:W-fe,y1:Y-fe,x2:W+fe,y2:Y+fe})}return F?z.filter(F):z}return this._forEachCell(c,m,C,T,this._queryCell,z,{hitTest:P,seenUids:{box:{},circle:{}}},F),P?z.length>0:z}_queryCircle(c,m,C,T,P){const F=c-C,z=c+C,j=m-C,W=m+C;if(z<0||F>this.width||W<0||j>this.height)return!T&&[];const Y=[];return this._forEachCell(F,j,z,W,this._queryCellCircle,Y,{hitTest:T,circle:{x:c,y:m,radius:C},seenUids:{box:{},circle:{}}},P),T?Y.length>0:Y}query(c,m,C,T,P){return this._query(c,m,C,T,!1,P)}hitTest(c,m,C,T,P){return this._query(c,m,C,T,!0,P)}hitTestCircle(c,m,C,T){return this._queryCircle(c,m,C,!0,T)}_queryCell(c,m,C,T,P,F,z,j){const W=z.seenUids,Y=this.boxCells[P];if(null!==Y){const Ae=this.bboxes;for(const Ve of Y)if(!W.box[Ve]){W.box[Ve]=!0;const Ue=4*Ve;if(c<=Ae[Ue+2]&&m<=Ae[Ue+3]&&C>=Ae[Ue+0]&&T>=Ae[Ue+1]&&(!j||j(this.boxKeys[Ve]))){if(z.hitTest)return F.push(!0),!0;F.push({key:this.boxKeys[Ve],x1:Ae[Ue],y1:Ae[Ue+1],x2:Ae[Ue+2],y2:Ae[Ue+3]})}}}const fe=this.circleCells[P];if(null!==fe){const Ae=this.circles;for(const Ve of fe)if(!W.circle[Ve]){W.circle[Ve]=!0;const Ue=3*Ve;if(this._circleAndRectCollide(Ae[Ue],Ae[Ue+1],Ae[Ue+2],c,m,C,T)&&(!j||j(this.circleKeys[Ve]))){if(z.hitTest)return F.push(!0),!0;{const Ge=Ae[Ue],qe=Ae[Ue+1],Ie=Ae[Ue+2];F.push({key:this.circleKeys[Ve],x1:Ge-Ie,y1:qe-Ie,x2:Ge+Ie,y2:qe+Ie})}}}}}_queryCellCircle(c,m,C,T,P,F,z,j){const W=z.circle,Y=z.seenUids,fe=this.boxCells[P];if(null!==fe){const Ve=this.bboxes;for(const Ue of fe)if(!Y.box[Ue]){Y.box[Ue]=!0;const Ge=4*Ue;if(this._circleAndRectCollide(W.x,W.y,W.radius,Ve[Ge+0],Ve[Ge+1],Ve[Ge+2],Ve[Ge+3])&&(!j||j(this.boxKeys[Ue])))return F.push(!0),!0}}const Ae=this.circleCells[P];if(null!==Ae){const Ve=this.circles;for(const Ue of Ae)if(!Y.circle[Ue]){Y.circle[Ue]=!0;const Ge=3*Ue;if(this._circlesCollide(Ve[Ge],Ve[Ge+1],Ve[Ge+2],W.x,W.y,W.radius)&&(!j||j(this.circleKeys[Ue])))return F.push(!0),!0}}}_forEachCell(c,m,C,T,P,F,z,j){const W=this._convertToXCellCoord(c),Y=this._convertToYCellCoord(m),fe=this._convertToXCellCoord(C),Ae=this._convertToYCellCoord(T);for(let Ve=W;Ve<=fe;Ve++)for(let Ue=Y;Ue<=Ae;Ue++)if(P.call(this,c,m,C,T,this.xCellCount*Ue+Ve,F,z,j))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,m,C,T,P,F){const z=T-c,j=P-m,W=C+F;return W*W>z*z+j*j}_circleAndRectCollide(c,m,C,T,P,F,z){const j=(F-T)/2,W=Math.abs(c-(T+j));if(W>j+C)return!1;const Y=(z-P)/2,fe=Math.abs(m-(P+Y));if(fe>Y+C)return!1;if(W<=j||fe<=Y)return!0;const Ae=W-j,Ve=fe-Y;return Ae*Ae+Ve*Ve<=C*C}}const Ni=Math.tan(85*Math.PI/180);function ol(b,c,m,C,T,P,F){const z=p.create();if(m)if("globe"===P.name){const j=p.calculateGlobeLabelMatrix(T,c);p.multiply(z,z,j)}else{const j=le([],F);z[0]=j[0],z[1]=j[1],z[4]=j[2],z[5]=j[3],C||p.rotateZ(z,z,T.angle)}else p.multiply(z,T.labelPlaneMatrix,b);return z}function xc(b,c,m,C,T,P,F){const z=ol(b,c,m,C,T,P,F);return"globe"===P.name&&m||(z[2]=z[6]=z[10]=z[14]=0),z}function ao(b,c,m,C,T,P,F){if(m){if("globe"===P.name){const z=ol(b,c,m,C,T,P,F);return p.invert(z,z),p.multiply(z,b,z),z}{const z=p.clone(b),j=p.identity([]);return j[0]=F[0],j[1]=F[1],j[4]=F[2],j[5]=F[3],p.multiply(z,z,j),C||p.rotateZ(z,z,-T.angle),z}}return T.glCoordMatrix}function hn(b,c,m,C){const T=[b,c,m,1];m?p.transformMat4$1(T,T,C):Cn(T,T,C);const P=T[3];return T[0]/=P,T[1]/=P,T[2]/=P,T}function Qr(b,c){return Math.min(.5+b/c*.5,1.5)}function Ti(b,c){const m=b[0]/b[3],C=b[1]/b[3];return m>=-c[0]&&m<=c[0]&&C>=-c[1]&&C<=c[1]}function On(b,c,m,C,T,P,F,z,j,W){const Y=m.transform,fe=C?b.textSizeData:b.iconSizeData,Ae=p.evaluateSizeForZoom(fe,m.transform.zoom),Ve="globe"===Y.projection.name,Ue=[256/m.width*2+1,256/m.height*2+1],Ge=C?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;Ge.clear();let qe=null;Ve&&(qe=C?b.text.globeExtVertexArray:b.icon.globeExtVertexArray);const Ie=b.lineVertexArray,tt=C?b.text.placedSymbolArray:b.icon.placedSymbolArray,Je=m.transform.width/m.transform.height;let ot,Ct=!1;for(let _t=0;_t<tt.length;_t++){const It=tt.get(_t),{numGlyphs:jt,writingMode:Wt}=It;if(Wt!==p.WritingMode.vertical||Ct||ot===p.WritingMode.horizontal||(Ct=!0),ot=Wt,(It.hidden||Wt===p.WritingMode.vertical)&&!Ct){Dt(jt,Ge);continue}Ct=!1;const Qt=new p.pointGeometry(It.tileAnchorX,It.tileAnchorY);let{x:Bn,y:Xt,z:yn}=Y.projection.projectTilePoint(Qt.x,Qt.y,W.canonical);if(j){const[wi,gr,or]=j(Qt);Bn+=wi,Xt+=gr,yn+=or}const sn=[Bn,Xt,yn,1];if(p.transformMat4$1(sn,sn,c),!Ti(sn,Ue)){Dt(jt,Ge);continue}const An=Qr(m.transform.cameraToCenterDistance,sn[3]),Ht=p.evaluateSizeForFeature(fe,Ae,It),Vt=F?Ht/An:Ht*An,en=hn(Bn,Xt,yn,T);if(en[3]<=0){Dt(jt,Ge);continue}let xn={};const Pn=F?null:j,br=we(It,Vt,!1,z,c,T,P,b.glyphOffsetArray,Ie,Ge,qe,en,Qt,xn,Je,Pn,Y.projection,W,F);Ct=br.useVertical,Pn&&br.needsFlipping&&(xn={}),(br.notEnoughRoom||Ct||br.needsFlipping&&we(It,Vt,!0,z,c,T,P,b.glyphOffsetArray,Ie,Ge,qe,en,Qt,xn,Je,Pn,Y.projection,W,F).notEnoughRoom)&&Dt(jt,Ge)}C?(b.text.dynamicLayoutVertexBuffer.updateData(Ge),qe&&b.text.globeExtVertexBuffer.updateData(qe)):(b.icon.dynamicLayoutVertexBuffer.updateData(Ge),qe&&b.icon.globeExtVertexBuffer.updateData(qe))}function k(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge){const{lineStartIndex:qe,glyphStartIndex:Ie,segment:tt}=z,Je=Ie+z.numGlyphs,ot=qe+z.lineLength,Ct=c.getoffsetX(Ie),_t=c.getoffsetX(Je-1),It=Mt(b*Ct,m,C,T,P,F,tt,qe,ot,j,W,Y,fe,Ae,!0,Ve,Ue,Ge);if(!It)return null;const jt=Mt(b*_t,m,C,T,P,F,tt,qe,ot,j,W,Y,fe,Ae,!0,Ve,Ue,Ge);return jt?{first:It,last:jt}:null}function G(b,c,m,C){return b===p.WritingMode.horizontal&&Math.abs(C)>Math.abs(m)?{useVertical:!0}:b===p.WritingMode.vertical?C>0?{needsFlipping:!0}:null:0!==c&&(0===(T=m)||Math.abs(C/T)>Ni)?1===c?{needsFlipping:!0}:null:m<0?{needsFlipping:!0}:null;var T}function we(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge,qe,Ie,tt){const Je=c/24,ot=b.lineOffsetX*Je,Ct=b.lineOffsetY*Je,{lineStartIndex:_t,glyphStartIndex:It,numGlyphs:jt,segment:Wt,writingMode:Qt,flipState:Bn}=b,Xt=_t+b.lineLength,yn=sn=>{if(Y){const[en,xn,Pn]=sn.up,br=W.length;p.updateGlobeVertexNormal(Y,br+0,en,xn,Pn),p.updateGlobeVertexNormal(Y,br+1,en,xn,Pn),p.updateGlobeVertexNormal(Y,br+2,en,xn,Pn),p.updateGlobeVertexNormal(Y,br+3,en,xn,Pn)}const[An,Ht,Vt]=sn.point;p.addDynamicAttributes(W,An,Ht,Vt,sn.angle)};if(jt>1){const sn=k(Je,z,ot,Ct,m,fe,Ae,b,j,P,Ve,Ge,!1,qe,Ie,tt);if(!sn)return{notEnoughRoom:!0};if(C&&!m){let[An,Ht,Vt]=sn.first.point,[en,xn,Pn]=sn.last.point;[An,Ht]=hn(An,Ht,Vt,F),[en,xn]=hn(en,xn,Pn,F);const br=G(Qt,Bn,(en-An)*Ue,xn-Ht);if(b.flipState=br&&br.needsFlipping?1:2,br)return br}yn(sn.first);for(let An=It+1;An<It+jt-1;An++){const Ht=Mt(Je*z.getoffsetX(An),ot,Ct,m,fe,Ae,Wt,_t,Xt,j,P,Ve,Ge,!1,!1,qe,Ie,tt);if(!Ht)return W.length-=4*(An-It),{notEnoughRoom:!0};yn(Ht)}yn(sn.last)}else{if(C&&!m){const An=hn(Ae.x,Ae.y,0,T),Ht=_t+Wt+1,Vt=new p.pointGeometry(j.getx(Ht),j.gety(Ht)),en=hn(Vt.x,Vt.y,0,T),xn=en[3]>0?en:at(Ae,Vt,An,1,T,void 0,qe,Ie.canonical),Pn=G(Qt,Bn,(xn[0]-An[0])*Ue,xn[1]-An[1]);if(b.flipState=Pn&&Pn.needsFlipping?1:2,Pn)return Pn}const sn=Mt(Je*z.getoffsetX(It),ot,Ct,m,fe,Ae,Wt,_t,Xt,j,P,Ve,Ge,!1,!1,qe,Ie,tt);if(!sn)return{notEnoughRoom:!0};yn(sn)}return{}}function st(b,c,m,C,T){const{x:P,y:F,z}=C.projectTilePoint(b.x,b.y,c);if(!T)return hn(P,F,z,m);const[j,W,Y]=T(b);return hn(P+j,F+W,z+Y,m)}function at(b,c,m,C,T,P,F,z){const j=st(b.sub(c)._unit()._add(b),z,T,F,P);return p.sub(j,m,j),p.normalize(j,j),p.scaleAndAdd(j,m,j,C)}function Mt(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge,qe,Ie){const tt=C?b-c:b+c;let Je=tt>0?1:-1,ot=0;C&&(Je*=-1,ot=Math.PI),Je<0&&(ot+=Math.PI);let Ct=z+F+(Je>0?0:1)|0,_t=T,It=T,jt=0,Wt=0;const Qt=Math.abs(tt),Bn=[],Xt=[];let yn=P,sn=yn;const An=()=>at(sn,yn,It,Qt-jt+1,Y,Ae,Ge,qe.canonical);for(;jt+Wt<=Qt;){if(Ct+=Je,Ct<z||Ct>=j)return null;if(It=_t,sn=yn,Bn.push(It),Ve&&Xt.push(sn),yn=new p.pointGeometry(W.getx(Ct),W.gety(Ct)),_t=fe[Ct],!_t){const or=st(yn,qe.canonical,Y,Ge,Ae);_t=or[3]>0?fe[Ct]=or:An()}jt+=Wt,Wt=p.distance(It,_t)}Ue&&Ae&&(fe[Ct]&&(_t=An(),Wt=p.distance(It,_t)),fe[Ct]=_t);const Ht=(Qt-jt)/Wt,Vt=yn.sub(sn)._mult(Ht)._add(sn),en=p.sub([],_t,It),xn=p.scaleAndAdd([],It,en,Ht);let Pn=[0,0,1],br=en[0],wi=en[1];if(Ie&&(Pn=Ge.upVector(qe.canonical,Vt.x,Vt.y),0!==Pn[0]||0!==Pn[1]||1!==Pn[2])){const or=[Pn[2],0,-Pn[0]],Ir=p.cross([],Pn,or);p.normalize(or,or),p.normalize(Ir,Ir),br=p.dot(en,or),wi=p.dot(en,Ir)}if(m){const or=p.cross([],Pn,en);p.normalize(or,or),p.scaleAndAdd(xn,xn,or,m*Je)}const gr=ot+Math.atan2(wi,br);return Bn.push(xn),Ve&&Xt.push(Vt),{point:xn,angle:gr,path:Bn,tilePath:Xt,up:Pn}}function Dt(b,c){const m=c.length,C=m+4*b;c.resize(C),c.float32.fill(-1/0,4*m,4*C)}function Cn(b,c,m){const C=c[0],T=c[1];return b[0]=m[0]*C+m[4]*T+m[12],b[1]=m[1]*C+m[5]*T+m[13],b[3]=m[3]*C+m[7]*T+m[15],b}const Mn=100;class Zn{constructor(c,m,C=new Qu(c.width+200,c.height+200,25),T=new Qu(c.width+200,c.height+200,25)){this.transform=c,this.grid=C,this.ignoredGrid=T,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Mn,this.screenBottomBoundary=c.height+Mn,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=m}placeCollisionBox(c,m,C,T,P,F,z,j){let W=C.projectedAnchorX,Y=C.projectedAnchorY,fe=C.projectedAnchorZ;const Ae=C.elevation,Ve=C.tileID,Ue=c.getProjection();if(Ae&&Ve){const[_t,It,jt]=Ue.upVector(Ve.canonical,C.tileAnchorX,C.tileAnchorY),Wt=Ue.upVectorScale(Ve.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=_t*Ae*Wt,Y+=It*Ae*Wt,fe+=jt*Ae*Wt}const Ge=this.projectAndGetPerspectiveRatio(z,W,Y,fe,C.tileID,"globe"===Ue.name||!!Ae||this.transform.pitch>0,Ue),qe=F*Ge.perspectiveRatio,Ie=(C.x1*m+T.x-C.padding)*qe+Ge.point.x,tt=(C.y1*m+T.y-C.padding)*qe+Ge.point.y,Je=(C.x2*m+T.x+C.padding)*qe+Ge.point.x,ot=(C.y2*m+T.y+C.padding)*qe+Ge.point.y,Ct=Ge.perspectiveRatio<=.55||Ge.occluded;return!this.isInsideGrid(Ie,tt,Je,ot)||!P&&this.grid.hitTest(Ie,tt,Je,ot,j)||Ct?{box:[],offscreen:!1,occluded:Ge.occluded}:{box:[Ie,tt,Je,ot],offscreen:this.isOffscreen(Ie,tt,Je,ot),occluded:!1}}placeCollisionCircles(c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge){const qe=[],Ie=this.transform.elevation,tt=c.getProjection(),Je=Ie?Ie.getAtTileOffsetFunc(Ge,this.transform.center.lat,this.transform.worldSize,tt):null,ot=new p.pointGeometry(C.tileAnchorX,C.tileAnchorY);let{x:Ct,y:_t,z:It}=tt.projectTilePoint(ot.x,ot.y,Ge.canonical);if(Je){const[Vt,en,xn]=Je(ot);Ct+=Vt,_t+=en,It+=xn}const jt="globe"===tt.name,Wt=this.projectAndGetPerspectiveRatio(z,Ct,_t,It,Ge,jt||!!Ie||this.transform.pitch>0,tt),{perspectiveRatio:Qt}=Wt,Bn=(fe?F/Qt:F*Qt)/p.ONE_EM,Xt=hn(Ct,_t,It,j),yn=Wt.signedDistanceFromCamera>0?k(Bn,P,C.lineOffsetX*Bn,C.lineOffsetY*Bn,!1,Xt,ot,C,T,j,{},Ie&&!fe?Je:null,fe&&!!Ie,tt,Ge,fe):null;let sn=!1,An=!1,Ht=!0;if(yn&&!Wt.occluded){const Vt=.5*Ve*Qt+Ue,en=new p.pointGeometry(-100,-100),xn=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Pn=new di,{first:br,last:wi}=yn,gr=br.path.length;let or=[];for(let Br=gr-1;Br>=1;Br--)or.push(br.path[Br]);for(let Br=1;Br<wi.path.length;Br++)or.push(wi.path[Br]);const Ir=2.5*Vt;W&&(or=or.map(([Br,ns,rs],fs)=>(Je&&!jt&&(rs=Je(fs<gr-1?br.tilePath[gr-1-fs]:wi.tilePath[fs-gr+2])[2]),hn(Br,ns,rs,W))),or.some(Br=>Br[3]<=0)&&(or=[]));let qi=[];if(or.length>0){let Br=1/0,ns=-1/0,rs=1/0,fs=-1/0;for(const Rs of or)Br=Math.min(Br,Rs[0]),rs=Math.min(rs,Rs[1]),ns=Math.max(ns,Rs[0]),fs=Math.max(fs,Rs[1]);ns>=en.x&&Br<=xn.x&&fs>=en.y&&rs<=xn.y&&(qi=[or.map(Rs=>new p.pointGeometry(Rs[0],Rs[1]))],(Br<en.x||ns>xn.x||rs<en.y||fs>xn.y)&&(qi=p.clipLine(qi,en.x,en.y,xn.x,xn.y)))}for(const Br of qi){Pn.reset(Br,.25*Vt);let ns=0;ns=Pn.length<=.5*Vt?1:Math.ceil(Pn.paddedLength/Ir)+1;for(let rs=0;rs<ns;rs++){const fs=rs/Math.max(ns-1,1),Rs=Pn.lerp(fs),Fa=Rs.x+Mn,cu=Rs.y+Mn;qe.push(Fa,cu,Vt,0);const Jl=Fa-Vt,Bc=cu-Vt,Vs=Fa+Vt,xs=cu+Vt;if(Ht=Ht&&this.isOffscreen(Jl,Bc,Vs,xs),An=An||this.isInsideGrid(Jl,Bc,Vs,xs),!m&&this.grid.hitTestCircle(Fa,cu,Vt,Ae)&&(sn=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:sn,occluded:!1}}}}return{circles:!Y&&sn||!An?[]:qe,offscreen:Ht,collisionDetected:sn,occluded:Wt.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const m=[];let C=1/0,T=1/0,P=-1/0,F=-1/0;for(const Y of c){const fe=new p.pointGeometry(Y.x+Mn,Y.y+Mn);C=Math.min(C,fe.x),T=Math.min(T,fe.y),P=Math.max(P,fe.x),F=Math.max(F,fe.y),m.push(fe)}const z=this.grid.query(C,T,P,F).concat(this.ignoredGrid.query(C,T,P,F)),j={},W={};for(const Y of z){const fe=Y.key;if(void 0===j[fe.bucketInstanceId]&&(j[fe.bucketInstanceId]={}),j[fe.bucketInstanceId][fe.featureIndex])continue;const Ae=[new p.pointGeometry(Y.x1,Y.y1),new p.pointGeometry(Y.x2,Y.y1),new p.pointGeometry(Y.x2,Y.y2),new p.pointGeometry(Y.x1,Y.y2)];p.polygonIntersectsPolygon(m,Ae)&&(j[fe.bucketInstanceId][fe.featureIndex]=!0,void 0===W[fe.bucketInstanceId]&&(W[fe.bucketInstanceId]=[]),W[fe.bucketInstanceId].push(fe.featureIndex))}return W}insertCollisionBox(c,m,C,T,P){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:C,featureIndex:T,collisionGroupID:P},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,m,C,T,P){const F=m?this.ignoredGrid:this.grid,z={bucketInstanceId:C,featureIndex:T,collisionGroupID:P};for(let j=0;j<c.length;j+=4)F.insertCircle(z,c[j],c[j+1],c[j+2])}projectAndGetPerspectiveRatio(c,m,C,T,P,F,z){const j=[m,C,T,1];let W=!1;if(T||this.transform.pitch>0){p.transformMat4$1(j,j,c);const fe="globe"===z.name;this.fogState&&P&&!fe&&(W=function(Ve,Ue,Ge,qe,Ie,tt){const Je=tt.calculateFogTileMatrix(Ie),ot=[Ue,Ge,qe];return p.transformMat4(ot,ot,Je),$e(Ve,ot,tt.pitch,tt._fov)}(this.fogState,m,C,T,P.toUnwrapped(),this.transform)>.9)}else Cn(j,j,c);const Y=j[3];return{point:new p.pointGeometry((j[0]/Y+1)/2*this.transform.width+Mn,(-j[1]/Y+1)/2*this.transform.height+Mn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/Y*.5,1.5),signedDistanceFromCamera:Y,occluded:F&&j[2]>Y||W}}isOffscreen(c,m,C,T){return C<Mn||c>=this.screenRightBoundary||T<Mn||m>this.screenBottomBoundary}isInsideGrid(c,m,C,T){return C>=0&&c<this.gridRightBoundary&&T>=0&&m<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function Qn(b,c,m){const C=c.createTileMatrix(b,b.worldSize,m.toUnwrapped());return p.multiply(new Float32Array(16),b.projMatrix,C)}function jn(b,c,m){if(c.projection.name===m.projection.name)return b.projMatrix;const C=m.clone();return C.setProjection(c.projection),Qn(C,c.getProjection(),b)}function cn(b,c,m){return c.name===m.projection.name?b.projMatrix:Qn(m,c,b)}class as{constructor(c,m,C,T){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?m:-m))):T&&C?1:0,this.placed=C}isHidden(){return 0===this.opacity&&!this.placed}}class jr{constructor(c,m,C,T,P,F=!1){this.text=new as(c?c.text:null,m,C,P),this.icon=new as(c?c.icon:null,m,T,P),this.clipped=F}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class lo{constructor(c,m,C,T=!1){this.text=c,this.icon=m,this.skipFade=C,this.clipped=T}}class bn{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class $n{constructor(c,m,C,T,P){this.bucketInstanceId=c,this.featureIndex=m,this.sourceLayerIndex=C,this.bucketIndex=T,this.tileID=P}}class sr{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const m=++this.maxGroupID;this.collisionGroups[c]={ID:m,predicate:C=>C.collisionGroupID===m}}return this.collisionGroups[c]}}function Jr(b,c,m,C,T){const{horizontalAlign:P,verticalAlign:F}=p.getAnchorAlignment(b),z=-(P-.5)*c,j=-(F-.5)*m,W=p.evaluateVariableOffset(b,C);return new p.pointGeometry(z+W[0]*T,j+W[1]*T)}function Gr(b,c,m,C,T){const P=new p.pointGeometry(b,c);return m&&P._rotate(C?T:-T),P}class vi{constructor(c,m,C,T,P){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Zn(this.transform,P),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new sr(C),this.collisionCircleArrays={},this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,m,C,T){const P=C.getBucket(m),F=C.latestFeatureIndex;if(!P||!F||m.id!==P.layerIds[0])return;const z=P.layers[0].layout,j=C.collisionBoxArray,W=Math.pow(2,this.transform.zoom-C.tileID.overscaledZ),Y=C.tileSize/p.EXTENT,fe=C.tileID.toUnwrapped();this.transform.setProjection(P.projection);const Ae=(Ve=C.tileID,Ue=P.getProjection(),Ge=this.transform,Ue.name===this.projection?Ge.calculateProjMatrix(Ve.toUnwrapped()):Qn(Ge,Ue,Ve));var Ve,Ue,Ge;const qe="map"===z.get("text-pitch-alignment"),Ie="map"===z.get("text-rotation-alignment");m.compileFilter();const tt=m.dynamicFilter(),Je=m.dynamicFilterNeedsFeature(),ot=this.transform.calculatePixelsToTileUnitsMatrix(C),Ct=xc(Ae,C.tileID.canonical,qe,Ie,this.transform,P.getProjection(),ot);let _t=null;if(qe){const Wt=ao(Ae,C.tileID.canonical,qe,Ie,this.transform,P.getProjection(),ot);_t=p.multiply([],this.transform.labelPlaneMatrix,Wt)}let It=null;tt&&C.latestFeatureIndex&&(It={unwrappedTileID:fe,dynamicFilter:tt,dynamicFilterNeedsFeature:Je,featureIndex:C.latestFeatureIndex}),this.retainedQueryData[P.bucketInstanceId]=new $n(P.bucketInstanceId,F,P.sourceLayerIndex,P.index,C.tileID);const jt={bucket:P,layout:z,posMatrix:Ae,textLabelPlaneMatrix:Ct,labelToScreenMatrix:_t,clippingData:It,scale:W,textPixelRatio:Y,holdingForFade:C.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(P.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(P.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(P.sourceID)};if(T)for(const Wt of P.sortKeyRanges){const{sortKey:Qt,symbolInstanceStart:Bn,symbolInstanceEnd:Xt}=Wt;c.push({sortKey:Qt,symbolInstanceStart:Bn,symbolInstanceEnd:Xt,parameters:jt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:jt})}attemptAnchorPlacement(c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge,qe,Ie,tt){const{textOffset0:Je,textOffset1:ot,crossTileID:Ct}=Ae,_t=[Je,ot],It=Jr(c,C,T,_t,P),jt=this.collisionIndex.placeCollisionBox(Ue,P,m,Gr(It.x,It.y,F,z,this.transform.angle),fe,j,W,Y.predicate);if(qe){const Wt=Ue.getSymbolInstanceIconSize(tt,this.transform.zoom,Ae.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Ue,Wt,qe,Gr(It.x,It.y,F,z,this.transform.angle),fe,j,W,Y.predicate).box.length)return}if(jt.box.length>0){let Wt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ct]&&this.prevPlacement.placements[Ct]&&this.prevPlacement.placements[Ct].text&&(Wt=this.prevPlacement.variableOffsets[Ct].anchor),this.variableOffsets[Ct]={textOffset:_t,width:C,height:T,anchor:c,textScale:P,prevAnchor:Wt},this.markUsedJustification(Ue,c,Ae,Ge),Ue.allowVerticalPlacement&&(this.markUsedOrientation(Ue,Ge,Ae),this.placedOrientations[Ct]=Ge),{shift:It,placedGlyphBoxes:jt}}}placeLayerBucketPart(c,m,C,T){const{bucket:P,layout:F,posMatrix:z,textLabelPlaneMatrix:j,labelToScreenMatrix:W,clippingData:Y,textPixelRatio:fe,holdingForFade:Ae,collisionBoxArray:Ve,partiallyEvaluatedTextSize:Ue,partiallyEvaluatedIconSize:Ge,collisionGroup:qe}=c.parameters,Ie=F.get("text-optional"),tt=F.get("icon-optional"),Je=F.get("text-allow-overlap"),ot=F.get("icon-allow-overlap"),Ct="map"===F.get("text-rotation-alignment"),_t="map"===F.get("text-pitch-alignment"),It="none"!==F.get("icon-text-fit"),jt="viewport-y"===F.get("symbol-z-order");this.transform.setProjection(P.projection);let Wt=Je&&(ot||!P.hasIconData()||tt),Qt=ot&&(Je||!P.hasTextData()||Ie);!P.collisionArrays&&Ve&&P.deserializeCollisionBoxes(Ve),C&&T&&P.updateCollisionDebugBuffers(this.transform.zoom,Ve);const Bn=(Xt,yn,sn)=>{const{crossTileID:An,numVerticalGlyphVertices:Ht}=Xt;if(Y){const Vs={zoom:this.transform.zoom,pitch:this.transform.pitch};let xs=null;if(Y.dynamicFilterNeedsFeature){const yo=this.retainedQueryData[P.bucketInstanceId];xs=Y.featureIndex.loadFeature({featureIndex:Xt.featureIndex,bucketIndex:yo.bucketIndex,sourceLayerIndex:yo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Y.dynamicFilter)(Vs,xs,this.retainedQueryData[P.bucketInstanceId].tileID.canonical,new p.pointGeometry(Xt.tileAnchorX,Xt.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[An]=new lo(!1,!1,!1,!0),void(m[An]=!0)}if(m[An])return;if(Ae)return void(this.placements[An]=new lo(!1,!1,!1));let Vt=!1,en=!1,xn=!0,Pn=!1,br=!1,wi=null,gr={box:null,offscreen:null,occluded:null},or={box:null,offscreen:null,occluded:null},Ir=null,qi=null,Br=null,ns=0,rs=0,fs=0;sn.textFeatureIndex?ns=sn.textFeatureIndex:Xt.useRuntimeCollisionCircles&&(ns=Xt.featureIndex),sn.verticalTextFeatureIndex&&(rs=sn.verticalTextFeatureIndex);const Rs=Vs=>{Vs.tileID=this.retainedQueryData[P.bucketInstanceId].tileID;const xs=this.transform.elevation;(xs||Vs.elevation)&&(Vs.elevation=xs?xs.getAtTileOffset(Vs.tileID,Vs.tileAnchorX,Vs.tileAnchorY):0)},Fa=sn.textBox;if(Fa){Rs(Fa);const Vs=yo=>{let ya=p.WritingMode.horizontal;if(P.allowVerticalPlacement&&!yo&&this.prevPlacement){const nl=this.prevPlacement.placedOrientations[An];nl&&(this.placedOrientations[An]=nl,ya=nl,this.markUsedOrientation(P,ya,Xt))}return ya},xs=(yo,ya)=>{if(P.allowVerticalPlacement&&Ht>0&&sn.verticalTextBox){for(const nl of P.writingModes)if(nl===p.WritingMode.vertical?(gr=ya(),or=gr):gr=yo(),gr&&gr.box&&gr.box.length)break}else gr=yo()};if(F.get("text-variable-anchor")){let yo=F.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[An]){const ds=this.prevPlacement.variableOffsets[An];yo.indexOf(ds.anchor)>0&&(yo=yo.filter(Ha=>Ha!==ds.anchor),yo.unshift(ds.anchor))}const ya=(ds,Ha,Wa)=>{const zc=P.getSymbolInstanceTextSize(Ue,Xt,this.transform.zoom,yn),ih=(ds.x2-ds.x1)*zc+2*ds.padding,_l=(ds.y2-ds.y1)*zc+2*ds.padding,sc=It&&!ot?Ha:null;sc&&Rs(sc);let Uc={box:[],offscreen:!1,occluded:!1};const Er=Je?2*yo.length:yo.length;for(let Ah=0;Ah<Er;++Ah){const Uf=this.attemptAnchorPlacement(yo[Ah%yo.length],ds,ih,_l,zc,Ct,_t,fe,z,qe,Ah>=yo.length,Xt,yn,P,Wa,sc,Ue,Ge);if(Uf&&(Uc=Uf.placedGlyphBoxes,Uc&&Uc.box&&Uc.box.length)){Vt=!0,wi=Uf.shift;break}}return Uc};xs(()=>ya(Fa,sn.iconBox,p.WritingMode.horizontal),()=>{const ds=sn.verticalTextBox;return ds&&Rs(ds),P.allowVerticalPlacement&&!(gr&&gr.box&&gr.box.length)&&Ht>0&&ds?ya(ds,sn.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),gr&&(Vt=gr.box,xn=gr.offscreen,Pn=gr.occluded);const nl=Vs(gr&&gr.box);if(!Vt&&this.prevPlacement){const ds=this.prevPlacement.variableOffsets[An];ds&&(this.variableOffsets[An]=ds,this.markUsedJustification(P,ds.anchor,Xt,nl))}}else{const yo=(ya,nl)=>{const ds=P.getSymbolInstanceTextSize(Ue,Xt,this.transform.zoom,yn),Ha=this.collisionIndex.placeCollisionBox(P,ds,ya,new p.pointGeometry(0,0),Je,fe,z,qe.predicate);return Ha&&Ha.box&&Ha.box.length&&(this.markUsedOrientation(P,nl,Xt),this.placedOrientations[An]=nl),Ha};xs(()=>yo(Fa,p.WritingMode.horizontal),()=>{const ya=sn.verticalTextBox;return P.allowVerticalPlacement&&Ht>0&&ya?(Rs(ya),yo(ya,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Vs(gr&&gr.box&&gr.box.length)}}if(Ir=gr,Vt=Ir&&Ir.box&&Ir.box.length>0,xn=Ir&&Ir.offscreen,Pn=Ir&&Ir.occluded,Xt.useRuntimeCollisionCircles){const Vs=P.text.placedSymbolArray.get(Xt.centerJustifiedTextSymbolIndex>=0?Xt.centerJustifiedTextSymbolIndex:Xt.verticalPlacedTextSymbolIndex),xs=p.evaluateSizeForFeature(P.textSizeData,Ue,Vs),yo=F.get("text-padding");qi=this.collisionIndex.placeCollisionCircles(P,Je,Vs,P.lineVertexArray,P.glyphOffsetArray,xs,z,j,W,C,_t,qe.predicate,Xt.collisionCircleDiameter*xs/p.ONE_EM,yo,this.retainedQueryData[P.bucketInstanceId].tileID),Vt=Je||qi.circles.length>0&&!qi.collisionDetected,xn=xn&&qi.offscreen,Pn=qi.occluded}if(sn.iconFeatureIndex&&(fs=sn.iconFeatureIndex),sn.iconBox){const Vs=xs=>{Rs(xs);const yo=It&&wi?Gr(wi.x,wi.y,Ct,_t,this.transform.angle):new p.pointGeometry(0,0),ya=P.getSymbolInstanceIconSize(Ge,this.transform.zoom,Xt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(P,ya,xs,yo,ot,fe,z,qe.predicate)};or&&or.box&&or.box.length&&sn.verticalIconBox?(Br=Vs(sn.verticalIconBox),en=Br.box.length>0):(Br=Vs(sn.iconBox),en=Br.box.length>0),xn=xn&&Br.offscreen,br=Br.occluded}const cu=Ie||0===Xt.numHorizontalGlyphVertices&&0===Ht,Jl=tt||0===Xt.numIconVertices;if(cu||Jl?Jl?cu||(en=en&&Vt):Vt=en&&Vt:en=Vt=en&&Vt,Vt&&Ir&&Ir.box&&this.collisionIndex.insertCollisionBox(Ir.box,F.get("text-ignore-placement"),P.bucketInstanceId,or&&or.box&&rs?rs:ns,qe.ID),en&&Br&&this.collisionIndex.insertCollisionBox(Br.box,F.get("icon-ignore-placement"),P.bucketInstanceId,fs,qe.ID),qi&&(Vt&&this.collisionIndex.insertCollisionCircles(qi.circles,F.get("text-ignore-placement"),P.bucketInstanceId,ns,qe.ID),C)){const Vs=P.bucketInstanceId;let xs=this.collisionCircleArrays[Vs];void 0===xs&&(xs=this.collisionCircleArrays[Vs]=new bn);for(let yo=0;yo<qi.circles.length;yo+=4)xs.circles.push(qi.circles[yo+0]),xs.circles.push(qi.circles[yo+1]),xs.circles.push(qi.circles[yo+2]),xs.circles.push(qi.collisionDetected?1:0)}const Bc="globe"!==P.projection.name;Wt=Wt&&(Bc||!Pn),Qt=Qt&&(Bc||!br),this.placements[An]=new lo(Vt||Wt,en||Qt,xn||P.justReloaded),m[An]=!0};if(jt){const Xt=P.getSortedSymbolIndexes(this.transform.angle);for(let yn=Xt.length-1;yn>=0;--yn){const sn=Xt[yn];Bn(P.symbolInstances.get(sn),sn,P.collisionArrays[sn])}}else for(let Xt=c.symbolInstanceStart;Xt<c.symbolInstanceEnd;Xt++)Bn(P.symbolInstances.get(Xt),Xt,P.collisionArrays[Xt]);if(C&&P.bucketInstanceId in this.collisionCircleArrays){const Xt=this.collisionCircleArrays[P.bucketInstanceId];p.invert(Xt.invProjMatrix,z),Xt.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1}markUsedJustification(c,m,C,T){const{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:F,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:j,crossTileID:W}=C,Y=p.getAnchorJustification(m),fe=T===p.WritingMode.vertical?j:"left"===Y?P:"center"===Y?F:"right"===Y?z:-1;P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=fe>=0&&P!==fe?0:W),F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=fe>=0&&F!==fe?0:W),z>=0&&(c.text.placedSymbolArray.get(z).crossTileID=fe>=0&&z!==fe?0:W),j>=0&&(c.text.placedSymbolArray.get(j).crossTileID=fe>=0&&j!==fe?0:W)}markUsedOrientation(c,m,C){const T=m===p.WritingMode.horizontal||m===p.WritingMode.horizontalOnly?m:0,P=m===p.WritingMode.vertical?m:0,{leftJustifiedTextSymbolIndex:F,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:W}=C,Y=c.text.placedSymbolArray;F>=0&&(Y.get(F).placedOrientation=T),z>=0&&(Y.get(z).placedOrientation=T),j>=0&&(Y.get(j).placedOrientation=T),W>=0&&(Y.get(W).placedOrientation=P)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const m=this.prevPlacement;let C=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;const T=m?m.symbolFadeChange(c):1,P=m?m.opacities:{},F=m?m.variableOffsets:{},z=m?m.placedOrientations:{};for(const j in this.placements){const W=this.placements[j],Y=P[j];Y?(this.opacities[j]=new jr(Y,T,W.text,W.icon,null,W.clipped),C=C||W.text!==Y.text.placed||W.icon!==Y.icon.placed):(this.opacities[j]=new jr(null,T,W.text,W.icon,W.skipFade,W.clipped),C=C||W.text||W.icon)}for(const j in P){const W=P[j];if(!this.opacities[j]){const Y=new jr(W,T,!1,!1);Y.isHidden()||(this.opacities[j]=Y,C=C||W.text.placed||W.icon.placed)}}for(const j in F)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=F[j]);for(const j in z)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=z[j]);C?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:c)}updateLayerOpacities(c,m){const C={};for(const T of m){const P=T.getBucket(c);P&&T.latestFeatureIndex&&c.id===P.layerIds[0]&&this.updateBucketOpacities(P,C,T.collisionBoxArray)}}updateBucketOpacities(c,m,C){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const T=c.layers[0].layout,P=!!c.layers[0].dynamicFilter(),F=new jr(null,0,!1,!1,!0),z=T.get("text-allow-overlap"),j=T.get("icon-allow-overlap"),W=T.get("text-variable-anchor"),Y="map"===T.get("text-rotation-alignment"),fe="map"===T.get("text-pitch-alignment"),Ae="none"!==T.get("icon-text-fit"),Ve=new jr(null,0,z&&(j||!c.hasIconData()||T.get("icon-optional")),j&&(z||!c.hasTextData()||T.get("text-optional")),!0);!c.collisionArrays&&C&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(C);const Ue=(qe,Ie,tt)=>{for(let Je=0;Je<Ie/4;Je++)qe.opacityVertexArray.emplaceBack(tt)};let Ge=0;for(let qe=0;qe<c.symbolInstances.length;qe++){const Ie=c.symbolInstances.get(qe),{numHorizontalGlyphVertices:tt,numVerticalGlyphVertices:Je,crossTileID:ot,numIconVertices:Ct}=Ie;let _t=this.opacities[ot];m[ot]?_t=F:_t||(_t=Ve,this.opacities[ot]=_t),m[ot]=!0;const It=tt>0||Je>0,jt=Ct>0,Wt=this.placedOrientations[ot],Qt=Wt===p.WritingMode.vertical,Bn=Wt===p.WritingMode.horizontal||Wt===p.WritingMode.horizontalOnly;if(!It&&!jt||_t.isHidden()||Ge++,It){const Xt=$l(_t.text);Ue(c.text,tt,Qt?uo:Xt),Ue(c.text,Je,Bn?uo:Xt);const yn=_t.text.isHidden(),{leftJustifiedTextSymbolIndex:sn,centerJustifiedTextSymbolIndex:An,rightJustifiedTextSymbolIndex:Ht,verticalPlacedTextSymbolIndex:Vt}=Ie,en=c.text.placedSymbolArray,xn=yn||Qt?1:0;sn>=0&&(en.get(sn).hidden=xn),An>=0&&(en.get(An).hidden=xn),Ht>=0&&(en.get(Ht).hidden=xn),Vt>=0&&(en.get(Vt).hidden=yn||Bn?1:0);const Pn=this.variableOffsets[ot];Pn&&this.markUsedJustification(c,Pn.anchor,Ie,Wt);const br=this.placedOrientations[ot];br&&(this.markUsedJustification(c,"left",Ie,br),this.markUsedOrientation(c,br,Ie))}if(jt){const Xt=$l(_t.icon),{placedIconSymbolIndex:yn,verticalPlacedIconSymbolIndex:sn}=Ie,An=c.icon.placedSymbolArray,Ht=_t.icon.isHidden()?1:0;yn>=0&&(Ue(c.icon,Ct,Qt?uo:Xt),An.get(yn).hidden=Ht),sn>=0&&(Ue(c.icon,Ie.numVerticalIconVertices,Bn?uo:Xt),An.get(sn).hidden=Ht)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Xt=c.collisionArrays[qe];if(Xt){let yn=new p.pointGeometry(0,0),sn=!0;if(Xt.textBox||Xt.verticalTextBox){if(W){const Ht=this.variableOffsets[ot];Ht?(yn=Jr(Ht.anchor,Ht.width,Ht.height,Ht.textOffset,Ht.textScale),Y&&yn._rotate(fe?this.transform.angle:-this.transform.angle)):sn=!1}P&&(sn=!_t.clipped),Xt.textBox&&pl(c.textCollisionBox.collisionVertexArray,_t.text.placed,!sn||Qt,yn.x,yn.y),Xt.verticalTextBox&&pl(c.textCollisionBox.collisionVertexArray,_t.text.placed,!sn||Bn,yn.x,yn.y)}const An=sn&&Boolean(!Bn&&Xt.verticalIconBox);Xt.iconBox&&pl(c.iconCollisionBox.collisionVertexArray,_t.icon.placed,An,Ae?yn.x:0,Ae?yn.y:0),Xt.verticalIconBox&&pl(c.iconCollisionBox.collisionVertexArray,_t.icon.placed,!An,Ae?yn.x:0,Ae?yn.y:0)}}}if(c.fullyClipped=0===Ge,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=qe.invProjMatrix,c.placementViewportMatrix=qe.viewportMatrix,c.collisionCircleArray=qe.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,m){const C=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*C>c}setStale(){this.stale=!0}}function pl(b,c,m,C,T){b.emplaceBack(c?1:0,m?1:0,C||0,T||0),b.emplaceBack(c?1:0,m?1:0,C||0,T||0),b.emplaceBack(c?1:0,m?1:0,C||0,T||0),b.emplaceBack(c?1:0,m?1:0,C||0,T||0)}const ji=Math.pow(2,25),ec=Math.pow(2,24),zn=Math.pow(2,17),Ci=Math.pow(2,16),Ms=Math.pow(2,9),bs=Math.pow(2,8),ha=Math.pow(2,1);function $l(b){if(0===b.opacity&&!b.placed)return 0;if(1===b.opacity&&b.placed)return 4294967295;const c=b.placed?1:0,m=Math.floor(127*b.opacity);return m*ji+c*ec+m*zn+c*Ci+m*Ms+c*bs+m*ha+c}const uo=0;class Ns{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,m,C,T,P){const F=this._bucketParts;for(;this._currentTileIndex<c.length;)if(m.getBucketParts(F,T,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,F.sort((z,j)=>z.sortKey-j.sortKey));this._currentPartIndex<F.length;){const z=F[this._currentPartIndex];if(m.placeLayerBucketPart(z,this._seenCrossTileIDs,C,0===z.symbolInstanceStart),this._currentPartIndex++,P())return!0}return!1}}class ou{constructor(c,m,C,T,P,F,z,j){this.placement=new vi(c,P,F,z,j),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=C,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(c,m,C){const T=p.exported.now(),P=()=>{const F=p.exported.now()-T;return!this._forceFullPlacement&&F>2};for(;this._currentPlacementIndex>=0;){const F=m[c[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if("symbol"===F.type&&(!F.minzoom||F.minzoom<=z)&&(!F.maxzoom||F.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Ns(F)),this._inProgressLayer.continuePlacement(C[F.source],this.placement,this._showCollisionBoxes,F,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const xa=512/p.EXTENT/2;class ql{constructor(c,m,C){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=C;for(let T=0;T<m.length;T++){const P=m.get(T),F=P.key;this.indexedSymbolInstances[F]||(this.indexedSymbolInstances[F]=[]),this.indexedSymbolInstances[F].push({crossTileID:P.crossTileID,coord:this.getScaledCoordinates(P,c)})}}getScaledCoordinates(c,m){const C=xa/Math.pow(2,m.canonical.z-this.tileID.canonical.z);return{x:Math.floor((m.canonical.x*p.EXTENT+c.tileAnchorX)*C),y:Math.floor((m.canonical.y*p.EXTENT+c.tileAnchorY)*C)}}findMatches(c,m,C){const T=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z);for(let P=0;P<c.length;P++){const F=c.get(P);if(F.crossTileID)continue;const z=this.indexedSymbolInstances[F.key];if(!z)continue;const j=this.getScaledCoordinates(F,m);for(const W of z)if(Math.abs(W.coord.x-j.x)<=T&&Math.abs(W.coord.y-j.y)<=T&&!C[W.crossTileID]){C[W.crossTileID]=!0,F.crossTileID=W.crossTileID;break}}}}class Cl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const m=Math.round((c-this.lng)/360);if(0!==m)for(const C in this.indexes){const T=this.indexes[C],P={};for(const F in T){const z=T[F];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+m),P[z.tileID.key]=z}this.indexes[C]=P}this.lng=c}addBucket(c,m,C){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let P=0;P<m.symbolInstances.length;P++)m.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const T=this.usedCrossTileIDs[c.overscaledZ];for(const P in this.indexes){const F=this.indexes[P];if(Number(P)>c.overscaledZ)for(const z in F){const j=F[z];j.tileID.isChildOf(c)&&j.findMatches(m.symbolInstances,c,T)}else{const z=F[c.scaledTo(Number(P)).key];z&&z.findMatches(m.symbolInstances,c,T)}}for(let P=0;P<m.symbolInstances.length;P++){const F=m.symbolInstances.get(P);F.crossTileID||(F.crossTileID=C.generate(),T[F.crossTileID]=!0)}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new ql(c,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(c,m){for(const C in m.indexedSymbolInstances)for(const T of m.indexedSymbolInstances[C])delete this.usedCrossTileIDs[c][T.crossTileID]}removeStaleBuckets(c){let m=!1;for(const C in this.indexes){const T=this.indexes[C];for(const P in T)c[T[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(C,T[P]),delete T[P],m=!0)}return m}}class fr{constructor(){this.layerIndexes={},this.crossTileIDs=new Cl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,m,C,T){let P=this.layerIndexes[c.id];void 0===P&&(P=this.layerIndexes[c.id]=new Sl);let F=!1;const z={};"globe"!==T.name&&P.handleWrapJump(C);for(const j of m){const W=j.getBucket(c);W&&c.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket(j.tileID,W,this.crossTileIDs)&&(F=!0),z[W.bucketInstanceId]=!0)}return P.removeStaleBuckets(z)&&(F=!0),F}pruneUnusedLayers(c){const m={};c.forEach(C=>{m[C]=!0});for(const C in this.layerIndexes)m[C]||delete this.layerIndexes[C]}}const Gu=(b,c)=>p.emitValidationErrors(b,c&&c.filter(m=>"source.canvas"!==m.identifier)),Da=p.pick(nr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),xi=p.pick(nr,["setCenter","setZoom","setBearing","setPitch"]),Es={version:8,layers:[],sources:{}},su={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ms extends p.Evented{constructor(c,m={}){super(),this.map=c,this.dispatcher=new Be(_r(),this),this.imageManager=new ne,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,m.localFontFamily?p.LocalGlyphMode.all:m.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,m.localFontFamily||m.localIdeographFontFamily),this.crossTileSymbolIndex=new fr,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const C=this;this._rtlTextPluginCallback=ms.registerForPluginStateChange(T=>{C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},(P,F)=>{if(p.triggerPluginCompletionEvent(P),F&&F.every(z=>z))for(const z in C._sourceCaches){const j=C._sourceCaches[z],W=j.getSource().type;"vector"!==W&&"geojson"!==W||j.reload()}})}),this.on("data",T=>{if("source"!==T.dataType||"metadata"!==T.sourceDataType)return;const P=this.getSource(T.sourceId);if(P&&P.vectorLayerIds)for(const F in this._layers){const z=this._layers[F];z.source===P.id&&this._validateLayer(z)}})}loadURL(c,m={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const C="boolean"==typeof m.validate?m.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,m.accessToken);const T=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(T,(P,F)=>{this._request=null,P?this.fire(new p.ErrorEvent(P)):F&&this._load(F,C)})}loadJSON(c,m={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==m.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Es,!1)}_updateLayerCount(c,m){const C=m?1:-1;c.is3D()&&(this._num3DLayers+=C),"circle"===c.type&&(this._numCircleLayers+=C),"symbol"===c.type&&(this._numSymbolLayers+=C)}_load(c,m){if(m&&Gu(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const T in c.sources)this.addSource(T,c.sources[T],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const C=Vr(this.stylesheet.layers);this._order=C.map(T=>T.id),this._layers={},this._serializedLayers={};for(let T of C)T=p.createStyleLayer(T),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new We(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(m,C,T){let P,F,z;const j=p.exported.devicePixelRatio>1?"@2x":"";let W=p.getJSON(C.transformRequest(C.normalizeSpriteURL(m,j,".json"),p.ResourceType.SpriteJSON),(Ae,Ve)=>{W=null,z||(z=Ae,P=Ve,fe())}),Y=p.getImage(C.transformRequest(C.normalizeSpriteURL(m,j,".png"),p.ResourceType.SpriteImage),(Ae,Ve)=>{Y=null,z||(z=Ae,F=Ve,fe())});function fe(){if(z)T(z);else if(P&&F){const Ae=p.exported.getImageData(F),Ve={};for(const Ue in P){const{width:Ge,height:qe,x:Ie,y:tt,sdf:Je,pixelRatio:ot,stretchX:Ct,stretchY:_t,content:It}=P[Ue],jt=new p.RGBAImage({width:Ge,height:qe});p.RGBAImage.copy(Ae,jt,{x:Ie,y:tt},{x:0,y:0},{width:Ge,height:qe}),Ve[Ue]={data:jt,pixelRatio:ot,sdf:Je,stretchX:Ct,stretchY:_t,content:It}}T(null,Ve)}}return{cancel(){W&&(W.cancel(),W=null),Y&&(Y.cancel(),Y=null)}}}(c,this.map._requestManager,(m,C)=>{if(this._spriteRequest=null,m)this.fire(new p.ErrorEvent(m));else if(C)for(const T in C)this.imageManager.addImage(T,C[T]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const m=this.getSource(c.source);if(!m)return;const C=c.sourceLayer;C&&("geojson"===m.type||m.vectorLayerIds&&-1===m.vectorLayerIds.indexOf(C))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${C}" does not exist on source "${m.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const m=[];for(const C of c){const T=this._layers[C];"custom"!==T.type&&m.push(T.serialize())}return m}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():su[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const m=this._changed;if(this._changed){const T=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);(T.length||P.length)&&this._updateWorkerLayers(T,P);for(const F in this._updatedSources){const z=this._updatedSources[F];"reload"===z?this._reloadSource(F):"clear"===z&&this._clearSource(F)}this._updateTilesForChangedImages();for(const F in this._updatedPaintProps)this._layers[F].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const C={};for(const T in this._sourceCaches){const P=this._sourceCaches[T];C[T]=P.used,P.used=!1}for(const T of this._order){const P=this._layers[T];if(P.recalculate(c,this._availableImages),!P.isHidden(c.zoom)){const z=this._getLayerSourceCache(P);z&&(z.used=!0)}const F=this.map.painter;if(F){const z=P.getProgramIds();if(!z)continue;const j=P.getProgramConfiguration(c.zoom);for(const W of z)F.useProgram(W,j)}}for(const T in C){const P=this._sourceCaches[T];C[T]!==P.used&&P.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const m in this._sourceCaches)this._sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Gu(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=Vr(c.layers);const m=function(T,P){if(!T)return[{command:nr.setStyle,args:[P]}];let F=[];try{if(!K(T.version,P.version))return[{command:nr.setStyle,args:[P]}];K(T.center,P.center)||F.push({command:nr.setCenter,args:[P.center]}),K(T.zoom,P.zoom)||F.push({command:nr.setZoom,args:[P.zoom]}),K(T.bearing,P.bearing)||F.push({command:nr.setBearing,args:[P.bearing]}),K(T.pitch,P.pitch)||F.push({command:nr.setPitch,args:[P.pitch]}),K(T.sprite,P.sprite)||F.push({command:nr.setSprite,args:[P.sprite]}),K(T.glyphs,P.glyphs)||F.push({command:nr.setGlyphs,args:[P.glyphs]}),K(T.transition,P.transition)||F.push({command:nr.setTransition,args:[P.transition]}),K(T.light,P.light)||F.push({command:nr.setLight,args:[P.light]}),K(T.fog,P.fog)||F.push({command:nr.setFog,args:[P.fog]}),K(T.projection,P.projection)||F.push({command:nr.setProjection,args:[P.projection]});const z={},j=[];!function(fe,Ae,Ve,Ue){let Ge;for(Ge in Ae=Ae||{},fe=fe||{})fe.hasOwnProperty(Ge)&&(Ae.hasOwnProperty(Ge)||Zr(Ge,Ve,Ue));for(Ge in Ae)Ae.hasOwnProperty(Ge)&&(fe.hasOwnProperty(Ge)?K(fe[Ge],Ae[Ge])||("geojson"===fe[Ge].type&&"geojson"===Ae[Ge].type&&Xi(fe,Ae,Ge)?Ve.push({command:nr.setGeoJSONSourceData,args:[Ge,Ae[Ge].data]}):Wi(Ge,Ae,Ve,Ue)):Pi(Ge,Ae,Ve))}(T.sources,P.sources,j,z);const W=[];T.layers&&T.layers.forEach(fe=>{fe.source&&z[fe.source]?F.push({command:nr.removeLayer,args:[fe.id]}):W.push(fe)});let Y=T.terrain;Y&&z[Y.source]&&(F.push({command:nr.setTerrain,args:[void 0]}),Y=void 0),F=F.concat(j),K(Y,P.terrain)||F.push({command:nr.setTerrain,args:[P.terrain]}),function(fe,Ae,Ve){Ae=Ae||[];const Ue=(fe=fe||[]).map(ca),Ge=Ae.map(ca),qe=fe.reduce(so,{}),Ie=Ae.reduce(so,{}),tt=Ue.slice(),Je=Object.create(null);let ot,Ct,_t,It,jt,Wt,Qt;for(ot=0,Ct=0;ot<Ue.length;ot++)_t=Ue[ot],Ie.hasOwnProperty(_t)?Ct++:(Ve.push({command:nr.removeLayer,args:[_t]}),tt.splice(tt.indexOf(_t,Ct),1));for(ot=0,Ct=0;ot<Ge.length;ot++)_t=Ge[Ge.length-1-ot],tt[tt.length-1-ot]!==_t&&(qe.hasOwnProperty(_t)?(Ve.push({command:nr.removeLayer,args:[_t]}),tt.splice(tt.lastIndexOf(_t,tt.length-Ct),1)):Ct++,Wt=tt[tt.length-ot],Ve.push({command:nr.addLayer,args:[Ie[_t],Wt]}),tt.splice(tt.length-ot,0,_t),Je[_t]=!0);for(ot=0;ot<Ge.length;ot++)if(_t=Ge[ot],It=qe[_t],jt=Ie[_t],!Je[_t]&&!K(It,jt))if(K(It.source,jt.source)&&K(It["source-layer"],jt["source-layer"])&&K(It.type,jt.type)){for(Qt in Yt(It.layout,jt.layout,Ve,_t,null,nr.setLayoutProperty),Yt(It.paint,jt.paint,Ve,_t,null,nr.setPaintProperty),K(It.filter,jt.filter)||Ve.push({command:nr.setFilter,args:[_t,jt.filter]}),K(It.minzoom,jt.minzoom)&&K(It.maxzoom,jt.maxzoom)||Ve.push({command:nr.setLayerZoomRange,args:[_t,jt.minzoom,jt.maxzoom]}),It)It.hasOwnProperty(Qt)&&"layout"!==Qt&&"paint"!==Qt&&"filter"!==Qt&&"metadata"!==Qt&&"minzoom"!==Qt&&"maxzoom"!==Qt&&(0===Qt.indexOf("paint.")?Yt(It[Qt],jt[Qt],Ve,_t,Qt.slice(6),nr.setPaintProperty):K(It[Qt],jt[Qt])||Ve.push({command:nr.setLayerProperty,args:[_t,Qt,jt[Qt]]}));for(Qt in jt)jt.hasOwnProperty(Qt)&&!It.hasOwnProperty(Qt)&&"layout"!==Qt&&"paint"!==Qt&&"filter"!==Qt&&"metadata"!==Qt&&"minzoom"!==Qt&&"maxzoom"!==Qt&&(0===Qt.indexOf("paint.")?Yt(It[Qt],jt[Qt],Ve,_t,Qt.slice(6),nr.setPaintProperty):K(It[Qt],jt[Qt])||Ve.push({command:nr.setLayerProperty,args:[_t,Qt,jt[Qt]]}))}else Ve.push({command:nr.removeLayer,args:[_t]}),Wt=tt[tt.lastIndexOf(_t)+1],Ve.push({command:nr.addLayer,args:[jt,Wt]})}(W,P.layers,F)}catch(z){console.warn("Unable to compute style diff:",z),F=[{command:nr.setStyle,args:[P]}]}return F}(this.serialize(),c).filter(T=>!(T.command in xi));if(0===m.length)return!1;const C=m.filter(T=>!(T.command in Da));if(C.length>0)throw new Error(`Unimplemented: ${C.map(T=>T.command).join(", ")}.`);return m.forEach(T=>{"setTransition"!==T.command&&"setProjection"!==T.command&&this[T.command].apply(this,T.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,m){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,m),this._afterImageUpdated(c),this)}updateImage(c,m){this.imageManager.updateImage(c,m)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,m,C={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(p.validateSource,`sources.${c}`,m,null,C))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);const T=Pt(c,m,this.dispatcher,this);T.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:T.serialize(),sourceId:c}));const P=F=>{const z=(F?"symbol:":"other:")+c,j=this._sourceCaches[z]=new p.SourceCache(z,T,F);(F?this._symbolSourceCaches:this._otherSourceCaches)[c]=j,j.style=this,j.onAdd(this.map)};P(!1),"vector"!==m.type&&"geojson"!==m.type||P(!0),T.onAdd&&T.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const m=this.getSource(c);if(!m)throw new Error("There is no source with this ID");for(const T in this._layers)if(this._layers[T].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${T}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const C=this._getSourceCaches(c);for(const T of C)delete this._sourceCaches[T.id],delete this._updatedSources[T.id],T.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:T.getSource().id})),T.setEventedParent(null),T.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],m.setEventedParent(null),m.onRemove&&m.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,m){this._checkLoaded(),this.getSource(c).setData(m),this._changed=!0}getSource(c){const m=this._getSourceCache(c);return m&&m.getSource()}_getSources(){const c=[];for(const m in this._otherSourceCaches){const C=this._getSourceCache(m);C&&c.push(C.getSource())}return c}addLayer(c,m,C={}){this._checkLoaded();const T=c.id;if(this.getLayer(T))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${T}" already exists on this map`)));let P;if("custom"===c.type){if(Gu(this,p.validateCustomStyleLayer(c)))return;P=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(T,c.source),c=p.clone$1(c),c=p.extend(c,{source:T})),this._validate(p.validateLayer,`layers.${T}`,c,{arrayIndex:-1},C))return;P=p.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[P.id]=P.serialize(),this._updateLayerCount(P,!0)}const F=m?this._order.indexOf(m):this._order.length;if(m&&-1===F)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${m}" does not exist on this map.`)));this._order.splice(F,0,T),this._layerOrderChanged=!0,this._layers[T]=P;const z=this._getLayerSourceCache(P);if(this._removedLayers[T]&&P.source&&z&&"custom"!==P.type){const j=this._removedLayers[T];delete this._removedLayers[T],j.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",z.pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,m){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===m)return;const C=this._order.indexOf(c);this._order.splice(C,1);const T=m?this._order.indexOf(m):this._order.length;m&&-1===T?this.fire(new p.ErrorEvent(new Error(`Layer with id "${m}" does not exist on this map.`))):(this._order.splice(T,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const m=this._layers[c];if(!m)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));m.setEventedParent(null),this._updateLayerCount(m,!1);const C=this._order.indexOf(c);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=m,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],m.onRemove&&m.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const m in this._layers)if(this._layers[m].type===c)return!0;return!1}setLayerZoomRange(c,m,C){this._checkLoaded();const T=this.getLayer(c);T?T.minzoom===m&&T.maxzoom===C||(null!=m&&(T.minzoom=m),null!=C&&(T.maxzoom=C),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,m,C={}){this._checkLoaded();const T=this.getLayer(c);if(T){if(!K(T.filter,m))return null==m?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(p.validateFilter,`layers.${T.id}.filter`,m,{layerType:T.type},C)||(T.filter=p.clone$1(m),this._updateLayer(T)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const m=this.getLayer(c);return m&&p.clone$1(m.filter)}setLayoutProperty(c,m,C,T={}){this._checkLoaded();const P=this.getLayer(c);P?K(P.getLayoutProperty(m),C)||(P.setLayoutProperty(m,C,T),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,m){const C=this.getLayer(c);if(C)return C.getLayoutProperty(m);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,m,C,T={}){this._checkLoaded();const P=this.getLayer(c);P?K(P.getPaintProperty(m),C)||(P.setPaintProperty(m,C,T)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,m){const C=this.getLayer(c);return C&&C.getPaintProperty(m)}setFeatureState(c,m){this._checkLoaded();const C=c.source,T=c.sourceLayer,P=this.getSource(C);if(!P)return void this.fire(new p.ErrorEvent(new Error(`The source '${C}' does not exist in the map's style.`)));const F=P.type;if("geojson"===F&&T)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===F&&!T)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const z=this._getSourceCaches(C);for(const j of z)j.setFeatureState(T,c.id,m)}removeFeatureState(c,m){this._checkLoaded();const C=c.source,T=this.getSource(C);if(!T)return void this.fire(new p.ErrorEvent(new Error(`The source '${C}' does not exist in the map's style.`)));const P=T.type,F="vector"===P?c.sourceLayer:void 0;if("vector"===P&&!F)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(m&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const z=this._getSourceCaches(C);for(const j of z)j.removeFeatureState(F,c.id,m)}getFeatureState(c){this._checkLoaded();const m=c.source,C=c.sourceLayer,T=this.getSource(m);if(T){if("vector"!==T.type||C)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(m)[0].getFeatureState(C,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const m in this._sourceCaches){const C=this._sourceCaches[m].getSource();c[C.id]||(c[C.id]=C.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},m=>void 0!==m)}_updateLayer(c){this._updatedLayers[c.id]=!0;const m=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&m&&"raster"!==m.getSource().type&&(this._updatedSources[c.source]="reload",m.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const m=F=>"fill-extrusion"===this._layers[F].type,C={},T=[];for(let F=this._order.length-1;F>=0;F--){const z=this._order[F];if(m(z)){C[z]=F;for(const j of c){const W=j[z];if(W)for(const Y of W)T.push(Y)}}}T.sort((F,z)=>z.intersectionZ-F.intersectionZ);const P=[];for(let F=this._order.length-1;F>=0;F--){const z=this._order[F];if(m(z))for(let j=T.length-1;j>=0;j--){const W=T[j].feature;if(C[W.layer.id]<F)break;P.push(W),T.pop()}else for(const j of c){const W=j[z];if(W)for(const Y of W)P.push(Y.feature)}}return P}queryRenderedFeatures(c,m,C){m&&m.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",m.filter,null,m);const T={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const j of m.layers){const W=this._layers[j];if(!W)return this.fire(new p.ErrorEvent(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];T[W.source]=!0}}const P=[];m.availableImages=this._availableImages;const F=m&&m.layers?m.layers.some(j=>{const W=this.getLayer(j);return W&&W.is3D()}):this.has3DLayers(),z=$t.createFromScreenPoints(c,C);for(const j in this._sourceCaches){const W=this._sourceCaches[j].getSource().id;m.layers&&!T[W]||P.push(zt(this._sourceCaches[j],this._layers,this._serializedLayers,z,m,C,F,!!this.map._showQueryGeometry))}return this.placement&&P.push(function(j,W,Y,fe,Ae,Ve,Ue){const Ge={},qe=Ve.queryRenderedSymbols(fe),Ie=[];for(const tt of Object.keys(qe).map(Number))Ie.push(Ue[tt]);Ie.sort(Fn);for(const tt of Ie){const Je=tt.featureIndex.lookupSymbolFeatures(qe[tt.bucketInstanceId],W,tt.bucketIndex,tt.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,j);for(const ot in Je){const Ct=Ge[ot]=Ge[ot]||[],_t=Je[ot];_t.sort((It,jt)=>{const Wt=tt.featureSortOrder;if(Wt){const Qt=Wt.indexOf(It.featureIndex);return Wt.indexOf(jt.featureIndex)-Qt}return jt.featureIndex-It.featureIndex});for(const It of _t)Ct.push(It)}}for(const tt in Ge)Ge[tt].forEach(Je=>{const ot=Je.feature,Ct=Y(j[tt]).getFeatureState(ot.layer["source-layer"],ot.id);ot.source=ot.layer.source,ot.layer["source-layer"]&&(ot.sourceLayer=ot.layer["source-layer"]),ot.state=Ct});return Ge}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),z.screenGeometry,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(c,m){m&&m.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",m.filter,null,m);const C=this._getSourceCaches(c);let T=[];for(const P of C)T=T.concat(dn(P,m));return T}addSourceType(c,m,C){return ms.getSourceType(c)?C(new Error(`A source type called "${c}" already exists.`)):(ms.setSourceType(c,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:m.workerSourceURL},C):C(null,null))}getLight(){return this.light.getLight()}setLight(c,m={}){this._checkLoaded();const C=this.light.getLight();let T=!1;for(const F in c)if(!K(c[F],C[F])){T=!0;break}if(!T)return;const P=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,m),this.light.updateTransitions(P)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,m=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===m){if("object"==typeof c.source){const C="terrain-dem-src";this.addSource(C,c.source),c=p.clone$1(c),c=p.extend(c,{source:C})}if(this._validate(p.validateTerrain,"terrain",c))return}if(!this.terrain||this.terrain&&m!==this.terrain.drapeRenderMode)this._createTerrain(c,m);else{const C=this.terrain,T=C.get();for(const P of Object.keys(p.spec.terrain))!c.hasOwnProperty(P)&&p.spec.terrain[P].default&&(c[P]=p.spec.terrain[P].default);for(const P in c)if(!K(c[P],T[P])){C.set(c),this.stylesheet.terrain=c;const F=this._setTransitionParameters({duration:0});C.updateTransitions(F);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const m=this.fog=new xt(c,this.map.transform);this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});m.updateTransitions(C)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const m=this.fog,C=m.get();0===Object.keys(c).length&&m.set(c);for(const T in c)if(!K(c[T],C[T])){m.set(c),this.stylesheet.fog=c;const P=this._setTransitionParameters({duration:0});m.updateTransitions(P);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(C=>this.isLayerDraped(this._layers[C])),m=this._order.filter(C=>!this.isLayerDraped(this._layers[C]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...m)}_createTerrain(c,m){const C=this.terrain=new Bt(c,m);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const T=this._setTransitionParameters({duration:0});C.updateTransitions(T)}_force3DLayerUpdate(){for(const c in this._layers){const m=this._layers[c];"fill-extrusion"===m.type&&this._updateLayer(m)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const m=this._layers[c];"symbol"===m.type&&this._updateLayer(m)}}_validate(c,m,C,T,P={}){return(!P||!1!==P.validate)&&Gu(this,c.call(p.validateStyle,p.extend({key:m,style:this.serialize(),value:C,styleSpec:p.spec},T)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const m=this._getSourceCaches(c);for(const C of m)C.clearTiles()}_reloadSource(c){const m=this._getSourceCaches(c);for(const C of m)C.resume(),C.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const m in this._sourceCaches)this._sourceCaches[m].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const m=this._sourceCaches[c];m.resume(),m.reload()}}_updatePlacement(c,m,C,T,P=!1){let F=!1,z=!1;const j={};for(const W of this._order){const Y=this._layers[W];if("symbol"!==Y.type)continue;if(!j[Y.source]){const Ae=this._getLayerSourceCache(Y);if(!Ae)continue;j[Y.source]=Ae.getRenderableIds(!0).map(Ve=>Ae.getTileByID(Ve)).sort((Ve,Ue)=>Ue.tileID.overscaledZ-Ve.tileID.overscaledZ||(Ve.tileID.isLessThan(Ue.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(Y,j[Y.source],c.center.lng,c.projection);F=F||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),P=P||this._layerOrderChanged||0===C,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new ou(c,this._order,P,m,C,T,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),z=!0),F&&this.pauseablePlacement.placement.setStale()),z||F)for(const W of this._order){const Y=this._layers[W];"symbol"===Y.type&&this.placement.updateLayerOpacities(Y,j[Y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,m,C){this.imageManager.getImages(m.icons,C),this._updateTilesForChangedImages();const T=P=>{P&&P.setDependencies(m.tileID.key,m.type,m.icons)};T(this._otherSourceCaches[m.source]),T(this._symbolSourceCaches[m.source])}getGlyphs(c,m,C){this.glyphManager.getGlyphs(m.stacks,C)}getResource(c,m,C){return p.makeRequest(m,C)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const m=[];return this._otherSourceCaches[c]&&m.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&m.push(this._symbolSourceCaches[c]),m}_isSourceCacheLoaded(c){const m=this._getSourceCaches(c);return 0===m.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):m.every(C=>C.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ms.getSourceType=function(b){return Ut[b]},ms.setSourceType=function(b,c){Ut[b]=c},ms.registerForPluginStateChange=p.registerForPluginStateChange;var ia="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ih="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",sf="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",bo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Zi="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let fa={},Au={};const oa=[];gl(ia,oa),gl(sf,oa),gl(bo,oa),gl(Zi,oa),fa=Ur("",sf),Au=Ur(Zi,bo);const Ri=Ur("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),go=ia,wr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var wc={background:Ur("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ur("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ur("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ur("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ur("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ur("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ur("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ur("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ur("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ur("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ur("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ur("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ur("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ur("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ur("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ur("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ur("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ur("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ur("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ur("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ur("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ur("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ur("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Ur("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ur("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ih),skyboxGradient:Ur("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ih),skyboxCapture:Ur("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ur("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ur("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function gl(b,c){const m=b.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let C of m)if(C=C.trim(),"#"===C[0]&&C.includes("if")&&!C.includes("endif")){C=C.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const T=C.split(" ");for(const P of T)c.includes(P)||c.push(P)}}function Ur(b,c){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,C=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T={},P=[...oa];return gl(b,P),gl(c,P),{fragmentSource:b=b.replace(m,(F,z,j,W,Y)=>(T[Y]=!0,"define"===z?`\n#ifndef HAS_UNIFORM_u_${Y}\nvarying ${j} ${W} ${Y};\n#else\nuniform ${j} ${W} u_${Y};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Y}\n    ${j} ${W} ${Y} = u_${Y};\n#endif\n`)),vertexSource:c=c.replace(m,(F,z,j,W,Y)=>{const fe="float"===W?"vec2":"vec4",Ae=Y.match(/color/)?"color":fe;return T[Y]?"define"===z?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${j} ${fe} a_${Y};\nvarying ${j} ${W} ${Y};\n#else\nuniform ${j} ${W} u_${Y};\n#endif\n`:"vec4"===Ae?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = a_${Y};\n#else\n    ${j} ${W} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = unpack_mix_${Ae}(a_${Y}, u_${Y}_t);\n#else\n    ${j} ${W} ${Y} = u_${Y};\n#endif\n`:"define"===z?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${j} ${fe} a_${Y};\n#else\nuniform ${j} ${W} u_${Y};\n#endif\n`:"vec4"===Ae?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${j} ${W} ${Y} = a_${Y};\n#else\n    ${j} ${W} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${j} ${W} ${Y} = unpack_mix_${Ae}(a_${Y}, u_${Y}_t);\n#else\n    ${j} ${W} ${Y} = u_${Y};\n#endif\n`}),staticAttributes:C,usedDefines:P}}class ea{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,m,C,T,P,F,z){this.context=c;let j=this.boundPaintVertexBuffers.length!==T.length;for(let Y=0;!j&&Y<T.length;Y++)this.boundPaintVertexBuffers[Y]!==T[Y]&&(j=!0);let W=this.boundDynamicVertexBuffers.length!==z.length;for(let Y=0;!W&&Y<z.length;Y++)this.boundDynamicVertexBuffers[Y]!==z[Y]&&(W=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==C||j||W||this.boundIndexBuffer!==P||this.boundVertexOffset!==F)this.freshBind(m,C,T,P,F,z);else{c.bindVertexArrayOES.set(this.vao);for(const Y of z)Y&&Y.bind();P&&P.dynamicDraw&&P.bind()}}freshBind(c,m,C,T,P,F){let z;const j=c.numAttributes,W=this.context,Y=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=c,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=C,this.boundIndexBuffer=T,this.boundVertexOffset=P,this.boundDynamicVertexBuffers=F;else{z=W.currentNumAttributes||0;for(let fe=j;fe<z;fe++)Y.disableVertexAttribArray(fe)}m.enableAttributes(Y,c),m.bind(),m.setVertexAttribPointers(Y,c,P);for(const fe of C)fe.enableAttributes(Y,c),fe.bind(),fe.setVertexAttribPointers(Y,c,P);for(const fe of F)fe&&(fe.enableAttributes(Y,c),fe.bind(),fe.setVertexAttribPointers(Y,c,P));T&&T.bind(),W.currentNumAttributes=j}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hl(b,c){const m=Math.pow(2,c.canonical.z),C=c.canonical.y;return[new p.MercatorCoordinate(0,C/m).toLngLat().lat,new p.MercatorCoordinate(0,(C+1)/m).toLngLat().lat]}function ja(b,c,m,C,T,P,F){const z=b.context,j=z.gl,W=m.fbo;if(!W)return;b.prepareDrawTile();const Y=b.useProgram("hillshade");z.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,W.colorAttachment.get());const fe=((Ge,qe,Ie,tt)=>{const Je=Ie.paint.get("hillshade-shadow-color"),ot=Ie.paint.get("hillshade-highlight-color"),Ct=Ie.paint.get("hillshade-accent-color");let _t=Ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Ie.paint.get("hillshade-illumination-anchor")&&(_t-=Ge.transform.angle);const It=!Ge.options.moving;return{u_matrix:tt||Ge.transform.calculateProjMatrix(qe.tileID.toUnwrapped(),It),u_image:0,u_latrange:Hl(0,qe.tileID),u_light:[Ie.paint.get("hillshade-exaggeration"),_t],u_shadow:Je,u_highlight:ot,u_accent:Ct}})(b,m,C,b.terrain?c.projMatrix:null);b.prepareDrawProgram(z,Y,c.toUnwrapped());const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:Ve,tileBoundsSegments:Ue}=b.getTileBoundsBuffers(m);Y.draw(z,j.TRIANGLES,T,P,F,p.CullFaceMode.disabled,fe,C.id,Ae,Ve,Ue)}function au(b,c,m){if(!c.needsDEMTextureUpload)return;const C=b.context,T=C.gl;C.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||b.getTileTexture(m.stride);const P=m.getPixels();c.demTexture?c.demTexture.update(P,{premultiply:!1}):c.demTexture=new p.Texture(C,P,T.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function bc(b,c,m,C,T,P){const F=b.context,z=F.gl;if(!c.dem)return;const j=c.dem;if(F.activeTexture.set(z.TEXTURE1),au(b,c,j),!c.demTexture)return;c.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);const W=j.dim;F.activeTexture.set(z.TEXTURE0);let Y=c.fbo;if(!Y){const Ue=new p.Texture(F,{width:W,height:W,data:null},z.RGBA);Ue.bind(z.LINEAR,z.CLAMP_TO_EDGE),Y=c.fbo=F.createFramebuffer(W,W,!0),Y.colorAttachment.set(Ue.texture)}F.bindFramebuffer.set(Y.framebuffer),F.viewport.set([0,0,W,W]);const{tileBoundsBuffer:fe,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Ve}=b.getMercatorTileBoundsBuffers();b.useProgram("hillshadePrepare").draw(F,z.TRIANGLES,C,T,P,p.CullFaceMode.disabled,((Ue,Ge)=>{const qe=Ge.stride,Ie=p.create();return p.ortho(Ie,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(Ie,Ie,[0,-p.EXTENT,0]),{u_matrix:Ie,u_image:1,u_dimension:[qe,qe],u_zoom:Ue.overscaledZ,u_unpack:Ge.unpackVector}})(c.tileID,j),m.id,fe,Ae,Ve),c.needsHillshadePrepare=!1}const ki=b=>({u_matrix:new p.UniformMatrix4f(b),u_image0:new p.Uniform1i(b),u_skirt_height:new p.Uniform1f(b)}),ls=(b,c)=>({u_matrix:b,u_image0:0,u_skirt_height:c}),us=(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue)=>({u_proj_matrix:Float32Array.from(b),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(C),u_merc_matrix:m,u_zoom_transition:T,u_merc_center:P,u_image0:0,u_frustum_tl:F,u_frustum_tr:z,u_frustum_br:j,u_frustum_bl:W,u_globe_pos:Y,u_globe_radius:fe,u_viewport:Ae,u_grid_matrix:Ue?Float32Array.from(Ue):new Float32Array(9),u_skirt_height:Ve});function $u(b,c){return null!=b&&null!=c&&!(!b.hasData()||!c.hasData())&&null!=b.demTexture&&null!=c.demTexture&&b.tileID.key!==c.tileID.key}const Fi=new class{constructor(){this.operations={}}newMorphing(b,c,m,C,T){if(b in this.operations){const P=this.operations[b];P.to.tileID.key!==m.tileID.key&&(P.queued=m)}else this.operations[b]={startTime:C,phase:0,duration:T,from:c,to:m,queued:null}}getMorphValuesForProxy(b){if(!(b in this.operations))return null;const c=this.operations[b];return{from:c.from,to:c.to,phase:c.phase}}update(b){for(const c in this.operations){const m=this.operations[c];for(m.phase=(b-m.startTime)/m.duration;m.phase>=1||!this._validOp(m);)if(!this._nextOp(m,b)){delete this.operations[c];break}}}_nextOp(b,c){return!!b.queued&&(b.from=b.to,b.to=b.queued,b.queued=null,b.phase=0,b.startTime=c,!0)}_validOp(b){return b.from.hasData()&&b.to.hasData()}},Xs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ur(b){return 6*Math.pow(1.5,22-b)}function Eo(b,c){const m=1<<b.z;return!c&&(0===b.x||b.x===m-1)||0===b.y||b.y===m-1}const er=b=>({u_matrix:b});function Ga(b,c,m,C,T){if(T>0){const P=p.exported.now(),F=(P-b.timeAdded)/T,z=c?(P-c.timeAdded)/T:-1,j=m.getSource(),W=C.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),Y=!c||Math.abs(c.tileID.overscaledZ-W)>Math.abs(b.tileID.overscaledZ-W),fe=Y&&b.refreshedUponExpiration?1:p.clamp(Y?F:1-z,0,1);return b.refreshedUponExpiration&&F>=1&&(b.refreshedUponExpiration=!1),c?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}class Ji extends p.SourceCache{constructor(c){const m={type:"raster-dem",maxzoom:c.transform.maxZoom},C=new Be(_r(),null),T=Pt("mock-dem",m,C,c.style);super("mock-dem",T,!1),T.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,m){c.state="loaded",m(null)}}class wa extends p.SourceCache{constructor(c){const m=Pt("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Be(_r(),null),c.style);super("proxy",m,!1),m.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,m,C){if(c.freezeTileCoverage)return;this.transform=c;const T=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((P,F)=>{if(P[F.key]="",!this._tiles[F.key]){const z=new p.Tile(F,this._source.tileSize*F.overscaleFactor(),c.tileZoom);z.state="loaded",this._tiles[F.key]=z}return P},{});for(const P in this._tiles)P in T||(this.freeFBO(P),this._tiles[P].unloadVectorData(),delete this._tiles[P])}freeFBO(c){const m=this.proxyCachedFBO[c];if(void 0!==m){const C=Object.values(m);this.renderCachePool.push(...C),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class lr extends p.OverscaledTileID{constructor(c,m,C){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=m,this.projMatrix=C}}class Yr extends p.Elevation{constructor(c,m){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[C,T,P]=function(j){const W=new p.StructArrayLayout2i4,Y=new p.StructArrayLayout3ui6;W.reserve(17161),Y.reserve(33800);const Ae=p.EXTENT/128,Ve=p.EXTENT+Ae/2,Ue=Ve+Ae;for(let qe=-Ae;qe<Ue;qe+=Ae)for(let Ie=-Ae;Ie<Ue;Ie+=Ae){const tt=Ie<0||Ie>Ve||qe<0||qe>Ve?24575:0,Je=p.clamp(Math.round(Ie),0,p.EXTENT),ot=p.clamp(Math.round(qe),0,p.EXTENT);W.emplaceBack(Je+tt,ot)}const Ge=(qe,Ie)=>{const tt=131*Ie+qe;Y.emplaceBack(tt+1,tt,tt+131),Y.emplaceBack(tt+131,tt+131+1,tt+1)};for(let qe=1;qe<129;qe++)for(let Ie=1;Ie<129;Ie++)Ge(Ie,qe);return[0,129].forEach(qe=>{for(let Ie=0;Ie<130;Ie++)Ge(Ie,qe),Ge(qe,Ie)}),[W,Y,32768]}(),F=c.context;this.gridBuffer=F.createVertexBuffer(C,p.posAttributes.members),this.gridIndexBuffer=F.createIndexBuffer(T),this.gridSegments=p.SegmentVector.simpleSegment(0,0,C.length,T.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,C.length,P),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new wa(m.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const z=F.gl;this._overlapStencilMode=new p.StencilMode({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=m,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ji(m.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,m,C){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const T=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(T.get("source")),this._exaggeration=T.get("exaggeration");const P=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(m,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),m.updateElevation(!0,C),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(m),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const m=this.proxySourceCache,C=this.painter.transform;this._initializing&&(this._initializing=0===C._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(C.center),-1),this._emptyDEMTextureDirty=!this._initializing);const T=this.proxyCoords=m.getIds().map(j=>{const W=m.getTileByID(j).tileID;return W.projMatrix=C.calculateProjMatrix(W.toUnwrapped()),W});(function(j,W){const Y=W.transform.pointCoordinate(W.transform.getCameraPoint()),fe=new p.pointGeometry(Y.x,Y.y);j.sort((Ae,Ve)=>{if(Ve.overscaledZ-Ae.overscaledZ)return Ve.overscaledZ-Ae.overscaledZ;const Ue=new p.pointGeometry(Ae.canonical.x+(1<<Ae.canonical.z)*Ae.wrap,Ae.canonical.y),Ge=new p.pointGeometry(Ve.canonical.x+(1<<Ve.canonical.z)*Ve.wrap,Ve.canonical.y),qe=fe.mult(1<<Ae.canonical.z);return qe.x-=.5,qe.y-=.5,qe.distSqr(Ue)-qe.distSqr(Ge)})})(T,this.painter),this._previousZoom=C.zoom;const P=this.proxyToSource||{};this.proxyToSource={},T.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const F=this._style._sourceCaches;for(const j in F){const W=F[j];if(!W.used||(W!==this.sourceCache&&this.resetTileLookupCache(W.id),this._setupProxiedCoordsForOrtho(W,c[j],P),W.usedForTerrain))continue;const Y=c[j];W.getSource().reparseOverscaled&&this._assignTerrainTiles(Y)}this.proxiedCoords[m.id]=T.map(j=>new lr(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(T),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(P),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const z={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const W=this.terrainTileForTile[j.key];if(!W)continue;const Y=W.tileID.key;Y in z||(this._visibleDemTiles.push(W),z[Y]=Y)}}_assignTerrainTiles(c){this._initializing||c.forEach(m=>{if(this.terrainTileForTile[m.key])return;const C=this._findTileCoveringTileID(m,this.sourceCache);C&&(this.terrainTileForTile[m.key]=C)})}_prepareDEMTextures(){const c=this.painter.context,m=c.gl;for(const C in this.terrainTileForTile){const T=this.terrainTileForTile[C],P=T.dem;!P||T.demTexture&&!T.needsDEMTextureUpload||(c.activeTexture.set(m.TEXTURE1),au(this.painter,T,P))}}_prepareDemTileUniforms(c,m,C,T){if(!m||null==m.demTexture)return!1;const P=c.tileID.canonical,F=Math.pow(2,m.tileID.canonical.z-P.z),z=T||"";return C[`u_dem_tl${z}`]=[P.x*F%1,P.y*F%1],C[`u_dem_scale${z}`]=F,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,m=c.gl;if(!this._emptyDepthBufferTexture){const C=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,C,m.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const m=this._visibleDemTiles.reduce((C,T)=>{if(!T.dem)return C;const P=T.dem.tree.minimums[0];return P>0&&c++,C+P},0);return c?m/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,m=c.gl;c.activeTexture.set(m.TEXTURE2);const C=this._getLoadedAreaMinimum(),T=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(C,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let P=this._emptyDEMTexture;return P?P.update(T,{premultiply:!1}):P=this._emptyDEMTexture=new p.Texture(c,T,m.RGBA,{premultiply:!1}),P}setupElevationDraw(c,m,C){const T=this.painter.context,P=T.gl,F=(z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var z;F.u_dem_size=this.sourceCache.getSource().tileSize,F.u_exaggeration=this.exaggeration();let j=null,W=null,Y=1;if(C&&C.morphing&&this._useVertexMorphing){const fe=C.morphing.srcDemTile,Ae=C.morphing.dstDemTile;Y=C.morphing.phase,fe&&Ae&&(this._prepareDemTileUniforms(c,fe,F,"_prev")&&(W=fe),this._prepareDemTileUniforms(c,Ae,F)&&(j=Ae))}if(W&&j?(T.activeTexture.set(P.TEXTURE2),j.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE,P.NEAREST),T.activeTexture.set(P.TEXTURE4),W.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE,P.NEAREST),F.u_dem_lerp=Y):(j=this.terrainTileForTile[c.tileID.key],T.activeTexture.set(P.TEXTURE2),(this._prepareDemTileUniforms(c,j,F)?j.demTexture:this.emptyDEMTexture).bind(P.NEAREST,P.CLAMP_TO_EDGE)),T.activeTexture.set(P.TEXTURE3),C&&C.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),this._depthFBO&&(F.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),F.u_depth_size_inv=[1,1]),C&&C.useMeterToDem&&j){const fe=(1<<j.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;F.u_meter_to_dem=fe}if(C&&C.labelPlaneMatrixInv&&(F.u_label_plane_matrix_inv=C.labelPlaneMatrixInv),m.setTerrainUniformValues(T,F),"globe"===this.painter.transform.projection.name){const fe=this.globeUniformValues(this.painter.transform,c.tileID.canonical,C&&C.useDenormalizedUpVectorScale);m.setGlobeUniformValues(T,fe)}}globeUniformValues(c,m,C){const T=c.projection;return{u_tile_tl_up:T.upVector(m,0,0),u_tile_tr_up:T.upVector(m,p.EXTENT,0),u_tile_br_up:T.upVector(m,p.EXTENT,p.EXTENT),u_tile_bl_up:T.upVector(m,0,p.EXTENT),u_tile_up_scale:C?p.globeMetersToEcef(1):T.upVectorScale(m,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const m=this.painter,C=this.painter.context;0!==c.length&&(C.bindFramebuffer.set(null),C.viewport.set([0,0,m.width,m.height]),m.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(T,P,F,z,j){if("globe"===T.transform.projection.name)!function(W,Y,fe,Ae,Ve){const Ue=W.context,Ge=Ue.gl;let qe,Ie;const tt=W.options.showTerrainWireframe?2:0,Je=W.transform,ot=p.globeUseCustomAntiAliasing(W,Ue,Je),Ct=(An,Ht)=>{if(Ie===An)return;const Vt=[Xs[An],"PROJECTION_GLOBE_VIEW"];ot&&Vt.push("CUSTOM_ANTIALIASING"),Ht&&Vt.push(Xs[tt]),qe=W.useProgram("globeRaster",null,Vt),Ie=An},_t=W.colorModeForRenderPass(),It=new p.DepthMode(Ge.LEQUAL,p.DepthMode.ReadWrite,W.depthRangeFor3D);Fi.update(Ve);const jt=p.calculateGlobeMercatorMatrix(Je),Wt=[p.mercatorXfromLng(Je.center.lng),p.mercatorYfromLat(Je.center.lat)],Qt=tt?[!1,!0]:[!1],Bn=W.globeSharedBuffers,Xt=[Je.width*p.exported.devicePixelRatio,Je.height*p.exported.devicePixelRatio],yn=Float32Array.from(Je.globeMatrix),sn={useDenormalizedUpVectorScale:!0};if(Qt.forEach(An=>{const Ht=W.transform,Vt=ur(Ht.zoom)*Y.exaggeration();Ie=-1;const en=An?Ge.LINES:Ge.TRIANGLES;for(const xn of Ae){const Pn=fe.getTile(xn),br=p.StencilMode.disabled,wi=Y.prevTerrainTileForTile[xn.key],gr=Y.terrainTileForTile[xn.key];$u(wi,gr)&&Fi.newMorphing(xn.key,wi,gr,Ve,250),Ue.activeTexture.set(Ge.TEXTURE0),Pn.texture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE);const or=Fi.getMorphValuesForProxy(xn.key),Ir=or?1:0;or&&p.extend$1(sn,{morphing:{srcDemTile:or.from,dstDemTile:or.to,phase:p.easeCubicInOut(or.phase)}});const qi=p.tileCornersToBounds(xn.canonical),Br=p.getLatitudinalLod(qi.getCenter().lat),ns=p.getGridMatrix(xn.canonical,qi,Br,Ht.worldSize/Ht._pixelsPerMercatorPixel),rs=p.globeNormalizeECEF(p.globeTileBounds(xn.canonical)),fs=us(Ht.projMatrix,yn,jt,rs,p.globeToMercatorTransition(Ht.zoom),Wt,Ht.frustumCorners.TL,Ht.frustumCorners.TR,Ht.frustumCorners.BR,Ht.frustumCorners.BL,Ht.globeCenterInViewSpace,Ht.globeRadius,Xt,Vt,ns);if(Ct(Ir,An),Y.setupElevationDraw(Pn,qe,sn),W.prepareDrawProgram(Ue,qe,xn.toUnwrapped()),Bn){const[Rs,Fa,cu]=An?Bn.getWirefameBuffers(W.context,Br):Bn.getGridBuffers(Br,0!==Vt);qe.draw(Ue,en,It,br,_t,p.CullFaceMode.backCCW,fs,"globe_raster",Rs,Fa,cu)}}}),Bn){const An=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ot&&An.push("CUSTOM_ANTIALIASING"),qe=W.useProgram("globeRaster",null,An);for(const Ht of Ae){const{x:Vt,y:en,z:xn}=Ht.canonical,Pn=0===en,br=en===(1<<xn)-1,[wi,gr,or,Ir]=Bn.getPoleBuffers(xn);if(Ir&&(Pn||br)){const qi=fe.getTile(Ht);Ue.activeTexture.set(Ge.TEXTURE0),qi.texture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE);let Br=p.globePoleMatrixForTile(xn,Vt,Je);const ns=p.globeNormalizeECEF(p.globeTileBounds(Ht.canonical)),rs=(fs,Rs)=>fs.draw(Ue,Ge.TRIANGLES,It,p.StencilMode.disabled,_t,p.CullFaceMode.disabled,us(Je.projMatrix,Br,Br,ns,0,Wt,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,Xt,0),"globe_pole_raster",Rs,or,Ir);Y.setupElevationDraw(qi,qe,sn),W.prepareDrawProgram(Ue,qe,Ht.toUnwrapped()),Pn&&rs(qe,wi),br&&(Br=p.scale(p.create(),Br,[1,-1,1]),rs(qe,gr))}}}}(T,P,F,z,j);else{const W=T.context,Y=W.gl;let fe,Ae;const Ve=T.options.showTerrainWireframe?2:0,Ue=(Je,ot)=>{if(Ae===Je)return;const Ct=[Xs[Je]];ot&&Ct.push(Xs[Ve]),fe=T.useProgram("terrainRaster",null,Ct),Ae=Je},Ge=T.colorModeForRenderPass(),qe=new p.DepthMode(Y.LEQUAL,p.DepthMode.ReadWrite,T.depthRangeFor3D);Fi.update(j);const Ie=T.transform,tt=ur(Ie.zoom)*P.exaggeration();(Ve?[!1,!0]:[!1]).forEach(Je=>{Ae=-1;const ot=Je?Y.LINES:Y.TRIANGLES,[Ct,_t]=Je?P.getWirefameBuffer():[P.gridIndexBuffer,P.gridSegments];for(const It of z){const jt=F.getTile(It),Wt=p.StencilMode.disabled,Qt=P.prevTerrainTileForTile[It.key],Bn=P.terrainTileForTile[It.key];$u(Qt,Bn)&&Fi.newMorphing(It.key,Qt,Bn,j,250),W.activeTexture.set(Y.TEXTURE0),jt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST);const Xt=Fi.getMorphValuesForProxy(It.key),yn=Xt?1:0;let sn;Xt&&(sn={morphing:{srcDemTile:Xt.from,dstDemTile:Xt.to,phase:p.easeCubicInOut(Xt.phase)}});const An=ls(It.projMatrix,Eo(It.canonical,Ie.renderWorldCopies)?tt/10:tt);Ue(yn,Je),P.setupElevationDraw(jt,fe,sn),T.prepareDrawProgram(W,fe,It.toUnwrapped()),fe.draw(W,ot,qe,Wt,Ge,p.CullFaceMode.backCCW,An,"terrain_raster",P.gridBuffer,Ct,_t)}})}}(m,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,m.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const m=this.painter,C=this.painter.context,T=this.proxySourceCache,P=this.proxiedCoords[T.id],F=this._drapedRenderBatches.shift(),z=[],j=m.style.order;let W=0;for(const Y of P){const fe=T.getTileByID(Y.proxyTileKey),Ae=T.proxyCachedFBO[Y.key]?T.proxyCachedFBO[Y.key][c]:void 0,Ve=void 0!==Ae?T.renderCache[Ae]:this.pool[W++],Ue=void 0!==Ae;if(fe.texture=Ve.tex,Ue&&!Ve.dirty){z.push(fe.tileID);continue}let Ge;C.bindFramebuffer.set(Ve.fb.framebuffer),this.renderedToTile=!1,Ve.dirty&&(C.clear({color:p.Color.transparent,stencil:0}),Ve.dirty=!1);for(let qe=F.start;qe<=F.end;++qe){const Ie=m.style._layers[j[qe]];if(Ie.isHidden(m.transform.zoom))continue;const tt=m.style._getLayerSourceCache(Ie),Je=tt?this.proxyToSource[Y.key][tt.id]:[Y];if(!Je)continue;const ot=Je;C.viewport.set([0,0,Ve.fb.width,Ve.fb.height]),Ge!==(tt?tt.id:null)&&(this._setupStencil(Ve,Je,Ie,tt),Ge=tt?tt.id:null),m.renderLayer(m,tt,Ie,ot)}this.renderedToTile?(Ve.dirty=!0,z.push(fe.tileID)):Ue||--W,5===W&&(W=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,C.bindFramebuffer.set(null),C.viewport.set([0,0,m.width,m.height]),F.end+1}postRender(){}renderCacheEfficiency(c){const m=c.order.length;if(0===m)return{efficiency:100};let C,T=0,P=0,F=!1;for(let z=0;z<m;++z){const j=c._layers[c.order[z]];this._style.isLayerDraped(j)?(F&&++T,++P):F||(F=!0,C=j.id)}return 0===P?{efficiency:100}:{efficiency:100*(1-T/P),firstUndrapedLayer:C}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(m=>m.dem).forEach(m=>{c=Math.min(c,m.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,m,C){if(!this._visibleDemTiles)return null;const T=this._visibleDemTiles.filter(P=>P.dem).map(P=>{const F=P.tileID,z=1<<F.overscaledZ,{x:j,y:W}=F.canonical,Y=j/z,fe=(j+1)/z,Ae=W/z,Ve=(W+1)/z;return{minx:Y,miny:Ae,maxx:fe,maxy:Ve,t:P.dem.tree.raycastRoot(Y,Ae,fe,Ve,c,m,C),tile:P}});T.sort((P,F)=>(null!==P.t?P.t:Number.MAX_VALUE)-(null!==F.t?F.t:Number.MAX_VALUE));for(const P of T){if(null==P.t)return null;const F=P.tile.dem.tree.raycast(P.minx,P.miny,P.maxx,P.maxy,c,m,C);if(null!=F)return F}return null}_createFBO(){const c=this.painter.context,m=c.gl,C=this.drapeBufferSize;c.activeTexture.set(m.TEXTURE0);const T=new p.Texture(c,{width:C[0],height:C[1],data:null},m.RGBA);T.bind(m.LINEAR,m.CLAMP_TO_EDGE);const P=c.createFramebuffer(C[0],C[1],!1);return P.colorAttachment.set(T.texture),P.depthAttachment=new Is(c,P.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,C[0],C[1]),this._stencilRef=0,P.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):P.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&m.texParameterf(m.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:P,tex:T,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const m=this._style._layers[c],C=m.isHidden(this.painter.transform.zoom);return"custom"===m.type?!C&&m.shouldRedrape():!C&&m.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const C of this._style._getSources())if(C instanceof ce){c=!0;break}if(!c)return;const m={};for(let C=0;C<this._style.order.length;++C){const T=this._style._layers[this._style.order[C]],P=this._style._getLayerSourceCache(T);if(P&&!m[P.id]&&!T.isHidden(this.painter.transform.zoom)&&"line"===T.type&&T.widthExpression()instanceof p.ZoomDependentExpression){m[P.id]=!0;for(const F of this.proxyCoords){const z=this.proxyToSource[F.key][P.id];if(z)for(const j of z)this._clearRenderCacheForTile(P.id,j)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const C in this._style._sourceCaches)if(this._style._sourceCaches[C]._source instanceof be){c=!0;break}if(!c)return;const m={};for(let C=0;C<this._style.order.length;++C){const T=this._style._layers[this._style.order[C]],P=this._style._getLayerSourceCache(T);if(!P||m[P.id]||T.isHidden(this.painter.transform.zoom)||"raster"!==T.type)continue;const F=T.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const j=this.proxyToSource[z.key][P.id];if(j)for(const W of j){const Y=Ga(P.getTile(W),P.findLoadedParent(W,0),P,this.painter.transform,F);(1!==Y.opacity||0!==Y.mix)&&this._clearRenderCacheForTile(P.id,W)}}}}_setupDrapedRenderBatches(){const c=this._style.order,m=c.length;if(0===m)return;const C=[];let T,P=0,F=this._style._layers[c[P]];for(;!this._style.isLayerDraped(F)&&F.isHidden(this.painter.transform.zoom)&&++P<m;)F=this._style._layers[c[P]];for(;P<m;++P){const z=this._style._layers[c[P]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?void 0===T&&(T=P):void 0!==T&&(C.push({start:T,end:P-1}),T=void 0))}void 0!==T&&C.push({start:T,end:P-1}),this._drapedRenderBatches=C}_setupRenderCache(c){const m=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,m.renderCache.length>m.renderCachePool.length){const F=Object.values(m.proxyCachedFBO);m.proxyCachedFBO={};for(let z=0;z<F.length;++z){const j=Object.values(F[z]);m.renderCachePool.push(...j)}}return}this._clearRasterLayersFromRenderCache();const C=this.proxyCoords,T=this._tilesDirty;for(let F=C.length-1;F>=0;F--){const z=C[F];if(m.getTileByID(z.key),void 0!==m.proxyCachedFBO[z.key]){const j=c[z.key],W=this.proxyToSource[z.key];let Y=0;for(const fe in W){const Ae=W[fe],Ve=j[fe];if(!Ve||Ve.length!==Ae.length||Ae.some((Ue,Ge)=>Ue!==Ve[Ge]||T[fe]&&T[fe].hasOwnProperty(Ue.key))){Y=-1;break}++Y}for(const fe in m.proxyCachedFBO[z.key])m.renderCache[m.proxyCachedFBO[z.key][fe]].dirty=Y<0||Y!==Object.values(j).length}}const P=[...this._drapedRenderBatches];P.sort((F,z)=>z.end-z.start-(F.end-F.start));for(const F of P)for(const z of C){if(m.proxyCachedFBO[z.key])continue;let j=m.renderCachePool.pop();void 0===j&&m.renderCache.length<50&&(j=m.renderCache.length,m.renderCache.push(this._createFBO())),void 0!==j&&(m.proxyCachedFBO[z.key]={},m.proxyCachedFBO[z.key][F.start]=j,m.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(c,m,C,T){if(!T||!this._sourceTilesOverlap[T.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const P=this.painter.context,F=P.gl;if(m.length<=1)return void(this._overlapStencilType=!1);let z;if(C.isTileClipped())z=m.length,this._overlapStencilMode.test={func:F.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(m[0].overscaledZ>m[m.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:F.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(P.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,C.isTileClipped()&&this._renderTileClippingMasks(m,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,m){const C=this.painter,T=this.painter.context,P=T.gl;C._tileClippingMaskIDs={},T.setColorMode(p.ColorMode.disabled),T.setDepthMode(p.DepthMode.disabled);const F=C.useProgram("clippingMask");for(const z of c){const j=C._tileClippingMaskIDs[z.key]=--m;F.draw(T,P.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:P.ALWAYS,mask:0},j,255,P.KEEP,P.KEEP,P.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,er(z.projMatrix),"$clipping",C.tileExtentBuffer,C.quadTriangleIndexBuffer,C.tileExtentSegments)}}pointCoordinate(c){const m=this.painter.transform;if(c.x<0||c.x>m.width||c.y<0||c.y>m.height)return null;const C=[c.x,c.y,1,1];p.transformMat4$1(C,C,m.pixelMatrixInverse),p.scale$1(C,C,1/C[3]),C[0]/=m.worldSize,C[1]/=m.worldSize;const T=m._camera.position,P=p.mercatorZfromAltitude(1,m.center.lat),F=[T[0],T[1],T[2]/P,0],z=p.subtract([],C.slice(0,3),F);p.normalize(z,z);const j=this.raycast(F,z,this._exaggeration);return null!==j&&j?(p.scaleAndAdd(F,F,z,j),F[3]=F[2],F[2]*=P,F):null}drawDepth(){const c=this.painter,m=c.context,C=this.proxySourceCache,T=Math.ceil(c.width),P=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===T&&this._depthFBO.height===P||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const F=m.gl,z=m.createFramebuffer(T,P,!0);m.activeTexture.set(F.TEXTURE0);const j=new p.Texture(m,{width:T,height:P,data:null},F.RGBA);j.bind(F.NEAREST,F.CLAMP_TO_EDGE),z.colorAttachment.set(j.texture);const W=m.createRenderbuffer(m.gl.DEPTH_COMPONENT16,T,P);z.depthAttachment.set(W),this._depthFBO=z,this._depthTexture=j}m.bindFramebuffer.set(this._depthFBO.framebuffer),m.viewport.set([0,0,T,P]),function(F,z,j,W){if("globe"===F.transform.projection.name)return;const Y=F.context,fe=Y.gl;Y.clear({depth:1});const Ae=F.useProgram("terrainDepth"),Ve=new p.DepthMode(fe.LESS,p.DepthMode.ReadWrite,F.depthRangeFor3D);for(const Ue of W){const Ge=j.getTile(Ue),qe=ls(Ue.projMatrix,0);z.setupElevationDraw(Ge,Ae),Ae.draw(Y,fe.TRIANGLES,Ve,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,qe,"terrain_depth",z.gridBuffer,z.gridIndexBuffer,z.gridNoSkirtSegments)}}(c,this,C,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,m,C){if(c.getSource()instanceof yt)return this._setupProxiedCoordsForImageSource(c,m,C);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const T=this.proxiedCoords[c.id]=[],P=this.proxyCoords;for(let z=0;z<P.length;z++){const j=P[z],W=this._findTileCoveringTileID(j,c);if(W){const Y=this._createProxiedId(j,W,C[j.key]&&C[j.key][c.id]);T.push(Y),this.proxyToSource[j.key][c.id]=[Y]}}let F=!1;for(let z=0;z<m.length;z++){const j=c.getTile(m[z]);if(!j||!j.hasData())continue;const W=this._findTileCoveringTileID(j.tileID,this.proxySourceCache);if(W&&W.tileID.canonical.z!==j.tileID.canonical.z){const Y=this.proxyToSource[W.tileID.key][c.id],fe=this._createProxiedId(W.tileID,j,C[W.tileID.key]&&C[W.tileID.key][c.id]);Y?Y.splice(Y.length-1,0,fe):this.proxyToSource[W.tileID.key][c.id]=[fe],T.push(fe),F=!0}}this._sourceTilesOverlap[c.id]=F}_setupProxiedCoordsForImageSource(c,m,C){if(!c.getSource().loaded())return;const T=this.proxiedCoords[c.id]=[],P=this.proxyCoords,F=c.getSource(),z=new p.pointGeometry(F.tileID.x,F.tileID.y)._div(1<<F.tileID.z),j=F.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((Y,fe)=>(Y.min.x=Math.min(Y.min.x,fe.x-z.x),Y.min.y=Math.min(Y.min.y,fe.y-z.y),Y.max.x=Math.max(Y.max.x,fe.x-z.x),Y.max.y=Math.max(Y.max.y,fe.y-z.y),Y),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),W=(Y,fe)=>{const Ae=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),Ve=Y.canonical.y/(1<<Y.canonical.z),Ue=p.EXTENT/(1<<Y.canonical.z),Ge=fe.wrap+fe.canonical.x/(1<<fe.canonical.z),qe=fe.canonical.y/(1<<fe.canonical.z);return Ae+Ue<Ge+j.min.x||Ae>Ge+j.max.x||Ve+Ue<qe+j.min.y||Ve>qe+j.max.y};for(let Y=0;Y<P.length;Y++){const fe=P[Y];for(let Ae=0;Ae<m.length;Ae++){const Ve=c.getTile(m[Ae]);if(!Ve||!Ve.hasData()||W(fe,Ve.tileID))continue;const Ue=this._createProxiedId(fe,Ve,C[fe.key]&&C[fe.key][c.id]),Ge=this.proxyToSource[fe.key][c.id];Ge?Ge.push(Ue):this.proxyToSource[fe.key][c.id]=[Ue],T.push(Ue)}}}_createProxiedId(c,m,C){let T=this.orthoMatrix;if(C){const P=C.find(F=>F.key===m.tileID.key);if(P)return P}if(m.tileID.key!==c.key){const P=c.canonical.z-m.tileID.canonical.z;let F,z,j;T=p.create();const W=m.tileID.wrap-c.wrap<<c.overscaledZ;P>0?(F=p.EXTENT>>P,z=F*((m.tileID.canonical.x<<P)-c.canonical.x+W),j=F*((m.tileID.canonical.y<<P)-c.canonical.y)):(F=p.EXTENT<<-P,z=p.EXTENT*(m.tileID.canonical.x-(c.canonical.x+W<<-P)),j=p.EXTENT*(m.tileID.canonical.y-(c.canonical.y<<-P))),p.ortho(T,0,F,0,F,0,1),p.translate(T,T,[z,j,0])}return new lr(m.tileID,c.key,T)}_findTileCoveringTileID(c,m){let C=m.getTile(c);if(C&&C.hasData())return C;const T=this._findCoveringTileCache[m.id],P=T[c.key];if(C=P?m.getTileByID(P):null,C&&C.hasData()||null===P)return C;let F=C?C.tileID:c,z=F.overscaledZ;const j=m.getSource().minzoom,W=[];if(!P){const fe=m.getSource().maxzoom;if(c.canonical.z>=fe){const Ae=c.canonical.z-fe;m.getSource().reparseOverscaled?(z=Math.max(c.canonical.z+2,m.transform.tileZoom),F=new p.OverscaledTileID(z,c.wrap,fe,c.canonical.x>>Ae,c.canonical.y>>Ae)):0!==Ae&&(z=fe,F=new p.OverscaledTileID(z,c.wrap,fe,c.canonical.x>>Ae,c.canonical.y>>Ae))}F.key!==c.key&&(W.push(F.key),C=m.getTile(F))}const Y=fe=>{W.forEach(Ae=>{T[Ae]=fe}),W.length=0};for(z-=1;z>=j&&(!C||!C.hasData());z--){C&&Y(C.tileID.key);const fe=F.calculateScaledKey(z);if(C=m.getTileByID(fe),C&&C.hasData())break;const Ae=T[fe];if(null===Ae)break;void 0===Ae?W.push(fe):C=m.getTileByID(Ae)}return Y(C?C.tileID.key:null),C&&C.hasData()?C:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,m){let C=this._tilesDirty[c];C||(C=this._tilesDirty[c]={}),C[m.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(m){let C=0;const T=new p.StructArrayLayout2ui4,P=131;for(let F=1;F<129;F++){for(let z=1;z<129;z++)C=F*P+z,T.emplaceBack(C,C+1),T.emplaceBack(C,C+P),T.emplaceBack(C+1,C+P),128===F&&T.emplaceBack(C+P,C+P+1);T.emplaceBack(C+1,C+1+P)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Or{static cacheKey(c,m,C,T){let P=`${m}${T?T.cacheKey:""}`;for(const F of C)c.usedDefines.includes(F)&&(P+=`/${F}`);return P}constructor(c,m,C,T,P,F){const z=c.gl;this.program=z.createProgram();const j=function(Ie){const tt=[];for(let Je=0;Je<Ie.length;Je++){if(null===Ie[Je])continue;const ot=Ie[Je].split(" ");tt.push(ot.pop())}return tt}(C.staticAttributes),W=T?T.getBinderAttributes():[],Y=j.concat(W);let fe=T?T.defines():[];fe=fe.concat(F.map(Ie=>`#define ${Ie}`));const Ae=c.isWebGL2?"#version 300 es\n":"",Ve=Ae+fe.concat(c.extStandardDerivatives&&0===Ae.length?"#extension GL_OES_standard_derivatives : enable\n".concat(wr):wr,wr,go,Ri.fragmentSource,Au.fragmentSource,C.fragmentSource).join("\n"),Ue=Ae+fe.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",go,Ri.vertexSource,Au.vertexSource,fa.vertexSource,C.vertexSource).join("\n"),Ge=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Ge,Ve),z.compileShader(Ge),z.attachShader(this.program,Ge);const qe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(qe,Ue),z.compileShader(qe),z.attachShader(this.program,qe),this.attributes={},this.numAttributes=Y.length;for(let Ie=0;Ie<this.numAttributes;Ie++)Y[Ie]&&(z.bindAttribLocation(this.program,Ie,Y[Ie]),this.attributes[Y[Ie]]=Ie);z.linkProgram(this.program),z.deleteShader(qe),z.deleteShader(Ge),this.fixedUniforms=P(c),this.binderUniforms=T?T.getUniforms(c):[],F.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(Ie=c),u_dem_prev:new p.Uniform1i(Ie),u_dem_unpack:new p.Uniform4f(Ie),u_dem_tl:new p.Uniform2f(Ie),u_dem_scale:new p.Uniform1f(Ie),u_dem_tl_prev:new p.Uniform2f(Ie),u_dem_scale_prev:new p.Uniform1f(Ie),u_dem_size:new p.Uniform1f(Ie),u_dem_lerp:new p.Uniform1f(Ie),u_exaggeration:new p.Uniform1f(Ie),u_depth:new p.Uniform1i(Ie),u_depth_size_inv:new p.Uniform2f(Ie),u_meter_to_dem:new p.Uniform1f(Ie),u_label_plane_matrix_inv:new p.UniformMatrix4f(Ie)}),F.includes("GLOBE")&&(this.globeUniforms=(Ie=>({u_tile_tl_up:new p.Uniform3f(Ie),u_tile_tr_up:new p.Uniform3f(Ie),u_tile_br_up:new p.Uniform3f(Ie),u_tile_bl_up:new p.Uniform3f(Ie),u_tile_up_scale:new p.Uniform1f(Ie)}))(c)),F.includes("FOG")&&(this.fogUniforms=(Ie=>({u_fog_matrix:new p.UniformMatrix4f(Ie),u_fog_range:new p.Uniform2f(Ie),u_fog_color:new p.Uniform4f(Ie),u_fog_horizon_blend:new p.Uniform1f(Ie),u_fog_temporal_offset:new p.Uniform1f(Ie),u_frustum_tl:new p.Uniform3f(Ie),u_frustum_tr:new p.Uniform3f(Ie),u_frustum_br:new p.Uniform3f(Ie),u_frustum_bl:new p.Uniform3f(Ie),u_globe_pos:new p.Uniform3f(Ie),u_globe_radius:new p.Uniform1f(Ie),u_globe_transition:new p.Uniform1f(Ie),u_is_globe:new p.Uniform1i(Ie),u_viewport:new p.Uniform2f(Ie)}))(c))}var Ie}setTerrainUniformValues(c,m){if(!this.terrainUniforms)return;const C=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const T in m)C[T]&&C[T].set(this.program,T,m[T])}}setGlobeUniformValues(c,m){if(!this.globeUniforms)return;const C=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const T in m)C[T]&&C[T].set(this.program,T,m[T])}}setFogUniformValues(c,m){if(!this.fogUniforms)return;const C=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const T in m)C[T].set(this.program,T,m[T])}}draw(c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge){const qe=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(C),c.setStencilMode(T),c.setColorMode(P),c.setCullFace(F);for(const tt of Object.keys(this.fixedUniforms))this.fixedUniforms[tt].set(this.program,tt,z[tt]);Ue&&Ue.setUniforms(this.program,c,this.binderUniforms,Ae,{zoom:Ve});const Ie={[qe.LINES]:2,[qe.TRIANGLES]:3,[qe.LINE_STRIP]:1}[m];for(const tt of fe.get()){const Je=tt.vaos||(tt.vaos={});(Je[j]||(Je[j]=new ea)).bind(c,this,W,Ue?Ue.getPaintVertexBuffers():[],Y,tt.vertexOffset,Ge||[]),qe.drawElements(m,tt.primitiveLength*Ie,qe.UNSIGNED_SHORT,tt.primitiveOffset*Ie*2)}}}function ys(b,c){const m=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,b.transform.tileZoom)/m,T=C*(c.tileID.canonical.x+c.tileID.wrap*m),P=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/qt(c,1,b.transform.tileZoom),u_pixel_coord_upper:[T>>16,P>>16],u_pixel_coord_lower:[65535&T,65535&P]}}const Wl=p.create(),Co=(b,c,m,C,T,P,F,z,j,W,Y)=>{const fe=c.style.light,Ae=fe.properties.get("position"),Ve=[Ae.x,Ae.y,Ae.z],Ue=p.create$1();"viewport"===fe.properties.get("anchor")&&(p.fromRotation(Ue,-c.transform.angle),p.transformMat3(Ve,Ve,Ue));const Ge=fe.properties.get("color"),qe=c.transform,Ie={u_matrix:b,u_lightpos:Ve,u_lightintensity:fe.properties.get("intensity"),u_lightcolor:[Ge.r,Ge.g,Ge.b],u_vertical_gradient:+m,u_opacity:C,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:T,u_edge_radius:P};return"globe"===qe.projection.name&&(Ie.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],Ie.u_zoom_transition=j,Ie.u_inv_rot_matrix=Y,Ie.u_merc_center=W,Ie.u_up_dir=qe.projection.upVector(new p.CanonicalTileID(0,0,0),W[0]*p.EXTENT,W[1]*p.EXTENT),Ie.u_height_lift=z),Ie},zs=(b,c,m,C,T,P,F,z,j,W,Y,fe)=>{const Ae=Co(b,c,m,C,T,P,F,j,W,Y,fe),Ve={u_height_factor:-Math.pow(2,F.overscaledZ)/z.tileSize/8};return p.extend(Ae,ys(c,z),Ve)},Si=b=>({u_matrix:b}),lu=(b,c,m)=>p.extend(Si(b),ys(c,m)),Xl=(b,c)=>({u_matrix:b,u_world:c}),oi=(b,c,m,C)=>p.extend(lu(b,c,m),{u_world:C}),Zs=p.create(),$a=(b,c,m,C,T,P)=>{const F=b.transform,z="globe"===F.projection.name;let j;if("map"===P.paint.get("circle-pitch-alignment"))if(z){const Y=p.globePixelsToTileUnits(F.zoom,c.canonical)*F._pixelsPerMercatorPixel;j=Float32Array.from([Y,0,0,Y])}else j=F.calculatePixelsToTileUnitsMatrix(m);else j=new Float32Array([F.pixelsToGLUnits[0],0,0,F.pixelsToGLUnits[1]]);const W={u_camera_to_center_distance:F.cameraToCenterDistance,u_matrix:b.translatePosMatrix(c.projMatrix,m,P.paint.get("circle-translate"),P.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:j,u_inv_rot_matrix:Zs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){W.u_inv_rot_matrix=C,W.u_merc_center=T,W.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],W.u_zoom_transition=p.globeToMercatorTransition(F.zoom);const Y=T[0]*p.EXTENT,fe=T[1]*p.EXTENT;W.u_up_dir=F.projection.upVector(new p.CanonicalTileID(0,0,0),Y,fe)}return W},Cs=b=>{const c=[];return"map"===b.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===b.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},da=(b,c,m,C)=>{const T=p.EXTENT/m.tileSize;return{u_matrix:b,u_camera_to_center_distance:c.getCameraToCenterDistance(C),u_extrude_scale:[c.pixelsToGLUnits[0]/T,c.pixelsToGLUnits[1]/T]}},ts=(b,c,m=1)=>({u_matrix:b,u_color:c,u_overlay:0,u_overlay_scale:m}),qa=p.create(),Ds=(b,c,m,C,T,P,F)=>{const z=b.transform,j="globe"===z.projection.name,W=j?p.globePixelsToTileUnits(z.zoom,c.canonical)*z._pixelsPerMercatorPixel:qt(m,1,P),Y={u_matrix:c.projMatrix,u_extrude_scale:W,u_intensity:F,u_inv_rot_matrix:qa,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){Y.u_inv_rot_matrix=C,Y.u_merc_center=T,Y.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],Y.u_zoom_transition=p.globeToMercatorTransition(z.zoom);const fe=T[0]*p.EXTENT,Ae=T[1]*p.EXTENT;Y.u_up_dir=z.projection.upVector(new p.CanonicalTileID(0,0,0),fe,Ae)}return Y},co=(b,c,m,C,T,P,F)=>{const z=b.transform,j=z.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:ui(b,c,m,C),u_pixels_to_tile_units:j,u_device_pixel_ratio:P,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:Tl(m)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ru(c,b.transform),u_alpha_discard_threshold:0,u_trim_offset:F}},Pu=(b,c,m,C,T)=>{const P=b.transform;return{u_matrix:ui(b,c,m,C),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:T,u_image:0,u_tile_units_to_pixels:Ru(c,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ru(b,c){return 1/qt(b,1,c.tileZoom)}function ui(b,c,m,C){return b.translatePosMatrix(C||c.tileID.projMatrix,c,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}function Tl(b){const c=b.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Zl=(b,c,m,C,T,P)=>{return{u_matrix:b,u_tl_parent:c,u_scale_parent:m,u_fade_t:C.mix,u_opacity:C.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(z=T.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(F=T.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:Ft(T.paint.get("raster-hue-rotate")),u_perspective_transform:P};var F,z};function Ft(b){b*=Math.PI/180;const c=Math.sin(b),m=Math.cos(b);return[(2*m+1)/3,(-Math.sqrt(3)*c-m+1)/3,(Math.sqrt(3)*c-m+1)/3]}const rn=p.create(),Hn=(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge)=>{const qe=T.transform,Ie={u_is_size_zoom_constant:+("constant"===b||"source"===b),u_is_size_feature_constant:+("constant"===b||"camera"===b),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:qe.cameraToCenterDistance,u_rotate_symbol:+m,u_aspect_ratio:qe.width/qe.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:F,u_coord_matrix:z,u_is_text:+j,u_pitch_with_map:+C,u_texsize:W,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:rn,u_up_vector:[0,-1,0]};return"globe"===Ge.name&&(Ie.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],Ie.u_zoom_transition=fe,Ie.u_inv_rot_matrix=Ve,Ie.u_merc_center=Ae,Ie.u_camera_forward=qe._camera.forward(),Ie.u_ecef_origin=p.globeECEFOrigin(qe.globeMatrix,Y.toUnwrapped()),Ie.u_tile_matrix=Float32Array.from(qe.globeMatrix),Ie.u_up_vector=Ue),Ie},Ar=(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge,qe)=>p.extend(Hn(b,c,m,C,T,P,F,z,j,W,fe,Ae,Ve,Ue,Ge,qe),{u_gamma_scale:C?T.transform.cameraToCenterDistance*Math.cos(T.terrain?0:T.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+Y}),Yi=(b,c,m,C,T,P,F,z,j,W,Y,fe,Ae,Ve,Ue,Ge)=>p.extend(Ar(b,c,m,C,T,P,F,z,!0,j,!0,Y,fe,Ae,Ve,Ue,Ge),{u_texsize_icon:W,u_texture_icon:1}),ei=(b,c,m)=>({u_matrix:b,u_opacity:c,u_color:m}),ks=(b,c,m,C,T)=>p.extend(function(P,F,z){const j=F.imageManager.getPattern(P.toString()),{width:W,height:Y}=F.imageManager.getPixelSize(),fe=Math.pow(2,z.tileID.overscaledZ),Ae=z.tileSize*Math.pow(2,F.transform.tileZoom)/fe,Ve=Ae*(z.tileID.canonical.x+z.tileID.wrap*fe),Ue=Ae*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[W,Y],u_pattern_size:j.displaySize,u_tile_units_to_pixels:1/qt(z,1,F.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,Ue>>16],u_pixel_coord_lower:[65535&Ve,65535&Ue]}}(C,m,T),{u_matrix:b,u_opacity:c}),Gi={fillExtrusion:b=>({u_matrix:new p.UniformMatrix4f(b),u_lightpos:new p.Uniform3f(b),u_lightintensity:new p.Uniform1f(b),u_lightcolor:new p.Uniform3f(b),u_vertical_gradient:new p.Uniform1f(b),u_opacity:new p.Uniform1f(b),u_edge_radius:new p.Uniform1f(b),u_ao:new p.Uniform2f(b),u_tile_id:new p.Uniform3f(b),u_zoom_transition:new p.Uniform1f(b),u_inv_rot_matrix:new p.UniformMatrix4f(b),u_merc_center:new p.Uniform2f(b),u_up_dir:new p.Uniform3f(b),u_height_lift:new p.Uniform1f(b)}),fillExtrusionPattern:b=>({u_matrix:new p.UniformMatrix4f(b),u_lightpos:new p.Uniform3f(b),u_lightintensity:new p.Uniform1f(b),u_lightcolor:new p.Uniform3f(b),u_vertical_gradient:new p.Uniform1f(b),u_height_factor:new p.Uniform1f(b),u_edge_radius:new p.Uniform1f(b),u_ao:new p.Uniform2f(b),u_tile_id:new p.Uniform3f(b),u_zoom_transition:new p.Uniform1f(b),u_inv_rot_matrix:new p.UniformMatrix4f(b),u_merc_center:new p.Uniform2f(b),u_up_dir:new p.Uniform3f(b),u_height_lift:new p.Uniform1f(b),u_image:new p.Uniform1i(b),u_texsize:new p.Uniform2f(b),u_pixel_coord_upper:new p.Uniform2f(b),u_pixel_coord_lower:new p.Uniform2f(b),u_tile_units_to_pixels:new p.Uniform1f(b),u_opacity:new p.Uniform1f(b)}),fill:b=>({u_matrix:new p.UniformMatrix4f(b)}),fillPattern:b=>({u_matrix:new p.UniformMatrix4f(b),u_image:new p.Uniform1i(b),u_texsize:new p.Uniform2f(b),u_pixel_coord_upper:new p.Uniform2f(b),u_pixel_coord_lower:new p.Uniform2f(b),u_tile_units_to_pixels:new p.Uniform1f(b)}),fillOutline:b=>({u_matrix:new p.UniformMatrix4f(b),u_world:new p.Uniform2f(b)}),fillOutlinePattern:b=>({u_matrix:new p.UniformMatrix4f(b),u_world:new p.Uniform2f(b),u_image:new p.Uniform1i(b),u_texsize:new p.Uniform2f(b),u_pixel_coord_upper:new p.Uniform2f(b),u_pixel_coord_lower:new p.Uniform2f(b),u_tile_units_to_pixels:new p.Uniform1f(b)}),circle:b=>({u_camera_to_center_distance:new p.Uniform1f(b),u_extrude_scale:new p.UniformMatrix2f(b),u_device_pixel_ratio:new p.Uniform1f(b),u_matrix:new p.UniformMatrix4f(b),u_inv_rot_matrix:new p.UniformMatrix4f(b),u_merc_center:new p.Uniform2f(b),u_tile_id:new p.Uniform3f(b),u_zoom_transition:new p.Uniform1f(b),u_up_dir:new p.Uniform3f(b)}),collisionBox:b=>({u_matrix:new p.UniformMatrix4f(b),u_camera_to_center_distance:new p.Uniform1f(b),u_extrude_scale:new p.Uniform2f(b)}),collisionCircle:b=>({u_matrix:new p.UniformMatrix4f(b),u_inv_matrix:new p.UniformMatrix4f(b),u_camera_to_center_distance:new p.Uniform1f(b),u_viewport_size:new p.Uniform2f(b)}),debug:b=>({u_color:new p.UniformColor(b),u_matrix:new p.UniformMatrix4f(b),u_overlay:new p.Uniform1i(b),u_overlay_scale:new p.Uniform1f(b)}),clippingMask:b=>({u_matrix:new p.UniformMatrix4f(b)}),heatmap:b=>({u_extrude_scale:new p.Uniform1f(b),u_intensity:new p.Uniform1f(b),u_matrix:new p.UniformMatrix4f(b),u_inv_rot_matrix:new p.UniformMatrix4f(b),u_merc_center:new p.Uniform2f(b),u_tile_id:new p.Uniform3f(b),u_zoom_transition:new p.Uniform1f(b),u_up_dir:new p.Uniform3f(b)}),heatmapTexture:b=>({u_image:new p.Uniform1i(b),u_color_ramp:new p.Uniform1i(b),u_opacity:new p.Uniform1f(b)}),hillshade:b=>({u_matrix:new p.UniformMatrix4f(b),u_image:new p.Uniform1i(b),u_latrange:new p.Uniform2f(b),u_light:new p.Uniform2f(b),u_shadow:new p.UniformColor(b),u_highlight:new p.UniformColor(b),u_accent:new p.UniformColor(b)}),hillshadePrepare:b=>({u_matrix:new p.UniformMatrix4f(b),u_image:new p.Uniform1i(b),u_dimension:new p.Uniform2f(b),u_zoom:new p.Uniform1f(b),u_unpack:new p.Uniform4f(b)}),line:b=>({u_matrix:new p.UniformMatrix4f(b),u_pixels_to_tile_units:new p.UniformMatrix2f(b),u_device_pixel_ratio:new p.Uniform1f(b),u_units_to_pixels:new p.Uniform2f(b),u_dash_image:new p.Uniform1i(b),u_gradient_image:new p.Uniform1i(b),u_image_height:new p.Uniform1f(b),u_texsize:new p.Uniform2f(b),u_tile_units_to_pixels:new p.Uniform1f(b),u_alpha_discard_threshold:new p.Uniform1f(b),u_trim_offset:new p.Uniform2f(b)}),linePattern:b=>({u_matrix:new p.UniformMatrix4f(b),u_texsize:new p.Uniform2f(b),u_pixels_to_tile_units:new p.UniformMatrix2f(b),u_device_pixel_ratio:new p.Uniform1f(b),u_image:new p.Uniform1i(b),u_units_to_pixels:new p.Uniform2f(b),u_tile_units_to_pixels:new p.Uniform1f(b),u_alpha_discard_threshold:new p.Uniform1f(b)}),raster:b=>({u_matrix:new p.UniformMatrix4f(b),u_tl_parent:new p.Uniform2f(b),u_scale_parent:new p.Uniform1f(b),u_fade_t:new p.Uniform1f(b),u_opacity:new p.Uniform1f(b),u_image0:new p.Uniform1i(b),u_image1:new p.Uniform1i(b),u_brightness_low:new p.Uniform1f(b),u_brightness_high:new p.Uniform1f(b),u_saturation_factor:new p.Uniform1f(b),u_contrast_factor:new p.Uniform1f(b),u_spin_weights:new p.Uniform3f(b),u_perspective_transform:new p.Uniform2f(b)}),symbolIcon:b=>({u_is_size_zoom_constant:new p.Uniform1i(b),u_is_size_feature_constant:new p.Uniform1i(b),u_size_t:new p.Uniform1f(b),u_size:new p.Uniform1f(b),u_camera_to_center_distance:new p.Uniform1f(b),u_rotate_symbol:new p.Uniform1i(b),u_aspect_ratio:new p.Uniform1f(b),u_fade_change:new p.Uniform1f(b),u_matrix:new p.UniformMatrix4f(b),u_label_plane_matrix:new p.UniformMatrix4f(b),u_coord_matrix:new p.UniformMatrix4f(b),u_is_text:new p.Uniform1i(b),u_pitch_with_map:new p.Uniform1i(b),u_texsize:new p.Uniform2f(b),u_tile_id:new p.Uniform3f(b),u_zoom_transition:new p.Uniform1f(b),u_inv_rot_matrix:new p.UniformMatrix4f(b),u_merc_center:new p.Uniform2f(b),u_camera_forward:new p.Uniform3f(b),u_tile_matrix:new p.UniformMatrix4f(b),u_up_vector:new p.Uniform3f(b),u_ecef_origin:new p.Uniform3f(b),u_texture:new p.Uniform1i(b)}),symbolSDF:b=>({u_is_size_zoom_constant:new p.Uniform1i(b),u_is_size_feature_constant:new p.Uniform1i(b),u_size_t:new p.Uniform1f(b),u_size:new p.Uniform1f(b),u_camera_to_center_distance:new p.Uniform1f(b),u_rotate_symbol:new p.Uniform1i(b),u_aspect_ratio:new p.Uniform1f(b),u_fade_change:new p.Uniform1f(b),u_matrix:new p.UniformMatrix4f(b),u_label_plane_matrix:new p.UniformMatrix4f(b),u_coord_matrix:new p.UniformMatrix4f(b),u_is_text:new p.Uniform1i(b),u_pitch_with_map:new p.Uniform1i(b),u_texsize:new p.Uniform2f(b),u_texture:new p.Uniform1i(b),u_gamma_scale:new p.Uniform1f(b),u_device_pixel_ratio:new p.Uniform1f(b),u_tile_id:new p.Uniform3f(b),u_zoom_transition:new p.Uniform1f(b),u_inv_rot_matrix:new p.UniformMatrix4f(b),u_merc_center:new p.Uniform2f(b),u_camera_forward:new p.Uniform3f(b),u_tile_matrix:new p.UniformMatrix4f(b),u_up_vector:new p.Uniform3f(b),u_ecef_origin:new p.Uniform3f(b),u_is_halo:new p.Uniform1i(b)}),symbolTextAndIcon:b=>({u_is_size_zoom_constant:new p.Uniform1i(b),u_is_size_feature_constant:new p.Uniform1i(b),u_size_t:new p.Uniform1f(b),u_size:new p.Uniform1f(b),u_camera_to_center_distance:new p.Uniform1f(b),u_rotate_symbol:new p.Uniform1i(b),u_aspect_ratio:new p.Uniform1f(b),u_fade_change:new p.Uniform1f(b),u_matrix:new p.UniformMatrix4f(b),u_label_plane_matrix:new p.UniformMatrix4f(b),u_coord_matrix:new p.UniformMatrix4f(b),u_is_text:new p.Uniform1i(b),u_pitch_with_map:new p.Uniform1i(b),u_texsize:new p.Uniform2f(b),u_texsize_icon:new p.Uniform2f(b),u_texture:new p.Uniform1i(b),u_texture_icon:new p.Uniform1i(b),u_gamma_scale:new p.Uniform1f(b),u_device_pixel_ratio:new p.Uniform1f(b),u_is_halo:new p.Uniform1i(b)}),background:b=>({u_matrix:new p.UniformMatrix4f(b),u_opacity:new p.Uniform1f(b),u_color:new p.UniformColor(b)}),backgroundPattern:b=>({u_matrix:new p.UniformMatrix4f(b),u_opacity:new p.Uniform1f(b),u_image:new p.Uniform1i(b),u_pattern_tl:new p.Uniform2f(b),u_pattern_br:new p.Uniform2f(b),u_texsize:new p.Uniform2f(b),u_pattern_size:new p.Uniform2f(b),u_pixel_coord_upper:new p.Uniform2f(b),u_pixel_coord_lower:new p.Uniform2f(b),u_tile_units_to_pixels:new p.Uniform1f(b)}),terrainRaster:ki,terrainDepth:ki,skybox:b=>({u_matrix:new p.UniformMatrix4f(b),u_sun_direction:new p.Uniform3f(b),u_cubemap:new p.Uniform1i(b),u_opacity:new p.Uniform1f(b),u_temporal_offset:new p.Uniform1f(b)}),skyboxGradient:b=>({u_matrix:new p.UniformMatrix4f(b),u_color_ramp:new p.Uniform1i(b),u_center_direction:new p.Uniform3f(b),u_radius:new p.Uniform1f(b),u_opacity:new p.Uniform1f(b),u_temporal_offset:new p.Uniform1f(b)}),skyboxCapture:b=>({u_matrix_3f:new p.UniformMatrix3f(b),u_sun_direction:new p.Uniform3f(b),u_sun_intensity:new p.Uniform1f(b),u_color_tint_r:new p.Uniform4f(b),u_color_tint_m:new p.Uniform4f(b),u_luminance:new p.Uniform1f(b)}),globeRaster:b=>({u_proj_matrix:new p.UniformMatrix4f(b),u_globe_matrix:new p.UniformMatrix4f(b),u_normalize_matrix:new p.UniformMatrix4f(b),u_merc_matrix:new p.UniformMatrix4f(b),u_zoom_transition:new p.Uniform1f(b),u_merc_center:new p.Uniform2f(b),u_image0:new p.Uniform1i(b),u_grid_matrix:new p.UniformMatrix3f(b),u_skirt_height:new p.Uniform1f(b),u_frustum_tl:new p.Uniform3f(b),u_frustum_tr:new p.Uniform3f(b),u_frustum_br:new p.Uniform3f(b),u_frustum_bl:new p.Uniform3f(b),u_globe_pos:new p.Uniform3f(b),u_globe_radius:new p.Uniform1f(b),u_viewport:new p.Uniform2f(b)}),globeAtmosphere:b=>({u_frustum_tl:new p.Uniform3f(b),u_frustum_tr:new p.Uniform3f(b),u_frustum_br:new p.Uniform3f(b),u_frustum_bl:new p.Uniform3f(b),u_horizon:new p.Uniform1f(b),u_transition:new p.Uniform1f(b),u_fadeout_range:new p.Uniform1f(b),u_color:new p.Uniform4f(b),u_high_color:new p.Uniform4f(b),u_space_color:new p.Uniform4f(b),u_star_intensity:new p.Uniform1f(b),u_star_density:new p.Uniform1f(b),u_star_size:new p.Uniform1f(b),u_temporal_offset:new p.Uniform1f(b),u_horizon_angle:new p.Uniform1f(b),u_rotation_matrix:new p.UniformMatrix4f(b)})};let Qi;function Bi(b,c,m,C,T,P,F){const z=b.context,j=z.gl,W=b.transform,Y=b.useProgram("collisionBox"),fe=[];let Ae=0,Ve=0;for(let ot=0;ot<C.length;ot++){const Ct=C[ot],_t=c.getTile(Ct),It=_t.getBucket(m);if(!It)continue;const jt=jn(Ct,It,W);let Wt=jt;0===T[0]&&0===T[1]||(Wt=b.translatePosMatrix(jt,_t,T,P));const Qt=F?It.textCollisionBox:It.iconCollisionBox,Bn=It.collisionCircleArray;if(Bn.length>0){const Xt=p.create(),yn=Wt;p.mul(Xt,It.placementInvProjMatrix,W.glCoordMatrix),p.mul(Xt,Xt,It.placementViewportMatrix),fe.push({circleArray:Bn,circleOffset:Ve,transform:yn,invTransform:Xt,projection:It.getProjection()}),Ae+=Bn.length/4,Ve=Ae}Qt&&(b.terrain&&b.terrain.setupElevationDraw(_t,Y),Y.draw(z,j.LINES,p.DepthMode.disabled,p.StencilMode.disabled,b.colorModeForRenderPass(),p.CullFaceMode.disabled,da(Wt,W,_t,It.getProjection()),m.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,null,W.zoom,null,[Qt.collisionVertexBuffer,Qt.collisionVertexBufferExt]))}if(!F||!fe.length)return;const Ue=b.useProgram("collisionCircle"),Ge=new p.StructArrayLayout2f1f2i16;Ge.resize(4*Ae),Ge._trim();let qe=0;for(const ot of fe)for(let Ct=0;Ct<ot.circleArray.length/4;Ct++){const _t=4*Ct,It=ot.circleArray[_t+0],jt=ot.circleArray[_t+1],Wt=ot.circleArray[_t+2],Qt=ot.circleArray[_t+3];Ge.emplace(qe++,It,jt,Wt,Qt,0),Ge.emplace(qe++,It,jt,Wt,Qt,1),Ge.emplace(qe++,It,jt,Wt,Qt,2),Ge.emplace(qe++,It,jt,Wt,Qt,3)}(!Qi||Qi.length<2*Ae)&&(Qi=function(ot){const Ct=2*ot,_t=new p.StructArrayLayout3ui6;_t.resize(Ct),_t._trim();for(let It=0;It<Ct;It++){const jt=6*It;_t.uint16[jt+0]=4*It+0,_t.uint16[jt+1]=4*It+1,_t.uint16[jt+2]=4*It+2,_t.uint16[jt+3]=4*It+2,_t.uint16[jt+4]=4*It+3,_t.uint16[jt+5]=4*It+0}return _t}(Ae));const Ie=z.createIndexBuffer(Qi,!0),tt=z.createVertexBuffer(Ge,p.collisionCircleLayout.members,!0);for(const ot of fe){const Ct={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(Je=W).getCameraToCenterDistance(ot.projection),u_viewport_size:[Je.width,Je.height]};Ue.draw(z,j.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,b.colorModeForRenderPass(),p.CullFaceMode.disabled,Ct,m.id,tt,Ie,p.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,W.zoom)}var Je;tt.destroy(),Ie.destroy()}const cs=p.create();function So({width:b,height:c,anchor:m,textOffset:C,textScale:T},P){const{horizontalAlign:F,verticalAlign:z}=p.getAnchorAlignment(m),j=-(F-.5)*b,W=-(z-.5)*c,Y=p.evaluateVariableOffset(m,C);return new p.pointGeometry((j/T+Y[0])*P,(W/T+Y[1])*P)}function io(b,c,m,C,T,P,F,z,j,W,Y){const fe=b.text.placedSymbolArray,Ae=b.text.dynamicLayoutVertexArray,Ve=b.icon.dynamicLayoutVertexArray,Ue={},Ge=b.getProjection(),qe=cn(z,Ge,P),Ie=P.elevation,tt=Ge.upVectorScale(z.canonical,P.center.lat,P.worldSize).metersToTile;Ae.clear();for(let Je=0;Je<fe.length;Je++){const ot=fe.get(Je),{tileAnchorX:Ct,tileAnchorY:_t,numGlyphs:It}=ot,jt=b.allowVerticalPlacement&&!ot.placedOrientation,Wt=ot.hidden||!ot.crossTileID||jt?null:C[ot.crossTileID];if(Wt){let Qt=0,Bn=0,Xt=0;if(Ie){const br=Ie?Ie.getAtTileOffset(z,Ct,_t):0,[wi,gr,or]=Ge.upVector(z.canonical,Ct,_t);Qt=br*wi*tt,Bn=br*gr*tt,Xt=br*or*tt}let[yn,sn,An,Ht]=hn(ot.projectedAnchorX+Qt,ot.projectedAnchorY+Bn,ot.projectedAnchorZ+Xt,m?qe:F);const Vt=Qr(P.getCameraToCenterDistance(Ge),Ht);let en=T.evaluateSizeForFeature(b.textSizeData,W,ot)*Vt/p.ONE_EM;m&&(en*=b.tilePixelRatio/j);const xn=So(Wt,en);m?(({x:yn,y:sn,z:An}=Ge.projectTilePoint(Ct+xn.x,_t+xn.y,z.canonical)),[yn,sn,An]=hn(yn+Qt,sn+Bn,An+Xt,F)):(c&&xn._rotate(-P.angle),yn+=xn.x,sn+=xn.y,An=0);const Pn=b.allowVerticalPlacement&&ot.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let br=0;br<It;br++)p.addDynamicAttributes(Ae,yn,sn,An,Pn);Y&&ot.associatedIconIndex>=0&&(Ue[ot.associatedIconIndex]={x:yn,y:sn,z:An,angle:Pn})}else Dt(It,Ae)}if(Y){Ve.clear();const Je=b.icon.placedSymbolArray;for(let ot=0;ot<Je.length;ot++){const Ct=Je.get(ot),{numGlyphs:_t}=Ct,It=Ue[ot];if(Ct.hidden||!It)Dt(_t,Ve);else{const{x:jt,y:Wt,z:Qt,angle:Bn}=It;for(let Xt=0;Xt<_t;Xt++)p.addDynamicAttributes(Ve,jt,Wt,Qt,Bn)}}b.icon.dynamicLayoutVertexBuffer.updateData(Ve)}b.text.dynamicLayoutVertexBuffer.updateData(Ae)}function ta(b,c,m){return m.iconsInText&&c?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function uu(b,c,m,C,T,P,F,z,j,W,Y,fe){const Ae=b.context,Ve=Ae.gl,Ue=b.transform,Ge="map"===z,qe="map"===j,Ie=Ge&&"point"!==m.layout.get("symbol-placement"),tt=Ge&&!qe&&!Ie,Je=void 0!==m.layout.get("symbol-sort-key").constantOr(1);let ot=!1;const Ct=b.depthModeForSublayer(0,p.DepthMode.ReadOnly),_t=[p.mercatorXfromLng(Ue.center.lng),p.mercatorYfromLat(Ue.center.lat)],It=m.layout.get("text-variable-anchor"),jt="globe"===Ue.projection.name,Wt=[],Qt=[0,-1,0];let Bn=Qt;!jt&&!Ue.mercatorFromTransition||Ge||(Bn=function(Xt){const yn=Xt._camera.getWorldToCamera(Xt.worldSize,1),sn=p.multiply([],yn,Xt.globeMatrix);p.invert(sn,sn);const An=[0,0,0],Ht=[0,1,0,0];return p.transformMat4$1(Ht,Ht,sn),An[0]=Ht[0],An[1]=Ht[1],An[2]=Ht[2],p.normalize(An,An),An}(Ue));for(const Xt of C){const yn=c.getTile(Xt),sn=yn.getBucket(m);if(!sn||"mercator"===sn.projection.name&&jt)continue;const An=T?sn.text:sn.icon;if(!An||sn.fullyClipped||!An.segments.get().length)continue;const Ht=An.programConfigurations.get(m.id),Vt=T||sn.sdfIcons,en=T?sn.textSizeData:sn.iconSizeData,xn=qe||0!==Ue.pitch,Pn=p.evaluateSizeForZoom(en,Ue.zoom);let br,wi,gr,or,Ir=[0,0],qi=null;if(T){if(wi=yn.glyphAtlasTexture,gr=Ve.LINEAR,br=yn.glyphAtlasTexture.size,sn.iconsInText){Ir=yn.imageAtlasTexture.size,qi=yn.imageAtlasTexture;const _l="composite"===en.kind||"camera"===en.kind;or=xn||b.options.rotating||b.options.zooming||_l?Ve.LINEAR:Ve.NEAREST}}else{const _l=1!==m.layout.get("icon-size").constantOr(0)||sn.iconsNeedLinear;wi=yn.imageAtlasTexture,gr=Vt||b.options.rotating||b.options.zooming||_l||xn?Ve.LINEAR:Ve.NEAREST,br=yn.imageAtlasTexture.size}const Br="globe"===sn.projection.name,ns=Br?Bn:Qt,rs=Br?p.globeToMercatorTransition(Ue.zoom):0,fs=cn(Xt,sn.getProjection(),Ue),Rs=Ue.calculatePixelsToTileUnitsMatrix(yn),Fa=ol(fs,yn.tileID.canonical,qe,Ge,Ue,sn.getProjection(),Rs),cu=b.terrain&&qe&&Ie?p.invert(p.create(),Fa):cs,Jl=ao(fs,yn.tileID.canonical,qe,Ge,Ue,sn.getProjection(),Rs),Bc=It&&sn.hasTextData(),Vs="none"!==m.layout.get("icon-text-fit")&&Bc&&sn.hasIconData();if(Ie){const _l=Ue.elevation,sc=_l?_l.getAtTileOffsetFunc(Xt,Ue.center.lat,Ue.worldSize,sn.getProjection()):null,Uc=xc(fs,yn.tileID.canonical,qe,Ge,Ue,sn.getProjection(),Rs);On(sn,fs,b,T,Uc,Jl,qe,W,sc,Xt)}const xs=Ie||T&&It||Vs,yo=b.translatePosMatrix(fs,yn,P,F),ya=xs?cs:Fa,nl=b.translatePosMatrix(Jl,yn,P,F,!0),ds=sn.getProjection().createInversionMatrix(Ue,Xt.canonical),Ha=[];b.terrainRenderModeElevated()&&qe&&Ha.push("PITCH_WITH_MAP_TERRAIN"),Br&&Ha.push("PROJECTION_GLOBE_VIEW"),xs&&Ha.push("PROJECTED_POS_ON_VIEWPORT");const Wa=Vt&&0!==m.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1);let zc;zc=Vt?sn.iconsInText?Yi(en.kind,Pn,tt,qe,b,yo,ya,nl,br,Ir,Xt,rs,_t,ds,ns,sn.getProjection()):Ar(en.kind,Pn,tt,qe,b,yo,ya,nl,T,br,!0,Xt,rs,_t,ds,ns,sn.getProjection()):Hn(en.kind,Pn,tt,qe,b,yo,ya,nl,T,br,Xt,rs,_t,ds,ns,sn.getProjection());const ih={program:b.useProgram(ta(Vt,T,sn),Ht,Ha),buffers:An,uniformValues:zc,atlasTexture:wi,atlasTextureIcon:qi,atlasInterpolation:gr,atlasInterpolationIcon:or,isSDF:Vt,hasHalo:Wa,tile:yn,labelPlaneMatrixInv:cu};if(Je&&sn.canOverlap){ot=!0;const _l=An.segments.get();for(const sc of _l)Wt.push({segments:new p.SegmentVector([sc]),sortKey:sc.sortKey,state:ih})}else Wt.push({segments:An.segments,sortKey:0,state:ih})}ot&&Wt.sort((Xt,yn)=>Xt.sortKey-yn.sortKey);for(const Xt of Wt){const yn=Xt.state;if(b.terrain&&b.terrain.setupElevationDraw(yn.tile,yn.program,{useDepthForOcclusion:!jt,labelPlaneMatrixInv:yn.labelPlaneMatrixInv}),Ae.activeTexture.set(Ve.TEXTURE0),yn.atlasTexture.bind(yn.atlasInterpolation,Ve.CLAMP_TO_EDGE),yn.atlasTextureIcon&&(Ae.activeTexture.set(Ve.TEXTURE1),yn.atlasTextureIcon&&yn.atlasTextureIcon.bind(yn.atlasInterpolationIcon,Ve.CLAMP_TO_EDGE)),yn.isSDF){const sn=yn.uniformValues;yn.hasHalo&&(sn.u_is_halo=1,Il(yn.buffers,Xt.segments,m,b,yn.program,Ct,Y,fe,sn)),sn.u_is_halo=0}Il(yn.buffers,Xt.segments,m,b,yn.program,Ct,Y,fe,yn.uniformValues)}}function Il(b,c,m,C,T,P,F,z,j){const W=C.context,Y=[b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer,b.globeExtVertexBuffer];T.draw(W,W.gl.TRIANGLES,P,F,z,p.CullFaceMode.disabled,j,m.id,b.layoutVertexBuffer,b.indexBuffer,c,m.paint,C.transform.zoom,b.programConfigurations.get(m.id),Y)}function Ml(b,c,m,C,T,P,F){const z=b.context.gl,j=m.paint.get("fill-pattern"),W=j&&j.constantOr(1);let Y,fe,Ae,Ve,Ue;F?(fe=W&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=z.LINES):(fe=W?"fillPattern":"fill",Y=z.TRIANGLES);for(const Ge of C){const qe=c.getTile(Ge);if(W&&!qe.patternsLoaded())continue;const Ie=qe.getBucket(m);if(!Ie)continue;b.prepareDrawTile();const tt=Ie.programConfigurations.get(m.id),Je=b.useProgram(fe,tt);W&&(b.context.activeTexture.set(z.TEXTURE0),qe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),tt.updatePaintBuffers());const ot=j.constantOr(null);if(ot&&qe.imageAtlas){const _t=qe.imageAtlas.patternPositions[ot.toString()];_t&&tt.setConstantPatternPositions(_t)}const Ct=b.translatePosMatrix(Ge.projMatrix,qe,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));if(F){Ve=Ie.indexBuffer2,Ue=Ie.segments2;const _t=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Ae="fillOutlinePattern"===fe&&W?oi(Ct,b,qe,_t):Xl(Ct,_t)}else Ve=Ie.indexBuffer,Ue=Ie.segments,Ae=W?lu(Ct,b,qe):Si(Ct);b.prepareDrawProgram(b.context,Je,Ge.toUnwrapped()),Je.draw(b.context,Y,T,b.stencilModeForClipping(Ge),P,p.CullFaceMode.disabled,Ae,m.id,Ie.layoutVertexBuffer,Ve,Ue,m.paint,b.transform.zoom,tt)}}function Ja(b,c,m,C,T,P,F){const z=b.context,j=z.gl,W=b.transform,Y=m.paint.get("fill-extrusion-pattern"),fe=Y.constantOr(1),Ae=m.paint.get("fill-extrusion-opacity"),Ve=[m.paint.get("fill-extrusion-ambient-occlusion-intensity"),m.paint.get("fill-extrusion-ambient-occlusion-radius")],Ue=m.layout.get("fill-extrusion-edge-radius"),Ge="globe"===W.projection.name?p.fillExtrusionHeightLift():0,qe="globe"===W.projection.name,Ie=qe?p.globeToMercatorTransition(W.zoom):0,tt=[p.mercatorXfromLng(W.center.lng),p.mercatorYfromLat(W.center.lat)],Je=[];qe&&Je.push("PROJECTION_GLOBE_VIEW"),Ve[0]>0&&Je.push("FAUX_AO");for(const ot of C){const Ct=c.getTile(ot),_t=Ct.getBucket(m);if(!_t||_t.projection.name!==W.projection.name)continue;const It=_t.programConfigurations.get(m.id),jt=b.useProgram(fe?"fillExtrusionPattern":"fillExtrusion",It,Je);if(b.terrain){const An=b.terrain;if(b.style.terrainSetForDrapingOnly())An.setupElevationDraw(Ct,jt,{useMeterToDem:!0});else{if(!_t.enableTerrain)continue;if(An.setupElevationDraw(Ct,jt,{useMeterToDem:!0}),Ys(z,c,ot,_t,m,An),!_t.centroidVertexBuffer){const Ht=jt.attributes.a_centroid_pos;void 0!==Ht&&j.vertexAttrib2f(Ht,0,0)}}}fe&&(b.context.activeTexture.set(j.TEXTURE0),Ct.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),It.updatePaintBuffers());const Wt=Y.constantOr(null);if(Wt&&Ct.imageAtlas){const An=Ct.imageAtlas.patternPositions[Wt.toString()];An&&It.setConstantPatternPositions(An)}const Qt=b.translatePosMatrix(ot.projMatrix,Ct,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),Bn=W.projection.createInversionMatrix(W,ot.canonical),Xt=m.paint.get("fill-extrusion-vertical-gradient"),yn=fe?zs(Qt,b,Xt,Ae,Ve,Ue,ot,Ct,Ge,Ie,tt,Bn):Co(Qt,b,Xt,Ae,Ve,Ue,ot,Ge,Ie,tt,Bn);b.prepareDrawProgram(z,jt,ot.toUnwrapped());const sn=[];b.terrain&&sn.push(_t.centroidVertexBuffer),qe&&sn.push(_t.layoutVertexExtBuffer),jt.draw(z,z.gl.TRIANGLES,T,P,F,p.CullFaceMode.backCCW,yn,m.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,m.paint,b.transform.zoom,It,sn)}}function Ys(b,c,m,C,T,P){const F=[Ie=>{let tt=Ie.canonical.x-1,Je=Ie.wrap;return tt<0&&(tt=(1<<Ie.canonical.z)-1,Je--),new p.OverscaledTileID(Ie.overscaledZ,Je,Ie.canonical.z,tt,Ie.canonical.y)},Ie=>{let tt=Ie.canonical.x+1,Je=Ie.wrap;return tt===1<<Ie.canonical.z&&(tt=0,Je++),new p.OverscaledTileID(Ie.overscaledZ,Je,Ie.canonical.z,tt,Ie.canonical.y)},Ie=>new p.OverscaledTileID(Ie.overscaledZ,Ie.wrap,Ie.canonical.z,Ie.canonical.x,(0===Ie.canonical.y?1<<Ie.canonical.z:Ie.canonical.y)-1),Ie=>new p.OverscaledTileID(Ie.overscaledZ,Ie.wrap,Ie.canonical.z,Ie.canonical.x,Ie.canonical.y===(1<<Ie.canonical.z)-1?0:Ie.canonical.y+1)],z=Ie=>{const tt=c.getSource().minzoom,Je=Ct=>{const _t=c.getTileByID(Ct);if(_t&&_t.hasData())return _t.getBucket(T)},ot=[0,-1,1];for(const Ct of ot){if(Ie.overscaledZ+Ct<tt)continue;const _t=Je(Ie.calculateScaledKey(Ie.overscaledZ+Ct));if(_t)return _t}},j=[0,0,0],W=(Ie,tt)=>(j[0]=Math.min(Ie.min.y,tt.min.y),j[1]=Math.max(Ie.max.y,tt.max.y),j[2]=p.EXTENT-tt.min.x>Ie.max.x?tt.min.x-p.EXTENT:Ie.max.x,j),Y=(Ie,tt)=>(j[0]=Math.min(Ie.min.x,tt.min.x),j[1]=Math.max(Ie.max.x,tt.max.x),j[2]=p.EXTENT-tt.min.y>Ie.max.y?tt.min.y-p.EXTENT:Ie.max.y,j),fe=[(Ie,tt)=>W(Ie,tt),(Ie,tt)=>W(tt,Ie),(Ie,tt)=>Y(Ie,tt),(Ie,tt)=>Y(tt,Ie)],Ae=new p.pointGeometry(0,0);let Ve,Ue,Ge;const qe=(Ie,tt,Je,ot,Ct)=>{const _t=[[ot?Je:Ie,ot?Ie:Je,0],[ot?Je:tt,ot?tt:Je,0]],It=Ct<0?p.EXTENT+Ct:Ct,jt=[ot?It:(Ie+tt)/2,ot?(Ie+tt)/2:It,0];return 0===Je&&Ct<0||0!==Je&&Ct>0?P.getForTilePoints(Ge,[jt],!0,Ue):_t.push(jt),P.getForTilePoints(m,_t,!0,Ve),Math.max(_t[0][2],_t[1][2],jt[2])/P.exaggeration()};for(let Ie=0;Ie<4;Ie++){const tt=(Ie<2?1:5)-Ie,Je=C.borders[Ie];if(0===Je.length)continue;const ot=Ge=F[Ie](m),Ct=z(ot);if(!(Ct&&Ct instanceof p.FillExtrusionBucket&&Ct.enableTerrain)||C.borderDoneWithNeighborZ[Ie]===Ct.canonical.z&&Ct.borderDoneWithNeighborZ[tt]===C.canonical.z||(Ue=P.findDEMTileFor(ot),!Ue||!Ue.dem))continue;if(!Ve){const Wt=P.findDEMTileFor(m);if(!Wt||!Wt.dem)return;Ve=Wt}const _t=Ct.borders[tt];let It=0;const jt=Ct.borderDoneWithNeighborZ[tt]!==C.canonical.z;if(C.canonical.z===Ct.canonical.z){for(let Wt=0;Wt<Je.length;Wt++){const Qt=C.featuresOnBorder[Je[Wt]],Bn=Qt.borders[Ie];let Xt;for(;It<_t.length&&(Xt=Ct.featuresOnBorder[_t[It]],!(Xt.borders[tt][1]>Bn[0]+3));)jt&&Ct.encodeCentroid(void 0,Xt,!1),It++;if(Xt&&It<_t.length){const yn=It;let sn=0;for(;!(Xt.borders[tt][0]>Bn[1]-3)&&(sn++,++It!==_t.length);)Xt=Ct.featuresOnBorder[_t[It]];if(Xt=Ct.featuresOnBorder[_t[yn]],Qt.intersectsCount()>1||Xt.intersectsCount()>1||1!==sn){1!==sn&&(It=yn),C.encodeCentroid(void 0,Qt,!1),jt&&Ct.encodeCentroid(void 0,Xt,!1);continue}const An=fe[Ie](Qt,Xt),Ht=Ie%2?p.EXTENT-1:0;Ae.x=qe(An[0],Math.min(p.EXTENT-1,An[1]),Ht,Ie<2,An[2]),Ae.y=0,C.encodeCentroid(Ae,Qt,!1),jt&&Ct.encodeCentroid(Ae,Xt,!1)}else C.encodeCentroid(void 0,Qt,!1)}C.borderDoneWithNeighborZ[Ie]=Ct.canonical.z,C.needsCentroidUpdate=!0,jt&&(Ct.borderDoneWithNeighborZ[tt]=C.canonical.z,Ct.needsCentroidUpdate=!0)}else{for(const Wt of Je)C.encodeCentroid(void 0,C.featuresOnBorder[Wt],!1);if(jt){for(const Wt of _t)Ct.encodeCentroid(void 0,Ct.featuresOnBorder[Wt],!1);Ct.borderDoneWithNeighborZ[tt]=C.canonical.z,Ct.needsCentroidUpdate=!0}C.borderDoneWithNeighborZ[Ie]=Ct.canonical.z,C.needsCentroidUpdate=!0}}(C.needsCentroidUpdate||!C.centroidVertexBuffer&&0!==C.centroidVertexArray.length)&&C.uploadCentroid(b)}const sl=new p.Color(1,0,0,1),ba=new p.Color(0,1,0,1),af=new p.Color(0,0,1,1),no=new p.Color(1,0,1,1),ro=new p.Color(0,1,1,1);function Us(b,c,m){const C=b.context,T=b.transform,P=C.gl,F="globe"===T.projection.name,z=F?["PROJECTION_GLOBE_VIEW"]:null;let j=m.projMatrix;if(F&&p.globeToMercatorTransition(T.zoom)>0){const Qt=p.transitionTileAABBinECEF(m.canonical,T),Bn=p.globeDenormalizeECEF(Qt);j=p.multiply(new Float32Array(16),T.globeMatrix,Bn),p.multiply(j,T.projMatrix,j)}const W=b.useProgram("debug",null,z),Y=c.getTileByID(m.key);b.terrain&&b.terrain.setupElevationDraw(Y,W);const fe=p.DepthMode.disabled,Ae=p.StencilMode.disabled,Ve=b.colorModeForRenderPass();C.activeTexture.set(P.TEXTURE0),b.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),F?Y._makeGlobeTileDebugBuffers(b.context,T):Y._makeDebugTileBoundsBuffers(b.context,T.projection);const Ge=Y._tileDebugBuffer||b.debugBuffer,qe=Y._tileDebugIndexBuffer||b.debugIndexBuffer,Ie=Y._tileDebugSegments||b.debugSegments;W.draw(C,P.LINE_STRIP,fe,Ae,Ve,p.CullFaceMode.disabled,ts(j,p.Color.red),"$debug",Ge,qe,Ie,null,null,null,[Y._globeTileDebugBorderBuffer]);const tt=Y.latestRawTileData,Je=Math.floor((tt&&tt.byteLength||0)/1024),ot=c.getTile(m).tileSize,Ct=512/Math.min(ot,512)*(m.overscaledZ/T.zoom)*.5;let _t=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(_t+=` => ${m.overscaledZ}`),_t+=` ${Je}kb`,function(Qt,Bn){Qt.initDebugOverlayCanvas();const Xt=Qt.debugOverlayCanvas,yn=Qt.context.gl,sn=Qt.debugOverlayCanvas.getContext("2d");sn.clearRect(0,0,Xt.width,Xt.height),sn.shadowColor="white",sn.shadowBlur=2,sn.lineWidth=1.5,sn.strokeStyle="white",sn.textBaseline="top",sn.font="bold 36px Open Sans, sans-serif",sn.fillText(Bn,5,5),sn.strokeText(Bn,5,5),Qt.debugOverlayTexture.update(Xt),Qt.debugOverlayTexture.bind(yn.LINEAR,yn.CLAMP_TO_EDGE)}(b,_t);const It=Y._tileDebugTextBuffer||b.debugBuffer,jt=Y._tileDebugTextIndexBuffer||b.quadTriangleIndexBuffer,Wt=Y._tileDebugTextSegments||b.debugSegments;W.draw(C,P.TRIANGLES,fe,Ae,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,ts(j,p.Color.transparent,Ct),"$debug",It,jt,Wt,null,null,null,[Y._globeTileDebugTextBuffer])}function mo(b,c,m,C){_s(b,0,c+m/2,b.transform.width,m,C)}function Aa(b,c,m,C){_s(b,c-m/2,0,m,b.transform.height,C)}function _s(b,c,m,C,T,P){const F=b.context,z=F.gl;z.enable(z.SCISSOR_TEST),z.scissor(c*p.exported.devicePixelRatio,m*p.exported.devicePixelRatio,C*p.exported.devicePixelRatio,T*p.exported.devicePixelRatio),F.clear({color:P}),z.disable(z.SCISSOR_TEST)}const al=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Pa}=al;function pa(b,c,m,C){b.emplaceBack(c,m,C)}class Ks{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,pa(this.vertexArray,-1,-1,1),pa(this.vertexArray,1,-1,1),pa(this.vertexArray,-1,1,1),pa(this.vertexArray,1,1,1),pa(this.vertexArray,-1,-1,-1),pa(this.vertexArray,1,-1,-1),pa(this.vertexArray,-1,1,-1),pa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Pa),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function ci(b,c,m,C,T,P){const F=b.gl,z=c.paint.get("sky-atmosphere-color"),j=c.paint.get("sky-atmosphere-halo-color"),W=c.paint.get("sky-atmosphere-sun-intensity"),Y={u_matrix_3f:p.fromMat4(p.create$1(),C),u_sun_direction:T,u_sun_intensity:W,u_color_tint_r:[(Ue=z).r,Ue.g,Ue.b,Ue.a],u_color_tint_m:[(Ge=j).r,Ge.g,Ge.b,Ge.a],u_luminance:5e-5};var Ue,Ge;F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_CUBE_MAP_POSITIVE_X+P,c.skyboxTexture,0),m.draw(b,F.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,Y,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const vs=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Mh{constructor(c){const m=new p.StructArrayLayout5f20;m.emplaceBack(-1,1,1,0,0),m.emplaceBack(1,1,1,1,0),m.emplaceBack(1,-1,1,1,1),m.emplaceBack(-1,-1,1,0,1);const C=new p.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(m,vs.members),this.indexBuffer=c.createIndexBuffer(C),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qa={symbol:function(b,c,m,C,T){if("translucent"!==b.renderPass)return;const P=p.StencilMode.disabled,F=b.colorModeForRenderPass();m.layout.get("text-variable-anchor")&&function(z,j,W,Y,fe,Ae,Ve){const Ue=j.transform,Ge="map"===fe,qe="map"===Ae;for(const Ie of z){const tt=Y.getTile(Ie),Je=tt.getBucket(W);if(!Je||!Je.text||!Je.text.segments.get().length)continue;const ot=p.evaluateSizeForZoom(Je.textSizeData,Ue.zoom),Ct=cn(Ie,Je.getProjection(),Ue),_t=Ue.calculatePixelsToTileUnitsMatrix(tt),It=ol(Ct,tt.tileID.canonical,qe,Ge,Ue,Je.getProjection(),_t),jt="none"!==W.layout.get("icon-text-fit")&&Je.hasIconData();if(ot){const Wt=Math.pow(2,Ue.zoom-tt.tileID.overscaledZ);io(Je,Ge,qe,Ve,p.symbolSize,Ue,It,Ie,Wt,ot,jt)}}}(C,b,m,c,m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),T),0!==m.paint.get("icon-opacity").constantOr(1)&&uu(b,c,m,C,!1,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),m.layout.get("icon-rotation-alignment"),m.layout.get("icon-pitch-alignment"),m.layout.get("icon-keep-upright"),P,F),0!==m.paint.get("text-opacity").constantOr(1)&&uu(b,c,m,C,!0,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),m.layout.get("text-keep-upright"),P,F),c.map.showCollisionBoxes&&(Bi(b,c,m,C,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),!0),Bi(b,c,m,C,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),!1))},circle:function(b,c,m,C){if("translucent"!==b.renderPass)return;const T=m.paint.get("circle-opacity"),P=m.paint.get("circle-stroke-width"),F=m.paint.get("circle-stroke-opacity"),z=void 0!==m.layout.get("circle-sort-key").constantOr(1);if(0===T.constantOr(1)&&(0===P.constantOr(1)||0===F.constantOr(1)))return;const j=b.context,W=j.gl,Y=b.transform,fe=b.depthModeForSublayer(0,p.DepthMode.ReadOnly),Ae=p.StencilMode.disabled,Ve=b.colorModeForRenderPass(),Ue="globe"===Y.projection.name,Ge=[p.mercatorXfromLng(Y.center.lng),p.mercatorYfromLat(Y.center.lat)],qe=[];for(let tt=0;tt<C.length;tt++){const Je=C[tt],ot=c.getTile(Je),Ct=ot.getBucket(m);if(!Ct||Ct.projection.name!==Y.projection.name)continue;const _t=Ct.programConfigurations.get(m.id),It=Cs(m);Ue&&It.push("PROJECTION_GLOBE_VIEW");const jt=b.useProgram("circle",_t,It),Wt=Ct.layoutVertexBuffer,Qt=Ct.globeExtVertexBuffer,Bn=Ct.indexBuffer,Xt=Y.projection.createInversionMatrix(Y,Je.canonical),yn={programConfiguration:_t,program:jt,layoutVertexBuffer:Wt,globeExtVertexBuffer:Qt,indexBuffer:Bn,uniformValues:$a(b,Je,ot,Xt,Ge,m),tile:ot};if(z){const sn=Ct.segments.get();for(const An of sn)qe.push({segments:new p.SegmentVector([An]),sortKey:An.sortKey,state:yn})}else qe.push({segments:Ct.segments,sortKey:0,state:yn})}z&&qe.sort((tt,Je)=>tt.sortKey-Je.sortKey);const Ie={useDepthForOcclusion:!Ue};for(const tt of qe){const{programConfiguration:Je,program:ot,layoutVertexBuffer:Ct,globeExtVertexBuffer:_t,indexBuffer:It,uniformValues:jt,tile:Wt}=tt.state,Qt=tt.segments;b.terrain&&b.terrain.setupElevationDraw(Wt,ot,Ie),b.prepareDrawProgram(j,ot,Wt.tileID.toUnwrapped()),ot.draw(j,W.TRIANGLES,fe,Ae,Ve,p.CullFaceMode.disabled,jt,m.id,Ct,It,Qt,m.paint,Y.zoom,Je,[_t])}},heatmap:function(b,c,m,C){if(0!==m.paint.get("heatmap-opacity"))if("offscreen"===b.renderPass){const T=b.context,P=T.gl,F=p.StencilMode.disabled,z=new p.ColorMode([P.ONE,P.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ve,Ue,Ge,qe){const Ie=Ve.gl,tt=Ue.width*qe,Je=Ue.height*qe;Ve.activeTexture.set(Ie.TEXTURE1),Ve.viewport.set([0,0,tt,Je]);let ot=Ge.heatmapFbo;if(!ot||ot&&(ot.width!==tt||ot.height!==Je)){ot&&ot.destroy();const Ct=Ie.createTexture();Ie.bindTexture(Ie.TEXTURE_2D,Ct),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_S,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_T,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MAG_FILTER,Ie.LINEAR),ot=Ge.heatmapFbo=Ve.createFramebuffer(tt,Je,!1),function(_t,It,jt,Wt,Qt,Bn){const Xt=_t.gl;Xt.texImage2D(Xt.TEXTURE_2D,0,_t.isWebGL2&&_t.extRenderToTextureHalfFloat?Xt.RGBA16F:Xt.RGBA,Qt,Bn,0,Xt.RGBA,_t.extRenderToTextureHalfFloat?_t.isWebGL2?Xt.HALF_FLOAT:_t.extTextureHalfFloat.HALF_FLOAT_OES:Xt.UNSIGNED_BYTE,null),Wt.colorAttachment.set(jt)}(Ve,0,Ct,ot,tt,Je)}else Ie.bindTexture(Ie.TEXTURE_2D,ot.colorAttachment.get()),Ve.bindFramebuffer.set(ot.framebuffer)})(T,b,m,"globe"===b.transform.projection.name?.5:.25),T.clear({color:p.Color.transparent});const j=b.transform,W="globe"===j.projection.name,Y=W?["PROJECTION_GLOBE_VIEW"]:null,fe=W?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Ae=[p.mercatorXfromLng(j.center.lng),p.mercatorYfromLat(j.center.lat)];for(let Ve=0;Ve<C.length;Ve++){const Ue=C[Ve];if(c.hasRenderableParent(Ue))continue;const Ge=c.getTile(Ue),qe=Ge.getBucket(m);if(!qe||qe.projection.name!==j.projection.name)continue;const Ie=qe.programConfigurations.get(m.id),tt=b.useProgram("heatmap",Ie,Y),{zoom:Je}=b.transform;b.terrain&&b.terrain.setupElevationDraw(Ge,tt),b.prepareDrawProgram(T,tt,Ue.toUnwrapped());const ot=j.projection.createInversionMatrix(j,Ue.canonical);tt.draw(T,P.TRIANGLES,p.DepthMode.disabled,F,z,fe,Ds(b,Ue,Ge,ot,Ae,Je,m.paint.get("heatmap-intensity")),m.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,m.paint,b.transform.zoom,Ie,W?[qe.globeExtVertexBuffer]:null)}T.viewport.set([0,0,b.width,b.height])}else"translucent"===b.renderPass&&(b.context.setColorMode(b.colorModeForRenderPass()),function(T,P){const F=T.context,z=F.gl,j=P.heatmapFbo;if(!j)return;F.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,j.colorAttachment.get()),F.activeTexture.set(z.TEXTURE1);let W=P.colorRampTexture;W||(W=P.colorRampTexture=new p.Texture(F,P.colorRamp,z.RGBA)),W.bind(z.LINEAR,z.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(F,z.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,T.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")},P.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,P.paint,T.transform.zoom)}(b,m))},line:function(b,c,m,C){if("translucent"!==b.renderPass)return;const T=m.paint.get("line-opacity"),P=m.paint.get("line-width");if(0===T.constantOr(1)||0===P.constantOr(1))return;const F=b.depthModeForSublayer(0,p.DepthMode.ReadOnly),z=b.colorModeForRenderPass(),j=b.terrain&&b.terrain.renderingToTexture?1:p.exported.devicePixelRatio,W=m.paint.get("line-dasharray"),Y=W.constantOr(1),fe=m.layout.get("line-cap"),Ae=m.paint.get("line-pattern"),Ve=Ae.constantOr(1),Ue=m.paint.get("line-gradient"),Ge=Ve?"linePattern":"line",qe=b.context,Ie=qe.gl,tt=(ot=>{const Ct=[];Tl(ot)&&Ct.push("RENDER_LINE_DASH"),ot.paint.get("line-gradient")&&Ct.push("RENDER_LINE_GRADIENT");const _t=ot.paint.get("line-trim-offset");0===_t[0]&&0===_t[1]||Ct.push("RENDER_LINE_TRIM_OFFSET");const It=ot.paint.get("line-pattern").constantOr(1),jt=1!==ot.paint.get("line-opacity").constantOr(1);return!It&&jt&&Ct.push("RENDER_LINE_ALPHA_DISCARD"),Ct})(m);let Je=tt.includes("RENDER_LINE_ALPHA_DISCARD");b.terrain&&b.terrain.clipOrMaskOverlapStencilType()&&(Je=!1);for(const ot of C){const Ct=c.getTile(ot);if(Ve&&!Ct.patternsLoaded())continue;const _t=Ct.getBucket(m);if(!_t)continue;b.prepareDrawTile();const It=_t.programConfigurations.get(m.id),jt=b.useProgram(Ge,It,tt),Wt=Ae.constantOr(null);if(Wt&&Ct.imageAtlas){const Vt=Ct.imageAtlas.patternPositions[Wt.toString()];Vt&&It.setConstantPatternPositions(Vt)}const Qt=W.constantOr(null),Bn=fe.constantOr(null);if(!Ve&&Qt&&Bn&&Ct.lineAtlas){const Vt=Ct.lineAtlas.getDash(Qt,Bn);Vt&&It.setConstantPatternPositions(Vt)}let[Xt,yn]=m.paint.get("line-trim-offset");("round"===Bn||"square"===Bn)&&Xt!==yn&&(0===Xt&&(Xt-=1),1===yn&&(yn+=1));const sn=b.terrain?ot.projMatrix:null,An=Ve?Pu(b,Ct,m,sn,j):co(b,Ct,m,sn,_t.lineClipsArray.length,j,[Xt,yn]);if(Ue){const Vt=_t.gradients[m.id];let en=Vt.texture;if(m.gradientVersion!==Vt.version){let xn=256;if(m.stepInterpolant){const Pn=c.getSource().maxzoom,br=ot.canonical.z===Pn?Math.ceil(1<<b.transform.maxZoom-ot.canonical.z):1;xn=p.clamp(p.nextPowerOfTwo(_t.maxLineLength/p.EXTENT*1024*br),256,qe.maxTextureSize)}Vt.gradient=p.renderColorRamp({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:xn,image:Vt.gradient||void 0,clips:_t.lineClipsArray}),Vt.texture?Vt.texture.update(Vt.gradient):Vt.texture=new p.Texture(qe,Vt.gradient,Ie.RGBA),Vt.version=m.gradientVersion,en=Vt.texture}qe.activeTexture.set(Ie.TEXTURE1),en.bind(m.stepInterpolant?Ie.NEAREST:Ie.LINEAR,Ie.CLAMP_TO_EDGE)}Y&&(qe.activeTexture.set(Ie.TEXTURE0),Ct.lineAtlasTexture.bind(Ie.LINEAR,Ie.REPEAT),It.updatePaintBuffers()),Ve&&(qe.activeTexture.set(Ie.TEXTURE0),Ct.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),It.updatePaintBuffers()),b.prepareDrawProgram(qe,jt,ot.toUnwrapped());const Ht=Vt=>{jt.draw(qe,Ie.TRIANGLES,F,Vt,z,p.CullFaceMode.disabled,An,m.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,m.paint,b.transform.zoom,It,[_t.layoutVertexBuffer2])};if(Je){const Vt=b.stencilModeForClipping(ot).ref;0===Vt&&b.terrain&&qe.clear({stencil:0});const en={func:Ie.EQUAL,mask:255};An.u_alpha_discard_threshold=.8,Ht(new p.StencilMode(en,Vt,255,Ie.KEEP,Ie.KEEP,Ie.INVERT)),An.u_alpha_discard_threshold=0,Ht(new p.StencilMode(en,Vt,255,Ie.KEEP,Ie.KEEP,Ie.KEEP))}else Ht(b.stencilModeForClipping(ot))}Je&&(b.resetStencilClippingMasks(),b.terrain&&qe.clear({stencil:0}))},fill:function(b,c,m,C){const T=m.paint.get("fill-color"),P=m.paint.get("fill-opacity");if(0===P.constantOr(1))return;const F=b.colorModeForRenderPass(),z=m.paint.get("fill-pattern"),j=b.opaquePassEnabledForLayer()&&!z.constantOr(1)&&1===T.constantOr(p.Color.transparent).a&&1===P.constantOr(0)?"opaque":"translucent";if(b.renderPass===j){const W=b.depthModeForSublayer(1,"opaque"===b.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Ml(b,c,m,C,W,F,!1)}if("translucent"===b.renderPass&&m.paint.get("fill-antialias")){const W=b.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Ml(b,c,m,C,W,F,!0)}},"fill-extrusion":function(b,c,m,C){const T=m.paint.get("fill-extrusion-opacity");if(0!==T&&"translucent"===b.renderPass){const P=new p.DepthMode(b.context.gl.LEQUAL,p.DepthMode.ReadWrite,b.depthRangeFor3D);if(1!==T||m.paint.get("fill-extrusion-pattern").constantOr(1))Ja(b,c,m,C,P,p.StencilMode.disabled,p.ColorMode.disabled),Ja(b,c,m,C,P,b.stencilModeFor3D(),b.colorModeForRenderPass()),b.resetStencilClippingMasks();else{const F=b.colorModeForRenderPass();Ja(b,c,m,C,P,p.StencilMode.disabled,F)}}},hillshade:function(b,c,m,C){if("offscreen"!==b.renderPass&&"translucent"!==b.renderPass)return;const T=b.context,P=b.depthModeForSublayer(0,p.DepthMode.ReadOnly),F=b.colorModeForRenderPass(),z=b.terrain&&b.terrain.renderingToTexture,[j,W]="translucent"!==b.renderPass||z?[{},C]:b.stencilConfigForOverlap(C);for(const Y of W){const fe=c.getTile(Y);if(fe.needsHillshadePrepare&&"offscreen"===b.renderPass)bc(b,fe,m,P,p.StencilMode.disabled,F);else if("translucent"===b.renderPass){const Ae=z&&b.terrain?b.terrain.stencilModeForRTTOverlap(Y):j[Y.overscaledZ];ja(b,Y,fe,m,P,Ae,F)}}T.viewport.set([0,0,b.width,b.height]),b.resetStencilClippingMasks()},raster:function(b,c,m,C,T,P){if("translucent"!==b.renderPass||0===m.paint.get("raster-opacity")||!C.length)return;const F=b.context,z=F.gl,j=c.getSource(),W=b.useProgram("raster"),Y=b.colorModeForRenderPass(),fe=b.terrain&&b.terrain.renderingToTexture,[Ae,Ve]=j instanceof yt||fe?[{},C]:b.stencilConfigForOverlap(C),Ue=Ve[Ve.length-1].overscaledZ,Ge=!b.options.moving;for(const qe of Ve){const Ie=fe?p.DepthMode.disabled:b.depthModeForSublayer(qe.overscaledZ-Ue,1===m.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,z.LESS),tt=qe.toUnwrapped(),Je=c.getTile(qe);if(fe&&(!Je||!Je.hasData()))continue;const ot=fe?qe.projMatrix:b.transform.calculateProjMatrix(tt,Ge),Ct=b.terrain&&fe?b.terrain.stencilModeForRTTOverlap(qe):Ae[qe.overscaledZ],_t=P?0:m.paint.get("raster-fade-duration");Je.registerFadeDuration(_t);const It=c.findLoadedParent(qe,0),jt=Ga(Je,It,c,b.transform,_t);let Wt,Qt;b.terrain&&b.terrain.prepareDrawTile();const Bn="nearest"===m.paint.get("raster-resampling")?z.NEAREST:z.LINEAR;F.activeTexture.set(z.TEXTURE0),Je.texture.bind(Bn,z.CLAMP_TO_EDGE),F.activeTexture.set(z.TEXTURE1),It?(It.texture.bind(Bn,z.CLAMP_TO_EDGE),Wt=Math.pow(2,It.tileID.overscaledZ-Je.tileID.overscaledZ),Qt=[Je.tileID.canonical.x*Wt%1,Je.tileID.canonical.y*Wt%1]):Je.texture.bind(Bn,z.CLAMP_TO_EDGE);const Xt=Zl(ot,Qt||[0,0],Wt||1,jt,m,j instanceof yt?j.perspectiveTransform:[0,0]);if(b.prepareDrawProgram(F,W,tt),j instanceof yt)j.boundsBuffer&&j.boundsSegments&&W.draw(F,z.TRIANGLES,Ie,p.StencilMode.disabled,Y,p.CullFaceMode.disabled,Xt,m.id,j.boundsBuffer,b.quadTriangleIndexBuffer,j.boundsSegments);else{const{tileBoundsBuffer:yn,tileBoundsIndexBuffer:sn,tileBoundsSegments:An}=b.getTileBoundsBuffers(Je);W.draw(F,z.TRIANGLES,Ie,Ct,Y,p.CullFaceMode.disabled,Xt,m.id,yn,sn,An)}}b.resetStencilClippingMasks()},background:function(b,c,m,C){const T=m.paint.get("background-color"),P=m.paint.get("background-opacity");if(0===P)return;const F=b.context,z=F.gl,j=b.transform,W=j.tileSize,Y=m.paint.get("background-pattern");if(b.isPatternMissing(Y))return;const fe=!Y&&1===T.a&&1===P&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==fe)return;const Ae=p.StencilMode.disabled,Ve=b.depthModeForSublayer(0,"opaque"===fe?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Ue=b.colorModeForRenderPass(),Ge=b.useProgram(Y?"backgroundPattern":"background");let qe,Ie=C;Ie||(qe=b.getBackgroundTiles(),Ie=Object.values(qe).map(tt=>tt.tileID)),Y&&(F.activeTexture.set(z.TEXTURE0),b.imageManager.bind(b.context));for(const tt of Ie){const Je=tt.toUnwrapped(),ot=C?tt.projMatrix:b.transform.calculateProjMatrix(Je);b.prepareDrawTile();const Ct=c?c.getTile(tt):qe?qe[tt.key]:new p.Tile(tt,W,j.zoom,b),_t=Y?ks(ot,P,b,Y,{tileID:tt,tileSize:W}):ei(ot,P,T);b.prepareDrawProgram(F,Ge,Je);const{tileBoundsBuffer:It,tileBoundsIndexBuffer:jt,tileBoundsSegments:Wt}=b.getTileBoundsBuffers(Ct);Ge.draw(F,z.TRIANGLES,Ve,Ae,Ue,p.CullFaceMode.disabled,_t,m.id,It,jt,Wt)}},sky:function(b,c,m){const C=b.transform,T="mercator"===C.projection.name||"globe"===C.projection.name?1:p.smoothstep(7,8,C.zoom),P=m.paint.get("sky-opacity")*T;if(0===P)return;const F=b.context,z=m.paint.get("sky-type"),j=new p.DepthMode(F.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),W=b.frameCounter/1e3%1;"atmosphere"===z?"offscreen"===b.renderPass?m.needsSkyboxCapture(b)&&(function(Y,fe,Ae,Ve){const Ue=Y.context,Ge=Ue.gl;let qe=fe.skyboxFbo;if(!qe){qe=fe.skyboxFbo=Ue.createFramebuffer(32,32,!1),fe.skyboxGeometry=new Ks(Ue),fe.skyboxTexture=Ue.gl.createTexture(),Ge.bindTexture(Ge.TEXTURE_CUBE_MAP,fe.skyboxTexture),Ge.texParameteri(Ge.TEXTURE_CUBE_MAP,Ge.TEXTURE_WRAP_S,Ge.CLAMP_TO_EDGE),Ge.texParameteri(Ge.TEXTURE_CUBE_MAP,Ge.TEXTURE_WRAP_T,Ge.CLAMP_TO_EDGE),Ge.texParameteri(Ge.TEXTURE_CUBE_MAP,Ge.TEXTURE_MIN_FILTER,Ge.LINEAR),Ge.texParameteri(Ge.TEXTURE_CUBE_MAP,Ge.TEXTURE_MAG_FILTER,Ge.LINEAR);for(let ot=0;ot<6;++ot)Ge.texImage2D(Ge.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0,Ge.RGBA,32,32,0,Ge.RGBA,Ge.UNSIGNED_BYTE,null)}Ue.bindFramebuffer.set(qe.framebuffer),Ue.viewport.set([0,0,32,32]);const Ie=fe.getCenter(Y,!0),tt=Y.useProgram("skyboxCapture"),Je=new Float64Array(16);p.identity(Je),p.rotateY(Je,Je,.5*-Math.PI),ci(Ue,fe,tt,Je,Ie,0),p.identity(Je),p.rotateY(Je,Je,.5*Math.PI),ci(Ue,fe,tt,Je,Ie,1),p.identity(Je),p.rotateX(Je,Je,.5*-Math.PI),ci(Ue,fe,tt,Je,Ie,2),p.identity(Je),p.rotateX(Je,Je,.5*Math.PI),ci(Ue,fe,tt,Je,Ie,3),p.identity(Je),ci(Ue,fe,tt,Je,Ie,4),p.identity(Je),p.rotateY(Je,Je,Math.PI),ci(Ue,fe,tt,Je,Ie,5),Ue.viewport.set([0,0,Y.width,Y.height])}(b,m),m.markSkyboxValid(b)):"sky"===b.renderPass&&function(Y,fe,Ae,Ve,Ue){const Ge=Y.context,qe=Ge.gl,Ie=Y.transform,tt=Y.useProgram("skybox");Ge.activeTexture.set(qe.TEXTURE0),qe.bindTexture(qe.TEXTURE_CUBE_MAP,fe.skyboxTexture);const Je={u_matrix:Ie.skyboxMatrix,u_sun_direction:fe.getCenter(Y,!1),u_cubemap:0,u_opacity:Ve,u_temporal_offset:Ue};Y.prepareDrawProgram(Ge,tt),tt.draw(Ge,qe.TRIANGLES,Ae,p.StencilMode.disabled,Y.colorModeForRenderPass(),p.CullFaceMode.backCW,Je,"skybox",fe.skyboxGeometry.vertexBuffer,fe.skyboxGeometry.indexBuffer,fe.skyboxGeometry.segment)}(b,m,j,P,W):"gradient"===z&&"sky"===b.renderPass&&function(Y,fe,Ae,Ve,Ue){const Ge=Y.context,qe=Ge.gl,Ie=Y.transform,tt=Y.useProgram("skyboxGradient");fe.skyboxGeometry||(fe.skyboxGeometry=new Ks(Ge)),Ge.activeTexture.set(qe.TEXTURE0);let Je=fe.colorRampTexture;Je||(Je=fe.colorRampTexture=new p.Texture(Ge,fe.colorRamp,qe.RGBA)),Je.bind(qe.LINEAR,qe.CLAMP_TO_EDGE);const ot=(Ct=Ie.skyboxMatrix,_t=fe.getCenter(Y,!1),It=fe.paint.get("sky-gradient-radius"),jt=Ve,Wt=Ue,{u_matrix:Ct,u_color_ramp:0,u_center_direction:_t,u_radius:p.degToRad(It),u_opacity:jt,u_temporal_offset:Wt});var Ct,_t,It,jt,Wt;Y.prepareDrawProgram(Ge,tt),tt.draw(Ge,qe.TRIANGLES,Ae,p.StencilMode.disabled,Y.colorModeForRenderPass(),p.CullFaceMode.backCW,ot,"skyboxGradient",fe.skyboxGeometry.vertexBuffer,fe.skyboxGeometry.indexBuffer,fe.skyboxGeometry.segment)}(b,m,j,P,W)},debug:function(b,c,m){for(let C=0;C<m.length;C++)Us(b,c,m[C])},custom:function(b,c,m,C){const T=b.context,P=m.implementation;if(!b.transform.projection.unsupportedLayers||!b.transform.projection.unsupportedLayers.includes("custom")||b.terrain&&(b.terrain.renderingToTexture||"offscreen"===b.renderPass)&&m.isLayerDraped()){if("offscreen"===b.renderPass){const F=P.prerender;if(F){if(b.setCustomLayerDefaults(),T.setColorMode(b.colorModeForRenderPass()),"globe"===b.transform.projection.name){const z=b.transform.pointMerc;F.call(P,T.gl,b.transform.customLayerMatrix(),b.transform.getProjection(),b.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(b.transform.zoom),[z.x,z.y],b.transform.pixelsPerMeterRatio)}else F.call(P,T.gl,b.transform.customLayerMatrix());T.setDirty(),b.setBaseState()}}else if("translucent"===b.renderPass){if(b.terrain&&b.terrain.renderingToTexture){const z=P.renderToTile;if(z){const j=C[0].canonical,W=new p.MercatorCoordinate(j.x+C[0].wrap*(1<<j.z),j.y,j.z);T.setDepthMode(p.DepthMode.disabled),T.setStencilMode(p.StencilMode.disabled),T.setColorMode(b.colorModeForRenderPass()),b.setCustomLayerDefaults(),z.call(P,T.gl,W),T.setDirty(),b.setBaseState()}return}b.setCustomLayerDefaults(),T.setColorMode(b.colorModeForRenderPass()),T.setStencilMode(p.StencilMode.disabled);const F="3d"===P.renderingMode?new p.DepthMode(b.context.gl.LEQUAL,p.DepthMode.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(T.setDepthMode(F),"globe"===b.transform.projection.name){const z=b.transform.pointMerc;P.render(T.gl,b.transform.customLayerMatrix(),b.transform.getProjection(),b.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(b.transform.zoom),[z.x,z.y],b.transform.pixelsPerMeterRatio)}else P.render(T.gl,b.transform.customLayerMatrix());T.setDirty(),b.setBaseState(),T.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ho{constructor(c,m,C=!1){this.context=new Ze(c,C),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fr,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,m){const C=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(C||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yr(this,c));const T=this._terrain;this.transform.elevation=C?T:null,T.update(c,this.transform,m)}_updateFog(c){const m=c.fog;if(!m||"globe"===this.transform.projection.name||m.getOpacity(this.transform.pitch)<1||m.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[C,T]=m.getFovAdjustedRange(this.transform._fov);if(C>T)return void(this.transform.fogCullDistSq=null);const P=C+.78*(T-C);this.transform.fogCullDistSq=P*P}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,m){if(this.width=c*p.exported.devicePixelRatio,this.height=m*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const C of this.style.order)this.style._layers[C].resize()}setup(){const c=this.context,m=new p.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(p.EXTENT,0),m.emplaceBack(0,p.EXTENT),m.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(m,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(p.EXTENT,0),C.emplaceBack(0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(C,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const T=new p.StructArrayLayout2i4;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(-1,1),T.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(T,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const P=new p.StructArrayLayout4i8;P.emplaceBack(0,0,0,0),P.emplaceBack(p.EXTENT,0,p.EXTENT,0),P.emplaceBack(0,p.EXTENT,0,p.EXTENT),P.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(P,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const F=new p.StructArrayLayout3ui6;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(F);const z=new p.StructArrayLayout1ui2;for(const W of[0,1,3,2,0])z.emplaceBack(W);this.debugIndexBuffer=c.createIndexBuffer(z),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const j=this.context.gl;this.stencilClearMode=new p.StencilMode({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new Mh(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,m=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,m.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,er(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,m,C){if(!m||this.currentStencilSource===m.id||!c.isTileClipped()||!C||0===C.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(const j of C)if(void 0===this._tileClippingMaskIDs[j.key]){z=!0;break}if(!z)return}this.currentStencilSource=m.id;const T=this.context,P=T.gl;this.nextStencilID+C.length>256&&this.clearStencil(),T.setColorMode(p.ColorMode.disabled),T.setDepthMode(p.DepthMode.disabled);const F=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of C){const j=m.getTile(z),W=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:Y,tileBoundsIndexBuffer:fe,tileBoundsSegments:Ae}=this.getTileBoundsBuffers(j);F.draw(T,P.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:P.ALWAYS,mask:0},W,255,P.KEEP,P.KEEP,P.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,er(z.projMatrix),"$clipping",Y,fe,Ae)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,m=this.context.gl;return new p.StencilMode({func:m.NOTEQUAL,mask:255},c,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const m=this.context.gl;return new p.StencilMode({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,m.KEEP,m.KEEP,m.REPLACE)}stencilConfigForOverlap(c){const m=this.context.gl,C=c.sort((F,z)=>z.overscaledZ-F.overscaledZ),T=C[C.length-1].overscaledZ,P=C[0].overscaledZ-T+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const F={};for(let z=0;z<P;z++)F[z+T]=new p.StencilMode({func:m.GEQUAL,mask:255},z+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=P,[F,C]}return[{[T]:p.StencilMode.disabled},C]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,m,C){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(C||this.context.gl.LEQUAL,m,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,m){this.style=c,this.options=m,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const C=this.style.order,T=this.style._sourceCaches;for(const j in T){const W=T[j];W.used&&W.prepare(this.context)}const P={},F={},z={};for(const j in T){const W=T[j];P[j]=W.getVisibleCoordinates(),F[j]=P[j].slice().reverse(),z[j]=W.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<C.length;j++)if(this.style._layers[C[j]].is3D()){this.opaquePassCutoff=j;break}if(this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),p.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const j of C){const W=this.style._layers[j],Y=c._getLayerSourceCache(W);if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;const fe=Y?F[Y.id]:void 0;("custom"===W.type||W.isSky()||fe&&fe.length)&&this.renderLayer(this,Y,W,fe)}if(this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:m.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=m.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[C[this.currentLayer]],W=c._getLayerSourceCache(j);if(j.isSky())continue;const Y=W?F[W.id]:void 0;this._renderTileClippingMasks(j,W,Y),this.renderLayer(this,W,j,Y)}if(this.style.fog&&this.transform.projection.supportsFog&&function(j,W){const Y=j.context,fe=Y.gl,Ae=j.transform,Ve=new p.DepthMode(fe.LEQUAL,p.DepthMode.ReadOnly,[0,1]),Ue=j.useProgram("globeAtmosphere",null,"globe"===Ae.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ge=p.globeToMercatorTransition(Ae.zoom),qe=W.properties.get("color").toArray01(),Ie=W.properties.get("high-color").toArray01(),tt=W.properties.get("space-color").toArray01PremultipliedAlpha(),Je=p.identity$1([]);p.rotateY$1(Je,Je,-p.degToRad(Ae._center.lng)),p.rotateX$1(Je,Je,p.degToRad(Ae._center.lat)),p.rotateZ$1(Je,Je,Ae.angle),p.rotateX$1(Je,Je,-Ae._pitch);const ot=p.fromQuat(new Float32Array(16),Je),Ct=p.mapValue(W.properties.get("star-intensity"),0,1,0,.25),It=p.mapValue(W.properties.get("horizon-blend"),0,1,5e-4,.25),jt=p.globeUseCustomAntiAliasing(j,Y,Ae)&&5e-4===It?Ae.worldSize/(2*Math.PI*1.025)-1:Ae.globeRadius,Wt=j.frameCounter/1e3%1,Qt=p.length(Ae.globeCenterInViewSpace),Bn=Math.sqrt(Math.pow(Qt,2)-Math.pow(jt,2)),Xt=Math.acos(Bn/Qt),yn={u_frustum_tl:Ae.frustumCorners.TL,u_frustum_tr:Ae.frustumCorners.TR,u_frustum_br:Ae.frustumCorners.BR,u_frustum_bl:Ae.frustumCorners.BL,u_horizon:Ae.frustumCorners.horizon,u_transition:Ge,u_fadeout_range:It,u_color:qe,u_high_color:Ie,u_space_color:tt,u_star_intensity:Ct,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Wt,u_horizon_angle:Xt,u_rotation_matrix:ot};j.prepareDrawProgram(Y,Ue);const sn=j.atmosphereBuffer;sn&&Ue.draw(Y,fe.TRIANGLES,Ve,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,yn,"skybox",sn.vertexBuffer,sn.indexBuffer,sn.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const j=this.style._layers[C[this.currentLayer]],W=c._getLayerSourceCache(j);j.isSky()&&this.renderLayer(this,W,j,W?F[W.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<C.length;){const j=this.style._layers[C[this.currentLayer]],W=c._getLayerSourceCache(j);if(j.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(j)){if(j.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Y=W?("symbol"===j.type?z:F)[W.id]:void 0;this._renderTileClippingMasks(j,W,W?P[W.id]:void 0),this.renderLayer(this,W,j,Y),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let j=null;p.values(this.style._layers).forEach(W=>{const Y=c._getLayerSourceCache(W);Y&&!W.isHidden(this.transform.zoom)&&(!j||j.getSource().maxzoom<Y.getSource().maxzoom)&&(j=Y)}),j&&this.options.showTileBoundaries&&Qa.debug(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const W=j.transform.padding;mo(j,j.transform.height-(W.top||0),3,sl),mo(j,W.bottom||0,3,ba),Aa(j,W.left||0,3,af),Aa(j,j.transform.width-(W.right||0),3,no);const Y=j.transform.centerPoint;var fe,Ae,Ve,Ue;_s(fe=j,(Ae=Y.x)-1,(Ve=j.transform.height-Y.y)-10,2,20,Ue=ro),_s(fe,Ae-10,Ve-1,20,2,Ue)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}}renderLayer(c,m,C,T){C.isHidden(this.transform.zoom)||("background"===C.type||"sky"===C.type||"custom"===C.type||T&&T.length)&&(this.id=C.id,this.gpuTimingStart(C),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(C.type)||c.terrain&&"custom"===C.type)&&Qa[C.type](c,m,C,T,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const m=this.context.extTimerQuery;let C=this.gpuTimers[c.id];C||(C=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:m.createQueryEXT()}),C.calls++,m.beginQueryEXT(m.TIME_ELAPSED_EXT,C.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,m=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(m),c.beginQueryEXT(c.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const m={};for(const C in c){const T=c[C],P=this.context.extTimerQuery,F=P.getQueryObjectEXT(T.query,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(T.query),m[C]=F}return m}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const m=this.context.extTimerQuery;let C=0;for(const T of c)C+=m.getQueryObjectEXT(T,m.QUERY_RESULT_EXT)/1e6,m.deleteQueryEXT(T);return C}translatePosMatrix(c,m,C,T,P){if(!C[0]&&!C[1])return c;const F=P?"map"===T?this.transform.angle:0:"viewport"===T?-this.transform.angle:0;if(F){const W=Math.sin(F),Y=Math.cos(F);C=[C[0]*Y-C[1]*W,C[0]*W+C[1]*Y]}const z=[P?C[0]:qt(m,C[0],this.transform.zoom),P?C[1]:qt(m,C[1],this.transform.zoom),0],j=new Float32Array(16);return p.translate(j,c,z),j}saveTileTexture(c){const m=this._tileTextures[c.size[0]];m?m.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const m=this._tileTextures[c];return m&&m.length>0?m.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,m=this.terrain&&0===this.terrain.exaggeration(),C=this.style&&this.style.fog,T=[];return this.terrainRenderModeElevated()&&T.push("TERRAIN"),"globe"===this.transform.projection.name&&T.push("GLOBE"),m&&T.push("ZERO_EXAGGERATION"),C&&!c&&0!==C.getOpacity(this.transform.pitch)&&T.push("FOG"),c&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}useProgram(c,m,C){this.cache=this.cache||{};const T=C||[],P=this.currentGlobalDefines().concat(T),F=Or.cacheKey(wc[c],c,P,m);return this.cache[F]||(this.cache[F]=new Or(this.context,c,wc[c],m,Gi[c],P)),this.cache[F]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,m,C){if(this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const P=T.getOpacity(this.transform.pitch),F=((z,j,W,Y,fe,Ae,Ve,Ue,Ge,qe,Ie)=>{const tt=z.transform,Je=j.properties.get("color").toArray01();Je[3]=Y;const ot=z.frameCounter/1e3%1;return{u_fog_matrix:W?tt.calculateFogTileMatrix(W):z.identityMat,u_fog_range:j.getFovAdjustedRange(tt._fov),u_fog_color:Je,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_temporal_offset:ot,u_frustum_tl:fe,u_frustum_tr:Ae,u_frustum_br:Ve,u_frustum_bl:Ue,u_globe_pos:Ge,u_globe_radius:qe,u_viewport:Ie,u_globe_transition:p.globeToMercatorTransition(tt.zoom),u_is_globe:+("globe"===tt.projection.name)}})(this,T,C,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);m.setFogUniformValues(c,F)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,m=c.createTexture();return c.bindTexture(c.TEXTURE_2D,m),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),m}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,m=this._backgroundTiles={},C=this.transform.coveringTiles({tileSize:512});for(const T of C)m[T.key]=c[T.key]||new p.Tile(T,512,this.transform.tileZoom,this);return m}clearBackgroundTiles(){this._backgroundTiles={}}}class Ra{constructor(c=0,m=0,C=0,T=0){if(isNaN(c)||c<0||isNaN(m)||m<0||isNaN(C)||C<0||isNaN(T)||T<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=m,this.left=C,this.right=T}interpolate(c,m,C){return null!=m.top&&null!=c.top&&(this.top=p.number(c.top,m.top,C)),null!=m.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,m.bottom,C)),null!=m.left&&null!=c.left&&(this.left=p.number(c.left,m.left,C)),null!=m.right&&null!=c.right&&(this.right=p.number(c.right,m.right,C)),this}getCenter(c,m){const C=p.clamp((this.left+c-this.right)/2,0,c),T=p.clamp((this.top+m-this.bottom)/2,0,m);return new p.pointGeometry(C,T)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Ra(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Oa(b,c){const m=p.getColumn(b,3);p.fromQuat(b,c),p.setColumn(b,3,m)}function Yl(b,c){const m=p.identity$1([]);return p.rotateZ$1(m,m,-c),p.rotateX$1(m,m,-b),m}function el(b,c){const m=[b[0],b[1],0],C=[c[0],c[1],0];if(p.length(m)>=1e-15){const F=p.normalize([],m);p.scale$2(C,F,p.dot(C,F)),c[0]=C[0],c[1]=C[1]}const T=p.cross([],c,b);if(p.len(T)<1e-15)return null;const P=Math.atan2(-T[1],T[0]);return Yl(Math.atan2(Math.sqrt(b[0]*b[0]+b[1]*b[1]),-b[2]),P)}class Dl{constructor(c,m){this.position=c,this.orientation=m}get position(){return this._position}set position(c){if(c){const m=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(m.x=p.wrap(m.x,0,1)),this._position=m}else this._position=null}lookAtPoint(c,m){if(this.orientation=null,!this.position)return;const C=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,T=this.position,P=p.MercatorCoordinate.fromLngLat(c,C),F=[P.x-T.x,P.y-T.y,P.z-T.z];m||(m=[0,0,1]),m[2]=Math.abs(m[2]),this.orientation=el(F,m)}setPitchBearing(c,m){this.orientation=Yl(p.degToRad(c),p.degToRad(-m))}}class sa{constructor(c,m){this._transform=p.identity([]),this.orientation=m,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var m;c&&p.setColumn(this._transform,3,[(m=c)[0],m[1],m[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Oa(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),m=this.right();return{bearing:Math.atan2(-m[1],m[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,m){this._orientation=Yl(c,m),Oa(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,m){const C=new Float64Array(16);return p.invert(C,this.getWorldToCamera(c,m)),C}getWorldToCameraPosition(c,m,C){const T=this.position;p.scale$2(T,T,-c);const P=new Float64Array(16);return p.fromScaling(P,[C,C,C]),p.translate(P,P,T),P[10]*=m,P}getWorldToCamera(c,m){const C=new Float64Array(16),T=new Float64Array(4),P=this.position;return p.conjugate(T,this._orientation),p.scale$2(P,P,-c),p.fromQuat(C,T),p.translate(C,C,P),C[1]*=-1,C[5]*=-1,C[9]*=-1,C[13]*=-1,C[8]*=m,C[9]*=m,C[10]*=m,C[11]*=m,C}getCameraToClipPerspective(c,m,C,T){const P=new Float64Array(16);return p.perspective(P,c,m,C,T),P}getDistanceToElevation(c,m=!1){const C=0===c?0:p.mercatorZfromAltitude(c,m?p.latFromMercatorY(this.position[1]):this.position[1]),T=this.forward();return(C-this.position[2])/T[2]}clone(){return new sa([...this.position],[...this.orientation])}}function ll(b,c){const m=qu(b.projection,b.zoom,b.width,b.height),C=function(P,F,z,j,W){const Y=new p.LngLat(z.lng-180*Ec,z.lat),fe=new p.LngLat(z.lng+180*Ec,z.lat),Ae=P.project(Y.lng,Y.lat),Ve=P.project(fe.lng,fe.lat),Ue=-Math.atan2(Ve.y-Ae.y,Ve.x-Ae.x),Ge=p.MercatorCoordinate.fromLngLat(z);Ge.y=p.clamp(Ge.y,-.999975,.999975);const qe=Ge.toLngLat(),Ie=P.project(qe.lng,qe.lat),tt=p.MercatorCoordinate.fromLngLat(qe);tt.x+=Ec;const Je=tt.toLngLat(),ot=P.project(Je.lng,Je.lat),Ct=Al(ot.x-Ie.x,ot.y-Ie.y,Ue),_t=p.MercatorCoordinate.fromLngLat(qe);_t.y+=Ec;const It=_t.toLngLat(),jt=P.project(It.lng,It.lat),Wt=Al(jt.x-Ie.x,jt.y-Ie.y,Ue),Qt=Math.abs(Ct.x)/Math.abs(Wt.y),Bn=p.identity([]);p.rotateZ(Bn,Bn,-Ue*(1-(W?0:j)));const Xt=p.identity([]);return p.scale(Xt,Xt,[1,1-(1-Qt)*j,1]),Xt[4]=-Wt.x/Wt.y*j,p.rotateZ(Xt,Xt,Ue),p.multiply(Xt,Bn,Xt),Xt}(b.projection,0,b.center,m,c),T=As(b);return p.scale(C,C,[T,T,1]),C}function As(b){const c=b.projection,m=qu(b.projection,b.zoom,b.width,b.height),C=To(c,b.center),T=To(c,p.LngLat.convert(c.center));return Math.pow(2,C*m+(1-m)*T)}function qu(b,c,m,C,T=1/0){const P=b.range;if(!P)return 0;const F=Math.min(T,Math.max(m,C)),z=Math.log(F/1024)/Math.LN2;return p.smoothstep(P[0]+z,P[1]+z,c)}const Ec=1/4e4;function To(b,c){const m=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),C=new p.LngLat(c.lng-180*Ec,m),T=new p.LngLat(c.lng+180*Ec,m),P=b.project(C.lng,m),F=b.project(T.lng,m),z=p.MercatorCoordinate.fromLngLat(C),j=p.MercatorCoordinate.fromLngLat(T),W=F.x-P.x,Y=F.y-P.y,fe=j.x-z.x,Ae=j.y-z.y,Ve=Math.sqrt((fe*fe+Ae*Ae)/(W*W+Y*Y));return Math.log(Ve)/Math.LN2}function Al(b,c,m){const C=Math.cos(m),T=Math.sin(m);return{x:b*C-c*T,y:b*T+c*C}}class tr{constructor(c,m,C,T,P,F,z){this.tileSize=512,this._renderWorldCopies=void 0===P||P,this._minZoom=c||0,this._maxZoom=m||22,this._minPitch=C??0,this._maxPitch=T??60,this.setProjection(F),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ra,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new sa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new tr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,m=!1){const C=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||C)&&this._updateCameraOnTerrain(),(c||C)&&this._constrainCamera(m),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const m=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const C=!K(m,this.getProjection());return C&&this._calcMatrices(),this.mercatorFromTransition=!1,C}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const m=c!==this.projection.name;return m&&this._calcMatrices(),m}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const m=-c*Math.PI/180;var C,T,P,F,z,j,W,Y,fe,Ae;this.angle!==m&&(this._unmodified=!1,this.angle=m,this._calcMatrices(),this.rotationMatrix=(C=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C),T=this.rotationMatrix,F=this.angle,z=(P=this.rotationMatrix)[0],j=P[1],W=P[2],Y=P[3],fe=Math.sin(F),Ae=Math.cos(F),T[0]=z*Ae+W*fe,T[1]=j*Ae+Y*fe,T[2]=z*-fe+W*Ae,T[3]=j*-fe+Y*Ae)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const m=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==m&&(this._unmodified=!1,this._pitch=m,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const m=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==m&&(this._unmodified=!1,this._setZoom(m),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,m=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],C=this.horizonLineFromTop();let T=0,P=0;for(let F=0;F<m.length;F++){const z=new p.pointGeometry(m[F][0]*this.width,C+m[F][1]*(this.height-C)),j=c.pointCoordinate(z);if(!j)continue;const W=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);T+=j[3]*W,P+=W}return 0===P?NaN:T/P}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,m=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),C=this.pixelsPerMeter/this.worldSize*m,T=this._mercatorZfromZoom(c),P=this._mercatorZfromZoom(this._maxZoom),F=Math.max(T-C,P);this._setZoom(this._zoomFromMercatorZ(F))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const m=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let C;C=c.z<this._camera.position[2]?[m.x,m.y,m.z]:[c.x,c.y,c.z];const T=p.length(p.sub([],this._camera.position,C));return p.clamp(this._zoomFromMercatorZ(T),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let m=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(m=this._setCameraOrientation(c.orientation)),c.position){const C=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(C,this._camera.position)||(this._setCameraPosition(C),m=!0)}m&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,m=new Dl;return m.position=new p.MercatorCoordinate(c[0],c[1],c[2]),m.orientation=this._camera.orientation,m._elevation=this.elevation,m._renderWorldCopies=this.renderWorldCopies,m}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const m=p.transformQuat([],[0,0,-1],c),C=p.transformQuat([],[0,-1,0],c);if(C[2]<0)return!1;const T=el(m,C);return!!T&&(this._camera.orientation=T,!0)}_setCameraPosition(c){const m=this.zoomScale(this.minZoom)*this.tileSize,C=this.zoomScale(this.maxZoom)*this.tileSize,T=this.cameraToCenterDistance;c[2]=p.clamp(c[2],T/C,T/m),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,m,C){this._unmodified=!1,this._edgeInsets.interpolate(c,m,C),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const m=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,m)}getVisibleUnwrappedCoordinates(c){const m=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const C=this.pointCoordinate(new p.pointGeometry(0,0)),T=this.pointCoordinate(new p.pointGeometry(this.width,0)),P=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),F=this.pointCoordinate(new p.pointGeometry(0,this.height)),z=Math.floor(Math.min(C.x,T.x,P.x,F.x)),j=Math.floor(Math.max(C.x,T.x,P.x,F.x)),W=1;for(let Y=z-W;Y<=j+W;Y++)0!==Y&&m.push(new p.UnwrappedTileID(Y,c))}return m}coveringTiles(c){let m=this.coveringZoomLevel(c);const C=m,T=this.elevation&&!c.isTerrainDEM,P="mercator"===this.projection.name;if(void 0!==c.minzoom&&m<c.minzoom)return[];void 0!==c.maxzoom&&m>c.maxzoom&&(m=c.maxzoom);const F=this.locationCoordinate(this.center),z=this.center.lat,j=1<<m,W=[j*F.x,j*F.y,0],Y="globe"===this.projection.name,fe=!Y,Ae=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m,fe),Ve=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ue=j*p.mercatorZfromAltitude(1,this.center.lat),Ge=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),qe=[j*Ve.x,j*Ve.y,Ge*(fe?1:Ue)],Ie=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),tt=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?m:0,Je=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ot=c.isTerrainDEM?-Je:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ct=this.projection.isReprojectedInTileSpace?As(this):1,_t=Ht=>{const en=new p.MercatorCoordinate(Ht.x+25e-6,Ht.y,Ht.z),xn=new p.MercatorCoordinate(Ht.x,Ht.y+25e-6,Ht.z),Pn=Ht.toLngLat(),br=en.toLngLat(),wi=xn.toLngLat(),gr=this.locationCoordinate(Pn),or=this.locationCoordinate(br),Ir=this.locationCoordinate(wi),qi=Math.hypot(or.x-gr.x,or.y-gr.y),Br=Math.hypot(Ir.x-gr.x,Ir.y-gr.y);return Math.sqrt(qi*Br)*Ct/25e-6},It=Ht=>{const Vt=Je,en=ot;return{aabb:p.tileAABB(this,j,0,0,0,Ht,en,Vt,this.projection),zoom:0,x:0,y:0,minZ:en,maxZ:Vt,wrap:Ht,fullyVisible:!1}},jt=[];let Wt=[];const Qt=m,Bn=c.reparseOverscaled?C:m,Xt=Ht=>Ht*Ht,yn=Xt((Ge-this._centerAltitude)*Ue),sn=Ht=>{if(!this._elevation||!Ht.tileID||!P)return;const Vt=this._elevation.getMinMaxForTile(Ht.tileID),en=Ht.aabb;Vt?(en.min[2]=Vt.min,en.max[2]=Vt.max,en.center[2]=(en.min[2]+en.max[2])/2):(Ht.shouldSplit=An(Ht),Ht.shouldSplit||(en.min[2]=en.max[2]=en.center[2]=this._centerAltitude))},An=Ht=>{if(Ht.zoom<tt)return!0;if(Ht.zoom===Qt)return!1;if(null!=Ht.shouldSplit)return Ht.shouldSplit;const Vt=Ht.aabb.distanceX(qe),en=Ht.aabb.distanceY(qe);let xn=yn,Pn=1;if(Y){xn=Xt(Ht.aabb.distanceZ(qe));const gr=Math.pow(2,Ht.zoom),or=p.latFromMercatorY((Ht.y+1)/gr),Ir=p.latFromMercatorY(Ht.y/gr),qi=Math.min(Math.max(z,or),Ir),Br=p.circumferenceAtLatitude(qi)/p.circumferenceAtLatitude(z);if(Pn=qi===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Br/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Ht.zoom===Qt-1&&Br>=.9)return!0}else if(T&&(xn=Xt(Ht.aabb.distanceZ(qe)*Ue)),this.projection.isReprojectedInTileSpace&&C<=5){const gr=Math.pow(2,Ht.zoom),or=_t(new p.MercatorCoordinate((Ht.x+.5)/gr,(Ht.y+.5)/gr));Pn=or>.85?1:or}const br=Vt*Vt+en*en+xn;return br<Xt((1<<Qt-Ht.zoom)*Ie*Pn*((gr,or)=>{if(or*Xt(.707)<gr)return 1;const Ir=Math.sqrt(or/gr);return Ir/(1.4144271570014144+(Math.pow(1.1,Ir-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(xn,yn),br))};if(this.renderWorldCopies)for(let Ht=1;Ht<=3;Ht++)jt.push(It(-Ht)),jt.push(It(Ht));for(jt.push(It(0));jt.length>0;){const Ht=jt.pop(),Vt=Ht.x,en=Ht.y;let xn=Ht.fullyVisible;if(!xn){const Pn=Ht.aabb.intersects(Ae);if(0===Pn)continue;xn=2===Pn}if(Ht.zoom!==Qt&&An(Ht))for(let Pn=0;Pn<4;Pn++){const br=(Vt<<1)+Pn%2,wi=(en<<1)+(Pn>>1),gr={aabb:P?Ht.aabb.quadrant(Pn):p.tileAABB(this,j,Ht.zoom+1,br,wi,Ht.wrap,Ht.minZ,Ht.maxZ,this.projection),zoom:Ht.zoom+1,x:br,y:wi,wrap:Ht.wrap,fullyVisible:xn,tileID:void 0,shouldSplit:void 0,minZ:Ht.minZ,maxZ:Ht.maxZ};T&&!Y&&(gr.tileID=new p.OverscaledTileID(Ht.zoom+1===Qt?Bn:Ht.zoom+1,Ht.wrap,Ht.zoom+1,br,wi),sn(gr)),jt.push(gr)}else{const Pn=Ht.zoom===Qt?Bn:Ht.zoom;if(c.minzoom&&c.minzoom>Pn)continue;const br=W[0]-(.5+Vt+(Ht.wrap<<Ht.zoom))*(1<<m-Ht.zoom),wi=W[1]-.5-en,gr=Ht.tileID?Ht.tileID:new p.OverscaledTileID(Pn,Ht.wrap,Ht.zoom,Vt,en);Wt.push({tileID:gr,distanceSq:br*br+wi*wi})}}if(this.fogCullDistSq){const Ht=this.fogCullDistSq,Vt=this.horizonLineFromTop();Wt=Wt.filter(en=>{const xn=[0,0,0,1],Pn=[p.EXTENT,p.EXTENT,0,1],br=this.calculateFogTileMatrix(en.tileID.toUnwrapped());p.transformMat4$1(xn,xn,br),p.transformMat4$1(Pn,Pn,br);const wi=p.getAABBPointSquareDist(xn,Pn);if(0===wi)return!0;let gr=!1;const or=this._elevation;if(or&&wi>Ht&&0!==Vt){const Ir=this.calculateProjMatrix(en.tileID.toUnwrapped());let qi;c.isTerrainDEM||(qi=or.getMinMaxForTile(en.tileID)),qi||(qi={min:ot,max:Je});const Br=p.furthestTileCorner(this.rotation),ns=[Br[0]*p.EXTENT,Br[1]*p.EXTENT,qi.max];p.transformMat4(ns,ns,Ir),gr=(1-ns[1])*this.height*.5<Vt}return wi<Ht||gr})}return Wt.sort((Ht,Vt)=>Ht.distanceSq-Vt.distanceSq).map(Ht=>Ht.tileID)}resize(c,m){this.width=c,this.height=m,this.pixelsToGLUnits=[2/c,-2/m],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const m=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),C=this.projection.project(c.lng,m);return new p.pointGeometry(C.x*this.worldSize,C.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,m){let C,T;const P=this.centerPoint;if("globe"===this.projection.name){const z=this.worldSize;C=(m.x-P.x)/z,T=(m.y-P.y)/z}else{const z=this.pointCoordinate(m),j=this.pointCoordinate(P);C=z.x-j.x,T=z.y-j.y}const F=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(F.x-C,F.y-T))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,m){const C=m?p.mercatorZfromAltitude(m,c.lat):void 0,T=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(T.x,T.y,C)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,m){const C=m??this._centerAltitude,T=[c.x,c.y,0,1],P=[c.x,c.y,1,1];p.transformMat4$1(T,T,this.pixelMatrixInverse),p.transformMat4$1(P,P,this.pixelMatrixInverse);const F=P[3];p.scale$1(T,T,1/T[3]),p.scale$1(P,P,1/F);const z=T[2],j=P[2];return{p0:T,p1:P,t:z===j?0:(C-z)/(j-z)}}screenPointToMercatorRay(c){const m=[c.x,c.y,0,1],C=[c.x,c.y,1,1];return p.transformMat4$1(m,m,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse),p.scale$1(m,m,1/m[3]),p.scale$1(C,C,1/C[3]),m[2]=p.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,C[2]=p.mercatorZfromAltitude(C[2],this._center.lat)*this.worldSize,p.scale$1(m,m,1/this.worldSize),p.scale$1(C,C,1/this.worldSize),new p.Ray([m[0],m[1],m[2]],p.normalize([],p.sub([],C,m)))}rayIntersectionCoordinate(c){const{p0:m,p1:C,t:T}=c,P=p.mercatorZfromAltitude(m[2],this._center.lat),F=p.mercatorZfromAltitude(C[2],this._center.lat);return new p.MercatorCoordinate(p.number(m[0],C[0],T)/this.worldSize,p.number(m[1],C[1],T)/this.worldSize,p.number(P,F,T))}pointCoordinate(c,m=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,m)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let m=this.projection.pointCoordinate3D(this,c.x,c.y);if(m)return new p.MercatorCoordinate(m[0],m[1],m[2]);let C=0,T=this.horizonLineFromTop();if(c.y>T)return this.pointCoordinate(c);const P=.02*T,F=c.clone();for(let z=0;z<10&&T-C>P;z++){F.y=p.number(C,T,.66);const j=this.projection.pointCoordinate3D(this,F.x,F.y);j?(T=F.y,m=j):C=F.y}return m?new p.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}_coordinatePoint(c,m){const C=m&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,T=[c.x*this.worldSize,c.y*this.worldSize,C+c.toAltitude(),1];return p.transformMat4$1(T,T,this.pixelMatrix),T[3]>0?new p.pointGeometry(T[0]/T[3],T[1]/T[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:m}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,P=this.pointLocation3D(new p.pointGeometry(m,c)),F=this.pointLocation3D(new p.pointGeometry(T,c)),z=this.pointLocation3D(new p.pointGeometry(T,C)),j=this.pointLocation3D(new p.pointGeometry(m,C));let W=Math.min(P.lng,F.lng,z.lng,j.lng),Y=Math.max(P.lng,F.lng,z.lng,j.lng),fe=Math.min(P.lat,F.lat,z.lat,j.lat),Ae=Math.max(P.lat,F.lat,z.lat,j.lat);const Ve=Math.pow(2,-this.zoom)/16*270,Ue="globe"===this.projection.name?1:4,Ge=(qe,Ie,tt,Je,ot)=>{const Ct=(qe+tt)/2,_t=(Ie+Je)/2,It=new p.pointGeometry(Ct,_t),{lng:jt,lat:Wt}=this.pointLocation3D(It),Qt=Math.max(0,W-jt,fe-Wt,jt-Y,Wt-Ae);W=Math.min(W,jt),Y=Math.max(Y,jt),fe=Math.min(fe,Wt),Ae=Math.max(Ae,Wt),(ot<Ue||Qt>Ve)&&(Ge(qe,Ie,Ct,_t,ot+1),Ge(Ct,_t,tt,Je,ot+1))};if(Ge(m,c,T,c,1),Ge(T,c,T,C,1),Ge(T,C,m,C,1),Ge(m,C,m,c,1),"globe"===this.projection.name){const[qe,Ie]=p.polesInViewport(this);qe?(Ae=90,Y=180,W=-180):Ie&&(fe=-90,Y=180,W=-180)}return new p.LngLatBounds(new p.LngLat(W,fe),new p.LngLat(Y,Ae))}_getBoundsRectangular(c,m){const{top:C,left:T}=this._edgeInsets,P=this.height-this._edgeInsets.bottom,F=this.width-this._edgeInsets.right,z=new p.pointGeometry(T,C),j=new p.pointGeometry(F,C),W=new p.pointGeometry(F,P),Y=new p.pointGeometry(T,P);let fe=this.pointCoordinate(z,c),Ae=this.pointCoordinate(j,c);const Ve=this.pointCoordinate(W,m),Ue=this.pointCoordinate(Y,m),Ge=(qe,Ie)=>(Ie.y-qe.y)/(Ie.x-qe.x);return fe.y>1&&Ae.y>=0?fe=new p.MercatorCoordinate((1-Ue.y)/Ge(Ue,fe)+Ue.x,1):fe.y<0&&Ae.y<=1&&(fe=new p.MercatorCoordinate(-Ue.y/Ge(Ue,fe)+Ue.x,0)),Ae.y>1&&fe.y>=0?Ae=new p.MercatorCoordinate((1-Ve.y)/Ge(Ve,Ae)+Ve.x,1):Ae.y<0&&fe.y<=1&&(Ae=new p.MercatorCoordinate(-Ve.y/Ge(Ve,Ae)+Ve.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(Ae)).extend(this.coordinateLocation(Ue)).extend(this.coordinateLocation(Ve))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const m=c.visibleDemTiles.reduce((C,T)=>{if(T.dem){const P=T.dem.tree;C.min=Math.min(C.min,P.minimums[0]),C.max=Math.max(C.max,P.maximums[0])}return C},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(m.min*c.exaggeration(),m.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const m=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,C=this.height/2-m*(1-this._horizonShift);return c?Math.max(0,C):C}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,m){return this.projection.createTileMatrix(this,m,c)}calculateDistanceTileData(c){const m=c.key,C=this._distanceTileDataCache;if(C[m])return C[m];const T=c.canonical,P=1/this.height,F=this.cameraWorldSize,z=F/this.zoomScale(T.z),j=(T.x+Math.pow(2,T.z)*c.wrap)*z,W=T.y*z,Y=this.point;Y.x*=F/this.worldSize,Y.y*=F/this.worldSize;const fe=this.angle,Ae=Math.sin(-fe),Ve=-Math.cos(-fe);return C[m]={bearing:[Ae,Ve],center:[(Y.x-j)*P,(Y.y-W)*P],scale:z/p.EXTENT*P},C[m]}calculateFogTileMatrix(c){const m=c.key,C=this._fogTileMatrixCache;if(C[m])return C[m];const T=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(T,this.worldToFogMatrix,T),C[m]=new Float32Array(T),C[m]}calculateProjMatrix(c,m=!1){const C=c.key,T=m?this._alignedProjMatrixCache:this._projMatrixCache;if(T[C])return T[C];const P=this.calculatePosMatrix(c,this.worldSize);return p.multiply(P,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.alignedProjMatrix:this.projMatrix,P),T[C]=new Float32Array(P),T[C]}calculatePixelsToTileUnitsMatrix(c){const m=c.tileID.key,C=this._pixelsToTileUnitsCache;if(C[m])return C[m];const T=function(P,F){const{scale:z}=P.tileTransform,j=z*p.EXTENT/(P.tileSize*Math.pow(2,F.zoom-P.tileID.overscaledZ+P.tileID.canonical.z));return W=new Float32Array(4),Ae=(Y=F.inverseAdjustmentMatrix)[1],Ve=Y[2],Ue=Y[3],qe=(fe=[j,j])[1],W[0]=Y[0]*(Ge=fe[0]),W[1]=Ae*Ge,W[2]=Ve*qe,W[3]=Ue*qe,W;var W,Y,fe,Ae,Ve,Ue,Ge,qe}(c,this);return C[m]=T,C[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,m=p.fromScaling([],[c,c,c]);return p.multiply(m,m,this.globeMatrix),m}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const m=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,C=this._computeCameraPosition(m),T=this._camera.forward(),P=p.mercatorZfromAltitude(1,this._center.lat);C[2]/=P,T[2]/=P,p.normalize(T,T);const F=c.raycast(C,T,c.exaggeration());if(F){const z=p.scaleAndAdd([],C,T,F),j=new p.MercatorCoordinate(z[0],z[1],p.mercatorZfromAltitude(z[2],p.latFromMercatorY(z[1]))),W=(j.z+p.length([j.x-C[0],j.y-C[1],j.z-C[2]*P]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(W),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const m=this._elevation,C=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,T=this._computeCameraPosition(C),P=m.getAtPointOrZero(new p.MercatorCoordinate(...T)),F=this.pixelsPerMeter/this.worldSize*P,z=this._minimumHeightOverTerrain(),j=T[2]-F;if(j<=z)if(j<0||c){const W=this.locationCoordinate(this._center,this._centerAltitude),Y=[T[0],T[1],W.z-T[2]],fe=p.length(Y);Y[2]-=(z-j)/this._pixelsPerMercatorPixel;const Ae=p.length(Y);if(0===Ae)return;p.scale$2(Y,Y,fe/Ae*this._pixelsPerMercatorPixel),this._camera.position=[T[0],T[1],W.z*this._pixelsPerMercatorPixel-Y[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const Ae=this.center;return Ae.lat=p.clamp(Ae.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(Ae.lng=p.clamp(Ae.lng,this.minLng,this.maxLng)),this.center=Ae,void(this._constraining=!1)}const m=this._unmodified,{x:C,y:T}=this.point;let P=0,F=C,z=T;const j=this.width/2,W=this.height/2,Y=this.worldMinY*this.scale,fe=this.worldMaxY*this.scale;if(T-W<Y&&(z=Y+W),T+W>fe&&(z=fe-W),fe-Y<this.height&&(P=Math.max(P,this.height/(fe-Y)),z=(fe+Y)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ae=this.worldMinX*this.scale,Ve=this.worldMaxX*this.scale,Ue=this.worldSize/2-(Ae+Ve)/2;F=(C+Ue+this.worldSize)%this.worldSize-Ue,F-j<Ae&&(F=Ae+j),F+j>Ve&&(F=Ve-j),Ve-Ae<this.width&&(P=Math.max(P,this.width/(Ve-Ae)),F=(Ve+Ae)/2)}F===C&&z===T||(this.center=this.unproject(new p.pointGeometry(F,z))),P&&(this.zoom+=this.scaleZoom(P)),this._constrainCamera(),this._unmodified=m,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,m=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const C=qu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,C),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T="meters"===this.projection.zAxisUnit?m:1,P=this._camera.getWorldToCamera(this.worldSize,T),F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);F[8]=2*-c.x/this.width,F[9]=2*c.y/this.height;let z=p.mul([],F,P);if(this.projection.isReprojectedInTileSpace){const _t=this.locationCoordinate(this.center),It=p.identity([]);p.translate(It,It,[_t.x*this.worldSize,_t.y*this.worldSize,0]),p.multiply(It,It,ll(this)),p.translate(It,It,[-_t.x*this.worldSize,-_t.y*this.worldSize,0]),p.multiply(z,z,It),this.inverseAdjustmentMatrix=function(jt){const Wt=ll(jt,!0);return le([],[Wt[0],Wt[1],Wt[4],Wt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],z,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=z,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const j=p.invert([],F);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height);const W=new Float32Array(16);p.identity(W),p.scale(W,W,[1,-1,1]),p.rotateX(W,W,this._pitch),p.rotateZ(W,W,this.angle);const Y=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),fe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-c.x/this.width,Y[9]=2*(c.y+fe)/this.height,this.skyboxMatrix=p.multiply(W,Y,W);const Ae=this.point,Ve=Ae.x,Ue=Ae.y,Ge=this.width%2/2,qe=this.height%2/2,Ie=Math.cos(this.angle),tt=Math.sin(this.angle),Je=Ve-Math.round(Ve)+Ie*Ge+tt*qe,ot=Ue-Math.round(Ue)+Ie*qe+tt*Ge,Ct=new Float64Array(z);if(p.translate(Ct,Ct,[Je>.5?Je-1:Je,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=Ct,z=p.create(),p.scale(z,z,[this.width/2,-this.height/2,1]),p.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=p.create(),p.scale(z,z,[1,-1,1]),p.translate(z,z,[-1,-1,0]),p.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},z=p.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const _t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(_t,_t,P),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,m=this.cameraPixelsPerMeter,C=this._camera.position,T=1/this.height/this._pixelsPerMercatorPixel,P=[c,c,m];p.scale$2(P,P,T),p.scale$2(C,C,-1),p.multiply$2(C,C,P);const F=p.create();p.translate(F,F,C),p.scale(F,F,P),this.mercatorFogMatrix=F,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,m,T)}_computeCameraPosition(c){const m=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,C=this._camera.forward(),T=this.point,P=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*m-c/this.worldSize*this._centerAltitude;return[T.x/this.worldSize-C[0]*P,T.y/this.worldSize-C[1]*P,c/this.worldSize*this._centerAltitude-C[2]*P]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const m=this._maxCameraBoundsDistance()*Math.cos(this._pitch),C=this._camera.position[2],T=c[2];let P=1;this.projection.wrap&&(this.center=this.center.wrap()),T>0&&(P=Math.min((m-C)/T,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,P),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,m=this._camera.forward(),{pitch:C,bearing:T}=this._camera.getPitchBearing(),P=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,F=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),z=Math.max((c[2]-P)/Math.cos(C),F),j=this._zoomFromMercatorZ(z);p.scaleAndAdd(c,c,m,z),this._pitch=p.clamp(C,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(T,-Math.PI,Math.PI),this._setZoom(p.clamp(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let m=0,C=p.GLOBE_ZOOM_THRESHOLD_MAX,T=0,P=1/0;for(;C-m>1e-6&&C>m;){const F=m+.5*(C-m),z=this.tileSize*Math.pow(2,F),j=this.getCameraToCenterDistance(this.projection,F,z),W=this.scaleZoom(j/(c*this.tileSize)),Y=Math.abs(F-W);Y<P&&(P=Y,T=F),F<W?m=F:C=F}return T}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,m){const C=Math.min(c.x,m.x),T=Math.max(c.x,m.x),P=Math.min(c.y,m.y),F=Math.max(c.y,m.y);if(P<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const z=[new p.pointGeometry(C,P),new p.pointGeometry(T,F),new p.pointGeometry(C,F),new p.pointGeometry(T,P)],j=this.renderWorldCopies?-3:0,W=this.renderWorldCopies?4:1;for(const Y of z){const fe=this.pointRayIntersection(Y);if(fe.t<0)return!0;const Ae=this.rayIntersectionCoordinate(fe);if(Ae.x<j||Ae.y<0||Ae.x>W||Ae.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(c,m){const C=p.length(p.sub([],this._camera.position,c)),T=this._zoomFromMercatorZ(C)+m;return C-this._mercatorZfromZoom(T)}getCameraPoint(){if("globe"===this.projection.name){const c=function([m,C,T],P){const F=[m,C,T,1];p.transformMat4$1(F,F,P);const z=F[3]=Math.max(F[3],1e-6);return F[0]/=z,F[1]/=z,F[2]/=z,F}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.pointGeometry(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,c))}}getCameraToCenterDistance(c,m=this.zoom,C=this.worldSize){const T=qu(c,m,this.width,this.height,1024),P=c.pixelSpaceConversion(this.center.lat,C,T);return.5/Math.tan(.5*this._fov)*this.height*P}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function La(b,c){let m=!1,C=null;const T=()=>{C=null,m&&(b(),C=setTimeout(T,c),m=!1)};return()=>(m=!0,C||T(),C)}class Hu{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=La(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const m=ga(c);if(this._hashName){const C=this._hashName;let T=!1;const P=p.window.location.hash.slice(1).split("&").map(F=>{const z=F.split("=")[0];return z===C?(T=!0,`${z}=${m}`):F}).filter(F=>F);return T||P.push(`${C}=${m}`),`#${P.join("&")}`}return`#${m}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let m;return c.split("&").map(C=>C.split("=")).forEach(C=>{C[0]===this._hashName&&(m=C)}),(m&&m[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const m=this._getCurrentHash();if(m.length>=3&&!m.some(C=>isNaN(C))){const C=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(m[3]||0):c.getBearing();return c.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:C,pitch:+(m[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function ga(b,c){const m=b.getCenter(),C=Math.round(100*b.getZoom())/100,T=Math.ceil((C*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,T),F=Math.round(m.lng*P)/P,z=Math.round(m.lat*P)/P,j=b.getBearing(),W=b.getPitch();let Y=c?`/${F}/${z}/${C}`:`${C}/${z}/${F}`;return(j||W)&&(Y+="/"+Math.round(10*j)/10),W&&(Y+=`/${Math.round(W)}`),Y}const $i={linearity:.3,easing:p.bezier(0,0,.3,1)},Wu=p.extend({deceleration:2500,maxSpeed:1400},$i),ml=p.extend({deceleration:20,maxSpeed:1400},$i),tc=p.extend({deceleration:1e3,maxSpeed:360},$i),tl=p.extend({deceleration:1e3,maxSpeed:90},$i);class aa{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,m=p.exported.now();for(;c.length>0&&m-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const m={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)m.zoom+=P.zoomDelta||0,m.bearing+=P.bearingDelta||0,m.pitch+=P.pitchDelta||0,P.panDelta&&m.pan._add(P.panDelta),P.around&&(m.around=P.around),P.pinchAround&&(m.pinchAround=P.pinchAround);const C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(m.pan.mag()){const P=Na(m.pan.mag(),C,p.extend({},Wu,c||{}));T.offset=m.pan.mult(P.amount/m.pan.mag()),T.center=this._map.transform.center,Fc(T,P)}if(m.zoom){const P=Na(m.zoom,C,ml);T.zoom=this._map.transform.zoom+P.amount,Fc(T,P)}if(m.bearing){const P=Na(m.bearing,C,tc);T.bearing=this._map.transform.bearing+p.clamp(P.amount,-179,179),Fc(T,P)}if(m.pitch){const P=Na(m.pitch,C,tl);T.pitch=this._map.transform.pitch+P.amount,Fc(T,P)}if(T.zoom||T.bearing){const P=void 0===m.pinchAround?m.around:m.pinchAround;T.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),T.noMoveStart=!0,T}}function Fc(b,c){(!b.duration||b.duration<c.duration)&&(b.duration=c.duration,b.easing=c.easing)}function Na(b,c,m){const{maxSpeed:C,linearity:T,deceleration:P}=m,F=p.clamp(b*T/(c/1e3),-C,C),z=Math.abs(F)/(P*T);return{easing:m.easing,duration:1e3*z,amount:F*(z/2)}}class hs extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,m,C,T={}){const P=Q(m.getCanvasContainer(),C),F=m.unproject(P);super(c,p.extend({point:P,lngLat:F,originalEvent:C},T)),this._defaultPrevented=!1,this.target=m}}class Cc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,m,C){const T="touchend"===c?C.changedTouches:C.touches,P=te(m.getCanvasContainer(),T),F=P.map(j=>m.unproject(j)),z=P.reduce((j,W,Y,fe)=>j.add(W.div(fe.length)),new p.pointGeometry(0,0));super(c,{points:P,point:z,lngLats:F,lngLat:m.unproject(z),originalEvent:C}),this._defaultPrevented=!1}}class lf extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,m,C){super(c,{originalEvent:C}),this._defaultPrevented=!1}}class xd{constructor(c,m){this._map=c,this._clickTolerance=m.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new lf(c.type,this._map,c))}mousedown(c,m){return this._mousedownPos=m,this._firePreventable(new hs(c.type,this._map,c))}mouseup(c){this._map.fire(new hs(c.type,this._map,c))}preclick(c){const m=p.extend({},c);m.type="preclick",this._map.fire(new hs(m.type,this._map,m))}click(c,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||(this.preclick(c),this._map.fire(new hs(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new hs(c.type,this._map,c))}mouseover(c){this._map.fire(new hs(c.type,this._map,c))}mouseout(c){this._map.fire(new hs(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Cc(c.type,this._map,c))}touchmove(c){this._map.fire(new Cc(c.type,this._map,c))}touchend(c){this._map.fire(new Cc(c.type,this._map,c))}touchcancel(c){this._map.fire(new Cc(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ea{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new hs(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new hs(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nc{constructor(c,m){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,m){this.isEnabled()&&c.shiftKey&&0===c.button&&(Rt(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(c,m){if(!this._active)return;const C=m,T=this._startPos,P=this._lastPos;if(!T||!P||P.equals(C)||!this._box&&C.dist(T)<this._clickTolerance)return;this._lastPos=C,this._box||(this._box=Fe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const F=Math.min(T.x,C.x),z=Math.max(T.x,C.x),j=Math.min(T.y,C.y),W=Math.max(T.y,C.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${F}px,${j}px)`,this._box.style.width=z-F+"px",this._box.style.height=W-j+"px")})}mouseupWindow(c,m){if(!this._active)return;const C=this._startPos,T=m;if(C&&0===c.button){if(this.reset(),re(),C.x!==T.x||C.y!==T.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:P=>P.fitScreenCoordinates(C,T,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ae(),delete this._startPos,delete this._lastPos}_fireEvent(c,m){return this._map.fire(new p.Event(c,{originalEvent:m}))}}function Ou(b,c){const m={};for(let C=0;C<b.length;C++)m[b[C].identifier]=c[C];return m}class mi{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,m,C){(this.centroid||C.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),C.length===this.numTouches&&(this.centroid=function(T){const P=new p.pointGeometry(0,0);for(const F of T)P._add(F);return P.div(T.length)}(m),this.touches=Ou(C,m)))}touchmove(c,m,C){if(this.aborted||!this.centroid)return;const T=Ou(C,m);for(const P in this.touches){const F=this.touches[P],z=T[P];(!z||z.dist(F)>30)&&(this.aborted=!0)}}touchend(c,m,C){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===C.length){const T=!this.aborted&&this.centroid;if(this.reset(),T)return T}}}class vu{constructor(c){this.singleTap=new mi(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,m,C){this.singleTap.touchstart(c,m,C)}touchmove(c,m,C){this.singleTap.touchmove(c,m,C)}touchend(c,m,C){const T=this.singleTap.touchend(c,m,C);if(T){const P=c.timeStamp-this.lastTime<500,F=!this.lastTap||this.lastTap.dist(T)<30;if(P&&F||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=T,this.count===this.numTaps)return this.reset(),T}}}class rc{constructor(){this._zoomIn=new vu({numTouches:1,numTaps:2}),this._zoomOut=new vu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,m,C){this._zoomIn.touchstart(c,m,C),this._zoomOut.touchstart(c,m,C)}touchmove(c,m,C){this._zoomIn.touchmove(c,m,C),this._zoomOut.touchmove(c,m,C)}touchend(c,m,C){const T=this._zoomIn.touchend(c,m,C),P=this._zoomOut.touchend(c,m,C);return T?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:F.getZoom()+1,around:F.unproject(T)},{originalEvent:c})}):P?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:F.getZoom()-1,around:F.unproject(P)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rh={0:1,2:2};class ic{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,m){return!1}_move(c,m){return{}}mousedown(c,m){if(this._lastPoint)return;const C=ue(c);this._correctButton(c,C)&&(this._lastPoint=m,this._eventButton=C)}mousemoveWindow(c,m){const C=this._lastPoint;if(C)if(c.preventDefault(),null!=this._eventButton&&function(T,P){const F=rh[P];return void 0===T.buttons||(T.buttons&F)!==F}(c,this._eventButton))this.reset();else if(this._moved||!(m.dist(C)<this._clickTolerance))return this._moved=!0,this._lastPoint=m,this._move(C,m)}mouseupWindow(c){this._lastPoint&&ue(c)===this._eventButton&&(this._moved&&re(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oc extends ic{mousedown(c,m){super.mousedown(c,m),this._lastPoint&&(this._active=!0)}_correctButton(c,m){return 0===m&&!c.ctrlKey}_move(c,m){return{around:m,panDelta:m.sub(c)}}}class ti extends ic{_correctButton(c,m){return 0===m&&c.ctrlKey||2===m}_move(c,m){const C=.8*(m.x-c.x);if(C)return this._active=!0,{bearingDelta:C}}contextmenu(c){c.preventDefault()}}class Lu extends ic{_correctButton(c,m){return 0===m&&c.ctrlKey||2===m}_move(c,m){const C=-.5*(m.y-c.y);if(C)return this._active=!0,{pitchDelta:C}}contextmenu(c){c.preventDefault()}}class Nu{constructor(c,m){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=m.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(c,m,C){return this._calculateTransform(c,m,C)}touchmove(c,m,C){if(this._active&&!(C.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===C.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,m,C)}}touchend(c,m,C){this._calculateTransform(c,m,C),this._active&&C.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,m,C){C.length>0&&(this._active=!0);const T=Ou(C,m),P=new p.pointGeometry(0,0),F=new p.pointGeometry(0,0);let z=0;for(const W in T){const Y=T[W],fe=this._touches[W];fe&&(P._add(Y),F._add(Y.sub(fe)),z++,T[W]=Y)}if(this._touches=T,z<this._minTouches||!F.mag())return;const j=F.div(z);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(z),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Dn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,m,C){return{}}touchstart(c,m,C){this._firstTwoTouches||C.length<2||(this._firstTwoTouches=[C[0].identifier,C[1].identifier],this._start([m[0],m[1]]))}touchmove(c,m,C){const T=this._firstTwoTouches;if(!T)return;c.preventDefault();const[P,F]=T,z=si(C,m,P),j=si(C,m,F);if(!z||!j)return;const W=this._aroundCenter?null:z.add(j).div(2);return this._move([z,j],W,c)}touchend(c,m,C){if(!this._firstTwoTouches)return;const[T,P]=this._firstTwoTouches,F=si(C,m,T),z=si(C,m,P);F&&z||(this._active&&re(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function si(b,c,m){for(let C=0;C<b.length;C++)if(b[C].identifier===m)return c[C]}function kf(b,c){return Math.log(b/c)/Math.LN2}class yl extends Dn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,m){const C=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(kf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kf(this._distance,C),pinchAround:m}}}function Oi(b,c){return 180*b.angleWith(c)/Math.PI}class uf extends Dn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,m){const C=this._vector;if(this._vector=c[0].sub(c[1]),C&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Oi(this._vector,C),pinchAround:m}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const m=25/(Math.PI*this._minDiameter)*360,C=this._startVector;if(!C)return!1;const T=Oi(c,C);return Math.abs(T)<m}}function xu(b){return Math.abs(b.y)>Math.abs(b.x)}class l extends Dn{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,xu(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,m,C){const T=this._lastPoints;if(!T)return;const P=c[0].sub(T[0]),F=c[1].sub(T[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&C.touches.length<3||(this._valid=this.gestureBeginsVertically(P,F,C.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(P.y+F.y)/2*-.5})}gestureBeginsVertically(c,m,C){if(void 0!==this._valid)return this._valid;const T=c.mag()>=2,P=m.mag()>=2;if(!T&&!P)return;if(!T||!P)return null==this._firstMove&&(this._firstMove=C),C-this._firstMove<100&&void 0;const F=c.y>0==m.y>0;return xu(c)&&xu(m)&&F}}const h={panStep:100,bearingStep:15,pitchStep:10};class _{constructor(){const c=h;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let m=0,C=0,T=0,P=0,F=0;switch(c.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:c.shiftKey?C=-1:(c.preventDefault(),P=-1);break;case 39:c.shiftKey?C=1:(c.preventDefault(),P=1);break;case 38:c.shiftKey?T=1:(c.preventDefault(),F=-1);break;case 40:c.shiftKey?T=-1:(c.preventDefault(),F=1);break;default:return}return this._rotationDisabled&&(C=0,T=0),{cameraAnimation:z=>{const j=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:w,zoom:m?Math.round(j)+m*(c.shiftKey?2:1):j,bearing:z.getBearing()+C*this._bearingStep,pitch:z.getPitch()+T*this._pitchStep,offset:[-P*this._panStep,-F*this._panStep],center:z.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function w(b){return b*(2-b)}const I=4.000244140625;class U{constructor(c,m){this._map=c,this._el=c.getCanvasContainer(),this._handler=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let m=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const C=p.exported.now(),T=C-(this._lastWheelEventTime||0);this._lastWheelEventTime=C,0!==m&&m%I==0?this._type="wheel":0!==m&&Math.abs(m)<4?this._type="trackpad":T>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(T*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),c.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=c,this._delta-=m,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const m=Q(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:m,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const m=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const j="wheel"===this._type&&Math.abs(this._delta)>I?this._wheelZoomRate:this._defaultZoomRate;let W=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&0!==W&&(W=1/W);const Y=m(),fe=Math.pow(2,Y),Ae="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):fe;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(Ae*W))),"wheel"===this._type&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._delta=0}const C="number"==typeof this._targetZoom?this._targetZoom:m(),T=this._startZoom,P=this._easing;let F,z=!1;if("wheel"===this._type&&T&&P){const j=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),W=P(j);F=p.number(T,C,W),j<1?this._frameId||(this._frameId=!0):z=!0}else F=C,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:F-m(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let m=p.ease;if(this._prevEase){const C=this._prevEase,T=(p.exported.now()-C.start)/C.duration,P=C.easing(T+.01)-C.easing(T),F=.27/Math.sqrt(P*P+1e-4)*.01,z=Math.sqrt(.0729-F*F);m=p.bezier(F,z,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:m},m}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class q{constructor(c,m){this._clickZoom=c,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class he{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,m){return c.preventDefault(),{cameraAnimation:C=>{C.easeTo({duration:300,zoom:C.getZoom()+(c.shiftKey?-1:1),around:C.unproject(m)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ke{constructor(){this._tap=new vu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,m,C){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?C.length>0&&(this._swipePoint=m[0],this._swipeTouch=C[0].identifier):this._tap.touchstart(c,m,C))}touchmove(c,m,C){if(this._tapTime){if(this._swipePoint){if(C[0].identifier!==this._swipeTouch)return;const T=m[0],P=T.y-this._swipePoint.y;return this._swipePoint=T,c.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(c,m,C)}touchend(c,m,C){this._tapTime?this._swipePoint&&0===C.length&&this.reset():this._tap.touchend(c,m,C)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wt{constructor(c,m,C){this._el=c,this._mousePan=m,this._touchPan=C}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vt{constructor(c,m,C){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=m,this._mousePitch=C}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class on{constructor(c,m,C,T){this._el=c,this._touchZoom=m,this._touchRotate=C,this._tapDragZoom=T,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Gn=b=>b.zoom||b.drag||b.pitch||b.rotate;class qn extends p.Event{}class hr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,m){const C=p.sub([],m,c);this.radius=p.length(C[2]<0?p.div([],C,this.constants):[C[0],C[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const m=p.scale$2([],c,this.radius);if(m[2]>0){const C=p.scale$2([],[0,0,1],p.dot(m,[0,0,1])),T=p.scale$2([],p.normalize([],[m[0],m[1],0]),this.radius),P=p.add([],m,p.scale$2([],p.sub([],p.add([],T,C),m),2));m[0]=P[0],m[1]=P[1]}return m}}function Lr(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class to{constructor(c,m){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new aa(c),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(m),p.bindAll(["handleEvent","handleWindowEvent"],this);const C=this._el;this._listeners=[[C,"touchstart",{passive:!0}],[C,"touchmove",{passive:!1}],[C,"touchend",void 0],[C,"touchcancel",void 0],[C,"mousedown",void 0],[C,"mousemove",void 0],[C,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[C,"mouseover",void 0],[C,"mouseout",void 0],[C,"dblclick",void 0],[C,"click",void 0],[C,"keydown",{capture:!1}],[C,"keyup",void 0],[C,"wheel",{passive:!1}],[C,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[T,P,F]of this._listeners)T.addEventListener(P,T===p.window.document?this.handleWindowEvent:this.handleEvent,F)}destroy(){for(const[c,m,C]of this._listeners)c.removeEventListener(m,c===p.window.document?this.handleWindowEvent:this.handleEvent,C)}_addDefaultHandlers(c){const m=this._map,C=m.getCanvasContainer();this._add("mapEvent",new xd(m,c));const T=m.boxZoom=new nc(m,c);this._add("boxZoom",T);const P=new rc,F=new he;m.doubleClickZoom=new q(F,P),this._add("tapZoom",P),this._add("clickZoom",F);const z=new ke;this._add("tapDragZoom",z);const j=m.touchPitch=new l(m);this._add("touchPitch",j);const W=new ti(c),Y=new Lu(c);m.dragRotate=new vt(c,W,Y),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);const fe=new oc(c),Ae=new Nu(m,c);m.dragPan=new wt(C,fe,Ae),this._add("mousePan",fe),this._add("touchPan",Ae,["touchZoom","touchRotate"]);const Ve=new uf,Ue=new yl;m.touchZoomRotate=new on(C,Ue,Ve,z),this._add("touchRotate",Ve,["touchPan","touchZoom"]),this._add("touchZoom",Ue,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ea(m));const Ge=m.scrollZoom=new U(m,this);this._add("scrollZoom",Ge,["mousePan"]);const qe=m.keyboard=new _;this._add("keyboard",qe);for(const Ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[Ie]&&m[Ie].enable(c[Ie])}_add(c,m,C){this._handlers.push({handlerName:c,handler:m,allowed:C}),this._handlersById[c]=m}stop(c){if(!this._updatingCamera){for(const{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,m,C){for(const T in c)if(T!==C&&(!m||m.indexOf(T)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const m=[];for(const C of c)this._el.contains(C.target)&&m.push(C);return m}handleEvent(c,m){this._updatingCamera=!0;const C="renderFrame"===c.type,T=C?void 0:c,P={needsRenderFrame:!1},F={},z={},j=c.touches?this._getMapTouches(c.touches):void 0,W=j?te(this._el,j):C?void 0:Q(this._el,c);for(const{handlerName:Ae,handler:Ve,allowed:Ue}of this._handlers){if(!Ve.isEnabled())continue;let Ge;this._blockedByActive(z,Ue,Ae)?Ve.reset():Ve[m||c.type]&&(Ge=Ve[m||c.type](c,W,j),this.mergeHandlerResult(P,F,Ge,Ae,T),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||Ve.isActive())&&(z[Ae]=Ve)}const Y={};for(const Ae in this._previousActiveHandlers)z[Ae]||(Y[Ae]=T);this._previousActiveHandlers=z,(Object.keys(Y).length||Lr(P))&&(this._changes.push([P,F,Y]),this._triggerRenderFrame()),(Object.keys(z).length||Lr(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=P;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))}mergeHandlerResult(c,m,C,T,P){if(!C)return;p.extend(c,C);const F={handlerName:T,originalEvent:C.originalEvent||P};void 0!==C.zoomDelta&&(m.zoom=F),void 0!==C.panDelta&&(m.drag=F),void 0!==C.pitchDelta&&(m.pitch=F),void 0!==C.bearingDelta&&(m.rotate=F)}_applyChanges(){const c={},m={},C={};for(const[T,P,F]of this._changes)T.panDelta&&(c.panDelta=(c.panDelta||new p.pointGeometry(0,0))._add(T.panDelta)),T.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+T.pitchDelta),void 0!==T.around&&(c.around=T.around),void 0!==T.aroundCoord&&(c.aroundCoord=T.aroundCoord),void 0!==T.pinchAround&&(c.pinchAround=T.pinchAround),T.noInertia&&(c.noInertia=T.noInertia),p.extend(m,P),p.extend(C,F);this._updateMapTransform(c,m,C),this._changes=[]}_updateMapTransform(c,m,C){const T=this._map,P=T.transform,F=tt=>[tt.x,tt.y,tt.z];if((tt=>{const Je=this._eventsInProgress.drag;return Je&&!this._handlersById[Je.handlerName].isActive()})()&&!Lr(c)){const tt=P.zoom;P.cameraElevationReference="sea",P.recenterOnTerrain(),P.cameraElevationReference="ground",tt!==P.zoom&&this._map._update(!0)}if(P._isCameraConstrained&&T._stop(!0),!Lr(c))return void this._fireEvents(m,C,!0);let{panDelta:z,zoomDelta:j,bearingDelta:W,pitchDelta:Y,around:fe,aroundCoord:Ae,pinchAround:Ve}=c;P._isCameraConstrained&&(j>0&&(j=0),P._isCameraConstrained=!1),void 0!==Ve&&(fe=Ve),(j||(tt=>m.drag&&!this._eventsInProgress.drag)())&&fe&&(this._dragOrigin=F(P.pointCoordinate3D(fe)),this._trackingEllipsoid.setup(P._camera.position,this._dragOrigin)),P.cameraElevationReference="sea",T._stop(!0),fe=fe||T.transform.centerPoint,W&&(P.bearing+=W),Y&&(P.pitch+=Y),P._updateCameraState();const Ue=[0,0,0];if(z)if("mercator"===P.projection.name){const tt=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(fe).dir),Je=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(fe.sub(z)).dir);Ue[0]=Je[0]-tt[0],Ue[1]=Je[1]-tt[1]}else{const tt=P.pointCoordinate(fe);if("globe"===P.projection.name){z=z.rotate(-P.angle);const Je=P._pixelsPerMercatorPixel/P.worldSize;Ue[0]=-z.x*p.mercatorScale(p.latFromMercatorY(tt.y))*Je,Ue[1]=-z.y*p.mercatorScale(P.center.lat)*Je}else{const Je=P.pointCoordinate(fe.sub(z));tt&&Je&&(Ue[0]=Je.x-tt.x,Ue[1]=Je.y-tt.y)}}const Ge=P.zoom,qe=[0,0,0];if(j){const tt=F(Ae||P.pointCoordinate3D(fe)),Je={dir:p.normalize([],p.sub([],tt,P._camera.position))};if(Je.dir[2]<0){const ot=P.zoomDeltaToMovement(tt,j);p.scale$2(qe,Je.dir,ot)}}const Ie=p.add(Ue,Ue,qe);P._translateCameraConstrained(Ie),j&&Math.abs(P.zoom-Ge)>1e-4&&P.recenterOnTerrain(),P.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(m,C,!0)}_fireEvents(c,m,C){const T=Gn(this._eventsInProgress),P=Gn(c),F={};for(const Y in c){const{originalEvent:fe}=c[Y];this._eventsInProgress[Y]||(F[`${Y}start`]=fe),this._eventsInProgress[Y]=c[Y]}!T&&P&&this._fireEvent("movestart",P.originalEvent);for(const Y in F)this._fireEvent(Y,F[Y]);P&&this._fireEvent("move",P.originalEvent);for(const Y in c){const{originalEvent:fe}=c[Y];this._fireEvent(Y,fe)}const z={};let j;for(const Y in this._eventsInProgress){const{handlerName:fe,originalEvent:Ae}=this._eventsInProgress[Y];this._handlersById[fe].isActive()||(delete this._eventsInProgress[Y],j=m[fe]||Ae,z[`${Y}end`]=j)}for(const Y in z)this._fireEvent(Y,z[Y]);const W=Gn(this._eventsInProgress);if(C&&(T||P)&&!W){this._updatingCamera=!0;const Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),fe=Ae=>0!==Ae&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;Y?(fe(Y.bearing||this._map.getBearing())&&(Y.bearing=0),this._map.easeTo(Y,{originalEvent:j})):(this._map.fire(new p.Event("moveend",{originalEvent:j})),fe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,m){this._map.fire(new p.Event(c,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new qn("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ps="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ka extends p.Evented{constructor(c,m){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=m.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,m){return this.jumpTo({center:c},m)}panBy(c,m,C){return c=p.pointGeometry.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},m),C)}panTo(c,m,C){return this.easeTo(p.extend({center:c},m),C)}getZoom(){return this.transform.zoom}setZoom(c,m){return this.jumpTo({zoom:c},m),this}zoomTo(c,m,C){return this.easeTo(p.extend({zoom:c},m),C)}zoomIn(c,m){return this.zoomTo(this.getZoom()+1,c,m),this}zoomOut(c,m){return this.zoomTo(this.getZoom()-1,c,m),this}getBearing(){return this.transform.bearing}setBearing(c,m){return this.jumpTo({bearing:c},m),this}getPadding(){return this.transform.padding}setPadding(c,m){return this.jumpTo({padding:c},m),this}rotateTo(c,m,C){return this.easeTo(p.extend({bearing:c},m),C)}resetNorth(c,m){return this.rotateTo(0,p.extend({duration:1e3},c),m),this}resetNorthPitch(c,m){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),m),this}snapToNorth(c,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,m):this}getPitch(){return this.transform.pitch}setPitch(c,m){return this.jumpTo({pitch:c},m),this}cameraForBounds(c,m){c=p.LngLatBounds.convert(c);const C=m&&m.bearing||0,T=m&&m.pitch||0,P=c.getNorthWest(),F=c.getSouthEast();return this._cameraForBounds(this.transform,P,F,C,T,m)}_extendCameraOptions(c){const m={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const C=c.padding;c.padding={top:C,bottom:C,right:C,left:C}}return c.padding=p.extend(m,c.padding),c}_minimumAABBFrustumDistance(c,m){const C=m.max[0]-m.min[0],T=m.max[1]-m.min[1];return C/T>c.aspect?C/(2*Math.tan(.5*c.fovX)*c.aspect):T/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,m,C,T,P,F){const z=c.clone(),j=this._extendCameraOptions(F);z.bearing=T,z.pitch=P;const W=p.LngLat.convert(m),Y=p.LngLat.convert(C),fe=.5*(W.lat+Y.lat),Ae=.5*(W.lng+Y.lng),Ve=p.latLngToECEF(fe,Ae),Ue=p.normalize([],Ve),Ge=p.normalize([],p.cross([],Ue,[0,1,0])),qe=p.cross([],Ge,Ue),Ie=[Ge[0],Ge[1],Ge[2],0,qe[0],qe[1],qe[2],0,Ue[0],Ue[1],Ue[2],0,0,0,0,1],tt=[Ve,p.latLngToECEF(W.lat,W.lng),p.latLngToECEF(Y.lat,W.lng),p.latLngToECEF(Y.lat,Y.lng),p.latLngToECEF(W.lat,Y.lng),p.latLngToECEF(fe,W.lng),p.latLngToECEF(fe,Y.lng),p.latLngToECEF(W.lat,Ae),p.latLngToECEF(Y.lat,Ae)];let Je=p.Aabb.fromPoints(tt.map(xn=>[p.dot(Ge,xn),p.dot(qe,xn),p.dot(Ue,xn)]));const ot=p.transformMat4([],Je.center,Ie);0===p.squaredLength(ot)&&p.set(ot,0,0,1),p.normalize(ot,ot),p.scale$2(ot,ot,p.GLOBE_RADIUS),z.center=p.ecefToLatLng(ot);const Ct=z.getWorldToCameraMatrix(),_t=p.invert(new Float64Array(16),Ct);Je=p.Aabb.applyTransform(Je,p.multiply([],Ct,Ie)),p.transformMat4(ot,ot,Ct);const It=.5*(Je.max[2]-Je.min[2]),jt=this._minimumAABBFrustumDistance(z,Je),Wt=p.scale$2([],[0,0,1],It),Qt=p.add(Wt,ot,Wt),Bn=jt+(0===z.pitch?0:p.distance(ot,Qt)),Xt=z.globeCenterInViewSpace,yn=p.sub([],ot,[Xt[0],Xt[1],Xt[2]]);p.normalize(yn,yn),p.scale$2(yn,yn,Bn);const sn=p.add([],ot,yn);p.transformMat4(sn,sn,_t);const An=p.earthRadius/p.GLOBE_RADIUS,Ht=p.length(sn),Vt=p.mercatorZfromAltitude(Math.max(Ht*An-p.earthRadius,Number.EPSILON),0),en=Math.min(z.zoomFromMercatorZAdjusted(Vt),j.maxZoom);return en>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"mercator"}),z.zoom=en,this._cameraForBounds(z,m,C,T,P,F)):{center:z.center,zoom:en,bearing:T,pitch:P}}queryTerrainElevation(c,m){const C=this.transform.elevation;return C?(m=p.extend({},{exaggerated:!0},m),C.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,m.exaggerated)):null}_cameraForBounds(c,m,C,T,P,F){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,m,C,T,P,F);const z=c.clone(),j=this._extendCameraOptions(F),W=z.padding;z.bearing=T,z.pitch=P;const Y=p.LngLat.convert(m),fe=p.LngLat.convert(C),Ae=new p.LngLat(Y.lng,fe.lat),Ve=new p.LngLat(fe.lng,Y.lat),Ue=z.project(Y),Ge=z.project(fe),qe=this.queryTerrainElevation(Y),Ie=this.queryTerrainElevation(fe),tt=this.queryTerrainElevation(Ae),Je=this.queryTerrainElevation(Ve),ot=[[Ue.x,Ue.y,Math.min(qe||0,Ie||0,tt||0,Je||0)],[Ge.x,Ge.y,Math.max(qe||0,Ie||0,tt||0,Je||0)]];let Ct=p.Aabb.fromPoints(ot);const _t=z.getWorldToCameraMatrix(),It=p.invert(new Float64Array(16),_t);Ct=p.Aabb.applyTransform(Ct,_t);const jt=p.sub([],Ct.max,Ct.min),Wt=W.left||0,Qt=W.right||0,Bn=W.bottom||0,Xt=W.top||0,{left:yn,right:sn,top:An,bottom:Ht}=j.padding,Vt=.5*(Wt+Qt),en=.5*(Xt+Bn),xn=Math.min(z.scaleZoom(z.scale*Math.min((z.width-(Wt+Qt+yn+sn))/jt[0],(z.height-(Bn+Xt+Ht+An))/jt[1])),j.maxZoom),Pn=z.scale/z.zoomScale(xn);Ct=new p.Aabb([Ct.min[0]-(yn+Vt)*Pn,Ct.min[1]-(Ht+en)*Pn,Ct.min[2]],[Ct.max[0]+(sn+Vt)*Pn,Ct.max[1]+(An+en)*Pn,Ct.max[2]]);const br=.5*jt[2],wi=this._minimumAABBFrustumDistance(z,Ct),gr=[0,0,1,0];p.transformMat4$1(gr,gr,_t),p.normalize$2(gr,gr);const or=p.scale$2([],gr,wi+br),Ir=p.add([],Ct.center,or),qi=("number"==typeof j.offset.x&&"number"==typeof j.offset.y?new p.pointGeometry(j.offset.x,j.offset.y):p.pointGeometry.convert(j.offset)).rotate(-p.degToRad(T));Ct.center[0]-=qi.x*Pn,Ct.center[1]+=qi.y*Pn,p.transformMat4(Ct.center,Ct.center,It),p.transformMat4(Ir,Ir,It);const Br=[Ct.center[0],Ct.center[1],Ir[2]*z.pixelsPerMeter];p.scale$2(Br,Br,1/z.worldSize);const ns=p.lngFromMercatorX(Br[0]),rs=p.latFromMercatorY(Br[1]),fs=Math.min(z._zoomFromMercatorZ(Br[2]),j.maxZoom),Rs=new p.LngLat(ns,rs);return z.mercatorFromTransition&&fs<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"globe"}),z.zoom=fs,this._cameraForBounds(z,m,C,T,P,F)):{center:Rs,zoom:fs,bearing:T,pitch:P}}fitBounds(c,m,C){const T=this.cameraForBounds(c,m);return this._fitInternal(T,m,C)}fitScreenCoordinates(c,m,C,T,P){const F=p.pointGeometry.convert(c),z=p.pointGeometry.convert(m),j=new p.pointGeometry(Math.min(F.x,z.x),Math.min(F.y,z.y)),W=new p.pointGeometry(Math.max(F.x,z.x),Math.max(F.y,z.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(F,z))return this;const Y=this.transform.pointLocation3D(j),fe=this.transform.pointLocation3D(W),Ae=this.transform.pointLocation3D(new p.pointGeometry(j.x,W.y)),Ve=this.transform.pointLocation3D(new p.pointGeometry(W.x,j.y)),Ue=[Math.min(Y.lng,fe.lng,Ae.lng,Ve.lng),Math.min(Y.lat,fe.lat,Ae.lat,Ve.lat)],Ge=[Math.max(Y.lng,fe.lng,Ae.lng,Ve.lng),Math.max(Y.lat,fe.lat,Ae.lat,Ve.lat)],qe=T&&T.pitch?T.pitch:this.getPitch(),Ie=this._cameraForBounds(this.transform,Ue,Ge,C,qe,T);return this._fitInternal(Ie,T,P)}_fitInternal(c,m,C){return c?(delete(m=p.extend(c,m)).padding,m.linear?this.easeTo(m,C):this.flyTo(m,C)):this}jumpTo(c,m){this.stop();const C=c.preloadOnly?this.transform.clone():this.transform;let T=!1,P=!1,F=!1;return"zoom"in c&&C.zoom!==+c.zoom&&(T=!0,C.zoom=+c.zoom),void 0!==c.center&&(C.center=p.LngLat.convert(c.center)),"bearing"in c&&C.bearing!==+c.bearing&&(P=!0,C.bearing=+c.bearing),"pitch"in c&&C.pitch!==+c.pitch&&(F=!0,C.pitch=+c.pitch),null==c.padding||C.isPaddingEqual(c.padding)||(C.padding=c.padding),c.preloadOnly?(this._preloadTiles(C),this):(this.fire(new p.Event("movestart",m)).fire(new p.Event("move",m)),T&&this.fire(new p.Event("zoomstart",m)).fire(new p.Event("zoom",m)).fire(new p.Event("zoomend",m)),P&&this.fire(new p.Event("rotatestart",m)).fire(new p.Event("rotate",m)).fire(new p.Event("rotateend",m)),F&&this.fire(new p.Event("pitchstart",m)).fire(new p.Event("pitch",m)).fire(new p.Event("pitchend",m)),this.fire(new p.Event("moveend",m)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Ps),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,m){const C=this.transform;if(!C.projection.supportsFreeCamera)return p.warnOnce(Ps),this;this.stop();const T=C.zoom,P=C.pitch,F=C.bearing;C.setFreeCameraOptions(c);const z=T!==C.zoom,j=P!==C.pitch,W=F!==C.bearing;return this.fire(new p.Event("movestart",m)).fire(new p.Event("move",m)),z&&this.fire(new p.Event("zoomstart",m)).fire(new p.Event("zoom",m)).fire(new p.Event("zoomend",m)),W&&this.fire(new p.Event("rotatestart",m)).fire(new p.Event("rotate",m)).fire(new p.Event("rotateend",m)),j&&this.fire(new p.Event("pitchstart",m)).fire(new p.Event("pitch",m)).fire(new p.Event("pitchend",m)),this.fire(new p.Event("moveend",m)),this}easeTo(c,m){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||!c.essential&&p.exported.prefersReducedMotion)&&(c.duration=0);const C=this.transform,T=this.getZoom(),P=this.getBearing(),F=this.getPitch(),z=this.getPadding(),j="zoom"in c?+c.zoom:T,W="bearing"in c?this._normalizeBearing(c.bearing,P):P,Y="pitch"in c?+c.pitch:F,fe="padding"in c?c.padding:C.padding,Ae=p.pointGeometry.convert(c.offset);let Ve,Ue,Ge;if("globe"===C.projection.name){const Wt=p.MercatorCoordinate.fromLngLat(C.center),Qt=Ae.rotate(-C.angle);Wt.x+=Qt.x/C.worldSize,Wt.y+=Qt.y/C.worldSize;const Bn=Wt.toLngLat(),Xt=p.LngLat.convert(c.center||Bn);this._normalizeCenter(Xt),Ve=C.centerPoint.add(Qt),Ue=new p.pointGeometry(Wt.x,Wt.y).mult(C.worldSize),Ge=new p.pointGeometry(p.mercatorXfromLng(Xt.lng),p.mercatorYfromLat(Xt.lat)).mult(C.worldSize).sub(Ue)}else{Ve=C.centerPoint.add(Ae);const Wt=C.pointLocation(Ve),Qt=p.LngLat.convert(c.center||Wt);this._normalizeCenter(Qt),Ue=C.project(Wt),Ge=C.project(Qt).sub(Ue)}const qe=C.zoomScale(j-T);let Ie,tt;c.around&&(Ie=p.LngLat.convert(c.around),tt=C.locationPoint(Ie));const Je=this._zooming||j!==T,ot=this._rotating||P!==W,Ct=this._pitching||Y!==F,_t=!C.isPaddingEqual(fe),It=Wt=>Qt=>{if(Je&&(Wt.zoom=p.number(T,j,Qt)),ot&&(Wt.bearing=p.number(P,W,Qt)),Ct&&(Wt.pitch=p.number(F,Y,Qt)),_t&&(Wt.interpolatePadding(z,fe,Qt),Ve=Wt.centerPoint.add(Ae)),Ie)Wt.setLocationAtPoint(Ie,tt);else{const Bn=Wt.zoomScale(Wt.zoom-T),Xt=j>T?Math.min(2,qe):Math.max(.5,qe),yn=Math.pow(Xt,1-Qt),sn=Wt.unproject(Ue.add(Ge.mult(Qt*yn)).mult(Bn));Wt.setLocationAtPoint(Wt.renderWorldCopies?sn.wrap():sn,Ve)}return c.preloadOnly||this._fireMoveEvents(m),Wt};if(c.preloadOnly){const Wt=this._emulate(It,c.duration,C);return this._preloadTiles(Wt),this}const jt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Je,this._rotating=ot,this._pitching=Ct,this._padding=_t,this._easeId=c.easeId,this._prepareEase(m,c.noMoveStart,jt),this._ease(It(C),Wt=>{C.recenterOnTerrain(),this._afterEase(m,Wt)},c),this}_prepareEase(c,m,C={}){this._moving=!0,this.transform.cameraElevationReference="sea",m||C.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!C.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!C.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!C.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,m){if(this._easeId&&m&&this._easeId===m)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const C=this._zooming,T=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new p.Event("zoomend",c)),T&&this.fire(new p.Event("rotateend",c)),P&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,m){if(!c.essential&&p.exported.prefersReducedMotion){const xn=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xn,m)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const C=this.transform,T=this.getZoom(),P=this.getBearing(),F=this.getPitch(),z=this.getPadding(),j="zoom"in c?p.clamp(+c.zoom,C.minZoom,C.maxZoom):T,W="bearing"in c?this._normalizeBearing(c.bearing,P):P,Y="pitch"in c?+c.pitch:F,fe="padding"in c?c.padding:C.padding,Ae=C.zoomScale(j-T),Ve=p.pointGeometry.convert(c.offset);let Ue=C.centerPoint.add(Ve);const Ge=C.pointLocation(Ue),qe=p.LngLat.convert(c.center||Ge);this._normalizeCenter(qe);const Ie=C.project(Ge),tt=C.project(qe).sub(Ie);let Je=c.curve;const ot=Math.max(C.width,C.height),Ct=ot/Ae,_t=tt.mag();if("minZoom"in c){const xn=p.clamp(Math.min(c.minZoom,T,j),C.minZoom,C.maxZoom),Pn=ot/C.zoomScale(xn-T);Je=Math.sqrt(Pn/_t*2)}const It=Je*Je;function jt(xn){const Pn=(Ct*Ct-ot*ot+(xn?-1:1)*It*It*_t*_t)/(2*(xn?Ct:ot)*It*_t);return Math.log(Math.sqrt(Pn*Pn+1)-Pn)}function Wt(xn){return(Math.exp(xn)-Math.exp(-xn))/2}function Qt(xn){return(Math.exp(xn)+Math.exp(-xn))/2}const Bn=jt(0);let Xt=function(xn){return Qt(Bn)/Qt(Bn+Je*xn)},yn=function(xn){return ot*((Qt(Bn)*(Wt(Pn=Bn+Je*xn)/Qt(Pn))-Wt(Bn))/It)/_t;var Pn},sn=(jt(1)-Bn)/Je;if(Math.abs(_t)<1e-6||!isFinite(sn)){if(Math.abs(ot-Ct)<1e-6)return this.easeTo(c,m);const xn=Ct<ot?-1:1;sn=Math.abs(Math.log(Ct/ot))/Je,yn=function(){return 0},Xt=function(Pn){return Math.exp(xn*Je*Pn)}}c.duration="duration"in c?+c.duration:1e3*sn/("screenSpeed"in c?+c.screenSpeed/Je:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const An=P!==W,Ht=Y!==F,Vt=!C.isPaddingEqual(fe),en=xn=>Pn=>{const br=Pn*sn,wi=1/Xt(br);xn.zoom=1===Pn?j:T+xn.scaleZoom(wi),An&&(xn.bearing=p.number(P,W,Pn)),Ht&&(xn.pitch=p.number(F,Y,Pn)),Vt&&(xn.interpolatePadding(z,fe,Pn),Ue=xn.centerPoint.add(Ve));const gr=1===Pn?qe:xn.unproject(Ie.add(tt.mult(yn(br))).mult(wi));return xn.setLocationAtPoint(xn.renderWorldCopies?gr.wrap():gr,Ue),xn._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(m),xn};if(c.preloadOnly){const xn=this._emulate(en,c.duration,C);return this._preloadTiles(xn),this}return this._zooming=!0,this._rotating=An,this._pitching=Ht,this._padding=Vt,this._prepareEase(m,!1),this._ease(en(C),()=>this._afterEase(m),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const C=this._onEaseEnd;this._onEaseEnd=void 0,C.call(this,m)}if(!c){const C=this.handlers;C&&C.stop(!1)}return this}_ease(c,m,C){!1===C.animate||0===C.duration?(c(1),m()):(this._easeStart=p.exported.now(),this._easeOptions=C,this._onEaseFrame=c,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),m=this._onEaseFrame;m&&m(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,m){c=p.wrap(c,-180,180);const C=Math.abs(c-m);return Math.abs(c-360-m)<C&&(c-=360),Math.abs(c+360-m)<C&&(c+=360),c}_normalizeCenter(c){const m=this.transform;if(!m.renderWorldCopies||m.maxBounds)return;const C=c.lng-m.center.lng;c.lng+=C>180?-360:C<-180?360:0}_emulate(c,m,C){const T=Math.ceil(15*m/1e3),P=[],F=c(C.clone());for(let z=0;z<=T;z++){const j=F(z/T);P.push(j.clone())}return P}}class Pl{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const m=this.options&&this.options.compact;return this._map=c,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Fe("button","mapboxgl-ctrl-attrib-button",this._container),Fe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Fe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),m&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===m&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,m){const C=this._map._getUIString(`AttributionControl.${m}`);c.setAttribute("aria-label",C),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",C)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const m=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const C=m.reduce((T,P,F)=>(P.value&&(T+=`${P.key}=${P.value}${F<m.length-1?"&":""}`),T),"?");c.href=`${p.config.FEEDBACK_URL}/${C}#${ga(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const T=this._map.style.stylesheet;this.styleOwner=T.owner,this.styleId=T.id}const m=this._map.style._sourceCaches;for(const T in m){const P=m[T];if(P.used){const F=P.getSource();F.attribution&&c.indexOf(F.attribution)<0&&c.push(F.attribution)}}c.sort((T,P)=>T.length-P.length),c=c.filter((T,P)=>{for(let F=P+1;F<c.length;F++)if(c[F].indexOf(T)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const C=c.join(" | ");C!==this._attribHTML&&(this._attribHTML=C,c.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ku{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Fe("div","mapboxgl-ctrl");const m=Fe("a","mapboxgl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://www.mapbox.com/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const m in c){const C=c[m].getSource();if(C.hasOwnProperty("mapbox_logo")&&!C.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const m=c[0];this._map.getCanvasContainer().offsetWidth<250?m.classList.add("mapboxgl-compact"):m.classList.remove("mapboxgl-compact")}}}class Sc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const m=++this._id;return this._queue.push({callback:c,id:m,cancelled:!1}),m}remove(c){const m=this._currentlyRunning,C=m?this._queue.concat(m):this._queue;for(const T of C)if(T.id===c)return void(T.cancelled=!0)}run(c=0){const m=this._currentlyRunning=this._queue;this._queue=[];for(const C of m)if(!C.cancelled&&(C.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function cf(b,c,m){if(b=new p.LngLat(b.lng,b.lat),c){const C=new p.LngLat(b.lng-360,b.lat),T=new p.LngLat(b.lng+360,b.lat),P=360*Math.ceil(Math.abs(b.lng-m.center.lng)/360),F=m.locationPoint(b).distSqr(c),z=c.x<0||c.y<0||c.x>m.width||c.y>m.height;m.locationPoint(C).distSqr(c)<F&&(z||Math.abs(C.lng-m.center.lng)<P)?b=C:m.locationPoint(T).distSqr(c)<F&&(z||Math.abs(T.lng-m.center.lng)<P)&&(b=T)}for(;Math.abs(b.lng-m.center.lng)>180;){const C=m.locationPoint(b);if(C.x>=0&&C.y>=0&&C.x<=m.width&&C.y<=m.height)break;b.lng>m.center.lng?b.lng-=360:b.lng+=360}return b}const Dh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ff extends p.Evented{constructor(c,m){if(super(),(c instanceof p.window.HTMLElement||m)&&(c=p.extend({element:c},m)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.pointGeometry.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Fe("div");const T=41,P=27,F=bt("svg",{display:"block",height:T*this._scale+"px",width:P*this._scale+"px",viewBox:`0 0 ${P} ${T}`},this._element),z=bt("radialGradient",{id:"shadowGradient"},bt("defs",{},F));bt("stop",{offset:"10%","stop-opacity":.4},z),bt("stop",{offset:"100%","stop-opacity":.05},z),bt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},F),bt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},F),bt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},F),bt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},F),this._offset=p.pointGeometry.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const C=this._element.classList;for(const T in Dh)C.remove(`mapboxgl-marker-anchor-${T}`);C.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const T=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[T,-1*(24.6+T)],"bottom-right":[-T,-1*(24.6+T)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const m=c.code,C=c.charCode||c.keyCode;"Space"!==m&&"Enter"!==m&&32!==C&&13!==C||this.togglePopup()}_onMapClick(c){const m=c.originalEvent.target,C=this._element;this._popup&&(m===C||C.contains(m))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,m=this._pos;if(!c||!m)return!1;const C=c.unproject(m),T=c.getFreeCameraOptions();if(!T.position)return!1;const P=T.position.toLngLat();return P.distanceTo(C)<.9*P.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const m=this._pos;if(!m||m.x<0||m.x>c.transform.width||m.y<0||m.y>c.transform.height)return void this._clearFadeTimer();const C=c.unproject(m);let T;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?T=0:(T=1-c._queryFogOpacity(C),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(T*=this._occludedOpacity)),this._element.style.opacity=`${T}`,this._element.style.pointerEvents=T>0?"auto":"none",this._popup&&this._popup._setOpacity(T),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const m=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${Dh[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${m.x}px,${m.y}px)\n        `}_calculateXYTransform(){const c=this._pos,m=this._map,C=this.getPitchAlignment();if(!m||!c||"map"!==C)return"";if(!m._showingGlobe()){const j=m.getPitch();return j?`rotateX(${j}deg)`:""}const T=p.radToDeg(p.globeTiltAtLngLat(m.transform,this._lngLat)),P=c.sub(p.globeCenterToScreenPoint(m.transform)),F=Math.abs(P.x)+Math.abs(P.y);if(0===F)return"";const z=T/F;return`rotateX(${-P.y*z}deg) rotateY(${P.x*z}deg)`}_calculateZTransform(){const c=this._pos,m=this._map;if(!m||!c)return"";let C=0;const T=this.getRotationAlignment();if("map"===T)if(m._showingGlobe()){const P=m.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),F=m.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(P);C=p.radToDeg(Math.atan2(F.y,F.x))-90}else C=-m.getBearing();else if("horizon"===T){const P=p.smoothstep(4,6,m.getZoom()),F=p.globeCenterToScreenPoint(m.transform);F.y+=P*m.transform.height;const z=c.sub(F),j=p.radToDeg(Math.atan2(z.y,z.x));C=(j>90?j-270:j+90)*(1-P)}return C+=this._rotation,C?`rotateZ(${C}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const m=this._map;m&&(m.transform.renderWorldCopies&&(this._lngLat=cf(this._lngLat,this._pos,m.transform)),this._pos=m.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),m._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(m._showingGlobe()||m.getTerrain()||m.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.pointGeometry.convert(c),this._update(),this}_onMove(c){const m=this._map;if(!m)return;const C=this._pointerdownPos,T=this._positionDelta;if(C&&T){if(!this._isDragging){const P=this._clickTolerance||m._clickTolerance;if(c.point.dist(C)<P)return;this._isDragging=!0}this._pos=c.point.sub(T),this._lngLat=m.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const m=this._map,C=this._pos;m&&C&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(C),this._pointerdownPos=c.point,this._state="pending",m.on("mousemove",this._onMove),m.on("touchmove",this._onMove),m.once("mouseup",this._onUp),m.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const m=this._map;return m&&(c?(m.on("mousedown",this._addDragHandler),m.on("touchstart",this._addDragHandler)):(m.off("mousedown",this._addDragHandler),m.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},wp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bf(b=new p.pointGeometry(0,0),c="bottom"){if("number"==typeof b){const m=Math.round(Math.sqrt(.5*Math.pow(b,2)));switch(c){case"top":return new p.pointGeometry(0,b);case"top-left":return new p.pointGeometry(m,m);case"top-right":return new p.pointGeometry(-m,m);case"bottom":return new p.pointGeometry(0,-b);case"bottom-left":return new p.pointGeometry(m,-m);case"bottom-right":return new p.pointGeometry(-m,-m);case"left":return new p.pointGeometry(b,0);case"right":return new p.pointGeometry(-b,0)}return new p.pointGeometry(0,0)}return b instanceof p.pointGeometry||Array.isArray(b)?p.pointGeometry.convert(b):p.pointGeometry.convert(b[c]||[0,0])}class Eg{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const m=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-m)+this._end*m}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,m,C){this._start=this.getValue(m),this._end=c,this._startTime=m,this._endTime=m+C}}const Cg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Kl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Tc={showCompass:!0,showZoom:!0,visualizePitch:!1};class ma{constructor(c,m,C=!1){this._clickTolerance=10,this.element=m,this.mouseRotate=new ti({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,C&&(this.mousePitch=new Lu({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),m.addEventListener("mousedown",this.mousedown),m.addEventListener("touchstart",this.touchstart,{passive:!1}),m.addEventListener("touchmove",this.touchmove),m.addEventListener("touchend",this.touchend),m.addEventListener("touchcancel",this.reset)}down(c,m){this.mouseRotate.mousedown(c,m),this.mousePitch&&this.mousePitch.mousedown(c,m),Rt()}move(c,m){const C=this.map,T=this.mouseRotate.mousemoveWindow(c,m),P=T&&T.bearingDelta;if(P&&C.setBearing(C.getBearing()+P),this.mousePitch){const F=this.mousePitch.mousemoveWindow(c,m),z=F&&F.pitchDelta;z&&C.setPitch(C.getPitch()+z)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ae(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Q(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Q(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=te(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=te(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Sg={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Tg={maxWidth:100,unit:"metric"};function Ig(b,c,m){const C=wd(c),T=C/c,P={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[m];this._map._requestDomTask(()=>{this._container.style.width=b*T+"px",this._container.innerHTML=`${C}&nbsp;${P}`})}function wd(b){const c=Math.pow(10,`${Math.floor(b)}`.length-1);let m=b/c;return m=m>=10?10:m>=5?5:m>=3?3:m>=2?2:m>=1?1:function(C){const T=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*T)/T}(m),c*m}const zf={version:p.version,supported:ge,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends ka{constructor(b){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(b=p.extend({},Kl,b)).minZoom&&null!=b.maxZoom&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=b.minPitch&&null!=b.maxPitch&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=b.minPitch&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=b.maxPitch&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(b.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(b.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tr(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),b),this._interactive=b.interactive,this._minTileCacheSize=b.minTileCacheSize,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._useWebGL2=b.useWebGL2,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=b.crossSourceCollisions,this._collectResourceTiming=b.collectResourceTiming,this._optimizeForTerrain=b.optimizeForTerrain,this._language=this._parseLanguage(b.language),this._worldview=b.worldview,this._renderTaskQueue=new Sc,this._domRenderTaskQueue=new Sc,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Cg,b.locale),this._clickTolerance=b.clickTolerance,this._cooperativeGestures=b.cooperativeGestures,this._performanceMetricsCollection=b.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Eg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(b.transformRequest,b.accessToken,b.testMode),this._silenceAuthErrors=!!b.testMode,"string"==typeof b.container){if(this._container=p.window.document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),b.maxBounds&&this.setMaxBounds(b.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new to(this,b),this._localFontFamily=b.localFontFamily,this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),b.projection&&this.setProjection(b.projection),this._hash=b.hash&&new Hu("string"==typeof b.hash&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,p.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),b.attributionControl&&this.addControl(new Pl({customAttribution:b.customAttribution})),this._logoControl=new ku,this.addControl(this._logoControl,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(b,c){if(void 0===c&&(c=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const m=b.onAdd(this);this._controls.push(b);const C=this._controlPositions[c];return-1!==c.indexOf("bottom")?C.insertBefore(m,C.firstChild):C.appendChild(m),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(b);return c>-1&&this._controls.splice(c,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(b){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",b)).fire(new p.Event("move",b)),this.fire(new p.Event("resize",b)),c&&this.fire(new p.Event("moveend",b)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(b){return this.transform.setMaxBounds(p.LngLatBounds.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b?this.setZoom(b):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b?this.setZoom(b):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b?this.setPitch(b):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b?this.setPitch(b):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(b){return"auto"===b?p.window.navigator.language:Array.isArray(b)?0===b.length?void 0:b.map(c=>"auto"===c?p.window.navigator.language:c):b}setLanguage(b){const c=this._parseLanguage(b);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const m of this._controls)m._setLanguage&&m._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(b){return this.style&&b!==this._worldview?(this._worldview=b,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(b){return this._lazyInitEmptyStyle(),b?"string"==typeof b&&(b={name:b}):b=null,this._useExplicitProjection=!!b,this._prioritizeAndUpdateProjection(b,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const b=this.transform,c=b.projection.name;let m;"globe"===c&&b.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(b.setMercatorFromTransition(),m=!0):"mercator"===c&&b.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(b.setProjection({name:"globe"}),m=!0),m&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(b,c){return this._updateProjection(b||c||{name:"mercator"})}_updateProjection(b){let c;if(c="globe"===b.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(b),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const m in this.style._sourceCaches)this.style._sourceCaches[m].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(b){return this.transform.locationPoint3D(p.LngLat.convert(b))}unproject(b){return this.transform.pointLocation3D(p.pointGeometry.convert(b))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(b,c,m){if("mouseenter"===b||"mouseover"===b){let C=!1;const T=F=>{const z=c.filter(W=>this.getLayer(W)),j=z.length?this.queryRenderedFeatures(F.point,{layers:z}):[];j.length?C||(C=!0,m.call(this,new hs(b,this,F.originalEvent,{features:j}))):C=!1},P=()=>{C=!1};return{layers:new Set(c),listener:m,delegates:{mousemove:T,mouseout:P}}}if("mouseleave"===b||"mouseout"===b){let C=!1;const T=F=>{const z=c.filter(j=>this.getLayer(j));(z.length?this.queryRenderedFeatures(F.point,{layers:z}):[]).length?C=!0:C&&(C=!1,m.call(this,new hs(b,this,F.originalEvent)))},P=F=>{C&&(C=!1,m.call(this,new hs(b,this,F.originalEvent)))};return{layers:new Set(c),listener:m,delegates:{mousemove:T,mouseout:P}}}{const C=T=>{const P=c.filter(z=>this.getLayer(z)),F=P.length?this.queryRenderedFeatures(T.point,{layers:P}):[];F.length&&(T.features=F,m.call(this,T),delete T.features)};return{layers:new Set(c),listener:m,delegates:{[b]:C}}}}on(b,c,m){if(void 0===m)return super.on(b,c);Array.isArray(c)||(c=[c]);const C=this._createDelegatedListener(b,c,m);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(C);for(const T in C.delegates)this.on(T,C.delegates[T]);return this}once(b,c,m){if(void 0===m)return super.once(b,c);Array.isArray(c)||(c=[c]);const C=this._createDelegatedListener(b,c,m);for(const T in C.delegates)this.once(T,C.delegates[T]);return this}off(b,c,m){if(void 0===m)return super.off(b,c);c=new Set(Array.isArray(c)?c:[c]);const C=(P,F)=>{if(P.size!==F.size)return!1;for(const z of P)if(!F.has(z))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[b]:void 0;return T&&(P=>{for(let F=0;F<P.length;F++){const z=P[F];if(z.listener===m&&C(z.layers,c)){for(const j in z.delegates)this.off(j,z.delegates[j]);return P.splice(F,1),this}}})(T),this}queryRenderedFeatures(b,c){return this.style?(void 0!==c||void 0===b||b instanceof p.pointGeometry||Array.isArray(b)||(c=b,b=void 0),this.style.queryRenderedFeatures(b=b||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(b,c){return this.style.querySourceFeatures(b,c)}setStyle(b,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&b?(this._diffStyle(b,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(b,c))}_getUIString(b){const c=this._locale[b];if(null==c)throw new Error(`Missing UI string '${b}'`);return c}_updateStyle(b,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),b&&(this.style=new ms(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof b?this.style.loadURL(b):this.style.loadJSON(b)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ms(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,c){if("string"==typeof b){const m=this._requestManager.normalizeStyleURL(b),C=this._requestManager.transformRequest(m,p.ResourceType.Style);p.getJSON(C,(T,P)=>{T?this.fire(new p.ErrorEvent(T)):P&&this._updateDiff(P,c)})}else"object"==typeof b&&this._updateDiff(b,c)}_updateDiff(b,c){try{this.style.setState(b)&&this._update(!0)}catch(m){p.warnOnce(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(b,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(b,c){return this._lazyInitEmptyStyle(),this.style.addSource(b,c),this._update(!0)}isSourceLoaded(b){return!!this.style&&this.style._isSourceCacheLoaded(b)}areTilesLoaded(){const b=this.style&&this.style._sourceCaches;for(const c in b){const m=b[c]._tiles;for(const C in m){const T=m[C];if("loaded"!==T.state&&"errored"!==T.state)return!1}}return!0}addSourceType(b,c,m){this._lazyInitEmptyStyle(),this.style.addSourceType(b,c,m)}removeSource(b){return this.style.removeSource(b),this._updateTerrain(),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,c,{pixelRatio:m=1,sdf:C=!1,stretchX:T,stretchY:P,content:F}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:z,height:j,data:W}=p.exported.getImageData(c);this.style.addImage(b,{data:new p.RGBAImage({width:z,height:j},W),pixelRatio:m,stretchX:T,stretchY:P,content:F,sdf:C,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:j}=c,W=c;this.style.addImage(b,{data:new p.RGBAImage({width:z,height:j},new Uint8Array(W.data)),pixelRatio:m,stretchX:T,stretchY:P,content:F,sdf:C,version:0,userImage:W}),W.onAdd&&W.onAdd(this,b)}}updateImage(b,c){const m=this.style.getImage(b);if(!m)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const C=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:T,height:P}=C;void 0!==T&&void 0!==P?T===m.data.width&&P===m.data.height?(m.data.replace(C.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(b,m)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${T}, ${P})\n                must be that same as the previous version of the image\n                (${m.data.width}, ${m.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b,c){p.getImage(this._requestManager.transformRequest(b,p.ResourceType.Image),(m,C)=>{c(m,C instanceof p.window.HTMLImageElement?p.exported.getImageData(C):C)})}listImages(){return this.style.listImages()}addLayer(b,c){return this._lazyInitEmptyStyle(),this.style.addLayer(b,c),this._update(!0)}moveLayer(b,c){return this.style.moveLayer(b,c),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}setLayerZoomRange(b,c,m){return this.style.setLayerZoomRange(b,c,m),this._update(!0)}setFilter(b,c,m={}){return this.style.setFilter(b,c,m),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,c,m,C={}){return this.style.setPaintProperty(b,c,m,C),this._update(!0)}getPaintProperty(b,c){return this.style.getPaintProperty(b,c)}setLayoutProperty(b,c,m,C={}){return this.style.setLayoutProperty(b,c,m,C),this._update(!0)}getLayoutProperty(b,c){return this.style.getLayoutProperty(b,c)}setLight(b,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(b){return this._lazyInitEmptyStyle(),!b&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(b),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(b){return this._lazyInitEmptyStyle(),this.style.setFog(b),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(b){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(b),this.transform):0}setFeatureState(b,c){return this.style.setFeatureState(b,c),this._update()}removeFeatureState(b,c){return this.style.removeFeatureState(b,c),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}_updateContainerDimensions(){if(!this._container)return;const b=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let m,C,T,P=this._container;for(;P&&(!C||!T);){const F=p.window.getComputedStyle(P).transform;F&&"none"!==F&&(m=F.match(/matrix.*\((.+)\)/)[1].split(", "),m[0]&&"0"!==m[0]&&"1"!==m[0]&&(C=m[0]),m[3]&&"0"!==m[3]&&"1"!==m[3]&&(T=m[3])),P=P.parentElement}this._containerWidth=C?Math.abs(b/C):b,this._containerHeight=T?Math.abs(c/T):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const b=this._container;b.classList.add("mapboxgl-map"),(this._missingCSSCanary=Fe("div","mapboxgl-canary",b)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Fe("div","mapboxgl-canvas-container",b);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Fe("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const m=this._controlContainer=Fe("div","mapboxgl-control-container",b),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{C[T]=Fe("div",`mapboxgl-ctrl-${T}`,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,c){const m=p.exported.devicePixelRatio||1;this._canvas.width=m*Math.ceil(b),this._canvas.height=m*Math.ceil(c),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${c}px`}_addMarker(b){this._markers.push(b)}_removeMarker(b){const c=this._markers.indexOf(b);-1!==c&&this._markers.splice(c,1)}_addPopup(b){this._popups.push(b)}_removePopup(b){const c=this._popups.indexOf(b);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const b=p.extend({},ge.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",b),m=c||this._canvas.getContext("webgl",b)||this._canvas.getContext("experimental-webgl",b);m?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(m,!0),this.painter=new ho(m,this.transform,!!c),this.on("data",C=>{"source"===C.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(m)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:b}))}_onMapScroll(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_requestDomTask(b){!this.loaded()||this.loaded()&&!this.isMoving()?b():this._domRenderTaskQueue.add(b)}_render(b){let c;const m=this.painter.context.extTimerQuery,C=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=m.createQueryEXT(),m.beginQueryEXT(m.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(b),this._domRenderTaskQueue.run(b),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,j=this.transform.pitch,W=p.exported.now(),Y=new p.EvaluationParameters(z,{now:W,fadeDuration:T,pitch:j,transition:this.style.getTransition()});this.style.update(Y)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let P=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),P=this._updateAverageElevation(C),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):P=this._updateAverageElevation(C),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const z=p.exported.now()-C;m.endQueryEXT(m.TIME_ELAPSED_EXT,c),setTimeout(()=>{const j=m.getQueryObjectEXT(c,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:z,gpuTime:j})),p.window.performance.mark("frame-gpu",{startTime:C,detail:{gpuTime:j}})},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(z);this.fire(new p.Event("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(z);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:j}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||P;if(F||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(P=this._updateAverageElevation(C,!0)),P)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(b){for(const c of this._markers)b&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!b||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(b,c=!1){const m=C=>(this.transform.averageElevation=C,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&m(0);if((c||b-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(b)){const C=this.transform.averageElevation;let T=this.transform.sampleAverageElevation(),P=!1;this.transform.elevation&&(P=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=b;const F=Math.abs(C-T);if(F>1){if(this._isInitialLoad||P)return this._averageElevation.jumpTo(T),m(T);this._averageElevation.easeTo(T,b,300)}else if(F>1e-4)return this._averageElevation.jumpTo(T),m(T)}return!!this._averageElevation.isEasing(b)&&m(this._averageElevation.getValue(b))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,b=>{if(b&&(b.message===p.AUTH_ERR_MSG||401===b.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof ku&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const b=this._isDragging();this.painter.updateTerrain(this.style,b)}_calculateSpeedIndex(){const b=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const m=this.painter.context.gl,C=m.createFramebuffer();function T(P){m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,P,0);const F=new Uint8Array(m.drawingBufferWidth*m.drawingBufferHeight*4);return m.readPixels(0,0,m.drawingBufferWidth,m.drawingBufferHeight,m.RGBA,m.UNSIGNED_BYTE,F),F}return m.bindFramebuffer(m.FRAMEBUFFER,C),this._canvasPixelComparison(T(b),c.canvasCopies.map(T),c.timeStamps)}_canvasPixelComparison(b,c,m){let C=m[1]-m[0];const T=b.length/4;for(let P=0;P<c.length;P++){const F=c[P];let z=0;for(let j=0;j<F.length;j+=4)F[j]===b[j]&&F[j+1]===b[j+1]&&F[j+2]===b[j+2]&&F[j+3]===b[j+3]&&(z+=1);C+=(m[P+2]-m[P+1])*(1-z/T)}return C}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(b){this._renderNextFrame=this._renderNextFrame||b,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const m=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,m&&this._render(c)}))}_preloadTiles(b){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(m,C)=>m._preloadTiles(b,C),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(b){this._trackResize&&this.resize({originalEvent:b})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(b){this._showTerrainWireframe!==b&&(this._showTerrainWireframe=b,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(b){this._speedIndexTiming!==b&&(this._speedIndexTiming=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(b){this._showTileAABBs!==b&&(this._showTileAABBs=b,b&&this._update())}_setCacheLimits(b,c){p.setCacheLimits(b,c)}get version(){return p.version}},NavigationControl:class{constructor(b){this.options=p.extend({},Tc,b),this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Fe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Fe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const m=this._map;m&&(this.options.visualizePitch?m.resetNorthPitch({},{originalEvent:c}):m.resetNorth({},{originalEvent:c}))}),this._compassIcon=Fe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const b=this._map;if(!b)return;const c=b.getZoom(),m=c===b.getMaxZoom(),C=c===b.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=C,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",C.toString())}_rotateCompassArrow(){const b=this._map;if(!b)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(b.transform.pitch*(Math.PI/180)),.5)}) rotateX(${b.transform.pitch}deg) rotateZ(${b.transform.angle*(180/Math.PI)}deg)`:`rotate(${b.transform.angle*(180/Math.PI)}deg)`;b._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),b.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&b.on("pitch",this._rotateCompassArrow),b.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ma(b,this._compass,this.options.visualizePitch)),this._container}onRemove(){const b=this._map;b&&(this._container.remove(),this.options.showZoom&&b.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&b.off("pitch",this._rotateCompassArrow),b.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(b,c){const m=Fe("button",b,this._container);return m.type="button",m.addEventListener("click",c),m}_setButtonTitle(b,c){if(!this._map)return;const m=this._map._getUIString(`NavigationControl.${c}`);b.setAttribute("aria-label",m),b.firstElementChild&&b.firstElementChild.setAttribute("title",m)}},GeolocateControl:class extends p.Evented{constructor(b){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Sg,b),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=La(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(b){return this._map=b,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(b){const c=(m=!!this.options.geolocation)=>{this._supportsGeolocation=m,b(m)};void 0!==this._supportsGeolocation?b(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(m=>c("denied"!==m.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(b){const c=this._map.getMaxBounds(),m=b.coords;return!!c&&(m.longitude<c.getWest()||m.longitude>c.getEast()||m.latitude<c.getSouth()||m.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(b),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(b),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",b)),this._finish()}}_updateCamera(b){const c=new p.LngLat(b.coords.longitude,b.coords.latitude),m=b.coords.accuracy,C=this._map.getBearing(),T=p.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(m),T,{geolocateSource:!0})}_updateMarker(b){if(b){const c=new p.LngLat(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const b=this._map.transform,c=p.mercatorZfromAltitude(1,b._center.lat)*b.worldSize,m=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(b){if(this._map){if(this.options.trackUserLocation)if(1===b.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===b.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(b){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Fe("button","mapboxgl-ctrl-geolocate",this._container),Fe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===b){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Fe("div","mapboxgl-user-location"),this._dotElement.appendChild(Fe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Fe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ff({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Fe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ff({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(b){this._userLocationDotMarker&&(b.webkitCompassHeading?this._heading=b.webkitCompassHeading:!0===b.absolute&&(this._heading=-1*b.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let b;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(b={maximumAge:6e5,timeout:0},this._noTimeout=!0):(b=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,b),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const b=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&b()}).catch(console.error):b()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Pl,ScaleControl:class{constructor(b){this.options=p.extend({},Tg,b),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Ig.bind(this)),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const b=this.options.maxWidth||100,c=this._map,m=c._containerHeight/2,C=c._containerWidth/2-b/2,T=c.unproject([C,m]),P=c.unproject([C+b,m]),F=T.distanceTo(P);if("imperial"===this.options.unit){const z=3.2808*F;z>5280?this._setScale(b,z/5280,"mile"):this._setScale(b,z,"foot")}else"nautical"===this.options.unit?this._setScale(b,F/1852,"nautical-mile"):F>=1e3?this._setScale(b,F/1e3,"kilometer"):this._setScale(b,F,"meter")}_setScale(b,c,m){const C=wd(c),T=C/c;this._map._requestDomTask(()=>{this._container.style.width=b*T+"px",this._container.innerHTML="nautical-mile"!==m?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:m}).format(C):`${C}&nbsp;nm`})}onAdd(b){return this._map=b,this._language=b.getLanguage(),this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",b.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(b){this._language=b,this._update()}setUnit(b){this.options.unit=b,this._update()}},FullscreenControl:class{constructor(b){this._fullscreen=!1,b&&b.container&&(b.container instanceof p.window.HTMLElement?this._container=b.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const b=this._fullscreenButton=Fe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Fe("span","mapboxgl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",b)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(b){super(),this.options=p.extend(Object.create(xp),b),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(b&&b.className?b.className.trim().split(/\s+/):[])}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&b.on("preclick",this._onClose),this.options.closeOnMove&&b.on("move",this._onClose),b.on("remove",this.remove),this._update(),b._addPopup(this),this._focusFirstElement(),this._trackPointer?(b.on("mousemove",this._onMouseEvent),b.on("mouseup",this._onMouseEvent),b._canvasContainer.classList.add("mapboxgl-track-pointer")):b.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const b=this._map;return b&&(b.off("move",this._update),b.off("move",this._onClose),b.off("preclick",this._onClose),b.off("click",this._onClose),b.off("remove",this.remove),b.off("mousemove",this._onMouseEvent),b.off("mouseup",this._onMouseEvent),b.off("drag",this._onMouseEvent),b._canvasContainer&&b._canvasContainer.classList.remove("mapboxgl-track-pointer"),b._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(b){this._lngLat=p.LngLat.convert(b),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const b=this._map;return b&&(b.off("move",this._update),b.on("mousemove",this._onMouseEvent),b.on("drag",this._onMouseEvent),b._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(p.window.document.createTextNode(b))}setHTML(b){const c=p.window.document.createDocumentFragment(),m=p.window.document.createElement("body");let C;for(m.innerHTML=b;C=m.firstChild,C;)c.appendChild(C);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Fe("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(b),this.options.closeButton){const m=this._closeButton=Fe("button","mapboxgl-popup-close-button",c);m.type="button",m.setAttribute("aria-label","Close popup"),m.setAttribute("aria-hidden","true"),m.innerHTML="&#215;",m.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(b){return this._classList.add(b),this._updateClassList(),this}removeClassName(b){return this._classList.delete(b),this._updateClassList(),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){let c;return this._classList.delete(b)?c=!1:(this._classList.add(b),c=!0),this._updateClassList(),c}_onMouseEvent(b){this._update(b.point)}_getAnchor(b){if(this.options.anchor)return this.options.anchor;const c=this._map,m=this._container,C=this._pos;if(!c||!m||!C)return"bottom";const T=m.offsetWidth,P=m.offsetHeight,F=C.x<T/2,z=C.x>c.transform.width-T/2;if(C.y+b<P)return F?"top-left":z?"top-right":"top";if(C.y>c.transform.height-P){if(F)return"bottom-left";if(z)return"bottom-right"}return F?"left":z?"right":"bottom"}_updateClassList(){const b=this._container;if(!b)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),b.className=c.join(" ")}_update(b){const c=this._map,m=this._content;if(!c||!this._lngLat&&!this._trackPointer||!m)return;let C=this._container;if(C||(C=this._container=Fe("div","mapboxgl-popup",c.getContainer()),this._tip=Fe("div","mapboxgl-popup-tip",C),C.appendChild(m)),this.options.maxWidth&&C.style.maxWidth!==this.options.maxWidth&&(C.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cf(this._lngLat,this._pos,c.transform)),!this._trackPointer||b){const T=this._pos=this._trackPointer&&b?b:c.project(this._lngLat),P=Bf(this.options.offset),F=this._anchor=this._getAnchor(P.y),z=Bf(this.options.offset,F),j=T.add(z).round();c._requestDomTask(()=>{this._container&&F&&(this._container.style.transform=`${Dh[F]} translate(${j.x}px,${j.y}px)`)})}if(!this._marker&&c._showingGlobe()){const T=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(T)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(wp);b&&b.focus()}_onClose(){this.remove()}_setOpacity(b){this._container&&(this._container.style.opacity=`${b}`),this._content&&(this._content.style.pointerEvents=b?"auto":"none")}},Marker:Ff,Style:ms,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:Dl,Evented:p.Evented,config:p.config,prewarm:function(){_r().acquire(yr)},clearPrewarmedResources:function(){const b=xr;b&&(b.isPreloaded()&&1===b.numActive()?(b.release(yr),xr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(b){p.config.ACCESS_TOKEN=b},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(b){p.config.API_URL=b},get workerCount(){return ir.workerCount},set workerCount(b){ir.workerCount=b},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(b){p.config.MAX_PARALLEL_IMAGE_REQUESTS=b},clearStorage(b){p.clearTileCache(b)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return zf}),de}()},5943:Lt=>{"use strict";var rt=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;function ye(p){if(null==p)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(p)}Lt.exports=function Ce(){try{if(!Object.assign)return!1;var p=new String("abc");if(p[5]="de","5"===Object.getOwnPropertyNames(p)[0])return!1;for(var K={},ge=0;ge<10;ge++)K["_"+String.fromCharCode(ge)]=ge;if("0123456789"!==Object.getOwnPropertyNames(K).map(function(Fe){return K[Fe]}).join(""))return!1;var Pe={};return"abcdefghijklmnopqrst".split("").forEach(function(Fe){Pe[Fe]=Fe}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},Pe)).join("")}catch{return!1}}()?Object.assign:function(p,K){for(var ge,Pe,Te=ye(p),Fe=1;Fe<arguments.length;Fe++){for(var bt in ge=Object(arguments[Fe]))xe.call(ge,bt)&&(Te[bt]=ge[bt]);if(rt){Pe=rt(ge);for(var nt=0;nt<Pe.length;nt++)de.call(ge,Pe[nt])&&(Te[Pe[nt]]=ge[Pe[nt]])}}return Te}},1175:Lt=>{"use strict";var rt=function(xe){return xe!=xe};Lt.exports=function(de,ye){return 0===de&&0===ye?1/de==1/ye:!!(de===ye||rt(de)&&rt(ye))}},2e3:(Lt,rt,xe)=>{"use strict";var de=xe(2358),ye=xe(5685),Ce=xe(1175),p=xe(6305),K=xe(3859),ge=ye(p(),Object);de(ge,{getPolyfill:p,implementation:Ce,shim:K}),Lt.exports=ge},6305:(Lt,rt,xe)=>{"use strict";var de=xe(1175);Lt.exports=function(){return"function"==typeof Object.is?Object.is:de}},3859:(Lt,rt,xe)=>{"use strict";var de=xe(6305),ye=xe(2358);Lt.exports=function(){var p=de();return ye(Object,{is:p},{is:function(){return Object.is!==p}}),p}},2450:(Lt,rt,xe)=>{"use strict";var de;if(!Object.keys){var ye=Object.prototype.hasOwnProperty,Ce=Object.prototype.toString,p=xe(9978),K=Object.prototype.propertyIsEnumerable,ge=!K.call({toString:null},"toString"),Te=K.call(function(){},"prototype"),Pe=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Fe=function(dt){var Rt=dt.constructor;return Rt&&Rt.prototype===dt},bt={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},nt=function(){if(typeof window>"u")return!1;for(var dt in window)try{if(!bt["$"+dt]&&ye.call(window,dt)&&null!==window[dt]&&"object"==typeof window[dt])try{Fe(window[dt])}catch{return!0}}catch{return!0}return!1}();de=function(Rt){var ae=null!==Rt&&"object"==typeof Rt,X="[object Function]"===Ce.call(Rt),re=p(Rt),Q=ae&&"[object String]"===Ce.call(Rt),te=[];if(!ae&&!X&&!re)throw new TypeError("Object.keys called on a non-object");var ue=Te&&X;if(Q&&Rt.length>0&&!ye.call(Rt,0))for(var oe=0;oe<Rt.length;++oe)te.push(String(oe));if(re&&Rt.length>0)for(var le=0;le<Rt.length;++le)te.push(String(le));else for(var me in Rt)(!ue||"prototype"!==me)&&ye.call(Rt,me)&&te.push(String(me));if(ge)for(var ne=function(dt){if(typeof window>"u"||!nt)return Fe(dt);try{return Fe(dt)}catch{return!1}}(Rt),ct=0;ct<Pe.length;++ct)(!ne||"constructor"!==Pe[ct])&&ye.call(Rt,Pe[ct])&&te.push(Pe[ct]);return te}}Lt.exports=de},1356:(Lt,rt,xe)=>{"use strict";var de=Array.prototype.slice,ye=xe(9978),Ce=Object.keys,p=Ce?function(Te){return Ce(Te)}:xe(2450),K=Object.keys;p.shim=function(){if(Object.keys){var Te=function(){var Pe=Object.keys(arguments);return Pe&&Pe.length===arguments.length}(1,2);Te||(Object.keys=function(Fe){return ye(Fe)?K(de.call(Fe)):K(Fe)})}else Object.keys=p;return Object.keys||p},Lt.exports=p},9978:Lt=>{"use strict";var rt=Object.prototype.toString;Lt.exports=function(de){var ye=rt.call(de),Ce="[object Arguments]"===ye;return Ce||(Ce="[object Array]"!==ye&&null!==de&&"object"==typeof de&&"number"==typeof de.length&&de.length>=0&&"[object Function]"===rt.call(de.callee)),Ce}},1766:Lt=>{Lt.exports=function(xe,de,ye,Ce){var p=xe[0],K=xe[1],ge=!1;void 0===ye&&(ye=0),void 0===Ce&&(Ce=de.length);for(var Te=(Ce-ye)/2,Pe=0,Fe=Te-1;Pe<Te;Fe=Pe++){var bt=de[ye+2*Pe+0],nt=de[ye+2*Pe+1],dt=de[ye+2*Fe+1];nt>K!=dt>K&&p<(de[ye+2*Fe+0]-bt)*(K-nt)/(dt-nt)+bt&&(ge=!ge)}return ge}},3870:(Lt,rt,xe)=>{var de=xe(1766),ye=xe(2260);Lt.exports=function(p,K,ge,Te){return K.length>0&&Array.isArray(K[0])?ye(p,K,ge,Te):de(p,K,ge,Te)},Lt.exports.nested=ye,Lt.exports.flat=de},2260:Lt=>{Lt.exports=function(xe,de,ye,Ce){var p=xe[0],K=xe[1],ge=!1;void 0===ye&&(ye=0),void 0===Ce&&(Ce=de.length);for(var Te=Ce-ye,Pe=0,Fe=Te-1;Pe<Te;Fe=Pe++){var bt=de[Pe+ye][0],nt=de[Pe+ye][1],dt=de[Fe+ye][1];nt>K!=dt>K&&p<(de[Fe+ye][0]-bt)*(K-nt)/(dt-nt)+bt&&(ge=!ge)}return ge}},9855:function(Lt){Lt.exports=function(){"use strict";function rt(Nt,Le){if(!(Nt instanceof Le))throw new TypeError("Cannot call a class as a function")}function xe(Nt,Le){for(var De=0;De<Le.length;De++){var Me=Le[De];Me.enumerable=Me.enumerable||!1,Me.configurable=!0,"value"in Me&&(Me.writable=!0),Object.defineProperty(Nt,Me.key,Me)}}function de(Nt,Le,De){return Le&&xe(Nt.prototype,Le),De&&xe(Nt,De),Nt}var ye=function Nt(Le,De){this.next=null,this.key=Le,this.data=De,this.left=null,this.right=null};function Ce(Nt,Le){return Nt>Le?1:Nt<Le?-1:0}function p(Nt,Le,De){for(var Me=new ye(null,null),Ke=Me,St=Me;;){var Jt=De(Nt,Le.key);if(Jt<0){if(null===Le.left)break;if(De(Nt,Le.left.key)<0&&(Le.left=(En=Le.left).right,En.right=Le,null===(Le=En).left))break;St.left=Le,St=Le,Le=Le.left}else{if(!(Jt>0))break;if(null===Le.right)break;var En;if(De(Nt,Le.right.key)>0&&(Le.right=(En=Le.right).left,En.left=Le,null===(Le=En).right))break;Ke.right=Le,Ke=Le,Le=Le.right}}return Ke.right=Le.left,St.left=Le.right,Le.left=Me.right,Le.right=Me.left,Le}function K(Nt,Le,De,Me){var Ke=new ye(Nt,Le);if(null===De)return Ke.left=Ke.right=null,Ke;var St=Me(Nt,(De=p(Nt,De,Me)).key);return St<0?(Ke.left=De.left,Ke.right=De,De.left=null):St>=0&&(Ke.right=De.right,Ke.left=De,De.right=null),Ke}function ge(Nt,Le,De){var Me=null,Ke=null;if(Le){var St=De((Le=p(Nt,Le,De)).key,Nt);0===St?(Me=Le.left,Ke=Le.right):St<0?(Ke=Le.right,Le.right=null,Me=Le):(Me=Le.left,Le.left=null,Ke=Le)}return{left:Me,right:Ke}}function Pe(Nt,Le,De,Me,Ke){if(Nt){Me(Le+(De?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+Ke(Nt)+"\n");var St=Le+(De?"    ":"\u2502   ");Nt.left&&Pe(Nt.left,St,!1,Me,Ke),Nt.right&&Pe(Nt.right,St,!0,Me,Ke)}}var Fe=function(){function Nt(Le){void 0===Le&&(Le=Ce),this._root=null,this._size=0,this._comparator=Le}return Nt.prototype.insert=function(Le,De){return this._size++,this._root=K(Le,De,this._root,this._comparator)},Nt.prototype.add=function(Le,De){var Me=new ye(Le,De);null===this._root&&(Me.left=Me.right=null,this._size++,this._root=Me);var Ke=this._comparator,St=p(Le,this._root,Ke),Jt=Ke(Le,St.key);return 0===Jt?this._root=St:(Jt<0?(Me.left=St.left,Me.right=St,St.left=null):Jt>0&&(Me.right=St.right,Me.left=St,St.right=null),this._size++,this._root=Me),this._root},Nt.prototype.remove=function(Le){this._root=this._remove(Le,this._root,this._comparator)},Nt.prototype._remove=function(Le,De,Me){var Ke;return null===De?null:0===Me(Le,(De=p(Le,De,Me)).key)?(null===De.left?Ke=De.right:(Ke=p(Le,De.left,Me)).right=De.right,this._size--,Ke):De},Nt.prototype.pop=function(){var Le=this._root;if(Le){for(;Le.left;)Le=Le.left;return this._root=p(Le.key,this._root,this._comparator),this._root=this._remove(Le.key,this._root,this._comparator),{key:Le.key,data:Le.data}}return null},Nt.prototype.findStatic=function(Le){for(var De=this._root,Me=this._comparator;De;){var Ke=Me(Le,De.key);if(0===Ke)return De;De=Ke<0?De.left:De.right}return null},Nt.prototype.find=function(Le){return this._root&&(this._root=p(Le,this._root,this._comparator),0!==this._comparator(Le,this._root.key))?null:this._root},Nt.prototype.contains=function(Le){for(var De=this._root,Me=this._comparator;De;){var Ke=Me(Le,De.key);if(0===Ke)return!0;De=Ke<0?De.left:De.right}return!1},Nt.prototype.forEach=function(Le,De){for(var Me=this._root,Ke=[],St=!1;!St;)null!==Me?(Ke.push(Me),Me=Me.left):0!==Ke.length?(Me=Ke.pop(),Le.call(De,Me),Me=Me.right):St=!0;return this},Nt.prototype.range=function(Le,De,Me,Ke){for(var St=[],Jt=this._comparator,En=this._root;0!==St.length||En;)if(En)St.push(En),En=En.left;else{if(Jt((En=St.pop()).key,De)>0)break;if(Jt(En.key,Le)>=0&&Me.call(Ke,En))return this;En=En.right}return this},Nt.prototype.keys=function(){var Le=[];return this.forEach(function(De){return Le.push(De.key)}),Le},Nt.prototype.values=function(){var Le=[];return this.forEach(function(De){return Le.push(De.data)}),Le},Nt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Nt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Nt.prototype.minNode=function(Le){if(void 0===Le&&(Le=this._root),Le)for(;Le.left;)Le=Le.left;return Le},Nt.prototype.maxNode=function(Le){if(void 0===Le&&(Le=this._root),Le)for(;Le.right;)Le=Le.right;return Le},Nt.prototype.at=function(Le){for(var De=this._root,Me=!1,Ke=0,St=[];!Me;)if(De)St.push(De),De=De.left;else if(St.length>0){if(De=St.pop(),Ke===Le)return De;Ke++,De=De.right}else Me=!0;return null},Nt.prototype.next=function(Le){var De=this._root,Me=null;if(Le.right){for(Me=Le.right;Me.left;)Me=Me.left;return Me}for(var Ke=this._comparator;De;){var St=Ke(Le.key,De.key);if(0===St)break;St<0?(Me=De,De=De.left):De=De.right}return Me},Nt.prototype.prev=function(Le){var De=this._root,Me=null;if(null!==Le.left){for(Me=Le.left;Me.right;)Me=Me.right;return Me}for(var Ke=this._comparator;De;){var St=Ke(Le.key,De.key);if(0===St)break;St<0?De=De.left:(Me=De,De=De.right)}return Me},Nt.prototype.clear=function(){return this._root=null,this._size=0,this},Nt.prototype.toList=function(){return function He(Nt){for(var Le=Nt,De=[],Me=!1,Ke=new ye(null,null),St=Ke;!Me;)Le?(De.push(Le),Le=Le.left):De.length>0?Le=(Le=St=St.next=De.pop()).right:Me=!0;return St.next=null,Ke.next}(this._root)},Nt.prototype.load=function(Le,De,Me){void 0===De&&(De=[]),void 0===Me&&(Me=!1);var Ke=Le.length,St=this._comparator;if(Me&&ae(Le,De,0,Ke-1,St),null===this._root)this._root=bt(Le,De,0,Ke),this._size=Ke;else{var Jt=function Rt(Nt,Le,De){for(var Me=new ye(null,null),Ke=Me,St=Nt,Jt=Le;null!==St&&null!==Jt;)De(St.key,Jt.key)<0?(Ke.next=St,St=St.next):(Ke.next=Jt,Jt=Jt.next),Ke=Ke.next;return null!==St?Ke.next=St:null!==Jt&&(Ke.next=Jt),Me.next}(this.toList(),function nt(Nt,Le){for(var De=new ye(null,null),Me=De,Ke=0;Ke<Nt.length;Ke++)Me=Me.next=new ye(Nt[Ke],Le[Ke]);return Me.next=null,De.next}(Le,De),St);this._root=dt({head:Jt},0,Ke=this._size+Ke)}return this},Nt.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(Nt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Nt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Nt.prototype.toString=function(Le){void 0===Le&&(Le=function(Ke){return String(Ke.key)});var De=[];return Pe(this._root,"",!0,function(Me){return De.push(Me)},Le),De.join("")},Nt.prototype.update=function(Le,De,Me){var Ke=this._comparator,St=ge(Le,this._root,Ke),Jt=St.left,En=St.right;Ke(Le,De)<0?En=K(De,Me,En,Ke):Jt=K(De,Me,Jt,Ke),this._root=function Te(Nt,Le,De){return null===Le?Nt:(null===Nt||((Le=p(Nt.key,Le,De)).left=Nt),Le)}(Jt,En,Ke)},Nt.prototype.split=function(Le){return ge(Le,this._root,this._comparator)},Nt}();function bt(Nt,Le,De,Me){var Ke=Me-De;if(Ke>0){var St=De+Math.floor(Ke/2),vn=new ye(Nt[St],Le[St]);return vn.left=bt(Nt,Le,De,St),vn.right=bt(Nt,Le,St+1,Me),vn}return null}function dt(Nt,Le,De){var Me=De-Le;if(Me>0){var Ke=Le+Math.floor(Me/2),St=dt(Nt,Le,Ke),Jt=Nt.head;return Jt.left=St,Nt.head=Nt.head.next,Jt.right=dt(Nt,Ke+1,De),Jt}return null}function ae(Nt,Le,De,Me,Ke){if(!(De>=Me)){for(var St=Nt[De+Me>>1],Jt=De-1,En=Me+1;;){do{Jt++}while(Ke(Nt[Jt],St)<0);do{En--}while(Ke(Nt[En],St)>0);if(Jt>=En)break;var vn=Nt[Jt];Nt[Jt]=Nt[En],Nt[En]=vn,vn=Le[Jt],Le[Jt]=Le[En],Le[En]=vn}ae(Nt,Le,De,En,Ke),ae(Nt,Le,En+1,Me,Ke)}}var X=function(Le,De){return Le.ll.x<=De.x&&De.x<=Le.ur.x&&Le.ll.y<=De.y&&De.y<=Le.ur.y},re=function(Le,De){return De.ur.x<Le.ll.x||Le.ur.x<De.ll.x||De.ur.y<Le.ll.y||Le.ur.y<De.ll.y?null:{ll:{x:Le.ll.x<De.ll.x?De.ll.x:Le.ll.x,y:Le.ll.y<De.ll.y?De.ll.y:Le.ll.y},ur:{x:Le.ur.x<De.ur.x?Le.ur.x:De.ur.x,y:Le.ur.y<De.ur.y?Le.ur.y:De.ur.y}}},Q=Number.EPSILON;void 0===Q&&(Q=Math.pow(2,-52));var te=Q*Q,ue=function(Le,De){if(-Q<Le&&Le<Q&&-Q<De&&De<Q)return 0;var Me=Le-De;return Me*Me<te*Le*De?0:Le<De?-1:1},oe=function(){function Nt(){rt(this,Nt),this.reset()}return de(Nt,[{key:"reset",value:function(){this.xRounder=new le,this.yRounder=new le}},{key:"round",value:function(De,Me){return{x:this.xRounder.round(De),y:this.yRounder.round(Me)}}}]),Nt}(),le=function(){function Nt(){rt(this,Nt),this.tree=new Fe,this.round(0)}return de(Nt,[{key:"round",value:function(De){var Me=this.tree.add(De),Ke=this.tree.prev(Me);if(null!==Ke&&0===ue(Me.key,Ke.key))return this.tree.remove(De),Ke.key;var St=this.tree.next(Me);return null!==St&&0===ue(Me.key,St.key)?(this.tree.remove(De),St.key):De}}]),Nt}(),me=new oe,ne=function(Le,De){return Le.x*De.y-Le.y*De.x},ct=function(Le,De){return Le.x*De.x+Le.y*De.y},je=function(Le,De,Me){var Jt=ne({x:De.x-Le.x,y:De.y-Le.y},{x:Me.x-Le.x,y:Me.y-Le.y});return ue(Jt,0)},We=function(Le){return Math.sqrt(ct(Le,Le))},Se=function(Le,De,Me){var Ke={x:De.x-Le.x,y:De.y-Le.y},St={x:Me.x-Le.x,y:Me.y-Le.y};return ne(St,Ke)/We(St)/We(Ke)},ln=function(Le,De,Me){var Ke={x:De.x-Le.x,y:De.y-Le.y},St={x:Me.x-Le.x,y:Me.y-Le.y};return ct(St,Ke)/We(St)/We(Ke)},Bt=function(Le,De,Me){return 0===De.y?null:{x:Le.x+De.x/De.y*(Me-Le.y),y:Me}},$e=function(Le,De,Me){return 0===De.x?null:{x:Me,y:Le.y+De.y/De.x*(Me-Le.x)}},Xe=function(){function Nt(Le,De){rt(this,Nt),void 0===Le.events?Le.events=[this]:Le.events.push(this),this.point=Le,this.isLeft=De}return de(Nt,null,[{key:"compare",value:function(De,Me){var Ke=Nt.comparePoints(De.point,Me.point);return 0!==Ke?Ke:(De.point!==Me.point&&De.link(Me),De.isLeft!==Me.isLeft?De.isLeft?1:-1:xt.compare(De.segment,Me.segment))}},{key:"comparePoints",value:function(De,Me){return De.x<Me.x?-1:De.x>Me.x?1:De.y<Me.y?-1:De.y>Me.y?1:0}}]),de(Nt,[{key:"link",value:function(De){if(De.point===this.point)throw new Error("Tried to link already linked events");for(var Me=De.point.events,Ke=0,St=Me.length;Ke<St;Ke++){var Jt=Me[Ke];this.point.events.push(Jt),Jt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var De=this.point.events.length,Me=0;Me<De;Me++){var Ke=this.point.events[Me];if(void 0===Ke.segment.consumedBy)for(var St=Me+1;St<De;St++){var Jt=this.point.events[St];void 0===Jt.consumedBy&&Ke.otherSE.point.events===Jt.otherSE.point.events&&Ke.segment.consume(Jt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var De=[],Me=0,Ke=this.point.events.length;Me<Ke;Me++){var St=this.point.events[Me];St!==this&&!St.segment.ringOut&&St.segment.isInResult()&&De.push(St)}return De}},{key:"getLeftmostComparator",value:function(De){var Me=this,Ke=new Map,St=function(En){var vn=En.otherSE;Ke.set(En,{sine:Se(Me.point,De.point,vn.point),cosine:ln(Me.point,De.point,vn.point)})};return function(Jt,En){Ke.has(Jt)||St(Jt),Ke.has(En)||St(En);var vn=Ke.get(Jt),un=vn.sine,kr=vn.cosine,Xr=Ke.get(En),kn=Xr.sine,ri=Xr.cosine;return un>=0&&kn>=0?kr<ri?1:kr>ri?-1:0:un<0&&kn<0?kr<ri?-1:kr>ri?1:0:kn<un?-1:kn>un?1:0}}}]),Nt}(),gt=0,xt=function(){function Nt(Le,De,Me,Ke){rt(this,Nt),this.id=++gt,this.leftSE=Le,Le.segment=this,Le.otherSE=De,this.rightSE=De,De.segment=this,De.otherSE=Le,this.rings=Me,this.windings=Ke}return de(Nt,null,[{key:"compare",value:function(De,Me){var Ke=De.leftSE.point.x,St=Me.leftSE.point.x,Jt=De.rightSE.point.x,En=Me.rightSE.point.x;if(En<Ke)return 1;if(Jt<St)return-1;var vn=De.leftSE.point.y,un=Me.leftSE.point.y,kr=De.rightSE.point.y,Xr=Me.rightSE.point.y;if(Ke<St){if(un<vn&&un<kr)return 1;if(un>vn&&un>kr)return-1;var kn=De.comparePoint(Me.leftSE.point);if(kn<0)return 1;if(kn>0)return-1;var ri=Me.comparePoint(De.rightSE.point);return 0!==ri?ri:-1}if(Ke>St){if(vn<un&&vn<Xr)return-1;if(vn>un&&vn>Xr)return 1;var Hi=Me.comparePoint(De.leftSE.point);if(0!==Hi)return Hi;var li=De.comparePoint(Me.rightSE.point);return li<0?1:li>0?-1:1}if(vn<un)return-1;if(vn>un)return 1;if(Jt<En){var gi=Me.comparePoint(De.rightSE.point);if(0!==gi)return gi}if(Jt>En){var oo=De.comparePoint(Me.rightSE.point);if(oo<0)return 1;if(oo>0)return-1}if(Jt!==En){var xo=kr-vn,eo=Jt-Ke,wo=Xr-un,Bs=En-St;if(xo>eo&&wo<Bs)return 1;if(xo<eo&&wo>Bs)return-1}return Jt>En?1:Jt<En||kr<Xr?-1:kr>Xr?1:De.id<Me.id?-1:De.id>Me.id?1:0}}]),de(Nt,[{key:"replaceRightSE",value:function(De){this.rightSE=De,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var De=this.leftSE.point.y,Me=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:De<Me?De:Me},ur:{x:this.rightSE.point.x,y:De>Me?De:Me}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(De){return De.x===this.leftSE.point.x&&De.y===this.leftSE.point.y||De.x===this.rightSE.point.x&&De.y===this.rightSE.point.y}},{key:"comparePoint",value:function(De){if(this.isAnEndpoint(De))return 0;var Me=this.leftSE.point,Ke=this.rightSE.point,St=this.vector();if(Me.x===Ke.x)return De.x===Me.x?0:De.x<Me.x?1:-1;if(De.x===Me.x+(De.y-Me.y)/St.y*St.x)return 0;var un=Me.y+(De.x-Me.x)/St.x*St.y;return De.y===un?0:De.y<un?-1:1}},{key:"getIntersection",value:function(De){var Me=this.bbox(),Ke=De.bbox(),St=re(Me,Ke);if(null===St)return null;var Jt=this.leftSE.point,En=this.rightSE.point,vn=De.leftSE.point,un=De.rightSE.point,kr=X(Me,vn)&&0===this.comparePoint(vn),Xr=X(Ke,Jt)&&0===De.comparePoint(Jt),kn=X(Me,un)&&0===this.comparePoint(un),ri=X(Ke,En)&&0===De.comparePoint(En);if(Xr&&kr)return ri&&!kn?En:!ri&&kn?un:null;if(Xr)return kn&&Jt.x===un.x&&Jt.y===un.y?null:Jt;if(kr)return ri&&En.x===vn.x&&En.y===vn.y?null:vn;if(ri&&kn)return null;if(ri)return En;if(kn)return un;var Hi=function(Le,De,Me,Ke){if(0===De.x)return $e(Me,Ke,Le.x);if(0===Ke.x)return $e(Le,De,Me.x);if(0===De.y)return Bt(Me,Ke,Le.y);if(0===Ke.y)return Bt(Le,De,Me.y);var St=ne(De,Ke);if(0==St)return null;var Jt={x:Me.x-Le.x,y:Me.y-Le.y},En=ne(Jt,De)/St,vn=ne(Jt,Ke)/St;return{x:(Le.x+vn*De.x+(Me.x+En*Ke.x))/2,y:(Le.y+vn*De.y+(Me.y+En*Ke.y))/2}}(Jt,this.vector(),vn,De.vector());return null!==Hi&&X(St,Hi)?me.round(Hi.x,Hi.y):null}},{key:"split",value:function(De){var Me=[],Ke=void 0!==De.events,St=new Xe(De,!0),Jt=new Xe(De,!1),En=this.rightSE;this.replaceRightSE(Jt),Me.push(Jt),Me.push(St);var vn=new Nt(St,En,this.rings.slice(),this.windings.slice());return Xe.comparePoints(vn.leftSE.point,vn.rightSE.point)>0&&vn.swapEvents(),Xe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ke&&(St.checkForConsuming(),Jt.checkForConsuming()),Me}},{key:"swapEvents",value:function(){var De=this.rightSE;this.rightSE=this.leftSE,this.leftSE=De,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Me=0,Ke=this.windings.length;Me<Ke;Me++)this.windings[Me]*=-1}},{key:"consume",value:function(De){for(var Me=this,Ke=De;Me.consumedBy;)Me=Me.consumedBy;for(;Ke.consumedBy;)Ke=Ke.consumedBy;var St=Nt.compare(Me,Ke);if(0!==St){if(St>0){var Jt=Me;Me=Ke,Ke=Jt}if(Me.prev===Ke){var En=Me;Me=Ke,Ke=En}for(var vn=0,un=Ke.rings.length;vn<un;vn++){var kr=Ke.rings[vn],Xr=Ke.windings[vn],kn=Me.rings.indexOf(kr);-1===kn?(Me.rings.push(kr),Me.windings.push(Xr)):Me.windings[kn]+=Xr}Ke.rings=null,Ke.windings=null,Ke.consumedBy=Me,Ke.leftSE.consumedBy=Me.leftSE,Ke.rightSE.consumedBy=Me.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var De=this.beforeState();this._afterState={rings:De.rings.slice(0),windings:De.windings.slice(0),multiPolys:[]};for(var Me=this._afterState.rings,Ke=this._afterState.windings,St=this._afterState.multiPolys,Jt=0,En=this.rings.length;Jt<En;Jt++){var vn=this.rings[Jt],un=this.windings[Jt],kr=Me.indexOf(vn);-1===kr?(Me.push(vn),Ke.push(un)):Ke[kr]+=un}for(var Xr=[],kn=[],ri=0,Hi=Me.length;ri<Hi;ri++)if(0!==Ke[ri]){var li=Me[ri],gi=li.poly;if(-1===kn.indexOf(gi))if(li.isExterior)Xr.push(gi);else{-1===kn.indexOf(gi)&&kn.push(gi);var oo=Xr.indexOf(li.poly);-1!==oo&&Xr.splice(oo,1)}}for(var xo=0,eo=Xr.length;xo<eo;xo++){var wo=Xr[xo].multiPoly;-1===St.indexOf(wo)&&St.push(wo)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var De=this.beforeState().multiPolys,Me=this.afterState().multiPolys;switch(Rn.type){case"union":this._isInResult=0===De.length!=(0===Me.length);break;case"intersection":var Jt,En;De.length<Me.length?(Jt=De.length,En=Me.length):(Jt=Me.length,En=De.length),this._isInResult=En===Rn.numMultiPolys&&Jt<En;break;case"xor":var vn=Math.abs(De.length-Me.length);this._isInResult=vn%2==1;break;case"difference":var un=function(Xr){return 1===Xr.length&&Xr[0].isSubject};this._isInResult=un(De)!==un(Me);break;default:throw new Error("Unrecognized operation type found ".concat(Rn.type))}return this._isInResult}}],[{key:"fromRing",value:function(De,Me,Ke){var St,Jt,En,vn=Xe.comparePoints(De,Me);if(vn<0)St=De,Jt=Me,En=1;else{if(!(vn>0))throw new Error("Tried to create degenerate segment at [".concat(De.x,", ").concat(De.y,"]"));St=Me,Jt=De,En=-1}return new Nt(new Xe(St,!0),new Xe(Jt,!1),[Ke],[En])}}]),Nt}(),Be=function(){function Nt(Le,De,Me){if(rt(this,Nt),!Array.isArray(Le)||0===Le.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=De,this.isExterior=Me,this.segments=[],"number"!=typeof Le[0][0]||"number"!=typeof Le[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ke=me.round(Le[0][0],Le[0][1]);this.bbox={ll:{x:Ke.x,y:Ke.y},ur:{x:Ke.x,y:Ke.y}};for(var St=Ke,Jt=1,En=Le.length;Jt<En;Jt++){if("number"!=typeof Le[Jt][0]||"number"!=typeof Le[Jt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var vn=me.round(Le[Jt][0],Le[Jt][1]);vn.x===St.x&&vn.y===St.y||(this.segments.push(xt.fromRing(St,vn,this)),vn.x<this.bbox.ll.x&&(this.bbox.ll.x=vn.x),vn.y<this.bbox.ll.y&&(this.bbox.ll.y=vn.y),vn.x>this.bbox.ur.x&&(this.bbox.ur.x=vn.x),vn.y>this.bbox.ur.y&&(this.bbox.ur.y=vn.y),St=vn)}(Ke.x!==St.x||Ke.y!==St.y)&&this.segments.push(xt.fromRing(St,Ke,this))}return de(Nt,[{key:"getSweepEvents",value:function(){for(var De=[],Me=0,Ke=this.segments.length;Me<Ke;Me++){var St=this.segments[Me];De.push(St.leftSE),De.push(St.rightSE)}return De}}]),Nt}(),qt=function(){function Nt(Le,De){if(rt(this,Nt),!Array.isArray(Le))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Be(Le[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Me=1,Ke=Le.length;Me<Ke;Me++){var St=new Be(Le[Me],this,!1);St.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=St.bbox.ll.x),St.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=St.bbox.ll.y),St.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=St.bbox.ur.x),St.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=St.bbox.ur.y),this.interiorRings.push(St)}this.multiPoly=De}return de(Nt,[{key:"getSweepEvents",value:function(){for(var De=this.exteriorRing.getSweepEvents(),Me=0,Ke=this.interiorRings.length;Me<Ke;Me++)for(var St=this.interiorRings[Me].getSweepEvents(),Jt=0,En=St.length;Jt<En;Jt++)De.push(St[Jt]);return De}}]),Nt}(),$t=function(){function Nt(Le,De){if(rt(this,Nt),!Array.isArray(Le))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof Le[0][0][0]&&(Le=[Le])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Me=0,Ke=Le.length;Me<Ke;Me++){var St=new qt(Le[Me],this);St.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=St.bbox.ll.x),St.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=St.bbox.ll.y),St.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=St.bbox.ur.x),St.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=St.bbox.ur.y),this.polys.push(St)}this.isSubject=De}return de(Nt,[{key:"getSweepEvents",value:function(){for(var De=[],Me=0,Ke=this.polys.length;Me<Ke;Me++)for(var St=this.polys[Me].getSweepEvents(),Jt=0,En=St.length;Jt<En;Jt++)De.push(St[Jt]);return De}}]),Nt}(),pn=function(){function Nt(Le){rt(this,Nt),this.events=Le;for(var De=0,Me=Le.length;De<Me;De++)Le[De].segment.ringOut=this;this.poly=null}return de(Nt,null,[{key:"factory",value:function(De){for(var Me=[],Ke=0,St=De.length;Ke<St;Ke++){var Jt=De[Ke];if(Jt.isInResult()&&!Jt.ringOut){for(var En=null,vn=Jt.leftSE,un=Jt.rightSE,kr=[vn],Xr=vn.point,kn=[];En=vn,kr.push(vn=un),vn.point!==Xr;)for(;;){var ri=vn.getAvailableLinkedEvents();if(0===ri.length){var Hi=kr[0].point,li=kr[kr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Hi.x,",")+" ".concat(Hi.y,"]. Last matching segment found ends at")+" [".concat(li.x,", ").concat(li.y,"]."))}if(1===ri.length){un=ri[0].otherSE;break}for(var gi=null,oo=0,xo=kn.length;oo<xo;oo++)if(kn[oo].point===vn.point){gi=oo;break}if(null===gi){kn.push({index:kr.length,point:vn.point});var Bs=vn.getLeftmostComparator(En);un=ri.sort(Bs)[0].otherSE;break}var eo=kn.splice(gi)[0],wo=kr.splice(eo.index);wo.unshift(wo[0].otherSE),Me.push(new Nt(wo.reverse()))}Me.push(new Nt(kr))}}return Me}}]),de(Nt,[{key:"getGeom",value:function(){for(var De=this.events[0].point,Me=[De],Ke=1,St=this.events.length-1;Ke<St;Ke++){var Jt=this.events[Ke].point;0!==je(Jt,De,this.events[Ke+1].point)&&(Me.push(Jt),De=Jt)}if(1===Me.length)return null;0===je(Me[0],De,Me[1])&&Me.shift(),Me.push(Me[0]);for(var kr=this.isExteriorRing()?1:-1,Xr=this.isExteriorRing()?0:Me.length-1,kn=this.isExteriorRing()?Me.length:-1,ri=[],Hi=Xr;Hi!=kn;Hi+=kr)ri.push([Me[Hi].x,Me[Hi].y]);return ri}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var De=this.enclosingRing();this._isExteriorRing=!De||!De.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var De=this.events[0],Me=1,Ke=this.events.length;Me<Ke;Me++){var St=this.events[Me];Xe.compare(De,St)>0&&(De=St)}for(var Jt=De.segment.prevInResult(),En=Jt?Jt.prevInResult():null;;){if(!Jt)return null;if(!En)return Jt.ringOut;if(En.ringOut!==Jt.ringOut)return En.ringOut.enclosingRing()!==Jt.ringOut?Jt.ringOut:Jt.ringOut.enclosingRing();Jt=En.prevInResult(),En=Jt?Jt.prevInResult():null}}}]),Nt}(),At=function(){function Nt(Le){rt(this,Nt),this.exteriorRing=Le,Le.poly=this,this.interiorRings=[]}return de(Nt,[{key:"addInterior",value:function(De){this.interiorRings.push(De),De.poly=this}},{key:"getGeom",value:function(){var De=[this.exteriorRing.getGeom()];if(null===De[0])return null;for(var Me=0,Ke=this.interiorRings.length;Me<Ke;Me++){var St=this.interiorRings[Me].getGeom();null!==St&&De.push(St)}return De}}]),Nt}(),Sn=function(){function Nt(Le){rt(this,Nt),this.rings=Le,this.polys=this._composePolys(Le)}return de(Nt,[{key:"getGeom",value:function(){for(var De=[],Me=0,Ke=this.polys.length;Me<Ke;Me++){var St=this.polys[Me].getGeom();null!==St&&De.push(St)}return De}},{key:"_composePolys",value:function(De){for(var Me=[],Ke=0,St=De.length;Ke<St;Ke++){var Jt=De[Ke];if(!Jt.poly)if(Jt.isExteriorRing())Me.push(new At(Jt));else{var En=Jt.enclosingRing();En.poly||Me.push(new At(En)),En.poly.addInterior(Jt)}}return Me}}]),Nt}(),Yn=function(){function Nt(Le){var De=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xt.compare;rt(this,Nt),this.queue=Le,this.tree=new Fe(De),this.segments=[]}return de(Nt,[{key:"process",value:function(De){var Me=De.segment,Ke=[];if(De.consumedBy)return De.isLeft?this.queue.remove(De.otherSE):this.tree.remove(Me),Ke;var St=De.isLeft?this.tree.insert(Me):this.tree.find(Me);if(!St)throw new Error("Unable to find segment #".concat(Me.id," ")+"[".concat(Me.leftSE.point.x,", ").concat(Me.leftSE.point.y,"] -> ")+"[".concat(Me.rightSE.point.x,", ").concat(Me.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Jt=St,En=St,vn=void 0,un=void 0;void 0===vn;)null===(Jt=this.tree.prev(Jt))?vn=null:void 0===Jt.key.consumedBy&&(vn=Jt.key);for(;void 0===un;)null===(En=this.tree.next(En))?un=null:void 0===En.key.consumedBy&&(un=En.key);if(De.isLeft){var kr=null;if(vn){var Xr=vn.getIntersection(Me);if(null!==Xr&&(Me.isAnEndpoint(Xr)||(kr=Xr),!vn.isAnEndpoint(Xr)))for(var kn=this._splitSafely(vn,Xr),ri=0,Hi=kn.length;ri<Hi;ri++)Ke.push(kn[ri])}var li=null;if(un){var gi=un.getIntersection(Me);if(null!==gi&&(Me.isAnEndpoint(gi)||(li=gi),!un.isAnEndpoint(gi)))for(var oo=this._splitSafely(un,gi),xo=0,eo=oo.length;xo<eo;xo++)Ke.push(oo[xo])}if(null!==kr||null!==li){var wo;wo=null===kr?li:null===li||Xe.comparePoints(kr,li)<=0?kr:li,this.queue.remove(Me.rightSE),Ke.push(Me.rightSE);for(var Li=Me.split(wo),ra=0,Ls=Li.length;ra<Ls;ra++)Ke.push(Li[ra])}Ke.length>0?(this.tree.remove(Me),Ke.push(De)):(this.segments.push(Me),Me.prev=vn)}else{if(vn&&un){var Tn=vn.getIntersection(un);if(null!==Tn){if(!vn.isAnEndpoint(Tn))for(var il=this._splitSafely(vn,Tn),va=0,Fr=il.length;va<Fr;va++)Ke.push(il[va]);if(!un.isAnEndpoint(Tn))for(var Ua=this._splitSafely(un,Tn),Is=0,Va=Ua.length;Is<Va;Is++)Ke.push(Ua[Is])}}this.tree.remove(Me)}return Ke}},{key:"_splitSafely",value:function(De,Me){this.tree.remove(De);var Ke=De.rightSE;this.queue.remove(Ke);var St=De.split(Me);return St.push(Ke),void 0===De.consumedBy&&this.tree.insert(De),St}}]),Nt}(),Kn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,pr=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Rn=new(function(){function Nt(){rt(this,Nt)}return de(Nt,[{key:"run",value:function(De,Me,Ke){Rn.type=De,me.reset();for(var St=[new $t(Me,!0)],Jt=0,En=Ke.length;Jt<En;Jt++)St.push(new $t(Ke[Jt],!1));if(Rn.numMultiPolys=St.length,"difference"===Rn.type)for(var vn=St[0],un=1;un<St.length;)null!==re(St[un].bbox,vn.bbox)?un++:St.splice(un,1);if("intersection"===Rn.type)for(var kr=0,Xr=St.length;kr<Xr;kr++)for(var kn=St[kr],ri=kr+1,Hi=St.length;ri<Hi;ri++)if(null===re(kn.bbox,St[ri].bbox))return[];for(var li=new Fe(Xe.compare),gi=0,oo=St.length;gi<oo;gi++)for(var xo=St[gi].getSweepEvents(),eo=0,wo=xo.length;eo<wo;eo++)if(li.insert(xo[eo]),li.size>Kn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Bs=new Yn(li),Li=li.size,ra=li.pop();ra;){var Ls=ra.key;if(li.size===Li){var Tn=Ls.segment;throw new Error("Unable to pop() ".concat(Ls.isLeft?"left":"right"," SweepEvent ")+"[".concat(Ls.point.x,", ").concat(Ls.point.y,"] from segment #").concat(Tn.id," ")+"[".concat(Tn.leftSE.point.x,", ").concat(Tn.leftSE.point.y,"] -> ")+"[".concat(Tn.rightSE.point.x,", ").concat(Tn.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(li.size>Kn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Bs.segments.length>pr)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var il=Bs.process(Ls),va=0,Fr=il.length;va<Fr;va++){var Ua=il[va];void 0===Ua.consumedBy&&li.insert(Ua)}Li=li.size,ra=li.pop()}me.reset();var Is=pn.factory(Bs.segments);return new Sn(Is).getGeom()}}]),Nt}());return{union:function(Le){for(var De=arguments.length,Me=new Array(De>1?De-1:0),Ke=1;Ke<De;Ke++)Me[Ke-1]=arguments[Ke];return Rn.run("union",Le,Me)},intersection:function(Le){for(var De=arguments.length,Me=new Array(De>1?De-1:0),Ke=1;Ke<De;Ke++)Me[Ke-1]=arguments[Ke];return Rn.run("intersection",Le,Me)},xor:function(Le){for(var De=arguments.length,Me=new Array(De>1?De-1:0),Ke=1;Ke<De;Ke++)Me[Ke-1]=arguments[Ke];return Rn.run("xor",Le,Me)},difference:function(Le){for(var De=arguments.length,Me=new Array(De>1?De-1:0),Ke=1;Ke<De;Ke++)Me[Ke-1]=arguments[Ke];return Rn.run("difference",Le,Me)}}}()},3544:(Lt,rt,xe)=>{"use strict";Lt.exports=ye,Lt.exports.default=ye;var de=xe(6709);function ye(re,Q){if(!(this instanceof ye))return new ye(re,Q);this._maxEntries=Math.max(4,re||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),Q&&this._initFormat(Q),this.clear()}function Ce(re,Q,te){if(!te)return Q.indexOf(re);for(var ue=0;ue<Q.length;ue++)if(te(re,Q[ue]))return ue;return-1}function p(re,Q){K(re,0,re.children.length,Q,re)}function K(re,Q,te,ue,oe){oe||(oe=ae(null)),oe.minX=1/0,oe.minY=1/0,oe.maxX=-1/0,oe.maxY=-1/0;for(var me,le=Q;le<te;le++)me=re.children[le],ge(oe,re.leaf?ue(me):me);return oe}function ge(re,Q){return re.minX=Math.min(re.minX,Q.minX),re.minY=Math.min(re.minY,Q.minY),re.maxX=Math.max(re.maxX,Q.maxX),re.maxY=Math.max(re.maxY,Q.maxY),re}function Te(re,Q){return re.minX-Q.minX}function Pe(re,Q){return re.minY-Q.minY}function Fe(re){return(re.maxX-re.minX)*(re.maxY-re.minY)}function bt(re){return re.maxX-re.minX+(re.maxY-re.minY)}function nt(re,Q){return(Math.max(Q.maxX,re.maxX)-Math.min(Q.minX,re.minX))*(Math.max(Q.maxY,re.maxY)-Math.min(Q.minY,re.minY))}function He(re,Q){var te=Math.max(re.minX,Q.minX),ue=Math.max(re.minY,Q.minY),oe=Math.min(re.maxX,Q.maxX),le=Math.min(re.maxY,Q.maxY);return Math.max(0,oe-te)*Math.max(0,le-ue)}function dt(re,Q){return re.minX<=Q.minX&&re.minY<=Q.minY&&Q.maxX<=re.maxX&&Q.maxY<=re.maxY}function Rt(re,Q){return Q.minX<=re.maxX&&Q.minY<=re.maxY&&Q.maxX>=re.minX&&Q.maxY>=re.minY}function ae(re){return{children:re,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function X(re,Q,te,ue,oe){for(var me,le=[Q,te];le.length;)!((te=le.pop())-(Q=le.pop())<=ue)&&(me=Q+Math.ceil((te-Q)/ue/2)*ue,de(re,me,Q,te,oe),le.push(Q,me,me,te))}ye.prototype={all:function(){return this._all(this.data,[])},search:function(re){var Q=this.data,te=[],ue=this.toBBox;if(!Rt(re,Q))return te;for(var le,me,ne,ct,oe=[];Q;){for(le=0,me=Q.children.length;le<me;le++)ne=Q.children[le],Rt(re,ct=Q.leaf?ue(ne):ne)&&(Q.leaf?te.push(ne):dt(re,ct)?this._all(ne,te):oe.push(ne));Q=oe.pop()}return te},collides:function(re){var Q=this.data,te=this.toBBox;if(!Rt(re,Q))return!1;for(var oe,le,me,ne,ue=[];Q;){for(oe=0,le=Q.children.length;oe<le;oe++)if(me=Q.children[oe],Rt(re,ne=Q.leaf?te(me):me)){if(Q.leaf||dt(re,ne))return!0;ue.push(me)}Q=ue.pop()}return!1},load:function(re){if(!re||!re.length)return this;if(re.length<this._minEntries){for(var Q=0,te=re.length;Q<te;Q++)this.insert(re[Q]);return this}var ue=this._build(re.slice(),0,re.length-1,0);if(this.data.children.length)if(this.data.height===ue.height)this._splitRoot(this.data,ue);else{if(this.data.height<ue.height){var oe=this.data;this.data=ue,ue=oe}this._insert(ue,this.data.height-ue.height-1,!0)}else this.data=ue;return this},insert:function(re){return re&&this._insert(re,this.data.height-1),this},clear:function(){return this.data=ae([]),this},remove:function(re,Q){if(!re)return this;for(var me,ne,ct,je,te=this.data,ue=this.toBBox(re),oe=[],le=[];te||oe.length;){if(te||(te=oe.pop(),ne=oe[oe.length-1],me=le.pop(),je=!0),te.leaf&&-1!==(ct=Ce(re,te.children,Q)))return te.children.splice(ct,1),oe.push(te),this._condense(oe),this;je||te.leaf||!dt(te,ue)?ne?(me++,te=ne.children[me],je=!1):te=null:(oe.push(te),le.push(me),me=0,ne=te,te=te.children[0])}return this},toBBox:function(re){return re},compareMinX:Te,compareMinY:Pe,toJSON:function(){return this.data},fromJSON:function(re){return this.data=re,this},_all:function(re,Q){for(var te=[];re;)re.leaf?Q.push.apply(Q,re.children):te.push.apply(te,re.children),re=te.pop();return Q},_build:function(re,Q,te,ue){var me,oe=te-Q+1,le=this._maxEntries;if(oe<=le)return p(me=ae(re.slice(Q,te+1)),this.toBBox),me;ue||(ue=Math.ceil(Math.log(oe)/Math.log(le)),le=Math.ceil(oe/Math.pow(le,ue-1))),(me=ae([])).leaf=!1,me.height=ue;var je,We,Se,ln,ne=Math.ceil(oe/le),ct=ne*Math.ceil(Math.sqrt(le));for(X(re,Q,te,ct,this.compareMinX),je=Q;je<=te;je+=ct)for(X(re,je,Se=Math.min(je+ct-1,te),ne,this.compareMinY),We=je;We<=Se;We+=ne)ln=Math.min(We+ne-1,Se),me.children.push(this._build(re,We,ln,ue-1));return p(me,this.toBBox),me},_chooseSubtree:function(re,Q,te,ue){for(var oe,le,me,ne,ct,je,We,Se;ue.push(Q),!Q.leaf&&ue.length-1!==te;){for(We=Se=1/0,oe=0,le=Q.children.length;oe<le;oe++)ct=Fe(me=Q.children[oe]),(je=nt(re,me)-ct)<Se?(Se=je,We=ct<We?ct:We,ne=me):je===Se&&ct<We&&(We=ct,ne=me);Q=ne||Q.children[0]}return Q},_insert:function(re,Q,te){var oe=te?re:(0,this.toBBox)(re),le=[],me=this._chooseSubtree(oe,this.data,Q,le);for(me.children.push(re),ge(me,oe);Q>=0&&le[Q].children.length>this._maxEntries;)this._split(le,Q),Q--;this._adjustParentBBoxes(oe,le,Q)},_split:function(re,Q){var te=re[Q],ue=te.children.length,oe=this._minEntries;this._chooseSplitAxis(te,oe,ue);var le=this._chooseSplitIndex(te,oe,ue),me=ae(te.children.splice(le,te.children.length-le));me.height=te.height,me.leaf=te.leaf,p(te,this.toBBox),p(me,this.toBBox),Q?re[Q-1].children.push(me):this._splitRoot(te,me)},_splitRoot:function(re,Q){this.data=ae([re,Q]),this.data.height=re.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(re,Q,te){var ue,oe,le,me,ne,ct,je,We;for(ct=je=1/0,ue=Q;ue<=te-Q;ue++)me=He(oe=K(re,0,ue,this.toBBox),le=K(re,ue,te,this.toBBox)),ne=Fe(oe)+Fe(le),me<ct?(ct=me,We=ue,je=ne<je?ne:je):me===ct&&ne<je&&(je=ne,We=ue);return We},_chooseSplitAxis:function(re,Q,te){var ue=re.leaf?this.compareMinX:Te,oe=re.leaf?this.compareMinY:Pe;this._allDistMargin(re,Q,te,ue)<this._allDistMargin(re,Q,te,oe)&&re.children.sort(ue)},_allDistMargin:function(re,Q,te,ue){re.children.sort(ue);var ct,je,oe=this.toBBox,le=K(re,0,Q,oe),me=K(re,te-Q,te,oe),ne=bt(le)+bt(me);for(ct=Q;ct<te-Q;ct++)je=re.children[ct],ge(le,re.leaf?oe(je):je),ne+=bt(le);for(ct=te-Q-1;ct>=Q;ct--)je=re.children[ct],ge(me,re.leaf?oe(je):je),ne+=bt(me);return ne},_adjustParentBBoxes:function(re,Q,te){for(var ue=te;ue>=0;ue--)ge(Q[ue],re)},_condense:function(re){for(var te,Q=re.length-1;Q>=0;Q--)0===re[Q].children.length?Q>0?(te=re[Q-1].children).splice(te.indexOf(re[Q]),1):this.clear():p(re[Q],this.toBBox)},_initFormat:function(re){var Q=["return a"," - b",";"];this.compareMinX=new Function("a","b",Q.join(re[0])),this.compareMinY=new Function("a","b",Q.join(re[1])),this.toBBox=new Function("a","return {minX: a"+re[0]+", minY: a"+re[1]+", maxX: a"+re[2]+", maxY: a"+re[3]+"};")}}},6709:function(Lt){Lt.exports=function(){"use strict";function xe(Ce,p,K,ge,Te){for(;ge>K;){if(ge-K>600){var Pe=ge-K+1,Fe=p-K+1,bt=Math.log(Pe),nt=.5*Math.exp(2*bt/3),He=.5*Math.sqrt(bt*nt*(Pe-nt)/Pe)*(Fe-Pe/2<0?-1:1);xe(Ce,p,Math.max(K,Math.floor(p-Fe*nt/Pe+He)),Math.min(ge,Math.floor(p+(Pe-Fe)*nt/Pe+He)),Te)}var ae=Ce[p],X=K,re=ge;for(de(Ce,K,p),Te(Ce[ge],ae)>0&&de(Ce,K,ge);X<re;){for(de(Ce,X,re),X++,re--;Te(Ce[X],ae)<0;)X++;for(;Te(Ce[re],ae)>0;)re--}0===Te(Ce[K],ae)?de(Ce,K,re):de(Ce,++re,ge),re<=p&&(K=re+1),p<=re&&(ge=re-1)}}function de(Ce,p,K){var ge=Ce[p];Ce[p]=Ce[K],Ce[K]=ge}function ye(Ce,p){return Ce<p?-1:Ce>p?1:0}return function rt(Ce,p,K,ge,Te){xe(Ce,p,K||0,ge||Ce.length-1,Te||ye)}}()},4468:(Lt,rt,xe)=>{"use strict";var de=xe(9582).functionsHaveConfigurableNames(),ye=Object,Ce=TypeError;Lt.exports=function(){if(null!=this&&this!==ye(this))throw new Ce("RegExp.prototype.flags getter called on non-object");var K="";return this.hasIndices&&(K+="d"),this.global&&(K+="g"),this.ignoreCase&&(K+="i"),this.multiline&&(K+="m"),this.dotAll&&(K+="s"),this.unicode&&(K+="u"),this.sticky&&(K+="y"),K},de&&Object.defineProperty&&Object.defineProperty(Lt.exports,"name",{value:"get flags"})},9235:(Lt,rt,xe)=>{"use strict";var de=xe(2358),ye=xe(5685),Ce=xe(4468),p=xe(6343),K=xe(1956),ge=ye(p());de(ge,{getPolyfill:p,implementation:Ce,shim:K}),Lt.exports=ge},6343:(Lt,rt,xe)=>{"use strict";var de=xe(4468),ye=xe(2358).supportsDescriptors,Ce=Object.getOwnPropertyDescriptor;Lt.exports=function(){if(ye&&"gim"===/a/gim.flags){var K=Ce(RegExp.prototype,"flags");if(K&&"function"==typeof K.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var ge="",Te={};if(Object.defineProperty(Te,"hasIndices",{get:function(){ge+="d"}}),Object.defineProperty(Te,"sticky",{get:function(){ge+="y"}}),"dy"===ge)return K.get}}return de}},1956:(Lt,rt,xe)=>{"use strict";var de=xe(2358).supportsDescriptors,ye=xe(6343),Ce=Object.getOwnPropertyDescriptor,p=Object.defineProperty,K=TypeError,ge=Object.getPrototypeOf,Te=/a/;Lt.exports=function(){if(!de||!ge)throw new K("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var Fe=ye(),bt=ge(Te),nt=Ce(bt,"flags");return(!nt||nt.get!==Fe)&&p(bt,"flags",{configurable:!0,enumerable:!1,get:Fe}),Fe}},7563:function(Lt,rt){!function(xe){"use strict";function Ce(dt,Rt,ae,X,re){let Q,te,ue,oe,le=Rt[0],me=X[0],ne=0,ct=0;me>le==me>-le?(Q=le,le=Rt[++ne]):(Q=me,me=X[++ct]);let je=0;if(ne<dt&&ct<ae)for(me>le==me>-le?(ue=Q-((te=le+Q)-le),le=Rt[++ne]):(ue=Q-((te=me+Q)-me),me=X[++ct]),Q=te,0!==ue&&(re[je++]=ue);ne<dt&&ct<ae;)me>le==me>-le?(ue=Q-((te=Q+le)-(oe=te-Q))+(le-oe),le=Rt[++ne]):(ue=Q-((te=Q+me)-(oe=te-Q))+(me-oe),me=X[++ct]),Q=te,0!==ue&&(re[je++]=ue);for(;ne<dt;)ue=Q-((te=Q+le)-(oe=te-Q))+(le-oe),le=Rt[++ne],Q=te,0!==ue&&(re[je++]=ue);for(;ct<ae;)ue=Q-((te=Q+me)-(oe=te-Q))+(me-oe),me=X[++ct],Q=te,0!==ue&&(re[je++]=ue);return 0===Q&&0!==je||(re[je++]=Q),je}function p(dt){return new Float64Array(dt)}const Pe=p(4),Fe=p(8),bt=p(12),nt=p(16),He=p(4);xe.orient2d=function(dt,Rt,ae,X,re,Q){const te=(Rt-Q)*(ae-re),ue=(dt-re)*(X-Q),oe=te-ue;if(0===te||0===ue||te>0!=ue>0)return oe;const le=Math.abs(te+ue);return Math.abs(oe)>=33306690738754716e-32*le?oe:-function(me,ne,ct,je,We,Se,ln){let Bt,$e,Tt,Xe,gt,xt,Be,qt,$t,pn,At,Sn,Yn,Kn,pr,Un,Rn,Jn;const Ei=me-We,Ai=ct-We,Sr=ne-Se,zr=je-Se;gt=(pr=(qt=Ei-(Be=(xt=134217729*Ei)-(xt-Ei)))*(pn=zr-($t=(xt=134217729*zr)-(xt-zr)))-((Kn=Ei*zr)-Be*$t-qt*$t-Be*pn))-(At=pr-(Rn=(qt=Sr-(Be=(xt=134217729*Sr)-(xt-Sr)))*(pn=Ai-($t=(xt=134217729*Ai)-(xt-Ai)))-((Un=Sr*Ai)-Be*$t-qt*$t-Be*pn))),Pe[0]=pr-(At+gt)+(gt-Rn),gt=(Yn=Kn-((Sn=Kn+At)-(gt=Sn-Kn))+(At-gt))-(At=Yn-Un),Pe[1]=Yn-(At+gt)+(gt-Un),gt=(Jn=Sn+At)-Sn,Pe[2]=Sn-(Jn-gt)+(At-gt),Pe[3]=Jn;let Nt=function(St,Jt){let En=Jt[0];for(let vn=1;vn<4;vn++)En+=Jt[vn];return En}(0,Pe),Le=22204460492503146e-32*ln;if(Nt>=Le||-Nt>=Le||(Bt=me-(Ei+(gt=me-Ei))+(gt-We),Tt=ct-(Ai+(gt=ct-Ai))+(gt-We),$e=ne-(Sr+(gt=ne-Sr))+(gt-Se),Xe=je-(zr+(gt=je-zr))+(gt-Se),0===Bt&&0===$e&&0===Tt&&0===Xe)||(Le=11093356479670487e-47*ln+33306690738754706e-32*Math.abs(Nt),(Nt+=Ei*Xe+zr*Bt-(Sr*Tt+Ai*$e))>=Le||-Nt>=Le))return Nt;gt=(pr=(qt=Bt-(Be=(xt=134217729*Bt)-(xt-Bt)))*(pn=zr-($t=(xt=134217729*zr)-(xt-zr)))-((Kn=Bt*zr)-Be*$t-qt*$t-Be*pn))-(At=pr-(Rn=(qt=$e-(Be=(xt=134217729*$e)-(xt-$e)))*(pn=Ai-($t=(xt=134217729*Ai)-(xt-Ai)))-((Un=$e*Ai)-Be*$t-qt*$t-Be*pn))),He[0]=pr-(At+gt)+(gt-Rn),gt=(Yn=Kn-((Sn=Kn+At)-(gt=Sn-Kn))+(At-gt))-(At=Yn-Un),He[1]=Yn-(At+gt)+(gt-Un),gt=(Jn=Sn+At)-Sn,He[2]=Sn-(Jn-gt)+(At-gt),He[3]=Jn;const De=Ce(4,Pe,4,He,Fe);gt=(pr=(qt=Ei-(Be=(xt=134217729*Ei)-(xt-Ei)))*(pn=Xe-($t=(xt=134217729*Xe)-(xt-Xe)))-((Kn=Ei*Xe)-Be*$t-qt*$t-Be*pn))-(At=pr-(Rn=(qt=Sr-(Be=(xt=134217729*Sr)-(xt-Sr)))*(pn=Tt-($t=(xt=134217729*Tt)-(xt-Tt)))-((Un=Sr*Tt)-Be*$t-qt*$t-Be*pn))),He[0]=pr-(At+gt)+(gt-Rn),gt=(Yn=Kn-((Sn=Kn+At)-(gt=Sn-Kn))+(At-gt))-(At=Yn-Un),He[1]=Yn-(At+gt)+(gt-Un),gt=(Jn=Sn+At)-Sn,He[2]=Sn-(Jn-gt)+(At-gt),He[3]=Jn;const Me=Ce(De,Fe,4,He,bt);gt=(pr=(qt=Bt-(Be=(xt=134217729*Bt)-(xt-Bt)))*(pn=Xe-($t=(xt=134217729*Xe)-(xt-Xe)))-((Kn=Bt*Xe)-Be*$t-qt*$t-Be*pn))-(At=pr-(Rn=(qt=$e-(Be=(xt=134217729*$e)-(xt-$e)))*(pn=Tt-($t=(xt=134217729*Tt)-(xt-Tt)))-((Un=$e*Tt)-Be*$t-qt*$t-Be*pn))),He[0]=pr-(At+gt)+(gt-Rn),gt=(Yn=Kn-((Sn=Kn+At)-(gt=Sn-Kn))+(At-gt))-(At=Yn-Un),He[1]=Yn-(At+gt)+(gt-Un),gt=(Jn=Sn+At)-Sn,He[2]=Sn-(Jn-gt)+(At-gt),He[3]=Jn;const Ke=Ce(Me,bt,4,He,nt);return nt[Ke-1]}(dt,Rt,ae,X,re,Q,le)},xe.orient2dfast=function(dt,Rt,ae,X,re,Q){return(Rt-Q)*(ae-re)-(dt-re)*(X-Q)},Object.defineProperty(xe,"__esModule",{value:!0})}(rt)},9231:Lt=>{"use strict";Lt.exports={eudist:function(xe,de,ye){for(var Ce=xe.length,p=0,K=0;K<Ce;K++){var ge=(xe[K]||0)-(de[K]||0);p+=ge*ge}return ye?Math.sqrt(p):p},mandist:function(xe,de,ye){for(var Ce=xe.length,p=0,K=0;K<Ce;K++)p+=Math.abs((xe[K]||0)-(de[K]||0));return ye?Math.sqrt(p):p},dist:function(xe,de,ye){var Ce=Math.abs(xe-de);return ye?Ce:Ce*Ce}}},5561:(Lt,rt,xe)=>{"use strict";var de=xe(9231),ye=de.eudist,Ce=de.dist;Lt.exports={kmrand:function(K,ge){for(var Te={},Pe=[],Fe=ge<<2,bt=K.length,nt=K[0].length>0;Pe.length<ge&&Fe-- >0;){var He=K[Math.floor(Math.random()*bt)],dt=nt?He.join("_"):""+He;Te[dt]||(Te[dt]=!0,Pe.push(He))}if(Pe.length<ge)throw new Error("Error initializating clusters");return Pe},kmpp:function(K,ge){var Te=K[0].length?ye:Ce,Pe=[],Fe=K.length,bt=K[0].length>0,He=K[Math.floor(Math.random()*Fe)];for(bt&&He.join("_"),Pe.push(He);Pe.length<ge;){for(var Rt=[],ae=Pe.length,X=0,re=[],Q=0;Q<Fe;Q++){for(var te=1/0,ue=0;ue<ae;ue++){var oe=Te(K[Q],Pe[ue]);oe<=te&&(te=oe)}Rt[Q]=te}for(var le=0;le<Fe;le++)X+=Rt[le];for(var me=0;me<Fe;me++)re[me]={i:me,v:K[me],pr:Rt[me]/X,cs:0};re.sort(function(We,Se){return We.pr-Se.pr}),re[0].cs=re[0].pr;for(var ne=1;ne<Fe;ne++)re[ne].cs=re[ne-1].cs+re[ne].pr;for(var ct=Math.random(),je=0;je<Fe-1&&re[je++].cs<ct;);Pe.push(re[je-1].v)}return Pe}}},9475:(Lt,rt,xe)=>{"use strict";var de=xe(9231),ye=xe(5561),Ce=de.eudist,ge=ye.kmrand,Te=ye.kmpp;function Fe(nt,He,dt){dt=dt||[];for(var Rt=0;Rt<nt;Rt++)dt[Rt]=He;return dt}Lt.exports=function bt(nt,He,dt,Rt){var ae=[],X=[],re=[],Q=[],te=!1,ue=Rt||1e4,oe=nt.length,le=nt[0].length,me=le>0,ne=[];if(dt)ae="kmrand"==dt?ge(nt,He):"kmpp"==dt?Te(nt,He):dt;else for(var ct={};ae.length<He;){var je=Math.floor(Math.random()*oe);ct[je]||(ct[je]=!0,ae.push(nt[je]))}do{Fe(He,0,ne);for(var We=0;We<oe;We++){for(var Se=1/0,ln=0,Bt=0;Bt<He;Bt++)(Q=me?Ce(nt[We],ae[Bt]):Math.abs(nt[We]-ae[Bt]))<=Se&&(Se=Q,ln=Bt);re[We]=ln,ne[ln]++}for(var $e=[],Xe=(X=[],0);Xe<He;Xe++)$e[Xe]=me?Fe(le,0,$e[Xe]):0,X[Xe]=ae[Xe];if(me){for(var gt=0;gt<He;gt++)ae[gt]=[];for(var xt=0;xt<oe;xt++)for(var qt=$e[re[xt]],$t=nt[xt],pn=0;pn<le;pn++)qt[pn]+=$t[pn];te=!0;for(var At=0;At<He;At++){for(var Sn=ae[At],Yn=$e[At],Kn=X[At],pr=ne[At],Un=0;Un<le;Un++)Sn[Un]=Yn[Un]/pr||0;if(te)for(var Rn=0;Rn<le;Rn++)if(Kn[Rn]!=Sn[Rn]){te=!1;break}}}else{for(var Jn=0;Jn<oe;Jn++)$e[re[Jn]]+=nt[Jn];for(var Ai=0;Ai<He;Ai++)ae[Ai]=$e[Ai]/ne[Ai]||0;te=!0;for(var Sr=0;Sr<He;Sr++)if(X[Sr]!=ae[Sr]){te=!1;break}}te=te||--ue<=0}while(!te);return{it:1e4-ue,k:He,idxs:re,centroids:ae}}},6775:function(Lt){var de;de=function(){var xe=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function de(ge){return ge.match(xe)||[]}function Ce(ge){return{language:(ge=de(ge))[1]||"",extlang:ge[2]||"",script:ge[3]||"",region:ge[4]||""}}function p(ge,Te,Pe){Object.defineProperty(ge,Te,{value:Pe,enumerable:!0})}function K(ge,Te,Pe){function Fe(bt){return de(bt)[ge]||""}p(Fe,"pattern",Te),p(Ce,Pe,Fe)}return K(1,/^[a-zA-Z]{2,3}$/,"language"),K(2,/^[a-zA-Z]{3}$/,"extlang"),K(3,/^[a-zA-Z]{4}$/,"script"),K(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),p(Ce,"split",function ye(ge){return de(ge).filter(function(Te,Pe){return Te&&Pe})}),Ce},Lt.exports?Lt.exports=de():this.subtag=de()},5562:(Lt,rt,xe)=>{"use strict";var de=xe(8576);Lt.exports=de,typeof window<"u"&&(window.Suggestions=de)},7554:Lt=>{"use strict";var rt=function(xe){return this.component=xe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,xe.el.parentNode.insertBefore(this.wrapper,xe.el.nextSibling),this};rt.prototype.show=function(){this.element.style.display="block"},rt.prototype.hide=function(){this.element.style.display="none"},rt.prototype.add=function(xe){this.items.push(xe)},rt.prototype.clear=function(){this.items=[],this.active=0},rt.prototype.isEmpty=function(){return!this.items.length},rt.prototype.isVisible=function(){return"block"===this.element.style.display},rt.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var xe=0;xe<this.items.length;xe++)this.drawItem(this.items[xe],this.active===xe);this.show()}else this.hide()},rt.prototype.drawItem=function(xe,de){var ye=document.createElement("li"),Ce=document.createElement("a");de&&(ye.className+=" active"),Ce.innerHTML=xe.string,ye.appendChild(Ce),this.element.appendChild(ye),ye.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),ye.addEventListener("mouseup",function(){this.handleMouseUp.call(this,xe)}.bind(this))},rt.prototype.handleMouseUp=function(xe){this.selectingListItem=!1,this.component.value(xe.original),this.clear(),this.draw()},rt.prototype.move=function(xe){this.active=xe,this.draw()},rt.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},rt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},rt.prototype.drawError=function(xe){var de=document.createElement("li");de.innerHTML=xe,this.element.appendChild(de),this.show()},Lt.exports=rt},8576:(Lt,rt,xe)=>{"use strict";var de=xe(4703),ye=xe(5780),Ce=xe(7554),p=function(K,ge,Te){return this.options=de({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Te=Te||{}),this.el=K,this.data=ge||[],this.list=new Ce(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(Pe){this.handleKeyUp(Pe.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(Pe){this.handleKeyDown(Pe)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(Pe){this.handlePaste(Pe)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};p.prototype.handleKeyUp=function(K){40===K||38===K||27===K||13===K||9===K||this.handleInputChange(this.el.value)},p.prototype.handleKeyDown=function(K){switch(K.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&K.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},p.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},p.prototype.handlePaste=function(K){if(K.clipboardData)this.handleInputChange(K.clipboardData.getData("Text"));else{var ge=this;setTimeout(function(){ge.handleInputChange(K.target.value)},100)}},p.prototype.handleInputChange=function(K){this.query=this.normalize(K),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(ge){for(var Te=0;Te<ge.length&&(this.list.add(ge[Te]),Te!==this.options.limit-1);Te++);this.list.draw()}.bind(this))},p.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},p.prototype.update=function(K){this.data=K,this.handleKeyUp()},p.prototype.clear=function(){this.data=[],this.list.clear()},p.prototype.normalize=function(K){return K.toLowerCase()},p.prototype.match=function(K,ge){return K.indexOf(ge)>-1},p.prototype.value=function(K){if(this.selected=K,this.el.value=this.getItemValue(K),document.createEvent){var ge=document.createEvent("HTMLEvents");ge.initEvent("change",!0,!1),this.el.dispatchEvent(ge)}else this.el.fireEvent("onchange")},p.prototype.getCandidates=function(K){var ge={pre:"<strong>",post:"</strong>",extract:function(Pe){return this.getItemValue(Pe)}.bind(this)};K(this.options.filter?ye.filter(this.query,this.data,ge).map(function(Pe){return{original:Pe.original,string:this.render(Pe.original,Pe.string)}}.bind(this)):this.data.map(function(Pe){return{original:Pe,string:this.render(Pe)}}.bind(this)))},p.prototype.getItemValue=function(K){return K},p.prototype.render=function(K,ge){if(ge)return ge;for(var Te=this.getItemValue(K.original?K.original:K),Pe=this.normalize(Te),Fe=Pe.lastIndexOf(this.query);Fe>-1;){var bt=Fe+this.query.length;Te=Te.slice(0,Fe)+"<strong>"+Te.slice(Fe,bt)+"</strong>"+Te.slice(bt),Fe=Pe.slice(0,Fe).lastIndexOf(this.query)}return Te},p.prototype.renderError=function(K){this.list.drawError(K)},Lt.exports=p},7253:(Lt,rt,xe)=>{"use strict";xe.r(rt),xe.d(rt,{default:()=>de});class de{constructor(p=[],K=ye){if(this.data=p,this.length=this.data.length,this.compare=K,this.length>0)for(let ge=(this.length>>1)-1;ge>=0;ge--)this._down(ge)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const p=this.data[0],K=this.data.pop();return this.length--,this.length>0&&(this.data[0]=K,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:K,compare:ge}=this,Te=K[p];for(;p>0;){const Pe=p-1>>1,Fe=K[Pe];if(ge(Te,Fe)>=0)break;K[p]=Fe,p=Pe}K[p]=Te}_down(p){const{data:K,compare:ge}=this,Te=this.length>>1,Pe=K[p];for(;p<Te;){let Fe=1+(p<<1),bt=K[Fe];const nt=Fe+1;if(nt<this.length&&ge(K[nt],bt)<0&&(Fe=nt,bt=K[nt]),ge(bt,Pe)>=0)break;K[p]=bt,p=Fe}K[p]=Pe}}function ye(Ce,p){return Ce<p?-1:Ce>p?1:0}},770:function(Lt,rt){!function(xe){"use strict";function de(){}function ye(l){this.message=l||""}function Ce(l){this.message=l||""}function p(l){this.message=l||""}function K(){}function ge(l){return null===l?et:l.color}function Te(l){return null===l?null:l.parent}function Pe(l,h){null!==l&&(l.color=h)}function Fe(l){return null===l?null:l.left}function bt(l){return null===l?null:l.right}function nt(){this.root_=null,this.size_=0}function He(){}function dt(){this.array_=[],arguments[0]instanceof Li&&this.addAll(arguments[0])}function Rt(){}function ae(l){this.message=l||""}function X(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(l){if(null==this)throw new TypeError(this+" is not an object");var h=Object(this),_=Math.max(Math.min(h.length,9007199254740991),0)||0,w=1 in arguments&&parseInt(Number(arguments[1]),10)||0;w=w<0?Math.max(_+w,0):Math.min(w,_);var I=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:_;for(I=I<0?Math.max(_+arguments[2],0):Math.min(I,_);w<I;)h[w]=l,++w;return h},writable:!0}),Number.isFinite=Number.isFinite||function(l){return"number"==typeof l&&isFinite(l)},Number.isInteger=Number.isInteger||function(l){return"number"==typeof l&&isFinite(l)&&Math.floor(l)===l},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(l){return l!=l},Math.trunc=Math.trunc||function(l){return l<0?Math.ceil(l):Math.floor(l)};var re=function(){};re.prototype.interfaces_=function(){return[]},re.prototype.getClass=function(){return re},re.prototype.equalsWithTolerance=function(l,h,_){return Math.abs(l-h)<=_};var Q=function(l){function h(_){l.call(this,_),this.name="IllegalArgumentException",this.message=_,this.stack=(new l).stack}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(Error),te=function(){},ue={MAX_VALUE:{configurable:!0}};te.isNaN=function(l){return Number.isNaN(l)},te.doubleToLongBits=function(l){return l},te.longBitsToDouble=function(l){return l},te.isInfinite=function(l){return!Number.isFinite(l)},ue.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(te,ue);var oe=function(){},le=function(){},me=function(){},ne=function l(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=l.NULL_ORDINATE;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.z=h.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=l.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},ct={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};ne.prototype.setOrdinate=function(l,h){switch(l){case ne.X:this.x=h;break;case ne.Y:this.y=h;break;case ne.Z:this.z=h;break;default:throw new Q("Invalid ordinate index: "+l)}},ne.prototype.equals2D=function(){if(1===arguments.length){var l=arguments[0];return this.x===l.x&&this.y===l.y}if(2===arguments.length){var h=arguments[0],_=arguments[1];return!!re.equalsWithTolerance(this.x,h.x,_)&&!!re.equalsWithTolerance(this.y,h.y,_)}},ne.prototype.getOrdinate=function(l){switch(l){case ne.X:return this.x;case ne.Y:return this.y;case ne.Z:return this.z}throw new Q("Invalid ordinate index: "+l)},ne.prototype.equals3D=function(l){return this.x===l.x&&this.y===l.y&&(this.z===l.z||te.isNaN(this.z))&&te.isNaN(l.z)},ne.prototype.equals=function(l){return l instanceof ne&&this.equals2D(l)},ne.prototype.equalInZ=function(l,h){return re.equalsWithTolerance(this.z,l.z,h)},ne.prototype.compareTo=function(l){return this.x<l.x?-1:this.x>l.x?1:this.y<l.y?-1:this.y>l.y?1:0},ne.prototype.clone=function(){},ne.prototype.copy=function(){return new ne(this)},ne.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},ne.prototype.distance3D=function(l){var h=this.x-l.x,_=this.y-l.y,w=this.z-l.z;return Math.sqrt(h*h+_*_+w*w)},ne.prototype.distance=function(l){var h=this.x-l.x,_=this.y-l.y;return Math.sqrt(h*h+_*_)},ne.prototype.hashCode=function(){var l=17;return 37*(l=37*l+ne.hashCode(this.x))+ne.hashCode(this.y)},ne.prototype.setCoordinate=function(l){this.x=l.x,this.y=l.y,this.z=l.z},ne.prototype.interfaces_=function(){return[oe,le,de]},ne.prototype.getClass=function(){return ne},ne.hashCode=function(){if(1===arguments.length){var h=te.doubleToLongBits(arguments[0]);return Math.trunc((h^h)>>>32)}},ct.DimensionalComparator.get=function(){return je},ct.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},ct.NULL_ORDINATE.get=function(){return te.NaN},ct.X.get=function(){return 0},ct.Y.get=function(){return 1},ct.Z.get=function(){return 2},Object.defineProperties(ne,ct);var je=function(l){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var h=arguments[0];if(2!==h&&3!==h)throw new Q("only 2 or 3 dimensions may be specified");this._dimensionsToTest=h}};je.prototype.compare=function(l,h){var _=l,w=h,I=je.compare(_.x,w.x);if(0!==I)return I;var U=je.compare(_.y,w.y);return 0!==U?U:this._dimensionsToTest<=2?0:je.compare(_.z,w.z)},je.prototype.interfaces_=function(){return[me]},je.prototype.getClass=function(){return je},je.compare=function(l,h){return l<h?-1:l>h?1:te.isNaN(l)?te.isNaN(h)?0:-1:te.isNaN(h)?1:0};var We=function(){};We.prototype.create=function(){},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We};var Se=function(){},ln={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Se.prototype.interfaces_=function(){return[]},Se.prototype.getClass=function(){return Se},Se.toLocationSymbol=function(l){switch(l){case Se.EXTERIOR:return"e";case Se.BOUNDARY:return"b";case Se.INTERIOR:return"i";case Se.NONE:return"-"}throw new Q("Unknown location value: "+l)},ln.INTERIOR.get=function(){return 0},ln.BOUNDARY.get=function(){return 1},ln.EXTERIOR.get=function(){return 2},ln.NONE.get=function(){return-1},Object.defineProperties(Se,ln);var Bt=function(l,h){return l.interfaces_&&l.interfaces_().indexOf(h)>-1},$e=function(){},Tt={LOG_10:{configurable:!0}};$e.prototype.interfaces_=function(){return[]},$e.prototype.getClass=function(){return $e},$e.log10=function(l){var h=Math.log(l);return te.isInfinite(h)||te.isNaN(h)?h:h/$e.LOG_10},$e.min=function(l,h,_,w){var I=l;return h<I&&(I=h),_<I&&(I=_),w<I&&(I=w),I},$e.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var l=arguments[0],h=arguments[1],_=arguments[2];return l<h?h:l>_?_:l}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var w=arguments[0],I=arguments[1],U=arguments[2];return w<I?I:w>U?U:w}},$e.wrap=function(l,h){return l<0?h- -l%h:l%h},$e.max=function(){if(3===arguments.length){var h=arguments[1],_=arguments[2],w=arguments[0];return h>w&&(w=h),_>w&&(w=_),w}if(4===arguments.length){var U=arguments[1],q=arguments[2],he=arguments[3],ke=arguments[0];return U>ke&&(ke=U),q>ke&&(ke=q),he>ke&&(ke=he),ke}},$e.average=function(l,h){return(l+h)/2},Tt.LOG_10.get=function(){return Math.log(10)},Object.defineProperties($e,Tt);var Xe=function(l){this.str=l};Xe.prototype.append=function(l){this.str+=l},Xe.prototype.setCharAt=function(l,h){this.str=this.str.substr(0,l)+h+this.str.substr(l+1)},Xe.prototype.toString=function(l){return this.str};var gt=function(l){this.value=l};gt.prototype.intValue=function(){return this.value},gt.prototype.compareTo=function(l){return this.value<l?-1:this.value>l?1:0},gt.isNaN=function(l){return Number.isNaN(l)};var xt=function(){};xt.isWhitespace=function(l){return l<=32&&l>=0||127===l},xt.toUpperCase=function(l){return l.toUpperCase()};var Be=function l(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof l?this.init(arguments[0]):"string"==typeof arguments[0]&&l.call(this,l.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},qt={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Be.prototype.le=function(l){return(this._hi<l._hi||this._hi===l._hi)&&this._lo<=l._lo},Be.prototype.extractSignificantDigits=function(l,h){var _=this.abs(),w=Be.magnitude(_._hi),I=Be.TEN.pow(w);(_=_.divide(I)).gt(Be.TEN)?(_=_.divide(Be.TEN),w+=1):_.lt(Be.ONE)&&(_=_.multiply(Be.TEN),w-=1);for(var U=w+1,q=new Xe,he=Be.MAX_PRINT_DIGITS-1,ke=0;ke<=he;ke++){l&&ke===U&&q.append(".");var wt=Math.trunc(_._hi);if(wt<0)break;var vt=!1,on=0;wt>9?(vt=!0,on="9"):on="0"+wt,q.append(on),_=_.subtract(Be.valueOf(wt)).multiply(Be.TEN),vt&&_.selfAdd(Be.TEN);var Gn=!0,qn=Be.magnitude(_._hi);if(qn<0&&Math.abs(qn)>=he-ke&&(Gn=!1),!Gn)break}return h[0]=w,q.toString()},Be.prototype.sqr=function(){return this.multiply(this)},Be.prototype.doubleValue=function(){return this._hi+this._lo},Be.prototype.subtract=function(){return arguments[0]instanceof Be?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Be.prototype.equals=function(){if(1===arguments.length){var l=arguments[0];return this._hi===l._hi&&this._lo===l._lo}},Be.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Be.prototype.selfSubtract=function(){if(arguments[0]instanceof Be){var l=arguments[0];return this.isNaN()?this:this.selfAdd(-l._hi,-l._lo)}if("number"==typeof arguments[0]){var h=arguments[0];return this.isNaN()?this:this.selfAdd(-h,0)}},Be.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Be.prototype.min=function(l){return this.le(l)?this:l},Be.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Be){var l=arguments[0];return this.selfDivide(l._hi,l._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var _=arguments[0],I=null,U=null,q=null,he=null,ke=null,wt=null,vt=null,on=null;return this._hi=on=(ke=this._hi/_)+(wt=(this._hi-(vt=ke*_)-(on=(I=(wt=Be.SPLIT*ke)-(I=wt-ke))*(q=(on=Be.SPLIT*_)-(q=on-_))-vt+I*(he=_-q)+(U=ke-I)*q+U*he)+this._lo-ke*arguments[1])/_),this._lo=ke-on+wt,this}},Be.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Be.prototype.divide=function(){if(arguments[0]instanceof Be){var l=arguments[0],h=null,_=null,w=null,I=null,U=null,q=null,he=null,ke=null;return _=(U=this._hi/l._hi)-(h=(q=Be.SPLIT*U)-(h=q-U)),ke=h*(w=(ke=Be.SPLIT*l._hi)-(w=ke-l._hi))-(he=U*l._hi)+h*(I=l._hi-w)+_*w+_*I,new Be(ke=U+(q=(this._hi-he-ke+this._lo-U*l._lo)/l._hi),U-ke+q)}if("number"==typeof arguments[0]){var wt=arguments[0];return te.isNaN(wt)?Be.createNaN():Be.copy(this).selfDivide(wt,0)}},Be.prototype.ge=function(l){return(this._hi>l._hi||this._hi===l._hi)&&this._lo>=l._lo},Be.prototype.pow=function(l){if(0===l)return Be.valueOf(1);var h=new Be(this),_=Be.valueOf(1),w=Math.abs(l);if(w>1)for(;w>0;)w%2==1&&_.selfMultiply(h),(w/=2)>0&&(h=h.sqr());else _=h;return l<0?_.reciprocal():_},Be.prototype.ceil=function(){if(this.isNaN())return Be.NaN;var l=Math.ceil(this._hi),h=0;return l===this._hi&&(h=Math.ceil(this._lo)),new Be(l,h)},Be.prototype.compareTo=function(l){return this._hi<l._hi?-1:this._hi>l._hi?1:this._lo<l._lo?-1:this._lo>l._lo?1:0},Be.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Be.prototype.setValue=function(){return arguments[0]instanceof Be||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Be.prototype.max=function(l){return this.ge(l)?this:l},Be.prototype.sqrt=function(){if(this.isZero())return Be.valueOf(0);if(this.isNegative())return Be.NaN;var l=1/Math.sqrt(this._hi),_=Be.valueOf(this._hi*l),w=this.subtract(_.sqr())._hi*(.5*l);return _.add(w)},Be.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Be){var l=arguments[0];return this.selfAdd(l._hi,l._lo)}if("number"==typeof arguments[0]){var h=arguments[0],_=null,w=null,I=null,q=null,he=null;return this._hi=(_=(I=this._hi+h)+(he=h-(q=I-this._hi)+(this._hi-(I-q))+this._lo))+(w=he+(I-_)),this._lo=w+(_-this._hi),this}}else if(2===arguments.length){var ke=arguments[0],wt=arguments[1],vt=null,on=null,Gn=null,qn=null,hr=null,Lr=null,to=null;hr=(qn=this._hi+ke)-(Lr=qn-this._hi),Gn=(on=this._lo+wt)-(to=on-this._lo);var Ps=(vt=qn+(Lr=(hr=ke-Lr+(this._hi-hr))+on))+(Lr=(Gn=wt-to+(this._lo-Gn))+(Lr+(qn-vt))),ka=Lr+(vt-Ps);return this._hi=Ps,this._lo=ka,this}},Be.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Be){var l=arguments[0];return this.selfMultiply(l._hi,l._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var _=arguments[0],I=null,U=null,q=null,he=null,ke=null,wt=null;I=(ke=Be.SPLIT*this._hi)-this._hi,I=ke-I;var vt=(ke=this._hi*_)+(wt=I*(q=(wt=Be.SPLIT*_)-(q=wt-_))-ke+I*(he=_-q)+(U=this._hi-I)*q+U*he+(this._hi*arguments[1]+this._lo*_)),on=wt+(I=ke-vt);return this._hi=vt,this._lo=on,this}},Be.prototype.selfSqr=function(){return this.selfMultiply(this)},Be.prototype.floor=function(){if(this.isNaN())return Be.NaN;var l=Math.floor(this._hi),h=0;return l===this._hi&&(h=Math.floor(this._lo)),new Be(l,h)},Be.prototype.negate=function(){return this.isNaN()?this:new Be(-this._hi,-this._lo)},Be.prototype.clone=function(){},Be.prototype.multiply=function(){if(arguments[0]instanceof Be){var l=arguments[0];return l.isNaN()?Be.createNaN():Be.copy(this).selfMultiply(l)}if("number"==typeof arguments[0]){var h=arguments[0];return te.isNaN(h)?Be.createNaN():Be.copy(this).selfMultiply(h,0)}},Be.prototype.isNaN=function(){return te.isNaN(this._hi)},Be.prototype.intValue=function(){return Math.trunc(this._hi)},Be.prototype.toString=function(){var l=Be.magnitude(this._hi);return l>=-3&&l<=20?this.toStandardNotation():this.toSciNotation()},Be.prototype.toStandardNotation=function(){var l=this.getSpecialNumberString();if(null!==l)return l;var h=new Array(1).fill(null),_=this.extractSignificantDigits(!0,h),w=h[0]+1,I=_;return"."===_.charAt(0)?I="0"+_:w<0?I="0."+Be.stringOfChar("0",-w)+_:-1===_.indexOf(".")&&(I=_+Be.stringOfChar("0",w-_.length)+".0"),this.isNegative()?"-"+I:I},Be.prototype.reciprocal=function(){var h,w,I,q,l=null,_=null,U=null,he=null;h=(I=1/this._hi)-(l=(U=Be.SPLIT*I)-(l=U-I)),_=(he=Be.SPLIT*this._hi)-this._hi;var ke=I+(U=(1-(q=I*this._hi)-(he=l*(_=he-_)-q+l*(w=this._hi-_)+h*_+h*w)-I*this._lo)/this._hi);return new Be(ke,I-ke+U)},Be.prototype.toSciNotation=function(){if(this.isZero())return Be.SCI_NOT_ZERO;var l=this.getSpecialNumberString();if(null!==l)return l;var h=new Array(1).fill(null),_=this.extractSignificantDigits(!1,h),w=Be.SCI_NOT_EXPONENT_CHAR+h[0];if("0"===_.charAt(0))throw new Error("Found leading zero: "+_);var I="";_.length>1&&(I=_.substring(1));var U=_.charAt(0)+"."+I;return this.isNegative()?"-"+U+w:U+w},Be.prototype.abs=function(){return this.isNaN()?Be.NaN:this.isNegative()?this.negate():new Be(this)},Be.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Be.prototype.lt=function(l){return(this._hi<l._hi||this._hi===l._hi)&&this._lo<l._lo},Be.prototype.add=function(){if(arguments[0]instanceof Be){var l=arguments[0];return Be.copy(this).selfAdd(l)}if("number"==typeof arguments[0]){var h=arguments[0];return Be.copy(this).selfAdd(h)}},Be.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Be){var h=arguments[0];this._hi=h._hi,this._lo=h._lo}}else if(2===arguments.length){var w=arguments[1];this._hi=arguments[0],this._lo=w}},Be.prototype.gt=function(l){return(this._hi>l._hi||this._hi===l._hi)&&this._lo>l._lo},Be.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Be.prototype.trunc=function(){return this.isNaN()?Be.NaN:this.isPositive()?this.floor():this.ceil()},Be.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Be.prototype.interfaces_=function(){return[de,oe,le]},Be.prototype.getClass=function(){return Be},Be.sqr=function(l){return Be.valueOf(l).selfMultiply(l)},Be.valueOf=function(){return"string"==typeof arguments[0]?Be.parse(arguments[0]):"number"==typeof arguments[0]?new Be(arguments[0]):void 0},Be.sqrt=function(l){return Be.valueOf(l).sqrt()},Be.parse=function(l){for(var h=0,_=l.length;xt.isWhitespace(l.charAt(h));)h++;var w=!1;if(h<_){var I=l.charAt(h);"-"!==I&&"+"!==I||(h++,"-"===I&&(w=!0))}for(var U=new Be,q=0,he=0,ke=0;!(h>=_);){var wt=l.charAt(h);if(h++,xt.isDigit(wt)){var vt=wt-"0";U.selfMultiply(Be.TEN),U.selfAdd(vt),q++}else{if("."!==wt){if("e"===wt||"E"===wt){var on=l.substring(h);try{ke=gt.parseInt(on)}catch(to){throw to instanceof Error?new Error("Invalid exponent "+on+" in string "+l):to}break}throw new Error("Unexpected character '"+wt+"' at position "+h+" in string "+l)}he=q}}var Gn=U,qn=q-he-ke;if(0===qn)Gn=U;else if(qn>0){var hr=Be.TEN.pow(qn);Gn=U.divide(hr)}else if(qn<0){var Lr=Be.TEN.pow(-qn);Gn=U.multiply(Lr)}return w?Gn.negate():Gn},Be.createNaN=function(){return new Be(te.NaN,te.NaN)},Be.copy=function(l){return new Be(l)},Be.magnitude=function(l){var h=Math.abs(l),_=Math.log(h)/Math.log(10),w=Math.trunc(Math.floor(_));return 10*Math.pow(10,w)<=h&&(w+=1),w},Be.stringOfChar=function(l,h){for(var _=new Xe,w=0;w<h;w++)_.append(l);return _.toString()},qt.PI.get=function(){return new Be(3.141592653589793,12246467991473532e-32)},qt.TWO_PI.get=function(){return new Be(6.283185307179586,24492935982947064e-32)},qt.PI_2.get=function(){return new Be(1.5707963267948966,6123233995736766e-32)},qt.E.get=function(){return new Be(2.718281828459045,14456468917292502e-32)},qt.NaN.get=function(){return new Be(te.NaN,te.NaN)},qt.EPS.get=function(){return 123259516440783e-46},qt.SPLIT.get=function(){return 134217729},qt.MAX_PRINT_DIGITS.get=function(){return 32},qt.TEN.get=function(){return Be.valueOf(10)},qt.ONE.get=function(){return Be.valueOf(1)},qt.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},qt.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Be,qt);var $t=function(){},pn={DP_SAFE_EPSILON:{configurable:!0}};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t},$t.orientationIndex=function(l,h,_){var w=$t.orientationIndexFilter(l,h,_);if(w<=1)return w;var I=Be.valueOf(h.x).selfAdd(-l.x),U=Be.valueOf(h.y).selfAdd(-l.y),q=Be.valueOf(_.x).selfAdd(-h.x),he=Be.valueOf(_.y).selfAdd(-h.y);return I.selfMultiply(he).selfSubtract(U.selfMultiply(q)).signum()},$t.signOfDet2x2=function(l,h,_,w){return l.multiply(w).selfSubtract(h.multiply(_)).signum()},$t.intersection=function(l,h,_,w){var I=Be.valueOf(w.y).selfSubtract(_.y).selfMultiply(Be.valueOf(h.x).selfSubtract(l.x)),U=Be.valueOf(w.x).selfSubtract(_.x).selfMultiply(Be.valueOf(h.y).selfSubtract(l.y)),q=I.subtract(U),he=Be.valueOf(w.x).selfSubtract(_.x).selfMultiply(Be.valueOf(l.y).selfSubtract(_.y)),ke=Be.valueOf(w.y).selfSubtract(_.y).selfMultiply(Be.valueOf(l.x).selfSubtract(_.x)),wt=he.subtract(ke).selfDivide(q).doubleValue(),vt=Be.valueOf(l.x).selfAdd(Be.valueOf(h.x).selfSubtract(l.x).selfMultiply(wt)).doubleValue(),on=Be.valueOf(h.x).selfSubtract(l.x).selfMultiply(Be.valueOf(l.y).selfSubtract(_.y)),Gn=Be.valueOf(h.y).selfSubtract(l.y).selfMultiply(Be.valueOf(l.x).selfSubtract(_.x)),qn=on.subtract(Gn).selfDivide(q).doubleValue(),hr=Be.valueOf(_.y).selfAdd(Be.valueOf(w.y).selfSubtract(_.y).selfMultiply(qn)).doubleValue();return new ne(vt,hr)},$t.orientationIndexFilter=function(l,h,_){var w=null,I=(l.x-_.x)*(h.y-_.y),U=(l.y-_.y)*(h.x-_.x),q=I-U;if(I>0){if(U<=0)return $t.signum(q);w=I+U}else{if(!(I<0)||U>=0)return $t.signum(q);w=-I-U}var he=$t.DP_SAFE_EPSILON*w;return q>=he||-q>=he?$t.signum(q):2},$t.signum=function(l){return l>0?1:l<0?-1:0},pn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties($t,pn);var At=function(){},Sn={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Sn.X.get=function(){return 0},Sn.Y.get=function(){return 1},Sn.Z.get=function(){return 2},Sn.M.get=function(){return 3},At.prototype.setOrdinate=function(l,h,_){},At.prototype.size=function(){},At.prototype.getOrdinate=function(l,h){},At.prototype.getCoordinate=function(){},At.prototype.getCoordinateCopy=function(l){},At.prototype.getDimension=function(){},At.prototype.getX=function(l){},At.prototype.clone=function(){},At.prototype.expandEnvelope=function(l){},At.prototype.copy=function(){},At.prototype.getY=function(l){},At.prototype.toCoordinateArray=function(){},At.prototype.interfaces_=function(){return[le]},At.prototype.getClass=function(){return At},Object.defineProperties(At,Sn);var Yn=function(){},Kn=function(l){function h(){l.call(this,"Projective point not representable on the Cartesian plane.")}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Yn),pr=function(){};pr.arraycopy=function(l,h,_,w,I){for(var U=0,q=h;q<h+I;q++)_[w+U]=l[q],U++},pr.getProperty=function(l){return{"line.separator":"\n"}[l]};var Un=function l(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var w=arguments[1];this.x=arguments[0],this.y=w,this.w=1}else if(arguments[0]instanceof l&&arguments[1]instanceof l){var I=arguments[0],U=arguments[1];this.x=I.y*U.w-U.y*I.w,this.y=U.x*I.w-I.x*U.w,this.w=I.x*U.y-U.x*I.y}else if(arguments[0]instanceof ne&&arguments[1]instanceof ne){var q=arguments[0],he=arguments[1];this.x=q.y-he.y,this.y=he.x-q.x,this.w=q.x*he.y-he.x*q.y}}else if(3===arguments.length){var wt=arguments[1],vt=arguments[2];this.x=arguments[0],this.y=wt,this.w=vt}else if(4===arguments.length){var on=arguments[0],Gn=arguments[1],qn=arguments[2],hr=arguments[3],Lr=on.y-Gn.y,to=Gn.x-on.x,Ps=on.x*Gn.y-Gn.x*on.y,ka=qn.y-hr.y,Pl=hr.x-qn.x,ku=qn.x*hr.y-hr.x*qn.y;this.x=to*ku-Pl*Ps,this.y=ka*Ps-Lr*ku,this.w=Lr*Pl-ka*to}};Un.prototype.getY=function(){var l=this.y/this.w;if(te.isNaN(l)||te.isInfinite(l))throw new Kn;return l},Un.prototype.getX=function(){var l=this.x/this.w;if(te.isNaN(l)||te.isInfinite(l))throw new Kn;return l},Un.prototype.getCoordinate=function(){var l=new ne;return l.x=this.getX(),l.y=this.getY(),l},Un.prototype.interfaces_=function(){return[]},Un.prototype.getClass=function(){return Un},Un.intersection=function(l,h,_,w){var I=l.y-h.y,U=h.x-l.x,q=l.x*h.y-h.x*l.y,he=_.y-w.y,ke=w.x-_.x,wt=_.x*w.y-w.x*_.y,vt=I*ke-he*U,on=(U*wt-ke*q)/vt,Gn=(he*q-I*wt)/vt;if(te.isNaN(on)||te.isInfinite(on)||te.isNaN(Gn)||te.isInfinite(Gn))throw new Kn;return new ne(on,Gn)};var Rn=function l(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof ne){var h=arguments[0];this.init(h.x,h.x,h.y,h.y)}else arguments[0]instanceof l&&this.init(arguments[0]);else if(2===arguments.length){var w=arguments[0],I=arguments[1];this.init(w.x,I.x,w.y,I.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Jn={serialVersionUID:{configurable:!0}};Rn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Rn.prototype.equals=function(l){if(!(l instanceof Rn))return!1;var h=l;return this.isNull()?h.isNull():this._maxx===h.getMaxX()&&this._maxy===h.getMaxY()&&this._minx===h.getMinX()&&this._miny===h.getMinY()},Rn.prototype.intersection=function(l){return this.isNull()||l.isNull()||!this.intersects(l)?new Rn:new Rn(this._minx>l._minx?this._minx:l._minx,this._maxx<l._maxx?this._maxx:l._maxx,this._miny>l._miny?this._miny:l._miny,this._maxy<l._maxy?this._maxy:l._maxy)},Rn.prototype.isNull=function(){return this._maxx<this._minx},Rn.prototype.getMaxX=function(){return this._maxx},Rn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof ne){var l=arguments[0];return this.covers(l.x,l.y)}if(arguments[0]instanceof Rn){var h=arguments[0];return!this.isNull()&&!h.isNull()&&h.getMinX()>=this._minx&&h.getMaxX()<=this._maxx&&h.getMinY()>=this._miny&&h.getMaxY()<=this._maxy}}else if(2===arguments.length){var _=arguments[0],w=arguments[1];return!this.isNull()&&_>=this._minx&&_<=this._maxx&&w>=this._miny&&w<=this._maxy}},Rn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Rn){var l=arguments[0];return!this.isNull()&&!l.isNull()&&!(l._minx>this._maxx||l._maxx<this._minx||l._miny>this._maxy||l._maxy<this._miny)}if(arguments[0]instanceof ne){var h=arguments[0];return this.intersects(h.x,h.y)}}else if(2===arguments.length){var _=arguments[0],w=arguments[1];return!this.isNull()&&!(_>this._maxx||_<this._minx||w>this._maxy||w<this._miny)}},Rn.prototype.getMinY=function(){return this._miny},Rn.prototype.getMinX=function(){return this._minx},Rn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof ne){var l=arguments[0];this.expandToInclude(l.x,l.y)}else if(arguments[0]instanceof Rn){var h=arguments[0];if(h.isNull())return null;this.isNull()?(this._minx=h.getMinX(),this._maxx=h.getMaxX(),this._miny=h.getMinY(),this._maxy=h.getMaxY()):(h._minx<this._minx&&(this._minx=h._minx),h._maxx>this._maxx&&(this._maxx=h._maxx),h._miny<this._miny&&(this._miny=h._miny),h._maxy>this._maxy&&(this._maxy=h._maxy))}}else if(2===arguments.length){var _=arguments[0],w=arguments[1];this.isNull()?(this._minx=_,this._maxx=_,this._miny=w,this._maxy=w):(_<this._minx&&(this._minx=_),_>this._maxx&&(this._maxx=_),w<this._miny&&(this._miny=w),w>this._maxy&&(this._maxy=w))}},Rn.prototype.minExtent=function(){if(this.isNull())return 0;var l=this.getWidth(),h=this.getHeight();return l<h?l:h},Rn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Rn.prototype.compareTo=function(l){var h=l;return this.isNull()?h.isNull()?0:-1:h.isNull()?1:this._minx<h._minx?-1:this._minx>h._minx?1:this._miny<h._miny?-1:this._miny>h._miny?1:this._maxx<h._maxx?-1:this._maxx>h._maxx?1:this._maxy<h._maxy?-1:this._maxy>h._maxy?1:0},Rn.prototype.translate=function(l,h){if(this.isNull())return null;this.init(this.getMinX()+l,this.getMaxX()+l,this.getMinY()+h,this.getMaxY()+h)},Rn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Rn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Rn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Rn.prototype.maxExtent=function(){if(this.isNull())return 0;var l=this.getWidth(),h=this.getHeight();return l>h?l:h},Rn.prototype.expandBy=function(){if(1===arguments.length){var l=arguments[0];this.expandBy(l,l)}else if(2===arguments.length){var h=arguments[0],_=arguments[1];if(this.isNull())return null;this._minx-=h,this._maxx+=h,this._miny-=_,this._maxy+=_,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Rn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Rn)return this.covers(arguments[0]);if(arguments[0]instanceof ne)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},Rn.prototype.centre=function(){return this.isNull()?null:new ne((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Rn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof ne){var l=arguments[0];this.init(l.x,l.x,l.y,l.y)}else if(arguments[0]instanceof Rn){var h=arguments[0];this._minx=h._minx,this._maxx=h._maxx,this._miny=h._miny,this._maxy=h._maxy}}else if(2===arguments.length){var _=arguments[0],w=arguments[1];this.init(_.x,w.x,_.y,w.y)}else if(4===arguments.length){var I=arguments[0],U=arguments[1],q=arguments[2],he=arguments[3];I<U?(this._minx=I,this._maxx=U):(this._minx=U,this._maxx=I),q<he?(this._miny=q,this._maxy=he):(this._miny=he,this._maxy=q)}},Rn.prototype.getMaxY=function(){return this._maxy},Rn.prototype.distance=function(l){if(this.intersects(l))return 0;var h=0;this._maxx<l._minx?h=l._minx-this._maxx:this._minx>l._maxx&&(h=this._minx-l._maxx);var _=0;return this._maxy<l._miny?_=l._miny-this._maxy:this._miny>l._maxy&&(_=this._miny-l._maxy),0===h?_:0===_?h:Math.sqrt(h*h+_*_)},Rn.prototype.hashCode=function(){var l=17;return 37*(l=37*(l=37*(l=37*l+ne.hashCode(this._minx))+ne.hashCode(this._maxx))+ne.hashCode(this._miny))+ne.hashCode(this._maxy)},Rn.prototype.interfaces_=function(){return[oe,de]},Rn.prototype.getClass=function(){return Rn},Rn.intersects=function(){if(3===arguments.length){var l=arguments[0],h=arguments[1],_=arguments[2];return _.x>=(l.x<h.x?l.x:h.x)&&_.x<=(l.x>h.x?l.x:h.x)&&_.y>=(l.y<h.y?l.y:h.y)&&_.y<=(l.y>h.y?l.y:h.y)}if(4===arguments.length){var w=arguments[0],I=arguments[1],U=arguments[2],q=arguments[3],he=Math.min(U.x,q.x),ke=Math.max(U.x,q.x),wt=Math.min(w.x,I.x),vt=Math.max(w.x,I.x);return!(wt>ke||vt<he||(he=Math.min(U.y,q.y),ke=Math.max(U.y,q.y),wt=Math.min(w.y,I.y),vt=Math.max(w.y,I.y),wt>ke||vt<he))}},Jn.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Rn,Jn);var Ei={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Ai=function(l){this.geometryFactory=l||new at};Ai.prototype.read=function(l){var h,_;l=l.replace(/[\n\r]/g," ");var I=Ei.typeStr.exec(l);if(-1!==l.search("EMPTY")&&((I=Ei.emptyTypeStr.exec(l))[2]=void 0),I&&(_=I[1].toLowerCase(),zr[_]&&(h=zr[_].apply(this,[I[2]]))),void 0===h)throw new Error("Could not parse WKT "+l);return h},Ai.prototype.write=function(l){return this.extractGeometry(l)},Ai.prototype.extractGeometry=function(l){var h=l.getGeometryType().toLowerCase();if(!Sr[h])return null;var _=h.toUpperCase();return l.isEmpty()?_+" EMPTY":_+"("+Sr[h].apply(this,[l])+")"};var Sr={coordinate:function(l){return l.x+" "+l.y},point:function(l){return Sr.coordinate.call(this,l._coordinates._coordinates[0])},multipoint:function(l){for(var h=[],_=0,w=l._geometries.length;_<w;++_)h.push("("+Sr.point.apply(this,[l._geometries[_]])+")");return h.join(",")},linestring:function(l){for(var h=[],_=0,w=l._points._coordinates.length;_<w;++_)h.push(Sr.coordinate.apply(this,[l._points._coordinates[_]]));return h.join(",")},linearring:function(l){for(var h=[],_=0,w=l._points._coordinates.length;_<w;++_)h.push(Sr.coordinate.apply(this,[l._points._coordinates[_]]));return h.join(",")},multilinestring:function(l){for(var h=[],_=0,w=l._geometries.length;_<w;++_)h.push("("+Sr.linestring.apply(this,[l._geometries[_]])+")");return h.join(",")},polygon:function(l){var h=[];h.push("("+Sr.linestring.apply(this,[l._shell])+")");for(var _=0,w=l._holes.length;_<w;++_)h.push("("+Sr.linestring.apply(this,[l._holes[_]])+")");return h.join(",")},multipolygon:function(l){for(var h=[],_=0,w=l._geometries.length;_<w;++_)h.push("("+Sr.polygon.apply(this,[l._geometries[_]])+")");return h.join(",")},geometrycollection:function(l){for(var h=[],_=0,w=l._geometries.length;_<w;++_)h.push(this.extractGeometry(l._geometries[_]));return h.join(",")}},zr={point:function(l){if(void 0===l)return this.geometryFactory.createPoint();var h=l.trim().split(Ei.spaces);return this.geometryFactory.createPoint(new ne(Number.parseFloat(h[0]),Number.parseFloat(h[1])))},multipoint:function(l){if(void 0===l)return this.geometryFactory.createMultiPoint();for(var h,_=l.trim().split(","),w=[],I=0,U=_.length;I<U;++I)h=_[I].replace(Ei.trimParens,"$1"),w.push(zr.point.apply(this,[h]));return this.geometryFactory.createMultiPoint(w)},linestring:function(l){if(void 0===l)return this.geometryFactory.createLineString();for(var h,_=l.trim().split(","),w=[],I=0,U=_.length;I<U;++I)h=_[I].trim().split(Ei.spaces),w.push(new ne(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLineString(w)},linearring:function(l){if(void 0===l)return this.geometryFactory.createLinearRing();for(var h,_=l.trim().split(","),w=[],I=0,U=_.length;I<U;++I)h=_[I].trim().split(Ei.spaces),w.push(new ne(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLinearRing(w)},multilinestring:function(l){if(void 0===l)return this.geometryFactory.createMultiLineString();for(var h,_=l.trim().split(Ei.parenComma),w=[],I=0,U=_.length;I<U;++I)h=_[I].replace(Ei.trimParens,"$1"),w.push(zr.linestring.apply(this,[h]));return this.geometryFactory.createMultiLineString(w)},polygon:function(l){if(void 0===l)return this.geometryFactory.createPolygon();for(var h,_,w,I,U=l.trim().split(Ei.parenComma),q=[],he=0,ke=U.length;he<ke;++he)h=U[he].replace(Ei.trimParens,"$1"),_=zr.linestring.apply(this,[h]),w=this.geometryFactory.createLinearRing(_._points),0===he?I=w:q.push(w);return this.geometryFactory.createPolygon(I,q)},multipolygon:function(l){if(void 0===l)return this.geometryFactory.createMultiPolygon();for(var h,_=l.trim().split(Ei.doubleParenComma),w=[],I=0,U=_.length;I<U;++I)h=_[I].replace(Ei.trimParens,"$1"),w.push(zr.polygon.apply(this,[h]));return this.geometryFactory.createMultiPolygon(w)},geometrycollection:function(l){if(void 0===l)return this.geometryFactory.createGeometryCollection();for(var h=(l=l.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),_=[],w=0,I=h.length;w<I;++w)_.push(this.read(h[w]));return this.geometryFactory.createGeometryCollection(_)}},Nt=function(l){this.parser=new Ai(l)};Nt.prototype.write=function(l){return this.parser.write(l)},Nt.toLineString=function(l,h){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+l.x+" "+l.y+", "+h.x+" "+h.y+" )"};var Le=function(l){function h(_){l.call(this,_),this.name="RuntimeException",this.message=_,this.stack=(new l).stack}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(Error),De=function(l){function h(){l.call(this),0===arguments.length?l.call(this):1===arguments.length&&l.call(this,arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Le),Me=function(){};Me.prototype.interfaces_=function(){return[]},Me.prototype.getClass=function(){return Me},Me.shouldNeverReachHere=function(){if(0===arguments.length)Me.shouldNeverReachHere(null);else if(1===arguments.length){var l=arguments[0];throw new De("Should never reach here"+(null!==l?": "+l:""))}},Me.isTrue=function(){var h;if(1===arguments.length)Me.isTrue(arguments[0],null);else if(2===arguments.length&&(h=arguments[1],!arguments[0]))throw null===h?new De:new De(h)},Me.equals=function(){var l,h,_;if(2===arguments.length)Me.equals(l=arguments[0],h=arguments[1],null);else if(3===arguments.length&&(_=arguments[2],!(h=arguments[1]).equals(l=arguments[0])))throw new De("Expected "+l+" but encountered "+h+(null!==_?": "+_:""))};var Ke=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new ne,this._intPt[1]=new ne,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},St={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Ke.prototype.getIndexAlongSegment=function(l,h){return this.computeIntLineIndex(),this._intLineIndex[l][h]},Ke.prototype.getTopologySummary=function(){var l=new Xe;return this.isEndPoint()&&l.append(" endpoint"),this._isProper&&l.append(" proper"),this.isCollinear()&&l.append(" collinear"),l.toString()},Ke.prototype.computeIntersection=function(l,h,_,w){this._inputLines[0][0]=l,this._inputLines[0][1]=h,this._inputLines[1][0]=_,this._inputLines[1][1]=w,this._result=this.computeIntersect(l,h,_,w)},Ke.prototype.getIntersectionNum=function(){return this._result},Ke.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var l=arguments[0];this.getEdgeDistance(l,0)>this.getEdgeDistance(l,1)?(this._intLineIndex[l][0]=0,this._intLineIndex[l][1]=1):(this._intLineIndex[l][0]=1,this._intLineIndex[l][1]=0)}},Ke.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Ke.prototype.setPrecisionModel=function(l){this._precisionModel=l},Ke.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var l=arguments[0],h=0;h<this._result;h++)if(!this._intPt[h].equals2D(this._inputLines[l][0])&&!this._intPt[h].equals2D(this._inputLines[l][1]))return!0;return!1}},Ke.prototype.getIntersection=function(l){return this._intPt[l]},Ke.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Ke.prototype.hasIntersection=function(){return this._result!==Ke.NO_INTERSECTION},Ke.prototype.getEdgeDistance=function(l,h){return Ke.computeEdgeDistance(this._intPt[h],this._inputLines[l][0],this._inputLines[l][1])},Ke.prototype.isCollinear=function(){return this._result===Ke.COLLINEAR_INTERSECTION},Ke.prototype.toString=function(){return Nt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Nt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Ke.prototype.getEndpoint=function(l,h){return this._inputLines[l][h]},Ke.prototype.isIntersection=function(l){for(var h=0;h<this._result;h++)if(this._intPt[h].equals2D(l))return!0;return!1},Ke.prototype.getIntersectionAlongSegment=function(l,h){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[l][h]]},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke},Ke.computeEdgeDistance=function(l,h,_){var w=Math.abs(_.x-h.x),I=Math.abs(_.y-h.y),U=-1;if(l.equals(h))U=0;else if(l.equals(_))U=w>I?w:I;else{var q=Math.abs(l.x-h.x),he=Math.abs(l.y-h.y);0!==(U=w>I?q:he)||l.equals(h)||(U=Math.max(q,he))}return Me.isTrue(!(0===U&&!l.equals(h)),"Bad distance calculation"),U},Ke.nonRobustComputeEdgeDistance=function(l,h,_){var w=l.x-h.x,I=l.y-h.y,U=Math.sqrt(w*w+I*I);return Me.isTrue(!(0===U&&!l.equals(h)),"Invalid distance calculation"),U},St.DONT_INTERSECT.get=function(){return 0},St.DO_INTERSECT.get=function(){return 1},St.COLLINEAR.get=function(){return 2},St.NO_INTERSECTION.get=function(){return 0},St.POINT_INTERSECTION.get=function(){return 1},St.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Ke,St);var Jt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isInSegmentEnvelopes=function(_){var w=new Rn(this._inputLines[0][0],this._inputLines[0][1]),I=new Rn(this._inputLines[1][0],this._inputLines[1][1]);return w.contains(_)&&I.contains(_)},h.prototype.computeIntersection=function(){if(3!==arguments.length)return l.prototype.computeIntersection.apply(this,arguments);var _=arguments[0],w=arguments[1],I=arguments[2];if(this._isProper=!1,Rn.intersects(w,I,_)&&0===un.orientationIndex(w,I,_)&&0===un.orientationIndex(I,w,_))return this._isProper=!0,(_.equals(w)||_.equals(I))&&(this._isProper=!1),this._result=l.POINT_INTERSECTION,null;this._result=l.NO_INTERSECTION},h.prototype.normalizeToMinimum=function(_,w,I,U,q){q.x=this.smallestInAbsValue(_.x,w.x,I.x,U.x),q.y=this.smallestInAbsValue(_.y,w.y,I.y,U.y),_.x-=q.x,_.y-=q.y,w.x-=q.x,w.y-=q.y,I.x-=q.x,I.y-=q.y,U.x-=q.x,U.y-=q.y},h.prototype.safeHCoordinateIntersection=function(_,w,I,U){var q=null;try{q=Un.intersection(_,w,I,U)}catch(he){if(!(he instanceof Kn))throw he;q=h.nearestEndpoint(_,w,I,U)}return q},h.prototype.intersection=function(_,w,I,U){var q=this.intersectionWithNormalization(_,w,I,U);return this.isInSegmentEnvelopes(q)||(q=new ne(h.nearestEndpoint(_,w,I,U))),null!==this._precisionModel&&this._precisionModel.makePrecise(q),q},h.prototype.smallestInAbsValue=function(_,w,I,U){var q=_,he=Math.abs(q);return Math.abs(w)<he&&(q=w,he=Math.abs(w)),Math.abs(I)<he&&(q=I,he=Math.abs(I)),Math.abs(U)<he&&(q=U),q},h.prototype.checkDD=function(_,w,I,U,q){var he=$t.intersection(_,w,I,U),ke=this.isInSegmentEnvelopes(he);pr.out.println("DD in env = "+ke+"  --------------------- "+he),q.distance(he)>1e-4&&pr.out.println("Distance = "+q.distance(he))},h.prototype.intersectionWithNormalization=function(_,w,I,U){var q=new ne(_),he=new ne(w),ke=new ne(I),wt=new ne(U),vt=new ne;this.normalizeToEnvCentre(q,he,ke,wt,vt);var on=this.safeHCoordinateIntersection(q,he,ke,wt);return on.x+=vt.x,on.y+=vt.y,on},h.prototype.computeCollinearIntersection=function(_,w,I,U){var q=Rn.intersects(_,w,I),he=Rn.intersects(_,w,U),ke=Rn.intersects(I,U,_),wt=Rn.intersects(I,U,w);return q&&he?(this._intPt[0]=I,this._intPt[1]=U,l.COLLINEAR_INTERSECTION):ke&&wt?(this._intPt[0]=_,this._intPt[1]=w,l.COLLINEAR_INTERSECTION):q&&ke?(this._intPt[0]=I,this._intPt[1]=_,!I.equals(_)||he||wt?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):q&&wt?(this._intPt[0]=I,this._intPt[1]=w,!I.equals(w)||he||ke?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):he&&ke?(this._intPt[0]=U,this._intPt[1]=_,!U.equals(_)||q||wt?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):he&&wt?(this._intPt[0]=U,this._intPt[1]=w,!U.equals(w)||q||ke?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):l.NO_INTERSECTION},h.prototype.normalizeToEnvCentre=function(_,w,I,U,q){var he=_.x<w.x?_.x:w.x,ke=_.y<w.y?_.y:w.y,wt=_.x>w.x?_.x:w.x,vt=_.y>w.y?_.y:w.y,on=I.x<U.x?I.x:U.x,Gn=I.y<U.y?I.y:U.y,qn=I.x>U.x?I.x:U.x,hr=I.y>U.y?I.y:U.y,to=((ke>Gn?ke:Gn)+(vt<hr?vt:hr))/2;q.x=((he>on?he:on)+(wt<qn?wt:qn))/2,q.y=to,_.x-=q.x,_.y-=q.y,w.x-=q.x,w.y-=q.y,I.x-=q.x,I.y-=q.y,U.x-=q.x,U.y-=q.y},h.prototype.computeIntersect=function(_,w,I,U){if(this._isProper=!1,!Rn.intersects(_,w,I,U))return l.NO_INTERSECTION;var q=un.orientationIndex(_,w,I),he=un.orientationIndex(_,w,U);if(q>0&&he>0||q<0&&he<0)return l.NO_INTERSECTION;var ke=un.orientationIndex(I,U,_),wt=un.orientationIndex(I,U,w);return ke>0&&wt>0||ke<0&&wt<0?l.NO_INTERSECTION:0===q&&0===he&&0===ke&&0===wt?this.computeCollinearIntersection(_,w,I,U):(0===q||0===he||0===ke||0===wt?(this._isProper=!1,_.equals2D(I)||_.equals2D(U)?this._intPt[0]=_:w.equals2D(I)||w.equals2D(U)?this._intPt[0]=w:0===q?this._intPt[0]=new ne(I):0===he?this._intPt[0]=new ne(U):0===ke?this._intPt[0]=new ne(_):0===wt&&(this._intPt[0]=new ne(w))):(this._isProper=!0,this._intPt[0]=this.intersection(_,w,I,U)),l.POINT_INTERSECTION)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.nearestEndpoint=function(_,w,I,U){var q=_,he=un.distancePointLine(_,I,U),ke=un.distancePointLine(w,I,U);return ke<he&&(he=ke,q=w),(ke=un.distancePointLine(I,_,w))<he&&(he=ke,q=I),(ke=un.distancePointLine(U,_,w))<he&&(he=ke,q=U),q},h}(Ke),En=function(){};En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},En.orientationIndex=function(l,h,_){return En.signOfDet2x2(h.x-l.x,h.y-l.y,_.x-h.x,_.y-h.y)},En.signOfDet2x2=function(l,h,_,w){var I=null,U=null,q=null;if(I=1,0===l||0===w)return 0===h||0===_?0:h>0?_>0?-I:I:_>0?I:-I;if(0===h||0===_)return w>0?l>0?I:-I:l>0?-I:I;if(h>0?w>0?h<=w||(I=-I,U=l,l=_,_=U,U=h,h=w,w=U):h<=-w?(I=-I,_=-_,w=-w):(U=l,l=-_,_=U,U=h,h=-w,w=U):w>0?-h<=w?(I=-I,l=-l,h=-h):(U=-l,l=_,_=U,U=-h,h=w,w=U):h>=w?(l=-l,h=-h,_=-_,w=-w):(I=-I,U=-l,l=-_,_=U,U=-h,h=-w,w=U),l>0){if(!(_>0&&l<=_))return I}else{if(_>0||!(l>=_))return-I;I=-I,l=-l,_=-_}for(;;){if((w-=(q=Math.floor(_/l))*h)<0)return-I;if(w>h)return I;if(l>(_-=q*l)+_){if(h<w+w)return I}else{if(h>w+w)return-I;_=l-_,w=h-w,I=-I}if(0===w)return 0===_?0:-I;if(0===_||(l-=(q=Math.floor(l/_))*_,(h-=q*w)<0))return I;if(h>w)return-I;if(_>l+l){if(w<h+h)return-I}else{if(w>h+h)return I;l=_-l,h=w-h,I=-I}if(0===h)return 0===l?0:I;if(0===l)return-I}};var vn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};vn.prototype.countSegment=function(l,h){if(l.x<this._p.x&&h.x<this._p.x)return null;if(this._p.x===h.x&&this._p.y===h.y)return this._isPointOnSegment=!0,null;if(l.y===this._p.y&&h.y===this._p.y){var _=l.x,w=h.x;return _>w&&(_=h.x,w=l.x),this._p.x>=_&&this._p.x<=w&&(this._isPointOnSegment=!0),null}if(l.y>this._p.y&&h.y<=this._p.y||h.y>this._p.y&&l.y<=this._p.y){var U=l.y-this._p.y,he=h.y-this._p.y,ke=En.signOfDet2x2(l.x-this._p.x,U,h.x-this._p.x,he);if(0===ke)return this._isPointOnSegment=!0,null;he<U&&(ke=-ke),ke>0&&this._crossingCount++}},vn.prototype.isPointInPolygon=function(){return this.getLocation()!==Se.EXTERIOR},vn.prototype.getLocation=function(){return this._isPointOnSegment?Se.BOUNDARY:this._crossingCount%2==1?Se.INTERIOR:Se.EXTERIOR},vn.prototype.isOnSegment=function(){return this._isPointOnSegment},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn},vn.locatePointInRing=function(){if(arguments[0]instanceof ne&&Bt(arguments[1],At)){for(var h=arguments[1],_=new vn(arguments[0]),w=new ne,I=new ne,U=1;U<h.size();U++)if(h.getCoordinate(U,w),h.getCoordinate(U-1,I),_.countSegment(w,I),_.isOnSegment())return _.getLocation();return _.getLocation()}if(arguments[0]instanceof ne&&arguments[1]instanceof Array){for(var he=arguments[1],ke=new vn(arguments[0]),wt=1;wt<he.length;wt++)if(ke.countSegment(he[wt],he[wt-1]),ke.isOnSegment())return ke.getLocation();return ke.getLocation()}};var un=function(){},kr={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un},un.orientationIndex=function(l,h,_){return $t.orientationIndex(l,h,_)},un.signedArea=function(){if(arguments[0]instanceof Array){var l=arguments[0];if(l.length<3)return 0;for(var h=0,_=l[0].x,w=1;w<l.length-1;w++)h+=(l[w].x-_)*(l[w-1].y-l[w+1].y);return h/2}if(Bt(arguments[0],At)){var q=arguments[0],he=q.size();if(he<3)return 0;var ke=new ne,wt=new ne,vt=new ne;q.getCoordinate(0,wt),q.getCoordinate(1,vt);var on=wt.x;vt.x-=on;for(var Gn=0,qn=1;qn<he-1;qn++)ke.y=wt.y,wt.x=vt.x,wt.y=vt.y,q.getCoordinate(qn+1,vt),vt.x-=on,Gn+=wt.x*(ke.y-vt.y);return Gn/2}},un.distanceLineLine=function(l,h,_,w){if(l.equals(h))return un.distancePointLine(l,_,w);if(_.equals(w))return un.distancePointLine(w,l,h);var I=!1;if(Rn.intersects(l,h,_,w)){var U=(h.x-l.x)*(w.y-_.y)-(h.y-l.y)*(w.x-_.x);if(0===U)I=!0;else{var he=((l.y-_.y)*(h.x-l.x)-(l.x-_.x)*(h.y-l.y))/U,ke=((l.y-_.y)*(w.x-_.x)-(l.x-_.x)*(w.y-_.y))/U;(ke<0||ke>1||he<0||he>1)&&(I=!0)}}else I=!0;return I?$e.min(un.distancePointLine(l,_,w),un.distancePointLine(h,_,w),un.distancePointLine(_,l,h),un.distancePointLine(w,l,h)):0},un.isPointInRing=function(l,h){return un.locatePointInRing(l,h)!==Se.EXTERIOR},un.computeLength=function(l){var h=l.size();if(h<=1)return 0;var _=0,w=new ne;l.getCoordinate(0,w);for(var I=w.x,U=w.y,q=1;q<h;q++){l.getCoordinate(q,w);var he=w.x,ke=w.y,wt=he-I,vt=ke-U;_+=Math.sqrt(wt*wt+vt*vt),I=he,U=ke}return _},un.isCCW=function(l){var h=l.length-1;if(h<3)throw new Q("Ring has fewer than 4 points, so orientation cannot be determined");for(var _=l[0],w=0,I=1;I<=h;I++){var U=l[I];U.y>_.y&&(_=U,w=I)}var q=w;do{(q-=1)<0&&(q=h)}while(l[q].equals2D(_)&&q!==w);var he=w;do{he=(he+1)%h}while(l[he].equals2D(_)&&he!==w);var ke=l[q],wt=l[he];if(ke.equals2D(_)||wt.equals2D(_)||ke.equals2D(wt))return!1;var vt=un.computeOrientation(ke,_,wt);return 0===vt?ke.x>wt.x:vt>0},un.locatePointInRing=function(l,h){return vn.locatePointInRing(l,h)},un.distancePointLinePerpendicular=function(l,h,_){var w=(_.x-h.x)*(_.x-h.x)+(_.y-h.y)*(_.y-h.y);return Math.abs(((h.y-l.y)*(_.x-h.x)-(h.x-l.x)*(_.y-h.y))/w)*Math.sqrt(w)},un.computeOrientation=function(l,h,_){return un.orientationIndex(l,h,_)},un.distancePointLine=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1];if(0===h.length)throw new Q("Line array must contain at least one vertex");for(var _=l.distance(h[0]),w=0;w<h.length-1;w++){var I=un.distancePointLine(l,h[w],h[w+1]);I<_&&(_=I)}return _}if(3===arguments.length){var U=arguments[0],q=arguments[1],he=arguments[2];if(q.x===he.x&&q.y===he.y)return U.distance(q);var ke=(he.x-q.x)*(he.x-q.x)+(he.y-q.y)*(he.y-q.y),wt=((U.x-q.x)*(he.x-q.x)+(U.y-q.y)*(he.y-q.y))/ke;return wt<=0?U.distance(q):wt>=1?U.distance(he):Math.abs(((q.y-U.y)*(he.x-q.x)-(q.x-U.x)*(he.y-q.y))/ke)*Math.sqrt(ke)}},un.isOnLine=function(l,h){for(var _=new Jt,w=1;w<h.length;w++)if(_.computeIntersection(l,h[w-1],h[w]),_.hasIntersection())return!0;return!1},kr.CLOCKWISE.get=function(){return-1},kr.RIGHT.get=function(){return un.CLOCKWISE},kr.COUNTERCLOCKWISE.get=function(){return 1},kr.LEFT.get=function(){return un.COUNTERCLOCKWISE},kr.COLLINEAR.get=function(){return 0},kr.STRAIGHT.get=function(){return un.COLLINEAR},Object.defineProperties(un,kr);var Xr=function(){};Xr.prototype.filter=function(l){},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr};var kn=function(){var l=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=l,this._SRID=l.getSRID()},ri={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};kn.prototype.isGeometryCollection=function(){return this.getSortIndex()===kn.SORTINDEX_GEOMETRYCOLLECTION},kn.prototype.getFactory=function(){return this._factory},kn.prototype.getGeometryN=function(l){return this},kn.prototype.getArea=function(){return 0},kn.prototype.isRectangle=function(){return!1},kn.prototype.equals=function(){if(arguments[0]instanceof kn){var l=arguments[0];return null!==l&&this.equalsTopo(l)}if(arguments[0]instanceof Object){var h=arguments[0];return h instanceof kn&&this.equalsExact(h)}},kn.prototype.equalsExact=function(l){return this===l||this.equalsExact(l,0)},kn.prototype.geometryChanged=function(){this.apply(kn.geometryChangedFilter)},kn.prototype.geometryChangedAction=function(){this._envelope=null},kn.prototype.equalsNorm=function(l){return null!==l&&this.norm().equalsExact(l.norm())},kn.prototype.getLength=function(){return 0},kn.prototype.getNumGeometries=function(){return 1},kn.prototype.compareTo=function(){if(1===arguments.length){var l=arguments[0],h=l;return this.getSortIndex()!==h.getSortIndex()?this.getSortIndex()-h.getSortIndex():this.isEmpty()&&h.isEmpty()?0:this.isEmpty()?-1:h.isEmpty()?1:this.compareToSameClass(l)}if(2===arguments.length){var _=arguments[0],w=arguments[1];return this.getSortIndex()!==_.getSortIndex()?this.getSortIndex()-_.getSortIndex():this.isEmpty()&&_.isEmpty()?0:this.isEmpty()?-1:_.isEmpty()?1:this.compareToSameClass(_,w)}},kn.prototype.getUserData=function(){return this._userData},kn.prototype.getSRID=function(){return this._SRID},kn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},kn.prototype.checkNotGeometryCollection=function(l){if(l.getSortIndex()===kn.SORTINDEX_GEOMETRYCOLLECTION)throw new Q("This method does not support GeometryCollection arguments")},kn.prototype.equal=function(l,h,_){return 0===_?l.equals(h):l.distance(h)<=_},kn.prototype.norm=function(){var l=this.copy();return l.normalize(),l},kn.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},kn.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Rn(this._envelope)},kn.prototype.setSRID=function(l){this._SRID=l},kn.prototype.setUserData=function(l){this._userData=l},kn.prototype.compare=function(l,h){for(var _=l.iterator(),w=h.iterator();_.hasNext()&&w.hasNext();){var I=_.next(),U=w.next(),q=I.compareTo(U);if(0!==q)return q}return _.hasNext()?1:w.hasNext()?-1:0},kn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},kn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===kn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===kn.SORTINDEX_MULTIPOINT||this.getSortIndex()===kn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===kn.SORTINDEX_MULTIPOLYGON},kn.prototype.interfaces_=function(){return[le,oe,de]},kn.prototype.getClass=function(){return kn},kn.hasNonEmptyElements=function(l){for(var h=0;h<l.length;h++)if(!l[h].isEmpty())return!0;return!1},kn.hasNullElements=function(l){for(var h=0;h<l.length;h++)if(null===l[h])return!0;return!1},ri.serialVersionUID.get=function(){return 0x799ea46522854c00},ri.SORTINDEX_POINT.get=function(){return 0},ri.SORTINDEX_MULTIPOINT.get=function(){return 1},ri.SORTINDEX_LINESTRING.get=function(){return 2},ri.SORTINDEX_LINEARRING.get=function(){return 3},ri.SORTINDEX_MULTILINESTRING.get=function(){return 4},ri.SORTINDEX_POLYGON.get=function(){return 5},ri.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ri.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ri.geometryChangedFilter.get=function(){return Hi},Object.defineProperties(kn,ri);var Hi=function(){};Hi.interfaces_=function(){return[Xr]},Hi.filter=function(l){l.geometryChangedAction()};var li=function(){};li.prototype.filter=function(l){},li.prototype.interfaces_=function(){return[]},li.prototype.getClass=function(){return li};var gi=function(){},oo={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};gi.prototype.isInBoundary=function(l){},gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi},oo.Mod2BoundaryNodeRule.get=function(){return xo},oo.EndPointBoundaryNodeRule.get=function(){return eo},oo.MultiValentEndPointBoundaryNodeRule.get=function(){return wo},oo.MonoValentEndPointBoundaryNodeRule.get=function(){return Bs},oo.MOD2_BOUNDARY_RULE.get=function(){return new xo},oo.ENDPOINT_BOUNDARY_RULE.get=function(){return new eo},oo.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new wo},oo.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Bs},oo.OGC_SFS_BOUNDARY_RULE.get=function(){return gi.MOD2_BOUNDARY_RULE},Object.defineProperties(gi,oo);var xo=function(){};xo.prototype.isInBoundary=function(l){return l%2==1},xo.prototype.interfaces_=function(){return[gi]},xo.prototype.getClass=function(){return xo};var eo=function(){};eo.prototype.isInBoundary=function(l){return l>0},eo.prototype.interfaces_=function(){return[gi]},eo.prototype.getClass=function(){return eo};var wo=function(){};wo.prototype.isInBoundary=function(l){return l>1},wo.prototype.interfaces_=function(){return[gi]},wo.prototype.getClass=function(){return wo};var Bs=function(){};Bs.prototype.isInBoundary=function(l){return 1===l},Bs.prototype.interfaces_=function(){return[gi]},Bs.prototype.getClass=function(){return Bs};var Li=function(){};Li.prototype.add=function(){},Li.prototype.addAll=function(){},Li.prototype.isEmpty=function(){},Li.prototype.iterator=function(){},Li.prototype.size=function(){},Li.prototype.toArray=function(){},Li.prototype.remove=function(){},(ye.prototype=new Error).name="IndexOutOfBoundsException";var ra=function(){};ra.prototype.hasNext=function(){},ra.prototype.next=function(){},ra.prototype.remove=function(){};var Ls=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.get=function(){},h.prototype.set=function(){},h.prototype.isEmpty=function(){},h}(Li);(Ce.prototype=new Error).name="NoSuchElementException";var Tn=function(l){function h(){l.call(this),this.array_=[],arguments[0]instanceof Li&&this.addAll(arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.ensureCapacity=function(){},h.prototype.interfaces_=function(){return[l,Li]},h.prototype.add=function(_){return 1===arguments.length?this.array_.push(_):this.array_.splice(arguments[0],arguments[1]),!0},h.prototype.clear=function(){this.array_=[]},h.prototype.addAll=function(_){for(var w=_.iterator();w.hasNext();)this.add(w.next());return!0},h.prototype.set=function(_,w){var I=this.array_[_];return this.array_[_]=w,I},h.prototype.iterator=function(){return new il(this)},h.prototype.get=function(_){if(_<0||_>=this.size())throw new ye;return this.array_[_]},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.size=function(){return this.array_.length},h.prototype.toArray=function(){for(var _=[],w=0,I=this.array_.length;w<I;w++)_.push(this.array_[w]);return _},h.prototype.remove=function(_){for(var w=!1,I=0,U=this.array_.length;I<U;I++)if(this.array_[I]===_){this.array_.splice(I,1),w=!0;break}return w},h}(Ls),il=function(l){function h(_){l.call(this),this.arrayList_=_,this.position_=0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Ce;return this.arrayList_.get(this.position_++)},h.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},h.prototype.set=function(_){return this.arrayList_.set(this.position_-1,_)},h.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},h}(ra),va=function(l){function h(){if(l.call(this),0!==arguments.length)if(1===arguments.length){var w=arguments[0];this.ensureCapacity(w.length),this.add(w,!0)}else if(2===arguments.length){var I=arguments[0],U=arguments[1];this.ensureCapacity(I.length),this.add(I,U)}}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={coordArrayType:{configurable:!0}};return _.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.getCoordinate=function(w){return this.get(w)},h.prototype.addAll=function(){if(2===arguments.length){for(var I=arguments[1],U=!1,q=arguments[0].iterator();q.hasNext();)this.add(q.next(),I),U=!0;return U}return l.prototype.addAll.apply(this,arguments)},h.prototype.clone=function(){for(var w=l.prototype.clone.call(this),I=0;I<this.size();I++)w.add(I,this.get(I).copy());return w},h.prototype.toCoordinateArray=function(){return this.toArray(h.coordArrayType)},h.prototype.add=function(){if(1===arguments.length)l.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof ne&&"boolean"==typeof arguments[1]){var q=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(q))return null;l.prototype.add.call(this,q)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var wt=arguments[0],vt=arguments[1];if(arguments[2])for(var on=0;on<wt.length;on++)this.add(wt[on],vt);else for(var Gn=wt.length-1;Gn>=0;Gn--)this.add(wt[Gn],vt);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof ne){var qn=arguments[0],hr=arguments[1];if(!arguments[2]){var Lr=this.size();if(Lr>0&&(qn>0&&this.get(qn-1).equals2D(hr)||qn<Lr&&this.get(qn).equals2D(hr)))return null}l.prototype.add.call(this,qn,hr)}}else if(4===arguments.length){var to=arguments[0],Ps=arguments[1],ka=arguments[2],Pl=arguments[3],ku=1;ka>Pl&&(ku=-1);for(var Sc=ka;Sc!==Pl;Sc+=ku)this.add(to[Sc],Ps);return!0}},h.prototype.closeRing=function(){this.size()>0&&this.add(new ne(this.get(0)),!1)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},Object.defineProperties(h,_),h}(Tn),Fr=function(){},Ua={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Ua.ForwardComparator.get=function(){return Is},Ua.BidirectionalComparator.get=function(){return Va},Ua.coordArrayType.get=function(){return new Array(0).fill(null)},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr},Fr.isRing=function(l){return!(l.length<4||!l[0].equals2D(l[l.length-1]))},Fr.ptNotInList=function(l,h){for(var _=0;_<l.length;_++){var w=l[_];if(Fr.indexOf(w,h)<0)return w}return null},Fr.scroll=function(l,h){var _=Fr.indexOf(h,l);if(_<0)return null;var w=new Array(l.length).fill(null);pr.arraycopy(l,_,w,0,l.length-_),pr.arraycopy(l,0,w,l.length-_,_),pr.arraycopy(w,0,l,0,l.length)},Fr.equals=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1];if(l===h)return!0;if(null===l||null===h||l.length!==h.length)return!1;for(var _=0;_<l.length;_++)if(!l[_].equals(h[_]))return!1;return!0}if(3===arguments.length){var w=arguments[0],I=arguments[1],U=arguments[2];if(w===I)return!0;if(null===w||null===I||w.length!==I.length)return!1;for(var q=0;q<w.length;q++)if(0!==U.compare(w[q],I[q]))return!1;return!0}},Fr.intersection=function(l,h){for(var _=new va,w=0;w<l.length;w++)h.intersects(l[w])&&_.add(l[w],!0);return _.toCoordinateArray()},Fr.hasRepeatedPoints=function(l){for(var h=1;h<l.length;h++)if(l[h-1].equals(l[h]))return!0;return!1},Fr.removeRepeatedPoints=function(l){return Fr.hasRepeatedPoints(l)?new va(l,!1).toCoordinateArray():l},Fr.reverse=function(l){for(var h=l.length-1,_=Math.trunc(h/2),w=0;w<=_;w++){var I=l[w];l[w]=l[h-w],l[h-w]=I}},Fr.removeNull=function(l){for(var h=0,_=0;_<l.length;_++)null!==l[_]&&h++;var w=new Array(h).fill(null);if(0===h)return w;for(var I=0,U=0;U<l.length;U++)null!==l[U]&&(w[I++]=l[U]);return w},Fr.copyDeep=function(){if(1===arguments.length){for(var l=arguments[0],h=new Array(l.length).fill(null),_=0;_<l.length;_++)h[_]=new ne(l[_]);return h}if(5===arguments.length)for(var w=arguments[0],I=arguments[1],U=arguments[2],q=arguments[3],he=arguments[4],ke=0;ke<he;ke++)U[q+ke]=new ne(w[I+ke])},Fr.isEqualReversed=function(l,h){for(var _=0;_<l.length;_++)if(0!==l[_].compareTo(h[l.length-_-1]))return!1;return!0},Fr.envelope=function(l){for(var h=new Rn,_=0;_<l.length;_++)h.expandToInclude(l[_]);return h},Fr.toCoordinateArray=function(l){return l.toArray(Fr.coordArrayType)},Fr.atLeastNCoordinatesOrNothing=function(l,h){return h.length>=l?h:[]},Fr.indexOf=function(l,h){for(var _=0;_<h.length;_++)if(l.equals(h[_]))return _;return-1},Fr.increasingDirection=function(l){for(var h=0;h<Math.trunc(l.length/2);h++){var w=l[h].compareTo(l[l.length-1-h]);if(0!==w)return w}return 1},Fr.compare=function(l,h){for(var _=0;_<l.length&&_<h.length;){var w=l[_].compareTo(h[_]);if(0!==w)return w;_++}return _<h.length?-1:_<l.length?1:0},Fr.minCoordinate=function(l){for(var h=null,_=0;_<l.length;_++)(null===h||h.compareTo(l[_])>0)&&(h=l[_]);return h},Fr.extract=function(l,h,_){h=$e.clamp(h,0,l.length);var w=(_=$e.clamp(_,-1,l.length))-h+1;_<0&&(w=0),h>=l.length&&(w=0),_<h&&(w=0);var I=new Array(w).fill(null);if(0===w)return I;for(var U=0,q=h;q<=_;q++)I[U++]=l[q];return I},Object.defineProperties(Fr,Ua);var Is=function(){};Is.prototype.compare=function(l,h){return Fr.compare(l,h)},Is.prototype.interfaces_=function(){return[me]},Is.prototype.getClass=function(){return Is};var Va=function(){};Va.prototype.compare=function(l,h){var _=l,w=h;if(_.length<w.length)return-1;if(_.length>w.length)return 1;if(0===_.length)return 0;var I=Fr.compare(_,w);return Fr.isEqualReversed(_,w)?0:I},Va.prototype.OLDcompare=function(l,h){var _=l,w=h;if(_.length<w.length)return-1;if(_.length>w.length)return 1;if(0===_.length)return 0;for(var I=Fr.increasingDirection(_),U=Fr.increasingDirection(w),q=I>0?0:_.length-1,he=U>0?0:_.length-1,ke=0;ke<_.length;ke++){var wt=_[q].compareTo(w[he]);if(0!==wt)return wt;q+=I,he+=U}return 0},Va.prototype.interfaces_=function(){return[me]},Va.prototype.getClass=function(){return Va};var Ze=function(){};Ze.prototype.get=function(){},Ze.prototype.put=function(){},Ze.prototype.size=function(){},Ze.prototype.values=function(){},Ze.prototype.entrySet=function(){};var ce=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(Ze);(p.prototype=new Error).name="OperationNotSupported",(K.prototype=new Li).contains=function(){};var be=function(l){function h(){l.call(this),this.array_=[],arguments[0]instanceof Li&&this.addAll(arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.contains=function(_){for(var w=0,I=this.array_.length;w<I;w++)if(this.array_[w]===_)return!0;return!1},h.prototype.add=function(_){return!this.contains(_)&&(this.array_.push(_),!0)},h.prototype.addAll=function(_){for(var w=_.iterator();w.hasNext();)this.add(w.next());return!0},h.prototype.remove=function(_){throw new Error},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var _=[],w=0,I=this.array_.length;w<I;w++)_.push(this.array_[w]);return _},h.prototype.iterator=function(){return new ze(this)},h}(K),ze=function(l){function h(_){l.call(this),this.hashSet_=_,this.position_=0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Ce;return this.hashSet_.array_[this.position_++]},h.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},h.prototype.remove=function(){throw new p},h}(ra),et=0;(nt.prototype=new ce).get=function(l){for(var h=this.root_;null!==h;){var _=l.compareTo(h.key);if(_<0)h=h.left;else{if(!(_>0))return h.value;h=h.right}}return null},nt.prototype.put=function(l,h){if(null===this.root_)return this.root_={key:l,value:h,left:null,right:null,parent:null,color:et,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var _,w,I=this.root_;do{if(_=I,(w=l.compareTo(I.key))<0)I=I.left;else{if(!(w>0)){var U=I.value;return I.value=h,U}I=I.right}}while(null!==I);var q={key:l,left:null,right:null,value:h,parent:_,color:et,getValue:function(){return this.value},getKey:function(){return this.key}};return w<0?_.left=q:_.right=q,this.fixAfterInsertion(q),this.size_++,null},nt.prototype.fixAfterInsertion=function(l){for(l.color=1;null!=l&&l!==this.root_&&1===l.parent.color;)if(Te(l)===Fe(Te(Te(l)))){var h=bt(Te(Te(l)));1===ge(h)?(Pe(Te(l),et),Pe(h,et),Pe(Te(Te(l)),1),l=Te(Te(l))):(l===bt(Te(l))&&(l=Te(l),this.rotateLeft(l)),Pe(Te(l),et),Pe(Te(Te(l)),1),this.rotateRight(Te(Te(l))))}else{var _=Fe(Te(Te(l)));1===ge(_)?(Pe(Te(l),et),Pe(_,et),Pe(Te(Te(l)),1),l=Te(Te(l))):(l===Fe(Te(l))&&(l=Te(l),this.rotateRight(l)),Pe(Te(l),et),Pe(Te(Te(l)),1),this.rotateLeft(Te(Te(l))))}this.root_.color=et},nt.prototype.values=function(){var l=new Tn,h=this.getFirstEntry();if(null!==h)for(l.add(h.value);null!==(h=nt.successor(h));)l.add(h.value);return l},nt.prototype.entrySet=function(){var l=new be,h=this.getFirstEntry();if(null!==h)for(l.add(h);null!==(h=nt.successor(h));)l.add(h);return l},nt.prototype.rotateLeft=function(l){if(null!=l){var h=l.right;l.right=h.left,null!=h.left&&(h.left.parent=l),h.parent=l.parent,null===l.parent?this.root_=h:l.parent.left===l?l.parent.left=h:l.parent.right=h,h.left=l,l.parent=h}},nt.prototype.rotateRight=function(l){if(null!=l){var h=l.left;l.left=h.right,null!=h.right&&(h.right.parent=l),h.parent=l.parent,null===l.parent?this.root_=h:l.parent.right===l?l.parent.right=h:l.parent.left=h,h.right=l,l.parent=h}},nt.prototype.getFirstEntry=function(){var l=this.root_;if(null!=l)for(;null!=l.left;)l=l.left;return l},nt.successor=function(l){if(null===l)return null;if(null!==l.right){for(var h=l.right;null!==h.left;)h=h.left;return h}for(var _=l.parent,w=l;null!==_&&w===_.right;)w=_,_=_.parent;return _},nt.prototype.size=function(){return this.size_};var yt=function(){};yt.prototype.interfaces_=function(){return[]},yt.prototype.getClass=function(){return yt},He.prototype=new K,(dt.prototype=new He).contains=function(l){for(var h=0,_=this.array_.length;h<_;h++)if(0===this.array_[h].compareTo(l))return!0;return!1},dt.prototype.add=function(l){if(this.contains(l))return!1;for(var h=0,_=this.array_.length;h<_;h++)if(1===this.array_[h].compareTo(l))return this.array_.splice(h,0,l),!0;return this.array_.push(l),!0},dt.prototype.addAll=function(l){for(var h=l.iterator();h.hasNext();)this.add(h.next());return!0},dt.prototype.remove=function(l){throw new p},dt.prototype.size=function(){return this.array_.length},dt.prototype.isEmpty=function(){return 0===this.array_.length},dt.prototype.toArray=function(){for(var l=[],h=0,_=this.array_.length;h<_;h++)l.push(this.array_[h]);return l},dt.prototype.iterator=function(){return new Ut(this)};var Ut=function(l){this.treeSet_=l,this.position_=0};Ut.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Ce;return this.treeSet_.array_[this.position_++]},Ut.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ut.prototype.remove=function(){throw new p};var Pt=function(){};Pt.sort=function(){var l,h,_,I=arguments[0];if(1===arguments.length)I.sort(function(q,he){return q.compareTo(he)});else if(2===arguments.length)_=arguments[1],I.sort(function(q,he){return _.compare(q,he)});else if(3===arguments.length){(h=I.slice(arguments[1],arguments[2])).sort();var U=I.slice(0,arguments[1]).concat(h,I.slice(arguments[2],I.length));for(I.splice(0,I.length),l=0;l<U.length;l++)I.push(U[l])}else if(4===arguments.length)for(h=I.slice(arguments[1],arguments[2]),_=arguments[3],h.sort(function(q,he){return _.compare(q,he)}),U=I.slice(0,arguments[1]).concat(h,I.slice(arguments[2],I.length)),I.splice(0,I.length),l=0;l<U.length;l++)I.push(U[l])},Pt.asList=function(l){for(var h=new Tn,_=0,w=l.length;_<w;_++)h.add(l[_]);return h};var ht=function(){},zt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};zt.P.get=function(){return 0},zt.L.get=function(){return 1},zt.A.get=function(){return 2},zt.FALSE.get=function(){return-1},zt.TRUE.get=function(){return-2},zt.DONTCARE.get=function(){return-3},zt.SYM_FALSE.get=function(){return"F"},zt.SYM_TRUE.get=function(){return"T"},zt.SYM_DONTCARE.get=function(){return"*"},zt.SYM_P.get=function(){return"0"},zt.SYM_L.get=function(){return"1"},zt.SYM_A.get=function(){return"2"},ht.prototype.interfaces_=function(){return[]},ht.prototype.getClass=function(){return ht},ht.toDimensionSymbol=function(l){switch(l){case ht.FALSE:return ht.SYM_FALSE;case ht.TRUE:return ht.SYM_TRUE;case ht.DONTCARE:return ht.SYM_DONTCARE;case ht.P:return ht.SYM_P;case ht.L:return ht.SYM_L;case ht.A:return ht.SYM_A}throw new Q("Unknown dimension value: "+l)},ht.toDimensionValue=function(l){switch(xt.toUpperCase(l)){case ht.SYM_FALSE:return ht.FALSE;case ht.SYM_TRUE:return ht.TRUE;case ht.SYM_DONTCARE:return ht.DONTCARE;case ht.SYM_P:return ht.P;case ht.SYM_L:return ht.L;case ht.SYM_A:return ht.A}throw new Q("Unknown dimension symbol: "+l)},Object.defineProperties(ht,zt);var dn=function(){};dn.prototype.filter=function(l){},dn.prototype.interfaces_=function(){return[]},dn.prototype.getClass=function(){return dn};var Fn=function(){};Fn.prototype.filter=function(l,h){},Fn.prototype.isDone=function(){},Fn.prototype.isGeometryChanged=function(){},Fn.prototype.interfaces_=function(){return[]},Fn.prototype.getClass=function(){return Fn};var mn=function(l){function h(w,I){if(l.call(this,I),this._geometries=w||[],l.hasNullElements(this._geometries))throw new Q("geometries must not contain null elements")}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){for(var w=new Rn,I=0;I<this._geometries.length;I++)w.expandToInclude(this._geometries[I].getEnvelopeInternal());return w},h.prototype.getGeometryN=function(w){return this._geometries[w]},h.prototype.getSortIndex=function(){return l.SORTINDEX_GEOMETRYCOLLECTION},h.prototype.getCoordinates=function(){for(var w=new Array(this.getNumPoints()).fill(null),I=-1,U=0;U<this._geometries.length;U++)for(var q=this._geometries[U].getCoordinates(),he=0;he<q.length;he++)w[++I]=q[he];return w},h.prototype.getArea=function(){for(var w=0,I=0;I<this._geometries.length;I++)w+=this._geometries[I].getArea();return w},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];if(!this.isEquivalentClass(w))return!1;var U=w;if(this._geometries.length!==U._geometries.length)return!1;for(var q=0;q<this._geometries.length;q++)if(!this._geometries[q].equalsExact(U._geometries[q],I))return!1;return!0}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var w=0;w<this._geometries.length;w++)this._geometries[w].normalize();Pt.sort(this._geometries)},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},h.prototype.getBoundaryDimension=function(){for(var w=ht.FALSE,I=0;I<this._geometries.length;I++)w=Math.max(w,this._geometries[I].getBoundaryDimension());return w},h.prototype.getDimension=function(){for(var w=ht.FALSE,I=0;I<this._geometries.length;I++)w=Math.max(w,this._geometries[I].getDimension());return w},h.prototype.getLength=function(){for(var w=0,I=0;I<this._geometries.length;I++)w+=this._geometries[I].getLength();return w},h.prototype.getNumPoints=function(){for(var w=0,I=0;I<this._geometries.length;I++)w+=this._geometries[I].getNumPoints();return w},h.prototype.getNumGeometries=function(){return this._geometries.length},h.prototype.reverse=function(){for(var I=new Array(this._geometries.length).fill(null),U=0;U<this._geometries.length;U++)I[U]=this._geometries[U].reverse();return this.getFactory().createGeometryCollection(I)},h.prototype.compareToSameClass=function(){if(1===arguments.length){var w=arguments[0],I=new dt(Pt.asList(this._geometries)),U=new dt(Pt.asList(w._geometries));return this.compare(I,U)}if(2===arguments.length){for(var he=arguments[1],ke=arguments[0],wt=this.getNumGeometries(),vt=ke.getNumGeometries(),on=0;on<wt&&on<vt;){var Gn=this.getGeometryN(on),qn=ke.getGeometryN(on),hr=Gn.compareToSameClass(qn,he);if(0!==hr)return hr;on++}return on<wt?1:on<vt?-1:0}},h.prototype.apply=function(){if(Bt(arguments[0],li))for(var w=arguments[0],I=0;I<this._geometries.length;I++)this._geometries[I].apply(w);else if(Bt(arguments[0],Fn)){var U=arguments[0];if(0===this._geometries.length)return null;for(var q=0;q<this._geometries.length&&(this._geometries[q].apply(U),!U.isDone());q++);U.isGeometryChanged()&&this.geometryChanged()}else if(Bt(arguments[0],dn)){var he=arguments[0];he.filter(this);for(var ke=0;ke<this._geometries.length;ke++)this._geometries[ke].apply(he)}else if(Bt(arguments[0],Xr)){var wt=arguments[0];wt.filter(this);for(var vt=0;vt<this._geometries.length;vt++)this._geometries[vt].apply(wt)}},h.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Me.shouldNeverReachHere(),null},h.prototype.clone=function(){var w=l.prototype.clone.call(this);w._geometries=new Array(this._geometries.length).fill(null);for(var I=0;I<this._geometries.length;I++)w._geometries[I]=this._geometries[I].clone();return w},h.prototype.getGeometryType=function(){return"GeometryCollection"},h.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),I=0;I<w.length;I++)w[I]=this._geometries[I].copy();return new h(w,this._factory)},h.prototype.isEmpty=function(){for(var w=0;w<this._geometries.length;w++)if(!this._geometries[w].isEmpty())return!1;return!0},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(h,_),h}(kn),yr=function(l){function h(){l.apply(this,arguments)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return kn.SORTINDEX_MULTILINESTRING},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];return!!this.isEquivalentClass(w)&&l.prototype.equalsExact.call(this,w,I)}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?ht.FALSE:0},h.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var w=0;w<this._geometries.length;w++)if(!this._geometries[w].isClosed())return!1;return!0},h.prototype.getDimension=function(){return 1},h.prototype.reverse=function(){for(var w=this._geometries.length,I=new Array(w).fill(null),U=0;U<this._geometries.length;U++)I[w-1-U]=this._geometries[U].reverse();return this.getFactory().createMultiLineString(I)},h.prototype.getBoundary=function(){return new ir(this).getBoundary()},h.prototype.getGeometryType=function(){return"MultiLineString"},h.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),I=0;I<w.length;I++)w[I]=this._geometries[I].copy();return new h(w,this._factory)},h.prototype.interfaces_=function(){return[yt]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(h,_),h}(mn),ir=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var l=arguments[0],h=gi.MOD2_BOUNDARY_RULE;this._geom=l,this._geomFact=l.getFactory(),this._bnRule=h}else if(2===arguments.length){var _=arguments[0],w=arguments[1];this._geom=_,this._geomFact=_.getFactory(),this._bnRule=w}};ir.prototype.boundaryMultiLineString=function(l){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var h=this.computeBoundaryCoordinates(l);return 1===h.length?this._geomFact.createPoint(h[0]):this._geomFact.createMultiPointFromCoords(h)},ir.prototype.getBoundary=function(){return this._geom instanceof nr?this.boundaryLineString(this._geom):this._geom instanceof yr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},ir.prototype.boundaryLineString=function(l){return this._geom.isEmpty()?this.getEmptyMultiPoint():l.isClosed()?this._bnRule.isInBoundary(2)?l.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([l.getStartPoint(),l.getEndPoint()])},ir.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},ir.prototype.computeBoundaryCoordinates=function(l){var h=new Tn;this._endpointMap=new nt;for(var _=0;_<l.getNumGeometries();_++){var w=l.getGeometryN(_);0!==w.getNumPoints()&&(this.addEndpoint(w.getCoordinateN(0)),this.addEndpoint(w.getCoordinateN(w.getNumPoints()-1)))}for(var I=this._endpointMap.entrySet().iterator();I.hasNext();){var U=I.next(),q=U.getValue().count;this._bnRule.isInBoundary(q)&&h.add(U.getKey())}return Fr.toCoordinateArray(h)},ir.prototype.addEndpoint=function(l){var h=this._endpointMap.get(l);null===h&&(h=new xr,this._endpointMap.put(l,h)),h.count++},ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir},ir.getBoundary=function(){return 1===arguments.length?new ir(arguments[0]).getBoundary():2===arguments.length?new ir(arguments[0],arguments[1]).getBoundary():void 0};var xr=function(){this.count=null};xr.prototype.interfaces_=function(){return[]},xr.prototype.getClass=function(){return xr};var _r=function(){},Dr={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},_r.chars=function(l,h){for(var _=new Array(h).fill(null),w=0;w<h;w++)_[w]=l;return String(_)},_r.getStackTrace=function(){if(1===arguments.length){var l=arguments[0],h=new function(){},_=new function(){}(h);return l.printStackTrace(_),h.toString()}if(2===arguments.length){for(var I=arguments[1],U="",q=new function(){}(new function(){}(_r.getStackTrace(arguments[0]))),he=0;he<I;he++)try{U+=q.readLine()+_r.NEWLINE}catch(ke){if(!(ke instanceof Rt))throw ke;Me.shouldNeverReachHere()}return U}},_r.split=function(l,h){for(var _=h.length,w=new Tn,I=""+l,U=I.indexOf(h);U>=0;){var q=I.substring(0,U);w.add(q),U=(I=I.substring(U+_)).indexOf(h)}I.length>0&&w.add(I);for(var he=new Array(w.size()).fill(null),ke=0;ke<he.length;ke++)he[ke]=w.get(ke);return he},_r.toString=function(){if(1===arguments.length)return _r.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},_r.spaces=function(l){return _r.chars(" ",l)},Dr.NEWLINE.get=function(){return pr.getProperty("line.separator")},Dr.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(_r,Dr);var Vr=function(){};Vr.prototype.interfaces_=function(){return[]},Vr.prototype.getClass=function(){return Vr},Vr.copyCoord=function(l,h,_,w){for(var I=Math.min(l.getDimension(),_.getDimension()),U=0;U<I;U++)_.setOrdinate(w,U,l.getOrdinate(h,U))},Vr.isRing=function(l){var h=l.size();return 0===h||!(h<=3)&&l.getOrdinate(0,At.X)===l.getOrdinate(h-1,At.X)&&l.getOrdinate(0,At.Y)===l.getOrdinate(h-1,At.Y)},Vr.isEqual=function(l,h){var _=l.size();if(_!==h.size())return!1;for(var w=Math.min(l.getDimension(),h.getDimension()),I=0;I<_;I++)for(var U=0;U<w;U++){var q=l.getOrdinate(I,U),he=h.getOrdinate(I,U);if(!(l.getOrdinate(I,U)===h.getOrdinate(I,U)||te.isNaN(q)&&te.isNaN(he)))return!1}return!0},Vr.extend=function(l,h,_){var w=l.create(_,h.getDimension()),I=h.size();if(Vr.copy(h,0,w,0,I),I>0)for(var U=I;U<_;U++)Vr.copy(h,I-1,w,U,1);return w},Vr.reverse=function(l){for(var h=l.size()-1,_=Math.trunc(h/2),w=0;w<=_;w++)Vr.swap(l,w,h-w)},Vr.swap=function(l,h,_){if(h===_)return null;for(var w=0;w<l.getDimension();w++){var I=l.getOrdinate(h,w);l.setOrdinate(h,w,l.getOrdinate(_,w)),l.setOrdinate(_,w,I)}},Vr.copy=function(l,h,_,w,I){for(var U=0;U<I;U++)Vr.copyCoord(l,h+U,_,w+U)},Vr.toString=function(){if(1===arguments.length){var l=arguments[0],h=l.size();if(0===h)return"()";var _=l.getDimension(),w=new Xe;w.append("(");for(var I=0;I<h;I++){I>0&&w.append(" ");for(var U=0;U<_;U++)U>0&&w.append(","),w.append(_r.toString(l.getOrdinate(I,U)))}return w.append(")"),w.toString()}},Vr.ensureValidRing=function(l,h){var _=h.size();return 0===_?h:_<=3?Vr.createClosedRing(l,h,4):h.getOrdinate(0,At.X)===h.getOrdinate(_-1,At.X)&&h.getOrdinate(0,At.Y)===h.getOrdinate(_-1,At.Y)?h:Vr.createClosedRing(l,h,_+1)},Vr.createClosedRing=function(l,h,_){var w=l.create(_,h.getDimension()),I=h.size();Vr.copy(h,0,w,0,I);for(var U=I;U<_;U++)Vr.copy(h,0,w,U,1);return w};var nr=function(l){function h(w,I){l.call(this,I),this._points=null,this.init(w)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Rn:this._points.expandEnvelope(new Rn)},h.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},h.prototype.getSortIndex=function(){return l.SORTINDEX_LINESTRING},h.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];if(!this.isEquivalentClass(w))return!1;var U=w;if(this._points.size()!==U._points.size())return!1;for(var q=0;q<this._points.size();q++)if(!this.equal(this._points.getCoordinate(q),U._points.getCoordinate(q),I))return!1;return!0}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var w=0;w<Math.trunc(this._points.size()/2);w++){var I=this._points.size()-1-w;if(!this._points.getCoordinate(w).equals(this._points.getCoordinate(I)))return this._points.getCoordinate(w).compareTo(this._points.getCoordinate(I))>0&&Vr.reverse(this._points),null}},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?ht.FALSE:0},h.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},h.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},h.prototype.getDimension=function(){return 1},h.prototype.getLength=function(){return un.computeLength(this._points)},h.prototype.getNumPoints=function(){return this._points.size()},h.prototype.reverse=function(){var w=this._points.copy();return Vr.reverse(w),this.getFactory().createLineString(w)},h.prototype.compareToSameClass=function(){if(1===arguments.length){for(var w=arguments[0],I=0,U=0;I<this._points.size()&&U<w._points.size();){var q=this._points.getCoordinate(I).compareTo(w._points.getCoordinate(U));if(0!==q)return q;I++,U++}return I<this._points.size()?1:U<w._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},h.prototype.apply=function(){if(Bt(arguments[0],li))for(var w=arguments[0],I=0;I<this._points.size();I++)w.filter(this._points.getCoordinate(I));else if(Bt(arguments[0],Fn)){var U=arguments[0];if(0===this._points.size())return null;for(var q=0;q<this._points.size()&&(U.filter(this._points,q),!U.isDone());q++);U.isGeometryChanged()&&this.geometryChanged()}else(Bt(arguments[0],dn)||Bt(arguments[0],Xr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return new ir(this).getBoundary()},h.prototype.isEquivalentClass=function(w){return w instanceof h},h.prototype.clone=function(){var w=l.prototype.clone.call(this);return w._points=this._points.clone(),w},h.prototype.getCoordinateN=function(w){return this._points.getCoordinate(w)},h.prototype.getGeometryType=function(){return"LineString"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._points},h.prototype.isEmpty=function(){return 0===this._points.size()},h.prototype.init=function(w){if(null===w&&(w=this.getFactory().getCoordinateSequenceFactory().create([])),1===w.size())throw new Q("Invalid number of points in LineString (found "+w.size()+" - must be 0 or >= 2)");this._points=w},h.prototype.isCoordinate=function(w){for(var I=0;I<this._points.size();I++)if(this._points.getCoordinate(I).equals(w))return!0;return!1},h.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},h.prototype.getPointN=function(w){return this.getFactory().createPoint(this._points.getCoordinate(w))},h.prototype.interfaces_=function(){return[yt]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(h,_),h}(kn),Pi=function(){};Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi};var Zr=function(l){function h(w,I){l.call(this,I),this._coordinates=w||null,this.init(this._coordinates)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Rn;var w=new Rn;return w.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),w},h.prototype.getSortIndex=function(){return l.SORTINDEX_POINT},h.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];return!!this.isEquivalentClass(w)&&(!(!this.isEmpty()||!w.isEmpty())||this.isEmpty()===w.isEmpty()&&this.equal(w.getCoordinate(),this.getCoordinate(),I))}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){},h.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},h.prototype.getBoundaryDimension=function(){return ht.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getNumPoints=function(){return this.isEmpty()?0:1},h.prototype.reverse=function(){return this.copy()},h.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},h.prototype.compareToSameClass=function(){if(1===arguments.length){var w=arguments[0];return this.getCoordinate().compareTo(w.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},h.prototype.apply=function(){if(Bt(arguments[0],li)){var w=arguments[0];if(this.isEmpty())return null;w.filter(this.getCoordinate())}else if(Bt(arguments[0],Fn)){var I=arguments[0];if(this.isEmpty())return null;I.filter(this._coordinates,0),I.isGeometryChanged()&&this.geometryChanged()}else(Bt(arguments[0],dn)||Bt(arguments[0],Xr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.clone=function(){var w=l.prototype.clone.call(this);return w._coordinates=this._coordinates.clone(),w},h.prototype.getGeometryType=function(){return"Point"},h.prototype.copy=function(){return new h(this._coordinates.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._coordinates},h.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},h.prototype.isEmpty=function(){return 0===this._coordinates.size()},h.prototype.init=function(w){null===w&&(w=this.getFactory().getCoordinateSequenceFactory().create([])),Me.isTrue(w.size()<=1),this._coordinates=w},h.prototype.isSimple=function(){return!0},h.prototype.interfaces_=function(){return[Pi]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(h,_),h}(kn),Wi=function(){};Wi.prototype.interfaces_=function(){return[]},Wi.prototype.getClass=function(){return Wi};var Xi=function(l){function h(w,I,U){if(l.call(this,U),this._shell=null,this._holes=null,null===w&&(w=this.getFactory().createLinearRing()),null===I&&(I=[]),l.hasNullElements(I))throw new Q("holes must not contain null elements");if(w.isEmpty()&&l.hasNonEmptyElements(I))throw new Q("shell is empty but holes are not");this._shell=w,this._holes=I}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},h.prototype.getSortIndex=function(){return l.SORTINDEX_POLYGON},h.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var w=new Array(this.getNumPoints()).fill(null),I=-1,U=this._shell.getCoordinates(),q=0;q<U.length;q++)w[++I]=U[q];for(var he=0;he<this._holes.length;he++)for(var ke=this._holes[he].getCoordinates(),wt=0;wt<ke.length;wt++)w[++I]=ke[wt];return w},h.prototype.getArea=function(){var w=0;w+=Math.abs(un.signedArea(this._shell.getCoordinateSequence()));for(var I=0;I<this._holes.length;I++)w-=Math.abs(un.signedArea(this._holes[I].getCoordinateSequence()));return w},h.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var w=this._shell.getCoordinateSequence(),I=this.getEnvelopeInternal(),U=0;U<5;U++){var q=w.getX(U);if(q!==I.getMinX()&&q!==I.getMaxX())return!1;var he=w.getY(U);if(he!==I.getMinY()&&he!==I.getMaxY())return!1}for(var ke=w.getX(0),wt=w.getY(0),vt=1;vt<=4;vt++){var on=w.getX(vt),Gn=w.getY(vt);if(on!==ke==(Gn!==wt))return!1;ke=on,wt=Gn}return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];if(!this.isEquivalentClass(w))return!1;var U=w;if(!this._shell.equalsExact(U._shell,I)||this._holes.length!==U._holes.length)return!1;for(var ke=0;ke<this._holes.length;ke++)if(!this._holes[ke].equalsExact(U._holes[ke],I))return!1;return!0}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var w=0;w<this._holes.length;w++)this.normalize(this._holes[w],!1);Pt.sort(this._holes)}else if(2===arguments.length){var I=arguments[0],U=arguments[1];if(I.isEmpty())return null;var q=new Array(I.getCoordinates().length-1).fill(null);pr.arraycopy(I.getCoordinates(),0,q,0,q.length);var he=Fr.minCoordinate(I.getCoordinates());Fr.scroll(q,he),pr.arraycopy(q,0,I.getCoordinates(),0,q.length),I.getCoordinates()[q.length]=q[0],un.isCCW(I.getCoordinates())===U&&Fr.reverse(I.getCoordinates())}},h.prototype.getCoordinate=function(){return this._shell.getCoordinate()},h.prototype.getNumInteriorRing=function(){return this._holes.length},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.getLength=function(){var w=0;w+=this._shell.getLength();for(var I=0;I<this._holes.length;I++)w+=this._holes[I].getLength();return w},h.prototype.getNumPoints=function(){for(var w=this._shell.getNumPoints(),I=0;I<this._holes.length;I++)w+=this._holes[I].getNumPoints();return w},h.prototype.reverse=function(){var w=this.copy();w._shell=this._shell.copy().reverse(),w._holes=new Array(this._holes.length).fill(null);for(var I=0;I<this._holes.length;I++)w._holes[I]=this._holes[I].copy().reverse();return w},h.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},h.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var he=arguments[1],ke=arguments[0],on=this._shell.compareToSameClass(ke._shell,he);if(0!==on)return on;for(var Gn=this.getNumInteriorRing(),qn=ke.getNumInteriorRing(),hr=0;hr<Gn&&hr<qn;){var Lr=this.getInteriorRingN(hr),to=ke.getInteriorRingN(hr),Ps=Lr.compareToSameClass(to,he);if(0!==Ps)return Ps;hr++}return hr<Gn?1:hr<qn?-1:0}},h.prototype.apply=function(w){if(Bt(w,li)){this._shell.apply(w);for(var I=0;I<this._holes.length;I++)this._holes[I].apply(w)}else if(Bt(w,Fn)){if(this._shell.apply(w),!w.isDone())for(var U=0;U<this._holes.length&&(this._holes[U].apply(w),!w.isDone());U++);w.isGeometryChanged()&&this.geometryChanged()}else if(Bt(w,dn))w.filter(this);else if(Bt(w,Xr)){w.filter(this),this._shell.apply(w);for(var q=0;q<this._holes.length;q++)this._holes[q].apply(w)}},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var w=new Array(this._holes.length+1).fill(null);w[0]=this._shell;for(var I=0;I<this._holes.length;I++)w[I+1]=this._holes[I];return w.length<=1?this.getFactory().createLinearRing(w[0].getCoordinateSequence()):this.getFactory().createMultiLineString(w)},h.prototype.clone=function(){var w=l.prototype.clone.call(this);w._shell=this._shell.clone(),w._holes=new Array(this._holes.length).fill(null);for(var I=0;I<this._holes.length;I++)w._holes[I]=this._holes[I].clone();return w},h.prototype.getGeometryType=function(){return"Polygon"},h.prototype.copy=function(){for(var w=this._shell.copy(),I=new Array(this._holes.length).fill(null),U=0;U<I.length;U++)I[U]=this._holes[U].copy();return new h(w,I,this._factory)},h.prototype.getExteriorRing=function(){return this._shell},h.prototype.isEmpty=function(){return this._shell.isEmpty()},h.prototype.getInteriorRingN=function(w){return this._holes[w]},h.prototype.interfaces_=function(){return[Wi]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(h,_),h}(kn),Yt=function(l){function h(){l.apply(this,arguments)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return kn.SORTINDEX_MULTIPOINT},h.prototype.isValid=function(){return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];return!!this.isEquivalentClass(w)&&l.prototype.equalsExact.call(this,w,I)}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():l.prototype.getCoordinate.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return ht.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.getGeometryType=function(){return"MultiPoint"},h.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),I=0;I<w.length;I++)w[I]=this._geometries[I].copy();return new h(w,this._factory)},h.prototype.interfaces_=function(){return[Pi]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(h,_),h}(mn),ca=function(l){function h(w,I){w instanceof ne&&I instanceof at&&(w=I.getCoordinateSequenceFactory().create(w)),l.call(this,w,I),this.validateConstruction()}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return kn.SORTINDEX_LINEARRING},h.prototype.getBoundaryDimension=function(){return ht.FALSE},h.prototype.isClosed=function(){return!!this.isEmpty()||l.prototype.isClosed.call(this)},h.prototype.reverse=function(){var w=this._points.copy();return Vr.reverse(w),this.getFactory().createLinearRing(w)},h.prototype.validateConstruction=function(){if(!this.isEmpty()&&!l.prototype.isClosed.call(this))throw new Q("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<h.MINIMUM_VALID_SIZE)throw new Q("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},h.prototype.getGeometryType=function(){return"LinearRing"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},_.MINIMUM_VALID_SIZE.get=function(){return 4},_.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(h,_),h}(nr),so=function(l){function h(){l.apply(this,arguments)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return kn.SORTINDEX_MULTIPOLYGON},h.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],I=arguments[1];return!!this.isEquivalentClass(w)&&l.prototype.equalsExact.call(this,w,I)}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.reverse=function(){for(var I=new Array(this._geometries.length).fill(null),U=0;U<this._geometries.length;U++)I[U]=this._geometries[U].reverse();return this.getFactory().createMultiPolygon(I)},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var w=new Tn,I=0;I<this._geometries.length;I++)for(var U=this._geometries[I].getBoundary(),q=0;q<U.getNumGeometries();q++)w.add(U.getGeometryN(q));var he=new Array(w.size()).fill(null);return this.getFactory().createMultiLineString(w.toArray(he))},h.prototype.getGeometryType=function(){return"MultiPolygon"},h.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),I=0;I<w.length;I++)w[I]=this._geometries[I].copy();return new h(w,this._factory)},h.prototype.interfaces_=function(){return[Wi]},h.prototype.getClass=function(){return h},_.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(h,_),h}(mn),di=function(l){this._factory=l||null,this._isUserDataCopied=!1},Qu={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};di.prototype.setCopyUserData=function(l){this._isUserDataCopied=l},di.prototype.edit=function(l,h){if(null===l)return null;var _=this.editInternal(l,h);return this._isUserDataCopied&&_.setUserData(l.getUserData()),_},di.prototype.editInternal=function(l,h){return null===this._factory&&(this._factory=l.getFactory()),l instanceof mn?this.editGeometryCollection(l,h):l instanceof Xi?this.editPolygon(l,h):l instanceof Zr||l instanceof nr?h.edit(l,this._factory):(Me.shouldNeverReachHere("Unsupported Geometry class: "+l.getClass().getName()),null)},di.prototype.editGeometryCollection=function(l,h){for(var _=h.edit(l,this._factory),w=new Tn,I=0;I<_.getNumGeometries();I++){var U=this.edit(_.getGeometryN(I),h);null===U||U.isEmpty()||w.add(U)}return _.getClass()===Yt?this._factory.createMultiPoint(w.toArray([])):_.getClass()===yr?this._factory.createMultiLineString(w.toArray([])):_.getClass()===so?this._factory.createMultiPolygon(w.toArray([])):this._factory.createGeometryCollection(w.toArray([]))},di.prototype.editPolygon=function(l,h){var _=h.edit(l,this._factory);if(null===_&&(_=this._factory.createPolygon(null)),_.isEmpty())return _;var w=this.edit(_.getExteriorRing(),h);if(null===w||w.isEmpty())return this._factory.createPolygon();for(var I=new Tn,U=0;U<_.getNumInteriorRing();U++){var q=this.edit(_.getInteriorRingN(U),h);null===q||q.isEmpty()||I.add(q)}return this._factory.createPolygon(w,I.toArray([]))},di.prototype.interfaces_=function(){return[]},di.prototype.getClass=function(){return di},di.GeometryEditorOperation=function(){},Qu.NoOpGeometryOperation.get=function(){return Ni},Qu.CoordinateOperation.get=function(){return ol},Qu.CoordinateSequenceOperation.get=function(){return xc},Object.defineProperties(di,Qu);var Ni=function(){};Ni.prototype.edit=function(l,h){return l},Ni.prototype.interfaces_=function(){return[di.GeometryEditorOperation]},Ni.prototype.getClass=function(){return Ni};var ol=function(){};ol.prototype.edit=function(l,h){var _=this.editCoordinates(l.getCoordinates(),l);return null===_?l:l instanceof ca?h.createLinearRing(_):l instanceof nr?h.createLineString(_):l instanceof Zr?_.length>0?h.createPoint(_[0]):h.createPoint():l},ol.prototype.interfaces_=function(){return[di.GeometryEditorOperation]},ol.prototype.getClass=function(){return ol};var xc=function(){};xc.prototype.edit=function(l,h){return l instanceof ca?h.createLinearRing(this.edit(l.getCoordinateSequence(),l)):l instanceof nr?h.createLineString(this.edit(l.getCoordinateSequence(),l)):l instanceof Zr?h.createPoint(this.edit(l.getCoordinateSequence(),l)):l},xc.prototype.interfaces_=function(){return[di.GeometryEditorOperation]},xc.prototype.getClass=function(){return xc};var ao=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var l=arguments[0];this._coordinates=new Array(l).fill(null);for(var h=0;h<l;h++)this._coordinates[h]=new ne}else if(Bt(arguments[0],At)){var _=arguments[0];if(null===_)return this._coordinates=new Array(0).fill(null),null;this._dimension=_.getDimension(),this._coordinates=new Array(_.size()).fill(null);for(var w=0;w<this._coordinates.length;w++)this._coordinates[w]=_.getCoordinateCopy(w)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var I=arguments[0],U=arguments[1];this._coordinates=I,this._dimension=U,null===I&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var q=arguments[0],he=arguments[1];this._coordinates=new Array(q).fill(null),this._dimension=he;for(var ke=0;ke<q;ke++)this._coordinates[ke]=new ne}},hn={serialVersionUID:{configurable:!0}};ao.prototype.setOrdinate=function(l,h,_){switch(h){case At.X:this._coordinates[l].x=_;break;case At.Y:this._coordinates[l].y=_;break;case At.Z:this._coordinates[l].z=_;break;default:throw new Q("invalid ordinateIndex")}},ao.prototype.size=function(){return this._coordinates.length},ao.prototype.getOrdinate=function(l,h){switch(h){case At.X:return this._coordinates[l].x;case At.Y:return this._coordinates[l].y;case At.Z:return this._coordinates[l].z}return te.NaN},ao.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var h=arguments[0],_=arguments[1];_.x=this._coordinates[h].x,_.y=this._coordinates[h].y,_.z=this._coordinates[h].z}},ao.prototype.getCoordinateCopy=function(l){return new ne(this._coordinates[l])},ao.prototype.getDimension=function(){return this._dimension},ao.prototype.getX=function(l){return this._coordinates[l].x},ao.prototype.clone=function(){for(var l=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)l[h]=this._coordinates[h].clone();return new ao(l,this._dimension)},ao.prototype.expandEnvelope=function(l){for(var h=0;h<this._coordinates.length;h++)l.expandToInclude(this._coordinates[h]);return l},ao.prototype.copy=function(){for(var l=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)l[h]=this._coordinates[h].copy();return new ao(l,this._dimension)},ao.prototype.toString=function(){if(this._coordinates.length>0){var l=new Xe(17*this._coordinates.length);l.append("("),l.append(this._coordinates[0]);for(var h=1;h<this._coordinates.length;h++)l.append(", "),l.append(this._coordinates[h]);return l.append(")"),l.toString()}return"()"},ao.prototype.getY=function(l){return this._coordinates[l].y},ao.prototype.toCoordinateArray=function(){return this._coordinates},ao.prototype.interfaces_=function(){return[At,de]},ao.prototype.getClass=function(){return ao},hn.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(ao,hn);var Qr=function(){},Ti={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Qr.prototype.readResolve=function(){return Qr.instance()},Qr.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new ao(arguments[0]);if(Bt(arguments[0],At))return new ao(arguments[0])}else if(2===arguments.length){var _=arguments[0],w=arguments[1];return w>3&&(w=3),w<2?new ao(_):new ao(_,w)}},Qr.prototype.interfaces_=function(){return[We,de]},Qr.prototype.getClass=function(){return Qr},Qr.instance=function(){return Qr.instanceObject},Ti.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Ti.instanceObject.get=function(){return new Qr},Object.defineProperties(Qr,Ti);var On=function(l){function h(){l.call(this),this.map_=new Map}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.get=function(_){return this.map_.get(_)||null},h.prototype.put=function(_,w){return this.map_.set(_,w),w},h.prototype.values=function(){for(var _=new Tn,w=this.map_.values(),I=w.next();!I.done;)_.add(I.value),I=w.next();return _},h.prototype.entrySet=function(){var _=new be;return this.map_.entries().forEach(function(w){return _.add(w)}),_},h.prototype.size=function(){return this.map_.size()},h}(Ze),k=function l(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=l.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof we){var h=arguments[0];this._modelType=h,h===l.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var _=arguments[0];this._modelType=l.FIXED,this.setScale(_)}else if(arguments[0]instanceof l){var w=arguments[0];this._modelType=w._modelType,this._scale=w._scale}},G={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};k.prototype.equals=function(l){return l instanceof k&&this._modelType===l._modelType&&this._scale===l._scale},k.prototype.compareTo=function(l){var h=l,_=this.getMaximumSignificantDigits(),w=h.getMaximumSignificantDigits();return new gt(_).compareTo(new gt(w))},k.prototype.getScale=function(){return this._scale},k.prototype.isFloating=function(){return this._modelType===k.FLOATING||this._modelType===k.FLOATING_SINGLE},k.prototype.getType=function(){return this._modelType},k.prototype.toString=function(){var l="UNKNOWN";return this._modelType===k.FLOATING?l="Floating":this._modelType===k.FLOATING_SINGLE?l="Floating-Single":this._modelType===k.FIXED&&(l="Fixed (Scale="+this.getScale()+")"),l},k.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var l=arguments[0];return te.isNaN(l)||this._modelType===k.FLOATING_SINGLE?l:this._modelType===k.FIXED?Math.round(l*this._scale)/this._scale:l}if(arguments[0]instanceof ne){var h=arguments[0];if(this._modelType===k.FLOATING)return null;h.x=this.makePrecise(h.x),h.y=this.makePrecise(h.y)}},k.prototype.getMaximumSignificantDigits=function(){var l=16;return this._modelType===k.FLOATING?l=16:this._modelType===k.FLOATING_SINGLE?l=6:this._modelType===k.FIXED&&(l=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),l},k.prototype.setScale=function(l){this._scale=Math.abs(l)},k.prototype.interfaces_=function(){return[de,oe]},k.prototype.getClass=function(){return k},k.mostPrecise=function(l,h){return l.compareTo(h)>=0?l:h},G.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},G.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(k,G);var we=function l(h){this._name=h||null,l.nameToTypeMap.put(h,this)},st={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};we.prototype.readResolve=function(){return we.nameToTypeMap.get(this._name)},we.prototype.toString=function(){return this._name},we.prototype.interfaces_=function(){return[de]},we.prototype.getClass=function(){return we},st.serialVersionUID.get=function(){return-552860263173159e4},st.nameToTypeMap.get=function(){return new On},Object.defineProperties(we,st),k.Type=we,k.FIXED=new we("FIXED"),k.FLOATING=new we("FLOATING"),k.FLOATING_SINGLE=new we("FLOATING SINGLE");var at=function l(){this._precisionModel=new k,this._SRID=0,this._coordinateSequenceFactory=l.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Bt(arguments[0],We)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof k&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Mt={serialVersionUID:{configurable:!0}};at.prototype.toGeometry=function(l){return l.isNull()?this.createPoint(null):l.getMinX()===l.getMaxX()&&l.getMinY()===l.getMaxY()?this.createPoint(new ne(l.getMinX(),l.getMinY())):l.getMinX()===l.getMaxX()||l.getMinY()===l.getMaxY()?this.createLineString([new ne(l.getMinX(),l.getMinY()),new ne(l.getMaxX(),l.getMaxY())]):this.createPolygon(this.createLinearRing([new ne(l.getMinX(),l.getMinY()),new ne(l.getMinX(),l.getMaxY()),new ne(l.getMaxX(),l.getMaxY()),new ne(l.getMaxX(),l.getMinY()),new ne(l.getMinX(),l.getMinY())]),null)},at.prototype.createLineString=function(l){return l?l instanceof Array?new nr(this.getCoordinateSequenceFactory().create(l),this):Bt(l,At)?new nr(l,this):void 0:new nr(this.getCoordinateSequenceFactory().create([]),this)},at.prototype.createMultiLineString=function(){return 0===arguments.length?new yr(null,this):1===arguments.length?new yr(arguments[0],this):void 0},at.prototype.buildGeometry=function(l){for(var h=null,_=!1,w=!1,I=l.iterator();I.hasNext();){var U=I.next(),q=U.getClass();null===h&&(h=q),q!==h&&(_=!0),U.isGeometryCollectionOrDerived()&&(w=!0)}if(null===h)return this.createGeometryCollection();if(_||w)return this.createGeometryCollection(at.toGeometryArray(l));var he=l.iterator().next();if(l.size()>1){if(he instanceof Xi)return this.createMultiPolygon(at.toPolygonArray(l));if(he instanceof nr)return this.createMultiLineString(at.toLineStringArray(l));if(he instanceof Zr)return this.createMultiPoint(at.toPointArray(l));Me.shouldNeverReachHere("Unhandled class: "+he.getClass().getName())}return he},at.prototype.createMultiPointFromCoords=function(l){return this.createMultiPoint(null!==l?this.getCoordinateSequenceFactory().create(l):null)},at.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof ne){var l=arguments[0];return this.createPoint(null!==l?this.getCoordinateSequenceFactory().create([l]):null)}if(Bt(arguments[0],At))return new Zr(arguments[0],this)}},at.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},at.prototype.createPolygon=function(){if(0===arguments.length)return new Xi(null,null,this);if(1===arguments.length){if(Bt(arguments[0],At))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof ca)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new Xi(arguments[0],arguments[1],this)},at.prototype.getSRID=function(){return this._SRID},at.prototype.createGeometryCollection=function(){return 0===arguments.length?new mn(null,this):1===arguments.length?new mn(arguments[0],this):void 0},at.prototype.createGeometry=function(l){return new di(this).edit(l,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},at.prototype.getPrecisionModel=function(){return this._precisionModel},at.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var l=arguments[0];return this.createLinearRing(null!==l?this.getCoordinateSequenceFactory().create(l):null)}if(Bt(arguments[0],At))return new ca(arguments[0],this)}},at.prototype.createMultiPolygon=function(){return 0===arguments.length?new so(null,this):1===arguments.length?new so(arguments[0],this):void 0},at.prototype.createMultiPoint=function(){if(0===arguments.length)return new Yt(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Yt(arguments[0],this);if(arguments[0]instanceof Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(Bt(arguments[0],At)){var _=arguments[0];if(null===_)return this.createMultiPoint(new Array(0).fill(null));for(var w=new Array(_.size()).fill(null),I=0;I<_.size();I++){var U=this.getCoordinateSequenceFactory().create(1,_.getDimension());Vr.copy(_,I,U,0,1),w[I]=this.createPoint(U)}return this.createMultiPoint(w)}}},at.prototype.interfaces_=function(){return[de]},at.prototype.getClass=function(){return at},at.toMultiPolygonArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.toGeometryArray=function(l){if(null===l)return null;var h=new Array(l.size()).fill(null);return l.toArray(h)},at.getDefaultCoordinateSequenceFactory=function(){return Qr.instance()},at.toMultiLineStringArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.toLineStringArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.toMultiPointArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.toLinearRingArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.toPointArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.toPolygonArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},at.createPointFromInternalCoord=function(l,h){return h.getPrecisionModel().makePrecise(l),h.getFactory().createPoint(l)},Mt.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(at,Mt);var Dt=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Cn=function(l){this.geometryFactory=l||new at};Cn.prototype.read=function(l){var h,_=(h="string"==typeof l?JSON.parse(l):l).type;if(!Mn[_])throw new Error("Unknown GeoJSON type: "+h.type);return-1!==Dt.indexOf(_)?Mn[_].apply(this,[h.coordinates]):Mn[_].apply(this,"GeometryCollection"===_?[h.geometries]:[h])},Cn.prototype.write=function(l){var h=l.getGeometryType();if(!Zn[h])throw new Error("Geometry is not supported");return Zn[h].apply(this,[l])};var Mn={Feature:function(l){var h={};for(var _ in l)h[_]=l[_];if(l.geometry){if(!Mn[l.geometry.type])throw new Error("Unknown GeoJSON type: "+l.type);h.geometry=this.read(l.geometry)}return l.bbox&&(h.bbox=Mn.bbox.apply(this,[l.bbox])),h},FeatureCollection:function(l){var h={};if(l.features){h.features=[];for(var _=0;_<l.features.length;++_)h.features.push(this.read(l.features[_]))}return l.bbox&&(h.bbox=this.parse.bbox.apply(this,[l.bbox])),h},coordinates:function(l){for(var h=[],_=0;_<l.length;++_){var w=l[_];h.push(new ne(w[0],w[1]))}return h},bbox:function(l){return this.geometryFactory.createLinearRing([new ne(l[0],l[1]),new ne(l[2],l[1]),new ne(l[2],l[3]),new ne(l[0],l[3]),new ne(l[0],l[1])])},Point:function(l){var h=new ne(l[0],l[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(l){for(var h=[],_=0;_<l.length;++_)h.push(Mn.Point.apply(this,[l[_]]));return this.geometryFactory.createMultiPoint(h)},LineString:function(l){var h=Mn.coordinates.apply(this,[l]);return this.geometryFactory.createLineString(h)},MultiLineString:function(l){for(var h=[],_=0;_<l.length;++_)h.push(Mn.LineString.apply(this,[l[_]]));return this.geometryFactory.createMultiLineString(h)},Polygon:function(l){for(var h=Mn.coordinates.apply(this,[l[0]]),_=this.geometryFactory.createLinearRing(h),w=[],I=1;I<l.length;++I){var q=Mn.coordinates.apply(this,[l[I]]),he=this.geometryFactory.createLinearRing(q);w.push(he)}return this.geometryFactory.createPolygon(_,w)},MultiPolygon:function(l){for(var h=[],_=0;_<l.length;++_)h.push(Mn.Polygon.apply(this,[l[_]]));return this.geometryFactory.createMultiPolygon(h)},GeometryCollection:function(l){for(var h=[],_=0;_<l.length;++_)h.push(this.read(l[_]));return this.geometryFactory.createGeometryCollection(h)}},Zn={coordinate:function(l){return[l.x,l.y]},Point:function(l){return{type:"Point",coordinates:Zn.coordinate.apply(this,[l.getCoordinate()])}},MultiPoint:function(l){for(var h=[],_=0;_<l._geometries.length;++_){var I=Zn.Point.apply(this,[l._geometries[_]]);h.push(I.coordinates)}return{type:"MultiPoint",coordinates:h}},LineString:function(l){for(var h=[],_=l.getCoordinates(),w=0;w<_.length;++w)h.push(Zn.coordinate.apply(this,[_[w]]));return{type:"LineString",coordinates:h}},MultiLineString:function(l){for(var h=[],_=0;_<l._geometries.length;++_){var I=Zn.LineString.apply(this,[l._geometries[_]]);h.push(I.coordinates)}return{type:"MultiLineString",coordinates:h}},Polygon:function(l){var h=[],_=Zn.LineString.apply(this,[l._shell]);h.push(_.coordinates);for(var w=0;w<l._holes.length;++w){var U=Zn.LineString.apply(this,[l._holes[w]]);h.push(U.coordinates)}return{type:"Polygon",coordinates:h}},MultiPolygon:function(l){for(var h=[],_=0;_<l._geometries.length;++_){var I=Zn.Polygon.apply(this,[l._geometries[_]]);h.push(I.coordinates)}return{type:"MultiPolygon",coordinates:h}},GeometryCollection:function(l){for(var h=[],_=0;_<l._geometries.length;++_){var w=l._geometries[_],I=w.getGeometryType();h.push(Zn[I].apply(this,[w]))}return{type:"GeometryCollection",geometries:h}}},Qn=function(l){this.geometryFactory=l||new at,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Cn(this.geometryFactory)};Qn.prototype.read=function(l){var h=this.parser.read(l);return this.precisionModel.getType()===k.FIXED&&this.reducePrecision(h),h},Qn.prototype.reducePrecision=function(l){var h,_;if(l.coordinate)this.precisionModel.makePrecise(l.coordinate);else if(l.points)for(h=0,_=l.points.length;h<_;h++)this.precisionModel.makePrecise(l.points[h]);else if(l.geometries)for(h=0,_=l.geometries.length;h<_;h++)this.reducePrecision(l.geometries[h])};var jn=function(){this.parser=new Cn(this.geometryFactory)};jn.prototype.write=function(l){return this.parser.write(l)};var cn=function(){},as={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn},cn.opposite=function(l){return l===cn.LEFT?cn.RIGHT:l===cn.RIGHT?cn.LEFT:l},as.ON.get=function(){return 0},as.LEFT.get=function(){return 1},as.RIGHT.get=function(){return 2},Object.defineProperties(cn,as),(ae.prototype=new Error).name="EmptyStackException",(X.prototype=new Ls).add=function(l){return this.array_.push(l),!0},X.prototype.get=function(l){if(l<0||l>=this.size())throw new Error;return this.array_[l]},X.prototype.push=function(l){return this.array_.push(l),l},X.prototype.pop=function(l){if(0===this.array_.length)throw new ae;return this.array_.pop()},X.prototype.peek=function(){if(0===this.array_.length)throw new ae;return this.array_[this.array_.length-1]},X.prototype.empty=function(){return 0===this.array_.length},X.prototype.isEmpty=function(){return this.empty()},X.prototype.search=function(l){return this.array_.indexOf(l)},X.prototype.size=function(){return this.array_.length},X.prototype.toArray=function(){for(var l=[],h=0,_=this.array_.length;h<_;h++)l.push(this.array_[h]);return l};var jr=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};jr.prototype.getCoordinate=function(){return this._minCoord},jr.prototype.getRightmostSide=function(l,h){var _=this.getRightmostSideOfSegment(l,h);return _<0&&(_=this.getRightmostSideOfSegment(l,h-1)),_<0&&(this._minCoord=null,this.checkForRightmostCoordinate(l)),_},jr.prototype.findRightmostEdgeAtVertex=function(){var l=this._minDe.getEdge().getCoordinates();Me.isTrue(this._minIndex>0&&this._minIndex<l.length,"rightmost point expected to be interior vertex of edge");var h=l[this._minIndex-1],_=l[this._minIndex+1],w=un.computeOrientation(this._minCoord,_,h),I=!1;(h.y<this._minCoord.y&&_.y<this._minCoord.y&&w===un.COUNTERCLOCKWISE||h.y>this._minCoord.y&&_.y>this._minCoord.y&&w===un.CLOCKWISE)&&(I=!0),I&&(this._minIndex=this._minIndex-1)},jr.prototype.getRightmostSideOfSegment=function(l,h){var _=l.getEdge().getCoordinates();if(h<0||h+1>=_.length||_[h].y===_[h+1].y)return-1;var w=cn.LEFT;return _[h].y<_[h+1].y&&(w=cn.RIGHT),w},jr.prototype.getEdge=function(){return this._orientedDe},jr.prototype.checkForRightmostCoordinate=function(l){for(var h=l.getEdge().getCoordinates(),_=0;_<h.length-1;_++)(null===this._minCoord||h[_].x>this._minCoord.x)&&(this._minDe=l,this._minIndex=_,this._minCoord=h[_])},jr.prototype.findRightmostEdgeAtNode=function(){var l=this._minDe.getNode().getEdges();this._minDe=l.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},jr.prototype.findEdge=function(l){for(var h=l.iterator();h.hasNext();){var _=h.next();_.isForward()&&this.checkForRightmostCoordinate(_)}Me.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===cn.LEFT&&(this._orientedDe=this._minDe.getSym())},jr.prototype.interfaces_=function(){return[]},jr.prototype.getClass=function(){return jr};var lo=function(l){function h(_,w){l.call(this,h.msgWithCoord(_,w)),this.pt=w?new ne(w):null,this.name="TopologyException"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCoordinate=function(){return this.pt},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.msgWithCoord=function(_,w){return w?_:_+" [ "+w+" ]"},h}(Le),bn=function(){this.array_=[]};bn.prototype.addLast=function(l){this.array_.push(l)},bn.prototype.removeFirst=function(){return this.array_.shift()},bn.prototype.isEmpty=function(){return 0===this.array_.length};var $n=function(){this._finder=null,this._dirEdgeList=new Tn,this._nodes=new Tn,this._rightMostCoord=null,this._env=null,this._finder=new jr};$n.prototype.clearVisitedEdges=function(){for(var l=this._dirEdgeList.iterator();l.hasNext();)l.next().setVisited(!1)},$n.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},$n.prototype.computeNodeDepth=function(l){for(var h=null,_=l.getEdges().iterator();_.hasNext();){var w=_.next();if(w.isVisited()||w.getSym().isVisited()){h=w;break}}if(null===h)throw new lo("unable to find edge to compute depths at "+l.getCoordinate());l.getEdges().computeDepths(h);for(var I=l.getEdges().iterator();I.hasNext();){var U=I.next();U.setVisited(!0),this.copySymDepths(U)}},$n.prototype.computeDepth=function(l){this.clearVisitedEdges();var h=this._finder.getEdge();h.setEdgeDepths(cn.RIGHT,l),this.copySymDepths(h),this.computeDepths(h)},$n.prototype.create=function(l){this.addReachable(l),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},$n.prototype.findResultEdges=function(){for(var l=this._dirEdgeList.iterator();l.hasNext();){var h=l.next();h.getDepth(cn.RIGHT)>=1&&h.getDepth(cn.LEFT)<=0&&!h.isInteriorAreaEdge()&&h.setInResult(!0)}},$n.prototype.computeDepths=function(l){var h=new be,_=new bn,w=l.getNode();for(_.addLast(w),h.add(w),l.setVisited(!0);!_.isEmpty();){var I=_.removeFirst();h.add(I),this.computeNodeDepth(I);for(var U=I.getEdges().iterator();U.hasNext();){var q=U.next().getSym();if(!q.isVisited()){var he=q.getNode();h.contains(he)||(_.addLast(he),h.add(he))}}}},$n.prototype.compareTo=function(l){return this._rightMostCoord.x<l._rightMostCoord.x?-1:this._rightMostCoord.x>l._rightMostCoord.x?1:0},$n.prototype.getEnvelope=function(){if(null===this._env){for(var l=new Rn,h=this._dirEdgeList.iterator();h.hasNext();)for(var _=h.next().getEdge().getCoordinates(),w=0;w<_.length-1;w++)l.expandToInclude(_[w]);this._env=l}return this._env},$n.prototype.addReachable=function(l){var h=new X;for(h.add(l);!h.empty();){var _=h.pop();this.add(_,h)}},$n.prototype.copySymDepths=function(l){var h=l.getSym();h.setDepth(cn.LEFT,l.getDepth(cn.RIGHT)),h.setDepth(cn.RIGHT,l.getDepth(cn.LEFT))},$n.prototype.add=function(l,h){l.setVisited(!0),this._nodes.add(l);for(var _=l.getEdges().iterator();_.hasNext();){var w=_.next();this._dirEdgeList.add(w);var I=w.getSym().getNode();I.isVisited()||h.push(I)}},$n.prototype.getNodes=function(){return this._nodes},$n.prototype.getDirectedEdges=function(){return this._dirEdgeList},$n.prototype.interfaces_=function(){return[oe]},$n.prototype.getClass=function(){return $n};var sr=function l(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var _=arguments[0];this.init(1),this.location[cn.ON]=_}else if(arguments[0]instanceof l){var w=arguments[0];if(this.init(w.location.length),null!==w)for(var I=0;I<this.location.length;I++)this.location[I]=w.location[I]}}else if(3===arguments.length){var U=arguments[0],q=arguments[1],he=arguments[2];this.init(3),this.location[cn.ON]=U,this.location[cn.LEFT]=q,this.location[cn.RIGHT]=he}};sr.prototype.setAllLocations=function(l){for(var h=0;h<this.location.length;h++)this.location[h]=l},sr.prototype.isNull=function(){for(var l=0;l<this.location.length;l++)if(this.location[l]!==Se.NONE)return!1;return!0},sr.prototype.setAllLocationsIfNull=function(l){for(var h=0;h<this.location.length;h++)this.location[h]===Se.NONE&&(this.location[h]=l)},sr.prototype.isLine=function(){return 1===this.location.length},sr.prototype.merge=function(l){if(l.location.length>this.location.length){var h=new Array(3).fill(null);h[cn.ON]=this.location[cn.ON],h[cn.LEFT]=Se.NONE,h[cn.RIGHT]=Se.NONE,this.location=h}for(var _=0;_<this.location.length;_++)this.location[_]===Se.NONE&&_<l.location.length&&(this.location[_]=l.location[_])},sr.prototype.getLocations=function(){return this.location},sr.prototype.flip=function(){if(this.location.length<=1)return null;var l=this.location[cn.LEFT];this.location[cn.LEFT]=this.location[cn.RIGHT],this.location[cn.RIGHT]=l},sr.prototype.toString=function(){var l=new Xe;return this.location.length>1&&l.append(Se.toLocationSymbol(this.location[cn.LEFT])),l.append(Se.toLocationSymbol(this.location[cn.ON])),this.location.length>1&&l.append(Se.toLocationSymbol(this.location[cn.RIGHT])),l.toString()},sr.prototype.setLocations=function(l,h,_){this.location[cn.ON]=l,this.location[cn.LEFT]=h,this.location[cn.RIGHT]=_},sr.prototype.get=function(l){return l<this.location.length?this.location[l]:Se.NONE},sr.prototype.isArea=function(){return this.location.length>1},sr.prototype.isAnyNull=function(){for(var l=0;l<this.location.length;l++)if(this.location[l]===Se.NONE)return!0;return!1},sr.prototype.setLocation=function(){1===arguments.length?this.setLocation(cn.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},sr.prototype.init=function(l){this.location=new Array(l).fill(null),this.setAllLocations(Se.NONE)},sr.prototype.isEqualOnSide=function(l,h){return this.location[h]===l.location[h]},sr.prototype.allPositionsEqual=function(l){for(var h=0;h<this.location.length;h++)if(this.location[h]!==l)return!1;return!0},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr};var Jr=function l(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var h=arguments[0];this.elt[0]=new sr(h),this.elt[1]=new sr(h)}else if(arguments[0]instanceof l){var _=arguments[0];this.elt[0]=new sr(_.elt[0]),this.elt[1]=new sr(_.elt[1])}}else if(2===arguments.length){var w=arguments[0],I=arguments[1];this.elt[0]=new sr(Se.NONE),this.elt[1]=new sr(Se.NONE),this.elt[w].setLocation(I)}else if(3===arguments.length){var U=arguments[0],q=arguments[1],he=arguments[2];this.elt[0]=new sr(U,q,he),this.elt[1]=new sr(U,q,he)}else if(4===arguments.length){var ke=arguments[0],wt=arguments[1],vt=arguments[2],on=arguments[3];this.elt[0]=new sr(Se.NONE,Se.NONE,Se.NONE),this.elt[1]=new sr(Se.NONE,Se.NONE,Se.NONE),this.elt[ke].setLocations(wt,vt,on)}};Jr.prototype.getGeometryCount=function(){var l=0;return this.elt[0].isNull()||l++,this.elt[1].isNull()||l++,l},Jr.prototype.setAllLocations=function(l,h){this.elt[l].setAllLocations(h)},Jr.prototype.isNull=function(l){return this.elt[l].isNull()},Jr.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var l=arguments[0];this.setAllLocationsIfNull(0,l),this.setAllLocationsIfNull(1,l)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},Jr.prototype.isLine=function(l){return this.elt[l].isLine()},Jr.prototype.merge=function(l){for(var h=0;h<2;h++)null===this.elt[h]&&null!==l.elt[h]?this.elt[h]=new sr(l.elt[h]):this.elt[h].merge(l.elt[h])},Jr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Jr.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(cn.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Jr.prototype.toString=function(){var l=new Xe;return null!==this.elt[0]&&(l.append("A:"),l.append(this.elt[0].toString())),null!==this.elt[1]&&(l.append(" B:"),l.append(this.elt[1].toString())),l.toString()},Jr.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Jr.prototype.isAnyNull=function(l){return this.elt[l].isAnyNull()},Jr.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(cn.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},Jr.prototype.isEqualOnSide=function(l,h){return this.elt[0].isEqualOnSide(l.elt[0],h)&&this.elt[1].isEqualOnSide(l.elt[1],h)},Jr.prototype.allPositionsEqual=function(l,h){return this.elt[l].allPositionsEqual(h)},Jr.prototype.toLine=function(l){this.elt[l].isArea()&&(this.elt[l]=new sr(this.elt[l].location[0]))},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr},Jr.toLineLabel=function(l){for(var h=new Jr(Se.NONE),_=0;_<2;_++)h.setLocation(_,l.getLocation(_));return h};var Gr=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Tn,this._pts=new Tn,this._label=new Jr(Se.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Tn,this._geometryFactory=null;var l=arguments[0];this._geometryFactory=arguments[1],this.computePoints(l),this.computeRing()};Gr.prototype.computeRing=function(){if(null!==this._ring)return null;for(var l=new Array(this._pts.size()).fill(null),h=0;h<this._pts.size();h++)l[h]=this._pts.get(h);this._ring=this._geometryFactory.createLinearRing(l),this._isHole=un.isCCW(this._ring.getCoordinates())},Gr.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Gr.prototype.computePoints=function(l){this._startDe=l;var h=l,_=!0;do{if(null===h)throw new lo("Found null DirectedEdge");if(h.getEdgeRing()===this)throw new lo("Directed Edge visited twice during ring-building at "+h.getCoordinate());this._edges.add(h);var w=h.getLabel();Me.isTrue(w.isArea()),this.mergeLabel(w),this.addPoints(h.getEdge(),h.isForward(),_),_=!1,this.setEdgeRing(h,this),h=this.getNext(h)}while(h!==this._startDe)},Gr.prototype.getLinearRing=function(){return this._ring},Gr.prototype.getCoordinate=function(l){return this._pts.get(l)},Gr.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var l=this._startDe;do{var h=l.getNode().getEdges().getOutgoingDegree(this);h>this._maxNodeDegree&&(this._maxNodeDegree=h),l=this.getNext(l)}while(l!==this._startDe);this._maxNodeDegree*=2},Gr.prototype.addPoints=function(l,h,_){var w=l.getCoordinates();if(h){var I=1;_&&(I=0);for(var U=I;U<w.length;U++)this._pts.add(w[U])}else{var q=w.length-2;_&&(q=w.length-1);for(var he=q;he>=0;he--)this._pts.add(w[he])}},Gr.prototype.isHole=function(){return this._isHole},Gr.prototype.setInResult=function(){var l=this._startDe;do{l.getEdge().setInResult(!0),l=l.getNext()}while(l!==this._startDe)},Gr.prototype.containsPoint=function(l){var h=this.getLinearRing();if(!h.getEnvelopeInternal().contains(l)||!un.isPointInRing(l,h.getCoordinates()))return!1;for(var _=this._holes.iterator();_.hasNext();)if(_.next().containsPoint(l))return!1;return!0},Gr.prototype.addHole=function(l){this._holes.add(l)},Gr.prototype.isShell=function(){return null===this._shell},Gr.prototype.getLabel=function(){return this._label},Gr.prototype.getEdges=function(){return this._edges},Gr.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Gr.prototype.getShell=function(){return this._shell},Gr.prototype.mergeLabel=function(){if(1===arguments.length){var l=arguments[0];this.mergeLabel(l,0),this.mergeLabel(l,1)}else if(2===arguments.length){var _=arguments[1],w=arguments[0].getLocation(_,cn.RIGHT);if(w===Se.NONE)return null;if(this._label.getLocation(_)===Se.NONE)return this._label.setLocation(_,w),null}},Gr.prototype.setShell=function(l){this._shell=l,null!==l&&l.addHole(this)},Gr.prototype.toPolygon=function(l){for(var h=new Array(this._holes.size()).fill(null),_=0;_<this._holes.size();_++)h[_]=this._holes.get(_).getLinearRing();return l.createPolygon(this.getLinearRing(),h)},Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr};var vi=function(l){function h(){l.call(this,arguments[0],arguments[1])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setEdgeRing=function(_,w){_.setMinEdgeRing(w)},h.prototype.getNext=function(_){return _.getNextMin()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Gr),pl=function(l){function h(){l.call(this,arguments[0],arguments[1])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.buildMinimalRings=function(){var _=new Tn,w=this._startDe;do{if(null===w.getMinEdgeRing()){var I=new vi(w,this._geometryFactory);_.add(I)}w=w.getNext()}while(w!==this._startDe);return _},h.prototype.setEdgeRing=function(_,w){_.setEdgeRing(w)},h.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var _=this._startDe;do{_.getNode().getEdges().linkMinimalDirectedEdges(this),_=_.getNext()}while(_!==this._startDe)},h.prototype.getNext=function(_){return _.getNext()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Gr),ji=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};ji.prototype.setVisited=function(l){this._isVisited=l},ji.prototype.setInResult=function(l){this._isInResult=l},ji.prototype.isCovered=function(){return this._isCovered},ji.prototype.isCoveredSet=function(){return this._isCoveredSet},ji.prototype.setLabel=function(l){this._label=l},ji.prototype.getLabel=function(){return this._label},ji.prototype.setCovered=function(l){this._isCovered=l,this._isCoveredSet=!0},ji.prototype.updateIM=function(l){Me.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(l)},ji.prototype.isInResult=function(){return this._isInResult},ji.prototype.isVisited=function(){return this._isVisited},ji.prototype.interfaces_=function(){return[]},ji.prototype.getClass=function(){return ji};var ec=function(l){function h(){l.call(this),this._coord=null,this._edges=null;var w=arguments[1];this._coord=arguments[0],this._edges=w,this._label=new Jr(0,Se.NONE)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isIncidentEdgeInResult=function(){for(var _=this.getEdges().getEdges().iterator();_.hasNext();)if(_.next().getEdge().isInResult())return!0;return!1},h.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},h.prototype.getCoordinate=function(){return this._coord},h.prototype.print=function(_){_.println("node "+this._coord+" lbl: "+this._label)},h.prototype.computeIM=function(_){},h.prototype.computeMergedLocation=function(_,w){var I=Se.NONE;if(I=this._label.getLocation(w),!_.isNull(w)){var U=_.getLocation(w);I!==Se.BOUNDARY&&(I=U)}return I},h.prototype.setLabel=function(){if(2!==arguments.length)return l.prototype.setLabel.apply(this,arguments);var _=arguments[0],w=arguments[1];null===this._label?this._label=new Jr(_,w):this._label.setLocation(_,w)},h.prototype.getEdges=function(){return this._edges},h.prototype.mergeLabel=function(){if(arguments[0]instanceof h)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof Jr)for(var w=arguments[0],I=0;I<2;I++){var U=this.computeMergedLocation(w,I);this._label.getLocation(I)===Se.NONE&&this._label.setLocation(I,U)}},h.prototype.add=function(_){this._edges.insert(_),_.setNode(this)},h.prototype.setLabelBoundary=function(_){if(null===this._label)return null;var w=Se.NONE;null!==this._label&&(w=this._label.getLocation(_)),this._label.setLocation(_,w===Se.BOUNDARY?Se.INTERIOR:Se.BOUNDARY)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ji),zn=function(){this.nodeMap=new nt,this.nodeFact=null,this.nodeFact=arguments[0]};zn.prototype.find=function(l){return this.nodeMap.get(l)},zn.prototype.addNode=function(){if(arguments[0]instanceof ne){var l=arguments[0],h=this.nodeMap.get(l);return null===h&&(h=this.nodeFact.createNode(l),this.nodeMap.put(l,h)),h}if(arguments[0]instanceof ec){var _=arguments[0],w=this.nodeMap.get(_.getCoordinate());return null===w?(this.nodeMap.put(_.getCoordinate(),_),_):(w.mergeLabel(_),w)}},zn.prototype.print=function(l){for(var h=this.iterator();h.hasNext();)h.next().print(l)},zn.prototype.iterator=function(){return this.nodeMap.values().iterator()},zn.prototype.values=function(){return this.nodeMap.values()},zn.prototype.getBoundaryNodes=function(l){for(var h=new Tn,_=this.iterator();_.hasNext();){var w=_.next();w.getLabel().getLocation(l)===Se.BOUNDARY&&h.add(w)}return h},zn.prototype.add=function(l){var h=l.getCoordinate();this.addNode(h).add(l)},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn};var Ci=function(){},Ms={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci},Ci.isNorthern=function(l){return l===Ci.NE||l===Ci.NW},Ci.isOpposite=function(l,h){return l!==h&&(l-h+4)%4==2},Ci.commonHalfPlane=function(l,h){if(l===h)return l;if((l-h+4)%4==2)return-1;var _=l<h?l:h;return 0===_&&3===(l>h?l:h)?3:_},Ci.isInHalfPlane=function(l,h){return h===Ci.SE?l===Ci.SE||l===Ci.SW:l===h||l===h+1},Ci.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var l=arguments[0],h=arguments[1];if(0===l&&0===h)throw new Q("Cannot compute the quadrant for point ( "+l+", "+h+" )");return l>=0?h>=0?Ci.NE:Ci.SE:h>=0?Ci.NW:Ci.SW}if(arguments[0]instanceof ne&&arguments[1]instanceof ne){var _=arguments[0],w=arguments[1];if(w.x===_.x&&w.y===_.y)throw new Q("Cannot compute the quadrant for two identical points "+_);return w.x>=_.x?w.y>=_.y?Ci.NE:Ci.SE:w.y>=_.y?Ci.NW:Ci.SW}},Ms.NE.get=function(){return 0},Ms.NW.get=function(){return 1},Ms.SW.get=function(){return 2},Ms.SE.get=function(){return 3},Object.defineProperties(Ci,Ms);var bs=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var _=arguments[1],w=arguments[2];this._edge=arguments[0],this.init(_,w),this._label=null}else if(4===arguments.length){var U=arguments[1],q=arguments[2],he=arguments[3];this._edge=arguments[0],this.init(U,q),this._label=he}};bs.prototype.compareDirection=function(l){return this._dx===l._dx&&this._dy===l._dy?0:this._quadrant>l._quadrant?1:this._quadrant<l._quadrant?-1:un.computeOrientation(l._p0,l._p1,this._p1)},bs.prototype.getDy=function(){return this._dy},bs.prototype.getCoordinate=function(){return this._p0},bs.prototype.setNode=function(l){this._node=l},bs.prototype.print=function(l){var h=Math.atan2(this._dy,this._dx),_=this.getClass().getName(),w=_.lastIndexOf("."),I=_.substring(w+1);l.print("  "+I+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+h+"   "+this._label)},bs.prototype.compareTo=function(l){return this.compareDirection(l)},bs.prototype.getDirectedCoordinate=function(){return this._p1},bs.prototype.getDx=function(){return this._dx},bs.prototype.getLabel=function(){return this._label},bs.prototype.getEdge=function(){return this._edge},bs.prototype.getQuadrant=function(){return this._quadrant},bs.prototype.getNode=function(){return this._node},bs.prototype.toString=function(){var l=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),_=h.lastIndexOf(".");return"  "+h.substring(_+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+l+"   "+this._label},bs.prototype.computeLabel=function(l){},bs.prototype.init=function(l,h){this._p0=l,this._p1=h,this._dx=h.x-l.x,this._dy=h.y-l.y,this._quadrant=Ci.quadrant(this._dx,this._dy),Me.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},bs.prototype.interfaces_=function(){return[oe]},bs.prototype.getClass=function(){return bs};var ha=function(l){function h(){var _=arguments[0],w=arguments[1];if(l.call(this,_),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=w,w)this.init(_.getCoordinate(0),_.getCoordinate(1));else{var I=_.getNumPoints()-1;this.init(_.getCoordinate(I),_.getCoordinate(I-1))}this.computeDirectedLabel()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getNextMin=function(){return this._nextMin},h.prototype.getDepth=function(_){return this._depth[_]},h.prototype.setVisited=function(_){this._isVisited=_},h.prototype.computeDirectedLabel=function(){this._label=new Jr(this._edge.getLabel()),this._isForward||this._label.flip()},h.prototype.getNext=function(){return this._next},h.prototype.setDepth=function(_,w){if(-999!==this._depth[_]&&this._depth[_]!==w)throw new lo("assigned depths do not match",this.getCoordinate());this._depth[_]=w},h.prototype.isInteriorAreaEdge=function(){for(var _=!0,w=0;w<2;w++)this._label.isArea(w)&&this._label.getLocation(w,cn.LEFT)===Se.INTERIOR&&this._label.getLocation(w,cn.RIGHT)===Se.INTERIOR||(_=!1);return _},h.prototype.setNextMin=function(_){this._nextMin=_},h.prototype.print=function(_){l.prototype.print.call(this,_),_.print(" "+this._depth[cn.LEFT]+"/"+this._depth[cn.RIGHT]),_.print(" ("+this.getDepthDelta()+")"),this._isInResult&&_.print(" inResult")},h.prototype.setMinEdgeRing=function(_){this._minEdgeRing=_},h.prototype.isLineEdge=function(){var _=this._label.isLine(0)||this._label.isLine(1),w=!this._label.isArea(0)||this._label.allPositionsEqual(0,Se.EXTERIOR),I=!this._label.isArea(1)||this._label.allPositionsEqual(1,Se.EXTERIOR);return _&&w&&I},h.prototype.setEdgeRing=function(_){this._edgeRing=_},h.prototype.getMinEdgeRing=function(){return this._minEdgeRing},h.prototype.getDepthDelta=function(){var _=this._edge.getDepthDelta();return this._isForward||(_=-_),_},h.prototype.setInResult=function(_){this._isInResult=_},h.prototype.getSym=function(){return this._sym},h.prototype.isForward=function(){return this._isForward},h.prototype.getEdge=function(){return this._edge},h.prototype.printEdge=function(_){this.print(_),_.print(" "),this._isForward?this._edge.print(_):this._edge.printReverse(_)},h.prototype.setSym=function(_){this._sym=_},h.prototype.setVisitedEdge=function(_){this.setVisited(_),this._sym.setVisited(_)},h.prototype.setEdgeDepths=function(_,w){var I=this.getEdge().getDepthDelta();this._isForward||(I=-I);var U=1;_===cn.LEFT&&(U=-1);var q=cn.opposite(_),he=w+I*U;this.setDepth(_,w),this.setDepth(q,he)},h.prototype.getEdgeRing=function(){return this._edgeRing},h.prototype.isInResult=function(){return this._isInResult},h.prototype.setNext=function(_){this._next=_},h.prototype.isVisited=function(){return this._isVisited},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.depthFactor=function(_,w){return _===Se.EXTERIOR&&w===Se.INTERIOR?1:_===Se.INTERIOR&&w===Se.EXTERIOR?-1:0},h}(bs),$l=function(){};$l.prototype.createNode=function(l){return new ec(l,null)},$l.prototype.interfaces_=function(){return[]},$l.prototype.getClass=function(){return $l};var uo=function(){this._edges=new Tn,this._nodes=null,this._edgeEndList=new Tn,0===arguments.length?this._nodes=new zn(new $l):1===arguments.length&&(this._nodes=new zn(arguments[0]))};uo.prototype.printEdges=function(l){l.println("Edges:");for(var h=0;h<this._edges.size();h++){l.println("edge "+h+":");var _=this._edges.get(h);_.print(l),_.eiList.print(l)}},uo.prototype.find=function(l){return this._nodes.find(l)},uo.prototype.addNode=function(){return arguments[0]instanceof ec||arguments[0]instanceof ne?this._nodes.addNode(arguments[0]):void 0},uo.prototype.getNodeIterator=function(){return this._nodes.iterator()},uo.prototype.linkResultDirectedEdges=function(){for(var l=this._nodes.iterator();l.hasNext();)l.next().getEdges().linkResultDirectedEdges()},uo.prototype.debugPrintln=function(l){pr.out.println(l)},uo.prototype.isBoundaryNode=function(l,h){var _=this._nodes.find(h);if(null===_)return!1;var w=_.getLabel();return null!==w&&w.getLocation(l)===Se.BOUNDARY},uo.prototype.linkAllDirectedEdges=function(){for(var l=this._nodes.iterator();l.hasNext();)l.next().getEdges().linkAllDirectedEdges()},uo.prototype.matchInSameDirection=function(l,h,_,w){return!!l.equals(_)&&un.computeOrientation(l,h,w)===un.COLLINEAR&&Ci.quadrant(l,h)===Ci.quadrant(_,w)},uo.prototype.getEdgeEnds=function(){return this._edgeEndList},uo.prototype.debugPrint=function(l){pr.out.print(l)},uo.prototype.getEdgeIterator=function(){return this._edges.iterator()},uo.prototype.findEdgeInSameDirection=function(l,h){for(var _=0;_<this._edges.size();_++){var w=this._edges.get(_),I=w.getCoordinates();if(this.matchInSameDirection(l,h,I[0],I[1])||this.matchInSameDirection(l,h,I[I.length-1],I[I.length-2]))return w}return null},uo.prototype.insertEdge=function(l){this._edges.add(l)},uo.prototype.findEdgeEnd=function(l){for(var h=this.getEdgeEnds().iterator();h.hasNext();){var _=h.next();if(_.getEdge()===l)return _}return null},uo.prototype.addEdges=function(l){for(var h=l.iterator();h.hasNext();){var _=h.next();this._edges.add(_);var w=new ha(_,!0),I=new ha(_,!1);w.setSym(I),I.setSym(w),this.add(w),this.add(I)}},uo.prototype.add=function(l){this._nodes.add(l),this._edgeEndList.add(l)},uo.prototype.getNodes=function(){return this._nodes.values()},uo.prototype.findEdge=function(l,h){for(var _=0;_<this._edges.size();_++){var w=this._edges.get(_),I=w.getCoordinates();if(l.equals(I[0])&&h.equals(I[1]))return w}return null},uo.prototype.interfaces_=function(){return[]},uo.prototype.getClass=function(){return uo},uo.linkResultDirectedEdges=function(l){for(var h=l.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()};var Ns=function(){this._geometryFactory=null,this._shellList=new Tn,this._geometryFactory=arguments[0]};Ns.prototype.sortShellsAndHoles=function(l,h,_){for(var w=l.iterator();w.hasNext();){var I=w.next();I.isHole()?_.add(I):h.add(I)}},Ns.prototype.computePolygons=function(l){for(var h=new Tn,_=l.iterator();_.hasNext();){var w=_.next().toPolygon(this._geometryFactory);h.add(w)}return h},Ns.prototype.placeFreeHoles=function(l,h){for(var _=h.iterator();_.hasNext();){var w=_.next();if(null===w.getShell()){var I=this.findEdgeRingContaining(w,l);if(null===I)throw new lo("unable to assign hole to a shell",w.getCoordinate(0));w.setShell(I)}}},Ns.prototype.buildMinimalEdgeRings=function(l,h,_){for(var w=new Tn,I=l.iterator();I.hasNext();){var U=I.next();if(U.getMaxNodeDegree()>2){U.linkDirectedEdgesForMinimalEdgeRings();var q=U.buildMinimalRings(),he=this.findShell(q);null!==he?(this.placePolygonHoles(he,q),h.add(he)):_.addAll(q)}else w.add(U)}return w},Ns.prototype.containsPoint=function(l){for(var h=this._shellList.iterator();h.hasNext();)if(h.next().containsPoint(l))return!0;return!1},Ns.prototype.buildMaximalEdgeRings=function(l){for(var h=new Tn,_=l.iterator();_.hasNext();){var w=_.next();if(w.isInResult()&&w.getLabel().isArea()&&null===w.getEdgeRing()){var I=new pl(w,this._geometryFactory);h.add(I),I.setInResult()}}return h},Ns.prototype.placePolygonHoles=function(l,h){for(var _=h.iterator();_.hasNext();){var w=_.next();w.isHole()&&w.setShell(l)}},Ns.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Ns.prototype.findEdgeRingContaining=function(l,h){for(var _=l.getLinearRing(),w=_.getEnvelopeInternal(),I=_.getCoordinateN(0),U=null,q=null,he=h.iterator();he.hasNext();){var ke=he.next(),wt=ke.getLinearRing(),vt=wt.getEnvelopeInternal();null!==U&&(q=U.getLinearRing().getEnvelopeInternal());var on=!1;vt.contains(w)&&un.isPointInRing(I,wt.getCoordinates())&&(on=!0),on&&(null===U||q.contains(vt))&&(U=ke)}return U},Ns.prototype.findShell=function(l){for(var h=0,_=null,w=l.iterator();w.hasNext();){var I=w.next();I.isHole()||(_=I,h++)}return Me.isTrue(h<=1,"found two shells in MinimalEdgeRing list"),_},Ns.prototype.add=function(){if(1===arguments.length){var l=arguments[0];this.add(l.getEdgeEnds(),l.getNodes())}else if(2===arguments.length){var h=arguments[0];uo.linkResultDirectedEdges(arguments[1]);var w=this.buildMaximalEdgeRings(h),I=new Tn,U=this.buildMinimalEdgeRings(w,this._shellList,I);this.sortShellsAndHoles(U,this._shellList,I),this.placeFreeHoles(this._shellList,I)}},Ns.prototype.interfaces_=function(){return[]},Ns.prototype.getClass=function(){return Ns};var ou=function(){};ou.prototype.getBounds=function(){},ou.prototype.interfaces_=function(){return[]},ou.prototype.getClass=function(){return ou};var xa=function(){this._bounds=null,this._item=null;var h=arguments[1];this._bounds=arguments[0],this._item=h};xa.prototype.getItem=function(){return this._item},xa.prototype.getBounds=function(){return this._bounds},xa.prototype.interfaces_=function(){return[ou,de]},xa.prototype.getClass=function(){return xa};var ql=function(){this._size=null,this._items=null,this._size=0,this._items=new Tn,this._items.add(null)};ql.prototype.poll=function(){if(this.isEmpty())return null;var l=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),l},ql.prototype.size=function(){return this._size},ql.prototype.reorder=function(l){for(var h=null,_=this._items.get(l);2*l<=this._size&&((h=2*l)!==this._size&&this._items.get(h+1).compareTo(this._items.get(h))<0&&h++,this._items.get(h).compareTo(_)<0);l=h)this._items.set(l,this._items.get(h));this._items.set(l,_)},ql.prototype.clear=function(){this._size=0,this._items.clear()},ql.prototype.isEmpty=function(){return 0===this._size},ql.prototype.add=function(l){this._items.add(null),this._size+=1;var h=this._size;for(this._items.set(0,l);l.compareTo(this._items.get(Math.trunc(h/2)))<0;h/=2)this._items.set(h,this._items.get(Math.trunc(h/2)));this._items.set(h,l)},ql.prototype.interfaces_=function(){return[]},ql.prototype.getClass=function(){return ql};var Cl=function(){};Cl.prototype.visitItem=function(l){},Cl.prototype.interfaces_=function(){return[]},Cl.prototype.getClass=function(){return Cl};var Sl=function(){};Sl.prototype.insert=function(l,h){},Sl.prototype.remove=function(l,h){},Sl.prototype.query=function(){},Sl.prototype.interfaces_=function(){return[]},Sl.prototype.getClass=function(){return Sl};var fr=function(){this._childBoundables=new Tn,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},Gu={serialVersionUID:{configurable:!0}};fr.prototype.getLevel=function(){return this._level},fr.prototype.size=function(){return this._childBoundables.size()},fr.prototype.getChildBoundables=function(){return this._childBoundables},fr.prototype.addChildBoundable=function(l){Me.isTrue(null===this._bounds),this._childBoundables.add(l)},fr.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},fr.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},fr.prototype.interfaces_=function(){return[ou,de]},fr.prototype.getClass=function(){return fr},Gu.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(fr,Gu);var Da=function(){};Da.reverseOrder=function(){return{compare:function(l,h){return h.compareTo(l)}}},Da.min=function(l){return Da.sort(l),l.get(0)},Da.sort=function(l,h){var _=l.toArray();h?Pt.sort(_,h):Pt.sort(_);for(var w=l.iterator(),I=0,U=_.length;I<U;I++)w.next(),w.set(_[I])},Da.singletonList=function(l){var h=new Tn;return h.add(l),h};var xi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var h=arguments[1],_=arguments[2];this._boundable1=arguments[0],this._boundable2=h,this._itemDistance=_,this._distance=this.distance()};xi.prototype.expandToQueue=function(l,h){var _=xi.isComposite(this._boundable1),w=xi.isComposite(this._boundable2);if(_&&w)return xi.area(this._boundable1)>xi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,l,h),null):(this.expand(this._boundable2,this._boundable1,l,h),null);if(_)return this.expand(this._boundable1,this._boundable2,l,h),null;if(w)return this.expand(this._boundable2,this._boundable1,l,h),null;throw new Q("neither boundable is composite")},xi.prototype.isLeaves=function(){return!(xi.isComposite(this._boundable1)||xi.isComposite(this._boundable2))},xi.prototype.compareTo=function(l){return this._distance<l._distance?-1:this._distance>l._distance?1:0},xi.prototype.expand=function(l,h,_,w){for(var I=l.getChildBoundables().iterator();I.hasNext();){var U=I.next(),q=new xi(U,h,this._itemDistance);q.getDistance()<w&&_.add(q)}},xi.prototype.getBoundable=function(l){return 0===l?this._boundable1:this._boundable2},xi.prototype.getDistance=function(){return this._distance},xi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},xi.prototype.interfaces_=function(){return[oe]},xi.prototype.getClass=function(){return xi},xi.area=function(l){return l.getBounds().getArea()},xi.isComposite=function(l){return l instanceof fr};var Es=function l(){if(this._root=null,this._built=!1,this._itemBoundables=new Tn,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=l.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var _=arguments[0];Me.isTrue(_>1,"Node capacity must be greater than 1"),this._nodeCapacity=_}},su={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Es.prototype.getNodeCapacity=function(){return this._nodeCapacity},Es.prototype.lastNode=function(l){return l.get(l.size()-1)},Es.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var l=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var _=h.next();_ instanceof fr?l+=this.size(_):_ instanceof xa&&(l+=1)}return l}},Es.prototype.removeItem=function(l,h){for(var _=null,w=l.getChildBoundables().iterator();w.hasNext();){var I=w.next();I instanceof xa&&I.getItem()===h&&(_=I)}return null!==_&&(l.getChildBoundables().remove(_),!0)},Es.prototype.itemsTree=function(){if(0===arguments.length){this.build();var l=this.itemsTree(this._root);return null===l?new Tn:l}if(1===arguments.length){for(var h=arguments[0],_=new Tn,w=h.getChildBoundables().iterator();w.hasNext();){var I=w.next();if(I instanceof fr){var U=this.itemsTree(I);null!==U&&_.add(U)}else I instanceof xa?_.add(I.getItem()):Me.shouldNeverReachHere()}return _.size()<=0?null:_}},Es.prototype.insert=function(l,h){Me.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new xa(l,h))},Es.prototype.boundablesAtLevel=function(){if(1===arguments.length){var l=arguments[0],h=new Tn;return this.boundablesAtLevel(l,this._root,h),h}if(3===arguments.length){var _=arguments[0],w=arguments[1],I=arguments[2];if(Me.isTrue(_>-2),w.getLevel()===_)return I.add(w),null;for(var U=w.getChildBoundables().iterator();U.hasNext();){var q=U.next();q instanceof fr?this.boundablesAtLevel(_,q,I):(Me.isTrue(q instanceof xa),-1===_&&I.add(q))}return null}},Es.prototype.query=function(){if(1===arguments.length){var l=arguments[0];this.build();var h=new Tn;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),l)&&this.query(l,this._root,h),h}if(2===arguments.length){var _=arguments[0],w=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),_)&&this.query(_,this._root,w)}else if(3===arguments.length)if(Bt(arguments[2],Cl)&&arguments[0]instanceof Object&&arguments[1]instanceof fr)for(var I=arguments[0],q=arguments[2],he=arguments[1].getChildBoundables(),ke=0;ke<he.size();ke++){var wt=he.get(ke);this.getIntersectsOp().intersects(wt.getBounds(),I)&&(wt instanceof fr?this.query(I,wt,q):wt instanceof xa?q.visitItem(wt.getItem()):Me.shouldNeverReachHere())}else if(Bt(arguments[2],Ls)&&arguments[0]instanceof Object&&arguments[1]instanceof fr)for(var vt=arguments[0],Gn=arguments[2],qn=arguments[1].getChildBoundables(),hr=0;hr<qn.size();hr++){var Lr=qn.get(hr);this.getIntersectsOp().intersects(Lr.getBounds(),vt)&&(Lr instanceof fr?this.query(vt,Lr,Gn):Lr instanceof xa?Gn.add(Lr.getItem()):Me.shouldNeverReachHere())}},Es.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Es.prototype.getRoot=function(){return this.build(),this._root},Es.prototype.remove=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),l)&&this.remove(l,this._root,h)}if(3===arguments.length){var _=arguments[0],w=arguments[1],I=arguments[2],U=this.removeItem(w,I);if(U)return!0;for(var q=null,he=w.getChildBoundables().iterator();he.hasNext();){var ke=he.next();if(this.getIntersectsOp().intersects(ke.getBounds(),_)&&ke instanceof fr&&(U=this.remove(_,ke,I))){q=ke;break}}return null!==q&&q.getChildBoundables().isEmpty()&&w.getChildBoundables().remove(q),U}},Es.prototype.createHigherLevels=function(l,h){Me.isTrue(!l.isEmpty());var _=this.createParentBoundables(l,h+1);return 1===_.size()?_.get(0):this.createHigherLevels(_,h+1)},Es.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var l=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var _=h.next();if(_ instanceof fr){var w=this.depth(_);w>l&&(l=w)}}return l+1}},Es.prototype.createParentBoundables=function(l,h){Me.isTrue(!l.isEmpty());var _=new Tn;_.add(this.createNode(h));var w=new Tn(l);Da.sort(w,this.getComparator());for(var I=w.iterator();I.hasNext();){var U=I.next();this.lastNode(_).getChildBoundables().size()===this.getNodeCapacity()&&_.add(this.createNode(h)),this.lastNode(_).addChildBoundable(U)}return _},Es.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Es.prototype.interfaces_=function(){return[de]},Es.prototype.getClass=function(){return Es},Es.compareDoubles=function(l,h){return l>h?1:l<h?-1:0},su.IntersectsOp.get=function(){return ms},su.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},su.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Es,su);var ms=function(){},ia=function(){};ia.prototype.distance=function(l,h){},ia.prototype.interfaces_=function(){return[]},ia.prototype.getClass=function(){return ia};var Ih=function(l){function h(w){l.call(this,w=w||h.DEFAULT_NODE_CAPACITY)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return h.prototype.createParentBoundablesFromVerticalSlices=function(w,I){Me.isTrue(w.length>0);for(var U=new Tn,q=0;q<w.length;q++)U.addAll(this.createParentBoundablesFromVerticalSlice(w[q],I));return U},h.prototype.createNode=function(w){return new sf(w)},h.prototype.size=function(){return 0===arguments.length?l.prototype.size.call(this):l.prototype.size.apply(this,arguments)},h.prototype.insert=function(){if(2!==arguments.length)return l.prototype.insert.apply(this,arguments);var w=arguments[0],I=arguments[1];if(w.isNull())return null;l.prototype.insert.call(this,w,I)},h.prototype.getIntersectsOp=function(){return h.intersectsOp},h.prototype.verticalSlices=function(w,I){for(var U=Math.trunc(Math.ceil(w.size()/I)),q=new Array(I).fill(null),he=w.iterator(),ke=0;ke<I;ke++){q[ke]=new Tn;for(var wt=0;he.hasNext()&&wt<U;){var vt=he.next();q[ke].add(vt),wt++}}return q},h.prototype.query=function(){if(1===arguments.length)return l.prototype.query.call(this,arguments[0]);2===arguments.length?l.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(Bt(arguments[2],Cl)&&arguments[0]instanceof Object&&arguments[1]instanceof fr||Bt(arguments[2],Ls)&&arguments[0]instanceof Object&&arguments[1]instanceof fr)&&l.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},h.prototype.getComparator=function(){return h.yComparator},h.prototype.createParentBoundablesFromVerticalSlice=function(w,I){return l.prototype.createParentBoundables.call(this,w,I)},h.prototype.remove=function(){return 2===arguments.length?l.prototype.remove.call(this,arguments[0],arguments[1]):l.prototype.remove.apply(this,arguments)},h.prototype.depth=function(){return 0===arguments.length?l.prototype.depth.call(this):l.prototype.depth.apply(this,arguments)},h.prototype.createParentBoundables=function(w,I){Me.isTrue(!w.isEmpty());var U=Math.trunc(Math.ceil(w.size()/this.getNodeCapacity())),q=new Tn(w);Da.sort(q,h.xComparator);var he=this.verticalSlices(q,Math.trunc(Math.ceil(Math.sqrt(U))));return this.createParentBoundablesFromVerticalSlices(he,I)},h.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Bt(arguments[0],ia)){var w=arguments[0],I=new xi(this.getRoot(),this.getRoot(),w);return this.nearestNeighbour(I)}if(arguments[0]instanceof xi)return this.nearestNeighbour(arguments[0],te.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof h&&Bt(arguments[1],ia)){var q=arguments[0],he=arguments[1],ke=new xi(this.getRoot(),q.getRoot(),he);return this.nearestNeighbour(ke)}if(arguments[0]instanceof xi&&"number"==typeof arguments[1]){var wt=arguments[0],vt=arguments[1],on=null,Gn=new ql;for(Gn.add(wt);!Gn.isEmpty()&&vt>0;){var qn=Gn.poll(),hr=qn.getDistance();if(hr>=vt)break;qn.isLeaves()?(vt=hr,on=qn):qn.expandToQueue(Gn,vt)}return[on.getBoundable(0).getItem(),on.getBoundable(1).getItem()]}}else if(3===arguments.length){var Ps=arguments[2],ka=new xa(arguments[0],arguments[1]),Pl=new xi(this.getRoot(),ka,Ps);return this.nearestNeighbour(Pl)[0]}},h.prototype.interfaces_=function(){return[Sl,de]},h.prototype.getClass=function(){return h},h.centreX=function(w){return h.avg(w.getMinX(),w.getMaxX())},h.avg=function(w,I){return(w+I)/2},h.centreY=function(w){return h.avg(w.getMinY(),w.getMaxY())},_.STRtreeNode.get=function(){return sf},_.serialVersionUID.get=function(){return 0x39920f7d5f261e0},_.xComparator.get=function(){return{interfaces_:function(){return[me]},compare:function(w,I){return l.compareDoubles(h.centreX(w.getBounds()),h.centreX(I.getBounds()))}}},_.yComparator.get=function(){return{interfaces_:function(){return[me]},compare:function(w,I){return l.compareDoubles(h.centreY(w.getBounds()),h.centreY(I.getBounds()))}}},_.intersectsOp.get=function(){return{interfaces_:function(){return[l.IntersectsOp]},intersects:function(w,I){return w.intersects(I)}}},_.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(h,_),h}(Es),sf=function(l){function h(){l.call(this,arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.computeBounds=function(){for(var _=null,w=this.getChildBoundables().iterator();w.hasNext();){var I=w.next();null===_?_=new Rn(I.getBounds()):_.expandToInclude(I.getBounds())}return _},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(fr),bo=function(){};bo.prototype.interfaces_=function(){return[]},bo.prototype.getClass=function(){return bo},bo.relativeSign=function(l,h){return l<h?-1:l>h?1:0},bo.compare=function(l,h,_){if(h.equals2D(_))return 0;var w=bo.relativeSign(h.x,_.x),I=bo.relativeSign(h.y,_.y);switch(l){case 0:return bo.compareValue(w,I);case 1:return bo.compareValue(I,w);case 2:return bo.compareValue(I,-w);case 3:return bo.compareValue(-w,I);case 4:return bo.compareValue(-w,-I);case 5:return bo.compareValue(-I,-w);case 6:return bo.compareValue(-I,w);case 7:return bo.compareValue(w,-I)}return Me.shouldNeverReachHere("invalid octant value"),0},bo.compareValue=function(l,h){return l<0?-1:l>0?1:h<0?-1:h>0?1:0};var Zi=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var l=arguments[0],h=arguments[1],_=arguments[2],w=arguments[3];this._segString=l,this.coord=new ne(h),this.segmentIndex=_,this._segmentOctant=w,this._isInterior=!h.equals2D(l.getCoordinate(_))};Zi.prototype.getCoordinate=function(){return this.coord},Zi.prototype.print=function(l){l.print(this.coord),l.print(" seg # = "+this.segmentIndex)},Zi.prototype.compareTo=function(l){var h=l;return this.segmentIndex<h.segmentIndex?-1:this.segmentIndex>h.segmentIndex?1:this.coord.equals2D(h.coord)?0:bo.compare(this._segmentOctant,this.coord,h.coord)},Zi.prototype.isEndPoint=function(l){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===l},Zi.prototype.isInterior=function(){return this._isInterior},Zi.prototype.interfaces_=function(){return[oe]},Zi.prototype.getClass=function(){return Zi};var fa=function(){this._nodeMap=new nt,this._edge=null,this._edge=arguments[0]};fa.prototype.getSplitCoordinates=function(){var l=new va;this.addEndpoints();for(var h=this.iterator(),_=h.next();h.hasNext();){var w=h.next();this.addEdgeCoordinates(_,w,l),_=w}return l.toCoordinateArray()},fa.prototype.addCollapsedNodes=function(){var l=new Tn;this.findCollapsesFromInsertedNodes(l),this.findCollapsesFromExistingVertices(l);for(var h=l.iterator();h.hasNext();){var _=h.next().intValue();this.add(this._edge.getCoordinate(_),_)}},fa.prototype.print=function(l){l.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(l)},fa.prototype.findCollapsesFromExistingVertices=function(l){for(var h=0;h<this._edge.size()-2;h++){var _=this._edge.getCoordinate(h),w=this._edge.getCoordinate(h+2);_.equals2D(w)&&l.add(new gt(h+1))}},fa.prototype.addEdgeCoordinates=function(l,h,_){var w=this._edge.getCoordinate(h.segmentIndex),I=h.isInterior()||!h.coord.equals2D(w);_.add(new ne(l.coord),!1);for(var U=l.segmentIndex+1;U<=h.segmentIndex;U++)_.add(this._edge.getCoordinate(U));I&&_.add(new ne(h.coord))},fa.prototype.iterator=function(){return this._nodeMap.values().iterator()},fa.prototype.addSplitEdges=function(l){this.addEndpoints(),this.addCollapsedNodes();for(var h=this.iterator(),_=h.next();h.hasNext();){var w=h.next(),I=this.createSplitEdge(_,w);l.add(I),_=w}},fa.prototype.findCollapseIndex=function(l,h,_){if(!l.coord.equals2D(h.coord))return!1;var w=h.segmentIndex-l.segmentIndex;return h.isInterior()||w--,1===w&&(_[0]=l.segmentIndex+1,!0)},fa.prototype.findCollapsesFromInsertedNodes=function(l){for(var h=new Array(1).fill(null),_=this.iterator(),w=_.next();_.hasNext();){var I=_.next();this.findCollapseIndex(w,I,h)&&l.add(new gt(h[0])),w=I}},fa.prototype.getEdge=function(){return this._edge},fa.prototype.addEndpoints=function(){var l=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(l),l)},fa.prototype.createSplitEdge=function(l,h){var _=h.segmentIndex-l.segmentIndex+2,w=this._edge.getCoordinate(h.segmentIndex),I=h.isInterior()||!h.coord.equals2D(w);I||_--;var U=new Array(_).fill(null),q=0;U[q++]=new ne(l.coord);for(var he=l.segmentIndex+1;he<=h.segmentIndex;he++)U[q++]=this._edge.getCoordinate(he);return I&&(U[q]=new ne(h.coord)),new go(U,this._edge.getData())},fa.prototype.add=function(l,h){var _=new Zi(this._edge,l,h,this._edge.getSegmentOctant(h)),w=this._nodeMap.get(_);return null!==w?(Me.isTrue(w.coord.equals2D(l),"Found equal nodes with different coordinates"),w):(this._nodeMap.put(_,_),_)},fa.prototype.checkSplitEdgesCorrectness=function(l){var h=this._edge.getCoordinates(),_=l.get(0).getCoordinate(0);if(!_.equals2D(h[0]))throw new Le("bad split edge start point at "+_);var w=l.get(l.size()-1).getCoordinates(),I=w[w.length-1];if(!I.equals2D(h[h.length-1]))throw new Le("bad split edge end point at "+I)},fa.prototype.interfaces_=function(){return[]},fa.prototype.getClass=function(){return fa};var Au=function(){};Au.prototype.interfaces_=function(){return[]},Au.prototype.getClass=function(){return Au},Au.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var l=arguments[0],h=arguments[1];if(0===l&&0===h)throw new Q("Cannot compute the octant for point ( "+l+", "+h+" )");var _=Math.abs(l),w=Math.abs(h);return l>=0?h>=0?_>=w?0:1:_>=w?7:6:h>=0?_>=w?3:2:_>=w?4:5}if(arguments[0]instanceof ne&&arguments[1]instanceof ne){var I=arguments[0],U=arguments[1],q=U.x-I.x,he=U.y-I.y;if(0===q&&0===he)throw new Q("Cannot compute the octant for two identical points "+I);return Au.octant(q,he)}};var oa=function(){};oa.prototype.getCoordinates=function(){},oa.prototype.size=function(){},oa.prototype.getCoordinate=function(l){},oa.prototype.isClosed=function(){},oa.prototype.setData=function(l){},oa.prototype.getData=function(){},oa.prototype.interfaces_=function(){return[]},oa.prototype.getClass=function(){return oa};var Ri=function(){};Ri.prototype.addIntersection=function(l,h){},Ri.prototype.interfaces_=function(){return[oa]},Ri.prototype.getClass=function(){return Ri};var go=function(){this._nodeList=new fa(this),this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};go.prototype.getCoordinates=function(){return this._pts},go.prototype.size=function(){return this._pts.length},go.prototype.getCoordinate=function(l){return this._pts[l]},go.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},go.prototype.getSegmentOctant=function(l){return l===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(l),this.getCoordinate(l+1))},go.prototype.setData=function(l){this._data=l},go.prototype.safeOctant=function(l,h){return l.equals2D(h)?0:Au.octant(l,h)},go.prototype.getData=function(){return this._data},go.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var w=arguments[1],U=new ne(arguments[0].getIntersection(arguments[3]));this.addIntersection(U,w)}},go.prototype.toString=function(){return Nt.toLineString(new ao(this._pts))},go.prototype.getNodeList=function(){return this._nodeList},go.prototype.addIntersectionNode=function(l,h){var _=h,w=_+1;return w<this._pts.length&&l.equals2D(this._pts[w])&&(_=w),this._nodeList.add(l,_)},go.prototype.addIntersections=function(l,h,_){for(var w=0;w<l.getIntersectionNum();w++)this.addIntersection(l,h,_,w)},go.prototype.interfaces_=function(){return[Ri]},go.prototype.getClass=function(){return go},go.getNodedSubstrings=function(){if(1===arguments.length){var l=arguments[0],h=new Tn;return go.getNodedSubstrings(l,h),h}if(2===arguments.length)for(var w=arguments[1],I=arguments[0].iterator();I.hasNext();)I.next().getNodeList().addSplitEdges(w)};var wr=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new ne,this.p1=new ne;else if(1===arguments.length){var l=arguments[0];this.p0=new ne(l.p0),this.p1=new ne(l.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var w=arguments[2],I=arguments[3];this.p0=new ne(arguments[0],arguments[1]),this.p1=new ne(w,I)}},wc={serialVersionUID:{configurable:!0}};wr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},wr.prototype.orientationIndex=function(){if(arguments[0]instanceof wr){var l=arguments[0],h=un.orientationIndex(this.p0,this.p1,l.p0),_=un.orientationIndex(this.p0,this.p1,l.p1);return h>=0&&_>=0||h<=0&&_<=0?Math.max(h,_):0}if(arguments[0]instanceof ne)return un.orientationIndex(this.p0,this.p1,arguments[0])},wr.prototype.toGeometry=function(l){return l.createLineString([this.p0,this.p1])},wr.prototype.isVertical=function(){return this.p0.x===this.p1.x},wr.prototype.equals=function(l){if(!(l instanceof wr))return!1;var h=l;return this.p0.equals(h.p0)&&this.p1.equals(h.p1)},wr.prototype.intersection=function(l){var h=new Jt;return h.computeIntersection(this.p0,this.p1,l.p0,l.p1),h.hasIntersection()?h.getIntersection(0):null},wr.prototype.project=function(){if(arguments[0]instanceof ne){var l=arguments[0];if(l.equals(this.p0)||l.equals(this.p1))return new ne(l);var h=this.projectionFactor(l),_=new ne;return _.x=this.p0.x+h*(this.p1.x-this.p0.x),_.y=this.p0.y+h*(this.p1.y-this.p0.y),_}if(arguments[0]instanceof wr){var w=arguments[0],I=this.projectionFactor(w.p0),U=this.projectionFactor(w.p1);if(I>=1&&U>=1||I<=0&&U<=0)return null;var q=this.project(w.p0);I<0&&(q=this.p0),I>1&&(q=this.p1);var he=this.project(w.p1);return U<0&&(he=this.p0),U>1&&(he=this.p1),new wr(q,he)}},wr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},wr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},wr.prototype.getCoordinate=function(l){return 0===l?this.p0:this.p1},wr.prototype.distancePerpendicular=function(l){return un.distancePointLinePerpendicular(l,this.p0,this.p1)},wr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},wr.prototype.midPoint=function(){return wr.midPoint(this.p0,this.p1)},wr.prototype.projectionFactor=function(l){if(l.equals(this.p0))return 0;if(l.equals(this.p1))return 1;var h=this.p1.x-this.p0.x,_=this.p1.y-this.p0.y,w=h*h+_*_;return w<=0?te.NaN:((l.x-this.p0.x)*h+(l.y-this.p0.y)*_)/w},wr.prototype.closestPoints=function(l){var h=this.intersection(l);if(null!==h)return[h,h];var _=new Array(2).fill(null),w=te.MAX_VALUE,I=null,U=this.closestPoint(l.p0);w=U.distance(l.p0),_[0]=U,_[1]=l.p0;var q=this.closestPoint(l.p1);(I=q.distance(l.p1))<w&&(w=I,_[0]=q,_[1]=l.p1);var he=l.closestPoint(this.p0);(I=he.distance(this.p0))<w&&(w=I,_[0]=this.p0,_[1]=he);var ke=l.closestPoint(this.p1);return(I=ke.distance(this.p1))<w&&(w=I,_[0]=this.p1,_[1]=ke),_},wr.prototype.closestPoint=function(l){var h=this.projectionFactor(l);return h>0&&h<1?this.project(l):this.p0.distance(l)<this.p1.distance(l)?this.p0:this.p1},wr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},wr.prototype.getLength=function(){return this.p0.distance(this.p1)},wr.prototype.compareTo=function(l){var h=l,_=this.p0.compareTo(h.p0);return 0!==_?_:this.p1.compareTo(h.p1)},wr.prototype.reverse=function(){var l=this.p0;this.p0=this.p1,this.p1=l},wr.prototype.equalsTopo=function(l){return this.p0.equals(l.p0)&&(this.p1.equals(l.p1)||this.p0.equals(l.p1))&&this.p1.equals(l.p0)},wr.prototype.lineIntersection=function(l){try{return Un.intersection(this.p0,this.p1,l.p0,l.p1)}catch(h){if(!(h instanceof Kn))throw h}return null},wr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},wr.prototype.pointAlongOffset=function(l,h){var _=this.p0.x+l*(this.p1.x-this.p0.x),w=this.p0.y+l*(this.p1.y-this.p0.y),I=this.p1.x-this.p0.x,U=this.p1.y-this.p0.y,q=Math.sqrt(I*I+U*U),he=0,ke=0;if(0!==h){if(q<=0)throw new Error("Cannot compute offset from zero-length line segment");he=h*I/q,ke=h*U/q}return new ne(_-ke,w+he)},wr.prototype.setCoordinates=function(){if(1===arguments.length){var l=arguments[0];this.setCoordinates(l.p0,l.p1)}else if(2===arguments.length){var h=arguments[0],_=arguments[1];this.p0.x=h.x,this.p0.y=h.y,this.p1.x=_.x,this.p1.y=_.y}},wr.prototype.segmentFraction=function(l){var h=this.projectionFactor(l);return h<0?h=0:(h>1||te.isNaN(h))&&(h=1),h},wr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},wr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},wr.prototype.distance=function(){if(arguments[0]instanceof wr){var l=arguments[0];return un.distanceLineLine(this.p0,this.p1,l.p0,l.p1)}if(arguments[0]instanceof ne)return un.distancePointLine(arguments[0],this.p0,this.p1)},wr.prototype.pointAlong=function(l){var h=new ne;return h.x=this.p0.x+l*(this.p1.x-this.p0.x),h.y=this.p0.y+l*(this.p1.y-this.p0.y),h},wr.prototype.hashCode=function(){var l=te.doubleToLongBits(this.p0.x);l^=31*te.doubleToLongBits(this.p0.y);var h=Math.trunc(l)^Math.trunc(l>>32),_=te.doubleToLongBits(this.p1.x);return _^=31*te.doubleToLongBits(this.p1.y),h^Math.trunc(_)^Math.trunc(_>>32)},wr.prototype.interfaces_=function(){return[oe,de]},wr.prototype.getClass=function(){return wr},wr.midPoint=function(l,h){return new ne((l.x+h.x)/2,(l.y+h.y)/2)},wc.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(wr,wc);var gl=function(){this.tempEnv1=new Rn,this.tempEnv2=new Rn,this._overlapSeg1=new wr,this._overlapSeg2=new wr};gl.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var _=arguments[2],w=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),_.getLineSegment(w,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},gl.prototype.interfaces_=function(){return[]},gl.prototype.getClass=function(){return gl};var Ur=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[1],_=arguments[2],w=arguments[3];this._pts=arguments[0],this._start=h,this._end=_,this._context=w};Ur.prototype.getLineSegment=function(l,h){h.p0=this._pts[l],h.p1=this._pts[l+1]},Ur.prototype.computeSelect=function(l,h,_,w){if(w.tempEnv1.init(this._pts[h],this._pts[_]),_-h==1)return w.select(this,h),null;if(!l.intersects(w.tempEnv1))return null;var q=Math.trunc((h+_)/2);h<q&&this.computeSelect(l,h,q,w),q<_&&this.computeSelect(l,q,_,w)},Ur.prototype.getCoordinates=function(){for(var l=new Array(this._end-this._start+1).fill(null),h=0,_=this._start;_<=this._end;_++)l[h++]=this._pts[_];return l},Ur.prototype.computeOverlaps=function(l,h){this.computeOverlapsInternal(this._start,this._end,l,l._start,l._end,h)},Ur.prototype.setId=function(l){this._id=l},Ur.prototype.select=function(l,h){this.computeSelect(l,this._start,this._end,h)},Ur.prototype.getEnvelope=function(){return null===this._env&&(this._env=new Rn(this._pts[this._start],this._pts[this._end])),this._env},Ur.prototype.getEndIndex=function(){return this._end},Ur.prototype.getStartIndex=function(){return this._start},Ur.prototype.getContext=function(){return this._context},Ur.prototype.getId=function(){return this._id},Ur.prototype.computeOverlapsInternal=function(l,h,_,w,I,U){var q=this._pts[l],he=this._pts[h],ke=_._pts[w],wt=_._pts[I];if(h-l==1&&I-w==1)return U.overlap(this,l,_,w),null;if(U.tempEnv1.init(q,he),U.tempEnv2.init(ke,wt),!U.tempEnv1.intersects(U.tempEnv2))return null;var vt=Math.trunc((l+h)/2),on=Math.trunc((w+I)/2);l<vt&&(w<on&&this.computeOverlapsInternal(l,vt,_,w,on,U),on<I&&this.computeOverlapsInternal(l,vt,_,on,I,U)),vt<h&&(w<on&&this.computeOverlapsInternal(vt,h,_,w,on,U),on<I&&this.computeOverlapsInternal(vt,h,_,on,I,U))},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur};var ea=function(){};ea.prototype.interfaces_=function(){return[]},ea.prototype.getClass=function(){return ea},ea.getChainStartIndices=function(l){var h=0,_=new Tn;_.add(new gt(h));do{var w=ea.findChainEnd(l,h);_.add(new gt(w)),h=w}while(h<l.length-1);return ea.toIntArray(_)},ea.findChainEnd=function(l,h){for(var _=h;_<l.length-1&&l[_].equals2D(l[_+1]);)_++;if(_>=l.length-1)return l.length-1;for(var w=Ci.quadrant(l[_],l[_+1]),I=h+1;I<l.length&&(l[I-1].equals2D(l[I])||Ci.quadrant(l[I-1],l[I])===w);)I++;return I-1},ea.getChains=function(){if(1===arguments.length)return ea.getChains(arguments[0],null);if(2===arguments.length){for(var h=arguments[0],_=arguments[1],w=new Tn,I=ea.getChainStartIndices(h),U=0;U<I.length-1;U++){var q=new Ur(h,I[U],I[U+1],_);w.add(q)}return w}},ea.toIntArray=function(l){for(var h=new Array(l.size()).fill(null),_=0;_<h.length;_++)h[_]=l.get(_).intValue();return h};var Hl=function(){};Hl.prototype.computeNodes=function(l){},Hl.prototype.getNodedSubstrings=function(){},Hl.prototype.interfaces_=function(){return[]},Hl.prototype.getClass=function(){return Hl};var ja=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};ja.prototype.setSegmentIntersector=function(l){this._segInt=l},ja.prototype.interfaces_=function(){return[Hl]},ja.prototype.getClass=function(){return ja};var au=function(l){function h(w){w?l.call(this,w):l.call(this),this._monoChains=new Tn,this._index=new Ih,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var _={SegmentOverlapAction:{configurable:!0}};return h.prototype.getMonotoneChains=function(){return this._monoChains},h.prototype.getNodedSubstrings=function(){return go.getNodedSubstrings(this._nodedSegStrings)},h.prototype.getIndex=function(){return this._index},h.prototype.add=function(w){for(var I=ea.getChains(w.getCoordinates(),w).iterator();I.hasNext();){var U=I.next();U.setId(this._idCounter++),this._index.insert(U.getEnvelope(),U),this._monoChains.add(U)}},h.prototype.computeNodes=function(w){this._nodedSegStrings=w;for(var I=w.iterator();I.hasNext();)this.add(I.next());this.intersectChains()},h.prototype.intersectChains=function(){for(var w=new bc(this._segInt),I=this._monoChains.iterator();I.hasNext();)for(var U=I.next(),q=this._index.query(U.getEnvelope()).iterator();q.hasNext();){var he=q.next();if(he.getId()>U.getId()&&(U.computeOverlaps(he,w),this._nOverlaps++),this._segInt.isDone())return null}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},_.SegmentOverlapAction.get=function(){return bc},Object.defineProperties(h,_),h}(ja),bc=function(l){function h(){l.call(this),this._si=null,this._si=arguments[0]}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.overlap=function(){if(4!==arguments.length)return l.prototype.overlap.apply(this,arguments);var w=arguments[1],I=arguments[2],U=arguments[3],q=arguments[0].getContext(),he=I.getContext();this._si.processIntersections(q,w,he,U)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(gl),ki=function l(){if(this._quadrantSegments=l.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=l.CAP_ROUND,this._joinStyle=l.JOIN_ROUND,this._mitreLimit=l.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=l.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var w=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(w)}else if(4===arguments.length){var U=arguments[1],q=arguments[2],he=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(U),this.setJoinStyle(q),this.setMitreLimit(he)}},ls={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};ki.prototype.getEndCapStyle=function(){return this._endCapStyle},ki.prototype.isSingleSided=function(){return this._isSingleSided},ki.prototype.setQuadrantSegments=function(l){this._quadrantSegments=l,0===this._quadrantSegments&&(this._joinStyle=ki.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=ki.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),l<=0&&(this._quadrantSegments=1),this._joinStyle!==ki.JOIN_ROUND&&(this._quadrantSegments=ki.DEFAULT_QUADRANT_SEGMENTS)},ki.prototype.getJoinStyle=function(){return this._joinStyle},ki.prototype.setJoinStyle=function(l){this._joinStyle=l},ki.prototype.setSimplifyFactor=function(l){this._simplifyFactor=l<0?0:l},ki.prototype.getSimplifyFactor=function(){return this._simplifyFactor},ki.prototype.getQuadrantSegments=function(){return this._quadrantSegments},ki.prototype.setEndCapStyle=function(l){this._endCapStyle=l},ki.prototype.getMitreLimit=function(){return this._mitreLimit},ki.prototype.setMitreLimit=function(l){this._mitreLimit=l},ki.prototype.setSingleSided=function(l){this._isSingleSided=l},ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki},ki.bufferDistanceError=function(l){var h=Math.PI/2/l;return 1-Math.cos(h/2)},ls.CAP_ROUND.get=function(){return 1},ls.CAP_FLAT.get=function(){return 2},ls.CAP_SQUARE.get=function(){return 3},ls.JOIN_ROUND.get=function(){return 1},ls.JOIN_MITRE.get=function(){return 2},ls.JOIN_BEVEL.get=function(){return 3},ls.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},ls.DEFAULT_MITRE_LIMIT.get=function(){return 5},ls.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(ki,ls);var us=function(l){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=un.COUNTERCLOCKWISE,this._inputLine=l||null},$u={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};us.prototype.isDeletable=function(l,h,_,w){var I=this._inputLine[l],U=this._inputLine[h],q=this._inputLine[_];return!!this.isConcave(I,U,q)&&!!this.isShallow(I,U,q,w)&&this.isShallowSampled(I,U,l,_,w)},us.prototype.deleteShallowConcavities=function(){for(var l=1,h=this.findNextNonDeletedIndex(l),_=this.findNextNonDeletedIndex(h),w=!1;_<this._inputLine.length;){var I=!1;this.isDeletable(l,h,_,this._distanceTol)&&(this._isDeleted[h]=us.DELETE,I=!0,w=!0),h=this.findNextNonDeletedIndex(l=I?_:h),_=this.findNextNonDeletedIndex(h)}return w},us.prototype.isShallowConcavity=function(l,h,_,w){return un.computeOrientation(l,h,_)===this._angleOrientation&&un.distancePointLine(h,l,_)<w},us.prototype.isShallowSampled=function(l,h,_,w,I){var U=Math.trunc((w-_)/us.NUM_PTS_TO_CHECK);U<=0&&(U=1);for(var q=_;q<w;q+=U)if(!this.isShallow(l,h,this._inputLine[q],I))return!1;return!0},us.prototype.isConcave=function(l,h,_){return un.computeOrientation(l,h,_)===this._angleOrientation},us.prototype.simplify=function(l){this._distanceTol=Math.abs(l),l<0&&(this._angleOrientation=un.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var h=!1;do{h=this.deleteShallowConcavities()}while(h);return this.collapseLine()},us.prototype.findNextNonDeletedIndex=function(l){for(var h=l+1;h<this._inputLine.length&&this._isDeleted[h]===us.DELETE;)h++;return h},us.prototype.isShallow=function(l,h,_,w){return un.distancePointLine(h,l,_)<w},us.prototype.collapseLine=function(){for(var l=new va,h=0;h<this._inputLine.length;h++)this._isDeleted[h]!==us.DELETE&&l.add(this._inputLine[h]);return l.toCoordinateArray()},us.prototype.interfaces_=function(){return[]},us.prototype.getClass=function(){return us},us.simplify=function(l,h){return new us(l).simplify(h)},$u.INIT.get=function(){return 0},$u.DELETE.get=function(){return 1},$u.KEEP.get=function(){return 1},$u.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(us,$u);var Fi=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Tn},Xs={COORDINATE_ARRAY_TYPE:{configurable:!0}};Fi.prototype.getCoordinates=function(){return this._ptList.toArray(Fi.COORDINATE_ARRAY_TYPE)},Fi.prototype.setPrecisionModel=function(l){this._precisionModel=l},Fi.prototype.addPt=function(l){var h=new ne(l);if(this._precisionModel.makePrecise(h),this.isRedundant(h))return null;this._ptList.add(h)},Fi.prototype.revere=function(){},Fi.prototype.addPts=function(l,h){if(h)for(var _=0;_<l.length;_++)this.addPt(l[_]);else for(var w=l.length-1;w>=0;w--)this.addPt(l[w])},Fi.prototype.isRedundant=function(l){if(this._ptList.size()<1)return!1;var h=this._ptList.get(this._ptList.size()-1);return l.distance(h)<this._minimimVertexDistance},Fi.prototype.toString=function(){return(new at).createLineString(this.getCoordinates()).toString()},Fi.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var l=new ne(this._ptList.get(0)),h=this._ptList.get(this._ptList.size()-1);if(l.equals(h))return null;this._ptList.add(l)},Fi.prototype.setMinimumVertexDistance=function(l){this._minimimVertexDistance=l},Fi.prototype.interfaces_=function(){return[]},Fi.prototype.getClass=function(){return Fi},Xs.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Fi,Xs);var ur=function(){},Eo={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ur.prototype.interfaces_=function(){return[]},ur.prototype.getClass=function(){return ur},ur.toDegrees=function(l){return 180*l/Math.PI},ur.normalize=function(l){for(;l>Math.PI;)l-=ur.PI_TIMES_2;for(;l<=-Math.PI;)l+=ur.PI_TIMES_2;return l},ur.angle=function(){if(1===arguments.length){var l=arguments[0];return Math.atan2(l.y,l.x)}if(2===arguments.length){var h=arguments[0],_=arguments[1];return Math.atan2(_.y-h.y,_.x-h.x)}},ur.isAcute=function(l,h,_){return(l.x-h.x)*(_.x-h.x)+(l.y-h.y)*(_.y-h.y)>0},ur.isObtuse=function(l,h,_){return(l.x-h.x)*(_.x-h.x)+(l.y-h.y)*(_.y-h.y)<0},ur.interiorAngle=function(l,h,_){var w=ur.angle(h,l),I=ur.angle(h,_);return Math.abs(I-w)},ur.normalizePositive=function(l){if(l<0){for(;l<0;)l+=ur.PI_TIMES_2;l>=ur.PI_TIMES_2&&(l=0)}else{for(;l>=ur.PI_TIMES_2;)l-=ur.PI_TIMES_2;l<0&&(l=0)}return l},ur.angleBetween=function(l,h,_){var w=ur.angle(h,l),I=ur.angle(h,_);return ur.diff(w,I)},ur.diff=function(l,h){var _=null;return(_=l<h?h-l:l-h)>Math.PI&&(_=2*Math.PI-_),_},ur.toRadians=function(l){return l*Math.PI/180},ur.getTurn=function(l,h){var _=Math.sin(h-l);return _>0?ur.COUNTERCLOCKWISE:_<0?ur.CLOCKWISE:ur.NONE},ur.angleBetweenOriented=function(l,h,_){var w=ur.angle(h,l),I=ur.angle(h,_)-w;return I<=-Math.PI?I+ur.PI_TIMES_2:I>Math.PI?I-ur.PI_TIMES_2:I},Eo.PI_TIMES_2.get=function(){return 2*Math.PI},Eo.PI_OVER_2.get=function(){return Math.PI/2},Eo.PI_OVER_4.get=function(){return Math.PI/4},Eo.COUNTERCLOCKWISE.get=function(){return un.COUNTERCLOCKWISE},Eo.CLOCKWISE.get=function(){return un.CLOCKWISE},Eo.NONE.get=function(){return un.COLLINEAR},Object.defineProperties(ur,Eo);var er=function l(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new wr,this._seg1=new wr,this._offset0=new wr,this._offset1=new wr,this._side=0,this._hasNarrowConcaveAngle=!1;var _=arguments[1],w=arguments[2];this._precisionModel=arguments[0],this._bufParams=_,this._li=new Jt,this._filletAngleQuantum=Math.PI/2/_.getQuadrantSegments(),_.getQuadrantSegments()>=8&&_.getJoinStyle()===ki.JOIN_ROUND&&(this._closingSegLengthFactor=l.MAX_CLOSING_SEG_LEN_FACTOR),this.init(w)},Ga={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};er.prototype.addNextSegment=function(l,h){if(this._s0=this._s1,this._s1=this._s2,this._s2=l,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var _=un.computeOrientation(this._s0,this._s1,this._s2),w=_===un.CLOCKWISE&&this._side===cn.LEFT||_===un.COUNTERCLOCKWISE&&this._side===cn.RIGHT;0===_?this.addCollinear(h):w?this.addOutsideTurn(_,h):this.addInsideTurn(_,h)},er.prototype.addLineEndCap=function(l,h){var _=new wr(l,h),w=new wr;this.computeOffsetSegment(_,cn.LEFT,this._distance,w);var I=new wr;this.computeOffsetSegment(_,cn.RIGHT,this._distance,I);var he=Math.atan2(h.y-l.y,h.x-l.x);switch(this._bufParams.getEndCapStyle()){case ki.CAP_ROUND:this._segList.addPt(w.p1),this.addFilletArc(h,he+Math.PI/2,he-Math.PI/2,un.CLOCKWISE,this._distance),this._segList.addPt(I.p1);break;case ki.CAP_FLAT:this._segList.addPt(w.p1),this._segList.addPt(I.p1);break;case ki.CAP_SQUARE:var ke=new ne;ke.x=Math.abs(this._distance)*Math.cos(he),ke.y=Math.abs(this._distance)*Math.sin(he);var wt=new ne(w.p1.x+ke.x,w.p1.y+ke.y),vt=new ne(I.p1.x+ke.x,I.p1.y+ke.y);this._segList.addPt(wt),this._segList.addPt(vt)}},er.prototype.getCoordinates=function(){return this._segList.getCoordinates()},er.prototype.addMitreJoin=function(l,h,_,w){var I=!0,U=null;try{U=Un.intersection(h.p0,h.p1,_.p0,_.p1),(w<=0?1:U.distance(l)/Math.abs(w))>this._bufParams.getMitreLimit()&&(I=!1)}catch(q){if(!(q instanceof Kn))throw q;U=new ne(0,0),I=!1}I?this._segList.addPt(U):this.addLimitedMitreJoin(h,_,w,this._bufParams.getMitreLimit())},er.prototype.addFilletCorner=function(l,h,_,w,I){var he=Math.atan2(h.y-l.y,h.x-l.x),vt=Math.atan2(_.y-l.y,_.x-l.x);w===un.CLOCKWISE?he<=vt&&(he+=2*Math.PI):he>=vt&&(he-=2*Math.PI),this._segList.addPt(h),this.addFilletArc(l,he,vt,w,I),this._segList.addPt(_)},er.prototype.addOutsideTurn=function(l,h){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*er.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===ki.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===ki.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(h&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,l,this._distance),this._segList.addPt(this._offset1.p0))},er.prototype.createSquare=function(l){this._segList.addPt(new ne(l.x+this._distance,l.y+this._distance)),this._segList.addPt(new ne(l.x+this._distance,l.y-this._distance)),this._segList.addPt(new ne(l.x-this._distance,l.y-this._distance)),this._segList.addPt(new ne(l.x-this._distance,l.y+this._distance)),this._segList.closeRing()},er.prototype.addSegments=function(l,h){this._segList.addPts(l,h)},er.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},er.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},er.prototype.initSideSegments=function(l,h,_){this._s1=l,this._s2=h,this._side=_,this._seg1.setCoordinates(l,h),this.computeOffsetSegment(this._seg1,_,this._distance,this._offset1)},er.prototype.addLimitedMitreJoin=function(l,h,_,w){var I=this._seg0.p1,U=ur.angle(I,this._seg0.p0),q=ur.angleBetweenOriented(this._seg0.p0,I,this._seg1.p1)/2,he=ur.normalize(U+q),ke=ur.normalize(he+Math.PI),wt=w*_,vt=_-wt*Math.abs(Math.sin(q)),on=I.x+wt*Math.cos(ke),Gn=I.y+wt*Math.sin(ke),qn=new ne(on,Gn),hr=new wr(I,qn),Lr=hr.pointAlongOffset(1,vt),to=hr.pointAlongOffset(1,-vt);this._side===cn.LEFT?(this._segList.addPt(Lr),this._segList.addPt(to)):(this._segList.addPt(to),this._segList.addPt(Lr))},er.prototype.computeOffsetSegment=function(l,h,_,w){var I=h===cn.LEFT?1:-1,U=l.p1.x-l.p0.x,q=l.p1.y-l.p0.y,he=Math.sqrt(U*U+q*q),ke=I*_*U/he,wt=I*_*q/he;w.p0.x=l.p0.x-wt,w.p0.y=l.p0.y+ke,w.p1.x=l.p1.x-wt,w.p1.y=l.p1.y+ke},er.prototype.addFilletArc=function(l,h,_,w,I){var U=w===un.CLOCKWISE?-1:1,q=Math.abs(h-_),he=Math.trunc(q/this._filletAngleQuantum+.5);if(he<1)return null;for(var ke=q/he,wt=0,vt=new ne;wt<q;){var on=h+U*wt;vt.x=l.x+I*Math.cos(on),vt.y=l.y+I*Math.sin(on),this._segList.addPt(vt),wt+=ke}},er.prototype.addInsideTurn=function(l,h){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*er.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var _=new ne((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(_);var w=new ne((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(w)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},er.prototype.createCircle=function(l){var h=new ne(l.x+this._distance,l.y);this._segList.addPt(h),this.addFilletArc(l,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},er.prototype.addBevelJoin=function(l,h){this._segList.addPt(l.p1),this._segList.addPt(h.p0)},er.prototype.init=function(l){this._distance=l,this._maxCurveSegmentError=l*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Fi,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(l*er.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},er.prototype.addCollinear=function(l){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===ki.JOIN_BEVEL||this._bufParams.getJoinStyle()===ki.JOIN_MITRE?(l&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,un.CLOCKWISE,this._distance))},er.prototype.closeRing=function(){this._segList.closeRing()},er.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},er.prototype.interfaces_=function(){return[]},er.prototype.getClass=function(){return er},Ga.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Ga.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Ga.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Ga.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(er,Ga);var Ji=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var h=arguments[1];this._precisionModel=arguments[0],this._bufParams=h};Ji.prototype.getOffsetCurve=function(l,h){if(this._distance=h,0===h)return null;var _=h<0,w=Math.abs(h),I=this.getSegGen(w);l.length<=1?this.computePointCurve(l[0],I):this.computeOffsetCurve(l,_,I);var U=I.getCoordinates();return _&&Fr.reverse(U),U},Ji.prototype.computeSingleSidedBufferCurve=function(l,h,_){var w=this.simplifyTolerance(this._distance);if(h){_.addSegments(l,!0);var I=us.simplify(l,-w),U=I.length-1;_.initSideSegments(I[U],I[U-1],cn.LEFT),_.addFirstSegment();for(var q=U-2;q>=0;q--)_.addNextSegment(I[q],!0)}else{_.addSegments(l,!1);var he=us.simplify(l,w),ke=he.length-1;_.initSideSegments(he[0],he[1],cn.LEFT),_.addFirstSegment();for(var wt=2;wt<=ke;wt++)_.addNextSegment(he[wt],!0)}_.addLastSegment(),_.closeRing()},Ji.prototype.computeRingBufferCurve=function(l,h,_){var w=this.simplifyTolerance(this._distance);h===cn.RIGHT&&(w=-w);var I=us.simplify(l,w),U=I.length-1;_.initSideSegments(I[U-1],I[0],h);for(var q=1;q<=U;q++)_.addNextSegment(I[q],1!==q);_.closeRing()},Ji.prototype.computeLineBufferCurve=function(l,h){var _=this.simplifyTolerance(this._distance),w=us.simplify(l,_),I=w.length-1;h.initSideSegments(w[0],w[1],cn.LEFT);for(var U=2;U<=I;U++)h.addNextSegment(w[U],!0);h.addLastSegment(),h.addLineEndCap(w[I-1],w[I]);var q=us.simplify(l,-_),he=q.length-1;h.initSideSegments(q[he],q[he-1],cn.LEFT);for(var ke=he-2;ke>=0;ke--)h.addNextSegment(q[ke],!0);h.addLastSegment(),h.addLineEndCap(q[1],q[0]),h.closeRing()},Ji.prototype.computePointCurve=function(l,h){switch(this._bufParams.getEndCapStyle()){case ki.CAP_ROUND:h.createCircle(l);break;case ki.CAP_SQUARE:h.createSquare(l)}},Ji.prototype.getLineCurve=function(l,h){if(this._distance=h,h<0&&!this._bufParams.isSingleSided()||0===h)return null;var _=Math.abs(h),w=this.getSegGen(_);return l.length<=1?this.computePointCurve(l[0],w):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(l,h<0,w):this.computeLineBufferCurve(l,w),w.getCoordinates()},Ji.prototype.getBufferParameters=function(){return this._bufParams},Ji.prototype.simplifyTolerance=function(l){return l*this._bufParams.getSimplifyFactor()},Ji.prototype.getRingCurve=function(l,h,_){if(this._distance=_,l.length<=2)return this.getLineCurve(l,_);if(0===_)return Ji.copyCoordinates(l);var w=this.getSegGen(_);return this.computeRingBufferCurve(l,h,w),w.getCoordinates()},Ji.prototype.computeOffsetCurve=function(l,h,_){var w=this.simplifyTolerance(this._distance);if(h){var I=us.simplify(l,-w),U=I.length-1;_.initSideSegments(I[U],I[U-1],cn.LEFT),_.addFirstSegment();for(var q=U-2;q>=0;q--)_.addNextSegment(I[q],!0)}else{var he=us.simplify(l,w),ke=he.length-1;_.initSideSegments(he[0],he[1],cn.LEFT),_.addFirstSegment();for(var wt=2;wt<=ke;wt++)_.addNextSegment(he[wt],!0)}_.addLastSegment()},Ji.prototype.getSegGen=function(l){return new er(this._precisionModel,this._bufParams,l)},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji},Ji.copyCoordinates=function(l){for(var h=new Array(l.length).fill(null),_=0;_<h.length;_++)h[_]=new ne(l[_]);return h};var wa=function(){this._subgraphs=null,this._seg=new wr,this._cga=new un,this._subgraphs=arguments[0]},lr={DepthSegment:{configurable:!0}};wa.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var l=arguments[0],h=new Tn,_=this._subgraphs.iterator();_.hasNext();){var w=_.next(),I=w.getEnvelope();l.y<I.getMinY()||l.y>I.getMaxY()||this.findStabbedSegments(l,w.getDirectedEdges(),h)}return h}if(3===arguments.length)if(Bt(arguments[2],Ls)&&arguments[0]instanceof ne&&arguments[1]instanceof ha){for(var U=arguments[0],q=arguments[1],he=arguments[2],ke=q.getEdge().getCoordinates(),wt=0;wt<ke.length-1;wt++)if(this._seg.p0=ke[wt],this._seg.p1=ke[wt+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<U.x||this._seg.isHorizontal()||U.y<this._seg.p0.y||U.y>this._seg.p1.y||un.computeOrientation(this._seg.p0,this._seg.p1,U)===un.RIGHT)){var vt=q.getDepth(cn.LEFT);this._seg.p0.equals(ke[wt])||(vt=q.getDepth(cn.RIGHT));var on=new Yr(this._seg,vt);he.add(on)}}else if(Bt(arguments[2],Ls)&&arguments[0]instanceof ne&&Bt(arguments[1],Ls))for(var Gn=arguments[0],hr=arguments[2],Lr=arguments[1].iterator();Lr.hasNext();){var to=Lr.next();to.isForward()&&this.findStabbedSegments(Gn,to,hr)}},wa.prototype.getDepth=function(l){var h=this.findStabbedSegments(l);return 0===h.size()?0:Da.min(h)._leftDepth},wa.prototype.interfaces_=function(){return[]},wa.prototype.getClass=function(){return wa},lr.DepthSegment.get=function(){return Yr},Object.defineProperties(wa,lr);var Yr=function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[1];this._upwardSeg=new wr(arguments[0]),this._leftDepth=h};Yr.prototype.compareTo=function(l){var h=l;if(this._upwardSeg.minX()>=h._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=h._upwardSeg.minX())return-1;var _=this._upwardSeg.orientationIndex(h._upwardSeg);return 0!==_||0!=(_=-1*h._upwardSeg.orientationIndex(this._upwardSeg))?_:this._upwardSeg.compareTo(h._upwardSeg)},Yr.prototype.compareX=function(l,h){var _=l.p0.compareTo(h.p0);return 0!==_?_:l.p1.compareTo(h.p1)},Yr.prototype.toString=function(){return this._upwardSeg.toString()},Yr.prototype.interfaces_=function(){return[oe]},Yr.prototype.getClass=function(){return Yr};var Or=function(l,h,_){this.p0=l||null,this.p1=h||null,this.p2=_||null};Or.prototype.area=function(){return Or.area(this.p0,this.p1,this.p2)},Or.prototype.signedArea=function(){return Or.signedArea(this.p0,this.p1,this.p2)},Or.prototype.interpolateZ=function(l){if(null===l)throw new Q("Supplied point is null.");return Or.interpolateZ(l,this.p0,this.p1,this.p2)},Or.prototype.longestSideLength=function(){return Or.longestSideLength(this.p0,this.p1,this.p2)},Or.prototype.isAcute=function(){return Or.isAcute(this.p0,this.p1,this.p2)},Or.prototype.circumcentre=function(){return Or.circumcentre(this.p0,this.p1,this.p2)},Or.prototype.area3D=function(){return Or.area3D(this.p0,this.p1,this.p2)},Or.prototype.centroid=function(){return Or.centroid(this.p0,this.p1,this.p2)},Or.prototype.inCentre=function(){return Or.inCentre(this.p0,this.p1,this.p2)},Or.prototype.interfaces_=function(){return[]},Or.prototype.getClass=function(){return Or},Or.area=function(l,h,_){return Math.abs(((_.x-l.x)*(h.y-l.y)-(h.x-l.x)*(_.y-l.y))/2)},Or.signedArea=function(l,h,_){return((_.x-l.x)*(h.y-l.y)-(h.x-l.x)*(_.y-l.y))/2},Or.det=function(l,h,_,w){return l*w-h*_},Or.interpolateZ=function(l,h,_,w){var I=h.x,U=h.y,q=_.x-I,he=w.x-I,ke=_.y-U,wt=w.y-U,vt=q*wt-he*ke,on=l.x-I,Gn=l.y-U;return h.z+(wt*on-he*Gn)/vt*(_.z-h.z)+(-ke*on+q*Gn)/vt*(w.z-h.z)},Or.longestSideLength=function(l,h,_){var w=l.distance(h),I=h.distance(_),U=_.distance(l),q=w;return I>q&&(q=I),U>q&&(q=U),q},Or.isAcute=function(l,h,_){return!!ur.isAcute(l,h,_)&&!!ur.isAcute(h,_,l)&&!!ur.isAcute(_,l,h)},Or.circumcentre=function(l,h,_){var w=_.x,I=_.y,U=l.x-w,q=l.y-I,he=h.x-w,ke=h.y-I,wt=2*Or.det(U,q,he,ke),vt=Or.det(q,U*U+q*q,ke,he*he+ke*ke),on=Or.det(U,U*U+q*q,he,he*he+ke*ke);return new ne(w-vt/wt,I+on/wt)},Or.perpendicularBisector=function(l,h){var _=h.x-l.x,w=h.y-l.y,I=new Un(l.x+_/2,l.y+w/2,1),U=new Un(l.x-w+_/2,l.y+_+w/2,1);return new Un(I,U)},Or.angleBisector=function(l,h,_){var w=h.distance(l),I=w/(w+h.distance(_));return new ne(l.x+I*(_.x-l.x),l.y+I*(_.y-l.y))},Or.area3D=function(l,h,_){var w=h.x-l.x,I=h.y-l.y,U=h.z-l.z,q=_.x-l.x,he=_.y-l.y,ke=_.z-l.z,wt=I*ke-U*he,vt=U*q-w*ke,on=w*he-I*q;return Math.sqrt(wt*wt+vt*vt+on*on)/2},Or.centroid=function(l,h,_){return new ne((l.x+h.x+_.x)/3,(l.y+h.y+_.y)/3)},Or.inCentre=function(l,h,_){var w=h.distance(_),I=l.distance(_),U=l.distance(h),q=w+I+U;return new ne((w*l.x+I*h.x+U*_.x)/q,(w*l.y+I*h.y+U*_.y)/q)};var ys=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Tn;var h=arguments[1],_=arguments[2];this._inputGeom=arguments[0],this._distance=h,this._curveBuilder=_};ys.prototype.addPoint=function(l){if(this._distance<=0)return null;var h=l.getCoordinates(),_=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(_,Se.EXTERIOR,Se.INTERIOR)},ys.prototype.addPolygon=function(l){var h=this._distance,_=cn.LEFT;this._distance<0&&(h=-this._distance,_=cn.RIGHT);var w=l.getExteriorRing(),I=Fr.removeRepeatedPoints(w.getCoordinates());if(this._distance<0&&this.isErodedCompletely(w,this._distance)||this._distance<=0&&I.length<3)return null;this.addPolygonRing(I,h,_,Se.EXTERIOR,Se.INTERIOR);for(var U=0;U<l.getNumInteriorRing();U++){var q=l.getInteriorRingN(U),he=Fr.removeRepeatedPoints(q.getCoordinates());this._distance>0&&this.isErodedCompletely(q,-this._distance)||this.addPolygonRing(he,h,cn.opposite(_),Se.INTERIOR,Se.EXTERIOR)}},ys.prototype.isTriangleErodedCompletely=function(l,h){var _=new Or(l[0],l[1],l[2]),w=_.inCentre();return un.distancePointLine(w,_.p0,_.p1)<Math.abs(h)},ys.prototype.addLineString=function(l){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var h=Fr.removeRepeatedPoints(l.getCoordinates()),_=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(_,Se.EXTERIOR,Se.INTERIOR)},ys.prototype.addCurve=function(l,h,_){if(null===l||l.length<2)return null;var w=new go(l,new Jr(0,Se.BOUNDARY,h,_));this._curveList.add(w)},ys.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},ys.prototype.addPolygonRing=function(l,h,_,w,I){if(0===h&&l.length<ca.MINIMUM_VALID_SIZE)return null;var U=w,q=I;l.length>=ca.MINIMUM_VALID_SIZE&&un.isCCW(l)&&(U=I,q=w,_=cn.opposite(_));var he=this._curveBuilder.getRingCurve(l,_,h);this.addCurve(he,U,q)},ys.prototype.add=function(l){if(l.isEmpty())return null;l instanceof Xi?this.addPolygon(l):l instanceof nr?this.addLineString(l):l instanceof Zr?this.addPoint(l):(l instanceof Yt||l instanceof yr||l instanceof so||l instanceof mn)&&this.addCollection(l)},ys.prototype.isErodedCompletely=function(l,h){var _=l.getCoordinates();if(_.length<4)return h<0;if(4===_.length)return this.isTriangleErodedCompletely(_,h);var w=l.getEnvelopeInternal(),I=Math.min(w.getHeight(),w.getWidth());return h<0&&2*Math.abs(h)>I},ys.prototype.addCollection=function(l){for(var h=0;h<l.getNumGeometries();h++){var _=l.getGeometryN(h);this.add(_)}},ys.prototype.interfaces_=function(){return[]},ys.prototype.getClass=function(){return ys};var Wl=function(){};Wl.prototype.locate=function(l){},Wl.prototype.interfaces_=function(){return[]},Wl.prototype.getClass=function(){return Wl};var Co=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var l=arguments[0];this._parent=l,this._atStart=!0,this._index=0,this._max=l.getNumGeometries()};Co.prototype.next=function(){if(this._atStart)return this._atStart=!1,Co.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ce;var l=this._parent.getGeometryN(this._index++);return l instanceof mn?(this._subcollectionIterator=new Co(l),this._subcollectionIterator.next()):l},Co.prototype.remove=function(){throw new Error(this.getClass().getName())},Co.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Co.prototype.interfaces_=function(){return[ra]},Co.prototype.getClass=function(){return Co},Co.isAtomic=function(l){return!(l instanceof mn)};var zs=function(){this._geom=null,this._geom=arguments[0]};zs.prototype.locate=function(l){return zs.locate(l,this._geom)},zs.prototype.interfaces_=function(){return[Wl]},zs.prototype.getClass=function(){return zs},zs.isPointInRing=function(l,h){return!!h.getEnvelopeInternal().intersects(l)&&un.isPointInRing(l,h.getCoordinates())},zs.containsPointInPolygon=function(l,h){if(h.isEmpty())return!1;var _=h.getExteriorRing();if(!zs.isPointInRing(l,_))return!1;for(var w=0;w<h.getNumInteriorRing();w++){var I=h.getInteriorRingN(w);if(zs.isPointInRing(l,I))return!1}return!0},zs.containsPoint=function(l,h){if(h instanceof Xi)return zs.containsPointInPolygon(l,h);if(h instanceof mn)for(var _=new Co(h);_.hasNext();){var w=_.next();if(w!==h&&zs.containsPoint(l,w))return!0}return!1},zs.locate=function(l,h){return h.isEmpty()?Se.EXTERIOR:zs.containsPoint(l,h)?Se.INTERIOR:Se.EXTERIOR};var Si=function(){this._edgeMap=new nt,this._edgeList=null,this._ptInAreaLocation=[Se.NONE,Se.NONE]};Si.prototype.getNextCW=function(l){this.getEdges();var h=this._edgeList.indexOf(l),_=h-1;return 0===h&&(_=this._edgeList.size()-1),this._edgeList.get(_)},Si.prototype.propagateSideLabels=function(l){for(var h=Se.NONE,_=this.iterator();_.hasNext();){var w=_.next().getLabel();w.isArea(l)&&w.getLocation(l,cn.LEFT)!==Se.NONE&&(h=w.getLocation(l,cn.LEFT))}if(h===Se.NONE)return null;for(var I=h,U=this.iterator();U.hasNext();){var q=U.next(),he=q.getLabel();if(he.getLocation(l,cn.ON)===Se.NONE&&he.setLocation(l,cn.ON,I),he.isArea(l)){var ke=he.getLocation(l,cn.LEFT),wt=he.getLocation(l,cn.RIGHT);if(wt!==Se.NONE){if(wt!==I)throw new lo("side location conflict",q.getCoordinate());ke===Se.NONE&&Me.shouldNeverReachHere("found single null side (at "+q.getCoordinate()+")"),I=ke}else Me.isTrue(he.getLocation(l,cn.LEFT)===Se.NONE,"found single null side"),he.setLocation(l,cn.RIGHT,I),he.setLocation(l,cn.LEFT,I)}}},Si.prototype.getCoordinate=function(){var l=this.iterator();return l.hasNext()?l.next().getCoordinate():null},Si.prototype.print=function(l){pr.out.println("EdgeEndStar:   "+this.getCoordinate());for(var h=this.iterator();h.hasNext();)h.next().print(l)},Si.prototype.isAreaLabelsConsistent=function(l){return this.computeEdgeEndLabels(l.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Si.prototype.checkAreaLabelsConsistent=function(l){var h=this.getEdges();if(h.size()<=0)return!0;var _=h.size()-1,w=h.get(_).getLabel().getLocation(l,cn.LEFT);Me.isTrue(w!==Se.NONE,"Found unlabelled area edge");for(var I=w,U=this.iterator();U.hasNext();){var q=U.next().getLabel();Me.isTrue(q.isArea(l),"Found non-area edge");var he=q.getLocation(l,cn.LEFT),ke=q.getLocation(l,cn.RIGHT);if(he===ke||ke!==I)return!1;I=he}return!0},Si.prototype.findIndex=function(l){this.iterator();for(var h=0;h<this._edgeList.size();h++)if(this._edgeList.get(h)===l)return h;return-1},Si.prototype.iterator=function(){return this.getEdges().iterator()},Si.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Tn(this._edgeMap.values())),this._edgeList},Si.prototype.getLocation=function(l,h,_){return this._ptInAreaLocation[l]===Se.NONE&&(this._ptInAreaLocation[l]=zs.locate(h,_[l].getGeometry())),this._ptInAreaLocation[l]},Si.prototype.toString=function(){var l=new Xe;l.append("EdgeEndStar:   "+this.getCoordinate()),l.append("\n");for(var h=this.iterator();h.hasNext();){var _=h.next();l.append(_),l.append("\n")}return l.toString()},Si.prototype.computeEdgeEndLabels=function(l){for(var h=this.iterator();h.hasNext();)h.next().computeLabel(l)},Si.prototype.computeLabelling=function(l){this.computeEdgeEndLabels(l[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var h=[!1,!1],_=this.iterator();_.hasNext();)for(var w=_.next().getLabel(),I=0;I<2;I++)w.isLine(I)&&w.getLocation(I)===Se.BOUNDARY&&(h[I]=!0);for(var U=this.iterator();U.hasNext();)for(var q=U.next(),he=q.getLabel(),ke=0;ke<2;ke++)if(he.isAnyNull(ke)){var wt=Se.NONE;if(h[ke])wt=Se.EXTERIOR;else{var vt=q.getCoordinate();wt=this.getLocation(ke,vt,l)}he.setAllLocationsIfNull(ke,wt)}},Si.prototype.getDegree=function(){return this._edgeMap.size()},Si.prototype.insertEdgeEnd=function(l,h){this._edgeMap.put(l,h),this._edgeList=null},Si.prototype.interfaces_=function(){return[]},Si.prototype.getClass=function(){return Si};var lu=function(l){function h(){l.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var _=null,w=null,I=this._SCANNING_FOR_INCOMING,U=0;U<this._resultAreaEdgeList.size();U++){var q=this._resultAreaEdgeList.get(U),he=q.getSym();if(q.getLabel().isArea())switch(null===_&&q.isInResult()&&(_=q),I){case this._SCANNING_FOR_INCOMING:if(!he.isInResult())continue;w=he,I=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!q.isInResult())continue;w.setNext(q),I=this._SCANNING_FOR_INCOMING}}if(I===this._LINKING_TO_OUTGOING){if(null===_)throw new lo("no outgoing dirEdge found",this.getCoordinate());Me.isTrue(_.isInResult(),"unable to link last incoming dirEdge"),w.setNext(_)}},h.prototype.insert=function(_){this.insertEdgeEnd(_,_)},h.prototype.getRightmostEdge=function(){var _=this.getEdges(),w=_.size();if(w<1)return null;var I=_.get(0);if(1===w)return I;var U=_.get(w-1),q=I.getQuadrant(),he=U.getQuadrant();return Ci.isNorthern(q)&&Ci.isNorthern(he)?I:Ci.isNorthern(q)||Ci.isNorthern(he)?0!==I.getDy()?I:0!==U.getDy()?U:(Me.shouldNeverReachHere("found two horizontal edges incident on node"),null):U},h.prototype.print=function(_){pr.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var w=this.iterator();w.hasNext();){var I=w.next();_.print("out "),I.print(_),_.println(),_.print("in "),I.getSym().print(_),_.println()}},h.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Tn;for(var _=this.iterator();_.hasNext();){var w=_.next();(w.isInResult()||w.getSym().isInResult())&&this._resultAreaEdgeList.add(w)}return this._resultAreaEdgeList},h.prototype.updateLabelling=function(_){for(var w=this.iterator();w.hasNext();){var I=w.next().getLabel();I.setAllLocationsIfNull(0,_.getLocation(0)),I.setAllLocationsIfNull(1,_.getLocation(1))}},h.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var _=null,w=null,I=this._edgeList.size()-1;I>=0;I--){var U=this._edgeList.get(I),q=U.getSym();null===w&&(w=q),null!==_&&q.setNext(_),_=U}w.setNext(_)},h.prototype.computeDepths=function(){if(1===arguments.length){var _=arguments[0],w=this.findIndex(_),I=_.getDepth(cn.LEFT),U=_.getDepth(cn.RIGHT),q=this.computeDepths(w+1,this._edgeList.size(),I);if(this.computeDepths(0,w,q)!==U)throw new lo("depth mismatch at "+_.getCoordinate())}else if(3===arguments.length){for(var ke=arguments[1],wt=arguments[2],vt=arguments[0];vt<ke;vt++){var on=this._edgeList.get(vt);on.setEdgeDepths(cn.RIGHT,wt),wt=on.getDepth(cn.LEFT)}return wt}},h.prototype.mergeSymLabels=function(){for(var _=this.iterator();_.hasNext();){var w=_.next();w.getLabel().merge(w.getSym().getLabel())}},h.prototype.linkMinimalDirectedEdges=function(_){for(var w=null,I=null,U=this._SCANNING_FOR_INCOMING,q=this._resultAreaEdgeList.size()-1;q>=0;q--){var he=this._resultAreaEdgeList.get(q),ke=he.getSym();switch(null===w&&he.getEdgeRing()===_&&(w=he),U){case this._SCANNING_FOR_INCOMING:if(ke.getEdgeRing()!==_)continue;I=ke,U=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(he.getEdgeRing()!==_)continue;I.setNextMin(he),U=this._SCANNING_FOR_INCOMING}}U===this._LINKING_TO_OUTGOING&&(Me.isTrue(null!==w,"found null for first outgoing dirEdge"),Me.isTrue(w.getEdgeRing()===_,"unable to link last incoming dirEdge"),I.setNextMin(w))},h.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var _=0,w=this.iterator();w.hasNext();)w.next().isInResult()&&_++;return _}if(1===arguments.length){for(var I=arguments[0],U=0,q=this.iterator();q.hasNext();)q.next().getEdgeRing()===I&&U++;return U}},h.prototype.getLabel=function(){return this._label},h.prototype.findCoveredLineEdges=function(){for(var _=Se.NONE,w=this.iterator();w.hasNext();){var I=w.next(),U=I.getSym();if(!I.isLineEdge()){if(I.isInResult()){_=Se.INTERIOR;break}if(U.isInResult()){_=Se.EXTERIOR;break}}}if(_===Se.NONE)return null;for(var q=_,he=this.iterator();he.hasNext();){var ke=he.next(),wt=ke.getSym();ke.isLineEdge()?ke.getEdge().setCovered(q===Se.INTERIOR):(ke.isInResult()&&(q=Se.EXTERIOR),wt.isInResult()&&(q=Se.INTERIOR))}},h.prototype.computeLabelling=function(_){l.prototype.computeLabelling.call(this,_),this._label=new Jr(Se.NONE);for(var w=this.iterator();w.hasNext();)for(var I=w.next().getEdge().getLabel(),U=0;U<2;U++){var q=I.getLocation(U);q!==Se.INTERIOR&&q!==Se.BOUNDARY||this._label.setLocation(U,Se.INTERIOR)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Si),Xl=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.createNode=function(_){return new ec(_,new lu)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}($l),oi=function l(){this._pts=null,this._orientation=null;var h=arguments[0];this._pts=h,this._orientation=l.orientation(h)};oi.prototype.compareTo=function(l){return oi.compareOriented(this._pts,this._orientation,l._pts,l._orientation)},oi.prototype.interfaces_=function(){return[oe]},oi.prototype.getClass=function(){return oi},oi.orientation=function(l){return 1===Fr.increasingDirection(l)},oi.compareOriented=function(l,h,_,w){for(var I=h?1:-1,U=w?1:-1,q=h?l.length:-1,he=w?_.length:-1,ke=h?0:l.length-1,wt=w?0:_.length-1;;){var vt=l[ke].compareTo(_[wt]);if(0!==vt)return vt;var on=(ke+=I)===q,Gn=(wt+=U)===he;if(on&&!Gn)return-1;if(!on&&Gn)return 1;if(on&&Gn)return 0}};var Zs=function(){this._edges=new Tn,this._ocaMap=new nt};Zs.prototype.print=function(l){l.print("MULTILINESTRING ( ");for(var h=0;h<this._edges.size();h++){var _=this._edges.get(h);h>0&&l.print(","),l.print("(");for(var w=_.getCoordinates(),I=0;I<w.length;I++)I>0&&l.print(","),l.print(w[I].x+" "+w[I].y);l.println(")")}l.print(")  ")},Zs.prototype.addAll=function(l){for(var h=l.iterator();h.hasNext();)this.add(h.next())},Zs.prototype.findEdgeIndex=function(l){for(var h=0;h<this._edges.size();h++)if(this._edges.get(h).equals(l))return h;return-1},Zs.prototype.iterator=function(){return this._edges.iterator()},Zs.prototype.getEdges=function(){return this._edges},Zs.prototype.get=function(l){return this._edges.get(l)},Zs.prototype.findEqualEdge=function(l){var h=new oi(l.getCoordinates());return this._ocaMap.get(h)},Zs.prototype.add=function(l){this._edges.add(l);var h=new oi(l.getCoordinates());this._ocaMap.put(h,l)},Zs.prototype.interfaces_=function(){return[]},Zs.prototype.getClass=function(){return Zs};var $a=function(){};$a.prototype.processIntersections=function(l,h,_,w){},$a.prototype.isDone=function(){},$a.prototype.interfaces_=function(){return[]},$a.prototype.getClass=function(){return $a};var Cs=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};Cs.prototype.isTrivialIntersection=function(l,h,_,w){if(l===_&&1===this._li.getIntersectionNum()){if(Cs.isAdjacentSegments(h,w))return!0;if(l.isClosed()){var I=l.size()-1;if(0===h&&w===I||0===w&&h===I)return!0}}return!1},Cs.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Cs.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Cs.prototype.getLineIntersector=function(){return this._li},Cs.prototype.hasProperIntersection=function(){return this._hasProper},Cs.prototype.processIntersections=function(l,h,_,w){if(l===_&&h===w)return null;this.numTests++;var I=l.getCoordinates()[h],U=l.getCoordinates()[h+1],q=_.getCoordinates()[w],he=_.getCoordinates()[w+1];this._li.computeIntersection(I,U,q,he),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(l,h,_,w)||(this._hasIntersection=!0,l.addIntersections(this._li,h,0),_.addIntersections(this._li,w,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Cs.prototype.hasIntersection=function(){return this._hasIntersection},Cs.prototype.isDone=function(){return!1},Cs.prototype.hasInteriorIntersection=function(){return this._hasInterior},Cs.prototype.interfaces_=function(){return[$a]},Cs.prototype.getClass=function(){return Cs},Cs.isAdjacentSegments=function(l,h){return 1===Math.abs(l-h)};var da=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[1],_=arguments[2];this.coord=new ne(arguments[0]),this.segmentIndex=h,this.dist=_};da.prototype.getSegmentIndex=function(){return this.segmentIndex},da.prototype.getCoordinate=function(){return this.coord},da.prototype.print=function(l){l.print(this.coord),l.print(" seg # = "+this.segmentIndex),l.println(" dist = "+this.dist)},da.prototype.compareTo=function(l){return this.compare(l.segmentIndex,l.dist)},da.prototype.isEndPoint=function(l){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===l},da.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},da.prototype.getDistance=function(){return this.dist},da.prototype.compare=function(l,h){return this.segmentIndex<l?-1:this.segmentIndex>l?1:this.dist<h?-1:this.dist>h?1:0},da.prototype.interfaces_=function(){return[oe]},da.prototype.getClass=function(){return da};var ts=function(){this._nodeMap=new nt,this.edge=null,this.edge=arguments[0]};ts.prototype.print=function(l){l.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(l)},ts.prototype.iterator=function(){return this._nodeMap.values().iterator()},ts.prototype.addSplitEdges=function(l){this.addEndpoints();for(var h=this.iterator(),_=h.next();h.hasNext();){var w=h.next(),I=this.createSplitEdge(_,w);l.add(I),_=w}},ts.prototype.addEndpoints=function(){var l=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[l],l,0)},ts.prototype.createSplitEdge=function(l,h){var _=h.segmentIndex-l.segmentIndex+2,I=h.dist>0||!h.coord.equals2D(this.edge.pts[h.segmentIndex]);I||_--;var U=new Array(_).fill(null),q=0;U[q++]=new ne(l.coord);for(var he=l.segmentIndex+1;he<=h.segmentIndex;he++)U[q++]=this.edge.pts[he];return I&&(U[q]=h.coord),new Ru(U,new Jr(this.edge._label))},ts.prototype.add=function(l,h,_){var w=new da(l,h,_),I=this._nodeMap.get(w);return null!==I?I:(this._nodeMap.put(w,w),w)},ts.prototype.isIntersection=function(l){for(var h=this.iterator();h.hasNext();)if(h.next().coord.equals(l))return!0;return!1},ts.prototype.interfaces_=function(){return[]},ts.prototype.getClass=function(){return ts};var qa=function(){};qa.prototype.getChainStartIndices=function(l){var h=0,_=new Tn;_.add(new gt(h));do{var w=this.findChainEnd(l,h);_.add(new gt(w)),h=w}while(h<l.length-1);return qa.toIntArray(_)},qa.prototype.findChainEnd=function(l,h){for(var _=Ci.quadrant(l[h],l[h+1]),w=h+1;w<l.length&&Ci.quadrant(l[w-1],l[w])===_;)w++;return w-1},qa.prototype.interfaces_=function(){return[]},qa.prototype.getClass=function(){return qa},qa.toIntArray=function(l){for(var h=new Array(l.size()).fill(null),_=0;_<h.length;_++)h[_]=l.get(_).intValue();return h};var Ds=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Rn,this.env2=new Rn;var l=arguments[0];this.e=l,this.pts=l.getCoordinates();var h=new qa;this.startIndex=h.getChainStartIndices(this.pts)};Ds.prototype.getCoordinates=function(){return this.pts},Ds.prototype.getMaxX=function(l){var h=this.pts[this.startIndex[l]].x,_=this.pts[this.startIndex[l+1]].x;return h>_?h:_},Ds.prototype.getMinX=function(l){var h=this.pts[this.startIndex[l]].x,_=this.pts[this.startIndex[l+1]].x;return h<_?h:_},Ds.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var l=arguments[0],h=arguments[1],_=arguments[2];this.computeIntersectsForChain(this.startIndex[l],this.startIndex[l+1],h,h.startIndex[_],h.startIndex[_+1],arguments[3])}else if(6===arguments.length){var I=arguments[0],U=arguments[1],q=arguments[2],he=arguments[3],ke=arguments[4],wt=arguments[5],vt=this.pts[I],on=this.pts[U],Gn=q.pts[he],qn=q.pts[ke];if(U-I==1&&ke-he==1)return wt.addIntersections(this.e,I,q.e,he),null;if(this.env1.init(vt,on),this.env2.init(Gn,qn),!this.env1.intersects(this.env2))return null;var hr=Math.trunc((I+U)/2),Lr=Math.trunc((he+ke)/2);I<hr&&(he<Lr&&this.computeIntersectsForChain(I,hr,q,he,Lr,wt),Lr<ke&&this.computeIntersectsForChain(I,hr,q,Lr,ke,wt)),hr<U&&(he<Lr&&this.computeIntersectsForChain(hr,U,q,he,Lr,wt),Lr<ke&&this.computeIntersectsForChain(hr,U,q,Lr,ke,wt))}},Ds.prototype.getStartIndexes=function(){return this.startIndex},Ds.prototype.computeIntersects=function(l,h){for(var _=0;_<this.startIndex.length-1;_++)for(var w=0;w<l.startIndex.length-1;w++)this.computeIntersectsForChain(_,l,w,h)},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds};var co=function l(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var h=0;h<2;h++)for(var _=0;_<3;_++)this._depth[h][_]=l.NULL_VALUE},Pu={NULL_VALUE:{configurable:!0}};co.prototype.getDepth=function(l,h){return this._depth[l][h]},co.prototype.setDepth=function(l,h,_){this._depth[l][h]=_},co.prototype.isNull=function(){if(0===arguments.length){for(var l=0;l<2;l++)for(var h=0;h<3;h++)if(this._depth[l][h]!==co.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===co.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===co.NULL_VALUE:void 0},co.prototype.normalize=function(){for(var l=0;l<2;l++)if(!this.isNull(l)){var h=this._depth[l][1];this._depth[l][2]<h&&(h=this._depth[l][2]),h<0&&(h=0);for(var _=1;_<3;_++){var w=0;this._depth[l][_]>h&&(w=1),this._depth[l][_]=w}}},co.prototype.getDelta=function(l){return this._depth[l][cn.RIGHT]-this._depth[l][cn.LEFT]},co.prototype.getLocation=function(l,h){return this._depth[l][h]<=0?Se.EXTERIOR:Se.INTERIOR},co.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},co.prototype.add=function(){if(1===arguments.length)for(var l=arguments[0],h=0;h<2;h++)for(var _=1;_<3;_++){var w=l.getLocation(h,_);w!==Se.EXTERIOR&&w!==Se.INTERIOR||(this.isNull(h,_)?this._depth[h][_]=co.depthAtLocation(w):this._depth[h][_]+=co.depthAtLocation(w))}else 3===arguments.length&&arguments[2]===Se.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},co.prototype.interfaces_=function(){return[]},co.prototype.getClass=function(){return co},co.depthAtLocation=function(l){return l===Se.EXTERIOR?0:l===Se.INTERIOR?1:co.NULL_VALUE},Pu.NULL_VALUE.get=function(){return-1},Object.defineProperties(co,Pu);var Ru=function(l){function h(){if(l.call(this),this.pts=null,this._env=null,this.eiList=new ts(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new co,this._depthDelta=0,1===arguments.length)h.call(this,arguments[0],null);else if(2===arguments.length){var I=arguments[1];this.pts=arguments[0],this._label=I}}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDepth=function(){return this._depth},h.prototype.getCollapsedEdge=function(){var _=new Array(2).fill(null);return _[0]=this.pts[0],_[1]=this.pts[1],new h(_,Jr.toLineLabel(this._label))},h.prototype.isIsolated=function(){return this._isIsolated},h.prototype.getCoordinates=function(){return this.pts},h.prototype.setIsolated=function(_){this._isIsolated=_},h.prototype.setName=function(_){this._name=_},h.prototype.equals=function(_){if(!(_ instanceof h))return!1;var w=_;if(this.pts.length!==w.pts.length)return!1;for(var I=!0,U=!0,q=this.pts.length,he=0;he<this.pts.length;he++)if(this.pts[he].equals2D(w.pts[he])||(I=!1),this.pts[he].equals2D(w.pts[--q])||(U=!1),!I&&!U)return!1;return!0},h.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},h.prototype.print=function(_){_.print("edge "+this._name+": "),_.print("LINESTRING (");for(var w=0;w<this.pts.length;w++)w>0&&_.print(","),_.print(this.pts[w].x+" "+this.pts[w].y);_.print(")  "+this._label+" "+this._depthDelta)},h.prototype.computeIM=function(_){h.updateIM(this._label,_)},h.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},h.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},h.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},h.prototype.getDepthDelta=function(){return this._depthDelta},h.prototype.getNumPoints=function(){return this.pts.length},h.prototype.printReverse=function(_){_.print("edge "+this._name+": ");for(var w=this.pts.length-1;w>=0;w--)_.print(this.pts[w]+" ");_.println("")},h.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Ds(this)),this._mce},h.prototype.getEnvelope=function(){if(null===this._env){this._env=new Rn;for(var _=0;_<this.pts.length;_++)this._env.expandToInclude(this.pts[_])}return this._env},h.prototype.addIntersection=function(_,w,I,U){var q=new ne(_.getIntersection(U)),he=w,ke=_.getEdgeDistance(I,U),wt=he+1;wt<this.pts.length&&q.equals2D(this.pts[wt])&&(he=wt,ke=0),this.eiList.add(q,he,ke)},h.prototype.toString=function(){var _=new Xe;_.append("edge "+this._name+": "),_.append("LINESTRING (");for(var w=0;w<this.pts.length;w++)w>0&&_.append(","),_.append(this.pts[w].x+" "+this.pts[w].y);return _.append(")  "+this._label+" "+this._depthDelta),_.toString()},h.prototype.isPointwiseEqual=function(_){if(this.pts.length!==_.pts.length)return!1;for(var w=0;w<this.pts.length;w++)if(!this.pts[w].equals2D(_.pts[w]))return!1;return!0},h.prototype.setDepthDelta=function(_){this._depthDelta=_},h.prototype.getEdgeIntersectionList=function(){return this.eiList},h.prototype.addIntersections=function(_,w,I){for(var U=0;U<_.getIntersectionNum();U++)this.addIntersection(_,w,I,U)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.updateIM=function(){if(2!==arguments.length)return l.prototype.updateIM.apply(this,arguments);var _=arguments[0],w=arguments[1];w.setAtLeastIfValid(_.getLocation(0,cn.ON),_.getLocation(1,cn.ON),1),_.isArea()&&(w.setAtLeastIfValid(_.getLocation(0,cn.LEFT),_.getLocation(1,cn.LEFT),2),w.setAtLeastIfValid(_.getLocation(0,cn.RIGHT),_.getLocation(1,cn.RIGHT),2))},h}(ji),ui=function(l){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Zs,this._bufParams=l||null};ui.prototype.setWorkingPrecisionModel=function(l){this._workingPrecisionModel=l},ui.prototype.insertUniqueEdge=function(l){var h=this._edgeList.findEqualEdge(l);if(null!==h){var _=h.getLabel(),w=l.getLabel();h.isPointwiseEqual(l)||(w=new Jr(l.getLabel())).flip(),_.merge(w);var I=ui.depthDelta(w),U=h.getDepthDelta()+I;h.setDepthDelta(U)}else this._edgeList.add(l),l.setDepthDelta(ui.depthDelta(l.getLabel()))},ui.prototype.buildSubgraphs=function(l,h){for(var _=new Tn,w=l.iterator();w.hasNext();){var I=w.next(),U=I.getRightmostCoordinate(),q=new wa(_).getDepth(U);I.computeDepth(q),I.findResultEdges(),_.add(I),h.add(I.getDirectedEdges(),I.getNodes())}},ui.prototype.createSubgraphs=function(l){for(var h=new Tn,_=l.getNodes().iterator();_.hasNext();){var w=_.next();if(!w.isVisited()){var I=new $n;I.create(w),h.add(I)}}return Da.sort(h,Da.reverseOrder()),h},ui.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},ui.prototype.getNoder=function(l){if(null!==this._workingNoder)return this._workingNoder;var h=new au,_=new Jt;return _.setPrecisionModel(l),h.setSegmentIntersector(new Cs(_)),h},ui.prototype.buffer=function(l,h){var _=this._workingPrecisionModel;null===_&&(_=l.getPrecisionModel()),this._geomFact=l.getFactory();var w=new Ji(_,this._bufParams),I=new ys(l,h,w).getCurves();if(I.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(I,_),this._graph=new uo(new Xl),this._graph.addEdges(this._edgeList.getEdges());var U=this.createSubgraphs(this._graph),q=new Ns(this._geomFact);this.buildSubgraphs(U,q);var he=q.getPolygons();return he.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(he)},ui.prototype.computeNodedEdges=function(l,h){var _=this.getNoder(h);_.computeNodes(l);for(var w=_.getNodedSubstrings().iterator();w.hasNext();){var I=w.next(),U=I.getCoordinates();if(2!==U.length||!U[0].equals2D(U[1])){var q=I.getData(),he=new Ru(I.getCoordinates(),new Jr(q));this.insertUniqueEdge(he)}}},ui.prototype.setNoder=function(l){this._workingNoder=l},ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.depthDelta=function(l){var h=l.getLocation(0,cn.LEFT),_=l.getLocation(0,cn.RIGHT);return h===Se.INTERIOR&&_===Se.EXTERIOR?1:h===Se.EXTERIOR&&_===Se.INTERIOR?-1:0},ui.convertSegStrings=function(l){for(var h=new at,_=new Tn;l.hasNext();){var w=l.next(),I=h.createLineString(w.getCoordinates());_.add(I)}return h.buildGeometry(_)};var Tl=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var h=arguments[1];this._noder=arguments[0],this._scaleFactor=h,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var w=arguments[1],I=arguments[2],U=arguments[3];this._noder=arguments[0],this._scaleFactor=w,this._offsetX=I,this._offsetY=U,this._isScaled=!this.isIntegerPrecision()}};Tl.prototype.rescale=function(){if(Bt(arguments[0],Li))for(var l=arguments[0].iterator();l.hasNext();){var h=l.next();this.rescale(h.getCoordinates())}else if(arguments[0]instanceof Array){for(var _=arguments[0],w=0;w<_.length;w++)_[w].x=_[w].x/this._scaleFactor+this._offsetX,_[w].y=_[w].y/this._scaleFactor+this._offsetY;2===_.length&&_[0].equals2D(_[1])&&pr.out.println(_)}},Tl.prototype.scale=function(){if(Bt(arguments[0],Li)){for(var l=arguments[0],h=new Tn,_=l.iterator();_.hasNext();){var w=_.next();h.add(new go(this.scale(w.getCoordinates()),w.getData()))}return h}if(arguments[0]instanceof Array){for(var I=arguments[0],U=new Array(I.length).fill(null),q=0;q<I.length;q++)U[q]=new ne(Math.round((I[q].x-this._offsetX)*this._scaleFactor),Math.round((I[q].y-this._offsetY)*this._scaleFactor),I[q].z);return Fr.removeRepeatedPoints(U)}},Tl.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},Tl.prototype.getNodedSubstrings=function(){var l=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(l),l},Tl.prototype.computeNodes=function(l){var h=l;this._isScaled&&(h=this.scale(l)),this._noder.computeNodes(h)},Tl.prototype.interfaces_=function(){return[Hl]},Tl.prototype.getClass=function(){return Tl};var Zl=function(){this._li=new Jt,this._segStrings=null,this._segStrings=arguments[0]},Ft={fact:{configurable:!0}};Zl.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var l=this._segStrings.iterator();l.hasNext();){var h=l.next().getCoordinates();this.checkEndPtVertexIntersections(h[0],this._segStrings),this.checkEndPtVertexIntersections(h[h.length-1],this._segStrings)}else if(2===arguments.length)for(var _=arguments[0],w=arguments[1].iterator();w.hasNext();)for(var I=w.next().getCoordinates(),U=1;U<I.length-1;U++)if(I[U].equals(_))throw new Le("found endpt/interior pt intersection at index "+U+" :pt "+_)},Zl.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var l=this._segStrings.iterator();l.hasNext();)for(var h=l.next(),_=this._segStrings.iterator();_.hasNext();){var w=_.next();this.checkInteriorIntersections(h,w)}else if(2===arguments.length)for(var I=arguments[0],U=arguments[1],q=I.getCoordinates(),he=U.getCoordinates(),ke=0;ke<q.length-1;ke++)for(var wt=0;wt<he.length-1;wt++)this.checkInteriorIntersections(I,ke,U,wt);else if(4===arguments.length){var vt=arguments[0],on=arguments[1],Gn=arguments[2],qn=arguments[3];if(vt===Gn&&on===qn)return null;var hr=vt.getCoordinates()[on],Lr=vt.getCoordinates()[on+1],to=Gn.getCoordinates()[qn],Ps=Gn.getCoordinates()[qn+1];if(this._li.computeIntersection(hr,Lr,to,Ps),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,hr,Lr)||this.hasInteriorIntersection(this._li,to,Ps)))throw new Le("found non-noded intersection at "+hr+"-"+Lr+" and "+to+"-"+Ps)}},Zl.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},Zl.prototype.checkCollapses=function(){if(0===arguments.length)for(var l=this._segStrings.iterator();l.hasNext();){var h=l.next();this.checkCollapses(h)}else if(1===arguments.length)for(var _=arguments[0].getCoordinates(),w=0;w<_.length-2;w++)this.checkCollapse(_[w],_[w+1],_[w+2])},Zl.prototype.hasInteriorIntersection=function(l,h,_){for(var w=0;w<l.getIntersectionNum();w++){var I=l.getIntersection(w);if(!I.equals(h)&&!I.equals(_))return!0}return!1},Zl.prototype.checkCollapse=function(l,h,_){if(l.equals(_))throw new Le("found non-noded collapse at "+Zl.fact.createLineString([l,h,_]))},Zl.prototype.interfaces_=function(){return[]},Zl.prototype.getClass=function(){return Zl},Ft.fact.get=function(){return new at},Object.defineProperties(Zl,Ft);var rn=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var l=arguments[0],h=arguments[1],_=arguments[2];if(this._originalPt=l,this._pt=l,this._scaleFactor=h,this._li=_,h<=0)throw new Q("Scale factor must be non-zero");1!==h&&(this._pt=new ne(this.scale(l.x),this.scale(l.y)),this._p0Scaled=new ne,this._p1Scaled=new ne),this.initCorners(this._pt)},Hn={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};rn.prototype.intersectsScaled=function(l,h){var _=Math.min(l.x,h.x),w=Math.max(l.x,h.x),I=Math.min(l.y,h.y),U=Math.max(l.y,h.y),q=this._maxx<_||this._minx>w||this._maxy<I||this._miny>U;if(q)return!1;var he=this.intersectsToleranceSquare(l,h);return Me.isTrue(!(q&&he),"Found bad envelope test"),he},rn.prototype.initCorners=function(l){this._minx=l.x-.5,this._maxx=l.x+.5,this._miny=l.y-.5,this._maxy=l.y+.5,this._corner[0]=new ne(this._maxx,this._maxy),this._corner[1]=new ne(this._minx,this._maxy),this._corner[2]=new ne(this._minx,this._miny),this._corner[3]=new ne(this._maxx,this._miny)},rn.prototype.intersects=function(l,h){return 1===this._scaleFactor?this.intersectsScaled(l,h):(this.copyScaled(l,this._p0Scaled),this.copyScaled(h,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},rn.prototype.scale=function(l){return Math.round(l*this._scaleFactor)},rn.prototype.getCoordinate=function(){return this._originalPt},rn.prototype.copyScaled=function(l,h){h.x=this.scale(l.x),h.y=this.scale(l.y)},rn.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var l=rn.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Rn(this._originalPt.x-l,this._originalPt.x+l,this._originalPt.y-l,this._originalPt.y+l)}return this._safeEnv},rn.prototype.intersectsPixelClosure=function(l,h){return this._li.computeIntersection(l,h,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(l,h,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(l,h,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(l,h,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},rn.prototype.intersectsToleranceSquare=function(l,h){var _=!1,w=!1;return this._li.computeIntersection(l,h,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(l,h,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(_=!0),this._li.computeIntersection(l,h,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(w=!0),this._li.computeIntersection(l,h,this._corner[3],this._corner[0]),this._li.isProper()||_&&w||l.equals(this._pt)||h.equals(this._pt)))))},rn.prototype.addSnappedNode=function(l,h){var _=l.getCoordinate(h),w=l.getCoordinate(h+1);return!!this.intersects(_,w)&&(l.addIntersection(this.getCoordinate(),h),!0)},rn.prototype.interfaces_=function(){return[]},rn.prototype.getClass=function(){return rn},Hn.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(rn,Hn);var Ar=function(){this.tempEnv1=new Rn,this.selectedSegment=new wr};Ar.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},Ar.prototype.interfaces_=function(){return[]},Ar.prototype.getClass=function(){return Ar};var Yi=function(){this._index=null,this._index=arguments[0]},ei={HotPixelSnapAction:{configurable:!0}};Yi.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var h=arguments[0],_=arguments[1],w=arguments[2],I=h.getSafeEnvelope(),U=new ks(h,_,w);return this._index.query(I,{interfaces_:function(){return[Cl]},visitItem:function(q){q.select(I,U)}}),U.isNodeAdded()}},Yi.prototype.interfaces_=function(){return[]},Yi.prototype.getClass=function(){return Yi},ei.HotPixelSnapAction.get=function(){return ks},Object.defineProperties(Yi,ei);var ks=function(l){function h(){l.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var w=arguments[1],I=arguments[2];this._hotPixel=arguments[0],this._parentEdge=w,this._hotPixelVertexIndex=I}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isNodeAdded=function(){return this._isNodeAdded},h.prototype.select=function(){if(2!==arguments.length)return l.prototype.select.apply(this,arguments);var w=arguments[1],I=arguments[0].getContext();if(null!==this._parentEdge&&I===this._parentEdge&&w===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(I,w)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ar),Gi=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new Tn};Gi.prototype.processIntersections=function(l,h,_,w){if(l===_&&h===w)return null;var I=l.getCoordinates()[h],U=l.getCoordinates()[h+1],q=_.getCoordinates()[w],he=_.getCoordinates()[w+1];if(this._li.computeIntersection(I,U,q,he),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var ke=0;ke<this._li.getIntersectionNum();ke++)this._interiorIntersections.add(this._li.getIntersection(ke));l.addIntersections(this._li,h,0),_.addIntersections(this._li,w,1)}},Gi.prototype.isDone=function(){return!1},Gi.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Gi.prototype.interfaces_=function(){return[$a]},Gi.prototype.getClass=function(){return Gi};var Qi=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var l=arguments[0];this._pm=l,this._li=new Jt,this._li.setPrecisionModel(l),this._scaleFactor=l.getScale()};Qi.prototype.checkCorrectness=function(l){var h=go.getNodedSubstrings(l),_=new Zl(h);try{_.checkValid()}catch(w){if(!(w instanceof Yn))throw w;w.printStackTrace()}},Qi.prototype.getNodedSubstrings=function(){return go.getNodedSubstrings(this._nodedSegStrings)},Qi.prototype.snapRound=function(l,h){var _=this.findInteriorIntersections(l,h);this.computeIntersectionSnaps(_),this.computeVertexSnaps(l)},Qi.prototype.findInteriorIntersections=function(l,h){var _=new Gi(h);return this._noder.setSegmentIntersector(_),this._noder.computeNodes(l),_.getInteriorIntersections()},Qi.prototype.computeVertexSnaps=function(){if(Bt(arguments[0],Li))for(var l=arguments[0].iterator();l.hasNext();){var h=l.next();this.computeVertexSnaps(h)}else if(arguments[0]instanceof go)for(var _=arguments[0],w=_.getCoordinates(),I=0;I<w.length;I++){var U=new rn(w[I],this._scaleFactor,this._li);this._pointSnapper.snap(U,_,I)&&_.addIntersection(w[I],I)}},Qi.prototype.computeNodes=function(l){this._nodedSegStrings=l,this._noder=new au,this._pointSnapper=new Yi(this._noder.getIndex()),this.snapRound(l,this._li)},Qi.prototype.computeIntersectionSnaps=function(l){for(var h=l.iterator();h.hasNext();){var _=h.next(),w=new rn(_,this._scaleFactor,this._li);this._pointSnapper.snap(w)}},Qi.prototype.interfaces_=function(){return[Hl]},Qi.prototype.getClass=function(){return Qi};var Bi=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new ki,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var _=arguments[1];this._argGeom=arguments[0],this._bufParams=_}},cs={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Bi.prototype.bufferFixedPrecision=function(l){var h=new Tl(new Qi(new k(1)),l.getScale()),_=new ui(this._bufParams);_.setWorkingPrecisionModel(l),_.setNoder(h),this._resultGeometry=_.buffer(this._argGeom,this._distance)},Bi.prototype.bufferReducedPrecision=function(){var l=this;if(0===arguments.length){for(var h=Bi.MAX_PRECISION_DIGITS;h>=0;h--){try{l.bufferReducedPrecision(h)}catch(U){if(!(U instanceof lo))throw U;l._saveException=U}if(null!==l._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var w=Bi.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),I=new k(w);this.bufferFixedPrecision(I)}},Bi.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var l=this._argGeom.getFactory().getPrecisionModel();l.getType()===k.FIXED?this.bufferFixedPrecision(l):this.bufferReducedPrecision()},Bi.prototype.setQuadrantSegments=function(l){this._bufParams.setQuadrantSegments(l)},Bi.prototype.bufferOriginalPrecision=function(){try{var l=new ui(this._bufParams);this._resultGeometry=l.buffer(this._argGeom,this._distance)}catch(h){if(!(h instanceof Le))throw h;this._saveException=h}},Bi.prototype.getResultGeometry=function(l){return this._distance=l,this.computeGeometry(),this._resultGeometry},Bi.prototype.setEndCapStyle=function(l){this._bufParams.setEndCapStyle(l)},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi},Bi.bufferOp=function(){if(2===arguments.length){var h=arguments[1];return new Bi(arguments[0]).getResultGeometry(h)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof kn&&"number"==typeof arguments[1]){var w=arguments[1],I=arguments[2],U=new Bi(arguments[0]);return U.setQuadrantSegments(I),U.getResultGeometry(w)}if(arguments[2]instanceof ki&&arguments[0]instanceof kn&&"number"==typeof arguments[1]){var he=arguments[1];return new Bi(arguments[0],arguments[2]).getResultGeometry(he)}}else if(4===arguments.length){var vt=arguments[1],on=arguments[2],Gn=arguments[3],qn=new Bi(arguments[0]);return qn.setQuadrantSegments(on),qn.setEndCapStyle(Gn),qn.getResultGeometry(vt)}},Bi.precisionScaleFactor=function(l,h,_){var w=l.getEnvelopeInternal(),I=$e.max(Math.abs(w.getMaxX()),Math.abs(w.getMaxY()),Math.abs(w.getMinX()),Math.abs(w.getMinY()))+2*(h>0?h:0),U=_-Math.trunc(Math.log(I)/Math.log(10)+1);return Math.pow(10,U)},cs.CAP_ROUND.get=function(){return ki.CAP_ROUND},cs.CAP_BUTT.get=function(){return ki.CAP_FLAT},cs.CAP_FLAT.get=function(){return ki.CAP_FLAT},cs.CAP_SQUARE.get=function(){return ki.CAP_SQUARE},cs.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(Bi,cs);var So=function(){this._pt=[new ne,new ne],this._distance=te.NaN,this._isNull=!0};So.prototype.getCoordinates=function(){return this._pt},So.prototype.getCoordinate=function(l){return this._pt[l]},So.prototype.setMinimum=function(){if(1===arguments.length){var l=arguments[0];this.setMinimum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],_=arguments[1];if(this._isNull)return this.initialize(h,_),null;var w=h.distance(_);w<this._distance&&this.initialize(h,_,w)}},So.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var l=arguments[0],h=arguments[1];this._pt[0].setCoordinate(l),this._pt[1].setCoordinate(h),this._distance=l.distance(h),this._isNull=!1}else if(3===arguments.length){var w=arguments[1],I=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(w),this._distance=I,this._isNull=!1}},So.prototype.getDistance=function(){return this._distance},So.prototype.setMaximum=function(){if(1===arguments.length){var l=arguments[0];this.setMaximum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],_=arguments[1];if(this._isNull)return this.initialize(h,_),null;var w=h.distance(_);w>this._distance&&this.initialize(h,_,w)}},So.prototype.interfaces_=function(){return[]},So.prototype.getClass=function(){return So};var io=function(){};io.prototype.interfaces_=function(){return[]},io.prototype.getClass=function(){return io},io.computeDistance=function(){if(arguments[2]instanceof So&&arguments[0]instanceof nr&&arguments[1]instanceof ne)for(var h=arguments[1],_=arguments[2],w=arguments[0].getCoordinates(),I=new wr,U=0;U<w.length-1;U++){I.setCoordinates(w[U],w[U+1]);var q=I.closestPoint(h);_.setMinimum(q,h)}else if(arguments[2]instanceof So&&arguments[0]instanceof Xi&&arguments[1]instanceof ne){var he=arguments[0],ke=arguments[1],wt=arguments[2];io.computeDistance(he.getExteriorRing(),ke,wt);for(var vt=0;vt<he.getNumInteriorRing();vt++)io.computeDistance(he.getInteriorRingN(vt),ke,wt)}else if(arguments[2]instanceof So&&arguments[0]instanceof kn&&arguments[1]instanceof ne){var on=arguments[0],Gn=arguments[1],qn=arguments[2];if(on instanceof nr)io.computeDistance(on,Gn,qn);else if(on instanceof Xi)io.computeDistance(on,Gn,qn);else if(on instanceof mn)for(var hr=on,Lr=0;Lr<hr.getNumGeometries();Lr++){var to=hr.getGeometryN(Lr);io.computeDistance(to,Gn,qn)}else qn.setMinimum(on.getCoordinate(),Gn)}else if(arguments[2]instanceof So&&arguments[0]instanceof wr&&arguments[1]instanceof ne){var ka=arguments[1],Pl=arguments[2],ku=arguments[0].closestPoint(ka);Pl.setMinimum(ku,ka)}};var ta=function(l){this._maxPtDist=new So,this._inputGeom=l||null},uu={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};ta.prototype.computeMaxMidpointDistance=function(l){var h=new Ml(this._inputGeom);l.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},ta.prototype.computeMaxVertexDistance=function(l){var h=new Il(this._inputGeom);l.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},ta.prototype.findDistance=function(l){return this.computeMaxVertexDistance(l),this.computeMaxMidpointDistance(l),this._maxPtDist.getDistance()},ta.prototype.getDistancePoints=function(){return this._maxPtDist},ta.prototype.interfaces_=function(){return[]},ta.prototype.getClass=function(){return ta},uu.MaxPointDistanceFilter.get=function(){return Il},uu.MaxMidpointDistanceFilter.get=function(){return Ml},Object.defineProperties(ta,uu);var Il=function(l){this._maxPtDist=new So,this._minPtDist=new So,this._geom=l||null};Il.prototype.filter=function(l){this._minPtDist.initialize(),io.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Il.prototype.getMaxPointDistance=function(){return this._maxPtDist},Il.prototype.interfaces_=function(){return[li]},Il.prototype.getClass=function(){return Il};var Ml=function(l){this._maxPtDist=new So,this._minPtDist=new So,this._geom=l||null};Ml.prototype.filter=function(l,h){if(0===h)return null;var _=l.getCoordinate(h-1),w=l.getCoordinate(h),I=new ne((_.x+w.x)/2,(_.y+w.y)/2);this._minPtDist.initialize(),io.computeDistance(this._geom,I,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ml.prototype.isDone=function(){return!1},Ml.prototype.isGeometryChanged=function(){return!1},Ml.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ml.prototype.interfaces_=function(){return[Fn]},Ml.prototype.getClass=function(){return Ml};var Ja=function(l){this._comps=l||null};Ja.prototype.filter=function(l){l instanceof Xi&&this._comps.add(l)},Ja.prototype.interfaces_=function(){return[dn]},Ja.prototype.getClass=function(){return Ja},Ja.getPolygons=function(){if(1===arguments.length)return Ja.getPolygons(arguments[0],new Tn);if(2===arguments.length){var h=arguments[0],_=arguments[1];return h instanceof Xi?_.add(h):h instanceof mn&&h.apply(new Ja(_)),_}};var Ys=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var _=arguments[1];this._lines=arguments[0],this._isForcedToLineString=_}};Ys.prototype.filter=function(l){if(this._isForcedToLineString&&l instanceof ca){var h=l.getFactory().createLineString(l.getCoordinateSequence());return this._lines.add(h),null}l instanceof nr&&this._lines.add(l)},Ys.prototype.setForceToLineString=function(l){this._isForcedToLineString=l},Ys.prototype.interfaces_=function(){return[Xr]},Ys.prototype.getClass=function(){return Ys},Ys.getGeometry=function(){if(1===arguments.length){var l=arguments[0];return l.getFactory().buildGeometry(Ys.getLines(l))}if(2===arguments.length){var h=arguments[0],_=arguments[1];return h.getFactory().buildGeometry(Ys.getLines(h,_))}},Ys.getLines=function(){if(1===arguments.length)return Ys.getLines(arguments[0],!1);if(2===arguments.length){if(Bt(arguments[0],Li)&&Bt(arguments[1],Li)){for(var _=arguments[1],w=arguments[0].iterator();w.hasNext();){var I=w.next();Ys.getLines(I,_)}return _}if(arguments[0]instanceof kn&&"boolean"==typeof arguments[1]){var U=arguments[0],q=arguments[1],he=new Tn;return U.apply(new Ys(he,q)),he}if(arguments[0]instanceof kn&&Bt(arguments[1],Li)){var ke=arguments[0],wt=arguments[1];return ke instanceof nr?wt.add(ke):ke.apply(new Ys(wt)),wt}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Bt(arguments[0],Li)&&Bt(arguments[1],Li)){for(var on=arguments[1],Gn=arguments[2],qn=arguments[0].iterator();qn.hasNext();){var hr=qn.next();Ys.getLines(hr,on,Gn)}return on}if("boolean"==typeof arguments[2]&&arguments[0]instanceof kn&&Bt(arguments[1],Li)){var to=arguments[1];return arguments[0].apply(new Ys(to,arguments[2])),to}}};var sl=function(){if(this._boundaryRule=gi.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var l=arguments[0];if(null===l)throw new Q("Rule must be non-null");this._boundaryRule=l}};sl.prototype.locateInternal=function(){if(arguments[0]instanceof ne&&arguments[1]instanceof Xi){var l=arguments[0],h=arguments[1];if(h.isEmpty())return Se.EXTERIOR;var _=h.getExteriorRing(),w=this.locateInPolygonRing(l,_);if(w===Se.EXTERIOR)return Se.EXTERIOR;if(w===Se.BOUNDARY)return Se.BOUNDARY;for(var I=0;I<h.getNumInteriorRing();I++){var U=h.getInteriorRingN(I),q=this.locateInPolygonRing(l,U);if(q===Se.INTERIOR)return Se.EXTERIOR;if(q===Se.BOUNDARY)return Se.BOUNDARY}return Se.INTERIOR}if(arguments[0]instanceof ne&&arguments[1]instanceof nr){var he=arguments[0],ke=arguments[1];if(!ke.getEnvelopeInternal().intersects(he))return Se.EXTERIOR;var wt=ke.getCoordinates();return ke.isClosed()||!he.equals(wt[0])&&!he.equals(wt[wt.length-1])?un.isOnLine(he,wt)?Se.INTERIOR:Se.EXTERIOR:Se.BOUNDARY}if(arguments[0]instanceof ne&&arguments[1]instanceof Zr){var vt=arguments[0];return arguments[1].getCoordinate().equals2D(vt)?Se.INTERIOR:Se.EXTERIOR}},sl.prototype.locateInPolygonRing=function(l,h){return h.getEnvelopeInternal().intersects(l)?un.locatePointInRing(l,h.getCoordinates()):Se.EXTERIOR},sl.prototype.intersects=function(l,h){return this.locate(l,h)!==Se.EXTERIOR},sl.prototype.updateLocationInfo=function(l){l===Se.INTERIOR&&(this._isIn=!0),l===Se.BOUNDARY&&this._numBoundaries++},sl.prototype.computeLocation=function(l,h){if(h instanceof Zr&&this.updateLocationInfo(this.locateInternal(l,h)),h instanceof nr)this.updateLocationInfo(this.locateInternal(l,h));else if(h instanceof Xi)this.updateLocationInfo(this.locateInternal(l,h));else if(h instanceof yr)for(var _=h,w=0;w<_.getNumGeometries();w++){var I=_.getGeometryN(w);this.updateLocationInfo(this.locateInternal(l,I))}else if(h instanceof so)for(var U=h,q=0;q<U.getNumGeometries();q++){var he=U.getGeometryN(q);this.updateLocationInfo(this.locateInternal(l,he))}else if(h instanceof mn)for(var ke=new Co(h);ke.hasNext();){var wt=ke.next();wt!==h&&this.computeLocation(l,wt)}},sl.prototype.locate=function(l,h){return h.isEmpty()?Se.EXTERIOR:h instanceof nr||h instanceof Xi?this.locateInternal(l,h):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(l,h),this._boundaryRule.isInBoundary(this._numBoundaries)?Se.BOUNDARY:this._numBoundaries>0||this._isIn?Se.INTERIOR:Se.EXTERIOR)},sl.prototype.interfaces_=function(){return[]},sl.prototype.getClass=function(){return sl};var ba=function l(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)l.call(this,arguments[0],l.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var I=arguments[1],U=arguments[2];this._component=arguments[0],this._segIndex=I,this._pt=U}},af={INSIDE_AREA:{configurable:!0}};ba.prototype.isInsideArea=function(){return this._segIndex===ba.INSIDE_AREA},ba.prototype.getCoordinate=function(){return this._pt},ba.prototype.getGeometryComponent=function(){return this._component},ba.prototype.getSegmentIndex=function(){return this._segIndex},ba.prototype.interfaces_=function(){return[]},ba.prototype.getClass=function(){return ba},af.INSIDE_AREA.get=function(){return-1},Object.defineProperties(ba,af);var no=function(l){this._pts=l||null};no.prototype.filter=function(l){l instanceof Zr&&this._pts.add(l)},no.prototype.interfaces_=function(){return[dn]},no.prototype.getClass=function(){return no},no.getPoints=function(){if(1===arguments.length){var l=arguments[0];return l instanceof Zr?Da.singletonList(l):no.getPoints(l,new Tn)}if(2===arguments.length){var h=arguments[0],_=arguments[1];return h instanceof Zr?_.add(h):h instanceof mn&&h.apply(new no(_)),_}};var ro=function(){this._locations=null,this._locations=arguments[0]};ro.prototype.filter=function(l){(l instanceof Zr||l instanceof nr||l instanceof Xi)&&this._locations.add(new ba(l,0,l.getCoordinate()))},ro.prototype.interfaces_=function(){return[dn]},ro.prototype.getClass=function(){return ro},ro.getLocations=function(l){var h=new Tn;return l.apply(new ro(h)),h};var Us=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new sl,this._minDistanceLocation=null,this._minDistance=te.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var _=arguments[0],w=arguments[1],I=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=_,this._geom[1]=w,this._terminateDistance=I}};Us.prototype.computeContainmentDistance=function(){if(0===arguments.length){var l=new Array(2).fill(null);if(this.computeContainmentDistance(0,l),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,l)}else if(2===arguments.length){var h=arguments[0],_=arguments[1],w=1-h,I=Ja.getPolygons(this._geom[h]);if(I.size()>0){var U=ro.getLocations(this._geom[w]);if(this.computeContainmentDistance(U,I,_),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[w]=_[0],this._minDistanceLocation[h]=_[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Bt(arguments[0],Ls)&&Bt(arguments[1],Ls)){for(var q=arguments[0],he=arguments[1],ke=arguments[2],wt=0;wt<q.size();wt++)for(var vt=q.get(wt),on=0;on<he.size();on++)if(this.computeContainmentDistance(vt,he.get(on),ke),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof ba&&arguments[1]instanceof Xi){var Gn=arguments[0],qn=arguments[1],hr=arguments[2],Lr=Gn.getCoordinate();if(Se.EXTERIOR!==this._ptLocator.locate(Lr,qn))return this._minDistance=0,hr[0]=Gn,hr[1]=new ba(qn,Lr),null}},Us.prototype.computeMinDistanceLinesPoints=function(l,h,_){for(var w=0;w<l.size();w++)for(var I=l.get(w),U=0;U<h.size();U++){var q=h.get(U);if(this.computeMinDistance(I,q,_),this._minDistance<=this._terminateDistance)return null}},Us.prototype.computeFacetDistance=function(){var l=new Array(2).fill(null),h=Ys.getLines(this._geom[0]),_=Ys.getLines(this._geom[1]),w=no.getPoints(this._geom[0]),I=no.getPoints(this._geom[1]);return this.computeMinDistanceLines(h,_,l),this.updateMinDistance(l,!1),this._minDistance<=this._terminateDistance?null:(l[0]=null,l[1]=null,this.computeMinDistanceLinesPoints(h,I,l),this.updateMinDistance(l,!1),this._minDistance<=this._terminateDistance?null:(l[0]=null,l[1]=null,this.computeMinDistanceLinesPoints(_,w,l),this.updateMinDistance(l,!0),this._minDistance<=this._terminateDistance?null:(l[0]=null,l[1]=null,this.computeMinDistancePoints(w,I,l),void this.updateMinDistance(l,!1))))},Us.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Us.prototype.updateMinDistance=function(l,h){if(null===l[0])return null;h?(this._minDistanceLocation[0]=l[1],this._minDistanceLocation[1]=l[0]):(this._minDistanceLocation[0]=l[0],this._minDistanceLocation[1]=l[1])},Us.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Us.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof nr&&arguments[1]instanceof Zr){var l=arguments[0],h=arguments[1],_=arguments[2];if(l.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var w=l.getCoordinates(),I=h.getCoordinate(),U=0;U<w.length-1;U++){var q=un.distancePointLine(I,w[U],w[U+1]);if(q<this._minDistance){this._minDistance=q;var he=new wr(w[U],w[U+1]).closestPoint(I);_[0]=new ba(l,U,he),_[1]=new ba(h,0,I)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof nr&&arguments[1]instanceof nr){var ke=arguments[0],wt=arguments[1],vt=arguments[2];if(ke.getEnvelopeInternal().distance(wt.getEnvelopeInternal())>this._minDistance)return null;for(var on=ke.getCoordinates(),Gn=wt.getCoordinates(),qn=0;qn<on.length-1;qn++)for(var hr=0;hr<Gn.length-1;hr++){var Lr=un.distanceLineLine(on[qn],on[qn+1],Gn[hr],Gn[hr+1]);if(Lr<this._minDistance){this._minDistance=Lr;var to=new wr(on[qn],on[qn+1]),Ps=new wr(Gn[hr],Gn[hr+1]),ka=to.closestPoints(Ps);vt[0]=new ba(ke,qn,ka[0]),vt[1]=new ba(wt,hr,ka[1])}if(this._minDistance<=this._terminateDistance)return null}}},Us.prototype.computeMinDistancePoints=function(l,h,_){for(var w=0;w<l.size();w++)for(var I=l.get(w),U=0;U<h.size();U++){var q=h.get(U),he=I.getCoordinate().distance(q.getCoordinate());if(he<this._minDistance&&(this._minDistance=he,_[0]=new ba(I,0,I.getCoordinate()),_[1]=new ba(q,0,q.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Us.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new Q("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Us.prototype.computeMinDistanceLines=function(l,h,_){for(var w=0;w<l.size();w++)for(var I=l.get(w),U=0;U<h.size();U++){var q=h.get(U);if(this.computeMinDistance(I,q,_),this._minDistance<=this._terminateDistance)return null}},Us.prototype.interfaces_=function(){return[]},Us.prototype.getClass=function(){return Us},Us.distance=function(l,h){return new Us(l,h).distance()},Us.isWithinDistance=function(l,h,_){return new Us(l,h,_).distance()<=_},Us.nearestPoints=function(l,h){return new Us(l,h).nearestPoints()};var mo=function(){this._pt=[new ne,new ne],this._distance=te.NaN,this._isNull=!0};mo.prototype.getCoordinates=function(){return this._pt},mo.prototype.getCoordinate=function(l){return this._pt[l]},mo.prototype.setMinimum=function(){if(1===arguments.length){var l=arguments[0];this.setMinimum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],_=arguments[1];if(this._isNull)return this.initialize(h,_),null;var w=h.distance(_);w<this._distance&&this.initialize(h,_,w)}},mo.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var l=arguments[0],h=arguments[1];this._pt[0].setCoordinate(l),this._pt[1].setCoordinate(h),this._distance=l.distance(h),this._isNull=!1}else if(3===arguments.length){var w=arguments[1],I=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(w),this._distance=I,this._isNull=!1}},mo.prototype.toString=function(){return Nt.toLineString(this._pt[0],this._pt[1])},mo.prototype.getDistance=function(){return this._distance},mo.prototype.setMaximum=function(){if(1===arguments.length){var l=arguments[0];this.setMaximum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],_=arguments[1];if(this._isNull)return this.initialize(h,_),null;var w=h.distance(_);w>this._distance&&this.initialize(h,_,w)}},mo.prototype.interfaces_=function(){return[]},mo.prototype.getClass=function(){return mo};var Aa=function(){};Aa.prototype.interfaces_=function(){return[]},Aa.prototype.getClass=function(){return Aa},Aa.computeDistance=function(){if(arguments[2]instanceof mo&&arguments[0]instanceof nr&&arguments[1]instanceof ne)for(var l=arguments[0],h=arguments[1],_=arguments[2],w=new wr,I=l.getCoordinates(),U=0;U<I.length-1;U++){w.setCoordinates(I[U],I[U+1]);var q=w.closestPoint(h);_.setMinimum(q,h)}else if(arguments[2]instanceof mo&&arguments[0]instanceof Xi&&arguments[1]instanceof ne){var he=arguments[0],ke=arguments[1],wt=arguments[2];Aa.computeDistance(he.getExteriorRing(),ke,wt);for(var vt=0;vt<he.getNumInteriorRing();vt++)Aa.computeDistance(he.getInteriorRingN(vt),ke,wt)}else if(arguments[2]instanceof mo&&arguments[0]instanceof kn&&arguments[1]instanceof ne){var on=arguments[0],Gn=arguments[1],qn=arguments[2];if(on instanceof nr)Aa.computeDistance(on,Gn,qn);else if(on instanceof Xi)Aa.computeDistance(on,Gn,qn);else if(on instanceof mn)for(var hr=on,Lr=0;Lr<hr.getNumGeometries();Lr++){var to=hr.getGeometryN(Lr);Aa.computeDistance(to,Gn,qn)}else qn.setMinimum(on.getCoordinate(),Gn)}else if(arguments[2]instanceof mo&&arguments[0]instanceof wr&&arguments[1]instanceof ne){var ka=arguments[1],Pl=arguments[2],ku=arguments[0].closestPoint(ka);Pl.setMinimum(ku,ka)}};var _s=function(){this._g0=null,this._g1=null,this._ptDist=new mo,this._densifyFrac=0;var h=arguments[1];this._g0=arguments[0],this._g1=h},al={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};_s.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},_s.prototype.setDensifyFraction=function(l){if(l>1||l<=0)throw new Q("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=l},_s.prototype.compute=function(l,h){this.computeOrientedDistance(l,h,this._ptDist),this.computeOrientedDistance(h,l,this._ptDist)},_s.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},_s.prototype.computeOrientedDistance=function(l,h,_){var w=new Pa(h);if(l.apply(w),_.setMaximum(w.getMaxPointDistance()),this._densifyFrac>0){var I=new pa(h,this._densifyFrac);l.apply(I),_.setMaximum(I.getMaxPointDistance())}},_s.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},_s.distance=function(){if(2===arguments.length)return new _s(arguments[0],arguments[1]).distance();if(3===arguments.length){var I=arguments[2],U=new _s(arguments[0],arguments[1]);return U.setDensifyFraction(I),U.distance()}},al.MaxPointDistanceFilter.get=function(){return Pa},al.MaxDensifiedByFractionDistanceFilter.get=function(){return pa},Object.defineProperties(_s,al);var Pa=function(){this._maxPtDist=new mo,this._minPtDist=new mo,this._euclideanDist=new Aa,this._geom=null,this._geom=arguments[0]};Pa.prototype.filter=function(l){this._minPtDist.initialize(),Aa.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Pa.prototype.getMaxPointDistance=function(){return this._maxPtDist},Pa.prototype.interfaces_=function(){return[li]},Pa.prototype.getClass=function(){return Pa};var pa=function(){this._maxPtDist=new mo,this._minPtDist=new mo,this._geom=null,this._numSubSegs=0;var h=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/h))};pa.prototype.filter=function(l,h){if(0===h)return null;for(var _=l.getCoordinate(h-1),w=l.getCoordinate(h),I=(w.x-_.x)/this._numSubSegs,U=(w.y-_.y)/this._numSubSegs,q=0;q<this._numSubSegs;q++){var wt=new ne(_.x+q*I,_.y+q*U);this._minPtDist.initialize(),Aa.computeDistance(this._geom,wt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},pa.prototype.isDone=function(){return!1},pa.prototype.isGeometryChanged=function(){return!1},pa.prototype.getMaxPointDistance=function(){return this._maxPtDist},pa.prototype.interfaces_=function(){return[Fn]},pa.prototype.getClass=function(){return pa};var Ks=function(l,h,_){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=l||null,this._bufDistance=h||null,this._result=_||null},ci={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Ks.prototype.checkMaximumDistance=function(l,h,_){var w=new _s(h,l);if(w.setDensifyFraction(.25),this._maxDistanceFound=w.orientedDistance(),this._maxDistanceFound>_){this._isValid=!1;var I=w.getCoordinates();this._errorLocation=I[1],this._errorIndicator=l.getFactory().createLineString(I),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Nt.toLineString(I[0],I[1])+")"}},Ks.prototype.isValid=function(){var l=Math.abs(this._bufDistance),h=Ks.MAX_DISTANCE_DIFF_FRAC*l;return this._minValidDistance=l-h,this._maxValidDistance=l+h,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Ks.VERBOSE&&pr.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Ks.prototype.checkNegativeValid=function(){if(!(this._input instanceof Xi||this._input instanceof so||this._input instanceof mn))return null;var l=this.getPolygonLines(this._input);if(this.checkMinimumDistance(l,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(l,this._result,this._maxValidDistance)},Ks.prototype.getErrorIndicator=function(){return this._errorIndicator},Ks.prototype.checkMinimumDistance=function(l,h,_){var w=new Us(l,h,_);if(this._minDistanceFound=w.distance(),this._minDistanceFound<_){this._isValid=!1;var I=w.nearestPoints();this._errorLocation=w.nearestPoints()[1],this._errorIndicator=l.getFactory().createLineString(I),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Nt.toLineString(I[0],I[1])+" )"}},Ks.prototype.checkPositiveValid=function(){var l=this._result.getBoundary();if(this.checkMinimumDistance(this._input,l,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,l,this._maxValidDistance)},Ks.prototype.getErrorLocation=function(){return this._errorLocation},Ks.prototype.getPolygonLines=function(l){for(var h=new Tn,_=new Ys(h),w=Ja.getPolygons(l).iterator();w.hasNext();)w.next().apply(_);return l.getFactory().buildGeometry(h)},Ks.prototype.getErrorMessage=function(){return this._errMsg},Ks.prototype.interfaces_=function(){return[]},Ks.prototype.getClass=function(){return Ks},ci.VERBOSE.get=function(){return!1},ci.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Ks,ci);var vs=function(l,h,_){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=l||null,this._distance=h||null,this._result=_||null},Mh={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};vs.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},vs.prototype.checkEnvelope=function(){if(this._distance<0)return null;var l=this._distance*vs.MAX_ENV_DIFF_FRAC;0===l&&(l=.001);var h=new Rn(this._input.getEnvelopeInternal());h.expandBy(this._distance);var _=new Rn(this._result.getEnvelopeInternal());_.expandBy(l),_.contains(h)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(_)),this.report("Envelope")},vs.prototype.checkDistance=function(){var l=new Ks(this._input,this._distance,this._result);l.isValid()||(this._isValid=!1,this._errorMsg=l.getErrorMessage(),this._errorLocation=l.getErrorLocation(),this._errorIndicator=l.getErrorIndicator()),this.report("Distance")},vs.prototype.checkArea=function(){var l=this._input.getArea(),h=this._result.getArea();this._distance>0&&l>h&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&l<h&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},vs.prototype.checkPolygonal=function(){this._result instanceof Xi||this._result instanceof so||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},vs.prototype.getErrorIndicator=function(){return this._errorIndicator},vs.prototype.getErrorLocation=function(){return this._errorLocation},vs.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},vs.prototype.report=function(l){if(!vs.VERBOSE)return null;pr.out.println("Check "+l+": "+(this._isValid?"passed":"FAILED"))},vs.prototype.getErrorMessage=function(){return this._errorMsg},vs.prototype.interfaces_=function(){return[]},vs.prototype.getClass=function(){return vs},vs.isValidMsg=function(l,h,_){var w=new vs(l,h,_);return w.isValid()?null:w.getErrorMessage()},vs.isValid=function(l,h,_){return!!new vs(l,h,_).isValid()},Mh.VERBOSE.get=function(){return!1},Mh.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(vs,Mh);var Qa=function(){this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};Qa.prototype.getCoordinates=function(){return this._pts},Qa.prototype.size=function(){return this._pts.length},Qa.prototype.getCoordinate=function(l){return this._pts[l]},Qa.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Qa.prototype.getSegmentOctant=function(l){return l===this._pts.length-1?-1:Au.octant(this.getCoordinate(l),this.getCoordinate(l+1))},Qa.prototype.setData=function(l){this._data=l},Qa.prototype.getData=function(){return this._data},Qa.prototype.toString=function(){return Nt.toLineString(new ao(this._pts))},Qa.prototype.interfaces_=function(){return[oa]},Qa.prototype.getClass=function(){return Qa};var ho=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Tn,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};ho.prototype.getInteriorIntersection=function(){return this._interiorIntersection},ho.prototype.setCheckEndSegmentsOnly=function(l){this._isCheckEndSegmentsOnly=l},ho.prototype.getIntersectionSegments=function(){return this._intSegments},ho.prototype.count=function(){return this._intersectionCount},ho.prototype.getIntersections=function(){return this._intersections},ho.prototype.setFindAllIntersections=function(l){this._findAllIntersections=l},ho.prototype.setKeepIntersections=function(l){this._keepIntersections=l},ho.prototype.processIntersections=function(l,h,_,w){if(!this._findAllIntersections&&this.hasIntersection()||l===_&&h===w||this._isCheckEndSegmentsOnly&&!this.isEndSegment(l,h)&&!this.isEndSegment(_,w))return null;var I=l.getCoordinates()[h],U=l.getCoordinates()[h+1],q=_.getCoordinates()[w],he=_.getCoordinates()[w+1];this._li.computeIntersection(I,U,q,he),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=I,this._intSegments[1]=U,this._intSegments[2]=q,this._intSegments[3]=he,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},ho.prototype.isEndSegment=function(l,h){return 0===h||h>=l.size()-2},ho.prototype.hasIntersection=function(){return null!==this._interiorIntersection},ho.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},ho.prototype.interfaces_=function(){return[$a]},ho.prototype.getClass=function(){return ho},ho.createAllIntersectionsFinder=function(l){var h=new ho(l);return h.setFindAllIntersections(!0),h},ho.createAnyIntersectionFinder=function(l){return new ho(l)},ho.createIntersectionCounter=function(l){var h=new ho(l);return h.setFindAllIntersections(!0),h.setKeepIntersections(!1),h};var Ra=function(){this._li=new Jt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};Ra.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Ra.prototype.getIntersections=function(){return this._segInt.getIntersections()},Ra.prototype.isValid=function(){return this.execute(),this._isValid},Ra.prototype.setFindAllIntersections=function(l){this._findAllIntersections=l},Ra.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new ho(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var l=new au;if(l.setSegmentIntersector(this._segInt),l.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Ra.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new lo(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Ra.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var l=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Nt.toLineString(l[0],l[1])+" and "+Nt.toLineString(l[2],l[3])},Ra.prototype.interfaces_=function(){return[]},Ra.prototype.getClass=function(){return Ra},Ra.computeIntersections=function(l){var h=new Ra(l);return h.setFindAllIntersections(!0),h.isValid(),h.getIntersections()};var Oa=function l(){this._nv=null,this._nv=new Ra(l.toSegmentStrings(arguments[0]))};Oa.prototype.checkValid=function(){this._nv.checkValid()},Oa.prototype.interfaces_=function(){return[]},Oa.prototype.getClass=function(){return Oa},Oa.toSegmentStrings=function(l){for(var h=new Tn,_=l.iterator();_.hasNext();){var w=_.next();h.add(new Qa(w.getCoordinates(),w))}return h},Oa.checkValid=function(l){new Oa(l).checkValid()};var Yl=function(l){this._mapOp=l};Yl.prototype.map=function(l){for(var h=new Tn,_=0;_<l.getNumGeometries();_++){var w=this._mapOp.map(l.getGeometryN(_));w.isEmpty()||h.add(w)}return l.getFactory().createGeometryCollection(at.toGeometryArray(h))},Yl.prototype.interfaces_=function(){return[]},Yl.prototype.getClass=function(){return Yl},Yl.map=function(l,h){return new Yl(h).map(l)};var el=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Tn,this._resultLineList=new Tn;var h=arguments[1],_=arguments[2];this._op=arguments[0],this._geometryFactory=h,this._ptLocator=_};el.prototype.collectLines=function(l){for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var _=h.next();this.collectLineEdge(_,l,this._lineEdgesList),this.collectBoundaryTouchEdge(_,l,this._lineEdgesList)}},el.prototype.labelIsolatedLine=function(l,h){var _=this._ptLocator.locate(l.getCoordinate(),this._op.getArgGeometry(h));l.getLabel().setLocation(h,_)},el.prototype.build=function(l){return this.findCoveredLineEdges(),this.collectLines(l),this.buildLines(l),this._resultLineList},el.prototype.collectLineEdge=function(l,h,_){var w=l.getLabel(),I=l.getEdge();l.isLineEdge()&&(l.isVisited()||!ti.isResultOfOp(w,h)||I.isCovered()||(_.add(I),l.setVisitedEdge(!0)))},el.prototype.findCoveredLineEdges=function(){for(var l=this._op.getGraph().getNodes().iterator();l.hasNext();)l.next().getEdges().findCoveredLineEdges();for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var _=h.next(),w=_.getEdge();if(_.isLineEdge()&&!w.isCoveredSet()){var I=this._op.isCoveredByA(_.getCoordinate());w.setCovered(I)}}},el.prototype.labelIsolatedLines=function(l){for(var h=l.iterator();h.hasNext();){var _=h.next(),w=_.getLabel();_.isIsolated()&&(w.isNull(0)?this.labelIsolatedLine(_,0):this.labelIsolatedLine(_,1))}},el.prototype.buildLines=function(l){for(var h=this._lineEdgesList.iterator();h.hasNext();){var _=h.next(),w=this._geometryFactory.createLineString(_.getCoordinates());this._resultLineList.add(w),_.setInResult(!0)}},el.prototype.collectBoundaryTouchEdge=function(l,h,_){var w=l.getLabel();return l.isLineEdge()||l.isVisited()||l.isInteriorAreaEdge()||l.getEdge().isInResult()?null:(Me.isTrue(!(l.isInResult()||l.getSym().isInResult())||!l.getEdge().isInResult()),void(ti.isResultOfOp(w,h)&&h===ti.INTERSECTION&&(_.add(l.getEdge()),l.setVisitedEdge(!0))))},el.prototype.interfaces_=function(){return[]},el.prototype.getClass=function(){return el};var Dl=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Tn;var h=arguments[1];this._op=arguments[0],this._geometryFactory=h};Dl.prototype.filterCoveredNodeToPoint=function(l){var h=l.getCoordinate();if(!this._op.isCoveredByLA(h)){var _=this._geometryFactory.createPoint(h);this._resultPointList.add(_)}},Dl.prototype.extractNonCoveredResultNodes=function(l){for(var h=this._op.getGraph().getNodes().iterator();h.hasNext();){var _=h.next();if(!(_.isInResult()||_.isIncidentEdgeInResult()||0!==_.getEdges().getDegree()&&l!==ti.INTERSECTION)){var w=_.getLabel();ti.isResultOfOp(w,l)&&this.filterCoveredNodeToPoint(_)}}},Dl.prototype.build=function(l){return this.extractNonCoveredResultNodes(l),this._resultPointList},Dl.prototype.interfaces_=function(){return[]},Dl.prototype.getClass=function(){return Dl};var sa=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};sa.prototype.transformPoint=function(l,h){return this._factory.createPoint(this.transformCoordinates(l.getCoordinateSequence(),l))},sa.prototype.transformPolygon=function(l,h){var _=!0,w=this.transformLinearRing(l.getExteriorRing(),l);null!==w&&w instanceof ca&&!w.isEmpty()||(_=!1);for(var I=new Tn,U=0;U<l.getNumInteriorRing();U++){var q=this.transformLinearRing(l.getInteriorRingN(U),l);null===q||q.isEmpty()||(q instanceof ca||(_=!1),I.add(q))}if(_)return this._factory.createPolygon(w,I.toArray([]));var he=new Tn;return null!==w&&he.add(w),he.addAll(I),this._factory.buildGeometry(he)},sa.prototype.createCoordinateSequence=function(l){return this._factory.getCoordinateSequenceFactory().create(l)},sa.prototype.getInputGeometry=function(){return this._inputGeom},sa.prototype.transformMultiLineString=function(l,h){for(var _=new Tn,w=0;w<l.getNumGeometries();w++){var I=this.transformLineString(l.getGeometryN(w),l);null!==I&&(I.isEmpty()||_.add(I))}return this._factory.buildGeometry(_)},sa.prototype.transformCoordinates=function(l,h){return this.copy(l)},sa.prototype.transformLineString=function(l,h){return this._factory.createLineString(this.transformCoordinates(l.getCoordinateSequence(),l))},sa.prototype.transformMultiPoint=function(l,h){for(var _=new Tn,w=0;w<l.getNumGeometries();w++){var I=this.transformPoint(l.getGeometryN(w),l);null!==I&&(I.isEmpty()||_.add(I))}return this._factory.buildGeometry(_)},sa.prototype.transformMultiPolygon=function(l,h){for(var _=new Tn,w=0;w<l.getNumGeometries();w++){var I=this.transformPolygon(l.getGeometryN(w),l);null!==I&&(I.isEmpty()||_.add(I))}return this._factory.buildGeometry(_)},sa.prototype.copy=function(l){return l.copy()},sa.prototype.transformGeometryCollection=function(l,h){for(var _=new Tn,w=0;w<l.getNumGeometries();w++){var I=this.transform(l.getGeometryN(w));null!==I&&(this._pruneEmptyGeometry&&I.isEmpty()||_.add(I))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(at.toGeometryArray(_)):this._factory.buildGeometry(_)},sa.prototype.transform=function(l){if(this._inputGeom=l,this._factory=l.getFactory(),l instanceof Zr)return this.transformPoint(l,null);if(l instanceof Yt)return this.transformMultiPoint(l,null);if(l instanceof ca)return this.transformLinearRing(l,null);if(l instanceof nr)return this.transformLineString(l,null);if(l instanceof yr)return this.transformMultiLineString(l,null);if(l instanceof Xi)return this.transformPolygon(l,null);if(l instanceof so)return this.transformMultiPolygon(l,null);if(l instanceof mn)return this.transformGeometryCollection(l,null);throw new Q("Unknown Geometry subtype: "+l.getClass().getName())},sa.prototype.transformLinearRing=function(l,h){var _=this.transformCoordinates(l.getCoordinateSequence(),l);if(null===_)return this._factory.createLinearRing(null);var w=_.size();return w>0&&w<4&&!this._preserveType?this._factory.createLineString(_):this._factory.createLinearRing(_)},sa.prototype.interfaces_=function(){return[]},sa.prototype.getClass=function(){return sa};var ll=function l(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new wr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof nr&&"number"==typeof arguments[1]){var _=arguments[1];l.call(this,arguments[0].getCoordinates(),_)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var w=arguments[0],I=arguments[1];this._srcPts=w,this._isClosed=l.isClosed(w),this._snapTolerance=I}};ll.prototype.snapVertices=function(l,h){for(var _=this._isClosed?l.size()-1:l.size(),w=0;w<_;w++){var I=l.get(w),U=this.findSnapForVertex(I,h);null!==U&&(l.set(w,new ne(U)),0===w&&this._isClosed&&l.set(l.size()-1,new ne(U)))}},ll.prototype.findSnapForVertex=function(l,h){for(var _=0;_<h.length;_++){if(l.equals2D(h[_]))return null;if(l.distance(h[_])<this._snapTolerance)return h[_]}return null},ll.prototype.snapTo=function(l){var h=new va(this._srcPts);return this.snapVertices(h,l),this.snapSegments(h,l),h.toCoordinateArray()},ll.prototype.snapSegments=function(l,h){if(0===h.length)return null;var _=h.length;h[0].equals2D(h[h.length-1])&&(_=h.length-1);for(var w=0;w<_;w++){var I=h[w],U=this.findSegmentIndexToSnap(I,l);U>=0&&l.add(U+1,new ne(I),!1)}},ll.prototype.findSegmentIndexToSnap=function(l,h){for(var _=te.MAX_VALUE,w=-1,I=0;I<h.size()-1;I++){if(this._seg.p0=h.get(I),this._seg.p1=h.get(I+1),this._seg.p0.equals2D(l)||this._seg.p1.equals2D(l)){if(this._allowSnappingToSourceVertices)continue;return-1}var U=this._seg.distance(l);U<this._snapTolerance&&U<_&&(_=U,w=I)}return w},ll.prototype.setAllowSnappingToSourceVertices=function(l){this._allowSnappingToSourceVertices=l},ll.prototype.interfaces_=function(){return[]},ll.prototype.getClass=function(){return ll},ll.isClosed=function(l){return!(l.length<=1)&&l[0].equals2D(l[l.length-1])};var As=function(l){this._srcGeom=l||null},qu={SNAP_PRECISION_FACTOR:{configurable:!0}};As.prototype.snapTo=function(l,h){var _=this.extractTargetCoordinates(l);return new Ec(h,_).transform(this._srcGeom)},As.prototype.snapToSelf=function(l,h){var _=this.extractTargetCoordinates(this._srcGeom),w=new Ec(l,_,!0).transform(this._srcGeom),I=w;return h&&Bt(I,Wi)&&(I=w.buffer(0)),I},As.prototype.computeSnapTolerance=function(l){return this.computeMinimumSegmentLength(l)/10},As.prototype.extractTargetCoordinates=function(l){for(var h=new dt,_=l.getCoordinates(),w=0;w<_.length;w++)h.add(_[w]);return h.toArray(new Array(0).fill(null))},As.prototype.computeMinimumSegmentLength=function(l){for(var h=te.MAX_VALUE,_=0;_<l.length-1;_++){var w=l[_].distance(l[_+1]);w<h&&(h=w)}return h},As.prototype.interfaces_=function(){return[]},As.prototype.getClass=function(){return As},As.snap=function(l,h,_){var w=new Array(2).fill(null),I=new As(l);w[0]=I.snapTo(h,_);var U=new As(h);return w[1]=U.snapTo(w[0],_),w},As.computeOverlaySnapTolerance=function(){if(1===arguments.length){var l=arguments[0],h=As.computeSizeBasedSnapTolerance(l),_=l.getPrecisionModel();if(_.getType()===k.FIXED){var w=1/_.getScale()*2/1.415;w>h&&(h=w)}return h}if(2===arguments.length){var U=arguments[1];return Math.min(As.computeOverlaySnapTolerance(arguments[0]),As.computeOverlaySnapTolerance(U))}},As.computeSizeBasedSnapTolerance=function(l){var h=l.getEnvelopeInternal();return Math.min(h.getHeight(),h.getWidth())*As.SNAP_PRECISION_FACTOR},As.snapToSelf=function(l,h,_){return new As(l).snapToSelf(h,_)},qu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(As,qu);var Ec=function(l){function h(_,w,I){l.call(this),this._snapTolerance=_||null,this._snapPts=w||null,this._isSelfSnap=void 0!==I&&I}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.snapLine=function(_,w){var I=new ll(_,this._snapTolerance);return I.setAllowSnappingToSourceVertices(this._isSelfSnap),I.snapTo(w)},h.prototype.transformCoordinates=function(_,w){var I=_.toCoordinateArray(),U=this.snapLine(I,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(U)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(sa),To=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};To.prototype.getCommon=function(){return te.longBitsToDouble(this._commonBits)},To.prototype.add=function(l){var h=te.doubleToLongBits(l);return this._isFirst?(this._commonBits=h,this._commonSignExp=To.signExpBits(this._commonBits),this._isFirst=!1,null):To.signExpBits(h)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=To.numCommonMostSigMantissaBits(this._commonBits,h),void(this._commonBits=To.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},To.prototype.toString=function(){if(1===arguments.length){var l=arguments[0],h=te.longBitsToDouble(l),_="0000000000000000000000000000000000000000000000000000000000000000"+te.toBinaryString(l),w=_.substring(_.length-64);return w.substring(0,1)+"  "+w.substring(1,12)+"(exp) "+w.substring(12)+" [ "+h+" ]"}},To.prototype.interfaces_=function(){return[]},To.prototype.getClass=function(){return To},To.getBit=function(l,h){return 0!=(l&1<<h)?1:0},To.signExpBits=function(l){return l>>52},To.zeroLowerBits=function(l,h){return l&~((1<<h)-1)},To.numCommonMostSigMantissaBits=function(l,h){for(var _=0,w=52;w>=0;w--){if(To.getBit(l,w)!==To.getBit(h,w))return _;_++}return 52};var Al=function(){this._commonCoord=null,this._ccFilter=new La},tr={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Al.prototype.addCommonBits=function(l){var h=new Hu(this._commonCoord);l.apply(h),l.geometryChanged()},Al.prototype.removeCommonBits=function(l){if(0===this._commonCoord.x&&0===this._commonCoord.y)return l;var h=new ne(this._commonCoord);h.x=-h.x,h.y=-h.y;var _=new Hu(h);return l.apply(_),l.geometryChanged(),l},Al.prototype.getCommonCoordinate=function(){return this._commonCoord},Al.prototype.add=function(l){l.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},Al.prototype.interfaces_=function(){return[]},Al.prototype.getClass=function(){return Al},tr.CommonCoordinateFilter.get=function(){return La},tr.Translater.get=function(){return Hu},Object.defineProperties(Al,tr);var La=function(){this._commonBitsX=new To,this._commonBitsY=new To};La.prototype.filter=function(l){this._commonBitsX.add(l.x),this._commonBitsY.add(l.y)},La.prototype.getCommonCoordinate=function(){return new ne(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},La.prototype.interfaces_=function(){return[li]},La.prototype.getClass=function(){return La};var Hu=function(){this.trans=null,this.trans=arguments[0]};Hu.prototype.filter=function(l,h){var _=l.getOrdinate(h,0)+this.trans.x,w=l.getOrdinate(h,1)+this.trans.y;l.setOrdinate(h,0,_),l.setOrdinate(h,1,w)},Hu.prototype.isDone=function(){return!1},Hu.prototype.isGeometryChanged=function(){return!0},Hu.prototype.interfaces_=function(){return[Fn]},Hu.prototype.getClass=function(){return Hu};var ga=function(l,h){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=l,this._geom[1]=h,this.computeSnapTolerance()};ga.prototype.selfSnap=function(l){return new As(l).snapTo(l,this._snapTolerance)},ga.prototype.removeCommonBits=function(l){this._cbr=new Al,this._cbr.add(l[0]),this._cbr.add(l[1]);var h=new Array(2).fill(null);return h[0]=this._cbr.removeCommonBits(l[0].copy()),h[1]=this._cbr.removeCommonBits(l[1].copy()),h},ga.prototype.prepareResult=function(l){return this._cbr.addCommonBits(l),l},ga.prototype.getResultGeometry=function(l){var h=this.snap(this._geom),_=ti.overlayOp(h[0],h[1],l);return this.prepareResult(_)},ga.prototype.checkValid=function(l){l.isValid()||pr.out.println("Snapped geometry is invalid")},ga.prototype.computeSnapTolerance=function(){this._snapTolerance=As.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},ga.prototype.snap=function(l){var h=this.removeCommonBits(l);return As.snap(h[0],h[1],this._snapTolerance)},ga.prototype.interfaces_=function(){return[]},ga.prototype.getClass=function(){return ga},ga.overlayOp=function(l,h,_){return new ga(l,h).getResultGeometry(_)},ga.union=function(l,h){return ga.overlayOp(l,h,ti.UNION)},ga.intersection=function(l,h){return ga.overlayOp(l,h,ti.INTERSECTION)},ga.symDifference=function(l,h){return ga.overlayOp(l,h,ti.SYMDIFFERENCE)},ga.difference=function(l,h){return ga.overlayOp(l,h,ti.DIFFERENCE)};var $i=function(l,h){this._geom=new Array(2).fill(null),this._geom[0]=l,this._geom[1]=h};$i.prototype.getResultGeometry=function(l){var h=null,_=!1,w=null;try{h=ti.overlayOp(this._geom[0],this._geom[1],l),_=!0}catch(I){if(!(I instanceof Le))throw I;w=I}if(!_)try{h=ga.overlayOp(this._geom[0],this._geom[1],l)}catch(I){throw I instanceof Le?w:I}return h},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i},$i.overlayOp=function(l,h,_){return new $i(l,h).getResultGeometry(_)},$i.union=function(l,h){return $i.overlayOp(l,h,ti.UNION)},$i.intersection=function(l,h){return $i.overlayOp(l,h,ti.INTERSECTION)},$i.symDifference=function(l,h){return $i.overlayOp(l,h,ti.SYMDIFFERENCE)},$i.difference=function(l,h){return $i.overlayOp(l,h,ti.DIFFERENCE)};var Wu=function(){this.mce=null,this.chainIndex=null;var h=arguments[1];this.mce=arguments[0],this.chainIndex=h};Wu.prototype.computeIntersections=function(l,h){this.mce.computeIntersectsForChain(this.chainIndex,l.mce,l.chainIndex,h)},Wu.prototype.interfaces_=function(){return[]},Wu.prototype.getClass=function(){return Wu};var ml=function l(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var h=arguments[0],_=arguments[1];this._eventType=l.DELETE,this._xValue=h,this._insertEvent=_}else if(3===arguments.length){var w=arguments[0],I=arguments[1],U=arguments[2];this._eventType=l.INSERT,this._label=w,this._xValue=I,this._obj=U}},tc={INSERT:{configurable:!0},DELETE:{configurable:!0}};ml.prototype.isDelete=function(){return this._eventType===ml.DELETE},ml.prototype.setDeleteEventIndex=function(l){this._deleteEventIndex=l},ml.prototype.getObject=function(){return this._obj},ml.prototype.compareTo=function(l){return this._xValue<l._xValue?-1:this._xValue>l._xValue?1:this._eventType<l._eventType?-1:this._eventType>l._eventType?1:0},ml.prototype.getInsertEvent=function(){return this._insertEvent},ml.prototype.isInsert=function(){return this._eventType===ml.INSERT},ml.prototype.isSameLabel=function(l){return null!==this._label&&this._label===l._label},ml.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ml.prototype.interfaces_=function(){return[oe]},ml.prototype.getClass=function(){return ml},tc.INSERT.get=function(){return 1},tc.DELETE.get=function(){return 2},Object.defineProperties(ml,tc);var tl=function(){};tl.prototype.interfaces_=function(){return[]},tl.prototype.getClass=function(){return tl};var aa=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var h=arguments[1],_=arguments[2];this._li=arguments[0],this._includeProper=h,this._recordIsolated=_};aa.prototype.isTrivialIntersection=function(l,h,_,w){if(l===_&&1===this._li.getIntersectionNum()){if(aa.isAdjacentSegments(h,w))return!0;if(l.isClosed()){var I=l.getNumPoints()-1;if(0===h&&w===I||0===w&&h===I)return!0}}return!1},aa.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},aa.prototype.setIsDoneIfProperInt=function(l){this._isDoneWhenProperInt=l},aa.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},aa.prototype.isBoundaryPointInternal=function(l,h){for(var _=h.iterator();_.hasNext();){var w=_.next().getCoordinate();if(l.isIntersection(w))return!0}return!1},aa.prototype.hasProperIntersection=function(){return this._hasProper},aa.prototype.hasIntersection=function(){return this._hasIntersection},aa.prototype.isDone=function(){return this._isDone},aa.prototype.isBoundaryPoint=function(l,h){return!(null===h||!this.isBoundaryPointInternal(l,h[0])&&!this.isBoundaryPointInternal(l,h[1]))},aa.prototype.setBoundaryNodes=function(l,h){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=l,this._bdyNodes[1]=h},aa.prototype.addIntersections=function(l,h,_,w){if(l===_&&h===w)return null;this.numTests++;var I=l.getCoordinates()[h],U=l.getCoordinates()[h+1],q=_.getCoordinates()[w],he=_.getCoordinates()[w+1];this._li.computeIntersection(I,U,q,he),this._li.hasIntersection()&&(this._recordIsolated&&(l.setIsolated(!1),_.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(l,h,_,w)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(l.addIntersections(this._li,h,0),_.addIntersections(this._li,w,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},aa.prototype.interfaces_=function(){return[]},aa.prototype.getClass=function(){return aa},aa.isAdjacentSegments=function(l,h){return 1===Math.abs(l-h)};var Fc=function(l){function h(){l.call(this),this.events=new Tn,this.nOverlaps=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.prepareEvents=function(){Da.sort(this.events);for(var _=0;_<this.events.size();_++){var w=this.events.get(_);w.isDelete()&&w.getInsertEvent().setDeleteEventIndex(_)}},h.prototype.computeIntersections=function(){if(1===arguments.length){var _=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var w=0;w<this.events.size();w++){var I=this.events.get(w);if(I.isInsert()&&this.processOverlaps(w,I.getDeleteEventIndex(),I,_),_.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof aa&&Bt(arguments[0],Ls)&&Bt(arguments[1],Ls)){var U=arguments[0],q=arguments[1],he=arguments[2];this.addEdges(U,U),this.addEdges(q,q),this.computeIntersections(he)}else if("boolean"==typeof arguments[2]&&Bt(arguments[0],Ls)&&arguments[1]instanceof aa){var ke=arguments[0],wt=arguments[1];arguments[2]?this.addEdges(ke,null):this.addEdges(ke),this.computeIntersections(wt)}},h.prototype.addEdge=function(_,w){for(var I=_.getMonotoneChainEdge(),U=I.getStartIndexes(),q=0;q<U.length-1;q++){var he=new Wu(I,q),ke=new ml(w,I.getMinX(q),he);this.events.add(ke),this.events.add(new ml(I.getMaxX(q),ke))}},h.prototype.processOverlaps=function(_,w,I,U){for(var q=I.getObject(),he=_;he<w;he++){var ke=this.events.get(he);if(ke.isInsert()){var wt=ke.getObject();I.isSameLabel(ke)||(q.computeIntersections(wt,U),this.nOverlaps++)}}},h.prototype.addEdges=function(){if(1===arguments.length)for(var _=arguments[0].iterator();_.hasNext();){var w=_.next();this.addEdge(w,w)}else if(2===arguments.length)for(var U=arguments[1],q=arguments[0].iterator();q.hasNext();){var he=q.next();this.addEdge(he,U)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(tl),Na=function(){this._min=te.POSITIVE_INFINITY,this._max=te.NEGATIVE_INFINITY},hs={NodeComparator:{configurable:!0}};Na.prototype.getMin=function(){return this._min},Na.prototype.intersects=function(l,h){return!(this._min>h||this._max<l)},Na.prototype.getMax=function(){return this._max},Na.prototype.toString=function(){return Nt.toLineString(new ne(this._min,0),new ne(this._max,0))},Na.prototype.interfaces_=function(){return[]},Na.prototype.getClass=function(){return Na},hs.NodeComparator.get=function(){return Cc},Object.defineProperties(Na,hs);var Cc=function(){};Cc.prototype.compare=function(l,h){var I=(l._min+l._max)/2,U=(h._min+h._max)/2;return I<U?-1:I>U?1:0},Cc.prototype.interfaces_=function(){return[me]},Cc.prototype.getClass=function(){return Cc};var lf=function(l){function h(){l.call(this),this._item=null;var w=arguments[1],I=arguments[2];this._min=arguments[0],this._max=w,this._item=I}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.query=function(_,w,I){if(!this.intersects(_,w))return null;I.visitItem(this._item)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Na),xd=function(l){function h(){l.call(this),this._node1=null,this._node2=null;var w=arguments[1];this._node1=arguments[0],this._node2=w,this.buildExtent(this._node1,this._node2)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.buildExtent=function(_,w){this._min=Math.min(_._min,w._min),this._max=Math.max(_._max,w._max)},h.prototype.query=function(_,w,I){if(!this.intersects(_,w))return null;null!==this._node1&&this._node1.query(_,w,I),null!==this._node2&&this._node2.query(_,w,I)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Na),Ea=function(){this._leaves=new Tn,this._root=null,this._level=0};Ea.prototype.buildTree=function(){Da.sort(this._leaves,new Na.NodeComparator);for(var l=this._leaves,h=null,_=new Tn;;){if(this.buildLevel(l,_),1===_.size())return _.get(0);h=l,l=_,_=h}},Ea.prototype.insert=function(l,h,_){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new lf(l,h,_))},Ea.prototype.query=function(l,h,_){this.init(),this._root.query(l,h,_)},Ea.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Ea.prototype.printNode=function(l){pr.out.println(Nt.toLineString(new ne(l._min,this._level),new ne(l._max,this._level)))},Ea.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Ea.prototype.buildLevel=function(l,h){this._level++,h.clear();for(var _=0;_<l.size();_+=2){var w=l.get(_);if(null===(_+1<l.size()?l.get(_):null))h.add(w);else{var I=new xd(l.get(_),l.get(_+1));h.add(I)}}},Ea.prototype.interfaces_=function(){return[]},Ea.prototype.getClass=function(){return Ea};var nc=function(){this._items=new Tn};nc.prototype.visitItem=function(l){this._items.add(l)},nc.prototype.getItems=function(){return this._items},nc.prototype.interfaces_=function(){return[Cl]},nc.prototype.getClass=function(){return nc};var Ou=function(){this._index=null;var l=arguments[0];if(!Bt(l,Wi))throw new Q("Argument must be Polygonal");this._index=new rc(l)},mi={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Ou.prototype.locate=function(l){var h=new vn(l),_=new vu(h);return this._index.query(l.y,l.y,_),h.getLocation()},Ou.prototype.interfaces_=function(){return[Wl]},Ou.prototype.getClass=function(){return Ou},mi.SegmentVisitor.get=function(){return vu},mi.IntervalIndexedGeometry.get=function(){return rc},Object.defineProperties(Ou,mi);var vu=function(){this._counter=null,this._counter=arguments[0]};vu.prototype.visitItem=function(l){var h=l;this._counter.countSegment(h.getCoordinate(0),h.getCoordinate(1))},vu.prototype.interfaces_=function(){return[Cl]},vu.prototype.getClass=function(){return vu};var rc=function(){this._index=new Ea,this.init(arguments[0])};rc.prototype.init=function(l){for(var h=Ys.getLines(l).iterator();h.hasNext();){var _=h.next().getCoordinates();this.addLine(_)}},rc.prototype.addLine=function(l){for(var h=1;h<l.length;h++){var _=new wr(l[h-1],l[h]),w=Math.min(_.p0.y,_.p1.y),I=Math.max(_.p0.y,_.p1.y);this._index.insert(w,I,_)}},rc.prototype.query=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1],_=new nc;return this._index.query(l,h,_),_.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},rc.prototype.interfaces_=function(){return[]},rc.prototype.getClass=function(){return rc};var rh=function(l){function h(){if(l.call(this),this._parentGeom=null,this._lineEdgeMap=new On,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new sl,2===arguments.length){var w=arguments[1],I=gi.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=w,this._boundaryNodeRule=I,null!==w&&this.add(w)}else if(3===arguments.length){var q=arguments[1],he=arguments[2];this._argIndex=arguments[0],this._parentGeom=q,this._boundaryNodeRule=he,null!==q&&this.add(q)}}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.insertBoundaryPoint=function(_,w){var I=this._nodes.addNode(w).getLabel(),U=1;I.getLocation(_,cn.ON)===Se.BOUNDARY&&U++;var q=h.determineBoundary(this._boundaryNodeRule,U);I.setLocation(_,q)},h.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var U=arguments[1],q=arguments[2],he=new aa(arguments[0],!0,!1);return he.setIsDoneIfProperInt(q),this.createEdgeSetIntersector().computeIntersections(this._edges,he,U||!(this._parentGeom instanceof ca||this._parentGeom instanceof Xi||this._parentGeom instanceof so)),this.addSelfIntersectionNodes(this._argIndex),he}},h.prototype.computeSplitEdges=function(_){for(var w=this._edges.iterator();w.hasNext();)w.next().eiList.addSplitEdges(_)},h.prototype.computeEdgeIntersections=function(_,w,I){var U=new aa(w,I,!0);return U.setBoundaryNodes(this.getBoundaryNodes(),_.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,_._edges,U),U},h.prototype.getGeometry=function(){return this._parentGeom},h.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},h.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},h.prototype.addPoint=function(){if(arguments[0]instanceof Zr){var _=arguments[0].getCoordinate();this.insertPoint(this._argIndex,_,Se.INTERIOR)}else arguments[0]instanceof ne&&this.insertPoint(this._argIndex,arguments[0],Se.INTERIOR)},h.prototype.addPolygon=function(_){this.addPolygonRing(_.getExteriorRing(),Se.EXTERIOR,Se.INTERIOR);for(var w=0;w<_.getNumInteriorRing();w++){var I=_.getInteriorRingN(w);this.addPolygonRing(I,Se.INTERIOR,Se.EXTERIOR)}},h.prototype.addEdge=function(_){this.insertEdge(_);var w=_.getCoordinates();this.insertPoint(this._argIndex,w[0],Se.BOUNDARY),this.insertPoint(this._argIndex,w[w.length-1],Se.BOUNDARY)},h.prototype.addLineString=function(_){var w=Fr.removeRepeatedPoints(_.getCoordinates());if(w.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=w[0],null;var I=new Ru(w,new Jr(this._argIndex,Se.INTERIOR));this._lineEdgeMap.put(_,I),this.insertEdge(I),Me.isTrue(w.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,w[0]),this.insertBoundaryPoint(this._argIndex,w[w.length-1])},h.prototype.getInvalidPoint=function(){return this._invalidPoint},h.prototype.getBoundaryPoints=function(){for(var _=this.getBoundaryNodes(),w=new Array(_.size()).fill(null),I=0,U=_.iterator();U.hasNext();){var q=U.next();w[I++]=q.getCoordinate().copy()}return w},h.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},h.prototype.addSelfIntersectionNode=function(_,w,I){if(this.isBoundaryNode(_,w))return null;I===Se.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(_,w):this.insertPoint(_,w,I)},h.prototype.addPolygonRing=function(_,w,I){if(_.isEmpty())return null;var U=Fr.removeRepeatedPoints(_.getCoordinates());if(U.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=U[0],null;var q=w,he=I;un.isCCW(U)&&(q=I,he=w);var ke=new Ru(U,new Jr(this._argIndex,Se.BOUNDARY,q,he));this._lineEdgeMap.put(_,ke),this.insertEdge(ke),this.insertPoint(this._argIndex,U[0],Se.BOUNDARY)},h.prototype.insertPoint=function(_,w,I){var U=this._nodes.addNode(w),q=U.getLabel();null===q?U._label=new Jr(_,I):q.setLocation(_,I)},h.prototype.createEdgeSetIntersector=function(){return new Fc},h.prototype.addSelfIntersectionNodes=function(_){for(var w=this._edges.iterator();w.hasNext();)for(var I=w.next(),U=I.getLabel().getLocation(_),q=I.eiList.iterator();q.hasNext();){var he=q.next();this.addSelfIntersectionNode(_,he.coord,U)}},h.prototype.add=function(){if(1!==arguments.length)return l.prototype.add.apply(this,arguments);var _=arguments[0];if(_.isEmpty())return null;if(_ instanceof so&&(this._useBoundaryDeterminationRule=!1),_ instanceof Xi)this.addPolygon(_);else if(_ instanceof nr)this.addLineString(_);else if(_ instanceof Zr)this.addPoint(_);else if(_ instanceof Yt)this.addCollection(_);else if(_ instanceof yr)this.addCollection(_);else if(_ instanceof so)this.addCollection(_);else{if(!(_ instanceof mn))throw new Error(_.getClass().getName());this.addCollection(_)}},h.prototype.addCollection=function(_){for(var w=0;w<_.getNumGeometries();w++){var I=_.getGeometryN(w);this.add(I)}},h.prototype.locate=function(_){return Bt(this._parentGeom,Wi)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Ou(this._parentGeom)),this._areaPtLocator.locate(_)):this._ptLocator.locate(_,this._parentGeom)},h.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):l.prototype.findEdge.apply(this,arguments)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.determineBoundary=function(_,w){return _.isInBoundary(w)?Se.BOUNDARY:Se.INTERIOR},h}(uo),ic=function(){if(this._li=new Jt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var l=arguments[0];this.setComputationPrecision(l.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new rh(0,l)}else if(2===arguments.length){var h=arguments[0],_=arguments[1],w=gi.OGC_SFS_BOUNDARY_RULE;h.getPrecisionModel().compareTo(_.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(_.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new rh(0,h,w),this._arg[1]=new rh(1,_,w)}else if(3===arguments.length){var I=arguments[0],U=arguments[1],q=arguments[2];I.getPrecisionModel().compareTo(U.getPrecisionModel())>=0?this.setComputationPrecision(I.getPrecisionModel()):this.setComputationPrecision(U.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new rh(0,I,q),this._arg[1]=new rh(1,U,q)}};ic.prototype.getArgGeometry=function(l){return this._arg[l].getGeometry()},ic.prototype.setComputationPrecision=function(l){this._resultPrecisionModel=l,this._li.setPrecisionModel(this._resultPrecisionModel)},ic.prototype.interfaces_=function(){return[]},ic.prototype.getClass=function(){return ic};var oc=function(){};oc.prototype.interfaces_=function(){return[]},oc.prototype.getClass=function(){return oc},oc.map=function(){if(arguments[0]instanceof kn&&Bt(arguments[1],oc.MapOp)){for(var l=arguments[0],h=arguments[1],_=new Tn,w=0;w<l.getNumGeometries();w++){var I=h.map(l.getGeometryN(w));null!==I&&_.add(I)}return l.getFactory().buildGeometry(_)}if(Bt(arguments[0],Li)&&Bt(arguments[1],oc.MapOp)){for(var U=arguments[0],q=arguments[1],he=new Tn,ke=U.iterator();ke.hasNext();){var wt=ke.next(),vt=q.map(wt);null!==vt&&he.add(vt)}return he}},oc.MapOp=function(){};var ti=function(l){function h(){var _=arguments[0];l.call(this,_,arguments[1]),this._ptLocator=new sl,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Zs,this._resultPolyList=new Tn,this._resultLineList=new Tn,this._resultPointList=new Tn,this._graph=new uo(new Xl),this._geomFact=_.getFactory()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.insertUniqueEdge=function(_){var w=this._edgeList.findEqualEdge(_);if(null!==w){var I=w.getLabel(),U=_.getLabel();w.isPointwiseEqual(_)||(U=new Jr(_.getLabel())).flip();var q=w.getDepth();q.isNull()&&q.add(I),q.add(U),I.merge(U)}else this._edgeList.add(_)},h.prototype.getGraph=function(){return this._graph},h.prototype.cancelDuplicateResultEdges=function(){for(var _=this._graph.getEdgeEnds().iterator();_.hasNext();){var w=_.next(),I=w.getSym();w.isInResult()&&I.isInResult()&&(w.setInResult(!1),I.setInResult(!1))}},h.prototype.isCoveredByLA=function(_){return!!this.isCovered(_,this._resultLineList)||!!this.isCovered(_,this._resultPolyList)},h.prototype.computeGeometry=function(_,w,I,U){var q=new Tn;return q.addAll(_),q.addAll(w),q.addAll(I),q.isEmpty()?h.createEmptyResult(U,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(q)},h.prototype.mergeSymLabels=function(){for(var _=this._graph.getNodes().iterator();_.hasNext();)_.next().getEdges().mergeSymLabels()},h.prototype.isCovered=function(_,w){for(var I=w.iterator();I.hasNext();){var U=I.next();if(this._ptLocator.locate(_,U)!==Se.EXTERIOR)return!0}return!1},h.prototype.replaceCollapsedEdges=function(){for(var _=new Tn,w=this._edgeList.iterator();w.hasNext();){var I=w.next();I.isCollapsed()&&(w.remove(),_.add(I.getCollapsedEdge()))}this._edgeList.addAll(_)},h.prototype.updateNodeLabelling=function(){for(var _=this._graph.getNodes().iterator();_.hasNext();){var w=_.next(),I=w.getEdges().getLabel();w.getLabel().merge(I)}},h.prototype.getResultGeometry=function(_){return this.computeOverlay(_),this._resultGeom},h.prototype.insertUniqueEdges=function(_){for(var w=_.iterator();w.hasNext();){var I=w.next();this.insertUniqueEdge(I)}},h.prototype.computeOverlay=function(_){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var w=new Tn;this._arg[0].computeSplitEdges(w),this._arg[1].computeSplitEdges(w),this.insertUniqueEdges(w),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Oa.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(_),this.cancelDuplicateResultEdges();var I=new Ns(this._geomFact);I.add(this._graph),this._resultPolyList=I.getPolygons();var U=new el(this,this._geomFact,this._ptLocator);this._resultLineList=U.build(_);var q=new Dl(this,this._geomFact,this._ptLocator);this._resultPointList=q.build(_),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,_)},h.prototype.labelIncompleteNode=function(_,w){var I=this._ptLocator.locate(_.getCoordinate(),this._arg[w].getGeometry());_.getLabel().setLocation(w,I)},h.prototype.copyPoints=function(_){for(var w=this._arg[_].getNodeIterator();w.hasNext();){var I=w.next();this._graph.addNode(I.getCoordinate()).setLabel(_,I.getLabel().getLocation(_))}},h.prototype.findResultAreaEdges=function(_){for(var w=this._graph.getEdgeEnds().iterator();w.hasNext();){var I=w.next(),U=I.getLabel();U.isArea()&&!I.isInteriorAreaEdge()&&h.isResultOfOp(U.getLocation(0,cn.RIGHT),U.getLocation(1,cn.RIGHT),_)&&I.setInResult(!0)}},h.prototype.computeLabelsFromDepths=function(){for(var _=this._edgeList.iterator();_.hasNext();){var w=_.next(),I=w.getLabel(),U=w.getDepth();if(!U.isNull()){U.normalize();for(var q=0;q<2;q++)I.isNull(q)||!I.isArea()||U.isNull(q)||(0===U.getDelta(q)?I.toLine(q):(Me.isTrue(!U.isNull(q,cn.LEFT),"depth of LEFT side has not been initialized"),I.setLocation(q,cn.LEFT,U.getLocation(q,cn.LEFT)),Me.isTrue(!U.isNull(q,cn.RIGHT),"depth of RIGHT side has not been initialized"),I.setLocation(q,cn.RIGHT,U.getLocation(q,cn.RIGHT))))}}},h.prototype.computeLabelling=function(){for(var _=this._graph.getNodes().iterator();_.hasNext();)_.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},h.prototype.labelIncompleteNodes=function(){for(var _=this._graph.getNodes().iterator();_.hasNext();){var w=_.next(),I=w.getLabel();w.isIsolated()&&(I.isNull(0)?this.labelIncompleteNode(w,0):this.labelIncompleteNode(w,1)),w.getEdges().updateLabelling(I)}},h.prototype.isCoveredByA=function(_){return!!this.isCovered(_,this._resultPolyList)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ic);ti.overlayOp=function(l,h,_){return new ti(l,h).getResultGeometry(_)},ti.intersection=function(l,h){if(l.isEmpty()||h.isEmpty())return ti.createEmptyResult(ti.INTERSECTION,l,h,l.getFactory());if(l.isGeometryCollection()){var _=h;return Yl.map(l,{interfaces_:function(){return[oc.MapOp]},map:function(w){return w.intersection(_)}})}return l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),$i.overlayOp(l,h,ti.INTERSECTION)},ti.symDifference=function(l,h){if(l.isEmpty()||h.isEmpty()){if(l.isEmpty()&&h.isEmpty())return ti.createEmptyResult(ti.SYMDIFFERENCE,l,h,l.getFactory());if(l.isEmpty())return h.copy();if(h.isEmpty())return l.copy()}return l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),$i.overlayOp(l,h,ti.SYMDIFFERENCE)},ti.resultDimension=function(l,h,_){var w=h.getDimension(),I=_.getDimension(),U=-1;switch(l){case ti.INTERSECTION:U=Math.min(w,I);break;case ti.UNION:U=Math.max(w,I);break;case ti.DIFFERENCE:U=w;break;case ti.SYMDIFFERENCE:U=Math.max(w,I)}return U},ti.createEmptyResult=function(l,h,_,w){var I=null;switch(ti.resultDimension(l,h,_)){case-1:I=w.createGeometryCollection(new Array(0).fill(null));break;case 0:I=w.createPoint();break;case 1:I=w.createLineString();break;case 2:I=w.createPolygon()}return I},ti.difference=function(l,h){return l.isEmpty()?ti.createEmptyResult(ti.DIFFERENCE,l,h,l.getFactory()):h.isEmpty()?l.copy():(l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),$i.overlayOp(l,h,ti.DIFFERENCE))},ti.isResultOfOp=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1],_=l.getLocation(0),w=l.getLocation(1);return ti.isResultOfOp(_,w,h)}if(3===arguments.length){var I=arguments[0],U=arguments[1];switch(I===Se.BOUNDARY&&(I=Se.INTERIOR),U===Se.BOUNDARY&&(U=Se.INTERIOR),arguments[2]){case ti.INTERSECTION:return I===Se.INTERIOR&&U===Se.INTERIOR;case ti.UNION:return I===Se.INTERIOR||U===Se.INTERIOR;case ti.DIFFERENCE:return I===Se.INTERIOR&&U!==Se.INTERIOR;case ti.SYMDIFFERENCE:return I===Se.INTERIOR&&U!==Se.INTERIOR||I!==Se.INTERIOR&&U===Se.INTERIOR}return!1}},ti.INTERSECTION=1,ti.UNION=2,ti.DIFFERENCE=3,ti.SYMDIFFERENCE=4;var Lu=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new sl,this._seg=new wr;var l=arguments[0],h=arguments[1];this._g=l,this._boundaryDistanceTolerance=h,this._linework=this.extractLinework(l)};Lu.prototype.isWithinToleranceOfBoundary=function(l){for(var h=0;h<this._linework.getNumGeometries();h++)for(var _=this._linework.getGeometryN(h).getCoordinateSequence(),w=0;w<_.size()-1;w++)if(_.getCoordinate(w,this._seg.p0),_.getCoordinate(w+1,this._seg.p1),this._seg.distance(l)<=this._boundaryDistanceTolerance)return!0;return!1},Lu.prototype.getLocation=function(l){return this.isWithinToleranceOfBoundary(l)?Se.BOUNDARY:this._ptLocator.locate(l,this._g)},Lu.prototype.extractLinework=function(l){var h=new Nu;l.apply(h);var _=h.getLinework(),w=at.toLineStringArray(_);return l.getFactory().createMultiLineString(w)},Lu.prototype.interfaces_=function(){return[]},Lu.prototype.getClass=function(){return Lu};var Nu=function(){this._linework=null,this._linework=new Tn};Nu.prototype.getLinework=function(){return this._linework},Nu.prototype.filter=function(l){if(l instanceof Xi){var h=l;this._linework.add(h.getExteriorRing());for(var _=0;_<h.getNumInteriorRing();_++)this._linework.add(h.getInteriorRingN(_))}},Nu.prototype.interfaces_=function(){return[dn]},Nu.prototype.getClass=function(){return Nu};var Dn=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};Dn.prototype.extractPoints=function(l,h,_){for(var w=l.getCoordinates(),I=0;I<w.length-1;I++)this.computeOffsetPoints(w[I],w[I+1],h,_)},Dn.prototype.setSidesToGenerate=function(l,h){this._doLeft=l,this._doRight=h},Dn.prototype.getPoints=function(l){for(var h=new Tn,_=Ys.getLines(this._g).iterator();_.hasNext();){var w=_.next();this.extractPoints(w,l,h)}return h},Dn.prototype.computeOffsetPoints=function(l,h,_,w){var I=h.x-l.x,U=h.y-l.y,q=Math.sqrt(I*I+U*U),he=_*I/q,ke=_*U/q,wt=(h.x+l.x)/2,vt=(h.y+l.y)/2;if(this._doLeft){var on=new ne(wt-ke,vt+he);w.add(on)}if(this._doRight){var Gn=new ne(wt+ke,vt-he);w.add(Gn)}},Dn.prototype.interfaces_=function(){return[]},Dn.prototype.getClass=function(){return Dn};var si=function l(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=l.TOLERANCE,this._testCoords=new Tn;var h=arguments[0],_=arguments[1],w=arguments[2];this._boundaryDistanceTolerance=l.computeBoundaryDistanceTolerance(h,_),this._geom=[h,_,w],this._locFinder=[new Lu(this._geom[0],this._boundaryDistanceTolerance),new Lu(this._geom[1],this._boundaryDistanceTolerance),new Lu(this._geom[2],this._boundaryDistanceTolerance)]},kf={TOLERANCE:{configurable:!0}};si.prototype.reportResult=function(l,h,_){pr.out.println("Overlay result invalid - A:"+Se.toLocationSymbol(h[0])+" B:"+Se.toLocationSymbol(h[1])+" expected:"+(_?"i":"e")+" actual:"+Se.toLocationSymbol(h[2]))},si.prototype.isValid=function(l){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(l)},si.prototype.checkValid=function(){if(1===arguments.length){for(var l=arguments[0],h=0;h<this._testCoords.size();h++){var _=this._testCoords.get(h);if(!this.checkValid(l,_))return this._invalidLocation=_,!1}return!0}if(2===arguments.length){var w=arguments[0],I=arguments[1];return this._location[0]=this._locFinder[0].getLocation(I),this._location[1]=this._locFinder[1].getLocation(I),this._location[2]=this._locFinder[2].getLocation(I),!!si.hasLocation(this._location,Se.BOUNDARY)||this.isValidResult(w,this._location)}},si.prototype.addTestPts=function(l){var h=new Dn(l);this._testCoords.addAll(h.getPoints(5*this._boundaryDistanceTolerance))},si.prototype.isValidResult=function(l,h){var _=ti.isResultOfOp(h[0],h[1],l),w=!(_^h[2]===Se.INTERIOR);return w||this.reportResult(l,h,_),w},si.prototype.getInvalidLocation=function(){return this._invalidLocation},si.prototype.interfaces_=function(){return[]},si.prototype.getClass=function(){return si},si.hasLocation=function(l,h){for(var _=0;_<3;_++)if(l[_]===h)return!0;return!1},si.computeBoundaryDistanceTolerance=function(l,h){return Math.min(As.computeSizeBasedSnapTolerance(l),As.computeSizeBasedSnapTolerance(h))},si.isValid=function(l,h,_,w){return new si(l,h,w).isValid(_)},kf.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(si,kf);var yl=function l(h){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=l.extractFactory(h),this._inputGeoms=h};yl.prototype.extractElements=function(l,h){if(null===l)return null;for(var _=0;_<l.getNumGeometries();_++){var w=l.getGeometryN(_);this._skipEmpty&&w.isEmpty()||h.add(w)}},yl.prototype.combine=function(){for(var l=new Tn,h=this._inputGeoms.iterator();h.hasNext();){var _=h.next();this.extractElements(_,l)}return 0===l.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(l)},yl.prototype.interfaces_=function(){return[]},yl.prototype.getClass=function(){return yl},yl.combine=function(){return 1===arguments.length?new yl(arguments[0]).combine():2===arguments.length?new yl(yl.createList(arguments[0],arguments[1])).combine():3===arguments.length?new yl(yl.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},yl.extractFactory=function(l){return l.isEmpty()?null:l.iterator().next().getFactory()},yl.createList=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1],_=new Tn;return _.add(l),_.add(h),_}if(3===arguments.length){var w=arguments[0],I=arguments[1],U=arguments[2],q=new Tn;return q.add(w),q.add(I),q.add(U),q}};var Oi=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new Tn)},uf={STRTREE_NODE_CAPACITY:{configurable:!0}};Oi.prototype.reduceToGeometries=function(l){for(var h=new Tn,_=l.iterator();_.hasNext();){var w=_.next(),I=null;Bt(w,Ls)?I=this.unionTree(w):w instanceof kn&&(I=w),h.add(I)}return h},Oi.prototype.extractByEnvelope=function(l,h,_){for(var w=new Tn,I=0;I<h.getNumGeometries();I++){var U=h.getGeometryN(I);U.getEnvelopeInternal().intersects(l)?w.add(U):_.add(U)}return this._geomFactory.buildGeometry(w)},Oi.prototype.unionOptimized=function(l,h){var _=l.getEnvelopeInternal(),w=h.getEnvelopeInternal();if(!_.intersects(w))return yl.combine(l,h);if(l.getNumGeometries()<=1&&h.getNumGeometries()<=1)return this.unionActual(l,h);var I=_.intersection(w);return this.unionUsingEnvelopeIntersection(l,h,I)},Oi.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var l=new Ih(Oi.STRTREE_NODE_CAPACITY),h=this._inputPolys.iterator();h.hasNext();){var _=h.next();l.insert(_.getEnvelopeInternal(),_)}this._inputPolys=null;var w=l.itemsTree();return this.unionTree(w)},Oi.prototype.binaryUnion=function(){if(1===arguments.length){var l=arguments[0];return this.binaryUnion(l,0,l.size())}if(3===arguments.length){var h=arguments[0],_=arguments[1],w=arguments[2];if(w-_<=1){var I=Oi.getGeometry(h,_);return this.unionSafe(I,null)}if(w-_==2)return this.unionSafe(Oi.getGeometry(h,_),Oi.getGeometry(h,_+1));var U=Math.trunc((w+_)/2),q=this.binaryUnion(h,_,U),he=this.binaryUnion(h,U,w);return this.unionSafe(q,he)}},Oi.prototype.repeatedUnion=function(l){for(var h=null,_=l.iterator();_.hasNext();){var w=_.next();h=null===h?w.copy():h.union(w)}return h},Oi.prototype.unionSafe=function(l,h){return null===l&&null===h?null:null===l?h.copy():null===h?l.copy():this.unionOptimized(l,h)},Oi.prototype.unionActual=function(l,h){return Oi.restrictToPolygons(l.union(h))},Oi.prototype.unionTree=function(l){var h=this.reduceToGeometries(l);return this.binaryUnion(h)},Oi.prototype.unionUsingEnvelopeIntersection=function(l,h,_){var w=new Tn,I=this.extractByEnvelope(_,l,w),U=this.extractByEnvelope(_,h,w),q=this.unionActual(I,U);return w.add(q),yl.combine(w)},Oi.prototype.bufferUnion=function(){if(1===arguments.length){var l=arguments[0];return l.get(0).getFactory().buildGeometry(l).buffer(0)}if(2===arguments.length){var h=arguments[0],_=arguments[1];return h.getFactory().createGeometryCollection([h,_]).buffer(0)}},Oi.prototype.interfaces_=function(){return[]},Oi.prototype.getClass=function(){return Oi},Oi.restrictToPolygons=function(l){if(Bt(l,Wi))return l;var h=Ja.getPolygons(l);return 1===h.size()?h.get(0):l.getFactory().createMultiPolygon(at.toPolygonArray(h))},Oi.getGeometry=function(l,h){return h>=l.size()?null:l.get(h)},Oi.union=function(l){return new Oi(l).union()},uf.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Oi,uf);var xu=function(){};xu.prototype.interfaces_=function(){return[]},xu.prototype.getClass=function(){return xu},xu.union=function(l,h){if(l.isEmpty()||h.isEmpty()){if(l.isEmpty()&&h.isEmpty())return ti.createEmptyResult(ti.UNION,l,h,l.getFactory());if(l.isEmpty())return h.copy();if(h.isEmpty())return l.copy()}return l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),$i.overlayOp(l,h,ti.UNION)},xe.GeoJSONReader=Qn,xe.GeoJSONWriter=jn,xe.OverlayOp=ti,xe.UnionOp=xu,xe.BufferOp=Bi,Object.defineProperty(xe,"__esModule",{value:!0})}(rt)},4703:Lt=>{Lt.exports=function xe(){for(var de={},ye=0;ye<arguments.length;ye++){var Ce=arguments[ye];for(var p in Ce)rt.call(Ce,p)&&(de[p]=Ce[p])}return de};var rt=Object.prototype.hasOwnProperty},9652:(Lt,rt,xe)=>{"use strict";xe.d(rt,{x0:()=>p});let p=(K=21)=>crypto.getRandomValues(new Uint8Array(K)).reduce((ge,Te)=>ge+((Te&=63)<36?Te.toString(36):Te<62?(Te-26).toString(36).toUpperCase():Te>62?"-":"_"),"")}},Lt=>{Lt(Lt.s=3659)}]);